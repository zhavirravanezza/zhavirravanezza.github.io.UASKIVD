// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/ThreatAnalysis/setting/newThreatType.html":'\x3cdiv class\x3d"esriCTPopupContainer"\x3e \r\n\r\n  \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n    \x3cdiv class\x3d"esriCTDeafultIconWrapper"\x3e\r\n      \x3cspan class\x3d"esriCTDefaultLabel"\x3e${nls.chooseDefaultThreatTypeIconLabel}\x3c/span\x3e\r\n      \x3cdiv class\x3d"esriCTDefaultIcon" data-dojo-attach-point\x3d"defaultThreatTypeIcon"\r\n        title\x3d"${nls.defaultThreatTypeIconTooltip}"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n    \x3cdiv class\x3d"esriCTLabel"\x3e${nls.threatTypeLabel}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTDijitControl"\x3e\r\n      \x3cdiv class\x3d"esriCTDijitWrapper"\x3e\r\n        \x3cdiv class\x3d"esriCTDijitWrapper" data-dojo-attach-point\x3d"threatTypeTextBox"\r\n          data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true" required\x3d"true"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"esriCTAddBtnWrapper"\x3e\r\n    \x3cdiv class\x3d"esriCTAddZoneBtn" data-dojo-attach-point\x3d"addZoneButton"\x3e\r\n      \x3cspan class\x3d"esriCTBtnAddIcon"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"esriCTBtnAddLabel"\x3e${nls.addThreatZoneButtonLabel}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTWrapper esriCTZonesTableMaxHeight" data-dojo-attach-point\x3d"threatZonesTableNode"\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./newThreatType.html dojo/_base/lang jimu/dijit/Popup dojo/Evented dojo/number ./defaultThreatTypes dojo/on dojo/_base/array jimu/dijit/SimpleTable ./newZone jimu/utils jimu/dijit/Message dojo/string dojo/_base/kernel dijit/form/ValidationTextBox dijit/form/TextBox dijit/form/Select".split(" "),function(m,n,p,q,r,d,t,u,l,v,g,h,w,x,k,y,z,A){return m([n,p,q,u],{templateString:r,baseClass:"jimu-widget-threatAnalysis-newThreatTypePopup",
prevThreatType:null,selectedThreatType:null,constructor:function(){},postCreate:function(){this.currentRowData&&this.currentRowData.threatType&&(this.prevThreatType=this.currentRowData.threatType,this.threatTypeTextBox.set("value",this.currentRowData.threatType),this.threatTypeTextBox.set("title",this.currentRowData.threatType));this.selectedUnitAbbr="feet"===this.selectedUnitType.toLowerCase()?this.nls.feetAbbr:this.nls.metersAbbr;this._threatTypeTextBoxValidator();this._createZoneTable();this._populateZoneTableRows();
this._createPopUp();this._handleClickEvents()},_handleClickEvents:function(){this.own(g(this.addZoneButton,"click",d.hitch(this,function(){this._createNewZonePopup(!0)})));this.own(g(this.threatTypeTextBox,"blur",d.hitch(this,function(){this.threatTypeTextBox.set("value",k.stripHTML(k.sanitizeHTML(this.threatTypeTextBox.value)));this.threatTypeTextBox.set("title",k.stripHTML(k.sanitizeHTML(this.threatTypeTextBox.value)))})));this.own(g(this.defaultThreatTypeIcon,"click",d.hitch(this,this._onDefaultThreatTypeIconClick)))},
_createPopUp:function(){this.newThreatTypePopup=new t({titleLabel:this.isAddThreat?this.nls.newThreatTypePopupLabel:this.nls.editThreatLabel,width:600,maxHeight:800,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,onClick:d.hitch(this,function(){0===this._threatZonesTable.getRows().length||!this.threatTypeTextBox.isValid()||this._isDuplicateZoneNames()?new y({message:this.nls.threatTypeHelp}):(this.emit("threatInfoUpdated",{threatName:k.stripHTML(k.sanitizeHTML(this.threatTypeTextBox.value)),
zones:this._getZoneTableInfo()}),this.newThreatTypePopup.close())})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:d.hitch(this,function(){this.newThreatTypePopup.close()})}]})},_isDuplicateThreatTypeName:function(a){var b=!1;h.some(this.existingThreatNames,d.hitch(this,function(c){if(this._getThreatTypeNls(a).toLowerCase()===c.toLowerCase())return b=!0}));return b},_threatTypeTextBoxValidator:function(){this.threatTypeTextBox.validator=d.hitch(this,function(a){return a?a!==this.prevThreatType&&
this._isDuplicateThreatTypeName(a)?(this.threatTypeTextBox.set("invalidMessage",this.nls.uniqueThreatTypeMsg),!1):!0:(this.threatTypeTextBox.set("invalidMessage",this.nls.requiredMsg),!1)})},_createZoneTable:function(){var a={fields:[{name:"zoneDescription",title:this.nls.zoneDescriptionColLabel,type:"text",width:"40%"},{name:"distance",title:z.substitute(this.nls.distanceLabel,{unitAbbr:this.selectedUnitAbbr}),type:"text",width:"40%"},{name:"symbol",title:this.nls.symbologyColLabel,type:"text",hidden:!0},
{name:"actions",title:this.nls.actions,type:"actions","class":"actions",actions:["edit","delete"],width:"20%"}],selectable:!1};this._threatZonesTable=new w(a);this._threatZonesTable.placeAt(this.threatZonesTableNode);this._threatZonesTable.startup();this.own(g(this._threatZonesTable,"actions-edit",d.hitch(this,this._onEditZoneInfoClick)))},_populateZoneTableRows:function(){if(this.currentRow&&this.currentRow.hasOwnProperty("_configInfo")&&this.currentRow._configInfo&&this.currentRow._configInfo.hasOwnProperty("zones")){var a=
this._sortZonesInAscOrder(this.currentRow._configInfo.zones);h.forEach(a,d.hitch(this,function(b){this._addRowToZoneTable(b)}))}},_addRowToZoneTable:function(a){var b=a.distance;var c={zoneDescription:this._getZoneNameNls(a.name),distance:l.format(b,{places:2}),symbol:JSON.stringify(a.symbol)};c=this._threatZonesTable.addRow(c);c.success&&c.tr&&(c=c.tr,c.zoneDescription=a.name,c.distance=b,c.symbol=a.symbol)},_getZoneNameNls:function(a){var b={"Mandatory Evacuation Distance":"mandatoryLabel","Safe Evacuation Distance":"safeLabel",
"Fireball Diameter":"fireBallDiameterLable","Safe Distance":"lpgSafeDistanceLable"};a=void 0!==b[a]?this.nls[b[a]]:a;return a},_getZoneTableInfo:function(){var a=[];var b=this._threatZonesTable.getRows();h.forEach(b,d.hitch(this,function(c){var f=this._threatZonesTable.getRowData(c),e={name:"",distance:0,symbol:{}};e.name=c.zoneDescription;e.distance=c.distance;e.symbol=JSON.parse(f.symbol);a.push(e)}));return a},_createNewZonePopup:function(a,b,c){a=new x({config:this.config,nls:this.nls,isAddZone:a,
currentRow:b,currentRowData:c,unitAbbr:this.selectedUnitAbbr,existingZoneNames:this._getExistingZoneNames()});a.startup();g(a,"zoneInfoUpdated",d.hitch(this,function(f){var e=[];b?(e={},b.zoneDescription=e.zoneDescription=f.name,b.distance=f.distance,e.distance=l.format(f.distance,{places:2}),e.symbol=JSON.stringify(f.symbol),b.symbol=f.symbol,this._threatZonesTable.editRow(b,e),e=this._getZoneTableInfo()):(e=this._getZoneTableInfo(),e.push(f));this._rePopulateZonesTableRow(e)}))},_onEditZoneInfoClick:function(a){var b=
this._threatZonesTable.getRowData(a);b&&this._createNewZonePopup(!1,a,b)},_getExistingZoneNames:function(){var a,b=[];(a=this._threatZonesTable.getRows())&&0<a.length&&h.forEach(a,d.hitch(this,function(c){c&&(c=A.locale.includes("en")?c.zoneDescription:c.innerText.split("\n")[0],b.push(c))}));return b},_sortZonesInAscOrder:function(a){return a.sort(function(b,c){return b.distance-c.distance})},_clearNewOrEditThreatPopupContent:function(){this.threatTypeTextBox.set("value","");this.threatTypeTextBox.set("title",
"");this._threatZonesTable.clear()},_onDefaultThreatTypeIconClick:function(){this.defaultThreatTypeObj=new v({nls:this.nls});this.own(g(this.defaultThreatTypeObj,"selectedDefaultThreatInfo",d.hitch(this,function(a){0!==this._threatZonesTable.getRows().length&&this._clearNewOrEditThreatPopupContent();this.threatTypeTextBox.set("value",a.threatName);this.threatTypeTextBox.set("title",a.threatName);a=this._sortZonesInAscOrder(a.zones);h.forEach(a,d.hitch(this,function(b){b.distance="feet"===this.selectedUnitType.toLowerCase()?
b.distance:.3048*b.distance;this._addRowToZoneTable(b)}))})))},_rePopulateZonesTableRow:function(a){this._threatZonesTable.clear();a=this._sortZonesInAscOrder(a);h.forEach(a,d.hitch(this,function(b){this._addRowToZoneTable(b)}))},_isDuplicateZoneNames:function(){var a=this._getZoneTableInfo();if(0<a.length){var b=a.map(function(c){return c.name});return b.some(function(c,f){return b.indexOf(c)!==f})}},_getThreatTypeNls:function(a){var b={"Pipe Bomb":"pipeBombLabel","Suicide Bomb":"suicideBombLabel",
Briefcase:"briefcaseLabel",Car:"carLabel","SUV/VAN":"suvVanLabel","Small Delivery Truck":"smallDeliveryTruckLabel","Container/Water Truck":"containerWaterTruckLabel","Semi-Trailer":"semiTrailerLabel","Small LPG Tank":"smallLPGTank","Large LPG Tank":"largeLPGTank","Commercial/Residential LPG Tank":"commercialResidentialLPGTank","Small LPG Truck":"smallLPGTruck","Semi-Tanker LPG":"semiTankerLPG"};a=void 0!==b[a]?this.nls[b[a]]:a;return a}})});