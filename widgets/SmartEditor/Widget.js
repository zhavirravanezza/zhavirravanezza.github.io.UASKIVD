// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D,z,L,F,Q,T,E){var M=O([Q,n,p],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:E,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(J,P){J=J||{};J.items||J.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=v.version.minor;this._itemWidgets={};J.featureLayers&&J.featureLayers.length&&(this._flChanged=1);this._nls=T.widgets.templatePicker;this.emptyMessage=J.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var J=
b.getContentBox(this.domNode);J.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!J.h||1>=J.h)this.domNode.style.height=this._initialAutoHeight+"px";J=b.getContentBox(this.domNode);this._columns=Math.floor(J.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();I.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>d("ie")&&(this._repaintItems=C.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var J=this._selectedCell,P=this._selectedInfo;J&&this._rowClicked({cellNode:J,rowIndex:P.selRow,cellIndex:P.selCol})},update:function(J){J=
"auto"===this.rows&&"auto"===this.columns&&J?!0:!1;var P=this.grid;if(J){var R=this.domNode;var Y=v.query("#"+R.id+".templatePicker div.item")[0];R=b.getContentBox(R);Y=(Y=Y&&Y.parentNode)?G.coords(Y).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((R.w-P.views.views[0].getScrollbarWidth())/Y))||1}Y=this._rows;this._preprocess();var Z=this._rows;this._setGridLayout();this._setGridData();Z!==Y&&P.set("autoHeight",this._rows,!1);J?(P._resize({w:R.w,h:R.h}),P.viewsHeaderNode.style.display=
"none"):P.update();this._toggleTooltip();var da=this,N=this.getSelected();N&&P.store.fetch({onComplete:function(U){var ca=(U=da._locate(N,da._selectedInfo,U))&&P.views.views[0].getCellNode(U[0],U[1]);ca&&da._rowClicked({cellNode:ca,rowIndex:U[0],cellIndex:U[1]},!0)}});9>d("ie")&&setTimeout(this._repaintItems,this._ieTimer);J=this.featureLayers;R=this.items;J&&J.length||R&&R.length||!P||!this.emptyMessage||P.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(J){var P=this.useLegend;this._started&&P===J||(J?this._flChanged=1:this._clearLegendInfo());this.useLegend=J},_setFeatureLayersAttr:function(J){var P=this.featureLayers;this._started&&P===J||(this._flChanged=1);this.featureLayers=J},_adjustRowsCols:function(J){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var P=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(P=J.length,e.forEach(J,function(R){P+=Math.ceil(R.length/this.columns)},this)):(e.forEach(J,function(R){P+=R.length},this),P=Math.ceil(P/this.columns)):P=Math.ceil(J.length/this.columns),this._rows=P):"auto"===this.columns&&(this.featureLayers?this.grouping?P=3:(e.forEach(J,function(R){P+=R.length},this),P=Math.ceil(P/this.rows)):P=Math.ceil(J.length/this.rows),this._columns=P)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),e.every(this.featureLayers,function(R){return R.loaded})){this.featureLayers=e.filter(this.featureLayers,function(R){return!(R.hasZ&&!R.enableZDefaults)});var J=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(J)}else{var P=this.featureLayers.length;e.forEach(this.featureLayers,function(R){if(R.loaded)P--;else var Y=I.connect(R,"onLoad",this,function(){I.disconnect(Y);Y=null;P--;P||this.update()})},this)}else J=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(J)},_processSelectionLayers:function(){var J,P,R,Y,Z,da,N,U={};e.forEach(this.featureLayers,function(ca,ja){ca.mode===w.MODE_SELECTION&&ca._map&&ca.url&&ca._params.drawMode&&!ca.source&&(P=C.trim(ca._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),R=U[P]=U[P]||{},Y=R.featureLayers=R.featureLayers||{},da=R.indices=R.indices||[],Y[ja]=ca,da.push(ja),J=ca._map)});J&&e.forEach(J.layerIds,function(ca){(ca=J.getLayer(ca))&&ca.url&&(ca.getImageUrl||ca.getTileUrl)&&ca.loaded&&10.1<=ca.version&&(P=C.trim(ca._url.path).replace(/(\/MapServer).*/ig,"$1"),Z=P.replace(/^https?:\/\//ig,"").toLowerCase(),U[Z]&&!U[Z].mapServiceUrl&&(R=U[Z],R.mapServiceUrl=P,R.mapServiceLayer=ca,this._legendIndices=this._legendIndices.concat(R.indices),
N=this._fetchLegend({pickerInstance:this,info:R},Z),N.then?(this._loadingIndices=this._loadingIndices.concat(R.indices),this._loadingLegends.push(N)):this._processLegendResponse(N,R)))},this)},_fetchLegend:function(J,P){var R=M.prototype,Y=R.legendCache[P];Y?Y.then&&Y._contexts.push(J):(Y=R.legendCache[P]=F({url:J.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),Y._contexts=[J],Y.addBoth(function(Z){if(!Y.canceled){R.legendCache[P]=Z;var da=Y._contexts;Y._contexts=null;
e.forEach(da,function(N){var U=N.pickerInstance;N=N.info;if(!U._destroyed){e.forEach(N.indices,function(ja){ca=e.indexOf(U._loadingIndices,ja);-1<ca&&U._loadingIndices.splice(ca,1)});var ca=e.indexOf(U._loadingLegends,Y);-1<ca&&U._loadingLegends.splice(ca,1);U._processLegendResponse(Z,N)}})}}));return Y},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
e.forEach(this._loadingLegends,function(J){var P=-1;e.some(J._contexts,function(R,Y){R.pickerInstance===this&&(P=Y);return-1<P},this);-1<P&&J._contexts.splice(P,1)},this)},_processLegendResponse:function(J,P){if(!J||J instanceof Error){var R;e.forEach(P.indices,function(Z){R=e.indexOf(this._legendIndices,Z);-1<R&&this._legendIndices.splice(R,1)},this)}else e.forEach(P.indices,function(Z){var da=P.featureLayers[Z].layerId,N,U=P.mapServiceUrl+"/"+da+"/images/",ca=P.mapServiceLayer._getToken(),ja,ia;
if(!this._legendSymbols[Z]){var X=null;e.some(J.layers,function(ba){ba.layerId==da&&(X=ba);return!!X});if(X){var W=this._legendSymbols[Z]={};e.forEach(X.legend,function(ba){if((ja=ba.values)&&ja.length)for(N=0;N<ja.length;N++)W[ja[N]]=ba;else W.defaultSymbol=ba;(ia=ba.url)&&!ba._fixed&&(ba._fixed=1,-1===ia.search(/https?:/)&&(ba.url=U+ia),ca&&-1!==ba.url.search(/https?:/)&&(ba.url+=(-1<ba.url.indexOf("?")?"\x26":"?")+"token\x3d"+ca))})}}},this);var Y=this;Y._started&&!Y._legendTimer&&(Y._legendTimer=
setTimeout(function(){clearTimeout(Y._legendTimer);Y._legendTimer=null;Y._destroyed||Y.update()},0))},_applyGridPatches:function(){var J=this.grid,P=J.adaptWidth,R,Y,Z;J.adaptWidth=function(){R=this.views.views;for(Y=0;Z=R[Y];Y++)a.set(Z.headerNode,"display","block");P.apply(this,arguments);for(Y=0;Z=R[Y];Y++)a.set(Z.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var da=I.connect(J,"_onFetchComplete",this,function(){I.disconnect(da);this.grid.set("autoHeight",
this._rows)});I.connect(J,"_onDelete",this,this._destroyItems);I.connect(J,"_clearData",this,this._destroyItems);I.connect(J,"destroy",this,this._destroyItems);(J=J.focus)&&J.findAndFocusGridCell&&(J.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var J=function(da){return function(N,U){return this._cellGet(da,N,U)}},P=C.hitch(this,this._cellFormatter),R=[],Y=this._columns,Z;for(Z=0;Z<Y;Z++)R.push({field:"cell"+Z,get:C.hitch(this,J(Z)),formatter:P});J={cells:[R]};this.grouping&&
(Y={field:"groupName",colSpan:Y,get:C.hitch(this,this._cellGetGroup),formatter:C.hitch(this,this._cellGroupFormatter)},J.cells.push([Y]));Y=this.grid;P=k.prototype.rowsPerPage;Y.set("rowsPerPage",this._rows>P?this._rows:P);Y.set("structure",J)},_setGridData:function(){var J=[];if(this.grouping){this._groupRowIndices=[];var P,R,Y=this._columns;e.forEach(this._flItems,function(da,N){J.push({});N=0===N?0:P+R+1;this._groupRowIndices.push(N);P=N;R=Math.ceil(da.length/Y);J=J.concat(this._getStoreItems(da))},
this)}else this.featureLayers?(e.forEach(this._flItems,function(da){J=J.concat(da)}),J=this._getStoreItems(J)):J=this._getStoreItems(this._itItems);var Z=new m({data:{items:J}});this.grid.setStore(Z)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=f.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var J=this.grid;this._mouseOverConnect=I.connect(J,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=
I.connect(J,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&(I.disconnect(this._mouseOverConnect),I.disconnect(this._mouseOutConnect),f.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(J,P){var R=J.cellNode,Y=J.rowIndex;J=J.cellIndex;var Z=this._getCellInfo(R,Y,J);if(Z){var da=this.grid.store;if(!da.getValue(Z,"loadingCell")&&(this._selectedCell&&h.remove(this._selectedCell,"selectedItem"),R!==this._selectedCell?(h.add(R,"selectedItem"),this._selectedCell=R,this._selectedItem=
{featureLayer:da.getValue(Z,"layer"),type:da.getValue(Z,"type"),template:da.getValue(Z,"template"),symbolInfo:da.getValue(Z,"symbolInfo"),item:this._getItem(Z)},this._selectedInfo={selRow:Y,selCol:J,index1:da.getValue(Z,"index1"),index2:da.getValue(Z,"index2"),index:da.getValue(Z,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!P))this.onSelectionChange()}},_locate:function(J,P,R){var Y=this.grid.store,Z=Array(this._columns),da,N=P.index1,U=P.index2,ca=P.index,ja=J.item;e.some(R,
function(ia,X){return e.some(Z,function(W,ba){return(W=Y.getValue(ia,"cell"+ba))&&(ja?ca===Y.getValue(W,"index"):N===Y.getValue(W,"index1")&&U===Y.getValue(W,"index2"))?(da=[X,ba],!0):!1})});return da},_getCellInfo:function(J,P,R){if(J)return J=this.grid,P=J.getItem(P),J.store.getValue(P,"cell"+R)},_getItem:function(J){var P=this.items;if(P)return P[this.grid.store.getValue(J,"index")]},_cellMouseOver:function(J){var P=this.tooltip,R=J.cellNode,Y=this._getCellInfo(R,J.rowIndex,J.cellIndex);if(P&&
Y){var Z=this.grid.store;J=Z.getValue(Y,"template");var da=Z.getValue(Y,"type"),N=Z.getValue(Y,"symbolInfo");Z=Z.getValue(Y,"layer");J=(Y=this._getItem(Y))&&Y.label+(Y.description?": "+Y.description:"")||J&&J.name+(J.description?": "+J.description:"")||da&&da.name||N&&N.label+(N.description?": "+N.description:"")||(Z&&Z.name+": ")+"Default";P.style.display="none";P.innerHTML=J;R=G.coords(R.firstChild);a.set(P,{left:R.x+"px",top:R.y+R.h+5+"px"});P.style.display=""}},_cellMouseOut:function(){var J=
this.tooltip;J&&(J.style.display="none")},_destroyItems:function(){var J=this._itemWidgets,P;for(P in J)J[P]&&(J[P].destroy(),delete J[P])},_repaintItems:function(){var J=this._itemWidgets,P;for(P in J){var R=J[P];R&&R._repaint(R._surface)}},_getStoreItems:function(J){var P=this._uniqueId;J=e.map(J,function(ia){return C.mixin({surfaceId:"tpick-surface-"+P.id++},ia)});for(var R=J.length,Y=0,Z={},da=0,N,U=[],ca=!0,ja=this._columns;Y<R;)ca=!0,N="cell"+da,Z[N]=J[Y],Y++,da++,0===da%ja&&(ca=!1,U.push(Z),
Z={},da=0);ca&&R&&U.push(Z);return U},_getItemsFromLayers:function(J){var P=[];e.forEach(J,function(R,Y){P.push(this._getItemsFromLayer(R,Y))},this);return P},_getItemsFromLayer:function(J,P){var R=[];if(this.useLegend&&-1<e.indexOf(this._loadingIndices,P))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:J,type:null,template:null,index1:P,index2:0,loadingCell:1}];var Y=[];Y=Y.concat(J.templates);e.forEach(J.types,function(U){var ca=U.templates;e.forEach(ca,function(ja){ja._type_=U});
Y=Y.concat(ca)});Y=e.filter(Y,L.isDefined);var Z=J.renderer;if(Z){var da=Z.declaredClass.replace("esri.renderer.","");if(0<Y.length)e.forEach(Y,function(U){var ca=U.prototype;if(ca){var ja;if(ja=this._isUnclassedRenderer(Z)?Z.infos[0].symbol:Z.valueExpression?this._createSimpleSymbol(J):Z.getSymbol(ca)||this._createSimpleSymbol(J)){var ia=null,X;if(!(9>t("ie"))&&U.thumbnail&&U.thumbnail.imageData)ia=new B(U.thumbnail);else if(this.useLegend&&-1<e.indexOf(this._legendIndices,P)){if(X=this._legendSymbols&&
this._legendSymbols[P])switch(da){case "SimpleRenderer":ia=X.defaultSymbol;break;case "UniqueValueRenderer":e.some(Z.infos,function(W){W.symbol===ja&&(ia=X[W.value]);return!!ia});break;case "ClassBreaksRenderer":e.some(Z.infos,function(W){W.symbol===ja&&(ia=X[W.maxValue]);return!!ia})}ia&&(ca=g.fromJson(g.toJson(B.defaultProps)),ca.url=ia.url,ca.imageData=ia.imageData,ca.contentType=ia.contentType,ca.width=ia.width,ca.height=ia.height,L.isDefined(ca.width)&&L.isDefined(ca.height)||(ca.width=15,ca.height=
15),ia=new B(ca))}R.push({label:this._trimLabel(U.name),symbol:ia||ja,legendOverride:!!ia,layer:J,type:U._type_,template:U,index1:P,index2:R.length})}else switch(da){case "HeatmapRenderer":R.push({label:this._trimLabel(U.name),symbol:new q,legendOverride:!!ia,layer:J,type:U._type_,template:U,index1:P,index2:R.length})}}delete U._type_},this);else{var N=[];"TemporalRenderer"===da&&(Z=Z.observationRenderer)&&(da=Z.declaredClass.replace("esri.renderer.",""));switch(da){case "SimpleRenderer":N=[{symbol:Z.symbol,
label:Z.label,description:Z.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":N=Z.infos}R=e.map(N,function(U,ca){return{label:this._trimLabel(U.label),description:U.description,symbolInfo:C.mixin({constructor:function(){}},U),symbol:U.symbol,layer:J,index1:P,index2:ca}},this)}}return R},_isUnclassedRenderer:function(J){return!!((J.hasVisualVariables("sizeInfo",!1)||J.hasVisualVariables("colorInfo",!1)||J.hasVisualVariables("opacityInfo",!1))&&J.addBreak&&J.infos&&1===J.infos.length)},
_createSimpleSymbol:function(J){switch(J.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var P=new q;break;case "esriGeometryPolyline":P=new u;break;case "esriGeometryPolygon":P=new l;break;default:J.hasXYFootprint&&J.hasXYFootprint()&&(P=new l)}return P},_getItemsFromItems:function(J){return e.map(J,function(P,R){P=C.mixin({index:R},P);P.label=this._trimLabel(P.label);return P},this)},_trimLabel:function(J){var P=this.maxLabelLength;P&&J&&J.length>P&&(J=J.substr(0,P)+"...");
return J||""},_cellGet:function(J,P,R){return R?this.grid.store.getValue(R,"cell"+J):""},_cellFormatter:function(J){if(J){var P=this._itemWidgets,R=this.grid.store,Y=R.getValue(J,"surfaceId"),Z=P[Y];Z||(Z=P[Y]=new D({id:Y,label:R.getValue(J,"label"),symbol:R.getValue(J,"symbol"),legendOverride:R.getValue(J,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:R.getValue(J,"template")}));return Z||""}return""},_cellGetGroup:function(J,P){if(!this._groupRowIndices)return"";
J=e.indexOf(this._groupRowIndices,J);return P&&-1!==J?(P=this.featureLayers[J])&&(this.groupLabelFunction?this.groupLabelFunction(P):P.name)||"":""},_cellGroupFormatter:function(J){return J?"\x3cdiv class\x3d'groupLabel'\x3e"+J+"\x3c/div\x3e":""}});d("extend-esri")&&C.setObject("dijit.editing.TemplatePicker",M,z);return M})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),
function(O,C,I,G,e,g,v,d,x){var t=g("dojox.grid.DataGrid",v,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},
destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new d(this)},get:function(h,f){if(f&&"_item"==this.field&&!this.fields)return f;if(f&&this.fields){var b=[],a=this.grid.store;C.forEach(this.fields,function(n){b=b.concat(a.getValues(f,n))});return b}return f||"string"!==typeof h?f?this.field?"_item"==this.field?f:this.grid.store.getValue(f,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<
this.updateDelay){var h=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,h=!0);this.updating||(this.beginUpdate(),h=!0);if(h){var f=this;this._endUpdateDelay=setTimeout(function(){delete f._endUpdateDelay;f.endUpdate()},this.updateDelay)}}},_onSet:function(h,f,b,a){this._checkUpdateStatus();h=this.getItemIndex(h);-1<h&&this.updateRow(h)},_createItem:function(h,f){f=this._hasIdentity?this.store.getIdentity(h):G.toJson(this.query)+":idx:"+f+":sort:"+G.toJson(this.getSortProps());
return this._by_idty[f]={idty:f,item:h}},_addItem:function(h,f,b){this._by_idx[f]=this._createItem(h,f);b||this.updateRow(f)},_onNew:function(h,f){this._checkUpdateStatus();f=this.get("rowCount");this._addingItem=!0;this.updateRowCount(f+1);this._addingItem=!1;this._addItem(h,f);this.showMessage()},_onDelete:function(h){this._checkUpdateStatus();h=this._getItemIndex(h,!0);if(0<=h){this._pages=[];this._eop=this._bop=-1;var f=this._by_idx[h];this._by_idx.splice(h,1);delete this._by_idty[f.idty];this.updateRowCount(this.get("rowCount")-
1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(h)&&(this.selection.deselect(h),this.selection.selected.splice(h,1))},_onRevert:function(){this._refresh()},setStore:function(h,f,b){this._requestsPending(0)||(this._setQuery(f,b),this._setStore(h),this._refresh(!0))},setQuery:function(h,f){this._requestsPending(0)||(this._setQuery(h,f),this._refresh(!0))},setItems:function(h){this.items=h;this._setStore(this.store);this._refresh(!0)},_setQuery:function(h,
f){this.query=h;this.queryOptions=f||this.queryOptions},_setStore:function(h){this.store&&this._store_connects&&C.forEach(this._store_connects,this.disconnect,this);if(this.store=h){h=this.store.getFeatures();var f=[];this._canEdit=!!h["dojo.data.api.Write"]&&!!h["dojo.data.api.Identity"];this._hasIdentity=!!h["dojo.data.api.Identity"];h["dojo.data.api.Notification"]&&!this.items&&(f.push(this.connect(this.store,"onSet","_onSet")),f.push(this.connect(this.store,"onNew","_onNew")),f.push(this.connect(this.store,
"onDelete","_onDelete")));this._canEdit&&f.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=f}},_onFetchBegin:function(h,f){this.scroller&&(this.rowCount!=h&&(f.isRender?(this.scroller.init(h,this.keepRows,this.rowsPerPage),this.rowCount=h,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(h)),h?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},
_onFetchComplete:function(h,f){this.scroller&&(h&&0<h.length&&(C.forEach(h,function(b,a){this._addItem(b,f.start+a,!0)},this),this.updateRows(f.start,h.length),f.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),e("ie")&&x.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[f.start]=!1)},_onFetchError:function(h,f){console.log(h);delete this._lastScrollTop;
this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[f.start]=!1;this.onFetchError(h,f)},onFetchError:function(h,f){},_fetch:function(h,f){h=h||0;if(this.store&&!this._pending_requests[h]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[h]=!0;try{if(this.items){var b=this.items,a=this.store;this.rowsPerPage=b.length;var n={start:h,count:this.rowsPerPage,isRender:f};this._onFetchBegin(b.length,
n);var p=0;C.forEach(b,function(k){a.isItemLoaded(k)||p++});if(0===p)this._onFetchComplete(b,n);else{var m=function(k){p--;0===p&&this._onFetchComplete(b,n)};C.forEach(b,function(k){a.isItemLoaded(k)||a.loadItem({item:k,onItem:m,scope:this})},this)}}else this.store.fetch({start:h,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:f,onBegin:I.hitch(this,"_onFetchBegin"),onComplete:I.hitch(this,"_onFetchComplete"),onError:I.hitch(this,"_onFetchError")})}catch(k){this._onFetchError(k,
{start:h,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(h){var f=this._by_idx[h];return!f||f&&!f.item?(this._preparePage(h),null):f.item},getItemIndex:function(h){return this._getItemIndex(h,!1)},_getItemIndex:function(h,f){if(!f&&!this.store.isItem(h))return-1;f=this._hasIdentity?this.store.getIdentity(h):null;for(var b=0,a=this._by_idx.length;b<a;b++){var n=
this._by_idx[b];if(n&&(f&&n.idty==f||n.item===h))return b}return-1},filter:function(h,f){this.query=h;f&&this._clearData();this._fetch()},_getItemAttr:function(h,f){return(h=this.getItem(h))?this.store.getValue(h,f):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(h){return this._pending_requests[h]},_rowToPage:function(h){return this.rowsPerPage?Math.floor(h/
this.rowsPerPage):h},_pageToRow:function(h){return this.rowsPerPage?this.rowsPerPage*h:h},_preparePage:function(h){(h<this._bop||h>=this._eop)&&!this._addingItem&&(h=this._rowToPage(h),this._needPage(h),this._bop=h*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(h){this._pages[h]||(this._pages[h]=!0,this._requestPage(h))},_requestPage:function(h){h=this._pageToRow(h);0<Math.min(this.rowsPerPage,this.get("rowCount")-h)&&(this._requests++,this._requestsPending(h)||
setTimeout(I.hitch(this,"_fetch",h,!1),1))},getCellName:function(h){return h.field},_refresh:function(h){this._clearData();this._fetch(0,h)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var h=this.getCell(this.getSortIndex());if(h){var f=h.sortDesc,b=!(0<this.sortInfo);return[{attribute:h.field,descending:"undefined"==typeof f?b:b?!f:f}]}return this.sortFields?this.sortFields:null},styleRowState:function(h){if(this.store&&
this.store.getState){for(var f=this.store.getState(h.index),b="",a=0,n=["inflight","error","inserting"],p;p=n[a];a++)if(f[p]){b=" dojoxGridRow-"+p;break}h.customClasses+=b}},onStyleRow:function(h){this.styleRowState(h);this.inherited(arguments)},canEdit:function(h,f){return this._canEdit},_copyAttr:function(h,f){h=this.getItem(h);return this.store.getValue(h,f)},doStartEdit:function(h,f){this._cache[f]||(this._cache[f]=this._copyAttr(f,h.field));this.onStartEdit(h,f)},doApplyCellEdit:function(h,f,
b){this.store.fetchItemByIdentity({identity:this._by_idx[f].idty,onItem:I.hitch(this,function(a){var n=this.store.getValue(a,b);"number"==typeof n?h=isNaN(h)?h:parseFloat(h):"boolean"==typeof n?h="true"==h?!0:"false"==h?!1:h:n instanceof Date&&(n=new Date(h),h=isNaN(n.getTime())?h:n);this.store.setValue(a,b,h);this.onApplyCellEdit(h,f,b)})})},doCancelEdit:function(h){this._cache[h]&&(this.updateRow(h),delete this._cache[h]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(h,f){this.onApplyEdit(h)},
removeSelectedRows:function(){if(this._canEdit){this.edit.apply();var h=I.hitch(this,function(f){f.length&&(C.forEach(f,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:h}):h(this.selection.getSelected())}}});t.cell_markupFactory=function(h,f,b){var a=I.trim(x.attr(f,"field")||"");a&&(b.field=a);b.field=b.field||b.name;if(a=I.trim(x.attr(f,"fields")||""))b.fields=a.split(",");h&&h(f,b)};t.markupFactory=
function(h,f,b,a){return v.markupFactory(h,f,b,I.partial(t.cell_markupFactory,a))};return t})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D){O.isCopyKey||(O.isCopyKey=O.dnd.getCopyKeyState);I=I("dojox.grid._Grid",[n,p,G],{templateString:k,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:g,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");l.initOnFontResize();this.connect(l,"onFontResize","textSizeChanged");a.funnelEvents(this.domNode,this,"doKeyEvent",a.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");u.addClass(this.domNode,this.classTag);this.isLeftToRight()||u.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&u.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var z=O.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=A.substitute(this.loadingMessage,z);this.errorMessage=A.substitute(this.errorMessage,z);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&u.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(w.forEach(this._placeholders,function(z){z.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(z,L){"string"==typeof z&&(z=z&&"false"!=z?"true"==z?!0:window.parseInt(z,10):!1);"number"==typeof z&&(isNaN(z)&&(z=!1),0>z?z=!0:0===z&&(z=!1));this.autoHeight=z;this._autoHeight="boolean"==typeof z?z:"number"==typeof z?z>=this.get("rowCount"):!1;this._started&&!L&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new x(this);this.focus=new t(this);this.edit=new h(this)},createSelection:function(){this.selection=new f(this)},createScroller:function(){this.scroller=new e;this.scroller.grid=this;this.scroller.renderRow=q.hitch(this,"renderRow");this.scroller.removeRow=
q.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(z){},createViews:function(){this.views=new d(this);this.views.createView=q.hitch(this,"createView")},createView:function(z,L){z=new (q.getObject(z))({grid:this,index:L});this.viewsNode.appendChild(z.domNode);this.viewsHeaderNode.appendChild(z.headerNode);this.views.addView(z);u.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return z},buildViews:function(){for(var z=0,L;L=this.layout.structure[z];z++)this.createView(L.type||C._scopeName+".grid._View",z).setStructure(L);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(z){z&&q.isString(z)&&(O.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),z=q.getObject(z));this.structure=z;if(!z)if(this.layout.structure)z=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;z!==this.layout.structure&&this.layout.setStructure(z);this._structureChanged()},setStructure:function(z){O.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(z)},getColumnTogglingItems:function(){var z=[];var L=w.map(this.layout.cells,function(F){F.menuItems||(F.menuItems=[]);var Q=this,T=new m({label:F.name,checked:!F.hidden,_gridCell:F,onChange:function(E){if(Q.layout.setColumnVisibility(this._gridCell.index,
E)){var M=this._gridCell.menuItems;1<M.length&&w.forEach(M,function(J){J!==this&&J.setAttribute("checked",E)},this);E=w.filter(Q.layout.cells,function(J){1<J.menuItems.length?w.forEach(J.menuItems,"item.set('disabled', false);"):J.menuItems[0].set("disabled",!1);return!J.hidden});1==E.length&&w.forEach(E[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var E=w.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(E,1);delete this._gridCell;m.prototype.destroy.apply(this,
arguments)}});F.menuItems.push(T);F.hidden||z.push(T);return T},this);1==z.length&&z[0].set("disabled",!0);return L},_setHeaderMenuAttr:function(z){this._placeholders&&this._placeholders.length&&(w.forEach(this._placeholders,function(L){L.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=z)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(z){O.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(z)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&w.forEach(this._placeholders,function(z){z._replaced&&z.unReplace(!0);z.replace(this.getColumnTogglingItems())},this)},_fetch:function(z){this.setScrollTop(0)},getItem:function(z){return null},showMessage:function(z){z?(this.messagesNode.innerHTML=z,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(z,L){this._pendingChangeSize=z;this._pendingResultSize=L;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||u._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var z=this.viewsHeaderNode.style,L="none"==z.display?
0:this.views.measureHeader();z.height=L+"px";this.views.normalizeHeaderNodeHeight();return L},_resize:function(z,L){z=z||this._pendingChangeSize;L=L||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var F=this.domNode.parentNode;if(F&&1==F.nodeType&&this.hasLayout()&&"hidden"!=F.style.visibility&&"none"!=F.style.display){var Q=this._getPadBorder(),T=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var E=
T=this._getHeaderHeight();E+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=E+"px"}else this.domNode.clientHeight<=Q.h&&(F==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");L&&(z=L);!this._autoHeight&&z?(u.marginBox(this.domNode,z),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(E=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
u._getContentBox(F).h,this.domNode.style.height=Math.max(0,E)+"px");z=w.some(this.views.views,function(M){return M.flexCells});this._autoHeight||0!==(E||u._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",z||void 0!==T||(T=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";z&&(T=void 0);this.adaptWidth();this.adaptHeight(T);this.postresize()}}},adaptWidth:function(){var z=!this.initialWidth&&this.autoWidth,L=z?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;L=this.views.arrange(1,L);this.views.onEach("adaptWidth");z&&(this.domNode.style.width=L+"px")},adaptHeight:function(z){z=void 0===z?this._getHeaderHeight():z;var L=this._autoHeight?-1:Math.max(this.domNode.clientHeight-z,0)||0;this.views.onEach("setSize",[0,L]);this.views.onEach("adaptHeight");if(!this._autoHeight){var F=0,Q=0,T=w.filter(this.views.views,function(E){(E=E.hasHScrollbar())?F++:Q++;return!E});0<F&&0<Q&&w.forEach(T,function(E){E.adaptHeight(!0)})}!0===this.autoHeight||
-1!=L||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=L:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-z,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();u.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var z=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=z}},renderRow:function(z,L){this.views.renderRow(z,
L,this._skipRowRenormalize)},rowRemoved:function(z){this.views.rowRemoved(z)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var z=this.invalidated,L;if(z.all)this.update();else if(void 0!=z.rowCount)this.updateRowCount(z.rowCount);else for(L in z)this.updateRow(Number(L));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(z){z=Number(z);this.updating?this.invalidated[z]=!0:(this.views.updateRow(z),this.scroller.rowHeightChanged(z))},updateRows:function(z,L){z=Number(z);L=Number(L);var F;if(this.updating)for(F=0;F<L;F++)this.invalidated[F+z]=!0;else{for(F=0;F<L;F++)this.views.updateRow(F+z,this._skipRowRenormalize);this.scroller.rowHeightChanged(z)}},updateRowCount:function(z){this.updating?
this.invalidated.rowCount=z:(this.rowCount=z,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(z),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(z){this.views.updateRowStyles(z)},getRowNode:function(z){if(!this.focus.focusView||this.focus.focusView instanceof b)for(var L=0,F;F=this.views.views[L];L++){if(!(F instanceof b))return F.rowNodes[z]}else return this.focus.focusView.rowNodes[z];return null},
rowHeightChanged:function(z){this.views.renormalizeRow(z);this.scroller.rowHeightChanged(z)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:B("ie")?100:50,scrollTo:function(z){if(this.fastScroll){var L=Math.abs(this.lastScrollTop-z);this.lastScrollTop=z;if(L>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=z;this.views.setScrollTop(z);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var F=this;this._pendingScroll=window.setTimeout(function(){delete F._pendingScroll;
F.finishScrollJob()},200)}else this.setScrollTop(z)}else this.setScrollTop(z)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(z){this.scroller.scroll(this.views.setScrollTop(z))},scrollToRow:function(z){this.setScrollTop(this.scroller.findScrollTop(z)+1)},styleRowNode:function(z,L){L&&this.rows.styleRowNode(z,L)},_mouseOut:function(z){this.rows.setOverRow(-2)},getCell:function(z){return this.layout.cells[z]},setCellWidth:function(z,L){this.getCell(z).unitWidth=
L},getCellName:function(z){return"Cell "+z.index},canSort:function(z){},sort:function(){},getSortAsc:function(z){z=void 0==z?this.sortInfo:z;return 0<z},getSortIndex:function(z){z=void 0==z?this.sortInfo:z;return Math.abs(z)-1},setSortIndex:function(z,L){var F=z+1;void 0!=L?F*=L?1:-1:this.getSortIndex()==z&&(F=-this.sortInfo);this.setSortInfo(F)},setSortInfo:function(z){this.canSort(z)&&(this.sortInfo=z,this.sort(),this.update())},doKeyEvent:function(z){z.dispatch="do"+z.type;this.onKeyEvent(z)},
_dispatch:function(z,L){return z in this?this[z](L):!1},dispatchKeyEvent:function(z){this._dispatch(z.dispatch,z)},dispatchContentEvent:function(z){this.edit.dispatchEvent(z)||z.sourceView.dispatchContentEvent(z)||this._dispatch(z.dispatch,z)},dispatchHeaderEvent:function(z){z.sourceView.dispatchHeaderEvent(z)||this._dispatch("doheader"+z.type,z)},dokeydown:function(z){this.onKeyDown(z)},doclick:function(z){if(z.cellNode)this.onCellClick(z);else this.onRowClick(z)},dodblclick:function(z){if(z.cellNode)this.onCellDblClick(z);
else this.onRowDblClick(z)},docontextmenu:function(z){if(z.cellNode)this.onCellContextMenu(z);else this.onRowContextMenu(z)},doheaderclick:function(z){if(z.cellNode)this.onHeaderCellClick(z);else this.onHeaderClick(z)},doheaderdblclick:function(z){if(z.cellNode)this.onHeaderCellDblClick(z);else this.onHeaderDblClick(z)},doheadercontextmenu:function(z){if(z.cellNode)this.onHeaderCellContextMenu(z);else this.onHeaderContextMenu(z)},doStartEdit:function(z,L){this.onStartEdit(z,L)},doApplyCellEdit:function(z,
L,F){this.onApplyCellEdit(z,L,F)},doCancelEdit:function(z){this.onCancelEdit(z)},doApplyEdit:function(z){this.onApplyEdit(z)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});I.markupFactory=function(z,L,F,Q){var T=function(E){E=u.attr(E,"width")||"auto";"auto"!=E&&"em"!=E.slice(-2)&&"%"!=E.slice(-1)&&
(E=parseInt(E,10)+"px");return E};z.structure||"table"!=L.nodeName.toLowerCase()||(z.structure=D("\x3e colgroup",L).map(function(E){var M=u.attr(E,"span");M={noscroll:"true"==u.attr(E,"noscroll")?!0:!1,__span:M?parseInt(M,10):1,cells:[]};u.hasAttr(E,"width")&&(M.width=T(E));return M}),z.structure.length||z.structure.push({__span:Infinity,cells:[]}),D("thead \x3e tr",L).forEach(function(E,M){var J=0,P=0,R,Y=null;D("\x3e th",E).map(function(Z){Y?J>=R+Y.__span&&(P++,R+=Y.__span,Y=z.structure[P]):(R=
0,Y=z.structure[0]);var da={name:q.trim(u.attr(Z,"name")||Z.innerHTML),colSpan:parseInt(u.attr(Z,"colspan")||1,10),type:q.trim(u.attr(Z,"cellType")||""),id:q.trim(u.attr(Z,"id")||"")};J+=da.colSpan;var N=u.attr(Z,"rowspan");N&&(da.rowSpan=N);u.hasAttr(Z,"width")&&(da.width=T(Z));u.hasAttr(Z,"relWidth")&&(da.relWidth=window.parseInt(u.attr(Z,"relWidth"),10));u.hasAttr(Z,"hidden")&&(da.hidden="true"==u.attr(Z,"hidden")||!0===u.attr(Z,"hidden"));Q&&Q(Z,da);da.type=da.type?q.getObject(da.type):C.grid.cells.Cell;
da.type&&da.type.markupFactory&&da.type.markupFactory(Z,da);Y.cells[M]||(Y.cells[M]=[]);Y.cells[M].push(da)})}));return new F(z,L)};return I})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(O,C,I,G,e){return I("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(g){this.dispatchKeyEvent(g)},onContentEvent:function(g){this.dispatchContentEvent(g)},onHeaderEvent:function(g){this.dispatchHeaderEvent(g)},
onStyleRow:function(g){g.customClasses+=(g.odd?" dojoxGridRowOdd":"")+(g.selected?" dojoxGridRowSelected":"")+(g.over?" dojoxGridRowOver":"");this.focus.styleRow(g);this.edit.styleRow(g)},onKeyDown:function(g){if(!g.altKey&&!g.metaKey)switch(g.keyCode){case O.ESCAPE:this.edit.cancel();break;case O.ENTER:if(!this.edit.isEditing()){var v=this.focus.getHeaderIndex();if(0<=v){this.setSortIndex(v);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(g),g.shiftKey);G.stop(g)}g.shiftKey||
(v=this.edit.isEditing(),this.edit.apply(),v||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(g),this.onRowClick(g),G.stop(g));break;case O.SPACE:this.edit.isEditing()||(v=this.focus.getHeaderIndex(),0<=v?this.setSortIndex(v):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(g),g.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),G.stop(g)));
break;case O.TAB:this.focus[g.shiftKey?"previousKey":"nextKey"](g);break;case O.LEFT_ARROW:case O.RIGHT_ARROW:if(!this.edit.isEditing()){var d=g.keyCode;G.stop(g);v=this.focus.getHeaderIndex();0<=v&&g.shiftKey&&g.ctrlKey?this.focus.colSizeAdjust(g,v,5*(d==O.LEFT_ARROW?-1:1)):(g=d==O.LEFT_ARROW?1:-1,this.isLeftToRight()&&(g*=-1),this.focus.move(0,g))}break;case O.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(G.stop(g),this.focus.move(-1,0));break;case O.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(G.stop(g),this.focus.move(1,0));break;case O.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(G.stop(g),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case O.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(G.stop(g),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(g){-1==g.rowIndex?this.onHeaderCellMouseOver(g):this.onCellMouseOver(g)},onMouseOut:function(g){-1==g.rowIndex?this.onHeaderCellMouseOut(g):this.onCellMouseOut(g)},onMouseDown:function(g){-1==
g.rowIndex?this.onHeaderCellMouseDown(g):this.onCellMouseDown(g)},onMouseOverRow:function(g){this.rows.isOver(g.rowIndex)||(this.rows.setOverRow(g.rowIndex),-1==g.rowIndex?this.onHeaderMouseOver(g):this.onRowMouseOver(g))},onMouseOutRow:function(g){if(this.rows.isOver(-1))this.onHeaderMouseOut(g);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(g))},onMouseDownRow:function(g){if(-1!=g.rowIndex)this.onRowMouseDown(g)},onCellMouseOver:function(g){g.cellNode&&C.add(g.cellNode,
this.cellOverClass)},onCellMouseOut:function(g){g.cellNode&&C.remove(g.cellNode,this.cellOverClass)},onCellMouseDown:function(g){},onCellClick:function(g){this._click[0]=this._click[1];this._click[1]=g;this.edit.isEditCell(g.rowIndex,g.cellIndex)||this.focus.setFocusCell(g.cell,g.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(g)},onCellDblClick:function(g){var v=1<this._click.length&&e("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:g;this.focus.setFocusCell(v.cell,v.rowIndex);this.edit.setEditCell(v.cell,v.rowIndex);this.onRowDblClick(g)},onCellContextMenu:function(g){this.onRowContextMenu(g)},onCellFocus:function(g,v){this.edit.cellFocus(g,v)},onRowClick:function(g){this.edit.rowClick(g);this.selection.clickSelectEvent(g)},onRowDblClick:function(g){},onRowMouseOver:function(g){},onRowMouseOut:function(g){},onRowMouseDown:function(g){},onRowContextMenu:function(g){G.stop(g)},onHeaderMouseOver:function(g){},onHeaderMouseOut:function(g){},
onHeaderCellMouseOver:function(g){g.cellNode&&C.add(g.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(g){g.cellNode&&C.remove(g.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(g){},onHeaderClick:function(g){},onHeaderCellClick:function(g){this.setSortIndex(g.cell.index);this.onHeaderClick(g)},onHeaderDblClick:function(g){},onHeaderCellDblClick:function(g){this.onHeaderDblClick(g)},onHeaderCellContextMenu:function(g){this.onHeaderContextMenu(g)},onHeaderContextMenu:function(g){this.headerMenu||
G.stop(g)},onStartEdit:function(g,v){},onApplyCellEdit:function(g,v,d){},onCancelEdit:function(g){},onApplyEdit:function(g){},onCanSelect:function(g){return!0},onCanDeselect:function(g){return!0},onSelected:function(g){this.updateRowStyles(g)},onDeselected:function(g){this.updateRowStyles(g)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(O,C,I,G,e){var g=function(d){d&&dojo.forEach(O.toArray(),
function(x){x.domNode&&e.isDescendant(x.domNode,d,!0)&&x.destroy()})},v=function(d,x){for(var t=[],h=0,f;f=d.childNodes[h];){h++;var b=e.byId(f);(b&&b.tagName?b.tagName.toLowerCase():"")==x&&t.push(f)}return t};return C("dojox.grid._Scroller",null,{constructor:function(d){this.setContentNodes(d);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(d,x,t){switch(arguments.length){case 3:this.rowsPerPage=t;case 2:this.keepRows=x;case 1:this.rowCount=d}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=I.hitch(this,
"onscroll"))},_getPageCount:function(d,x){return d?Math.ceil(d/x)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(d){this.keepPages=(this.keepRows=d)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(d){this.colCount=(this.contentNodes=d)?this.contentNodes.length:0;this.pageNodes=[];for(d=0;d<this.colCount;d++)this.pageNodes[d]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(d){this.invalidateNodes();this.rowCount=d;d=this.pageCount;0===d&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<d)for(--d;d>=this.pageCount;d--)this.height-=this.getPageHeight(d),delete this.pageHeights[d];
else this.pageCount>d&&(this.height+=this.defaultPageHeight*(this.pageCount-d-1)+this.calcLastPageHeight());this.resize()},pageExists:function(d){return!!this.getDefaultPageNode(d)},measurePage:function(d){return this.grid.rowHeight?((d+1)*this.rowsPerPage>this.rowCount?this.rowCount-d*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(d=this.getDefaultPageNode(d))&&d.innerHTML?d.offsetHeight:void 0},positionPage:function(d,x){for(var t=0;t<this.colCount;t++)this.pageNodes[t][d].style.top=x+
"px"},repositionPages:function(d){for(var x=this.getDefaultNodes(),t=0,h=0;h<this.stack.length;h++)t=Math.max(this.stack[h],t);var f=(h=x[d])?this.getPageNodePosition(h)+this.getPageHeight(d):0;for(d+=1;d<=t;d++){if(h=x[d]){if(this.getPageNodePosition(h)==f)break;this.positionPage(d,f)}f+=this.getPageHeight(d)}},installPage:function(d){for(var x=0;x<this.colCount;x++)this.contentNodes[x].appendChild(this.pageNodes[x][d])},preparePage:function(d,x){x=x?this.popPage():null;for(var t=0;t<this.colCount;t++){var h=
this.pageNodes[t],f=null===x?this.createPageNode():this.invalidatePageNode(x,h);f.pageIndex=d;h[d]=f}},renderPage:function(d){var x=[],t;for(t=0;t<this.colCount;t++)x[t]=this.pageNodes[t][d];t=0;for(d*=this.rowsPerPage;t<this.rowsPerPage&&d<this.rowCount;t++,d++)this.renderRow(d,x)},removePage:function(d){var x=0;for(d*=this.rowsPerPage;x<this.rowsPerPage;x++,d++)this.removeRow(d)},destroyPage:function(d){for(var x=0;x<this.colCount;x++){var t=this.invalidatePageNode(d,this.pageNodes[x]);t&&e.destroy(t)}},
pacify:function(d){},pacifying:!1,pacifyTicks:200,setPacifying:function(d){this.pacifying!=d&&(this.pacifying=d,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var d=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return d},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var d=0;d<this.colCount;d++)G.setStyleHeightPx(this.contentNodes[d],
Math.max(1,this.height));d=!this._invalidating;if(!d){var x=this.grid.get("autoHeight");"number"==typeof x&&x<=Math.min(this.rowsPerPage,this.rowCount)&&(d=!0)}d&&this.needPage(this.page,this.pageTop);d=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;x=this.getPageHeight(this.page);this.averageRowHeight=0<x&&0<d?x/d:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var d=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=d},updateContentHeight:function(d){this.height+=d;this.resize()},updatePageHeight:function(d,x,t){if(this.pageExists(d)){var h=this.getPageHeight(d),f=this.measurePage(d);void 0===f&&(f=h);this.pageHeights[d]=f;if(h!=f){this.updateContentHeight(f-h);var b=this.grid.get("autoHeight");"number"==typeof b&&b>this.rowCount||!0===b&&!x?t?(x=this.grid.viewsNode.style,x.height=parseInt(x.height)+f-h+"px",this.repositionPages(d)):this.grid.sizeChange():this.repositionPages(d)}return f}return 0},
rowHeightChanged:function(d,x){this.updatePageHeight(Math.floor(d/this.rowsPerPage),!1,x)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var d=document.createElement("div");e.attr(d,"role","presentation");d.style.position="absolute";d.style[this.grid.isLeftToRight()?"left":"right"]="0";return d},getPageHeight:function(d){d=this.pageHeights[d];return void 0!==d?d:this.defaultPageHeight},pushPage:function(d){return this.stack.push(d)},
popPage:function(){return this.stack.shift()},findPage:function(d){for(var x=0,t=0,h=0;x<this.pageCount&&!(h=this.getPageHeight(x),t+h>=d);x++,t+=h);this.page=x;this.pageTop=t},buildPage:function(d,x,t){this.preparePage(d,x);this.positionPage(d,t);this.installPage(d);this.renderPage(d);this.pushPage(d)},needPage:function(d,x){var t=this.getPageHeight(d);this.pageExists(d)?this.positionPage(d,x):(this.buildPage(d,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,x),t=this.updatePageHeight(d,
!0));return t},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(d){this.grid.scrollTop=d;if(this.colCount){this.startPacify();this.findPage(d);for(var x=this.height,t=this.getScrollBottom(d),h=this.page,f=this.pageTop;h<this.pageCount&&(0>t||f<t);h++)f+=this.needPage(h,f);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,d);this.lastVisibleRow=this.getLastVisibleRow(h-1,f,t);x!=this.height&&this.repositionPages(h-1);this.endPacify()}},getScrollBottom:function(d){return 0<=
this.windowHeight?d+this.windowHeight:-1},processNodeEvent:function(d,x){for(var t=d.target;t&&t!=x&&t.parentNode&&t.parentNode.parentNode!=x;)t=t.parentNode;if(!t||!t.parentNode||t.parentNode.parentNode!=x)return!1;d.topRowIndex=t.parentNode.pageIndex*this.rowsPerPage;x=d.topRowIndex;a:{var h=0;for(var f,b=t.parentNode;f=b.childNodes[h++];)if(f==t){--h;break a}h=-1}d.rowIndex=x+h;d.rowTarget=t;return!0},processEvent:function(d){return this.processNodeEvent(d,this.contentNode)},renderRow:function(d,
x){},removeRow:function(d){},getDefaultPageNode:function(d){return this.getDefaultNodes()[d]},positionPageNode:function(d,x){},getPageNodePosition:function(d){return d.offsetTop},invalidatePageNode:function(d,x){var t=x[d];t&&(delete x[d],this.removePage(d,t),g(t),t.innerHTML="");return t},getPageRow:function(d){return d*this.rowsPerPage},getLastPageRow:function(d){return Math.min(this.rowCount,this.getPageRow(d+1))-1},getFirstVisibleRow:function(d,x,t){if(!this.pageExists(d))return 0;var h=this.getPageRow(d),
f=this.getDefaultNodes();d=v(f[d],"div");f=0;for(var b=d.length;f<b&&x<t;f++,h++)x+=d[f].offsetHeight;return h?h-1:h},getLastVisibleRow:function(d,x,t){if(!this.pageExists(d))return 0;var h=this.getDefaultNodes(),f=this.getLastPageRow(d);d=v(h[d],"div");for(h=d.length-1;0<=h&&x>t;h--,f--)x-=d[h].offsetHeight;return f+1},findTopRow:function(d){var x=this.getDefaultNodes();x=v(x[this.page],"div");for(var t=0,h=x.length,f=this.pageTop,b;t<h;t++)if(b=x[t].offsetHeight,f+=b,f>=d)return this.offset=b-(f-
d),t+this.page*this.rowsPerPage;return-1},findScrollTop:function(d){var x=Math.floor(d/this.rowsPerPage),t=0,h;for(h=0;h<x;h++)t+=this.getPageHeight(h);this.pageTop=t;this.page=x;this.needPage(x,this.pageTop);h=this.getDefaultNodes();var f=v(h[x],"div");x=d-this.rowsPerPage*x;h=0;for(d=f.length;h<d&&h<x;h++)t+=f[h].offsetHeight;return t},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(O,C,I,G){var e=C.getObject("grid.util",!0,O);
e.na="...";e.rowIndexTag="gridRowIndex";e.gridViewTag="gridView";e.fire=function(g,v,d){function x(n,p){if(null==n)return null;var m=p?"Width":"Height";return n["scroll"+m]>n["client"+m]?n:x(n.parentNode,p)}var t;if(G("webkit")&&"focus"==v){var h=g.domNode?g.domNode:g;if(t=x(h,!1))var f=t.scrollTop;if(h=x(h,!0))var b=h.scrollLeft}var a=g&&v&&g[v];g=a&&(d?a.apply(g,d):g[v]());G("webkit")&&"focus"==v&&(t&&(t.scrollTop=f),h&&(h.scrollLeft=b));return g};e.setStyleHeightPx=function(g,v){if(0<=v){var d=
g.style;v+="px";g&&d.height!=v&&(d.height=v)}};e.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");e.keyEvents=["keyup","keydown","keypress"];e.funnelEvents=function(g,v,d,x){x=x?x:e.mouseEvents.concat(e.keyEvents);for(var t=0,h=x.length;t<h;t++)v.connect(g,"on"+x[t],d)};e.removeNode=function(g){(g=I.byId(g))&&g.parentNode&&g.parentNode.removeChild(g);return g};e.arrayCompare=function(g,v){for(var d=0,x=g.length;d<x;d++)if(g[d]!=v[d])return!1;return g.length==
v.length};e.arrayInsert=function(g,v,d){g.length<=v?g[v]=d:g.splice(v,0,d)};e.arrayRemove=function(g,v){g.splice(v,1)};e.arraySwap=function(g,v,d){var x=g[v];g[v]=g[d];g[d]=x};return e})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(O,C,I,G,e,g){return I("dojox.grid._Layout",null,{constructor:function(v){this.grid=v},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(v,
d,x,t,h){var f=this.structure[v].cells[0],b=this.structure[d].cells[0],a=null,n=a=0;v=0;for(var p;p=f[v];v++)if(p.index==x){a=v;break}a=f.splice(a,1)[0];a.view=this.grid.views.views[d];v=0;for(p=null;p=b[v];v++)if(p.index==t){n=v;break}h||(n+=1);b.splice(n,0,a);if(x=this.grid.getCell(this.grid.getSortIndex()))x._currentlySorted=this.grid.getSortAsc();this.cells=[];for(v=x=0;d=this.structure[v];v++)for(t=0;h=d.cells[t];t++)for(f=0;p=h[f];f++)p.index=x,this.cells.push(p),"_currentlySorted"in p&&(b=
x+1,b*=p._currentlySorted?1:-1,this.grid.sortInfo=b,delete p._currentlySorted),x++;G.forEach(this.cells,function(m){var k=m.markup[2].split(" ");parseInt(k[1].substring(5))!=m.index&&(k[1]='idx\x3d"'+m.index+'"',m.markup[2]=k.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(v,d){v=this.cells[v];if(v.hidden==d){v.hidden=!d;d=v.view;var x=d.viewWidth;x&&"auto"!=x&&(d._togglingColumn=g.getMarginBox(v.getHeaderNode()).w||0);d.update();return!0}return!1},addCellDef:function(v,d,x){var t=
this,h=function(f){var b=0;1<f.colSpan?b=0:(b=f.width||t._defaultCellProps.width||t.defaultWidth,isNaN(b)||(b+="em"));return b};v={grid:this.grid,subrow:v,layoutIndex:d,index:this.cells.length};if(x&&x instanceof C.grid.cells._Base)return d=e.clone(x),v.unitWidth=h(d._props),d=e.mixin(d,this._defaultCellProps,x._props,v);d=x.type||x.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||C.grid.cells.Cell;e.isString(d)&&(d=e.getObject(d));v.unitWidth=h(x);return new d(e.mixin({},this._defaultCellProps,
x,v))},addRowDef:function(v,d){for(var x=[],t=0,h=0,f=!0,b=0,a;a=d[b];b++)a=this.addCellDef(v,b,a),x.push(a),this.cells.push(a),f&&a.relWidth?t+=a.relWidth:a.width&&(a=a.width,"string"==typeof a&&"%"==a.slice(-1)?h+=window.parseInt(a,10):"auto"==a&&(f=!1));t&&f&&G.forEach(x,function(n){n.relWidth&&(n.width=n.unitWidth=n.relWidth/t*(100-h)+"%")});return x},addRowsDef:function(v){var d=[];if(e.isArray(v))if(e.isArrayLike(v[0]))for(var x=0,t;v&&(t=v[x]);x++)d.push(this.addRowDef(x,t));else d.push(this.addRowDef(0,
v));return d},addViewDef:function(v){this._defaultCellProps=v.defaultCell||{};v.width&&"auto"==v.width&&delete v.width;return e.mixin({},v,{cells:this.addRowsDef(v.rows||v.cells)})},setStructure:function(v){this.fieldIndex=0;this.cells=[];var d=this.structure=[];if(this.grid.rowSelector){var x={type:C._scopeName+".grid._RowSelector"};if(e.isString(this.grid.rowSelector)){var t=this.grid.rowSelector;"false"==t?x=null:"true"!=t&&(x.width=t)}else this.grid.rowSelector||(x=null);x&&d.push(this.addViewDef(x))}var h=
function(n){return"name"in n||"field"in n||"get"in n};x=function(n){return e.isArray(n)&&(e.isArray(n[0])||h(n[0]))?!0:!1};t=function(n){return null!==n&&e.isObject(n)&&("cells"in n||"rows"in n||"type"in n&&!h(n))};if(e.isArrayLike(v)){for(var f=!1,b=0,a;a=v[b];b++)if(t(a)){f=!0;break}if(f)for(b=0;a=v[b];b++)x(a)?d.push(this.addViewDef({cells:a})):t(a)&&d.push(this.addViewDef(a));else d.push(this.addViewDef({cells:v}))}else t(v)&&d.push(this.addViewDef(v));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(O){return O.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f){var b=C("dojox.grid._DeferredTextWidget",h,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(I.hitch(this,
function(k){this.domNode&&(this.domNode.innerHTML=k)}))}}),a=function(){setTimeout(I.hitch.apply(O,arguments),0)},n=C("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(k){this._props=k||{};I.mixin(this,k);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(k,A){var w=this.grid.formatterScope||this,q=this.formatter;
q&&w&&"string"==typeof q&&(q=this.formatter=w[q]);k=k!=this.defaultValue&&q?q.apply(w,A):k;if("undefined"==typeof k)return this.defaultValue;k&&k.addBoth&&(k=new b({deferred:k},t.create("span",{innerHTML:this.defaultValue})));return k&&k.declaredClass&&k.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+k.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":k},format:function(k,A){var w=this.grid.edit.info;(A=this.get?this.get(k,A):this.value||this.defaultValue)&&A.replace&&
this.grid.escapeHTMLInData&&(A=A.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||w.rowIndex==k&&w.cell==this)?this.formatEditing(w.value?w.value:A,k):this._defaultFormat(A,[A,k,this])},formatEditing:function(k,A){},getNode:function(k){return this.view.getCellNode(k,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(k){return(this.getNode(k)||0).firstChild||0},canResize:function(){var k=
this.unitWidth;return k&&"auto"!==k},isFlex:function(){var k=this.unitWidth;return k&&I.isString(k)&&("auto"==k||"%"==k.slice(-1))},applyEdit:function(k,A){this.getNode(A)&&this.grid.edit.applyCellEdit(k,this,A)},cancelEdit:function(k){this.grid.doCancelEdit(k)},_onEditBlur:function(k){this.grid.edit.isEditCell(k,this.index)&&this.grid.edit.apply()},registerOnBlur:function(k,A){this.commitOnBlur&&e.connect(k,"onblur",function(w){setTimeout(I.hitch(this,"_onEditBlur",A),250)})},needFormatNode:function(k,
A){this._formatPending=!0;a(this,"_formatNode",k,A)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(k,A){this._formatPending&&(this._formatPending=!1,v("ie")||d.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(A),k,A))},formatNode:function(k,A,w){v("ie")?a(this,"focus",w,k):this.focus(w,k)},dispatchEvent:function(k,A){if(k in this)return this[k](A)},getValue:function(k){return this.getEditNode(k)[this._valueProp]},setValue:function(k,A){(k=this.getEditNode(k))&&
(k[this._valueProp]=A)},focus:function(k,A){k=A||this.getEditNode(k);try{f.fire(k,"focus"),f.fire(k,"select")}catch(w){}},save:function(k){this.value=this.value||this.getValue(k)},restore:function(k){this.setValue(k,this.value)},_finish:function(k){d.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(k){this.applyEdit(this.getValue(k),k);this._finish(k)},cancel:function(k){this.cancelEdit(k);this._finish(k)}});n.markupFactory=function(k,A){var w=I.trim(x.get(k,"formatter")||
"");w&&(A.formatter=I.getObject(w)||w);if(w=I.trim(x.get(k,"get")||""))A.get=I.getObject(w);w=function(q,B,l){var u=I.trim(x.get(k,q)||"");u&&(B[l||q]="false"!=u.toLowerCase())};w("sortDesc",A);w("editable",A);w("alwaysEditing",A);w("noresize",A);w("draggable",A);if(w=I.trim(x.get(k,"loadingText")||x.get(k,"defaultValue")||""))A.defaultValue=w;w=function(q,B,l){var u=I.trim(x.get(k,q)||"")||void 0;u&&(B[l||q]=u)};w("styles",A);w("headerStyles",A);w("cellStyles",A);w("classes",A);w("headerClasses",
A);w("cellClasses",A)};var p=n.Cell=C("dojox.grid.cells.Cell",n,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(k,A){this.needFormatNode(k,A);k&&k.replace&&(k=k.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+k+'"\x3e'},formatNode:function(k,A,w){this.inherited(arguments);this.registerOnBlur(k,w)},doKey:function(k){this.keyFilter&&-1==String.fromCharCode(k.charCode).search(this.keyFilter)&&G.stop(k)},_finish:function(k){this.inherited(arguments);
var A=this.getEditNode(k);try{f.fire(A,"blur")}catch(w){}}});p.markupFactory=function(k,A){n.markupFactory(k,A);if(k=I.trim(x.get(k,"keyFilter")||""))A.keyFilter=new RegExp(k)};(n.RowIndex=C("dojox.grid.cells.RowIndex",p,{name:"Row",postscript:function(){this.editable=!1},get:function(k){return k+1}})).markupFactory=function(k,A){p.markupFactory(k,A)};(n.Select=C("dojox.grid.cells.Select",p,{options:null,values:null,returnIndex:-1,constructor:function(k){this.values=this.values||this.options},formatEditing:function(k,
A){this.needFormatNode(k,A);A=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var w=0,q,B;void 0!==(q=this.options[w])&&void 0!==(B=this.values[w]);w++)B=B.replace?B.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):B,q=q.replace?q.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):q,A.push("\x3coption",k==B?" selected":"",' value\x3d"'+B+'"',"\x3e",q,"\x3c/option\x3e");A.push("\x3c/select\x3e");return A.join("")},_defaultFormat:function(k,A){var w=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var q=g.indexOf(this.values,w);0<=q&&(w=this.options[q])}return w},getValue:function(k){var A=this.getEditNode(k);if(A)return k=A.selectedIndex,A=A.options[k],-1<this.returnIndex?k:A.value||A.innerHTML}})).markupFactory=function(k,A){p.markupFactory(k,A);var w=I.trim(x.get(k,"options")||"");if(w){var q=w.split(",");q[0]!=w&&(A.options=q)}if(k=I.trim(x.get(k,"values")||""))w=k.split(","),w[0]!=k&&(A.values=w)};var m=n.AlwaysEdit=C("dojox.grid.cells.AlwaysEdit",p,{alwaysEditing:!0,_formatNode:function(k,
A){this.formatNode(this.getEditNode(A),k,A)},applyStaticValue:function(k){var A=this.grid.edit;A.applyCellEdit(this.getValue(k),this,k);A.start(this,k,!0)}});m.markupFactory=function(k,A){p.markupFactory(k,A)};(n.Bool=C("dojox.grid.cells.Bool",m,{_valueProp:"checked",formatEditing:function(k,A){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(k?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(k){"INPUT"==k.target.tagName&&this.applyStaticValue(k.rowIndex)}})).markupFactory=
function(k,A){m.markupFactory(k,A)};return n})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(O,C){return O("dojox.grid._RowSelector",C,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(I,G){G.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(I,G){var e=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(I)&&e.push("dojoxGridRowbarOver");this.grid.selection.isSelected(I)&&e.push("dojoxGridRowbarSelected");G.className=e.join(" ")},domouseover:function(I){this.grid.onMouseOverRow(I)},domouseout:function(I){if(!this.isIntraRowEvent(I))this.grid.onMouseOutRow(I)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w){h=G("dojox.grid._View",[b,a],{defaultWidth:"18em",viewWidth:"",templateString:h,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:k._HeaderBuilder,_contentBuilderClass:k._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");p.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
p.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){m.destroy(this.headerNode);delete this.headerNode;for(var l in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[l]),m.destroy(this.rowNodes[l]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){d("ie")||d("webkit")||d("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(l){l=this.structure=l;l.width&&!isNaN(l.width)?this.viewWidth=l.width+"em":this.viewWidth=l.width||(l.noscroll?"auto":this.viewWidth);this._onBeforeRow=l.onBeforeRow||function(){};this._onAfterRow=l.onAfterRow||function(){};if(this.noscroll=l.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==l.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(l){l&&e.forEach(x("[widgetId]",l).map(C.byNode),function(u){u._destroyOnRemove?(u.destroy(),delete u):u.domNode&&u.domNode.parentNode&&u.domNode.parentNode.removeChild(u.domNode)})},onBeforeRow:function(l,u){this._onBeforeRow(l,u);0<=l&&this._cleanupRowWidgets(this.getRowNode(l))},onAfterRow:function(l,u,D){this._onAfterRow(l,u,D);var z=this.grid;e.forEach(x(".dojoxGridStubNode",D),function(L){if(L&&L.parentNode){var F=L.getAttribute("linkWidget"),
Q=window.parseInt(m.attr(L,"cellIdx"),10);z.getCell(Q);(F=C.byId(F))?(L.parentNode.replaceChild(F.domNode,L),F._started||F.startup(),O.destroy(L)):L.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var l=0,u;u=this.structure.cells[l];l++)for(var D=0,z;z=u[D];D++)z.view=this,this.flexCells=this.flexCells||z.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var l=this.hasVScrollbar(),u=m.style(this.scrollboxNode,
"overflow");this.noscroll||!u||"hidden"==u?l=!1:"scroll"==u&&(l=!0);return l?n.getScrollbar().w:0},getColumnsWidth:function(){var l=this.headerContentNode;return l&&l.firstChild?l.firstChild.offsetWidth||m.style(l.firstChild,"width"):0},setColumnsWidth:function(l){this.headerContentNode.firstChild.style.width=l+"px";this.viewWidth&&(this.viewWidth=l+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
m._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var l=this.grid.layout.cells,u=g.hitch(this,function(z,L){!this.grid.isLeftToRight()&&(L=!L);L=L?-1:1;z=this.header.getCellNodeIndex(z)+L;for(var F=l[z];F&&F.getHeaderNode()&&"none"==F.getHeaderNode().style.display;)z+=L,F=l[z];return F?F.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&m.destroy(this.bottomMarker);this.bottomMarker=m.byId("dojoxGrid_bottomMarker");this.topMarker&&m.destroy(this.topMarker);this.topMarker=m.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=m.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},t.body()),this._hide(this.bottomMarker),this.topMarker=m.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
t.body()),this._hide(this.topMarker));this.arrowDim=m.contentBox(this.bottomMarker);var D=m.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new f(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:g.hitch(this,function(z){this.header.decorateEvent(z);if((this.header.overRightResizeArea(z)||this.header.overLeftResizeArea(z))&&this.header.canResize(z)&&!this.header.moveable)this.header.beginColumnResize(z);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);z.button===(9>d("ie")?1:0)&&f.prototype.onMouseDown.call(this.source,z)}}),onMouseOver:g.hitch(this,function(z){var L=this.source;L._getChildByEvent(z)&&f.prototype.onMouseOver.apply(L,arguments)}),_markTargetAnchor:g.hitch(this,function(z){var L=this.source;if(L.current!=L.targetAnchor||L.before!=z){L.targetAnchor&&u(L.targetAnchor,L.before)&&L._removeItemClass(u(L.targetAnchor,L.before),L.before?"After":"Before");f.prototype._markTargetAnchor.call(L,
z);var F=z?L.targetAnchor:u(L.targetAnchor,L.before);z=0;F||(F=L.targetAnchor,z=m.contentBox(F).w+this.arrowDim.w/2+2);F=m.position(F,!0);z=Math.floor(F.x-this.arrowDim.w/2+z);m.style(this.bottomMarker,"visibility","visible");m.style(this.topMarker,"visibility","visible");m.style(this.bottomMarker,{left:z+"px",top:D+F.y+"px"});m.style(this.topMarker,{left:z+"px",top:F.y-this.arrowDim.h+"px"});L.targetAnchor&&u(L.targetAnchor,L.before)&&L._addItemClass(u(L.targetAnchor,L.before),L.before?"After":"Before")}}),
_unmarkTargetAnchor:g.hitch(this,function(){var z=this.source;z.targetAnchor&&(z.targetAnchor&&u(z.targetAnchor,z.before)&&z._removeItemClass(u(z.targetAnchor,z.before),z.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),f.prototype._unmarkTargetAnchor.call(z))}),destroy:g.hitch(this,function(){v.disconnect(this._source_conn);v.unsubscribe(this._source_sub);f.prototype.destroy.call(this.source);this.bottomMarker&&(m.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(m.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:g.hitch(this,function(){f.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=v.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=v.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(l){m.style(l,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(l,u,D){w.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,u=this.grid.views.views,l=u[l.viewIndex],u=u[this.index],u!=l&&(l.convertColPctToFixed(),u.convertColPctToFixed()))},_onDndDrop:function(l,u,D){if(w.manager().target!==this.source)w.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);D=m.marginBox(u[0]).w;if(l.viewIndex!==this.index){var z=this.grid.views.views,L=z[l.viewIndex];z=z[this.index];
L.viewWidth&&"auto"!=L.viewWidth&&L.setColumnsWidth(L.getColumnsWidth()-D);z.viewWidth&&"auto"!=z.viewWidth&&z.setColumnsWidth(z.getColumnsWidth())}D=this.source._targetNode;L=this.source._beforeTarget;!this.grid.isLeftToRight()&&(L=!L);z=this.grid.layout;var F=this.index;delete this.source._targetNode;delete this.source._beforeTarget;var Q=z.moveColumn;l=l.viewIndex;u=(u=u[0])?m.attr(u,"idx"):null;Q.call(z,l,F,u,D?m.attr(D,"idx"):null,L)}},renderHeader:function(){this.headerContentNode.innerHTML=
this.header.generateHtml(this._getHeaderContent);this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);p.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(l){var u=l.name||l.grid.getCellName(l);/^\s+$/.test(u)&&(u="\x26nbsp;");var D=['\x3cdiv class\x3d"dojoxGridSortNode'];l.index!=l.grid.getSortIndex()?D.push('"\x3e'):D=D.concat([" ",0<l.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",
'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',0<l.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);D=D.concat([u,"\x3c/div\x3e\x3c/div\x3e"]);return D.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(l){var u=this._hasHScroll||!1;if(void 0==this._hasHScroll||l)this.noscroll?this._hasHScroll=!1:(l=m.style(this.scrollboxNode,
"overflow"),this._hasHScroll="hidden"==l?!1:"scroll"==l?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);u!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(l){var u=this._hasVScroll||!1;if(void 0==this._hasVScroll||l)this.noscroll?this._hasVScroll=!1:(l=m.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==l?!1:"scroll"==l?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);u!==this._hasVScroll&&
this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var l=!1;this.grid.initialWidth="";var u=x("th",this.headerContentNode),D=e.map(u,function(z,L){var F=z.style.width;m.attr(z,"vIdx",L);if(F&&"%"==F.slice(-1))l=!0;else if(F&&"px"==F.slice(-2))return window.parseInt(F,10);return m.contentBox(z).w});return l?(e.forEach(this.grid.layout.cells,function(z,L){if(z.view==this&&(z=z.view.getHeaderCellNode(z.index))&&m.hasAttr(z,"vIdx")){var F=window.parseInt(m.attr(z,"vIdx"));this.setColWidth(L,
D[F]);m.removeAttr(z,"vIdx")}},this),!0):!1},adaptHeight:function(l){if(!this.grid._autoHeight){var u=this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!l&&(l=this.noscroll))a:{for(var D=0;D<this.grid.views.views.length;++D)if(l=this.grid.views.views[D],l!==this&&l.hasHScrollbar()){l=!0;break a}l=!1}l&&(u-=n.getScrollbar().h);p.setStyleHeightPx(this.scrollboxNode,u)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=
this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var l=this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(l=Math.min(l,this.getColumnsWidth())+"px",this._removingColumn=!1):l=Math.max(l,this.getColumnsWidth())+"px";this.contentNode.style.width=l;this.hasHScrollbar(!0)},setSize:function(l,u){var D=this.domNode.style,z=this.headerNode.style;l&&(D.width=l,z.width=l);D.height=0<=u?u+"px":""},renderRow:function(l){var u=this.createRowNode(l);
this.buildRow(l,u);return u},createRowNode:function(l){var u=document.createElement("div");u.className=this.classTag+"Row";this instanceof I.grid._RowSelector?m.attr(u,"role","presentation"):(m.attr(u,"role","row"),"none"!=this.grid.selectionMode&&u.setAttribute("aria-selected","false"));u[p.gridViewTag]=this.id;u[p.rowIndexTag]=l;return this.rowNodes[l]=u},buildRow:function(l,u){this.buildRowContent(l,u);this.styleRow(l,u)},buildRowContent:function(l,u){u.innerHTML=this.content.generateHtml(l,l);
this.flexCells&&this.contentWidth&&(u.firstChild.style.width=this.contentWidth);p.fire(this,"onAfterRow",[l,this.structure.cells,u])},rowRemoved:function(l){0<=l&&this._cleanupRowWidgets(this.getRowNode(l));this.grid.edit.save(this,l);delete this.rowNodes[l]},getRowNode:function(l){return this.rowNodes[l]},getCellNode:function(l,u){if(l=this.getRowNode(l))return this.content.getCellNode(l,u)},getHeaderCellNode:function(l){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,
l)},styleRow:function(l,u){var D=void 0==u.style.cssText?u.getAttribute("style"):u.style.cssText;u._style=D;this.styleRowNode(l,u)},styleRowNode:function(l,u){u&&this.doStyleRowNode(l,u)},doStyleRowNode:function(l,u){this.grid.styleRowNode(l,u)},updateRow:function(l){var u=this.getRowNode(l);u&&(u.style.height="",this.buildRow(l,u));return u},updateRowStyles:function(l){this.styleRowNode(l,this.getRowNode(l))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(l){if(13<=d("ff")||d("chrome"))this._nativeScroll=
!0;l=this.grid.isLeftToRight();if(2>this.firstScroll){if(!l&&1==this.firstScroll||l&&0===this.firstScroll){var u=m.marginBox(this.headerNodeContainer);d("ie")?this.headerNodeContainer.style.width=u.w+this.getScrollbarWidth()+"px":d("mozilla")&&(this.headerNodeContainer.style.width=u.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=l?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=
this.scrollboxNode.scrollLeft;l=this.scrollboxNode.scrollTop;l!==this.lastTop&&this.grid.scrollTo(l);this._nativeScroll=!1},setScrollTop:function(l){this.lastTop=l;this._nativeScroll||(this.scrollboxNode.scrollTop=l);return this.scrollboxNode.scrollTop},doContentEvent:function(l){if(this.content.decorateEvent(l))this.grid.onContentEvent(l)},doHeaderEvent:function(l){if(this.header.decorateEvent(l))this.grid.onHeaderEvent(l)},dispatchContentEvent:function(l){return this.content.dispatchEvent(l)},dispatchHeaderEvent:function(l){return this.header.dispatchEvent(l)},
setColWidth:function(l,u){this.grid.setCellWidth(l,u+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var l=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=l;this.headerNode.scrollLeft=l}}});var q=G("dojox.grid._GridAvatar",A,{construct:function(){var l=t.doc,u=l.createElement("table");u.cellPadding=u.cellSpacing="0";u.className="dojoxGridDndAvatar";u.style.position="absolute";u.style.zIndex=1999;u.style.margin="0px";var D=l.createElement("tbody"),z=l.createElement("tr"),
L=l.createElement("td"),F=l.createElement("td");z.className="dojoxGridDndAvatarItem";F.className="dojoxGridDndAvatarItemImage";F.style.width="16px";var Q=this.manager.source;if(Q.creator)Q=Q._normalizedCreator(Q.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(Q=this.manager.nodes[0].cloneNode(!0),"tr"==Q.tagName.toLowerCase()){var T=l.createElement("table");var E=l.createElement("tbody");E.appendChild(Q);T.appendChild(E);Q=T}else"th"==Q.tagName.toLowerCase()&&(T=l.createElement("table"),
E=l.createElement("tbody"),l=l.createElement("tr"),T.cellPadding=T.cellSpacing="0",l.appendChild(Q),E.appendChild(l),T.appendChild(E),Q=T);Q.id="";L.appendChild(Q);z.appendChild(F);z.appendChild(L);m.style(z,"opacity",.9);D.appendChild(z);u.appendChild(D);this.node=u;u=w.manager();this.oldOffsetY=u.OFFSET_Y;u.OFFSET_Y=1},destroy:function(){w.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),B=w.manager().makeAvatar;w.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
m.hasClass(t.body(),"dijit_a11y")?B.call(w.manager()):new q(this)};return h})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(O,C,I,G,e,g,v){var d=C.getObject("dojox.html.metrics",!0),x=C.getObject("dojox");d.getFontMeasurements=function(){var n={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(I("ie")){var p=
g.doc.documentElement.style.fontSize||"";p||(g.doc.documentElement.style.fontSize="100%")}var m=g.doc.createElement("div"),k=m.style;k.position="absolute";k.left="-100px";k.top="0";k.width="30px";k.height="1000em";k.borderWidth="0";k.margin="0";k.padding="0";k.outline="0";k.lineHeight="1";k.overflow="hidden";g.body().appendChild(m);for(var A in n)k.fontSize=A,n[A]=16*Math.round(12*m.offsetHeight/16)/12/1E3;I("ie")&&(g.doc.documentElement.style.fontSize=p);g.body().removeChild(m);m=null;return n};
var t=null;d.getCachedFontMeasurements=function(n){if(n||!t)t=d.getFontMeasurements();return t};var h=null,f={};d.getTextBox=function(n,p,m){if(h)var k=h;else{k=h=g.doc.createElement("div");k.style.whiteSpace="nowrap";var A=g.doc.createElement("div");A.appendChild(k);var w=A.style;w.overflow="scroll";w.position="absolute";w.left="0px";w.top="-10000px";w.width="1px";w.height="1px";w.visibility="hidden";w.borderWidth="0";w.margin="0";w.padding="0";w.outline="0";g.body().appendChild(A)}k.className="";
w=k.style;w.borderWidth="0";w.margin="0";w.padding="0";w.outline="0";if(1<arguments.length&&p)for(var q in p)q in f||(w[q]=p[q]);2<arguments.length&&m&&(k.className=m);k.innerHTML=n;w=v.position(k);w.w=k.parentNode.scrollWidth;return w};var b=16,a=16;d.getScrollbar=function(){return{w:b,h:a}};d._fontResizeNode=null;d.initOnFontResize=function(n){var p=d._fontResizeNode=g.doc.createElement("iframe");n=p.style;n.position="absolute";n.width="5em";n.height="10em";n.top="-10000px";n.display="none";I("ie")?
p.onreadystatechange=function(){"complete"==p.contentWindow.document.readyState&&(p.onresize=p.contentWindow.parent[x._scopeName].html.metrics._fontresize)}:p.onload=function(){p.contentWindow.onresize=p.contentWindow.parent[x._scopeName].html.metrics._fontresize};p.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");g.body().appendChild(p);d.initOnFontResize=
function(){}};d.onFontResize=function(){};d._fontresize=function(){d.onFontResize()};e.addOnUnload(function(){var n=d._fontResizeNode;n&&(I("ie")&&n.onresize?n.onresize=null:n.contentWindow&&n.contentWindow.onresize&&(n.contentWindow.onresize=null),d._fontResizeNode=null)});G(function(){try{var n=g.doc.createElement("div");n.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";g.body().appendChild(n);b=n.offsetWidth-n.clientWidth;a=n.offsetHeight-
n.clientHeight;g.body().removeChild(n);delete n}catch(p){}"fontSizeWatch"in O.config&&O.config.fontSizeWatch&&d.initOnFontResize()});return d})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f){var b=O.grid,a=function(q,B){return q&&((q.rows||0)[B]||q.childNodes[B])},n=function(q){for(;q&&
"TABLE"!=q.tagName;q=q.parentNode);return q},p=function(q){var B=q.toUpperCase();return function(l){return l.tagName!=B}},m=t.rowIndexTag,k=t.gridViewTag,A=b._Builder=I.extend(function(q){q&&(this.view=q,this.grid=q.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var q=[this._table];this.view.viewWidth&&q.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));q.push("\x3e");
return q},generateCellMarkup:function(q,B,l,u){var D=[];if(u){var z=q.index!=q.grid.getSortIndex()?"":0<q.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';q.id||(q.id=this.grid.id+"Hdr"+q.index);z=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',z,' id\x3d"',q.id,'"']}else z=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&!q.editable?'aria-readonly\x3d"true"':""];q.colSpan&&z.push(' colspan\x3d"',q.colSpan,'"');q.rowSpan&&z.push(' rowspan\x3d"',
q.rowSpan,'"');z.push(' class\x3d"dojoxGridCell ');q.classes&&z.push(q.classes," ");l&&z.push(l," ");D.push(z.join(""));D.push("");z=['" idx\x3d"',q.index,'" style\x3d"'];B&&";"!=B[B.length-1]&&(B+=";");z.push(q.styles,B||"",q.hidden?"display:none;":"");q.unitWidth&&z.push("width:",q.unitWidth,";");D.push(z.join(""));D.push("");z=['"'];q.attrs&&z.push(" ",q.attrs);z.push("\x3e");D.push(z.join(""));D.push("");D.push(u?"\x3c/th\x3e":"\x3c/td\x3e");return D},isCellNode:function(q){return!(!q||q==G.doc||
!h.attr(q,"idx"))},getCellNodeIndex:function(q){return q?Number(h.attr(q,"idx")):-1},getCellNode:function(q,B){for(var l=0,u;(u=a(q.firstChild,l))&&u.cells;l++)for(var D=0,z;z=u.cells[D];D++)if(this.getCellNodeIndex(z)==B)return z;return null},findCellTarget:function(q,B){for(;q&&(!this.isCellNode(q)||q.offsetParent&&k in q.offsetParent.parentNode&&q.offsetParent.parentNode[k]!=this.view.id)&&q!=B;)q=q.parentNode;return q!=B?q:null},baseDecorateEvent:function(q){q.dispatch="do"+q.type;q.grid=this.grid;
q.sourceView=this.view;q.cellNode=this.findCellTarget(q.target,q.rowNode);q.cellIndex=this.getCellNodeIndex(q.cellNode);q.cell=0<=q.cellIndex?this.grid.getCell(q.cellIndex):null},findTarget:function(q,B){for(;q&&q!=this.domNode&&(!(B in q)||k in q&&q[k]!=this.view.id);)q=q.parentNode;return q!=this.domNode?q:null},findRowTarget:function(q){return this.findTarget(q,m)},isIntraNodeEvent:function(q){try{return q.cellNode&&q.relatedTarget&&h.isDescendant(q.relatedTarget,q.cellNode)}catch(B){return!1}},
isIntraRowEvent:function(q){try{var B=q.relatedTarget&&this.findRowTarget(q.relatedTarget);return!B&&-1==q.rowIndex||B&&q.rowIndex==B.gridRowIndex}catch(l){return!1}},dispatchEvent:function(q){return q.dispatch in this?this[q.dispatch](q):!1},domouseover:function(q){q.cellNode&&q.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=q.cellNode,this.grid.onMouseOver(q));this.grid.onMouseOverRow(q)},domouseout:function(q){if(q.cellNode&&q.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(q,
this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(q),!this.isIntraRowEvent(q)))this.grid.onMouseOutRow(q)},domousedown:function(q){if(q.cellNode)this.grid.onMouseDown(q);this.grid.onMouseDownRow(q)},_getTextDirStyle:function(q,B,l){return""}});O=b._ContentBuilder=I.extend(function(q){A.call(this,q)},A.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var q=this.grid.get,B=this.view.structure.cells,l=0,u;u=B[l];l++)for(var D=0,z;z=u[D];D++)z.get=z.get||
void 0==z.value&&q,z.markup=this.generateCellMarkup(z,z.cellStyles,z.cellClasses,!1),!this.grid.editable&&z.editable&&(this.grid.editable=!0)},generateHtml:function(q,B){q=this.getTableArray();var l=this.view.structure.cells,u=this.grid.getItem(B);t.fire(this.view,"onBeforeRow",[B,l]);for(var D=0,z;z=l[D];D++)if(!z.hidden&&!z.header){q.push(z.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var L=0,F,Q,T;F=z[L];L++){Q=F.markup;var E=F.customClasses=[];T=F.customStyles=[];Q[5]=
F.format(B,u);Q[1]=E.join(" ");Q[3]=T.join(";");(E=F.textDir||this.grid.textDir)&&(Q[3]+=this._getTextDirStyle(E,F,B));q.push.apply(q,Q)}q.push("\x3c/tr\x3e")}q.push("\x3c/table\x3e");return q.join("")},decorateEvent:function(q){q.rowNode=this.findRowTarget(q.target);if(!q.rowNode)return!1;q.rowIndex=q.rowNode[m];this.baseDecorateEvent(q);q.cell=this.grid.getCell(q.cellIndex);return!0}});var w=b._HeaderBuilder=I.extend(function(q){this.moveable=null;A.call(this,q)},A.prototype,{_skipBogusClicks:!1,
overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new b._TableMap(this.view.structure.cells)},generateHtml:function(q,B){var l,u=this.getTableArray(),D=this.view.structure.cells;t.fire(this.view,"onBeforeRow",[-1,D]);for(var z=0,L;L=D[z];z++)if(!L.hidden){u.push(L.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var F=0,Q,T;Q=L[F];F++)Q.customClasses=[],Q.customStyles=[],this.view.simpleStructure&&(Q.draggable&&
(Q.headerClasses?-1==Q.headerClasses.indexOf("dojoDndItem")&&(Q.headerClasses+=" dojoDndItem"):Q.headerClasses="dojoDndItem"),Q.attrs?-1==Q.attrs.indexOf("dndType\x3d'gridColumn_")&&(Q.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):Q.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),T=this.generateCellMarkup(Q,Q.headerStyles,Q.headerClasses,!0),T[5]=void 0!=B?B:q(Q),T[3]=Q.customStyles.join(";"),(l=Q.textDir||this.grid.textDir)&&(T[3]+=this._getTextDirStyle(l,Q,B)),T[1]=Q.customClasses.join(" "),
u.push(T.join(""));u.push("\x3c/tr\x3e")}u.push("\x3c/table\x3e");return u.join("")},getCellX:function(q){var B=p("th");for(var l=q.target;l&&B(l);l=l.parentNode);(B=l)?(B=f.position(B),q=q.clientX-B.x):q=q.layerX;return q},decorateEvent:function(q){this.baseDecorateEvent(q);q.rowIndex=-1;q.cellX=this.getCellX(q);return!0},prepareResize:function(q,B){do{var l=q.cellIndex;q.cellNode=l?q.cellNode.parentNode.cells[l+B]:null;q.cellIndex=q.cellNode?this.getCellNodeIndex(q.cellNode):-1}while(q.cellNode&&
"none"==q.cellNode.style.display);return!!q.cellNode},canResize:function(q){if(!q.cellNode||1<q.cellNode.colSpan)return!1;q=this.grid.getCell(q.cellIndex);return!q.noresize&&q.canResize()},overLeftResizeArea:function(q){if(h.hasClass(G.body(),"dojoDndMove"))return!1;if(g("ie")){var B=q.target;if(h.hasClass(B,"dojoxGridArrowButtonNode")||h.hasClass(B,"dojoxGridArrowButtonChar")||h.hasClass(B,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?0<q.cellIndex&&0<q.cellX&&q.cellX<this.overResizeWidth&&
this.prepareResize(q,-1):q.cellNode&&0<q.cellX&&q.cellX<this.overResizeWidth},overRightResizeArea:function(q){if(h.hasClass(G.body(),"dojoDndMove"))return!1;if(g("ie")){var B=q.target;if(h.hasClass(B,"dojoxGridArrowButtonNode")||h.hasClass(B,"dojoxGridArrowButtonChar")||h.hasClass(B,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?q.cellNode&&q.cellX>=q.cellNode.offsetWidth-this.overResizeWidth:0<q.cellIndex&&q.cellX>=q.cellNode.offsetWidth-this.overResizeWidth&&this.prepareResize(q,
-1)},domousemove:function(q){if(!this.moveable){var B=this.overRightResizeArea(q)?"dojoxGridColResize":this.overLeftResizeArea(q)?"dojoxGridColResize":"";B&&!this.canResize(q)&&(B="dojoxGridColNoResize");h.toggleClass(q.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==B);h.toggleClass(q.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==B);B&&e.stop(q)}},domousedown:function(q){this.moveable||((this.overRightResizeArea(q)||this.overLeftResizeArea(q))&&this.canResize(q)?
this.beginColumnResize(q):(this.grid.onMouseDown(q),this.grid.onMouseOverRow(q)))},doclick:function(q){return this._skipBogusClicks?(e.stop(q),!0):!1},colResizeSetup:function(q,B){var l=h.contentBox(q.sourceView.headerNode);if(B){this.lineDiv=document.createElement("div");B=h.position(q.sourceView.headerNode,!0);var u=h.contentBox(q.sourceView.domNode),D=q.pageX;!this.grid.isLeftToRight()&&8>g("ie")&&(D-=x.getScrollbar().w);h.style(this.lineDiv,{top:B.y+"px",left:D+"px",height:u.h+l.h+"px"});h.addClass(this.lineDiv,
"dojoxGridResizeColLine");this.lineDiv._origLeft=D;G.body().appendChild(this.lineDiv)}B=[];u=this.tableMap.findOverlappingNodes(q.cellNode);D=0;for(var z;z=u[D];D++)B.push({node:z,index:this.getCellNodeIndex(z),width:z.offsetWidth});u=q.sourceView;z=this.grid.isLeftToRight()?1:-1;var L=q.grid.views.views;D=[];for(var F=u.idx+z,Q;Q=L[F];F+=z)D.push({node:Q.headerNode,left:window.parseInt(Q.headerNode.style.left)});z=u.headerContentNode.firstChild;return{scrollLeft:q.sourceView.headerNode.scrollLeft,
view:u,node:q.cellNode,index:q.cellIndex,w:h.contentBox(q.cellNode).w,vw:l.w,table:z,tw:h.contentBox(z).w,spanners:B,followers:D}},beginColumnResize:function(q){this.moverDiv=document.createElement("div");h.style(this.moverDiv,{position:"absolute",left:0});G.body().appendChild(this.moverDiv);h.addClass(this.grid.domNode,"dojoxGridColumnResizing");var B=this.moveable=new d(this.moverDiv),l=this.colResizeSetup(q,!0);B.onMove=I.hitch(this,"doResizeColumn",l);v.connect(B,"onMoveStop",I.hitch(this,function(){this.endResizeColumn(l);
l.node.releaseCapture&&l.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;h.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));q.cellNode.setCapture&&q.cellNode.setCapture();B.onMouseDown(q)},doResizeColumn:function(q,B,l){var u=l.l;u={deltaX:u,w:q.w+(this.grid.isLeftToRight()?u:-u),vw:q.vw+u,tw:q.tw+u};this.dragRecord={inDrag:q,mover:B,leftTop:l};u.w>=this.minColWidth&&(B?h.style(this.lineDiv,"left",this.lineDiv._origLeft+u.deltaX+"px"):this.doResizeNow(q,
u))},endResizeColumn:function(q){if(this.dragRecord){var B=this.dragRecord.leftTop;B=this.grid.isLeftToRight()?B.l:-B.l;B+=Math.max(q.w+B,this.minColWidth)-(q.w+B);g("webkit")&&q.spanners.length&&(B+=h._getPadBorderExtents(q.spanners[0].node).w);this.doResizeNow(q,{deltaX:B,w:q.w+B,vw:q.vw+B,tw:q.tw+B});delete this.dragRecord}h.destroy(this.lineDiv);h.destroy(this.moverDiv);h.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=!0;q.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(q.index)},
doResizeNow:function(q,B){q.view.convertColPctToFixed();if(q.view.flexCells&&!q.view.testFlexCells()){var l=n(q.node);l&&(l.style.width="")}var u;for(l=0;u=q.spanners[l];l++){var D=u.width+B.deltaX;0<D&&(u.node.style.width=D+"px",q.view.setColWidth(u.index,D))}if(this.grid.isLeftToRight()||!g("ie"))for(l=0;u=q.followers[l];l++)D=u.left+B.deltaX,u.node.style.left=D+"px";q.node.style.width=B.w+"px";q.view.setColWidth(q.index,B.w);q.view.headerNode.style.width=B.vw+"px";q.view.setColumnsWidth(B.tw);
this.grid.isLeftToRight()||(q.view.headerNode.scrollLeft=q.scrollLeft+B.deltaX)}});b._TableMap=I.extend(function(q){this.mapRows(q)},{map:null,mapRows:function(q){if(q.length){this.map=[];for(var B,l=0;B=q[l];l++)this.map[l]=[];for(l=0;B=q[l];l++)for(var u=0,D=0,z,L;z=B[u];u++){for(;this.map[l][D];)D++;this.map[l][D]={c:u,r:l};L=z.rowSpan||1;z=z.colSpan||1;for(var F=0;F<L;F++)for(var Q=0;Q<z;Q++)this.map[l+F][D+Q]=this.map[l][D];D+=z}}},dumpMap:function(){for(var q=0,B;B=this.map[q];q++)for(var l=
0;B[l];l++);},getMapCoords:function(q,B){for(var l=0,u;u=this.map[l];l++)for(var D=0,z;z=u[D];D++)if(z.c==B&&z.r==q)return{j:l,i:D};return{j:-1,i:-1}},getNode:function(q,B,l){return(q=q&&q.rows[B])&&q.cells[l]},_findOverlappingNodes:function(q,B,l){var u=[];B=this.getMapCoords(B,l);l=0;for(var D;D=this.map[l];l++)l!=B.j&&(D=(D=D[B.i])?this.getNode(q,D.r,D.c):null)&&u.push(D);return u},findOverlappingNodes:function(q){var B=this._findOverlappingNodes,l=n(q);var u=q.parentNode;u=0<=u.rowIndex?u.rowIndex:
C.indexOf(u.parentNode.childNodes,u);return B.call(this,l,u,0<=q.cellIndex?q.cellIndex:C.indexOf(q.parentNode.cells,q))}});return{_Builder:A,_HeaderBuilder:w,_ContentBuilder:O}})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(O,C,I){return O("dojox.grid._ViewManager",null,{constructor:function(G){this.grid=G},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(G){G.idx=
this.views.length;this.views.push(G)},destroyViews:function(){for(var G=0,e;e=this.views[G];G++)e.destroy();this.views=[]},getContentNodes:function(){for(var G=[],e=0,g;g=this.views[e];e++)G.push(g.contentNode);return G},forEach:function(G){for(var e=0,g;g=this.views[e];e++)G(g,e)},onEach:function(G,e){e=e||[];for(var g=0,v;v=this.views[g];g++)G in v&&v[G].apply(v,e)},normalizeHeaderNodeHeight:function(){for(var G=[],e=0,g;g=this.views[e];e++)g.headerContentNode.firstChild&&G.push(g.headerContentNode);
this.normalizeRowNodeHeights(G)},normalizeRowNodeHeights:function(G){var e=0,g=[];if(this.grid.rowHeight)e=this.grid.rowHeight;else{if(1>=G.length)return;for(var v=0,d;d=G[v];v++)I.contains(d,"dojoxGridNonNormalizedCell")||(g[v]=d.firstChild.offsetHeight,e=Math.max(e,g[v]));e=0<=e?e:0;(C("mozilla")||8<C("ie"))&&e&&e++}for(v=0;d=G[v];v++)g[v]!=e&&(d.firstChild.style.height=e+"px")},resetHeaderNodeHeight:function(){for(var G=0,e;e=this.views[G];G++)if(e=e.headerContentNode.firstChild)e.style.height=
""},renormalizeRow:function(G){for(var e=[],g=0,v,d;(v=this.views[g])&&(d=v.getRowNode(G));g++)d.firstChild.style.height="",e.push(d);this.normalizeRowNodeHeights(e)},getViewWidth:function(G){return this.views[G].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();this.forEach(function(e){e.headerContentNode.style.height=""});var G=0;this.forEach(function(e){G=Math.max(e.headerNode.offsetHeight,G)});return G},measureContent:function(){var G=0;this.forEach(function(e){G=
Math.max(e.domNode.offsetHeight,G)});return G},findClient:function(G){G=this.grid.elasticView||-1;if(0>G)for(var e=1,g;g=this.views[e];e++)if(g.viewWidth){for(e=1;g=this.views[e];e++)if(!g.viewWidth){G=e;break}break}0>G&&(G=Math.floor(this.views.length/2));return G},arrange:function(G,e){var g,v,d=this.views.length,x=this,t=0>=e?d:this.findClient(),h=function(a,n){var p=a.domNode.style,m=a.headerNode.style;x.grid.isLeftToRight()?(p.left=n+"px",m.left=n+"px"):(p.right=n+"px",4>C("ff")?m.right=n+a.getScrollbarWidth()+
"px":m.right=n+"px",C("webkit")||"auto"==m.width||(m.width=parseInt(m.width,10)-a.getScrollbarWidth()+"px"));p.top="0px";m.top=0};for(g=0;(v=this.views[g])&&g<t;g++){var f=this.getViewWidth(g);v.setSize(f,0);h(v,G);f=v.headerContentNode&&v.headerContentNode.firstChild?v.getColumnsWidth()+v.getScrollbarWidth():v.domNode.offsetWidth;G+=f}g++;for(var b=d-1;(v=this.views[b])&&g<=b;b--)f=this.getViewWidth(b),v.setSize(f,0),f=v.domNode.offsetWidth,e-=f,h(v,e);t<d&&(v=this.views[t],f=Math.max(1,e-G),v.setSize(f+
"px",0),h(v,G));return G},renderRow:function(G,e,g){for(var v=[],d=0,x,t;(x=this.views[d])&&(t=e[d]);d++)x=x.renderRow(G),t.appendChild(x),v.push(x);g||this.normalizeRowNodeHeights(v)},rowRemoved:function(G){this.onEach("rowRemoved",[G])},updateRow:function(G,e){for(var g=0,v;v=this.views[g];g++)v.updateRow(G);e||this.renormalizeRow(G)},updateRowStyles:function(G){this.onEach("updateRowStyles",[G])},setScrollTop:function(G){for(var e=G,g=0,v;v=this.views[g];g++)e=v.setScrollTop(G),C("ie")&&v.headerNode&&
v.scrollboxNode&&(v.headerNode.scrollLeft=v.scrollboxNode.scrollLeft);return e},getFirstScrollingView:function(){for(var G=0,e;e=this.views[G];G++)if(e.hasHScrollbar()||e.hasVScrollbar())return e;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(O,C,I){return O("dojox.grid._RowManager",null,{constructor:function(G){this.grid=G},linesToEms:2,overRow:-2,prepareStylingRow:function(G,e){return{index:G,node:e,odd:!!(G&1),selected:!!this.grid.selection.isSelected(G),
over:this.isOver(G),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(G,e){G=this.prepareStylingRow(G,e);this.grid.onStyleRow(G);this.applyStyles(G)},applyStyles:function(G){G.node.className=G.customClasses;var e=G.node.style.height,g=G.node,v=G.customStyles+";"+(G.node._style||"");void 0==g.style.cssText?g.setAttribute("style",v):g.style.cssText=v;G.node.style.height=e},updateStyles:function(G){this.grid.updateRowStyles(G)},setOverRow:function(G){var e=this.overRow;this.overRow=
G;e!=this.overRow&&(C.isString(e)||0<=e)&&this.updateStyles(e);this.updateStyles(this.overRow)},isOver:function(G){return this.overRow==G&&!I.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),function(O,C,I,G,e,g,v,d,x){return I("dojox.grid._FocusManager",null,{constructor:function(t){this.grid=
t;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(G.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(G.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(G.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(G.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));this._connects.push(G.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(G.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(G.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(G.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(G.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){O.forEach(this._connects,G.disconnect);O.forEach(this._headerConnects,G.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,
_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(t,h){return this.cell==t&&this.rowIndex==h},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===
this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?O.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(t){var h=this.cell&&this.cell.getNode(this.rowIndex);if(h&&(x.toggleClass(h,this.focusClass,t),t)){t=this.scrollIntoView();try{if(g("webkit")||!this.grid.edit.isEditing())d.fire(h,"focus"),t&&(this.cell.view.scrollboxNode.scrollLeft=
t)}catch(f){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var t=this.cell&&this.cell.getNode(this.rowIndex);if(t)try{this.grid.edit.isEditing()||(x.toggleClass(t,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),d.fire(t,"focus"))}catch(h){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){O.forEach(this._headerConnects,G.disconnect);this._headerConnects=[];for(var t=this._findHeaderCells(),h=0;h<t.length;h++)this._headerConnects.push(G.connect(t[h],
"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(G.connect(t[h],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var t=v("th",this.grid.viewsHeaderNode),h=[],f=0;f<t.length;f++){var b=t[f],a=x.hasAttr(b,"tabIndex"),n=x.attr(b,"tabIndex");a&&0>n&&h.push(b)}return h},_setActiveColHeader:function(t,h,f){this.grid.domNode.setAttribute("aria-activedescendant",t.id);null!=f&&0<=f&&f!=h&&x.toggleClass(this._findHeaderCells()[f],this.focusClass,!1);x.toggleClass(t,this.focusClass,
!0);this._colHeadNode=t;this._colHeadFocusIdx=h;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var t=this.cell?this._scrollInfo(this.cell):null;if(!t||!t.s)return null;var h=this.grid.scroller.findScrollTop(this.rowIndex);t.n&&t.sr&&(t.n.offsetLeft+t.n.offsetWidth>t.sr.l+t.sr.w?t.s.scrollLeft=t.n.offsetLeft+t.n.offsetWidth-t.sr.w:t.n.offsetLeft<t.sr.l&&(t.s.scrollLeft=t.n.offsetLeft));t.r&&t.sr&&(h+t.r.offsetHeight>t.sr.t+t.sr.h?this.grid.setScrollTop(h+t.r.offsetHeight-t.sr.h):
h<t.sr.t&&this.grid.setScrollTop(h));return t.s.scrollLeft},_scrollInfo:function(t,h){if(t){var f=t.view.scrollboxNode,b={w:f.clientWidth,l:f.scrollLeft,t:f.scrollTop,h:f.clientHeight},a=t.view.getRowNode(this.rowIndex);return{c:t,s:f,sr:b,n:h?h:t.getNode(this.rowIndex),r:a}}return null},_scrollHeader:function(t){var h=null;if(this._colHeadNode){var f=this.grid.getCell(t);if(!f)return;h=this._scrollInfo(f,f.getNode(0))}h&&h.s&&h.sr&&h.n&&(h.n.offsetLeft+h.n.offsetWidth>h.sr.l+h.sr.w?h.s.scrollLeft=
h.n.offsetLeft+h.n.offsetWidth-h.sr.w:h.n.offsetLeft<h.sr.l?h.s.scrollLeft=h.n.offsetLeft:7>=g("ie")&&f&&f.view.headerNode&&(f.view.headerNode.scrollLeft=h.s.scrollLeft))},_isHeaderHidden:function(){var t=this.focusView;if(!t)for(var h=0,f;f=this.grid.views.views[h];h++)if(f.headerNode){t=f;break}return t&&"none"==x.getComputedStyle(t.headerNode).display},colSizeAdjust:function(t,h,f){var b=this._findHeaderCells(),a=this.focusView;if(!a||!a.header.tableMap.map)for(var n=0,p;p=this.grid.views.views[n];n++)if(p.header.tableMap.map){a=
p;break}n=b[h];!a||h==b.length-1&&0===h||(a.content.baseDecorateEvent(t),t.cellNode=n,t.cellIndex=a.content.getCellNodeIndex(t.cellNode),t.cell=0<=t.cellIndex?this.grid.getCell(t.cellIndex):null,a.header.canResize(t)&&(h={l:f},t=a.header.colResizeSetup(t,!1),a.header.doResizeColumn(t,null,h),a.update()))},styleRow:function(t){},setFocusIndex:function(t,h){this.setFocusCell(this.grid.getCell(h),t)},setFocusCell:function(t,h){t&&!this.isFocusCell(t,h)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),
this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=t,this.rowIndex=h,this._focusifyCellNode(!0));if(g("opera"))setTimeout(C.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var t=this.rowIndex,h=this.cell.index+1,f=this.grid.layout.cellCount-1,b=this.grid.rowCount-1;h>f&&(h=0,t++);t>b&&(h=f,t=b);if(this.grid.edit.isEditing()&&(f=this.grid.getCell(h),!this.isLastFocusCell()&&
(!f.editable||this.grid.canEdit&&!this.grid.canEdit(f,t)))){this.cell=f;this.rowIndex=t;this.next();return}this.setFocusIndex(t,h)}},previous:function(){if(this.cell){var t=this.rowIndex||0,h=(this.cell.index||0)-1;0>h&&(h=this.grid.layout.cellCount-1,t--);0>t&&(h=t=0);if(this.grid.edit.isEditing()){var f=this.grid.getCell(h);if(!this.isFirstFocusCell()&&!f.editable){this.cell=f;this.rowIndex=t;this.previous();return}}this.setFocusIndex(t,h)}},move:function(t,h){var f=0>h?-1:1;if(this.isNavHeader()){t=
this._findHeaderCells();var b=currentIdx=O.indexOf(t,this._colHeadNode);for(currentIdx+=h;0<=currentIdx&&currentIdx<t.length&&"none"==t[currentIdx].style.display;)currentIdx+=f;0<=currentIdx&&currentIdx<t.length&&this._setActiveColHeader(t[currentIdx],currentIdx,b)}else if(this.cell){var a=this.grid.scroller;b=this.rowIndex;var n=this.grid.rowCount-1,p=Math.min(n,Math.max(0,b+t));t&&(0<t?p>a.getLastPageRow(a.page)&&this.grid.setScrollTop(this.grid.scrollTop+a.findScrollTop(p)-a.findScrollTop(b)):
0>t&&p<=a.getPageRow(a.page)&&this.grid.setScrollTop(this.grid.scrollTop-a.findScrollTop(b)-a.findScrollTop(p)));a=this.grid.layout.cellCount-1;for(var m=this.cell.index,k=Math.min(a,Math.max(0,m+h)),A=this.grid.getCell(k);0<=k&&k<a&&A&&!0===A.hidden;)k+=f,A=this.grid.getCell(k);A&&!0!==A.hidden||(k=m);f=A.getNode(p);!f&&t?0<=p+t&&p+t<=n&&this.move(0<t?++t:--t,h):f&&"none"!==x.style(f,"display")||!h?(this.setFocusIndex(p,k),t&&this.grid.updateRow(b)):0<=k+h&&k+h<=a&&this.move(t,0<h?++h:--h)}},previousKey:function(t){this.grid.edit.isEditing()?
(e.stop(t),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(x.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),e.stop(t))},nextKey:function(t){t.target===this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),e.stop(t)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),
this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(e.stop(t),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(t){this.tabbingOut=!0;t.focus()},focusGridView:function(){d.fire(this.focusView,"focus")},focusGrid:function(t){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var t=!0,h=0===this.grid.rowCount;this.isNoFocusCell()&&!h?(h=0,this.grid.getCell(h).hidden&&(h=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,
h)):this.cell&&!h?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):t=!1;this._colHeadNode=this._colHeadFocusIdx=null;return t},focusHeader:function(){var t=this._findHeaderCells(),h=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=t[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&
this._colHeadFocusIdx<t.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=t[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,h),this._scrollHeader(this._colHeadFocusIdx),
this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){x.removeClass(this._colHeadNode,this.focusClass);x.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var t=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(t);this._contextMenuBindNode=t}},doFocus:function(t){t&&t.target!=t.currentTarget?e.stop(t):this._clickFocus||(this.tabbingOut||this.focusHeader(),
this.tabbingOut=!1,e.stop(t))},doBlur:function(t){e.stop(t)},doContextMenu:function(t){this.headerMenu||e.stop(t)},doLastNodeFocus:function(t){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;e.stop(t)},doLastNodeBlur:function(t){e.stop(t)},doColHeaderFocus:function(t){this._setActiveColHeader(t.target,x.attr(t.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());
e.stop(t)},doColHeaderBlur:function(t){x.toggleClass(t.target,this.focusClass,!1)},_mouseDown:function(t){this._clickFocus=dojo.some(this.grid.views.views,function(h){return h.scrollboxNode===t.target})},_mouseUp:function(t){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),function(O,C,I,G,e,g){return I("dojox.grid._EditManager",null,{constructor:function(v){this.grid=v;
this.connections=e("ie")?[G.connect(document.body,"onfocus",O.hitch(this,"_boomerangFocus"))]:[];this.connections.push(G.connect(this.grid,"onBlur",this,"apply"));this.connections.push(G.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){C.forEach(this.connections,G.disconnect)},cellFocus:function(v,d){this.grid.singleClickEdit||this.isEditRow(d)?this.setEditCell(v,d):this.apply();(this.isEditing()||v&&v.editable&&v.alwaysEditing)&&this._focusEditor(v,d)},rowClick:function(v){this.isEditing()&&
!this.isEditRow(v.rowIndex)&&this.apply()},styleRow:function(v){v.index==this.info.rowIndex&&(v.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(v){var d=v.cell;return(d=d&&d.editable?d:0)&&d.dispatchEvent(v.dispatch,v)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(v,d){return this.info.rowIndex===v&&this.info.cell.index==d},isEditRow:function(v){return this.info.rowIndex===v},setEditCell:function(v,d){!this.isEditCell(d,v.index)&&this.grid.canEdit&&this.grid.canEdit(v,
d)&&this.start(v,d,this.isEditRow(d)||v.editable)},_focusEditor:function(v,d){g.fire(v,"focus",[d])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){e("ie")&&(this._catchBoomerang=(new Date).getTime()+
this._boomerangWindow)},start:function(v,d,x){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(d)&&(this.applyRowEdit(),this.grid.updateRow(d)),x?(this.info={cell:v,rowIndex:d},this.grid.doStartEdit(v,d),this.grid.updateRow(d)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(v,d),this._doCatchBoomerang())},_editorDo:function(v){var d=this.info.cell;if(d&&d.editable)d[v](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},
editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(v,d,x){this.grid.canEdit(d,x)&&this.grid.doApplyCellEdit(v,x,d.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),
this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(v,d){var x=this.info.cell;!this.isEditRow(v)||d&&x.view!=d||!x.editable||x.save(x,this.info.rowIndex)},restore:function(v,d){var x=this.info.cell;this.isEditRow(d)&&x.view==v&&x.editable&&x.restore(this.info.rowIndex)},_isValidInput:function(){var v=(this.info.cell||{}).widget;if(!v||!v.isValid)return!0;v.focused=!0;return v.isValid(!0)},_onPreRender:function(){this.isEditing()&&
(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(O,C,I,G){return O("dojox.grid.Selection",null,{constructor:function(e){this.grid=e;this.selected=[];this.setMode(e.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(e){this.selected.length&&this.deselectAll();this.mode="extended"!=e&&"multiple"!=e&&"single"!=e&&"none"!=
e?"extended":e},onCanSelect:function(e){return this.grid.onCanSelect(e)},onCanDeselect:function(e){return this.grid.onCanDeselect(e)},onSelected:function(e){},onDeselected:function(e){},onChanging:function(){},onChanged:function(){},isSelected:function(e){return"none"==this.mode?!1:this.selected[e]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var e=0,g=this.selected.length;e<g;e++)if(this.selected[e])return e;return-1},getNextSelected:function(e){if("none"==
this.mode)return-1;e+=1;for(var g=this.selected.length;e<g;e++)if(this.selected[e])return e;return-1},getSelected:function(){for(var e=[],g=0,v=this.selected.length;g<v;g++)this.selected[g]&&e.push(g);return e},getSelectedCount:function(){for(var e=0,g=0;g<this.selected.length;g++)this.selected[g]&&e++;return e},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},select:function(e){"none"!=this.mode&&
("multiple"!=this.mode?(this.deselectAll(e),this.addToSelection(e)):this.toggleSelect(e))},addToSelection:function(e){if("none"!=this.mode)if(I.isArray(e))C.forEach(e,this.addToSelection,this);else if(e=Number(e),this.selected[e])this.selectedIndex=e;else if(!1!==this.onCanSelect(e)){this.selectedIndex=e;var g=this.grid.getRowNode(e);g&&G.set(g,"aria-selected","true");this._beginUpdate();this.selected[e]=!0;this.onSelected(e);this._endUpdate()}},deselect:function(e){if("none"!=this.mode)if(I.isArray(e))C.forEach(e,
this.deselect,this);else if(e=Number(e),this.selectedIndex==e&&(this.selectedIndex=-1),this.selected[e]&&!1!==this.onCanDeselect(e)){var g=this.grid.getRowNode(e);g&&G.set(g,"aria-selected","false");this._beginUpdate();delete this.selected[e];this.onDeselected(e);this._endUpdate()}},setSelected:function(e,g){this[g?"addToSelection":"deselect"](e)},toggleSelect:function(e){I.isArray(e)?C.forEach(e,this.toggleSelect,this):this.setSelected(e,!this.selected[e])},_range:function(e,g,v){var d=0<=e?e:g;
e=g;d>e&&(e=d,d=g);for(g=d;g<=e;g++)v(g)},selectRange:function(e,g){this._range(e,g,I.hitch(this,"addToSelection"))},deselectRange:function(e,g){this._range(e,g,I.hitch(this,"deselect"))},insert:function(e){this.selected.splice(e,0,!1);this.selectedIndex>=e&&this.selectedIndex++},remove:function(e){this.selected.splice(e,1);this.selectedIndex>=e&&this.selectedIndex--},deselectAll:function(e){for(var g in this.selected)g!=e&&!0===this.selected[g]&&this.deselect(g)},clickSelect:function(e,g,v){if("none"!=
this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(e);else{if(!v||0>this.rangeStartIndex)this.rangeStartIndex=e;g||this.deselectAll(e);v?this.selectRange(this.rangeStartIndex,e):g?this.toggleSelect(e):this.addToSelection(e)}this._endUpdate()}},clickSelectEvent:function(e){this.clickSelect(e.rowIndex,dojo.isCopyKey(e),e.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver",
"./Selection"],function(O,C,I){return O("dojox.grid.DataSelection",I,{constructor:function(G){G.keepSelection&&(this.preserver=new C(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var G=I.prototype.getFirstSelected.call(this);return-1==G?null:this.grid.getItem(G)},getNextSelected:function(G){G=this.grid.getItemIndex(G);G=I.prototype.getNextSelected.call(this,G);return-1==G?null:this.grid.getItem(G)},getSelected:function(){for(var G=[],e=0,g=this.selected.length;e<
g;e++)this.selected[e]&&G.push(this.grid.getItem(e));return G},addToSelection:function(G){if("none"!=this.mode){var e=null;e="number"==typeof G||"string"==typeof G?G:this.grid.getItemIndex(G);I.prototype.addToSelection.call(this,e)}},deselect:function(G){if("none"!=this.mode){var e=null;e="number"==typeof G||"string"==typeof G?G:this.grid.getItemIndex(G);I.prototype.deselect.call(this,e)}},deselectAll:function(G){var e=null;G||"number"==typeof G?(e="number"==typeof G||"string"==typeof G?G:this.grid.getItemIndex(G),
I.prototype.deselectAll.call(this,e)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(O,C,I,G){return O("dojox.grid._SelectionPreserver",null,{constructor:function(e){this.selection=e;var g=this.grid=e.grid;this.reset();this._connects=[C.connect(g,"_setStore",this,"reset"),C.connect(g,"_addItem",this,"_reSelectById"),C.connect(e,"onSelected",I.hitch(this,"_selectById",!0)),
C.connect(e,"onDeselected",I.hitch(this,"_selectById",!1)),C.connect(e,"deselectAll",this,"reset")]},destroy:function(){this.reset();G.forEach(this._connects,C.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(e,g){e&&this.grid._hasIdentity&&(this.selection.selected[g]=this._selectedById[this.grid.store.getIdentity(e)])},_selectById:function(e,g){if("none"!=this.selection.mode&&this.grid._hasIdentity){var v=g,d=this.grid;if("number"==typeof g||"string"==
typeof g)v=(g=d._by_idx[g])&&g.item;v&&(this._selectedById[d.store.getIdentity(v)]=!!e);return v}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(O,C,I,G,e,g,v,d,x,t,h){O=O([v,d],{declaredClass:"esri.dijit.editing.TemplatePickerItem",templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",
startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(f,b,a,n,p){if(b&&"textsymbol"!==b.type){f=x.createSurface(f,a,n);if(9>G("ie")){var m=f.getEventSource();g.set(m,"position","relative");g.set(m.parentNode,"position","relative")}b=!this.legendOverride&&this._getDrawingToolShape(b,p)||t.getShapeDescriptors(b);try{var k=f.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke)}catch(q){f.clear();
f.destroy();return}var A=k.getBoundingBox();b=A.width;p=A.height;m=-(A.x+b/2);A=-(A.y+p/2);var w=f.getDimensions();m={dx:m+w.width/2,dy:A+w.height/2};if(b>a||p>n)A=b/a>p/n,a=((A?a:n)-5)/(A?b:p),C.mixin(m,{xx:a,yy:a});k.applyTransform(m);return f}},_getDrawingToolShape:function(f,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":b={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};
break;case "esriFeatureEditToolRightArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":b={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};break;case "esriFeatureEditToolDownArrow":b={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":b=
{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":b="simplelinesymbol"===f.type||"cartographiclinesymbol"===f.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:
{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:b,fill:f.getFill(),stroke:f.getStroke()}},_repaint:function(f){f?(f.getStroke&&f.setStroke&&f.setStroke(f.getStroke()),f.getFill&&f.setFill&&f.setFill(f.getFill()),f.children&&C.isArray(f.children)&&I.forEach(f.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
G("extend-esri")&&C.setObject("dijit.editing.TemplatePickerItem",O,h);return O})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ./FeatureTable/dataUtils ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D,z,L,F,Q,T,E,M,J,P,R,Y,Z,da,N,U,ca,ja){var ia=O([u,A,w],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:ja,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(X,W){C.mixin(this,p.widgets.attributeInspector);X=X||{};X.featureLayer||X.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(X);this._layerInfos=X.layerInfos||[{featureLayer:X.featureLayer,options:X.options||[]}];this._layerInfos=I.filter(this._layerInfos,function(ba){return!ba.disableAttributeUpdate});this._hideNavButtons=X.hideNavButtons||!1},postCreate:function(){if(I.every(this._layerInfos,
function(W){return W.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var X=this._layerInfos.length;I.forEach(this._layerInfos,function(W){W=W.featureLayer;if(W.loaded)X--;else var ba=G.connect(W,"onLoad",this,function(ha){G.disconnect(ba);ba=null;X--;X||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();I.forEach(this._aiConnects,G.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(X,W){W&&(this._createOnlyFirstTime=!0);
this._updateSelection([X],W);this._updateUI()},onLayerSelectionChange:function(X,W,ba){this._createOnlyFirstTime=!1;this._featureIdx=ba===n.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(X,W,ba,ha){},onLayerError:function(X,W,ba,ha){},onLayerEditsError:function(X,
W,ba,ha){},onLayerEditsComplete:function(X,W,ba,ha){ha=ha||[];if(ha.length){var na=this._selection,pa=X.featureLayer.objectIdField;I.forEach(ha,C.hitch(this,function(sa){I.some(na,C.hitch(this,function(qa,xa){if(qa.attributes[pa]!==sa.objectId)return!1;this._selection.splice(xa,1);return!0}))}))}W=W||[];W.length&&(this._selection=z.findFeatures(W,X.featureLayer),this._featureIdx=0);ha=this._numFeatures=(this._selection=z.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;
if(W.length){if(W=ha?this._selection[this._featureIdx]:null)ha=W.getLayer().getEditCapabilities(),ha.canCreate&&!ha.canUpdate||this._showFeature(W);this._updateUI()}ba=ba||[];if(ba.length){var ra=this._rollbackInfo;I.forEach(ba,function(sa){var qa=z.findFeatures(ba,X.featureLayer)[0];if(!sa.success&&qa.attributes[X.featureLayer.objectIdField]===sa.objectId&&ra){var xa=ra.field;sa=ra.graphic.attributes[xa.name];var Da=I.filter(this._currentLInfo.fieldInfos,function(Qa){return Qa.fieldName===xa.name},
this)[0].dijit;qa.attributes[xa.name]=sa;"esriFieldTypeDate"===xa.type&&(sa=new Date(sa));this._setValue(Da,sa)}},this)}this._rollbackInfo=null},onFieldValueChange:function(X,W){var ba=X.field,ha=X.dijit,na=this._currentFeature,pa=this._currentLInfo,ra=ba.name;X=this._isFieldRequired(ba,X);if(""===ha.displayedValue||"dijit.form.ValidationTextBox"!==ha.declaredClass||ha.isValid())if(""!==ha.displayedValue&&ha.displayedValue!==W&&ha.isValid&&!ha.isValid())this._setValue(ha,na.attributes[ba.name]);else{var sa=
!("esriFieldTypeInteger"!==ba.type&&"esriFieldTypeSmallInteger"!==ba.type&&"esriFieldTypeSingle"!==ba.type&&"esriFieldTypeDouble"!==ba.type);if(X&&(null===W||""===W||"undefined"===typeof W||sa&&isNaN(W))){ra=na.attributes[ba.name];if("esriFieldTypeDate"===ba.type&&(ra=new Date(ra),ha instanceof Array)){this._setValue(ha[0],ra);this._setValue(ha[1],ra);return}this._setValue(ha,ra)}else{if(sa){if(isNaN(W)||""===W)W=null;sa&&null!==W&&(W=Number(W))}"esriFieldTypeDate"===ba.type&&(ha instanceof Array?
(W=ha[0].getValue(),ha=ha[1].getValue(),W=W&&ha?new Date(W.getFullYear(),W.getMonth(),W.getDate(),ha.getHours(),ha.getMinutes(),ha.getSeconds(),ha.getMilliseconds()):W||ha||null):(W=ha.getValue(),ba.domain&&(W=Number(W))),W=W&&W.getTime?W.getTime():W&&W.toGregorian?W.toGregorian().getTime():W);if(this._currentFeature.attributes[ba.name]!==W){if(ra===pa.typeIdField){var qa=this._findFirst(pa.types,"id",W);I.forEach(pa.fieldInfos,function(xa){(ba=xa.field)&&ba.name!==pa.typeIdField&&(xa=xa.dijit,this._setFieldDomain(xa,
qa,ba)&&xa&&(this._setValue(xa,na.attributes[ba.name]+""),!1===xa.isValid()&&this._setValue(xa,null)))},this)}this.onAttributeChange(na,ra,W)}}}else this._setValue(ha,na.attributes[ba.name])},onDeleteBtn:function(X){this._deleteFeature()},onNextFeature:function(X){this._onNextFeature(1)},onPreviousFeature:function(X){this._onNextFeature(-1)},onFirstFeature:function(X){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(X){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var X=
this._layerInfos;this._editorTrackingInfos={};I.forEach(X,this._initLayerInfo,this)},_initLayerInfo:function(X){var W=X.featureLayer,ba;this._userIds={};var ha=W.id;W.credential&&(this._userIds[ha]=W.credential.userId);X.userId&&(this._userIds[ha]=X.userId);this._connect(W,"onSelectionComplete",C.hitch(this,"onLayerSelectionChange",X));this._connect(W,"onSelectionClear",C.hitch(this,"onLayerSelectionClear",X));this._connect(W,"onEditsComplete",C.hitch(this,"onLayerEditsComplete",X));this._connect(W,
"error",C.hitch(this,"onLayerError",X));this._connect(W,"onUpdateEnd",C.hitch(this,"onLayerUpdateEnd",X));X.showAttachments=W.hasAttachments?f.isDefined(X.showAttachments)?X.showAttachments:!0:!1;X.hideFields=X.hideFields||[];X.htmlFields=X.htmlFields||[];X.isEditable=W.isEditable()?f.isDefined(X.isEditable)?X.isEditable:!0:!1;X.typeIdField=W.typeIdField;X.layerId=W.id;X.types=W.types;W.globalIdField&&((ba=this._findFirst(X.fieldInfos,"fieldName",W.globalIdField))||X.showGlobalID||X.hideFields.push(W.globalIdField));
(ha=this._findFirst(X.fieldInfos,"fieldName",W.objectIdField))||X.showObjectID||X.hideFields.push(W.objectIdField);var na=this._getFields(X.featureLayer);if(na){var pa=X.fieldInfos||[];pa=I.map(pa,function(ra){return C.mixin({},ra)});pa.length?X.fieldInfos=I.filter(I.map(pa,C.hitch(this,function(ra){var sa=ra.stringFieldOption||(this._isInFields(ra.fieldName,X.htmlFields)?ia.STRING_FIELD_OPTION_RICHTEXT:ia.STRING_FIELD_OPTION_TEXTBOX);return C.mixin(ra,{field:this._findFirst(na,"name",ra.fieldName),
stringFieldOption:sa})})),"return item.field;"):(na=I.filter(na,C.hitch(this,function(ra){return!this._isInFields(ra.name,X.hideFields)})),X.fieldInfos=I.map(na,C.hitch(this,function(ra){var sa=this._isInFields(ra.name,X.htmlFields)?ia.STRING_FIELD_OPTION_RICHTEXT:ia.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:ra.name,field:ra,stringFieldOption:sa}})));X.showGlobalID&&!ba&&pa.push(this._findFirst(na,"name",W.globalIdField));X.showObjectID&&!ha&&pa.push(this._findFirst(na,"name",W.objectIdField));
ba=[];W.editFieldsInfo&&(W.editFieldsInfo.creatorField&&ba.push(W.editFieldsInfo.creatorField),W.editFieldsInfo.creationDateField&&ba.push(W.editFieldsInfo.creationDateField),W.editFieldsInfo.editorField&&ba.push(W.editFieldsInfo.editorField),W.editFieldsInfo.editDateField&&ba.push(W.editFieldsInfo.editDateField));this._editorTrackingInfos[W.id]=ba}},_createAttachmentEditor:function(){this._attachmentEditor=null;var X=I.filter(this._layerInfos,function(W){return W.showAttachments});X&&X.length&&(this._attachmentEditor=
new D({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(X){var W=this._currentLInfo?this._currentLInfo.featureLayer:null,ba=X.featureLayer;if(W&&W.id===ba.id&&!W.ownershipBasedAccessControlForFeatures&&(W=ba.getEditCapabilities(),!W.canCreate||W.canUpdate))return;this._currentLInfo=X;this._createTable()},_updateSelection:function(X,W){this._selection=X||[];I.forEach(this._layerInfos,this._getSelection,this);this._selection=z.sortFeaturesById(this._layerInfos,
this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?this._selection[this._featureIdx]:null,W)},_getSelection:function(X){X=X.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(X)},_updateUI:function(){var X=this._numFeatures,W=this._currentLInfo;this.layerName.innerHTML=W&&0!==X?W.featureLayer?W.featureLayer.name:"":this.NLS_noFeaturesSelected;d.set(this.attributeTable,"display",X?"":"none");d.set(this.editButtons,"display",X?"":"none");
d.set(this.navButtons,"display",!this._hideNavButtons&&1<X?"":"none");this.navMessage.innerHTML=f.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&d.set(this._attachmentEditor.domNode,"display",W&&W.showAttachments&&X?"":"none");d.set(this.deleteBtn.domNode,"display",W&&!1===W.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(X){this._featureIdx+=
X;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);X=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(X);this._updateUI();this.onNext(X)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(X,W){if(X){this._currentFeature=X;W=W?W:X.getLayer();var ba=W.getEditCapabilities({feature:X,userId:this._userIds[W.id]});this._canUpdate=ba.canUpdate;this._canDelete=ba.canDelete;if(ba=
this._getLInfoFromFeatureLayer(W)){this._setCurrentLInfo(ba);var ha=X.attributes,na=this._findFirst(ba.types,"id",ha[ba.typeIdField]),pa=null;I.forEach(ba.fieldInfos,function(ra){pa=ra.field;var sa=[];ra.dijit&&1<ra.dijit.length?I.forEach(ra.dijit,function(qa){sa.push(qa)}):sa.push(ra.dijit);I.forEach(sa,C.hitch(this,function(qa){if(qa){var xa=this._setFieldDomain(qa,na,pa),Da=ha[pa.name];Da=Da&&xa&&xa.codedValues&&xa.codedValues.length?xa.codedValues[Da]?xa.codedValues[Da].name:Da:Da;f.isDefined(Da)||
(Da="");"dijit.form.DateTextBox"===qa.declaredClass||"dijit.form.TimeTextBox"===qa.declaredClass?Da=""===Da?null:new Date(Da):"dijit.form.FilteringSelect"===qa.declaredClass&&(qa._lastValueReported=null,Da=ha[pa.name]+"");try{this._setValue(qa,Da),"dijit.form.FilteringSelect"===qa.declaredClass&&!1===qa.isValid()&&this._setValue(qa,null)}catch(Qa){qa.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&ba.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,
W);(X=W.getEditSummary(X))?(this.editorTrackingInfoDiv.innerHTML=X,b.show(this.editorTrackingInfoDiv)):b.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(X,W,ba){if(!X)return null;var ha=ba.domain;W&&W.domains&&W.domains[ba.name]&&!1===W.domains[ba.name]instanceof a&&(ha=W.domains[ba.name]);if(!ha)return null;ha.codedValues&&0<ha.codedValues.length?(X.set("store",this._toStore(I.map(ha.codedValues,function(na){return{id:na.code+"",name:na.name}}))),this._setValue(X,ha.codedValues[0].code+
"")):(X.constraints={min:f.isDefined(ha.minValue)?ha.minValue:Number.MIN_VALUE,max:f.isDefined(ha.maxValue)?ha.maxValue:Number.MAX_VALUE},this._setValue(X,X.constraints.min));return ha},_setValue:function(X,W){X.set&&(X._onChangeActive=!1,X.set("value",W,!0),X._onChangeActive=!0)},_getFields:function(X){var W=X._getOutFields();if(!W)return null;X=X.fields;return"*"==W?X:I.filter(I.map(W,C.hitch(this,"_findFirst",X,"name")),f.isDefined)},_isInFields:function(X,W){return X&&(W||W.length)?I.some(W,function(ba){return ba.toLowerCase()===
X.toLowerCase()}):!1},_isFieldNullable:function(X,W){return!(!1===X.nullable||W.field&&!1===W.field.nullable)},_isFieldRequired:function(X,W){return!1!==X.editable&&!1!==W.isEditable&&!this._isFieldNullable(X,W)},_findFirst:function(X,W,ba){return(X=I.filter(X,function(ha){return ha.hasOwnProperty(W)&&ha[W]===ba}))&&X.length?X[0]:null},_getLInfoFromFeatureLayer:function(X){return this._findFirst(this._layerInfos,"layerId",X?X.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML=
"";this._attributes=x.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var X=x.create("tbody",null,this._attributes),W=this._currentLInfo,ba=this._findFirst(W.types,"id",this._currentFeature.attributes[W.typeIdField]);I.forEach(W.fieldInfos,C.hitch(this,"_createField",ba,X),this);this._createOnlyFirstTime=!1},_createField:function(X,W,ba){var ha=this._currentLInfo,na=ba.field;if(!this._isInFields(na.name,ha.hideFields)&&!this._isInFields(na.name,this._editorTrackingInfos[ha.featureLayer.id])){var pa=
!1,ra;W=x.create("tr",null,W);var sa=ba.label||na.alias||na.name;sa=t.sanitizer?t.sanitizer.sanitize(sa):htmlEntities.encode(sa);sa=x.create("td",{innerHTML:sa,"class":this.css.label,"data-fieldname":na.name},W);this._isFieldRequired(na,ba)&&x.create("span",{"class":this.css.red,innerHTML:" *"},sa);W=x.create("td",null,W);if(ba.customField){x.place(ba.customField.domNode||ba.customField,x.create("div",null,W),"first");var qa=ba.customField}else if(!1===ha.isEditable||!1===na.editable||!1===ba.isEditable||
"esriFieldTypeOID"===na.type||"esriFieldTypeGlobalID"===na.type||!this._canUpdate&&!this._createOnlyFirstTime)pa=!0;ha=ha.typeIdField&&na.name.toLowerCase()==ha.typeIdField.toLowerCase();sa=!!this._getDomainForField(na,X);!qa&&ha?qa=this._createTypeField(na,ba,W):!qa&&sa&&(qa=this._createDomainField(na,ba,X,W));if(!qa)switch(na.type){case "esriFieldTypeString":qa=this._createStringField(na,ba,W);break;case "esriFieldTypeDate":qa=this._createDateField(na,ba,W);ba.format&&ba.format.time&&(ra=this._createTimeField(na,
ba,W));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":qa=this._createIntField(na,ba,W);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":qa=this._createFltField(na,ba,W);break;default:qa=this._createStringField(na,ba,W)}ba.tooltip&&ba.tooltip.length&&this._toolTips.push(new Z({connectId:[qa.id],label:ba.tooltip}));qa.onChange=C.hitch(this,"onFieldValueChange",ba);qa.set("disabled",pa);ra?(ba.dijit=[qa,ra],ra.onChange=C.hitch(this,"onFieldValueChange",ba),ra.set("disabled",
pa)):ba.dijit=qa}},_createTypeField:function(X,W,ba){ba=x.create("div",null,ba);var ha=X.domain;return ha&&"range"===ha.type&&ha.minValue===ha.maxValue?new R({"class":this.css.field,trim:!0,maxLength:X.length,name:X.alias||X.name,required:this._isFieldRequired(X,W)},ba):new E({"class":this.css.field,name:X.alias||X.name,required:this._isFieldRequired(X,W),store:this._toStore(I.map(this._currentLInfo.types,function(na){return{id:na.id,name:na.name}})),searchAttr:"name"},ba)},_getDomainForField:function(X,
W){var ba=X.domain;(X=X.name)&&W&&W.domains&&W.domains[X]&&!1===W.domains[X]instanceof a&&(ba=W.domains[X]);return ba||null},_createDomainField:function(X,W,ba,ha){ba=this._getDomainForField(X,ba);ha=x.create("div",null,ha);return ba.codedValues?new E({"class":this.css.field,name:X.alias||X.name,searchAttr:"name",required:this._isFieldRequired(X,W)},ha):new M({"class":this.css.field},ha)},_createStringField:function(X,W,ba){ba=x.create("div",null,ba);var ha={trim:!0,maxLength:X.length,required:this._isFieldRequired(X,
W)};if(W.stringFieldOption===ia.STRING_FIELD_OPTION_TEXTAREA)return ha["class"]=this.css.field+" "+this.css.textArea,new P(ha,ba);if(W.stringFieldOption===ia.STRING_FIELD_OPTION_RICHTEXT)return ha["class"]=this.css.field+" "+this.css.richText,ha.height="100%",ha.width="100%",ha.plugins=W.richTextPlugins||this._defaultRichTextPlugins,ba=new q(ha,ba),ba.startup(),ba;var na=this;ha.validator=function(pa,ra){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return na._isFieldNullable(X,W)||!(""===
pa||null===pa)};return new R(ha,ba)},_createTimeField:function(X,W,ba){ba=x.create("div",null,ba);X={"class":this.css.field,trim:!0,required:this._isFieldRequired(X,W),constraints:{formatLength:"medium"}};this._datePackage&&(X.datePackage=this._datePackage);return new Y(X,ba)},_createDateField:function(X,W,ba){ba=x.create("div",null,ba);X={"class":this.css.field,trim:!0,required:this._isFieldRequired(X,W)};this._datePackage&&(X.datePackage=this._datePackage);return new F(X,ba)},_createIntField:function(X,
W,ba){ba=x.create("div",null,ba);return new T({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===X.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(X,W)},ba)},_createFltField:function(X,W,ba){ba=x.create("div",null,ba);return new T({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(X,W)},ba)},_toStore:function(X){return new da({data:{identifier:"id",
label:"name",items:X}})},_connect:function(X,W,ba){this._aiConnects.push(G.connect(X,W,ba))},_getDatePackage:function(X){return null===X.datePackage?null:X.datePackage?X.datePackage:"ar"===g.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){I.forEach(this._layerInfos,function(X){I.forEach(X.fieldInfos,function(W){var ba=W.dijit;if(ba){ba._onChangeHandle=null;if(W.customField)return;ba instanceof Array?I.forEach(ba,C.hitch(this,function(ha){ha.destroyRecursive?ha.destroyRecursive():
ha.destroy&&ha.destroy();ha._onChangeHandle=null})):ba.destroyRecursive?ba.destroyRecursive():ba.destroy&&ba.destroy()}W.dijit=null},this)},this);I.forEach(this._toolTips,function(X){X.destroy()});this._toolTips=[];this._attributes&&x.destroy(this._attributes)}});C.mixin(ia,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});v("extend-esri")&&C.setObject("dijit.AttributeInspector",ia,h);return ia})},"esri/dijit/FeatureTable/dataUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/number dojo/string dojo/date/locale dojo/promise/all ../../libs/sanitizer/Sanitizer ../../config ../../graphic ../../numberUtils ../../request ../../ArcadeExpression ../../arcadeProfiles/popupProfile ../../layers/FeatureLayer ../../geometry/Extent ../../tasks/query ../../tasks/StatisticDefinition ../../tasks/QueryTask ../../tasks/RelationshipQuery dojo/i18n dojo/i18n!../../nls/jsapi".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B){return{i18nStrings:B.widgets.FeatureTable,numericFieldTypes:["esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeSmallInteger"],statisticDefinitions:[{type:"count",name:"countField"},{type:"sum",name:"sumField"},{type:"min",name:"minField"},{type:"max",name:"maxField"},{type:"avg",name:"avgField"},{type:"stddev",name:"stddevField"}],_reExprField:/^\s*expression\//i,sanitizer:new d({whiteList:{dd:[],dl:[],dt:[],h1:[],
h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],text:[],textpath:[],tspan:[],use:[]}},!0),getOrderByString:function(l,u){return l+(u?" DESC":" ASC")},getWhereString:function(l,u){return l+"\x3d'"+u+"'"},getRelationshipWhereClause:function(l){var u=l.layer,D=l.originRelationship,
z=l.destinationRelationship,L=D.relationshipTableId||D.relatedTableId;D=D.keyFieldInRelationshipTable||D.keyField;var F=z.keyFieldInRelationshipTable||z.keyField,Q=u.layerId==L?F:D;l=this.getWhereString(Q,l.keyValue);D=u._url.path;D=D.substring(0,D.lastIndexOf("/")+1);return f({url:D+L+"/query",content:{f:"json",outFields:["*"],returnGeometry:!1,where:l},handleAs:"json",callbackParamName:"callback"}).then(C.hitch(this,function(T){if(T&&T.features&&T.features.length){var E=T.features,M=[],J="",P;O.forEach(E,
function(R,Y){if(R.attributes&&R.attributes[F])P=R.attributes[F];else{var Z=u.getField(Q)?u.getField(Q).name:null;if(this.isValueEmpty(Z)){Z=F.toUpperCase();var da=F.toLowerCase();P=R.attributes[Z]||R.attributes[da]||null}else P=R.attributes[Z]}-1===O.indexOf(M,P)&&(0<M.length&&Y<E.length&&(J=J.concat(" OR ")),M.push(P),J=J.concat(this.getWhereString(z.keyField,P)))},this);return J}return null}))},isValueEmpty:function(l){return null===l||" "===l||""===l||"undefined"===typeof l},findFirst:function(l,
u,D){return O.filter(l,function(z){return z.hasOwnProperty(u)&&z[u]===D})[0]||null},compareIntArrays:function(l,u){l.sort();u.sort();var D=O.every(u,function(L){return-1!==O.indexOf(l,L)},this),z=O.every(l,function(L){return-1!==O.indexOf(u,L)},this);return D&&z},findFirstNumberColumn:function(l,u){var D;O.some(l,function(z,L){if(-1!==O.indexOf(this.numericFieldTypes,z.type)&&z.field!==u&&!z.hidden)return D=z,!0},this);return D},getRoundingPrecision:function(l){return 1E3<=l?0:10<=l?2:0<=l?4:6},generateLinkFromString:function(l){var u=
/^\s*(http?:\/\/([^\s]+))\s*$/i,D=/^\s*(https?:\/\/([^\s]+))\s*$/i;if("string"===typeof l){var z;u.test(l)?z=l.indexOf("http:"):D.test(l)&&(z=l.indexOf("https:"));-1<z&&-1===l.indexOf("href\x3d")?(u=l.indexOf(" ",z),-1===u&&(u=l.length),D=l.substring(z,u),l=l.substring(0,z)+"\x3ca href\x3d'"+D+"' target\x3d'_blank'\x3e"+D+"\x3c/a\x3e"+l.substring(u,l.length)):l=this.sanitizer.sanitize(l)}return this.isValueEmpty(l)?"":l},isNumericFieldType:function(l){return-1!==O.indexOf(this.numericFieldTypes,l)},
isIntegerFieldType:function(l){return"esriFieldTypeInteger"===l||"esriFieldTypeSmallInteger"===l},isFloatFieldType:function(l){return"esriFieldTypeDouble"===l||"esriFieldTypeSingle"===l},getDomainValueFromRow:function(l){var u=l.fieldInfo.name,D=l.fieldInfo.domain,z=l.row;if("range"===D.type)return z[u];l=O.filter(D.codedValues,function(L){return L.hasOwnProperty("code")&&L.code==z[u]});return l[0]&&!this.isValueEmpty(l[0].name)?l[0].name:z[u]},getTypeValueFromRow:function(l){var u=l.layerInfo[l.typesProperty],
D=l.typeIdProperty,z=l.fieldInfo,L=l.row;l=u&&u[0];if(l){var F=L[z.name];z=this.isNumericFieldType(z.type);z=(l="string"===typeof l[D])&&z?F.toString():F;F=(F=this.findFirst(u,D,z))?F.name:null}return F},getSubtypeDomainValue:function(l){var u=l.layerInfo,D=l.fieldInfo.name,z=l.row,L;l=(u=this.findFirst(u.types,"id",z[u.typeIdField]))?u.domains:null;if(!u||!l)return z[D];l[D]&&l[D].codedValues&&(L=O.filter(l[D].codedValues,function(F){return F.hasOwnProperty("code")&&F.code==z[D]}));return L&&L[0]&&
!this.isValueEmpty(L[0].name)?L[0].name:z[D]},mergeDictionaries:function(l,u){if(null===l||null===u)return l;for(var D in u){l[D]||(l[D]={});for(var z in u[D])l[D][z]=u[D][z]}return l},isCyclicalRelationship:function(l){return"esriRelCardinalityOneToOne"===l.cardinality||"esriRelCardinalityOneToMany"===l.cardinality&&"esriRelRoleDestination"===l.role},getColumnFromFieldName:function(l){return this.findFirst(l.grid.columns,"field",l.fieldName)},isDateFieldWithStringDataValue:function(l){return"esriFieldTypeDateOnly"===
l||"esriFieldTypeTimeOnly"===l||"esriFieldTypeTimestampOffset"===l},formatNumberForLocale:function(l,u){if(u){var D=q.getLocalization("dojo.cldr","number");if(u.digitSeparator||!D||this.isValueEmpty(l))return isNaN(l)||null===l?null:G.format(l,u);l=isNaN(l)||null===l?null:G.format(l,u);return l.replace(new RegExp("\\"+D.group,"g"),"")}return isNaN(l)||null===l?null:h.format(l,u)},getCombinedDateTime:function(l,u){return new Date(l.getFullYear(),l.getMonth(),l.getDate(),u.getHours(),u.getMinutes(),
u.getSeconds())},formatDateForLocale:function(l){var u=l.dateOptions||{},D=l.timestamp,z=l.fieldInfo,L=!1,F=!1;l={};u=(L=z&&z.dateOptions?z.dateOptions:!1)||u;L=L&&this.isValueEmpty(u.dateEnabled)?!0:!!u.dateEnabled;F=!!u.timeEnabled;this.isValueEmpty(u.datePattern)||(l.datePattern=u.datePattern);this.isValueEmpty(u.timeEnabled)||this.isValueEmpty(u.timePattern)||(l.timePattern=u.timePattern);l.selector=L&&F?"date and time":L&&!F?"date":!L&&F?"time":"date";return g.format(new Date(D),l)},calculateExtentFromFeatures:function(l){var u=
l[0].geometry,D;if(null===u&&1===l.length)return null;for(u=l.length-1;0<=u;u--)null===l[u].geometry&&l.splice(u,1);u=l[0].geometry;var z=u.getExtent();var L=l.length;null===z&&(z=new p(u.x,u.y,u.x,u.y,u.spatialReference));for(D=1;D<L;D++){u=l[D].geometry;var F=u.getExtent();null===F&&(F=new p(u.x,u.y,u.x,u.y,u.spatialReference));z=z.union(F)}return z},initFeatureLayer:function(l,u){l=l._url.path;l=l.substring(0,l.lastIndexOf("/")+1);return new n(l+u,{mode:n.MODE_ONDEMAND,outFields:["*"],visible:!0})},
applyEdits:function(l){var u=[],D=new I;if(!l||0>=l.length)return D.reject(),D;O.forEach(l,function(z){z.layer&&u.push(z.layer.applyEdits(z.adds,z.updates,z.deletes,function(L,F,Q){D.resolve({adds:L,updates:F,deletes:Q})},function(L){D.reject(L)}))});0<u.length?v(u):D.reject();return D},applyEditsFromRow:function(l){var u=l.layer,D=new t;D.setAttributes(l.row);return this.applyEdits([{layer:u,updates:[D]}],null)},queryLayer:function(l){var u=l.layer;l=l.ids||null;var D=new m;D.where="1\x3d1";D.returnGeometry=
!1;D.objectIds=l;return u.queryFeatures(D)},queryLayerForFeature:function(l){return this.queryLayerForFeatures({layer:l.layer,ids:[l.id]})},queryLayerForFeatures:function(l){var u=l.layer,D=u.advancedQueryCapabilities;D=D&&D.supportsQueryWithCacheHint;l=l.ids;var z=new m;z.objectIds=l;z.outFields=["*"];D&&(z.cacheHint=!0);return u.queryFeatures(z,function(L){return L.features})},queryLayerForCount:function(l){var u=l.layer,D=u.advancedQueryCapabilities;D=D&&D.supportsQueryWithCacheHint;if(u.queryCount){var z=
new m,L=l.layerInfo;l=l.where||"1\x3d1";z.returnGeometry=!1;z.returnCountOnly=!0;z.where=l;D&&(z.cacheHint=!0);return u.queryCount(z).then(function(F){return F}).otherwise(function(){return L.isFeatureCollection?u.graphics.length:2E3}).always(function(F){return F})}return this.queryLayerCustom({layer:u,returnCountOnly:!0,cacheHint:D}).then(function(F){return F&&F.features?F.features.length:0}).otherwise(function(){return u.maxRecordCount||2E3}).always(function(F){return F})},queryLayerCustom:function(l){var u=
new m,D=l.returnCountOnly||!1,z=l.where||"1\x3d1",L=l.returnGeometry||!1,F=l.outFields||["*"],Q=l.cacheHint||!1;l=new A(l.layer.url);u.returnGeometry=L;u.outFields=F;u.where=z;u.returnCountOnly=D;Q&&(u.cacheHint=!0);return l.execute(u)},queryLayerForIds:function(l){var u=l.layer,D=u.advancedQueryCapabilities;D=D&&D.supportsQueryWithCacheHint;var z=l.idProperty;l=l.where||"1\x3d1";var L=new m;L.returnGeometry=!1;L.outFields=[z];L.where=l;L.returnIdsOnly=!0;D&&(L.cacheHint=!0);return u.queryIds(L)},
queryLayerForAttachments:function(l){return f({url:l.layer._url.path+"/queryAttachments",content:{f:"json",objectIds:l.ids},handleAs:"json",callbackParamName:"callback"})},queryLayerForAttachmentById:function(l){return l.layer.queryAttachmentInfos(l.id||0)},addAttachmentToLayer:function(l){return l.layer.addAttachment(l.featureId,l.formData)},deleteAttachmentFromLayer:function(l){return l.layer.deleteAttachments(l.featureId,[l.attachmentId])},queryLayerForRelatedRecords:function(l){var u=l.layer,
D=l.ids,z=l.outFields||["*"],L=l.relationship;l=l.returnCountOnly||!1;var F=new w;F.outFields=z;F.returnGeometry=!1;F.relationshipId=L.id;F.returnCountOnly=l;F.objectIds=D;return u.queryRelatedFeatures(F)},queryLayerForRelatedRecordCount:function(l){return f({url:l.layer._url.path+"/queryRelatedRecords",content:{f:"json",objectIds:l.objectIds.toString(),outFields:l.outFields,returnGeometry:!1,relationshipId:l.relationship.id,returnCountOnly:!0},handleAs:"json",callbackParamName:"callback"})},getFieldStatistics:function(l){var u=
new I,D=l.layer,z=D.advancedQueryCapabilities;z=z&&z.supportsQueryWithCacheHint;var L=l.idProperty,F=l.where||"1\x3d1",Q=l.filterIds,T=l.grid.columns[l.columnId].field;l=D.url;var E=[];var M=O.map(this.statisticDefinitions,function(P){var R=new k;R.onStatisticField=T;R.displayFieldName=T;R.outStatisticFieldName=P.name;R.statisticType=P.type;return R});var J=new m;J.outFields=[T];J.outStatistics=[];J.where=F;J.outStatistics=M;z&&(J.cacheHint=!0);Q&&0<Q.length&&(E=Q);J.where&&0<E.length&&(J.where="("+
J.where+") AND ("+L+" IN ("+E.toString()+"))");D.source&&!this.isValueEmpty(D.source.mapLayerId)&&l.endsWith("/dynamicLayer")&&(l=l.slice(0,-13),l=l+"/"+D.source.mapLayerId);(new A(l)).execute(J).then(function(P){u.resolve(P)}).otherwise(function(){u.reject()});return u},selectFeaturesById:function(l){var u=l.grid,D=u.layer;u=u.layerInfo;var z=l.map,L=l.ids;l=l.id;var F=new m;F.returnGeometry=!!z;F.objectIds=L||[l];u.isFeatureCollection||(F.where="1\x3d1");return D.selectFeatures(F,n.SELECTION_NEW)},
isFeatureEditable:function(l){var u=l.layerInfo;return!!l.layer.getEditCapabilities({userId:u.userIds[u.layerId]||null,feature:{attributes:l.attributes}}).canUpdate},isExpressionField:function(l){return this._reExprField.test(l)},getExpressionInfo:function(l,u){if(this.isExpressionField(u)){var D;u=u.replace(this._reExprField,"");u=u.toLowerCase();O.some(l,function(z){z.name.toLowerCase()===u&&(D=z);return!!D});return D}},compileExpressions:function(l){var u={};O.forEach(l,function(D){var z=D.returnType&&
D.returnType.toLowerCase();u[D.name]=new b({expression:D.expression,returnType:"number"===z?"number":"string",profile:a})});return u},getExpressionValue:function(l,u){var D=l.getLayer(),z=D&&D.getMap();return u?l.evaluateExpression(u,a.getEvalOptions({expression:u,feature:l,layer:D,map:z,spatialReference:z&&z.spatialReference})):null}}})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D){function z(F){return new w({command:F.name})}function L(F){return new w({buttonClass:A,command:F.name})}I=I("dijit.Editor",u,{plugins:null,extraPlugins:null,constructor:function(){h.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",q]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(f("ie")||f("trident")||f("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new G;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);h.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=e.getLocalization("dijit._editor",
"commands",this.lang);f("webkit")&&x.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new p({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));C.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);v.add(this.iframe.parentNode,"dijitEditorIFrameContainer");v.add(this.iframe,"dijitEditorIFrame");g.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){C.forEach(this._plugins,function(F){F&&F.destroy&&F.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(F,Q){var T=h.isString(F)?{name:F}:h.isFunction(F)?{ctor:F}:F;if(!T.setEditor){var E={args:T,plugin:null,editor:this};T.name&&(w.registry[T.name]?E.plugin=w.registry[T.name](T):a.publish(D._scopeName+".Editor.getPlugin",E));if(!E.plugin)try{var M=
T.ctor||h.getObject(T.name)||O(T.name);M&&(E.plugin=new M(T))}catch(J){throw Error(this.id+": cannot find plugin ["+T.name+"]");}if(!E.plugin)throw Error(this.id+": cannot find plugin ["+T.name+"]");F=E.plugin}1<arguments.length?this._plugins[Q]=F:this._plugins.push(F);F.setEditor(this);h.isFunction(F.setToolbar)&&F.setToolbar(this.toolbar)},resize:function(F){F&&k.prototype.resize.apply(this,arguments)},layout:function(){var F=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+d.getPadBorderExtents(this.iframe.parentNode).h+
d.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=F+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(F){var Q,T=this.document.body,E=T.clientWidth,M=T.clientHeight,J=T.clientLeft,P=T.offsetWidth,R=T.offsetHeight,Y=T.offsetLeft;/^rtl$/i.test(T.dir||"")?E<P&&F.x>E&&F.x<P&&(Q=!0):F.x<J&&F.x>Y&&(Q=!0);Q||M<R&&F.y>M&&F.y<R&&(Q=!0);Q||(delete this._cursorToStart,delete this._savedSelection,"BODY"==F.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(F){this.customUndo&&this.endEditing(!0);"BODY"!=F.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(F){this._inEditing||(this._inEditing=!0,this._beginEditing(F));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(F){if(!this.customUndo||
"undo"!=F&&"redo"!=F){this.customUndo&&(this.endEditing(),this._beginEditing());var Q=this.inherited(arguments);this.customUndo&&this._endEditing();return Q}return this[F]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(F){try{var Q=this.document.execCommand(F,!1,null);if(f("webkit")&&!Q)throw{};}catch(T){Q=b.substitute,alert(Q(this.commands.systemShortcut,
[this.commands[F],Q(this.commands[f("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[F]])])),Q=!1}return Q},queryCommandEnabled:function(F){return!this.customUndo||"undo"!=F&&"redo"!=F?this.inherited(arguments):"undo"==F?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(F){var Q=F.mark,T=F.mark;F=F.isCollapsed;var E;if(T)if(9>f("ie")||9===f("ie")&&f("quirks"))if(h.isArray(T))Q=[],C.forEach(T,function(P){Q.push(l.getNode(P,this.editNode))},this),this.selection.moveToBookmark({mark:Q,
isCollapsed:F});else{if(T.startContainer&&T.endContainer&&(E=l.getSelection(this.window))&&E.removeAllRanges){E.removeAllRanges();F=l.create(this.window);var M=l.getNode(T.startContainer,this.editNode);var J=l.getNode(T.endContainer,this.editNode);M&&J&&(F.setStart(M,T.startOffset),F.setEnd(J,T.endOffset),E.addRange(F))}}else(E=l.getSelection(this.window))&&E.removeAllRanges&&(E.removeAllRanges(),F=l.create(this.window),M=l.getNode(T.startContainer,this.editNode),J=l.getNode(T.endContainer,this.editNode),
M&&J&&(F.setStart(M,T.startOffset),F.setEnd(J,T.endOffset),E.addRange(F)))},_changeToStep:function(F,Q){this.setValue(Q.text);(F=Q.bookmark)&&this._moveToBookmark(F)},undo:function(){var F=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var Q=this._steps.pop();Q&&0<this._steps.length&&(this.focus(),this._changeToStep(Q,this._steps[this._steps.length-1]),this._undoedSteps.push(Q),this.onDisplayChanged(),delete this._undoRedoActive,F=!0);delete this._undoRedoActive}return F},
redo:function(){var F=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var Q=this._undoedSteps.pop();Q&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],Q),this._steps.push(Q),this.onDisplayChanged(),F=!0);delete this._undoRedoActive}return F},endEditing:function(F){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(F),this._inEditing=!1)},_getBookmark:function(){var F=this.selection.getBookmark(),
Q=[];if(F&&F.mark){var T=F.mark;if(9>f("ie")||9===f("ie")&&f("quirks")){var E=l.getSelection(this.window);if(h.isArray(T))C.forEach(F.mark,function(J){Q.push(l.getIndex(J,this.editNode).o)},this),F.mark=Q;else if(E){var M;E.rangeCount&&(M=E.getRangeAt(0));F.mark=M?M.cloneRange():this.selection.getBookmark()}}try{F.mark&&F.mark.startContainer&&(Q=l.getIndex(F.mark.startContainer,this.editNode).o,F.mark={startContainer:Q,startOffset:F.mark.startOffset,endContainer:F.mark.endContainer===F.mark.startContainer?
Q:l.getIndex(F.mark.endContainer,this.editNode).o,endOffset:F.mark.endOffset})}catch(J){F.mark=null}}return F},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:B.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var F=B.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:F,bookmark:this._getBookmark()})},onKeyDown:function(F){f("ie")||this.iframe||F.keyCode!=t.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var Q=
F.keyCode;if(F.ctrlKey&&!F.shiftKey&&!F.altKey){if(90==Q||122==Q){F.stopPropagation();F.preventDefault();this.undo();return}if(89==Q||121==Q){F.stopPropagation();F.preventDefault();this.redo();return}}this.inherited(arguments);switch(Q){case t.ENTER:case t.BACKSPACE:case t.DELETE:this.beginEditing();break;case 88:case 86:if(F.ctrlKey&&!F.altKey&&!F.metaKey){this.endEditing();88==F.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!F.ctrlKey&&!F.altKey&&
!F.metaKey&&(F.keyCode<t.F1||F.keyCode>t.F15)){this.beginEditing();break}case t.ALT:this.endEditing();break;case t.UP_ARROW:case t.DOWN_ARROW:case t.LEFT_ARROW:case t.RIGHT_ARROW:case t.HOME:case t.END:case t.PAGE_UP:case t.PAGE_DOWN:this.endEditing(!0);case t.CTRL:case t.SHIFT:case t.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(F){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(F){this.customUndo?this.isClosed?this.setValue(F):(this.beginEditing(),F||(F="\x26#160;"),this.setValue(F),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(F){this.setValueDeferred.then(h.hitch(this,function(){!this.disabled&&F||!this._buttonEnabledPlugins&&F?
C.forEach(this._plugins,function(Q){Q.set("disabled",!0)}):this.disabled&&!F&&C.forEach(this._plugins,function(Q){Q.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(x.set(this.document.body,"color",x.get(this.iframe,"color")),x.set(this.document.body,"background-color",x.get(this.iframe,"background-color")))}catch(F){}}});h.mixin(w.registry,{undo:z,redo:z,cut:z,copy:z,paste:z,insertOrderedList:z,insertUnorderedList:z,
indent:z,outdent:z,justifyCenter:z,justifyFull:z,justifyLeft:z,justifyRight:z,"delete":z,selectAll:z,removeFormat:z,unlink:z,insertHorizontalRule:z,bold:L,italic:L,underline:L,strikethrough:L,subscript:L,superscript:L,"|":function(){return new w({setEditor:function(F){this.editor=F;this.button=new m({ownerDocument:F.ownerDocument})}})}});return I})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(O,C,I,G,e,g,v,d){I("dijit-legacy-requires")&&e(0,function(){O(["dijit/ToolbarSeparator"])});return C("dijit.Toolbar",[g,d,v],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(O,C,I,G){return O("dijit.ToolbarSeparator",[I,G],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);C.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(O,C,I,G,e){C=C("dijit._editor._Plugin",G,{constructor:function(g){this.params=
g||{};I.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:e,disabled:!1,getLabel:function(g){return this.editor.commands[g]},_initButton:function(){if(this.command.length){var g=this.getLabel(this.command),v=this.editor,d=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(g=I.mixin({label:g,ownerDocument:v.ownerDocument,dir:v.dir,
lang:v.lang,showLabel:!1,iconClass:d,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete g.name,this.button=new this.buttonClass(g))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(g,v,d){this.own(O.connect(g,v,this,d))},updateState:function(){var g=this.editor,v=this.command;if(g&&g.isLoaded&&v.length){var d=this.get("disabled");if(this.button)try{var x=
g._implCommand(v);var t=!d&&(this[x]?this[x](v):g.queryCommandEnabled(v));this.enabled!==t&&(this.enabled=t,this.button.set("disabled",!t));if(t&&"boolean"==typeof this.button.checked){var h=g.queryCommandState(v);this.checked!==h&&(this.checked=h,this.button.set("checked",g.queryCommandState(v)))}}catch(f){console.log(f)}}},setEditor:function(g){this.editor=g;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",I.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",I.hitch(this,"updateState")))},setToolbar:function(g){this.button&&g.addChild(this.button)},set:function(g,v){if("object"===typeof g){for(var d in g)this.set(d,g[d]);return this}d=this._getAttrNames(g);if(this[d.s])var x=this[d.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(g,v);return x||this},get:function(g){var v=this._getAttrNames(g);
return this[v.g]?this[v.g]():this[g]},_setDisabledAttr:function(g){this._set("disabled",g);this.updateState()},_getAttrNames:function(g){var v=this._attrPairNames;if(v[g])return v[g];var d=g.charAt(0).toUpperCase()+g.substr(1);return v[g]={s:"_set"+d+"Attr",g:"_get"+d+"Attr"}},_set:function(g,v){this[g]=v}});C.registry={};return C})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h){return O("dijit._editor.plugins.EnterKeyHandling",x,{blockNodeForEnter:"BR",constructor:function(f){f&&("blockNodeForEnter"in f&&(f.blockNodeForEnter=f.blockNodeForEnter.toUpperCase()),G.mixin(this,f))},setEditor:function(f){if(this.editor!==f)if(this.editor=f,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,f.onLoadDeferred.then(G.hitch(this,function(a){this.own(e(f.document,"keydown",G.hitch(this,function(n){if(n.keyCode==I.ENTER){var p=G.mixin({},n);p.shiftKey=
!0;this.handleEnterKey(p)||(n.stopPropagation(),n.preventDefault())}})));9<=g("ie")&&10>=g("ie")&&this.own(e(f.document,"paste",G.hitch(this,function(n){setTimeout(G.hitch(this,function(){var p=this.editor.document.selection.createRange();p.move("character",-1);p.select();p.move("character",1);p.select()}),0)})));return a}));else if(this.blockNodeForEnter){var b=G.hitch(this,"handleEnterKey");f.addKeyHandler(13,0,0,b);f.addKeyHandler(13,0,1,b);this.own(this.editor.on("KeyPressed",G.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var f=this.editor.selection.getAncestorElement("LI");if(f){g("mozilla")&&"LI"==f.parentNode.parentNode.nodeName&&(f=f.parentNode.parentNode);var b=f.firstChild;!b||1!=b.nodeType||"UL"!=b.nodeName&&"OL"!=b.nodeName||(f.insertBefore(b.ownerDocument.createTextNode("\u00a0"),b),b=h.create(this.editor.window),b.setStart(f.firstChild,0),f=h.getSelection(this.editor.window,!0),f.removeAllRanges(),f.addRange(b))}else t.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(f=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(f.innerHTML=this.bogusHtmlContent,9>=g("ie")&&(f=this.editor.document.selection.createRange(),f.move("character",-1),f.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(f){var b,a=this.editor.document,n;if(f.shiftKey){f=this.editor.selection.getParentElement();if(b=h.getAncestor(f,this.blockNodes)){if("LI"==b.tagName)return!0;f=h.getSelection(this.editor.window);var p=f.getRangeAt(0);p.collapsed||(p.deleteContents(),f=h.getSelection(this.editor.window),p=f.getRangeAt(0));if(h.atBeginningOfContainer(b,p.startContainer,p.startOffset)){var m=a.createElement("br");p=h.create(this.editor.window);b.insertBefore(m,
b.firstChild);p.setStartAfter(m);f.removeAllRanges();f.addRange(p)}else if(h.atEndOfContainer(b,p.startContainer,p.startOffset))p=h.create(this.editor.window),m=a.createElement("br"),b.appendChild(m),b.appendChild(a.createTextNode("\u00a0")),p.setStart(b.lastChild,0),f.removeAllRanges(),f.addRange(p);else{if((n=p.startContainer)&&3==n.nodeType){var k=n.nodeValue;var A=a.createTextNode(k.substring(0,p.startOffset));var w=a.createTextNode(k.substring(p.startOffset));b=a.createElement("br");""==w.nodeValue&&
g("webkit")&&(w=a.createTextNode("\u00a0"));C.place(A,n,"after");C.place(b,A,"after");C.place(w,b,"after");C.destroy(n);p=h.create(this.editor.window);p.setStart(w,0);f.removeAllRanges();f.addRange(p);return!1}return!0}}else f=h.getSelection(this.editor.window),f.rangeCount?(p=f.getRangeAt(0))&&p.startContainer&&(p.collapsed||(p.deleteContents(),f=h.getSelection(this.editor.window),p=f.getRangeAt(0)),(n=p.startContainer)&&3==n.nodeType?(b=p.startOffset,n.length<b&&(w=this._adjustNodeAndOffset(n,b),
n=w.node,b=w.offset),k=n.nodeValue,A=a.createTextNode(k.substring(0,b)),w=a.createTextNode(k.substring(b)),b=a.createElement("br"),w.length||(w=a.createTextNode("\u00a0")),A.length?C.place(A,n,"after"):A=n,C.place(b,A,"after"),C.place(w,b,"after"),C.destroy(n)):(0<=p.startOffset&&(m=n.childNodes[p.startOffset]),b=a.createElement("br"),w=a.createTextNode("\u00a0"),m?(C.place(b,m,"before"),C.place(w,b,"after")):(n.appendChild(b),n.appendChild(w))),p=h.create(this.editor.window),p.setStart(w,0),p.setEnd(w,
w.length),f.removeAllRanges(),f.addRange(p),this.editor.selection.collapse(!0)):t.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var q=!0;f=h.getSelection(this.editor.window);p=f.getRangeAt(0);p.collapsed||(p.deleteContents(),f=h.getSelection(this.editor.window),p=f.getRangeAt(0));m=h.getBlockAncestor(p.endContainer,null,this.editor.editNode);var B=m.blockNode;if(this._checkListLater=B&&("LI"==B.nodeName||"LI"==B.parentNode.nodeName))return g("mozilla")&&(this._pressedEnterInBlock=
B),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(B.innerHTML)&&(B.innerHTML="",g("webkit")&&(p=h.create(this.editor.window),p.setStart(B,0),f.removeAllRanges(),f.addRange(p)),this._checkListLater=!1),!0;if(!m.blockNode||m.blockNode===this.editor.editNode){try{t.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(l){}m={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(m.blockNode){if(m.blockNode!=this.editor.editNode&&!(m.blockNode.textContent||m.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(m.blockNode),!1}else m.blockNode=this.editor.editNode;f=h.getSelection(this.editor.window);p=f.getRangeAt(0)}B=a.createElement(this.blockNodeForEnter);B.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(m.blockNode);w=p.endOffset;q=p.endContainer;q.length<w&&(w=this._adjustNodeAndOffset(q,w),q=
w.node,w=w.offset);if(h.atEndOfContainer(m.blockNode,q,w))m.blockNode===m.blockContainer?m.blockNode.appendChild(B):C.place(B,m.blockNode,"after"),q=!1,p=h.create(this.editor.window),p.setStart(B,0),f.removeAllRanges(),f.addRange(p),this.editor.height&&d.scrollIntoView(B);else if(h.atBeginningOfContainer(m.blockNode,p.startContainer,p.startOffset))C.place(B,m.blockNode,m.blockNode===m.blockContainer?"first":"before"),B.nextSibling&&this.editor.height&&(p=h.create(this.editor.window),p.setStart(B.nextSibling,
0),f.removeAllRanges(),f.addRange(p),d.scrollIntoView(B.nextSibling)),q=!1;else{m.blockNode===m.blockContainer?m.blockNode.appendChild(B):C.place(B,m.blockNode,"after");q=!1;m.blockNode.style&&B.style&&m.blockNode.style.cssText&&(B.style.cssText=m.blockNode.style.cssText);if((n=p.startContainer)&&3==n.nodeType){w=p.endOffset;n.length<w&&(w=this._adjustNodeAndOffset(n,w),n=w.node,w=w.offset);k=n.nodeValue;A=a.createTextNode(k.substring(0,w));w=a.createTextNode(k.substring(w,k.length));C.place(A,n,
"before");C.place(w,n,"after");C.destroy(n);for(p=A.parentNode;p!==m.blockNode;){k=a.createElement(p.tagName);p.style&&k.style&&p.style.cssText&&(k.style.cssText=p.style.cssText);"FONT"===p.tagName&&(p.color&&(k.color=p.color),p.face&&(k.face=p.face),p.size&&(k.size=p.size));for(;w;)n=w.nextSibling,k.appendChild(w),w=n;C.place(k,p,"after");A=p;w=k;p=p.parentNode}if(1==w.nodeType||3==w.nodeType&&w.nodeValue)B.innerHTML="";for(A=w;w;)n=w.nextSibling,B.appendChild(w),w=n}p=h.create(this.editor.window);
a=A;if("BR"!==this.blockNodeForEnter){for(;a;)b=a,a=n=a.firstChild;b&&b.parentNode?(B=b.parentNode,p.setStart(B,0),f.removeAllRanges(),f.addRange(p),this.editor.height&&d.scrollIntoView(B),g("mozilla")&&(this._pressedEnterInBlock=m.blockNode)):q=!0}else p.setStart(B,0),f.removeAllRanges(),f.addRange(p),this.editor.height&&d.scrollIntoView(B),g("mozilla")&&(this._pressedEnterInBlock=m.blockNode)}return q},_adjustNodeAndOffset:function(f,b){for(;f.length<b&&f.nextSibling&&3==f.nextSibling.nodeType;)b-=
f.length,f=f.nextSibling;return{node:f,offset:b}},removeTrailingBr:function(f){if(f=/P|DIV|LI/i.test(f.tagName)?f:this.editor.selection.getParentOfType(f,["P","DIV","LI"]))f.lastChild&&(1<f.childNodes.length&&3==f.lastChild.nodeType&&/^[\s\xAD]*$/.test(f.lastChild.nodeValue)||"BR"==f.lastChild.tagName)&&C.destroy(f.lastChild),f.childNodes.length||(f.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D,z,L,F,Q){var T=I("dijit._editor.RichText",[l,u],{constructor:function(E){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};E&&b.isString(E.value)&&(this.value=E.value);this.onLoadDeferred=new G},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[b.trim,b.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);m("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));m("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(m("ie")||m("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[b.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[b.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);A.publish(Q._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var E=b.hitch(this,function(P,R){return function(){return!this.execCommand(P,R)}}),M={b:E("bold"),i:E("italic"),u:E("underline"),a:E("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:E("formatblock",
"h1"),2:E("formatblock","h2"),3:E("formatblock","h3"),4:E("formatblock","h4"),"\\":E("insertunorderedlist")};m("ie")||(M.Z=E("redo"));for(var J in M)this.addKeyHandler(J,!0,!1,M[J])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(T._editorCommandsLocalized)this._local2NativeFormatNames=T._local2NativeFormatNames,this._native2LocalFormatNames=T._native2LocalFormatNames;else{T._editorCommandsLocalized=!0;T._local2NativeFormatNames={};
T._native2LocalFormatNames={};this._local2NativeFormatNames=T._local2NativeFormatNames;this._native2LocalFormatNames=T._native2LocalFormatNames;for(var E="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),M="",J,P=0;J=E[P++];)M="l"!==J.charAt(1)?M+("\x3c"+J+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+J+"\x3e\x3cbr/\x3e"):M+("\x3c"+J+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+J+"\x3e\x3cbr/\x3e");var R=d.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:M});this.ownerDocumentBody.appendChild(R);
E=b.hitch(this,function(){for(var Y=R.firstChild;Y;)try{this.selection.selectElement(Y.firstChild);var Z=Y.tagName.toLowerCase();this._local2NativeFormatNames[Z]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[Z]]=Z;Y=Y.nextSibling.nextSibling}catch(da){}d.destroy(R)});this.defer(E)}},open:function(E){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new G;this.isClosed||this.close();A.publish(Q._scopeName+"._editor.RichText::open",
this);1===arguments.length&&E.nodeName&&(this.domNode=E);var M=this.domNode;if(b.isString(this.value)){var J=this.value;M.innerHTML=""}else if(M.nodeName&&"textarea"==M.nodeName.toLowerCase()){var P=this.textarea=M;this.name=P.name;J=P.value;M=this.domNode=this.ownerDocument.createElement("div");M.setAttribute("widgetId",this.id);P.removeAttribute("widgetId");M.cssText=P.cssText;M.className+=" "+P.className;d.place(M,P,"before");var R=b.hitch(this,function(){t.set(P,{display:"block",position:"absolute",
top:"-1000px"});if(m("ie")){var N=P.style;this.__overflow=N.overflow;N.overflow="hidden"}});m("ie")?this.defer(R,10):R();if(P.form){var Y=P.value;this.reset=function(){this.getValue()!==Y&&this.replaceValue(Y)};a(P.form,"submit",b.hitch(this,function(){g.set(P,"disabled",this.disabled);P.value=this.getValue()}))}}else J=L.getChildrenHtml(M),M.innerHTML="";this.value=J;M.nodeName&&"LI"===M.nodeName&&(M.innerHTML=" \x3cbr\x3e");this.header=M.ownerDocument.createElement("div");M.appendChild(this.header);
this.editingArea=M.ownerDocument.createElement("div");M.appendChild(this.editingArea);this.footer=M.ownerDocument.createElement("div");M.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!C.useXDomain||C.allowXdRichTextSave)){if((J=e.byId(Q._scopeName+"._editor.RichText.value"))&&""!==J.value){R=J.value.split(this._SEPARATOR);for(var Z=0,da;da=R[Z++];)if(da=da.split(this._NAME_CONTENT_SEP),da[0]===this.name){this.value=da[1];R=R.splice(Z,1);J.value=R.join(this._SEPARATOR);
break}}T._globalSaveHandler||(T._globalSaveHandler={},w.addOnUnload(function(){for(var N in T._globalSaveHandler){var U=T._globalSaveHandler[N];b.isFunction(U)&&U()}}));T._globalSaveHandler[this.id]=b.hitch(this,"_saveContent")}this.isClosed=!1;J=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");J.id=this.id+"_iframe";J.style.border="none";J.style.width="100%";this._layoutMode?J.style.height="100%":7<=m("ie")?(this.height&&(J.style.height=this.height),this.minHeight&&(J.style.minHeight=
this.minHeight)):J.style.height=this.height?this.height:this.minHeight;J.frameBorder=0;J._loadFunc=b.hitch(this,function(N){this.window=N;this.document=N.document;this.selection=new D.SelectionManager(N);m("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});R=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");R=11>m("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+R+"');document.close()":"javascript: '"+
R+"'";this.editingArea.appendChild(J);J.src=R;"LI"===M.nodeName&&(M.lastChild.style.marginTop="-1.2em");v.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var E=t.getComputedStyle(this.domNode);if(this["aria-label"])var M=this["aria-label"];else{var J=n('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||e.byId(this["aria-labelledby"],this.ownerDocument);J&&(M=J.textContent||J.innerHTML||"")}J="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(M?" aria-label\x3d'"+k.escape(M)+"'":"")+"\x3e\x3c/div\x3e";var P=[E.fontWeight,E.fontSize,E.fontFamily].join(" "),R=E.lineHeight;R=0<=R.indexOf("px")?parseFloat(R)/parseFloat(E.fontSize):0<=R.indexOf("em")?parseFloat(R):"normal";var Y="",Z=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(da){da=da.replace(/^;/ig,"")+";";var N=da.split(":")[0];if(N){N=b.trim(N);N=N.toLowerCase();var U,ca="";for(U=0;U<N.length;U++){var ja=N.charAt(U);switch(ja){case "-":U++,ja=N.charAt(U).toUpperCase();
default:ca+=ja}}t.set(Z.domNode,ca,"")}Y+=da+";"});this.iframe.setAttribute("title",M);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||h.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",M?"\x3ctitle\x3e"+k.escape(M)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",P,";\n",this.height||m("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",R,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",m("ie")||m("trident")||m("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",M?" aria-label\x3d'"+k.escape(M)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+Y+"'\x3e",J,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var E=[];this.styleSheets&&(E=this.styleSheets.split(";"),this.styleSheets=
"");E=E.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var M="",J=0,P,R=B.get(this.ownerDocument);P=E[J++];)P=(new q(R.location,P)).toString(),this.editingAreaStyleSheets.push(P),M+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+P+'"/\x3e';return M},addStyleSheet:function(E){var M=E.toString(),J=B.get(this.ownerDocument);if("."===M.charAt(0)||"/"!==M.charAt(0)&&!E.host)M=(new q(J.location,M)).toString();-1<O.indexOf(this.editingAreaStyleSheets,M)||(this.editingAreaStyleSheets.push(M),
this.onLoadDeferred.then(b.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(M);else{var P=this.document.getElementsByTagName("head")[0],R=this.document.createElement("link");R.rel="stylesheet";R.type="text/css";R.href=M;P.appendChild(R)}})))},removeStyleSheet:function(E){var M=E.toString(),J=B.get(this.ownerDocument);if("."===M.charAt(0)||"/"!==M.charAt(0)&&!E.host)M=(new q(J.location,M)).toString();E=O.indexOf(this.editingAreaStyleSheets,M);-1!==E&&(delete this.editingAreaStyleSheets[E],
n('link[href\x3d"'+M+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(E){E=!!E;this._set("disabled",E);if(this.isLoaded){var M=m("ie")&&(this.isLoaded||!this.focusOnLoad);M&&(this.editNode.unselectable="on");this.editNode.contentEditable=!E;this.editNode.tabIndex=E?"-1":this.tabIndex;M&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(m("mozilla")&&!E&&this._mozSettingProps){E=this._mozSettingProps;for(var J in E)if(E.hasOwnProperty(J))try{this.document.execCommand(J,
!1,E[J])}catch(P){}}this._disabledOK=!0}},onLoad:function(E){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=F.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var M=this;this.beforeIframeNode=d.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=d.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){M.editNode.focus()};this.focusNode=
this.editNode;var J=this.events.concat(this.captureEvents),P=this.iframe?this.document:this.editNode;this.own.apply(this,O.map(J,function(R){var Y=R.toLowerCase().replace(/^on/,"");return a(P,Y,b.hitch(this,R))},this));this.own(a(P,"mouseup",b.hitch(this,"onClick")));m("ie")&&(this.own(a(this.document,"mousedown",b.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);m("webkit")&&(this._webkitListener=this.own(a(this.document,"mouseup",b.hitch(this,"onDisplayChanged")))[0],this.own(a(this.document,
"mousedown",b.hitch(this,function(R){R=R.target;!R||R!==this.document.body&&R!==this.document||this.defer("placeCursorAtEnd")}))));if(m("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(R){}this.isLoaded=!0;this.set("disabled",this.disabled);J=b.hitch(this,function(){this.setValue(E);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&p(b.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(J):J()},onKeyDown:function(E){if(E.keyCode===f.SHIFT||E.keyCode===f.ALT||E.keyCode===f.META||E.keyCode===f.CTRL)return!0;E.keyCode===f.TAB&&this.isTabIndent&&(E.stopPropagation(),E.preventDefault(),this.queryCommandEnabled(E.shiftKey?"outdent":"indent")&&this.execCommand(E.shiftKey?"outdent":"indent"));if(E.keyCode==f.TAB&&!this.isTabIndent&&!E.ctrlKey&&!E.altKey)return E.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>m("ie")&&E.keyCode===f.BACKSPACE&&"Control"===this.document.selection.type&&(E.stopPropagation(),E.preventDefault(),this.execCommand("delete"));m("ff")&&(E.keyCode===f.PAGE_UP||E.keyCode===f.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&E.preventDefault();var M=this._keyHandlers[E.keyCode],J=arguments;M&&!E.altKey&&O.some(M,function(P){if(!(P.shift^E.shiftKey||P.ctrl^(E.ctrlKey||E.metaKey)))return P.handler.apply(this,J)||E.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(E){h.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",E)},_setValueAttr:function(E){this.setValue(E)},_setDisableSpellCheckAttr:function(E){this.document?g.set(this.document.body,"spellcheck",!E):this.onLoadDeferred.then(b.hitch(this,function(){g.set(this.document.body,"spellcheck",!E)}));this._set("disableSpellCheck",E)},addKeyHandler:function(E,M,J,P){"string"==
typeof E&&(E=E.toUpperCase().charCodeAt(0));b.isArray(this._keyHandlers[E])||(this._keyHandlers[E]=[]);this._keyHandlers[E].push({shift:J||!1,ctrl:M||!1,handler:P})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(E){this.onDisplayChanged(E)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(E){(m("ie")||m("trident"))&&this.defer(function(){F.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var M=this.getValue(!0);if(M!==this.value)this.onChange(M);
this._set("value",M)},_onFocus:function(E){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!m("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>m("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(E,M){E=E.toLowerCase();"formatblock"===E?m("safari")&&void 0===M&&(E="heading"):"hilitecolor"!==E||m("mozilla")||(E="backcolor");return E},_implCommand:function(E){return"_"+this._normalizeCommand(E)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(E){var M=this._qcaCache[E];return void 0!==M?M:this._qcaCache[E]=this._queryCommandAvailable(E)},_queryCommandAvailable:function(E){switch(E.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return m("ie")||m("trident")||m("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!m("webkit");default:return!1}},execCommand:function(E,M){this.focused&&this.focus();E=this._normalizeCommand(E,M);if(void 0!==M){if("heading"===E)throw Error("unimplemented");"formatblock"===
E&&(m("ie")||m("trident"))&&(M="\x3c"+M+"\x3e")}var J="_"+E+"Impl";if(this[J])var P=this[J](M);else if((M=1<arguments.length?M:null)||"createlink"!==E)P=this.document.execCommand(E,!1,M);this.onDisplayChanged();return P},queryCommandEnabled:function(E){if(this.disabled||!this._disabledOK)return!1;E=this._normalizeCommand(E);var M=this._implCommand(E);return this[M]?this[M](E):this._browserQueryCommandEnabled(E)},queryCommandState:function(E){if(this.disabled||!this._disabledOK)return!1;E=this._normalizeCommand(E);
try{return this.document.queryCommandState(E)}catch(M){return!1}},queryCommandValue:function(E){if(this.disabled||!this._disabledOK)return!1;E=this._normalizeCommand(E);if(m("ie")&&"formatblock"===E)E=this._native2LocalFormatNames[this.document.queryCommandValue(E)];else if(m("mozilla")&&"hilitecolor"===E){try{var M=this.document.queryCommandValue("styleWithCSS")}catch(J){M=!1}this.document.execCommand("styleWithCSS",!1,!0);E=this.document.queryCommandValue(E);this.document.execCommand("styleWithCSS",
!1,M)}else E=this.document.queryCommandValue(E);return E},_sCall:function(E,M){return this.selection[E].apply(this.selection,M)},placeCursorAtStart:function(){this.focus();var E=!1;if(m("mozilla"))for(var M=this.editNode.firstChild;M;){if(3===M.nodeType){if(0<M.nodeValue.replace(/^\s+|\s+$/g,"").length){E=!0;this.selection.selectElement(M);break}}else if(1===M.nodeType){E=!0;var J=M.tagName?M.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(J)?this.selection.selectElement(M):
this.selection.selectElementChildren(M);break}M=M.nextSibling}else E=!0,this.selection.selectElementChildren(this.editNode);E&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var E=!1;if(m("mozilla"))for(var M=this.editNode.lastChild;M;){if(3===M.nodeType){if(0<M.nodeValue.replace(/^\s+|\s+$/g,"").length){E=!0;this.selection.selectElement(M);break}}else if(1===M.nodeType){E=!0;this.selection.selectElement(M.lastChild||M);break}M=M.previousSibling}else E=!0,this.selection.selectElementChildren(this.editNode);
E&&this.selection.collapse(!1)},getValue:function(E){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,E):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(E){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){E=this._preFilterContent(E);var M=this.isClosed?this.domNode:this.editNode;M.innerHTML=E;this._preDomFilterContent(M)}else this.textarea.value=E;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(b.hitch(this,function(){this.setValue(E)}))},replaceValue:function(E){this.isClosed?this.setValue(E):this.window&&this.window.getSelection&&!m("mozilla")?this.setValue(E):this.window&&this.window.getSelection?(E=this._preFilterContent(E),this.execCommand("selectall"),this.execCommand("inserthtml",E),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(E);this._set("value",this.getValue(!0))},_preFilterContent:function(E){var M=
E;O.forEach(this.contentPreFilters,function(J){J&&(M=J(M))});return M},_preDomFilterContent:function(E){E=E||this.editNode;O.forEach(this.contentDomPreFilters,function(M){M&&b.isFunction(M)&&M(E)},this)},_postFilterContent:function(E,M){if(b.isString(E))var J=E;else E=E||this.editNode,this.contentDomPostFilters.length&&(M&&(E=b.clone(E)),O.forEach(this.contentDomPostFilters,function(P){E=P(E)})),J=L.getChildrenHtml(E);b.trim(J.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(J="");O.forEach(this.contentPostFilters,
function(P){J=P(J)});return J},_saveContent:function(){var E=e.byId(Q._scopeName+"._editor.RichText.value");E&&(E.value&&(E.value+=this._SEPARATOR),E.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(E,M){E=E.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");M||(E=E.replace(/'/gm,"\x26#39;"));return E},getNodeHtml:function(E){h.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return L.getNodeHtml(E)},getNodeChildrenHtml:function(E){h.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return L.getChildrenHtml(E)},close:function(E){if(!this.isClosed){arguments.length||(E=!0);E&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);m("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var M=this.textarea.style;M.position="";M.left=M.top="";m("ie")&&(M.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;d.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;v.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);T._globalSaveHandler&&delete T._globalSaveHandler[this.id]},_removeMozBogus:function(E){return E.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(E){E=E.replace(/\sclass="webkit-block-placeholder"/gi,"");E=E.replace(/\sclass="apple-style-span"/gi,
"");return E=E.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(E){return E.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(E){return E.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(E){if(!E)return!1;
var M=9>m("ie")?this.document.selection.createRange():this.document;try{return M.queryCommandEnabled(E)}catch(J){return!1}},_createlinkEnabledImpl:function(){var E=!0;return E=m("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var E=!0;return E=m("mozilla")||m("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var E=
!0;return E=m("mozilla")||m("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var E=!0;m("webkit")?((E=this.window.getSelection())&&(E=E.toString()),E=!!E):E=this._browserQueryCommandEnabled("cut");return E},_copyEnabledImpl:function(){var E=!0;m("webkit")?((E=this.window.getSelection())&&(E=E.toString()),E=!!E):E=this._browserQueryCommandEnabled("copy");return E},_pasteEnabledImpl:function(){var E=!0;return m("webkit")?!0:E=this._browserQueryCommandEnabled("paste")},
_inserthorizontalruleImpl:function(E){return m("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,E)},_unlinkImpl:function(E){return this.queryCommandEnabled("unlink")&&(m("mozilla")||m("webkit"))?(E=this.selection.getAncestorElement("a"),this.selection.selectElement(E),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",!1,E)},_hilitecolorImpl:function(E){if(!this._handleTextColorOrProperties("hilitecolor",E))if(m("mozilla")){this.document.execCommand("styleWithCSS",
!1,!0);console.log("Executing color command.");var M=this.document.execCommand("hilitecolor",!1,E);this.document.execCommand("styleWithCSS",!1,!1)}else M=this.document.execCommand("hilitecolor",!1,E);return M},_backcolorImpl:function(E){m("ie")&&(E=E?E:null);var M=this._handleTextColorOrProperties("backcolor",E);M||(M=this.document.execCommand("backcolor",!1,E));return M},_forecolorImpl:function(E){m("ie")&&(E=E?E:null);var M=!1;(M=this._handleTextColorOrProperties("forecolor",E))||(M=this.document.execCommand("forecolor",
!1,E));return M},_inserthtmlImpl:function(E){E=this._preFilterContent(E);var M=!0;if(9>m("ie")){var J=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var P=J.item(0);J.length;)J.remove(J.item(0));P.outerHTML=E}else J.pasteHTML(E);J.select()}else if(8>m("trident")){var R=z.getSelection(this.window);if(R&&R.rangeCount&&R.getRangeAt){J=R.getRangeAt(0);J.deleteContents();var Y=d.create("div");Y.innerHTML=E;for(P=this.document.createDocumentFragment();E=
Y.firstChild;)var Z=P.appendChild(E);J.insertNode(P);Z&&(J=J.cloneRange(),J.setStartAfter(Z),J.collapse(!1),R.removeAllRanges(),R.addRange(J))}}else m("mozilla")&&!E.length?this.selection.remove():M=this.document.execCommand("inserthtml",!1,E);return M},_boldImpl:function(E){var M=!1;if(m("ie")||m("trident"))this._adaptIESelection(),M=this._adaptIEFormatAreaAndExec("bold");M||(M=this.document.execCommand("bold",!1,E));return M},_italicImpl:function(E){var M=!1;if(m("ie")||m("trident"))this._adaptIESelection(),
M=this._adaptIEFormatAreaAndExec("italic");M||(M=this.document.execCommand("italic",!1,E));return M},_underlineImpl:function(E){var M=!1;if(m("ie")||m("trident"))this._adaptIESelection(),M=this._adaptIEFormatAreaAndExec("underline");M||(M=this.document.execCommand("underline",!1,E));return M},_strikethroughImpl:function(E){var M=!1;if(m("ie")||m("trident"))this._adaptIESelection(),M=this._adaptIEFormatAreaAndExec("strikethrough");M||(M=this.document.execCommand("strikethrough",!1,E));return M},_superscriptImpl:function(E){var M=
!1;if(m("ie")||m("trident"))this._adaptIESelection(),M=this._adaptIEFormatAreaAndExec("superscript");M||(M=this.document.execCommand("superscript",!1,E));return M},_subscriptImpl:function(E){var M=!1;if(m("ie")||m("trident"))this._adaptIESelection(),M=this._adaptIEFormatAreaAndExec("subscript");M||(M=this.document.execCommand("subscript",!1,E));return M},_fontnameImpl:function(E){if(m("ie")||m("trident"))var M=this._handleTextColorOrProperties("fontname",E);M||(M=this.document.execCommand("fontname",
!1,E));return M},_fontsizeImpl:function(E){if(m("ie")||m("trident"))var M=this._handleTextColorOrProperties("fontsize",E);M||(M=this.document.execCommand("fontsize",!1,E));return M},_insertorderedlistImpl:function(E){var M=!1;if(m("ie")||m("trident")||m("edge"))M=this._adaptIEList("insertorderedlist",E);M||(M=this.document.execCommand("insertorderedlist",!1,E));return M},_insertunorderedlistImpl:function(E){var M=!1;if(m("ie")||m("trident")||m("edge"))M=this._adaptIEList("insertunorderedlist",E);
M||(M=this.document.execCommand("insertunorderedlist",!1,E));return M},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(E){var M=0;if(E&&E.childNodes){var J;for(J=0;J<E.childNodes.length;J++){var P=x.position(E.childNodes[J]);M+=P.h}}return M},_isNodeEmpty:function(E,M){return 1===E.nodeType?0<E.childNodes.length?this._isNodeEmpty(E.childNodes[0],M):!0:3===E.nodeType?
""===E.nodeValue.substring(M):!1},_removeStartingRangeFromRange:function(E,M){if(E.nextSibling)M.setStart(E.nextSibling,0);else{for(E=E.parentNode;E&&null==E.nextSibling;)E=E.parentNode;E&&M.setStart(E.nextSibling,0)}return M},_adaptIESelection:function(){var E=z.getSelection(this.window);if(E&&E.rangeCount&&!E.isCollapsed){for(var M=E.getRangeAt(0),J=M.startContainer,P=M.startOffset;3===J.nodeType&&P>=J.length&&J.nextSibling;)P-=J.length,J=J.nextSibling;for(var R=null;this._isNodeEmpty(J,P)&&J!==
R;)R=J,M=this._removeStartingRangeFromRange(J,M),J=M.startContainer,P=0;E.removeAllRanges();E.addRange(M)}},_adaptIEFormatAreaAndExec:function(E){var M=z.getSelection(this.window),J=this.document,P;if(E&&M&&M.isCollapsed){if(this.queryCommandValue(E)){E=this._tagNamesForCommand(E);var R=M.getRangeAt(0);var Y=R.startContainer;if(3===Y.nodeType){var Z=R.endOffset;Y.length<Z&&(Z=this._adjustNodeAndOffset(da,Z),Y=Z.node,Z=Z.offset)}for(;Y&&Y!==this.editNode;){var da=Y.tagName?Y.tagName.toLowerCase():
"";if(-1<O.indexOf(E,da)){var N=Y;break}Y=Y.parentNode}if(N&&(da=R.startContainer,E=J.createElement(N.tagName),d.place(E,N,"after"),da&&3===da.nodeType)){Z=R.endOffset;da.length<Z&&(Z=this._adjustNodeAndOffset(da,Z),da=Z.node,Z=Z.offset);Y=da.nodeValue;R=J.createTextNode(Y.substring(0,Z));var U=Y.substring(Z,Y.length);U&&(P=J.createTextNode(U));d.place(R,da,"before");if(P){var ca=J.createElement("span");ca.className="ieFormatBreakerSpan";d.place(ca,da,"after");d.place(P,ca,"after");P=ca}d.destroy(da);
Z=R.parentNode;for(da=[];Z!==N;){Y=Z.tagName;R={tagName:Y};da.push(R);Y=J.createElement(Y);Z.style&&Y.style&&Z.style.cssText&&(Y.style.cssText=Z.style.cssText,R.cssText=Z.style.cssText);"FONT"===Z.tagName&&(Z.color&&(Y.color=Z.color,R.color=Z.color),Z.face&&(Y.face=Z.face,R.face=Z.face),Z.size&&(Y.size=Z.size,R.size=Z.size));Z.className&&(Y.className=Z.className,R.className=Z.className);if(P)for(;P;)R=P.nextSibling,Y.appendChild(P),P=R;Y.tagName==Z.tagName?(ca=J.createElement("span"),ca.className=
"ieFormatBreakerSpan",d.place(ca,Z,"after"),d.place(Y,ca,"after")):d.place(Y,Z,"after");R=Z;P=Y;Z=Z.parentNode}if(P){if(1===P.nodeType||3===P.nodeType&&P.nodeValue)E.innerHTML="";for(;P;)R=P.nextSibling,E.appendChild(P),P=R}if(da.length){R=da.pop();P=J.createElement(R.tagName);R.cssText&&P.style&&(P.style.cssText=R.cssText);R.className&&(P.className=R.className);"FONT"===R.tagName&&(R.color&&(P.color=R.color),R.face&&(P.face=R.face),R.size&&(P.size=R.size));for(d.place(P,E,"before");da.length;)R=
da.pop(),N=J.createElement(R.tagName),R.cssText&&N.style&&(N.style.cssText=R.cssText),R.className&&(N.className=R.className),"FONT"===R.tagName&&(R.color&&(N.color=R.color),R.face&&(N.face=R.face),R.size&&(N.size=R.size)),P.appendChild(N),P=N;N=J.createTextNode(".");ca.appendChild(N);P.appendChild(N)}else ca=J.createElement("span"),ca.className="ieFormatBreakerSpan",N=J.createTextNode("."),ca.appendChild(N),d.place(ca,E,"before");P=z.create(this.window);P.setStart(N,0);P.setEnd(N,N.length);M.removeAllRanges();
M.addRange(P);this.selection.collapse(!1);N.parentNode.innerHTML="";E.firstChild||d.destroy(E);return!0}return!1}R=M.getRangeAt(0);if((da=R.startContainer)&&3===da.nodeType)return Z=R.startOffset,da.length<Z&&(Z=this._adjustNodeAndOffset(da,Z),da=Z.node,Z=Z.offset),Y=da.nodeValue,R=J.createTextNode(Y.substring(0,Z)),U=Y.substring(Z),""!==U&&(P=J.createTextNode(Y.substring(Z))),ca=J.createElement("span"),N=J.createTextNode("."),ca.appendChild(N),R.length?d.place(R,da,"after"):R=da,d.place(ca,R,"after"),
P&&d.place(P,ca,"after"),d.destroy(da),P=z.create(this.window),P.setStart(N,0),P.setEnd(N,N.length),M.removeAllRanges(),M.addRange(P),J.execCommand(E),d.place(ca.firstChild,ca,"before"),d.destroy(ca),P.setStart(N,0),P.setEnd(N,N.length),M.removeAllRanges(),M.addRange(P),this.selection.collapse(!1),N.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(E){var M=z.getSelection(this.window);if(M.isCollapsed&&M.rangeCount&&!this.queryCommandValue(E)){var J=M.getRangeAt(0),P=J.startContainer;
if(P&&3==P.nodeType&&!J.startOffset)return J="ul","insertorderedlist"===E&&(J="ol"),E=this.document.createElement(J),J=d.create("li",null,E),d.place(E,P,"before"),J.appendChild(P),d.create("br",null,E,"after"),E=z.create(this.window),E.setStart(P,0),E.setEnd(P,P.length),M.removeAllRanges(),M.addRange(E),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(E,M){var J=z.getSelection(this.window),P=this.document,R,Y;M=M||null;if(E&&J&&J.isCollapsed&&J.rangeCount){var Z=J.getRangeAt(0);
if((R=Z.startContainer)&&3===R.nodeType){var da=Z.startOffset;R.length<da&&(Z=this._adjustNodeAndOffset(R,da),R=Z.node,da=Z.offset);var N=R.nodeValue;Z=P.createTextNode(N.substring(0,da));""!==N.substring(da)&&(Y=P.createTextNode(N.substring(da)));N=P.createElement("span");da=P.createTextNode(".");N.appendChild(da);P=P.createElement("span");N.appendChild(P);Z.length?d.place(Z,R,"after"):Z=R;d.place(N,Z,"after");Y&&d.place(Y,N,"after");d.destroy(R);R=z.create(this.window);R.setStart(da,0);R.setEnd(da,
da.length);J.removeAllRanges();J.addRange(R);if(m("webkit")){J="color";if("hilitecolor"===E||"backcolor"===E)J="backgroundColor";t.set(N,J,M);this.selection.remove();d.destroy(P);N.innerHTML="\x26#160;";this.selection.selectElement(N);this.focus()}else this.execCommand(E,M),d.place(N.firstChild,N,"before"),d.destroy(N),R.setStart(da,0),R.setEnd(da,da.length),J.removeAllRanges(),J.addRange(R),this.selection.collapse(!1),da.parentNode.removeChild(da);return!0}}return!1},_adjustNodeAndOffset:function(E,
M){for(;E.length<M&&E.nextSibling&&3===E.nextSibling.nodeType;)M-=E.length,E=E.nextSibling;return{node:E,offset:M}},_tagNamesForCommand:function(E){return"bold"===E?["b","strong"]:"italic"===E?["i","em"]:"strikethrough"===E?["s","strike"]:"superscript"===E?["sup"]:"subscript"===E?["sub"]:"underline"===E?["u"]:[]},_stripBreakerNodes:function(E){if(this.isLoaded)return n(".ieFormatBreakerSpan",E).forEach(function(M){for(;M.firstChild;)d.place(M.firstChild,M,"before");d.destroy(M)}),E},_stripTrailingEmptyNodes:function(E){function M(J){return/^(p|div|br)$/i.test(J.nodeName)&&
0==J.children.length&&/^[\s\xA0]*$/.test(J.textContent||J.innerText||"")||3===J.nodeType&&/^[\s\xA0]*$/.test(J.nodeValue)}for(;E.lastChild&&M(E.lastChild);)d.destroy(E.lastChild);return E},_setTextDirAttr:function(E){this._set("textDir",E);this.onLoadDeferred.then(b.hitch(this,function(){this.editNode.dir=E}))}});return T})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(O,C,I){var G={getIndex:function(v,d){for(var x=[],t=[],h=v,f,b;v!=
d;){var a=0;for(f=v.parentNode;b=f.childNodes[a++];)if(b===v){--a;break}x.unshift(a);t.unshift(a-f.childNodes.length);v=f}if(0<x.length&&3==h.nodeType){for(b=h.previousSibling;b&&3==b.nodeType;)x[x.length-1]--,b=b.previousSibling;for(b=h.nextSibling;b&&3==b.nodeType;)t[t.length-1]++,b=b.nextSibling}return{o:x,r:t}},getNode:function(v,d){if(!I.isArray(v)||0==v.length)return d;var x=d;O.every(v,function(t){if(0<=t&&t<x.childNodes.length)x=x.childNodes[t];else return x=null,!1;return!0});return x},getCommonAncestor:function(v,
d,x){x=x||v.ownerDocument.body;var t=function(b){for(var a=[];b;)if(a.unshift(b),b!==x)b=b.parentNode;else break;return a};v=t(v);d=t(d);t=Math.min(v.length,d.length);for(var h=v[0],f=1;f<t;f++)if(v[f]===d[f])h=v[f];else break;return h},getAncestor:function(v,d,x){for(x=x||v.ownerDocument.body;v&&v!==x;){var t=v.nodeName.toUpperCase();if(d.test(t))return v;v=v.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(v,d,x){x=x||v.ownerDocument.body;
d=d||G.BlockTagNames;for(var t=null,h;v&&v!==x;){var f=v.nodeName.toUpperCase();!t&&d.test(f)&&(t=v);!h&&/^(?:BODY|TD|TH|CAPTION)$/.test(f)&&(h=v);v=v.parentNode}return{blockNode:t,blockContainer:h||v.ownerDocument.body}},atBeginningOfContainer:function(v,d,x){var t=!1,h=0==x;h||3!=d.nodeType||/^[\s\xA0]+$/.test(d.nodeValue.substr(0,x))&&(h=!0);if(h)for(t=!0;d&&d!==v;){if(d.previousSibling){t=!1;break}d=d.parentNode}return t},atEndOfContainer:function(v,d,x){var t=!1,h=x==(d.length||d.childNodes.length);
h||3!=d.nodeType||/^[\s\xA0]+$/.test(d.nodeValue.substr(x))&&(h=!0);if(h)for(t=!0;d&&d!==v;){if(d.nextSibling){t=!1;break}d=d.parentNode}return t},adjacentNoneTextNode:function(v,d){var x=v;v=0-v.length||0;for(d=d?"nextSibling":"previousSibling";x&&3==x.nodeType;)v+=x.length,x=x[d];return[x,v]},create:function(v){v=v||window;return v.getSelection?v.document.createRange():new g},getSelection:function(v,d){if(v.getSelection)return v.getSelection();v=new e.selection(v);d||v._getCurrentSelection();return v}};
if(!window.getSelection)var e=G.ie={cachedSelection:{},selection:function(v){this._ranges=[];this.addRange=function(d,x){this._ranges.push(d);x||d._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(d){return this._ranges[d]};this._getCurrentSelection=function(){this.removeAllRanges();var d=v.document.selection.createRange();d="CONTROL"==v.document.selection.type.toUpperCase()?new g(e.decomposeControlRange(d)):
new g(e.decomposeTextRange(d));this.addRange(d,!0),this.isCollapsed=d.collapsed}},decomposeControlRange:function(v){var d=v.item(0),x=v.item(v.length-1);v=d.parentNode;var t=x.parentNode;d=G.getIndex(d,v).o[0];x=G.getIndex(x,t).o[0]+1;return[v,d,t,x]},getEndPoint:function(v,d){var x=v.duplicate();x.collapse(!d);var t="EndTo"+(d?"End":"Start"),h=x.parentElement(),f;if(0<h.childNodes.length)O.every(h.childNodes,function(n,p){if(3!=n.nodeType)if(x.moveToElementText(n),0<x.compareEndPoints(t,v))if(f&&
3==f.nodeType){b=f;var m=!0}else return b=h,a=p,!1;else{if(p==h.childNodes.length-1)return b=h,a=h.childNodes.length,!1}else p==h.childNodes.length-1&&(b=n,m=!0);if(m&&b)return b=(n=G.adjacentNoneTextNode(b)[0])?n.nextSibling:h.firstChild,p=G.adjacentNoneTextNode(b),n=p[0],p=p[1],n?(x.moveToElementText(n),x.collapse(!1)):x.moveToElementText(h),x.setEndPoint(t,v),a=x.text.length-p,!1;f=n;return!0});else{var b=h;var a=0}d||1!=b.nodeType||a!=b.childNodes.length||(d=b.nextSibling)&&3==d.nodeType&&(b=
d,a=0);return[b,a]},setEndPoint:function(v,d,x){v=v.duplicate();var t;if(3!=d.nodeType)if(0<x){if(t=d.childNodes[x-1])if(3==t.nodeType)d=t,x=t.length;else if(t.nextSibling&&3==t.nextSibling.nodeType)d=t.nextSibling,x=0;else{v.moveToElementText(t.nextSibling?t:d);var h=t.parentNode;t=h.insertBefore(t.ownerDocument.createTextNode(" "),t.nextSibling);v.collapse(!1);h.removeChild(t)}}else v.moveToElementText(d),v.collapse(!0);3==d.nodeType&&(t=G.adjacentNoneTextNode(d),h=t[0],t=t[1],h?(v.moveToElementText(h),
v.collapse(!1),"inherit"!=h.contentEditable&&t++):(v.moveToElementText(d.parentNode),v.collapse(!0),v.move("character",1),v.move("character",-1)),x+=t,0<x&&v.move("character",x)!=x&&console.error("Error when moving!"));return v},decomposeTextRange:function(v){var d=e.getEndPoint(v),x=d[0],t=d[1],h=d[0];d=d[1];v.htmlText.length&&(v.htmlText==v.text?d=t+v.text.length:(d=e.getEndPoint(v,!0),h=d[0],d=d[1]));return[x,t,h,d]},setRange:function(v,d,x,t,h,f){d=e.setEndPoint(v,d,x);v.setEndPoint("StartToStart",
d);if(!f)var b=e.setEndPoint(v,t,h);v.setEndPoint("EndToEnd",b||d);return v}},g=G.W3CRange=C(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?G.getCommonAncestor(this.startContainer,
this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(v,d){d=parseInt(d);if(this.startContainer!==v||this.startOffset!=d)delete this._cachedBookmark,this.startContainer=v,this.startOffset=d,this.endContainer?this._updateInternal():this.setEnd(v,d)},setEnd:function(v,d){d=parseInt(d);if(this.endContainer!==v||this.endOffset!=d)delete this._cachedBookmark,this.endContainer=v,this.endOffset=d,this.startContainer?
this._updateInternal():this.setStart(v,d)},setStartAfter:function(v,d){this._setPoint("setStart",v,d,1)},setStartBefore:function(v,d){this._setPoint("setStart",v,d,0)},setEndAfter:function(v,d){this._setPoint("setEnd",v,d,1)},setEndBefore:function(v,d){this._setPoint("setEnd",v,d,0)},_setPoint:function(v,d,x,t){x=G.getIndex(d,d.parentNode).o;this[v](d.parentNode,x.pop()+t)},_getIERange:function(){var v=(this._body||this.endContainer.ownerDocument.body).createTextRange();e.setRange(v,this.startContainer,
this.startOffset,this.endContainer,this.endOffset,this.collapsed);return v},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var v=this.startContainer,d=this._getIERange();3!==v.nodeType||this.startOffset||this.setStartBefore(v);d.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var v=new g([this.startContainer,this.startOffset,
this.endContainer,this.endOffset]);v._body=this._body;return v},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});I.setObject("dijit.range",G);return G})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(O,C,I){var G={};C.setObject("dijit._editor.html",G);var e=G.escapeXml=function(g,v){g=g.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,
"\x26gt;").replace(/"/gm,"\x26quot;");v||(g=g.replace(/'/gm,"\x26#39;"));return g};G.getNodeHtml=function(g){var v=[];G.getNodeHtmlHelper(g,v);return v.join("")};G.getNodeHtmlHelper=function(g,v){switch(g.nodeType){case 1:var d=g.nodeName.toLowerCase();if(!d||"/"==d.charAt(0))return"";v.push("\x3c",d);var x=[],t={},h;if(I("dom-attributes-explicit")||I("dom-attributes-specified-flag"))for(var f=0;h=g.attributes[f++];){var b=h.name;"_dj"===b.substr(0,3)||I("dom-attributes-specified-flag")&&!h.specified||
b in t||(h=h.value,("src"==b||"href"==b)&&g.getAttribute("_djrealurl")&&(h=g.getAttribute("_djrealurl")),8===I("ie")&&"style"===b&&(h=h.replace("HEIGHT:","height:").replace("WIDTH:","width:")),x.push([b,h]),t[b]=h)}else{var a=(/^input$|^img$/i.test(g.nodeName)?g:g.cloneNode(!1)).outerHTML;t=a.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);a=a.substr(0,a.indexOf("\x3e"));O.forEach(t,function(n){if(n){var p=n.indexOf("\x3d");if(0<p&&(n=n.substring(0,p),"_dj"!=n.substr(0,3)))if("src"!=n&&"href"!=n||!g.getAttribute("_djrealurl")){switch(n){case "style":var m=
g.style.cssText.toLowerCase();break;case "class":m=g.className;break;case "width":if("img"===d){(p=/width=(\S+)/i.exec(a))&&(m=p[1]);break}case "height":if("img"===d){(p=/height=(\S+)/i.exec(a))&&(m=p[1]);break}default:m=g.getAttribute(n)}null!=m&&x.push([n,m.toString()])}else x.push([n,g.getAttribute("_djrealurl")])}},this)}x.sort(function(n,p){return n[0]<p[0]?-1:n[0]==p[0]?0:1});for(t=0;h=x[t++];)v.push(" ",h[0],'\x3d"',"string"===typeof h[1]?e(h[1],!0):h[1],'"');switch(d){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":v.push(" /\x3e");
break;case "script":v.push("\x3e",g.innerHTML,"\x3c/",d,"\x3e");break;default:v.push("\x3e"),g.hasChildNodes()&&G.getChildrenHtmlHelper(g,v),v.push("\x3c/",d,"\x3e")}break;case 4:case 3:v.push(e(g.nodeValue,!0));break;case 8:v.push("\x3c!--",e(g.nodeValue,!0),"--\x3e");break;default:v.push("\x3c!-- Element not recognized - Type: ",g.nodeType," Name: ",g.nodeName,"--\x3e")}};G.getChildrenHtml=function(g){var v=[];G.getChildrenHtmlHelper(g,v);return v.join("")};G.getChildrenHtmlHelper=function(g,v){if(g)for(var d=
g.childNodes||g,x=!I("ie")||d!==g,t,h=0;t=d[h++];)x&&t.parentNode!=g||G.getNodeHtmlHelper(t,v)};return G})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f,b){var a=I("dijit._editor.plugins.LinkDialog",h,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:f,useDefaultCommand:!1,
urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=g.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(p){O("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),g.hitch(this,function(m,k,A){var w=this;this.tag="insertImage"==this.command?"img":"a";m=g.delegate(m.getLocalization("dijit","common",this.lang),m.getLocalization("dijit._editor",
"LinkDialog",this.lang));var q=this.dropDown=this.button.dropDown=new k({title:m[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:g.hitch(this,"setValue"),onOpen:function(){w._onOpenDialog();k.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(g.hitch(w,"_onCloseDialog"),0)}});m.urlRegExp=this.urlRegExp;m.id=A.getUniqueId(this.editor.id);this._uniqueId=m.id;this._setContent(q.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
t.substitute(this.linkDialogTemplate,m));q.startup();this._urlInput=A.byId(this._uniqueId+"_urlInput");this._textInput=A.byId(this._uniqueId+"_textInput");this._setButton=A.byId(this._uniqueId+"_setButton");this.own(A.byId(this._uniqueId+"_cancelButton").on("click",g.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",g.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",g.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=g.hitch(this,function(){var B=this._urlInput.get("value");return this._urlRegExp.test(B)||this._emailRegExp.test(B)});this.own(v(q.domNode,"keydown",g.hitch(this,g.hitch(this,function(B){!B||B.keyCode!=e.ENTER||B.shiftKey||B.metaKey||B.ctrlKey||B.altKey||this._setButton.get("disabled")||(q.onExecute(),q.execute(q.get("value")))}))));p()}))},_checkAndFixInput:function(){var p=this,m=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var k=m,A=!1,w=!1;k&&1<k.length&&(k=g.trim(k),0!==k.indexOf("mailto:")&&(0<k.indexOf("/")?-1===k.indexOf("://")&&"/"!==k.charAt(0)&&k.indexOf("./")&&0!==k.indexOf("../")&&p._hostRxp.test(k)&&(A=!0):p._userAtRxp.test(k)&&(w=!0)));A&&p._urlInput.set("value","http://"+k);w&&p._urlInput.set("value","mailto:"+k);p._setButton.set("disabled",!p._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(g.hitch(this,
function(){this.own(v(this.editor.editNode,"mouseup",g.hitch(this,"_onMouseUp")));this.own(v(this.editor.editNode,"dblclick",g.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(p){this.dropDown.set({parserScope:"dojo",content:p})},_checkValues:function(p){p&&p.urlInput&&(p.urlInput=p.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&p&&p.textInput&&("function"===typeof this.linkFilter?p.textInput=this.linkFilter(p.textInput):
C.forEach(this.linkFilter,function(m){p.textInput=p.textInput.replace(m[0],m[1])}));return p},_createlinkEnabledImpl:function(){return!0},setValue:function(p){this._onCloseDialog();if(9>d("ie")){var m=b.getSelection(this.editor.window).getRangeAt(0).endContainer;3===m.nodeType&&(m=m.parentNode);m&&m.nodeName&&m.nodeName.toLowerCase()!==this.tag&&(m=this.editor.selection.getSelectedElement(this.tag));m&&m.nodeName&&m.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(m),
this.editor.execCommand("unlink"))}p=this._checkValues(p);this.editor.execCommand("inserthtml",t.substitute(this.htmlTemplate,p));x("a",this.editor.document).forEach(function(k){k.innerHTML||G.has(k,"name")||k.parentNode.removeChild(k)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(p){if(p&&p.tagName.toLowerCase()===this.tag){var m=p.getAttribute("_djrealurl")||p.getAttribute("href");var k=p.getAttribute("target")||"_self";var A=p.textContent||
p.innerText;this.editor.selection.selectElement(p,!0)}else A=this.editor.selection.getSelectedText();return{urlInput:m||"",textInput:A||"",targetSelect:k||""}},_onOpenDialog:function(){if(d("ie")){var p=b.getSelection(this.editor.window);if(p.rangeCount){var m=p.getRangeAt(0);var k=m.endContainer;3===k.nodeType&&(k=k.parentNode);k&&k.nodeName&&k.nodeName.toLowerCase()!==this.tag&&(k=this.editor.selection.getSelectedElement(this.tag));if(!k||k.nodeName&&k.nodeName.toLowerCase()!==this.tag)(p=this.editor.selection.getAncestorElement(this.tag))&&
p.nodeName&&p.nodeName.toLowerCase()==this.tag?(k=p,this.editor.selection.selectElement(k)):m.startContainer===m.endContainer&&(p=m.startContainer.firstChild)&&p.nodeName&&p.nodeName.toLowerCase()==this.tag&&(k=p,this.editor.selection.selectElement(k))}}else k=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(k))},_onDblClick:function(p){if(p&&p.target&&(p=p.target,(p.tagName?p.tagName.toLowerCase():
"")===this.tag&&G.get(p,"href"))){var m=this.editor;this.editor.selection.selectElement(p);m.onDisplayChanged();m._updateTimer&&(m._updateTimer.remove(),delete m._updateTimer);m.onNormalizedDisplayChanged();var k=this.button;setTimeout(function(){k.set("disabled",!1);k.loadAndOpenDropDown().then(function(){k.dropDown.focus&&k.dropDown.focus()})},10)}},_onMouseUp:function(){if(d("ff")){var p=this.editor.selection.getAncestorElement(this.tag);if(p){var m=b.getSelection(this.editor.window).getRangeAt(0);
if(m.collapsed&&p.childNodes.length){var k=m.cloneRange();k.selectNodeContents(p.childNodes[p.childNodes.length-1]);k.setStart(p.childNodes[0],0);1!==m.compareBoundaryPoints(k.START_TO_START,k)?m.setStartBefore(p):-1!==m.compareBoundaryPoints(k.END_TO_START,k)&&m.setStartAfter(p)}}}}}),n=I("dijit._editor.plugins.ImgLinkDialog",[a],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(p){if(p&&p.tagName.toLowerCase()===this.tag){var m=p.getAttribute("_djrealurl")||p.getAttribute("src");var k=p.getAttribute("alt");this.editor.selection.selectElement(p,!0)}else k=this.editor.selection.getSelectedText();return{urlInput:m||"",textInput:k||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(g.hitch(this,function(){this.own(v(this.editor.editNode,"mousedown",g.hitch(this,"_selectTag")))}))},_selectTag:function(p){p&&p.target&&(p=p.target,(p.tagName?p.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(p))},_checkValues:function(p){p&&p.urlInput&&(p.urlInput=p.urlInput.replace(/"/g,"\x26quot;"));p&&p.textInput&&(p.textInput=p.textInput.replace(/"/g,"\x26quot;"));return p},_onDblClick:function(p){if(p&&p.target&&(p=p.target,(p.tagName?
p.tagName.toLowerCase():"")===this.tag&&G.get(p,"src"))){var m=this.editor;this.editor.selection.selectElement(p);m.onDisplayChanged();m._updateTimer&&(m._updateTimer.remove(),delete m._updateTimer);m.onNormalizedDisplayChanged();var k=this.button;setTimeout(function(){k.set("disabled",!1);k.loadAndOpenDropDown().then(function(){k.dropDown.focus&&k.dropDown.focus()})},10)}}});h.registry.createLink=function(p){var m={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in p?p.allowUnsafeHtml:!1};
"linkFilter"in p&&(m.linkFilter=p.linkFilter);return new a(m)};h.registry.insertImage=function(){return new n({command:"insertImage"})};a.ImgLinkDialog=n;return a})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(O,C,I,G,e,g){var v=I("dijit._editor.plugins.TextColor",e,{buttonClass:g,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var d=this;this.button.loadDropDown=function(x){function t(h){d.button.dropDown=new h({dir:d.editor.dir,ownerDocument:d.editor.ownerDocument,value:d.value,onChange:function(f){d.editor.execCommand(d.command,f)},onExecute:function(){d.editor.execCommand(d.command,this.get("value"))}});x()}"string"==typeof d.colorPicker?O([d.colorPicker],t):t(d.colorPicker)}},updateState:function(){var d=this.editor,x=this.command;if(d&&d.isLoaded&&x.length){if(this.button){var t=this.get("disabled");
this.button.set("disabled",t);if(t)return;try{var h=d.queryCommandValue(x)||""}catch(f){h=""}}""==h&&(h="#000000");"transparent"==h&&(h="#ffffff");"string"==typeof h?-1<h.indexOf("rgb")&&(h=C.fromRgb(h).toHex()):(h=((h&255)<<16|h&65280|(h&16711680)>>>16).toString(16),h="#000000".slice(0,7-h.length)+h);this.value=h;(d=this.button.dropDown)&&d.get&&h!==d.get("value")&&d.set("value",h,!1)}}});e.registry.foreColor=function(d){return new v(d)};e.registry.hiliteColor=function(d){return new v(d)};return v})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m){O=O([t,h],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:p,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(k,A){C.mixin(this,m.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=I.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=I.connect(this._uploadField,"onfocus",C.hitch(this,function(k){n.hide(this._attachmentError)}))},destroy:function(){G.forEach(this._aeConnects,I.disconnect);I.disconnect(this._uploadField_connect);I.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(k,A){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";G.forEach(this.domNode.children,function(w,q){n.show(w)});n.hide(this._attachmentError);k&&(this._featureLayer=k.getLayer()||A)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:k}).canUpdate,this._oid=k.attributes[this._featureLayer.objectIdField],this._getAttachments(k)):A&&A.getEditCapabilities()||(n.hide(this._uploadForm),G.forEach(this.domNode.children,function(w,q){n.hide(w)})))},_getAttachments:function(k){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,C.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){n.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(n.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,C.hitch(this,"_onAddAttachmentComplete"),C.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(k,A){this._tempUpload&&(n.show(this._attachmentProgress),A.addAttachment(k,this._tempUpload,C.hitch(this,"_onAddAttachmentComplete"),C.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(k,
A){n.show(this._attachmentProgress);this._featureLayer.deleteAttachments(k,[A],C.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(k){var A=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(A=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(A=this._listHtml+this._endHtml);var w=this._attachmentList;k=G.map(k,C.hitch(this,function(q){return a.substitute({href:q.url,name:q.name,oid:q.objectId,attid:q.id},A)}));w.innerHTML=k.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(k){n.hide(this._attachmentProgress.domNode);var A=this._attachmentList,w=this._uploadField,q=w.value,B=q.lastIndexOf("\\");
-1<B&&(q=q.substring(B+1,q.length));q=q.replace(/ /g,"_");B=d.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var l=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(l=this._listHtml+this._endHtml);k=a.substitute({href:this._featureLayer._url.path+"/"+k.objectId+"/attachments/"+k.attachmentId+(B?"?"+B:""),name:q,oid:k.objectId,attid:k.attachmentId},
l);A.innerHTML=A.innerHTML==this.NLS_none?k:A.innerHTML+k;this._updateConnects();w.value=""},_onAddAttachmentError:function(k){n.hide(this._attachmentProgress.domNode);if(k){var A=this.NLS_error,w=this._attachmentError;a.isDefined(k.code)&&400===k.code&&(A=this.NLS_fileNotSupported);x.set(w,"innerHTML",A);n.show(w)}},_onDeleteAttachmentComplete:function(k){n.hide(this._attachmentProgress.domNode);var A=this._attachmentList;G.every(k,function(w){return w.success})&&(e.query("#node_"+k[0].objectId+
"_"+k[0].attachmentId).orphan(),A.children&&A.children.length||(A.innerHTML=this.NLS_none))},_updateConnects:function(){G.forEach(this._aeConnects,I.disconnect);e.query(".deleteAttachment").forEach(function(k){this._aeConnects.push(I.connect(k,"onclick",C.hitch(this,"_deleteAttachment",this._oid,k.id)))},this)}});g("extend-esri")&&C.setObject("dijit.editing.AttachmentEditor",O,b);return O})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(O,C,I,G,e,g,v,d){return C("dijit.ProgressBar",[g,v],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:d,_indeterminateHighContrastImagePath:O.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(x){var t="rtl"==x.toLowerCase();I.toggle(this.domNode,"dijitProgressBarRtl",t);I.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&t);this.inherited(arguments)},update:function(x){G.mixin(this,x||{});x=this.internalProgress;var t=this.domNode,h=1;this.indeterminate?t.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(h=Math.min(parseFloat(this.progress)/100,1),this.progress=h*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),h=this.maximum?this.progress/this.maximum:0),t.setAttribute("aria-valuenow",this.progress));t.setAttribute("aria-labelledby",this.labelNode.id);t.setAttribute("aria-valuemin",0);t.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(h);I.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);I.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());x.style.width=100*h+"%";this.onChange()},_setValueAttr:function(x){this._set("value",
x);Infinity==x?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:x})},_setLabelAttr:function(x){this._set("label",x);this.update()},_setIndeterminateAttr:function(x){this._set("indeterminate",x);this.update()},report:function(x){return this.label?this.label:this.indeterminate?"\x26#160;":e.format(x,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(O,C,I,G){var e={};e={findFeatures:function(g,v,d){var x=v.objectIdField;v=C.filter(v.graphics,function(t){return C.some(g,function(h){return t.attributes[x]===h.objectId})});if(d)d(v);else return v},getSelection:function(g){var v=[];C.forEach(g,function(d){d=d.getSelectedFeatures();C.forEach(d,function(x){v.push(x)})});return v},sortFeaturesById:function(g,v){var d=C.map(g,function(x){return x.featureLayer});v.sort(function(x,t){var h=x.getLayer(),f=t.getLayer();if(!h)return-1;if(!f)return 1;
var b=C.indexOf(d,h);f=C.indexOf(d,f);b-=f;b||(h=h.objectIdField,b=x.attributes[h]-t.attributes[h]);return b});return v}};I("extend-esri")&&O.setObject("dijit.editing.Util.LayerHelper",e,G);return e})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(O,C,I,G){var e=C.getObject("date.islamic",!0,O);e.getDaysInMonth=function(g){return g.getDaysInIslamicMonth(g.getMonth(),g.getFullYear())};e.compare=function(g,v,d){g instanceof G&&(g=g.toGregorian());
v instanceof G&&(v=v.toGregorian());return I.compare.apply(null,arguments)};e.add=function(g,v,d){var x=new G(g);switch(v){case "day":x.setDate(g.getDate()+d);break;case "weekday":var t=g.getDay();if(5>t+d&&0<t+d)x.setDate(g.getDate()+d);else{var h=v=0;5==t?(t=4,h=0<d?-1:1):6==t&&(t=4,h=0<d?-2:2);t=0<d?5-t-1:-t;var f=d-t,b=parseInt(f/5);0!=f%5&&(v=0<d?2:-2);v=v+7*b+f%5+t;x.setDate(g.getDate()+v+h)}break;case "year":x.setFullYear(g.getFullYear()+d);break;case "week":d*=7;x.setDate(g.getDate()+d);break;
case "month":g=g.getMonth();x.setMonth(g+d);break;case "hour":x.setHours(g.getHours()+d);break;case "minute":x._addMinutes(d);break;case "second":x._addSeconds(d);break;case "millisecond":x._addMilliseconds(d)}return x};e.difference=function(g,v,d){v=v||new G;d=d||"day";var x=v.getFullYear()-g.getFullYear(),t=1;switch(d){case "weekday":x=Math.round(e.difference(g,v,"day"));t=parseInt(e.difference(g,v,"week"));if(0==x%7)x=5*t;else{d=0;var h=g.getDay(),f=v.getDay();t=parseInt(x/7);v=x%7;g=new G(g);
g.setDate(g.getDate()+7*t);g=g.getDay();if(0<x)switch(!0){case 5==h:d=-1;break;case 6==h:d=0;break;case 5==f:d=-1;break;case 6==f:d=-2;break;case 5<g+v:d=-2}else if(0>x)switch(!0){case 5==h:d=0;break;case 6==h:d=1;break;case 5==f:d=2;break;case 6==f:d=1;break;case 0>g+v:d=2}x=x+d-2*t}t=x;break;case "year":t=x;break;case "month":d=v.toGregorian()>g.toGregorian()?v:g;h=v.toGregorian()>g.toGregorian()?g:v;t=d.getMonth();f=h.getMonth();if(0==x)t=d.getMonth()-h.getMonth();else for(t=12-f+t,x=h.getFullYear()+
1,d=d.getFullYear(),x;x<d;x++)t+=12;v.toGregorian()<g.toGregorian()&&(t=-t);break;case "week":t=parseInt(e.difference(g,v,"day")/7);break;case "day":t/=24;case "hour":t/=60;case "minute":t/=60;case "second":t/=1E3;case "millisecond":t*=v.toGregorian().getTime()-g.toGregorian().getTime()}return Math.round(t)};return e})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(O,C,I){var G=C("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var e=arguments.length;e?1==e?(e=arguments[0],"number"==typeof e&&(e=new Date(e)),e instanceof Date?this.fromGregorian(e):""==e?this._date=new Date(""):(this._year=e._year,this._month=e._month,this._date=e._date,this._hours=e._hours,this._minutes=e._minutes,this._seconds=e._seconds,this._milliseconds=e._milliseconds)):3<=e&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(e){e=parseInt(e);if(!(0<e&&e<=this.getDaysInIslamicMonth(this._month,this._year))){var g;if(0<e)for(g=this.getDaysInIslamicMonth(this._month,this._year);e>g;e-=g,g=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(g=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=e;g=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),e+=g}this._date=e;return this},setFullYear:function(e){this._year=+e},setMonth:function(e){this._year+=Math.floor(e/12);this._month=0<e?Math.floor(e%12):Math.floor((e%12+12)%12)},setHours:function(){var e=arguments.length,g=0;1<=e&&(g=parseInt(arguments[0]));2<=e&&(this._minutes=parseInt(arguments[1]));3<=e&&(this._seconds=parseInt(arguments[2]));4==e&&(this._milliseconds=parseInt(arguments[3]));for(;24<=g;)this._date++,e=this.getDaysInIslamicMonth(this._month,
this._year),this._date>e&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=e),g-=24;this._hours=g},_addMinutes:function(e){e+=this._minutes;this.setMinutes(e);this.setHours(this._hours+parseInt(e/60));return this},_addSeconds:function(e){e+=this._seconds;this.setSeconds(e);this._addMinutes(parseInt(e/60));return this},_addMilliseconds:function(e){e+=this._milliseconds;this.setMilliseconds(e);this._addSeconds(parseInt(e/1E3));return this},setMinutes:function(e){this._minutes=
e%60;return this},setSeconds:function(e){this._seconds=e%60;return this},setMilliseconds:function(e){this._milliseconds=e%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var e=new Date;e.setHours(this._hours);e.setMinutes(this._minutes);e.setSeconds(this._seconds);e.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+e.toTimeString()},toGregorian:function(){var e=this._year;e=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(e-1)+Math.floor((3+11*e)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var g=e-this._GREGORIAN_EPOCH,v=Math.floor(g/146097),d=this._mod(g,146097);g=Math.floor(d/36524);var x=this._mod(d,36524);d=Math.floor(x/1461);x=this._mod(x,1461);x=Math.floor(x/365);v=400*v+100*g+4*d+x;4!=g&&4!=x&&v++;g=e-(this._GREGORIAN_EPOCH+365*(v-1)+Math.floor((v-1)/4)-Math.floor((v-1)/100)+Math.floor((v-1)/400));d=this._GREGORIAN_EPOCH-1+365*(v-1)+Math.floor((v-1)/4)-Math.floor((v-1)/100)+Math.floor((v-1)/400)+Math.floor(739/12+(I.isLeapYear(new Date(v,
3,1))?-1:-2)+1);d=e<d?0:I.isLeapYear(new Date(v,3,1))?1:2;g=Math.floor((12*(g+d)+373)/367);d=this._GREGORIAN_EPOCH-1+365*(v-1)+Math.floor((v-1)/4)-Math.floor((v-1)/100)+Math.floor((v-1)/400)+Math.floor((367*g-362)/12+(2>=g?0:I.isLeapYear(new Date(v,g-1,1))?-1:-2)+1);return new Date(v,g-1,e-d+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(e){e=new Date(e);var g=e.getFullYear(),v=e.getMonth(),d=e.getDate();g=this._GREGORIAN_EPOCH-1+365*(g-1)+Math.floor((g-1)/4)+
-Math.floor((g-1)/100)+Math.floor((g-1)/400)+Math.floor((367*(v+1)-362)/12+(2>=v+1?0:I.isLeapYear(e)?-1:-2)+d);g=Math.floor(g)+.5;g-=this._ISLAMIC_EPOCH;v=Math.floor((30*g+10646)/10631);d=Math.ceil((g-29-this._yearStart(v))/29.5);d=Math.min(d,11);this._date=Math.ceil(g-this._monthStart(v,d))+1;this._month=d;this._year=v;this._hours=e.getHours();this._minutes=e.getMinutes();this._seconds=e.getSeconds();this._milliseconds=e.getMilliseconds();this._day=e.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(e){return 354*(e-1)+Math.floor((3+11*e)/30)},_monthStart:function(e,g){return Math.ceil(29.5*g)+354*(e-1)+Math.floor((3+11*e)/30)},_civilLeapYear:function(e){return 11>(14+11*e)%30},getDaysInIslamicMonth:function(e,g){var v=0;v=29+(e+1)%2;11==e&&this._civilLeapYear(g)&&v++;return v},_mod:function(e,g){return e-g*Math.floor(e/g)}});G.getDaysInIslamicMonth=function(e){return(new G).getDaysInIslamicMonth(e.getMonth(),e.getFullYear())};return G})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(O,C,I,G,e,g,v,d,x){function t(n,p,m,k,A){return A.replace(/([a-z])\1*/ig,function(w){var q=w.charAt(0);w=w.length;var B=["abbr","wide","narrow"];switch(q){case "G":var l=p.eraAbbr[0];break;case "y":l=String(n.getFullYear());break;case "M":l=n.getMonth();if(3>w){l+=1;var u=!0}else q=["months-format",B[w-3]].join("-"),l=p[q][l];break;case "d":l=n.getDate(!0);u=!0;break;case "E":l=n.getDay();3>w?(l+=1,u=!0):(q=["days-format",B[w-3]].join("-"),l=p[q][l]);break;case "a":l=12>n.getHours()?"am":
"pm";l=p["dayPeriods-format-wide-"+l];break;case "h":case "H":case "K":case "k":u=n.getHours();switch(q){case "h":l=u%12||12;break;case "H":l=u;break;case "K":l=u%12;break;case "k":l=u||24}u=!0;break;case "m":l=n.getMinutes();u=!0;break;case "s":l=n.getSeconds();u=!0;break;case "S":l=Math.round(n.getMilliseconds()*Math.pow(10,w-3));u=!0;break;case "z":if(l=G.getTimezoneName(n.toGregorian()))break;w=4;case "Z":l=n.toGregorian().getTimezoneOffset();l=[0>=l?"+":"-",v.pad(Math.floor(Math.abs(l)/60),2),
v.pad(Math.abs(l)%60,2)];4==w&&(l.splice(0,0,"GMT"),l.splice(3,0,":"));l=l.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+A);}u&&(l=v.pad(l,w));return l})}function h(n,p,m,k){var A=function(B){return B};p=p||A;m=m||A;k=k||A;var w=n.match(/(''|[^'])+/g),q="'"==n.charAt(0);I.forEach(w,function(B,l){B?(w[l]=(q?m:p)(B),q=!q):w[l]=""});return k(w.join(""))}function f(n,p,m,k){k=g.escapeString(k);e.normalizeLocale(m.locale);return k.replace(/([a-z])\1*/ig,
function(A){var w=A.charAt(0);var q=A.length,B="";m.strict?1<q&&(B="0{"+(q-1)+"}"):B="0?";switch(w){case "y":w="\\d+";break;case "M":w=2<q?"\\S+ ?\\S+":B+"[1-9]|1[0-2]";break;case "d":w="[12]\\d|"+B+"[1-9]|3[01]";break;case "E":w="\\S+";break;case "h":w=B+"[1-9]|1[0-2]";break;case "k":w=B+"\\d|1[01]";break;case "H":w=B+"\\d|1\\d|2[0-3]";break;case "K":w=B+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":w=B+"\\d|[0-5]\\d";break;case "S":w="\\d{"+q+"}";break;case "a":q=m.am||p["dayPeriods-format-wide-am"];
B=m.pm||p["dayPeriods-format-wide-pm"];m.strict?w=q+"|"+B:(w=q+"|"+B,q!=q.toLowerCase()&&(w+="|"+q.toLowerCase()),B!=B.toLowerCase()&&(w+="|"+B.toLowerCase()));break;default:w=".*"}n&&n.push(A);return"("+w+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var b=C.getObject("date.islamic.locale",!0,O);b.format=function(n,p){p=p||{};var m=e.normalizeLocale(p.locale),k=p.formatLength||"short",A=b._getIslamicBundle(m),w=[];m=C.hitch(this,t,n,A,m,p.fullYear);if("year"==p.selector)return n.getFullYear();"time"!=p.selector&&
(n=p.datePattern||A["dateFormat-"+k])&&w.push(h(n,m));"date"!=p.selector&&(p=p.timePattern||A["timeFormat-"+k])&&w.push(h(p,m));return w.join(" ")};b.regexp=function(n){return b._parseInfo(n).regexp};b._parseInfo=function(n){n=n||{};var p=e.normalizeLocale(n.locale);p=b._getIslamicBundle(p);var m=n.formatLength||"short",k=n.datePattern||p["dateFormat-"+m];m=n.timePattern||p["timeFormat-"+m];var A=[];return{regexp:h("date"==n.selector?k:"time"==n.selector?m:"undefined"==typeof m?k:k+" "+m,C.hitch(this,
f,A,p,n)),tokens:A,bundle:p}};b.parse=function(n,p){n=n.replace(/[\u200E\u200F\u202A\u202E]/g,"");p||(p={});var m=b._parseInfo(p),k=m.tokens,A=m.bundle;m=m.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");n=(new RegExp("^"+m+"$")).exec(n);e.normalizeLocale(p.locale);if(!n)return null;var w=[1389,0,1,0,0,0,0],q="",B=["abbr","wide","narrow"];I.every(n,function(l,u){if(!u)return!0;u=k[u-1];var D=u.length;switch(u.charAt(0)){case "y":w[0]=Number(l);break;case "M":if(2<D){if(u=A["months-format-"+B[D-3]].concat(),
p.strict||(l=l.replace(".","").toLowerCase(),u=I.map(u,function(L){return L?L.replace(".","").toLowerCase():L})),l=I.indexOf(u,l),-1==l)return!1}else l--;w[1]=Number(l);break;case "D":w[1]=0;case "d":w[2]=Number(l);break;case "a":u=p.am||A["dayPeriods-format-wide-am"];D=p.pm||A["dayPeriods-format-wide-pm"];if(!p.strict){var z=/\./g;l=l.replace(z,"").toLowerCase();u=u.replace(z,"").toLowerCase();D=D.replace(z,"").toLowerCase()}if(p.strict&&l!=u&&l!=D)return!1;q=l==D?"p":l==u?"a":"";break;case "K":24==
l&&(l=0);case "h":case "H":case "k":w[3]=Number(l);break;case "m":w[4]=Number(l);break;case "s":w[5]=Number(l);break;case "S":w[6]=Number(l)}return!0});n=+w[3];"p"===q&&12>n?w[3]=n+12:"a"===q&&12==n&&(w[3]=0);return new d(w[0],w[1],w[2],w[3],w[4],w[5],w[6])};var a=[];b.addCustomFormats=function(n,p){a.push({pkg:n,name:p})};b._getIslamicBundle=function(n){var p={};I.forEach(a,function(m){m=e.getLocalization(m.pkg,m.name,n);p=C.mixin(p,m)},this);return p};b.addCustomFormats("dojo.cldr","islamic");b.getNames=
function(n,p,m,k,A){k=b._getIslamicBundle(k);n=[n,m,p];if("standAlone"==m){m=n.join("-");var w=k[m];1==w[0]&&(w=void 0)}n[1]="format";return(w||k[n.join("-")]).concat()};b.weekDays=b.getNames("days","wide","format");b.months=b.getNames("months","wide","format");return b})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q){var B=C(b,{declaredClass:"esri.toolbars.Edit",constructor:function(l,u){this._map=l;this._tool=0;if(this._map.loaded)this._scratchGL=l.graphics;else var D=G.connect(this._map,"onLoad",this,function(){G.disconnect(D);D=null;this._scratchGL=this._map.graphics});l=v("esri-mobile");this._defaultOptions=I.mixin({vertexSymbol:new k(k.STYLE_CIRCLE,l?20:12,new A(A.STYLE_SOLID,new g([0,0,0,.5]),1),new g([128,128,128])),ghostVertexSymbol:new k(k.STYLE_CIRCLE,
l?18:10,new A(A.STYLE_SOLID,new g([0,0,0,.5]),1),new g([255,255,255,.75])),ghostLineSymbol:new A(A.STYLE_DOT,new g([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:l?24:16,boxLineSymbol:new A(A.STYLE_DASH,new g([64,64,64]),1),boxHandleSymbol:new k(k.STYLE_SQUARE,l?16:9,new A(A.STYLE_SOLID,new g([0,0,0,.5]),1),new g([255,255,255,.75])),textAnchorSymbol:new k(k.STYLE_CIRCLE,10,null,new g([255,0,0]))},u||{})},activate:function(l,u,D){this.deactivate();this._graphic=u;this._options=
I.mixin(I.mixin({},this._defaultOptions),D||{});var z=B.MOVE;D=B.EDIT_VERTICES;var L=B.SCALE,F=B.ROTATE,Q=B.EDIT_TEXT,T=!1,E=!1,M=!1,J=this._map,P=J.spatialReference,R=u.geometry.spatialReference;this._geo=!(!P||!R||P.equals(R)||!P.isWebMercator()||4326!==R.wkid);this._isTextPoint=this._prepareTextSymbolEditing(u,l);(l&z)===z&&(T=this._enableMove(u));z=(l&L)===L;F=(l&F)===F;if(z||F)M=this._enableBoxEditing(u,z,F);(l&D)===D&&(E=this._enableVertexEditing(u));(l&Q)===Q&&this._enableTextEditing(u);if(!(T||
E||M))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=l)this._mapPanEndHandle=G.connect(J,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=G.connect(J,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,u);J.snappingManager&&(T||E)&&J.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var l=this._tool,u=this._graphic;if(l){var D=
!!this._modified;this._clear();G.disconnect(this._mapPanEndHandle);G.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(l,u,{isModified:D});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(l,u){},onDeactivate:function(l,u,D){},
onGraphicMoveStart:function(l){},onGraphicFirstMove:function(l){this._modified=!0},onGraphicMove:function(l,u){},onGraphicMoveStop:function(l,u){},onGraphicClick:function(l,u){},onVertexMoveStart:function(l,u){},onVertexFirstMove:function(l,u){this._modified=!0},onVertexMove:function(l,u,D){},onVertexMoveStop:function(l,u,D){},onVertexAdd:function(l,u){this._modified=!0},onVertexClick:function(l,u){},onVertexMouseOver:function(l,u){},onVertexMouseOut:function(l,u){},onVertexDelete:function(l,u){this._modified=
!0},onTextEditStart:function(l,u){},onTextEditEnd:function(l){},onScaleStart:function(l){},onScaleFirstMove:function(l){this._modified=!0},onScale:function(l,u){},onScaleStop:function(l,u){},onRotateStart:function(l){},onRotateFirstMove:function(l){this._modified=!0},onRotate:function(l,u){},onRotateStop:function(l,u){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(l,u){if("point"===l.geometry.type||"multipoint"===l.geometry.type){var D=l.getLayer(),z=D.renderer;D=l.symbol||D._getSymbol(l);!D&&(z.hasVisualVariables("sizeInfo",!1)||z.hasVisualVariables("colorInfo",!1)||z.hasVisualVariables("opacityInfo",!1))&&z.addBreak&&
z.infos&&1===z.infos.length&&(D=z.infos[0].symbol||z.defaultSymbol);if(D&&"textsymbol"===D.type){if((u&B.SCALE)===B.SCALE||(u&B.ROTATE)===B.ROTATE||(u&B.EDIT_TEXT)===B.EDIT_TEXT){l.setSymbol(new w(D.toJson()));var L=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(l),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){L._boxEditor&&L._boxEditor.refresh()})):
O(["../dijit/SymbolEditor"],function(F){if(!L._textSymbolEditor){var Q=L._options.textSymbolEditorHolder?d.create("div",null,L._options.textSymbolEditorHolder):d.create("div",null,L._map.root);L._textSymbolEditor=new F({graphic:l},Q);F=L._textSymbolEditor.domNode.parentNode.id;x.set(L._textSymbolEditor.domNode,{position:"map_root"===F?"absolute":"relative",left:"map_root"===F?L._map.width/2-100+"px":"5px",top:"20px","z-index":50});L._textSymbolEditor.startup();L._textSymbolEditor.createForm(l);L._textSymbolEditor.show();
L._textSymbolEditor.on("symbol-change",function(){L._boxEditor&&L._boxEditor.refresh()})}})}if((u&B.MOVE)===B.MOVE||(u&B.ROTATE)===B.ROTATE||(u&B.SCALE)===B.SCALE)this._textAnchor=new q(l.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(l){var u=this._map;switch(l.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new n(l,u,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(l){var u=
this._map;switch(l.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=p.create(l,u,this),!0}return!1},_enableBoxEditing:function(l,u,D){var z=this._map,L=l.geometry.type;return"polyline"===L||"polygon"===L||this._isTextPoint?(this._boxEditor=new a(l,z,this,u,D,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(l){return this._isTextPoint?(this._textEditor=new m(l,this._map,this),G.connect(this._textEditor,"onEditStart",I.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var l=this._graphicMover;l&&(l.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var l=this._vertexEditor;l&&(l.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var l=this._boxEditor;l&&(l.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(l,u,D){D&&this._refreshMoveables()},_refreshMoveables:function(l){var u=e.filter([this._graphicMover,this._vertexEditor,this._boxEditor],h.isDefined);e.forEach(u,function(D){D.refresh(l)})},_beginOperation:function(l){e.forEach(this._getAffectedTools(l),function(u){u.suspend()})},_endOperation:function(l){e.forEach(this._getAffectedTools(l),function(u){u.resume()})},_getAffectedTools:function(l){var u=[];switch(l){case "MOVE":u=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":u=[this._boxEditor];break;case "BOX":u=[this._vertexEditor]}return u=e.filter(u,h.isDefined)}});I.mixin(B,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});v("extend-esri")&&I.setObject("toolbars.Edit",B,t);return B})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m){O=O(null,{declaredClass:"esri.toolbars._Box",constructor:function(k,A,w,q,B,l,u){this._graphic=k;this._map=A;this._toolbar=w;this._scale=q;this._rotate=B;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=l;k=w._options;this._markerSymbol=k.boxHandleSymbol;this._lineSymbol=k.boxLineSymbol;this._moveStartHandler=C.hitch(this,this._moveStartHandler);this._firstMoveHandler=C.hitch(this,this._firstMoveHandler);
this._moveStopHandler=C.hitch(this,this._moveStopHandler);this._moveHandler=C.hitch(this,this._moveHandler);this._isTextPoint=u;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){I.forEach(this._getAllGraphics(),function(k){k.hide()})},resume:function(){I.forEach(this._getAllGraphics(),function(k){k.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
I.forEach(this._connects,G.disconnect);var k=this._toolbar._scratchGL;this._anchors&&I.forEach(this._anchors,function(A){k.remove(A.graphic);(A=A.moveable)&&A.destroy()});this._box&&k.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var k=this._map,A=this._toolbar._scratchGL,w=this._getBoxCoords(),q=new b(k.spatialReference),B=C.clone(I.filter(w,function(l,u){return 8!==u&&0===u%2}));B[0]&&B.push([B[0][0],B[0][1]]);q.addPath(B);this._rotate&&
q.addPath([w[1],w[8]]);this._box?this._box.setGeometry(q):(this._box=new m(q,this._lineSymbol),A.add(this._box));this._anchors?I.forEach(this._anchors,function(l,u){this._scale||(u=8);var D=new f(w[u],k.spatialReference);l.graphic.setGeometry(D);D=l.moveable;var z=l.graphic.getDojoShape();z&&(D?z!==D.shape&&(D.destroy(),l.moveable=this._getMoveable(l.graphic,u)):l.moveable=this._getMoveable(l.graphic,u))},this):(this._anchors=[],this._connects=[],I.forEach(w,function(l,u){!this._scale&&8>u||(l=new f(l,
k.spatialReference),l=new m(l,this._markerSymbol),this._isTextPoint&&1===u%2&&l.hide(),A.add(l),this._anchors.push({graphic:l,moveable:this._getMoveable(l,u)}))},this))}else this._cleanUp()},_getBoxCoords:function(k){var A=this._map,w=[],q,B,l;if(this._isTextPoint){var u=this._graphic.getNode().getBoundingClientRect();var D=A.__container.getBoundingClientRect();u=[{x:u.left-D.left,y:u.top-D.top},{x:u.right-D.left,y:u.top-D.top},{x:u.right-D.left,y:u.bottom-D.top},{x:u.left-D.left,y:u.bottom-D.top}]}else u=
this._getTransformedBoundingBox(this._graphic);I.forEach(u,function(z,L,F){q=z;(B=F[L+1])||(B=F[0]);l={x:(q.x+B.x)/2,y:(q.y+B.y)/2};k||(q=A.toMap(q),l=A.toMap(l));w.push([q.x,q.y]);w.push([l.x,l.y])});this._rotate&&(u=C.clone(w[1]),u=k?{x:u[0],y:u[1]}:A.toScreen({x:u[0],y:u[1],spatialReference:A.spatialReference}),u.y-=this._toolbar._options.rotateHandleOffset,k||(u=A.toMap(u)),w.push([u.x,u.y]));return w},_getTransformedBoundingBox:function(k){var A=this._map,w=k.geometry.getExtent(),q=k.geometry.spatialReference;
k=new f(w.xmin,w.ymax,q);w=new f(w.xmax,w.ymin,q);k=A.toScreen(k);w=A.toScreen(w);return[{x:k.x,y:k.y},{x:w.x,y:k.y},{x:w.x,y:w.y},{x:k.x,y:w.y}]},_getAllGraphics:function(){var k=[this._box];this._anchors&&I.forEach(this._anchors,function(A){k.push(A.graphic)});return k=I.filter(k,h.isDefined)},_getMoveable:function(k,A){var w=k.getDojoShape();if(w)return k=new d(w),k._index=A,this._connects.push(G.connect(k,"onMoveStart",this._moveStartHandler)),this._connects.push(G.connect(k,"onFirstMove",this._firstMoveHandler)),
this._connects.push(G.connect(k,"onMoveStop",this._moveStopHandler)),k.onMove=this._moveHandler,(w=w.getEventSource())&&v.set(w,"cursor",this._toolbar._cursors["box"+A]),k},_moveStartHandler:function(k){this._toolbar["on"+(8===k.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(k){this._toolbar._deactivateScrollWheel();var A=k.host._index,w=this._wrapOffset=k.host.shape._wrapOffsets[0]||0,q=this._graphic.getLayer().getNavigationTransform();k=I.map(this._getBoxCoords(!0),
function(l){return{x:l[0]+w,y:l[1]}});var B=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:k[1].x,y:k[3].y};this._centerCoord=x.multiplyPoint(x.invert(q),B);if(8===A)B=x.multiplyPoint(x.invert(q),k[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,B)),this._startLine=[this._centerCoord,B],this._moveLine=C.clone(this._startLine);else if(B=x.multiplyPoint(x.invert(q),k[A]),q=x.multiplyPoint(x.invert(q),k[(A+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,B)),this._firstMoverToAnchor=Math.sqrt((B.x-this._centerCoord.x)*(B.x-this._centerCoord.x)+(B.y-this._centerCoord.y)*(B.y-this._centerCoord.y)),this._startBox=q,this._startBox.width=k[4].x-k[0].x,this._startBox.height=k[4].y-k[0].y,this._moveBox=C.clone(this._startBox),this._xfactor=B.x>q.x?1:-1,this._yfactor=B.y>q.y?1:-1,1===A||5===A)this._xfactor=0;else if(3===A||7===A)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===A?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(k,A){k=k.host._index;var w=this._defaultEventArgs;w.angle=0;w.scaleX=1;w.scaleY=1;if(8===k){var q=this._startLine;var B=this._moveLine;var l=B[1];l.x+=A.dx;l.y+=A.dy;A=this._getAngle(q,B);this._isTextPoint&&(A+=this._graphic.symbol.angle);B=x.rotategAt(A,q[0]);this._graphic.getDojoShape().setTransform(B);w.transform=B;w.angle=A;w.around=q[0]}else{q=this._startBox;B=this._moveBox;B.width+=A.dx*this._xfactor;B.height+=A.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(q=B.x+this._xfactor*B.width,B=B.y+this._yfactor*B.height,q=Math.sqrt((q-this._centerCoord.x)*(q-this._centerCoord.x)+(B-this._centerCoord.y)*(B-this._centerCoord.y)),this._scaleRatio=A=l=q/this._firstMoverToAnchor,q=this._centerCoord):(A=B.width/q.width,l=B.height/q.height,q={x:q.x,y:q.y});if(isNaN(A)||Infinity===A||-Infinity===A)A=1;if(isNaN(l)||Infinity===l||-Infinity===l)l=1;B=x.scaleAt(A,l,q);if(this._isTextPoint){var u=x.rotategAt(this._graphic.symbol.angle,
q);this._graphic.getDojoShape().setTransform([u,B])}else this._graphic.getDojoShape().setTransform(B);w.transform=B;w.scaleX=A;w.scaleY=l;w.around=q}this._toolbar["on"+(8===k?this._rotateEvent:this._scaleEvent)](this._graphic,w)},_moveStopHandler:function(k){this._toolbar._activateScrollWheel();var A=this._graphic,w=this._toolbar,q=w._geo?n.geographicToWebMercator(A.geometry):A.geometry,B=q.spatialReference,l=A.getDojoShape(),u=l.getTransform(),D=A.getLayer().getNavigationTransform();this._isTextPoint?
(A=this._graphic.symbol,8===k.host._index?A.angle+=this._getAngle(this._startLine,this._moveLine):A.font.setSize(Math.round(A.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(A)):(q=q.toJson(),this._updateSegments(q.paths||q.rings,u,D,B),l.setTransform(null),q=p.fromJson(q),A.setGeometry(w._geo?n.webMercatorToGeographic(q,!0):q));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;w._endOperation("BOX");this._defaultEventArgs.transform=
u;w["on"+(8===k.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(k,A,w,q){var B=this._map,l=this._wrapOffset||0;I.forEach(k,function(u){I.forEach(u,function(D){this._updatePoint(D,q,l,x,B,w,A)},this)},this)},_updatePoint:function(k,A,w,q,B,l,u){A=B.toScreen({x:k[0],y:k[1],spatialReference:A},!0);A.x+=w;A=q.multiplyPoint([l,u,q.invert(l)],A);A.x-=w;w=B.toMap(A);k[0]=w.x;k[1]=w.y},_getAngle:function(k,A){return 180*Math.atan2(A[0].y-
A[1].y,A[0].x-A[1].x)/Math.PI-180*Math.atan2(k[0].y-k[1].y,k[0].x-k[1].x)/Math.PI},_deNormalizePoint:function(k,A){var w=this._map._getFrameWidth();if(-1===w)return k;for(k={x:k.x,y:k.y};Math.abs(k.x-A.x)>=w;)k.x=k.x<A.x?k.x+w:k.x-w;var q=Math.abs(k.x-A.x);Math.abs(k.x-A.x+w)<q?k.x+=w:Math.abs(k.x-A.x-w)<q&&(k.x-=w);return k}});g("extend-esri")&&C.setObject("toolbars._Box",O,t);return O})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(O,C,I,G,e,g,v,d,x,t){return C("dojox.gfx.Moveable",null,{constructor:function(h,f){this.shape=h;this.delay=f&&0<f.delay?f.delay:0;this.mover=f&&f.mover?f.mover:x;this.leftButtonOnly=f&&f.leftButtonOnly;this.events=[this.shape.on(g.press,O.hitch(this,"onMouseDown"))]},destroy:function(){I.forEach(this.events,function(h){h.remove()});this.events=this.shape=null},onMouseDown:function(h){this.delay?(this.events.push(this.shape.on(g.move,O.hitch(this,"onMouseMove")),this.shape.on(g.release,O.hitch(this,
"onMouseUp"))),this._lastX=h.clientX,this._lastY=h.clientY):this.leftButtonOnly&&!t.isLeft(h)||new this.mover(this.shape,h,this);G.stop(h)},onMouseMove:function(h){var f=h.clientY;if(Math.abs(h.clientX-this._lastX)>this.delay||Math.abs(f-this._lastY)>this.delay)this.onMouseUp(h),new this.mover(this.shape,h,this);G.stop(h)},onMouseUp:function(h){this.events.pop().remove()},onMoveStart:function(h){e.publish("/gfx/move/start",h);v.add(d.body(),"dojoMove")},onMoveStop:function(h){e.publish("/gfx/move/stop",
h);v.remove(d.body(),"dojoMove")},onFirstMove:function(h){},onMove:function(h,f,b){this.onMoving(h,f,b);this.shape.applyLeftTransform(f);this.onMoved(h,f)},onMoving:function(h,f){},onMoved:function(h,f){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(O,C,I,G,e,g){return I("dojox.gfx.Mover",null,{constructor:function(v,d,x){this.shape=v;this.lastX=d.clientX;this.lastY=d.clientY;v=this.host=x;d=
document;x=G(d,e.move,O.hitch(this,"onFirstMove"));this.events=[G(d,e.move,O.hitch(this,"onMouseMove")),G(d,e.release,O.hitch(this,"destroy")),G(d,"dragstart",O.hitch(g,"stop")),G(d,"selectstart",O.hitch(g,"stop")),x];if(v&&v.onMoveStart)v.onMoveStart(this)},onMouseMove:function(v){var d=v.clientX,x=v.clientY;this.host.onMove(this,{dx:d-this.lastX,dy:x-this.lastY},v);this.lastX=d;this.lastY=x;g.stop(v)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){C.forEach(this.events,
function(d){d.remove()});var v=this.host;if(v&&v.onMoveStop)v.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f,b,a){var n=O(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(p,m,k,A){this.graphic=p;this.map=m;this.toolbar=k;this.tempPt=A;this._enableGraphicMover();this._moved=!1},refresh:function(p){var m=this.graphic.getDojoShape();!m||!p&&m._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var p=this.graphic,m=p.getDojoShape();m&&(m._hostGraphic=p,this._moveable=new g(m,{mover:n.Mover}),this._moveStartHandle=
I.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=I.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=I.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=I.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(p=m.getEventSource())&&e.set(p,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var p=this._moveable;if(p){I.disconnect(this._moveStartHandle);I.disconnect(this._firstMoveHandle);
I.disconnect(this._movingHandle);I.disconnect(this._moveStopHandle);var m=p.shape;m&&(m._hostGraphic=null,(m=m.getEventSource())&&e.set(m,"cursor","inherit"));p.destroy()}this._moveable=null},_moveStartHandler:function(){var p=this.graphic,m=this.map;this._startTx=p.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&m.snappingManager&&m.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(p)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(p,m,k){p=p.shape.getTransform();m=this.map;var A;h("esri-pointer")?A=m.navigationManager.pointerEvents._processTouchEvent(k,k):k&&"pointermove"===k.type&&(A=t.prototype._processTouchEvent.call({map:m},k,k));A&&m.snappingManager&&m.snappingManager._onSnappingMouseMoveHandler(A);this.tempPt&&this.tempPt.getDojoShape().setTransform(p);this.toolbar.onGraphicMove(this.graphic,p)},_moveStopHandler:function(p){var m=this.graphic,k=this.toolbar,A=this.map,w=k._geo?f.geographicToWebMercator(m.geometry):
m.geometry,q=w.type,B=m.getDojoShape(),l=B.getTransform();if(G.toJson(l)!==G.toJson(this._startTx)){this._moved=!0;switch(q){case "point":q=[l,d.invert(this._startTx)];if(A.snappingManager)var u=A.snappingManager._snappingPoint;w=u||A.toMap(d.multiplyPoint(q,A.toScreen(w,!0)));A.snappingManager&&A.snappingManager._killOffSnapping();break;case "polyline":w=this._updatePolyGeometry(w,w.paths,l);break;case "polygon":w=this._updatePolyGeometry(w,w.rings,l)}B.setTransform(null);m.setGeometry(k._geo?f.webMercatorToGeographic(w,
!0):w);this.tempPt&&this.tempPt.setGeometry(new a(m.geometry.toJson()))}else this._moved=!1;k._endOperation("MOVE");k.onGraphicMoveStop(m,l);this._moved||(p=p.__e,A=this.map.position,p=new b(p.pageX-A.x,p.pageY-A.y),k.onGraphicClick(m,{screenPoint:p,mapPoint:this.map.toMap(p)}))},_updatePolyGeometry:function(p,m,k){var A=this.map,w=p.getPoint(0,0);A=A.toMap(A.toScreen(w).offset(k.dx,k.dy));k=A.x-w.x;w=A.y-w.y;var q;for(A=0;A<m.length;A++){var B=m[A];for(q=0;q<B.length;q++){var l=p.getPoint(A,q);p.setPoint(A,
q,l.offset(k,w))}}return p}});n.Mover=O(v,{declaredClass:"esri.toolbars._Mover",constructor:function(p,m,k){this.__e=m}});h("extend-esri")&&(C.setObject("toolbars._GraphicMover",n,x),C.setObject("toolbars._Mover",n.Mover,x));return n})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(O,
C,I,G,e,g,v,d,x,t,h,f){var b=O(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,n,p){this.graphic=a;this.map=n;this.toolbar=p;a=p._options;this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;n=a.ghostLineSymbol;this._lineStroke={style:n.style,width:n.width,color:n.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=I.connect(x,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=I.connect(x,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=I.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=I.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new g({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new v({label:f.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
I.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){I.disconnect(this._firstMoveHandle);I.disconnect(this._moveStopHandle);I.disconnect(this._mouseOverHandle);I.disconnect(this._mouseOutHandle);I.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(a,n,p){var m,k,A=this.graphic,w=[];for(m=0;m<a.length;m++){var q=a[m],B=[];for(k=0;k<q.length;k++)B.push(new x(q[k],n,A,m,k,q.length,this,p));w.push(B)}return w},_remove:function(a){a&&G.forEach(a,function(n){G.forEach(n,function(p){p.destroy()})})},_refresh:function(a){a&&G.forEach(a,function(n){G.forEach(n,function(p){p.refresh()})})},_isNew:function(a){return-1===G.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var n=this._findMover(a);n&&(this.toolbar.onVertexMouseOver(this.graphic,n._getInfo()),n._placeholder||(this._selectedMover=n,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=
this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var n=[];var p=this._mpVertexMovers;G.forEach(this._vertexMovers,function(k){n=n.concat(k)});p&&G.forEach(p,function(k){n=n.concat(k)});
for(p=0;p<n.length;p++){var m=n[p];if(m.graphic===a)return m}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(a,n){var p=this._isNew(a);n&&(n.dx||n.dy)?(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,p),this._canAdd&&(p?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES")):
!p&&this._canAdd&&this._showRelatedMidpoints(a)},_showRelatedMidpoints:function(a){var n=this._getAdjacentMidpoints(a.ptIndex,a.segLength),p=this._mpVertexMovers[a.segIndex];for(a=0;a<n.length;a++){var m=p[n[a]];m.graphic.show();m.refresh()}},_hideRelatedMidpoints:function(a){var n=this._getAdjacentMidpoints(a.ptIndex,a.segLength),p=this._mpVertexMovers[a.segIndex];for(a=0;a<n.length;a++)p[n[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var n,p=this._getAdjacentMidpoints(a.ptIndex,a.segLength),
m=this._mpVertexMovers[a.segIndex];for(n=0;n<p.length;n++){var k=this._getAdjacentVertices(p[n],a.segLength),A=a.relatedGraphic.geometry.getPoint(a.segIndex,k[0]);k=a.relatedGraphic.geometry.getPoint(a.segIndex,k[1]);A=new t({x:(A.x+k.x)/2,y:(A.y+k.y)/2,spatialReference:A.spatialReference.toJson()});m[p[n]].graphic.setGeometry(A)}},_addMidpoints:function(a){var n=a.segIndex,p=a.ptIndex,m=a.segLength,k=p+1,A,w=m+1;this._mpVertexMovers[n].splice(p,1);var q=this._vertexMovers[n];for(A=0;A<k;A++)q[A].segLength+=
1;for(A=k;A<q.length;A++)q[A].ptIndex+=1,q[A].segLength+=1;a.ptIndex=k;a.segLength=q.length+1;q.splice(k,0,a);a.graphic.setSymbol(this._symbol1);q=this._mpVertexMovers[n];for(A=0;A<p;A++)q[A].segLength+=1;for(A=p;A<m-1;A++)q[A].ptIndex+=1,q[A].segLength+=1;k=this._getAdjacentVertices(p,w);n=this._getAdjacentVertices(p+1,w);m=a.relatedGraphic.geometry.getPoint(a.segIndex,k[0]);A=a.relatedGraphic.geometry.getPoint(a.segIndex,k[1]);k=new t({x:(m.x+A.x)/2,y:(m.y+A.y)/2,spatialReference:m.spatialReference.toJson()});
m=a.relatedGraphic.geometry.getPoint(a.segIndex,n[0]);A=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);n=new t({x:(m.x+A.x)/2,y:(m.y+A.y)/2,spatialReference:m.spatialReference.toJson()});m=new x(k,this._symbol2,this.graphic,a.segIndex,p,w,this,!0);a=new x(n,this._symbol2,this.graphic,a.segIndex,p+1,w,this,!0);q.splice(p,0,m,a)},_deleteVertex:function(a){var n,p=a.ptIndex,m=this._vertexMovers[a.segIndex];for(n=0;n<p;n++)--m[n].segLength;for(n=p+1;n<m.length;n++){var k=m[n];--k.ptIndex;--k.segLength}m.splice(p,
1);n=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,n)}});C.mixin(b,{create:function(a,n,p){switch(a.geometry.type){case "multipoint":return new b.MultipointVertexEditor(a,n,p);case "polyline":return new b.PolylineVertexEditor(a,n,p);case "polygon":return new b.PolygonVertexEditor(a,n,p)}}});b.MultipointVertexEditor=O(b,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=I.connect(x,"onMoveStart",this,this._moveStartHandler);
I.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);I.disconnect(this._moveStartHandle)},_getSegments:function(a){var n=a.points,p=[],m=a.spatialReference;for(a=0;a<n.length;a++){var k=n[a];p.push(new t({x:k[0],y:k[1],spatialReference:m.toJson()}))}return[p]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,n,p,m,k){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var n=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(n,
a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var n=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(n,a._getInfo())},_findMover:function(a){var n=[].concat(this._vertexMovers[0]),p=a.target;for(a=0;a<n.length;a++){var m=n[a];if(m.graphic.getDojoShape().getNode()===p)return m}},_moveStartHandler:function(a){var n=a.ptIndex,p=a.segLength-1,m=a.relatedGraphic.geometry.points;a=m.splice(n,1);m.push(a[0]);
m=this._vertexMovers[0];for(a=p;a>n;a--)--m[a].ptIndex;a=m.splice(n,1);m.push(a[0]);a[0].ptIndex=p},_moveStopHandler:function(a){this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,n,p,m,k,A,w,q){a=n.geometry;q?a.removePoint(k):a.setPoint(k,p);n.setGeometry(a)},_deleteMidpoints:function(a){}});b.PolylineVertexEditor=O(b,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(a){var n,p,m=a.paths,k=[];for(n=0;n<m.length;n++){var A=m[n],w=[];for(p=0;p<A.length;p++)w.push(a.getPoint(n,p));k.push(w)}return k},_getMidpointSegments:function(a){var n,p,m=a.paths,k=[],A=a.spatialReference;for(n=0;n<m.length;n++){var w=m[n],q=[];for(p=0;p<w.length-1;p++){var B=a.getPoint(n,p),l=a.getPoint(n,p+1);B=new t({x:(B.x+l.x)/2,y:(B.y+l.y)/2,spatialReference:A.toJson()});q.push(B)}k.push(q)}return k},_getControlPoints:function(a,n,p,m,k){var A=this.map,w,q;this._isNew(a)?
(a=m,m+=1,0<=a&&(w=A.toScreen(n.getPoint(p,a))),m<=k&&(q=A.toScreen(n.getPoint(p,m)))):(a=m-1,m+=1,0<=a&&(w=A.toScreen(n.getPoint(p,a))),m<k&&(q=A.toScreen(n.getPoint(p,m))));return[w,q]},_getAdjacentMidpoints:function(a,n){var p=[],m=a-1;0<=m&&p.push(m);a<n-1&&p.push(a);return p},_getAdjacentVertices:function(a,n){return[a,a+1]},_deleteMidpoints:function(a){var n=this._mpVertexMovers[a.segIndex],p=n.length-1,m=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),k,A=m[0];for(k=0;k<A;k++)--n[k].segLength;
for(k=A+1;k<n.length;k++){var w=n[k];--w.ptIndex;--w.segLength}if(1===m.length)n.splice(A,1)[0].destroy();else for(w=this._getAdjacentVertices(A,p),k=a.relatedGraphic.geometry.getPoint(a.segIndex,w[0]),w=a.relatedGraphic.geometry.getPoint(a.segIndex,w[1]),k=new t({x:(k.x+w.x)/2,y:(k.y+w.y)/2,spatialReference:k.spatialReference.toJson()}),a=new x(k,this._symbol2,this.graphic,a.segIndex,A,p,this,!0),n=n.splice(A,m.length,a),k=0;k<n.length;k++)n[k].destroy()},_updateRelatedGraphic:function(a,n,p,m,k,
A,w,q){a=n.geometry;w?a.insertPoint(m,k+1,h.fromJson(p.toJson())):q?a.removePoint(m,k):a.setPoint(m,k,h.fromJson(p.toJson()));n.setGeometry(a)}});b.PolygonVertexEditor=O(b,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(a){var n,p,m=a.rings,k=[];for(n=0;n<m.length;n++){var A=m[n],w=[];for(p=0;p<A.length-1;p++)w.push(a.getPoint(n,p));k.push(w)}return k},_getMidpointSegments:function(a){var n,p,m=a.rings,k=[],A=a.spatialReference;for(n=0;n<m.length;n++){var w=m[n],
q=[];for(p=0;p<w.length-1;p++){var B=a.getPoint(n,p),l=a.getPoint(n,p+1);B=new t({x:(B.x+l.x)/2,y:(B.y+l.y)/2,spatialReference:A.toJson()});q.push(B)}k.push(q)}return k},_getControlPoints:function(a,n,p,m,k){var A=this.map;this._isNew(a)?a=m:(a=m-1,a=0>a?(k+a)%k:a);m=(m+1)%k;k=A.toScreen(n.getPoint(p,a));n=A.toScreen(n.getPoint(p,m));return[k,n]},_getAdjacentMidpoints:function(a,n){var p=a-1;return[0>p?(n+p)%n:p,a]},_getAdjacentVertices:function(a,n){return[a,(a+1)%n]},_deleteMidpoints:function(a){var n=
a.ptIndex,p=this._mpVertexMovers[a.segIndex],m=p.length-1,k=this._getAdjacentMidpoints(n,a.segLength).sort();var A=k[0];var w=k[k.length-1];if(0===n){var q=this._getAdjacentVertices(m-1,m);n=a.relatedGraphic.geometry.getPoint(a.segIndex,q[0]);q=a.relatedGraphic.geometry.getPoint(a.segIndex,q[1]);n=new t({x:(n.x+q.x)/2,y:(n.y+q.y)/2,spatialReference:n.spatialReference.toJson()});a=new x(n,this._symbol2,this.graphic,a.segIndex,m-1,m,this,!0);p.splice(w,1,a)[0].destroy();p.splice(A,1)[0].destroy();for(k=
0;k<p.length-1;k++)A=p[k],--A.ptIndex,--A.segLength}else{q=this._getAdjacentVertices(A,m);n=a.relatedGraphic.geometry.getPoint(a.segIndex,q[0]);q=a.relatedGraphic.geometry.getPoint(a.segIndex,q[1]);n=new t({x:(n.x+q.x)/2,y:(n.y+q.y)/2,spatialReference:n.spatialReference.toJson()});a=new x(n,this._symbol2,this.graphic,a.segIndex,A,m,this,!0);w=p.splice(A,k.length,a);for(k=0;k<w.length;k++)w[k].destroy();for(k=0;k<A;k++)--p[k].segLength;for(k=A+1;k<p.length;k++)A=p[k],--A.ptIndex,--A.segLength}},_updateRelatedGraphic:function(a,
n,p,m,k,A,w,q){a=n.geometry;w?a.insertPoint(m,k+1,h.fromJson(p.toJson())):q?(a.removePoint(m,k),0===k&&a.setPoint(m,A-1,h.fromJson(a.getPoint(m,0).toJson()))):(a.setPoint(m,k,h.fromJson(p.toJson())),0===k&&a.setPoint(m,A,h.fromJson(p.toJson())));n.setGeometry(a)}});e("extend-esri")&&(C.setObject("toolbars._GraphicVertexEditor",b,d),C.setObject("toolbars._MultipointVertexEditor",b.MultipointVertexEditor,d),C.setObject("toolbars._PolylineVertexEditor",b.PolylineVertexEditor,d),C.setObject("toolbars._PolygonVertexEditor",
b.PolygonVertexEditor,d));return b})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f,b){O=O(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(a,n,p,m,k,A,w,q){this.point=a;this.symbol=n;this.relatedGraphic=p;this.segIndex=m;this.ptIndex=
k;this.segLength=A;this.editor=w;this.map=w.map;this._scratchGL=w.toolbar._scratchGL;this._placeholder=q||!1;this._type=p.geometry.type;this._init();this._enable()},refresh:function(a){if(a||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var a=new h(this.point.toJson());
a=new f(a,this.symbol);switch(this._type){case "multipoint":a._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(a)}this.graphic=a},_enable:function(){var a=this.graphic.getDojoShape();a&&(a._hasMover=!0,this._moveable=this._getMoveable(a),(a=a.getEventSource())&&e.set(a,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var a=this._moveable;if(a){I.disconnect(this._startHandle);
I.disconnect(this._firstHandle);I.disconnect(this._movingHandle);I.disconnect(this._stopHandle);var n=a.shape;n&&(n=n.getEventSource())&&e.set(n,"cursor","inherit");a.destroy();this._moveable=null}},_needRefresh:function(){var a=this.graphic.getDojoShape(),n=!1;if(a)switch(this._type){case "multipoint":var p=this.relatedGraphic.getDojoShape();p&&(p=p.children[this.ptIndex],a!==p&&(this.graphic._shape=p,n=!0));break;case "polyline":case "polygon":n=!a._hasMover}return n},_getMoveable:function(a){a=
new g(a,G("mac")&&G("ff")&&!t("esri-touch")&&{leftButtonOnly:!0});this._startHandle=I.connect(a,"onMoveStart",this,this._moveStartHandler);this._firstHandle=I.connect(a,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=I.connect(a,"onMoving",this,this._movingHandler);this._stopHandle=I.connect(a,"onMoveStop",this,this._moveStopHandler);return a},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(a){var n=this.map;n.snappingManager&&n.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();a.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(a){var n=a.shape,p=this._getControlEdges(),m=this._scratchGL._div,k,A=[],w=a.host.shape._wrapOffsets[0]||
0;for(k=0;k<p.length;k++){var q=p[k];q.x1+=w;q.x2+=w;A.push([m.createLine({x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2}).setStroke(this.editor._lineStroke),q.x1,q.y1,q.x2,q.y2])}n._lines=A;a.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(a,n,p){n=this.map;var m;t("esri-pointer")?m=n.navigationManager.pointerEvents._processTouchEvent(p,p):p&&"pointermove"===p.type&&(m=x.prototype._processTouchEvent.call({map:n},
p,p));m&&n.snappingManager&&n.snappingManager._onSnappingMouseMoveHandler(m);p=a.shape;a=p.getTransform();p=p._lines;for(m=0;m<p.length;m++)n=p[m],n[0].setShape({x1:n[1]+a.dx,y1:n[2]+a.dy,x2:n[3],y2:n[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),a)},_moveStopHandler:function(a){a=a.shape;var n=this.editor.toolbar,p=a.getTransform(),m=this.map,k=this.graphic,A=n._geo?b.geographicToWebMercator(k.geometry):k.geometry;n._activateScrollWheel();var w,q=a._lines;if(q){for(w=
0;w<q.length;w++)q[w][0].removeShape();a._lines=null}w=!1;q=!0;var B=this._getInfo();p&&(p.dx||p.dy)?this._placeholder&&(this._placeholder=!1,w=!0):q=!1;if(m.snappingManager)var l=m.snappingManager._snappingPoint;var u=[p,v.invert(this._startTx)];l=l||m.toMap(v.multiplyPoint(u,m.toScreen(A,!0)));m.snappingManager&&m.snappingManager._killOffSnapping();a.setTransform(null);k.setGeometry(n._geo?b.webMercatorToGeographic(l,!0):l);this.constructor.onMoveStop(this,p);n.onVertexMoveStop(this.relatedGraphic,
B,p);if(!q)n.onVertexClick(this.relatedGraphic,B);if(w)n.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var a=this.map,n=this.relatedGraphic.geometry,p=this.segIndex,m=this.ptIndex,k=this.segLength,A=this._scratchGL.getNavigationTransform(),w=A.dx;A=A.dy;var q=a.toScreen(this.graphic.geometry);a=q.x-w;q=q.y-A;var B=[];n=this.editor._getControlPoints(this,n,p,m,k);n[0]&&B.push({x1:a,y1:q,x2:n[0].x-w,y2:n[0].y-A});n[1]&&B.push({x1:a,y1:q,x2:n[1].x-w,y2:n[1].y-A});return B}});
t("extend-esri")&&C.setObject("toolbars.VertexMover",O,d);C.mixin(O,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return O})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(O,C,I,G,e,g,v,d,x,t){O=O(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(h,f,b){this._graphic=h;this._map=f;
this._toolbar=b;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(h){this._editBox?(I.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=I.connect(h.getLayer(),"onDblClick",this,function(f){this._map.navigationManager.setImmediateClick(!1);f.graphic==h&&(G.stop(f),I.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(h))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(I.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(h,f){if(!this._editBox){if(!h.symbol.text){h.symbol.text="Tempt text";h.setSymbol(h.symbol);var b=""}var a=this._createInputTextStyle(h,this._map);""!==b&&(b=f||h.symbol.text);this._editBox=g.create("input",{type:"text",value:b});
d.set(this._editBox,a);v.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=I.connect(this._editBox,"onkeyup",C.hitch(this,function(p){p.keyCode!=x.ENTER&&p.keyCode!==x.TAB||this._disable()}));this._editBoxBlurHandler=I.connect(this._editBox,"onblur",C.hitch(this,function(p){this._disable()}));h.symbol.text="";h.setSymbol(h.symbol);h.hide();var n=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
C.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(p){d.set(n,{left:this._editBoxLeft+p.delta.x+"px",top:this._editBoxTop+p.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(d.get(n,"left"));this._editBoxTop=parseFloat(d.get(n,"top"))});this.onEditStart(h,this._editBox);this._toolbar.onTextEditStart(h,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(I.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(I.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(h,
f){f=h.getDojoShape().getTransformedBoundingBox();var b=h.getLayer();b=b.hasLocalNavigationTransform()?{dx:0,dy:0}:b.getNavigationTransform();var a=h.symbol.font;return{"font-family":a.family,"font-size":a.size+"px","font-style":a.style,"font-variant":a.variant,"font-weight":a.weight,left:f[0].x+b.dx+"px",top:f[0].y+b.dy+"px",width:Math.abs(f[0].x-f[1].x)/Math.cos(h.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var h=this._graphic.symbol;
h.text=this._editBox.value;this._graphic.setSymbol(h)}else this._graphic.getLayer().remove(this._graphic)}});e("extend-esri")&&C.setObject("toolbars.TextEditor",O,t);return O})},"widgets/SmartEditor/PresetAllFields":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/on dojo/keys dojo/string dojo/dom-attr dojo/mouse ./presetUtils ./RelativeDates dijit/_TemplatedMixin jimu/BaseWidgetSetting dijit/form/FilteringSelect dojo/store/Memory dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/form/SimpleTextarea esri/urlUtils jimu/dijit/Message jimu/utils".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l){return O([n,C,a],{baseClass:"jimu-widget-smartEditor-setting-preset",tooltipContents:{},hasAtLeastOneGroupInDisplay:!1,enableUsePresetValueCheckBox:!1,postCreate:function(){this.inherited(arguments);this.enableUsePresetValueCheckBox=this.hasAtLeastOneGroupInDisplay=!1;this.tooltipContents={};this.presetContainer=e.create("div",{"class":"esriCTPresetContent"},this.parentNode);this._createPresetContents()},_fetchUrlParameters:function(){var u=
q.urlToObject(document.location.href);if(u.query)var D=u.query;return D},_createPresetContents:function(){var u=this._fetchUrlParameters();for(var D=0;D<this.presetOrder.length;D++){var z=this.presetOrder[D];var L=this._isGroupNameFound(u,z);L=u&&L.isConfiguredGroupName?this._createPresetContentDOM(this._configuredPresetInfos[z],u[L.urlParamKey]):this._createPresetContentDOM(this._configuredPresetInfos[z]);this._configuredPresetInfos[z].hideInPresetDisplay?g.add(L,"esriCTHidden"):this.hasAtLeastOneGroupInDisplay=
!0;this._createTooltipContent(this._configuredPresetInfos[z])}},_hasFieldsInPresetGroup:function(u){var D=!1,z;for(z in u.appliedOn)if(0<u.appliedOn[z].length){D=!0;break}return D},_isGroupNameFound:function(u,D){var z=!1,L;u&&G.forEach(Object.keys(u),I.hitch(this,function(F){if(F.toLowerCase()===D.toLowerCase())return z=!0,L=F,!0}));return{isConfiguredGroupName:z,urlParamKey:L}},_createPresetContentDOM:function(u,D){var z=e.create("tr"),L=e.create("td"),F=e.create("div",{"class":"esriCTGroupInfoIcon",
"aria-label":x.substitute(this.nls.groupInfoLabel,{groupName:u.name}),tabindex:"0",role:"button"},L),Q=e.create("span",{innerHTML:u.name,"class":"ee-atiLabel"},L);t.set(Q,"groupName",u.name);t.set(F,"groupName",u.name);this.own(v(F,"click",I.hitch(this,function(T){T=t.get(T.currentTarget,"groupName");B({message:this.tooltipContents[T].innerHTML})})));this.own(v(F,"keydown",I.hitch(this,function(T){if(T.keyCode===d.ENTER||T.keyCode===d.SPACE)T=t.get(T.currentTarget,"groupName"),B({message:this.tooltipContents[T].innerHTML})})));
e.place(L,z);L=e.create("td",{"class":"preset-value-editable"},z);if(u.showOnlyDomainFields)u=this._createDomainContentNode(u,L),void 0!==D&&u.set("value",D);else switch(u.dataType){case "esriFieldTypeInteger":void 0===D||isNaN(D)||(u.presetValue=D);this._createNumberTypeDOM(u,L);break;case "esriFieldTypeDate":void 0!==D&&(u.presetValue={dateType:"fixed",dateTime:isNaN(D)?null:Number(D)});this._createDateTypeDOM(u,L);break;case "esriFieldTypeString":void 0!==D&&(u.presetValue=D);this._createStringTypeDOM(u,
L);break;case "esriFieldTypeGUID":void 0!==D&&(u.presetValue=D),this._createGUIDTypeDOM(u,L)}this.parentNode.appendChild(z);return z},_createTooltipContent:function(u){var D,z=!1,L=e.create("div");var F=e.create("div",{"class":"presetMessageContentDiv",style:{"max-height":"200px",overflow:"auto"},tabindex:"0"},L);var Q=x.substitute(this.nls.presetGroupFieldsLabel,{groupName:"\x3cb\x3e"+u.name+"\x3c/b\x3e"});var T=x.substitute(this.nls.presetGroupNoFieldsLabel,{groupName:"\x3cb\x3e"+u.name+"\x3c/b\x3e"});
Q=e.create("div",{innerHTML:Q},F);F=e.create("ul",{style:"margin: 0px; padding: 0 20px;"},F);for(D in u.appliedOn)if(0<u.appliedOn[D].length){z=!0;var E=this._jimuLayerInfos.getLayerOrTableInfoById(D);if(E&&E.title&&E.layerObject&&E.layerObject.fields){e.create("li",{innerHTML:E.title+": "},F);var M=e.create("ul",{style:"margin: 0px;"},F);G.forEach(E.layerObject.fields,I.hitch(this,function(J){J=l.getDefaultPortalFieldInfo(J);0<=u.appliedOn[D].indexOf(J.fieldName)&&e.create("li",{innerHTML:J.label||
J.fieldName},M)}))}}z||t.set(Q,"innerHTML",T);this.tooltipContents[u.name]=L},_enableUsePresetValueCB:function(u){null!==u&&""!==u&&void 0!==u&&(this.enableUsePresetValueCheckBox=!0)},_createNumberTypeDOM:function(u,D){D=new A({"class":"ee-inputField",name:u.name,value:u.presetValue,"aria-label":u.name},e.create("div",{},D));this.own(v(D,"change",I.hitch(this,function(z){u.presetValue=z;this.emit("presetValueChanged")})));this._enableUsePresetValueCB(u.presetValue)},_createDateTypeDOM:function(u,
D){var z=new k({"class":"ee-inputField",name:u.name,disabled:!0,"aria-label":u.name,style:"width: calc(100% - 30px)",value:this.nls.relativeDates[u.presetValue.dateType]},e.create("div",{},D));"fixed"===u.presetValue.dateType&&(u.presetValue.dateTime?z.set("value",f.getDateFromRelativeInfo(u.presetValue,!0)):z.set("value",""));t.set(z.focusNode,"disabled",!1);t.set(z.focusNode,"readonly",!0);t.set(z.focusNode,"tabindex",0);z.esriCTisDateGroup=!0;z.esriCTPresetGroup=u;var L=x.substitute(this.nls.editGroupInfoIcon,
{groupName:u.name});D=e.create("div",{"class":"jimu-icon jimu-icon-edit",tabindex:"0",role:"button","aria-label":L},e.create("div",{"class":"editRelativeDateIcon"},D));this.own(v(D,"click",I.hitch(this,function(){var F=new b({nls:this.nls,relativeDates:u.presetValue,map:this.map,layerInfos:this._jimuLayerInfos,selectedPresetValue:u.presetValue&&u.presetValue.chooseFromLayerInfo?u.presetValue.chooseFromLayerInfo.selectedValue:""});this.own(v(F,"updatePresetValue",I.hitch(this,function(Q){u.presetValue=
Q;"fixed"===u.presetValue.dateType?u.presetValue.dateTime?z.set("value",f.getDateFromRelativeInfo(u.presetValue,!0)):z.set("value",""):z.set("value",this.nls.relativeDates[Q.dateType]);this.emit("presetValueChanged")})))})));this.own(v(D,"keydown",I.hitch(this,function(F){if(F.keyCode===d.ENTER||F.keyCode===d.SPACE)F=new b({nls:this.nls,relativeDates:u.presetValue,map:this.map,layerInfos:this._jimuLayerInfos,selectedPresetValue:u.presetValue&&u.presetValue.chooseFromLayerInfo?u.presetValue.chooseFromLayerInfo.selectedValue:
""}),this.own(v(F,"updatePresetValue",I.hitch(this,function(Q){u.presetValue=Q;"fixed"===u.presetValue.dateType?u.presetValue.dateTime?z.set("value",f.getDateFromRelativeInfo(u.presetValue,!0)):z.set("value",""):z.set("value",this.nls.relativeDates[Q.dateType]);this.emit("presetValueChanged")})))})));this.own(v(z.domNode,h.enter,I.hitch(this,function(){var F=f.getDateFromRelativeInfo(u.presetValue,!0);""===F&&(F=this.nls.relativeDates.noDateDefinedTooltip);z.set("title",F)})));this._enableUsePresetValueCB(u.presetValue)},
_createStringTypeDOM:function(u,D){D=new w({row:1,style:{resize:"vertical"},"class":"ee-inputField",name:u.name,"aria-label":u.name,value:u.presetValue},e.create("div",{},D));this.own(v(D,"change",I.hitch(this,function(z){u.presetValue!==z&&(u.presetValue=z,this.emit("presetValueChanged"))})));this._enableUsePresetValueCB(u.presetValue)},_createGUIDTypeDOM:function(u,D){D=new k({"class":"ee-inputField","aria-label":u.name,name:u.name,value:u.presetValue},e.create("div",{},D));this.own(v(D,"change",
I.hitch(this,function(z){u.presetValue=z;this.emit("presetValueChanged")})));this._enableUsePresetValueCB(u.presetValue)},_createDomainContentNode:function(u,D){var z=this._populateDomains(u);var L=new p({"class":"ee-inputField",name:u.name,"aria-label":u.name,style:{width:"99%"},required:!1,store:new m({data:z.options})},e.create("div",{},D));L.esriCTDomainList=!0;this.own(v(L,"change",I.hitch(this,function(){u.selectedDomainValue=L.get("value");this.emit("presetValueChanged")})));L.set("value",
z.defaultValue);this._enableUsePresetValueCB(u.presetValue);return L},_populateDomains:function(u){var D=[],z;G.forEach(u.presetValue,I.hitch(this,function(L){L.showInList&&(D.push({name:L.label,id:L.value}),L.isDefault&&(z=L.value,u.selectedDomainValue=L.value))}));return{options:D,defaultValue:z}}})})},"widgets/SmartEditor/presetUtils":function(){define("dojo/_base/lang jimu/utils dojo/date dojo/_base/array dojo/dom-construct dijit/form/DateTextBox dijit/form/NumberSpinner dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Editor dijit/form/SimpleTextarea dojo/store/Memory dojo/query dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor jimu/dijit/EditorTextColor jimu/dijit/EditorBackgroundColor".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p){return{integerFields:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],getFieldInfoByFieldName:function(m,k){var A={};G.some(m,function(w){if(w.name===k)return O.mixin(A,w),!0});return A},getDateFromRelativeInfo:function(m,k){var A=new Date;"fixed"===m.dateType?A=m.dateTime?new Date(m.dateTime):"":"future"===m.dateType?(A=I.add(A,"year",m.year),A=I.add(A,"month",m.month),A=I.add(A,"day",m.day),A=I.add(A,"hour",
m.hour),A=I.add(A,"minute",m.minute),A=I.add(A,"second",m.second)):"past"===m.dateType&&(m.year&&(A=I.add(A,"year",-1*m.year)),m.month&&(A=I.add(A,"month",-1*m.month)),m.day&&(A=I.add(A,"day",-1*m.day)),m.hour&&(A=I.add(A,"hour",-1*m.hour)),m.minute&&(A=I.add(A,"minute",-1*m.minute)),m.second&&(A=I.add(A,"second",-1*m.second)));return k&&""!==A?C.localizeDate(A):A},getDateFieldValue:function(m,k){if("esriFieldTypeDate"===m.type){if(k instanceof Array){var A,w;0<k.length&&k[0]&&(A=k[0].getValue());
1<k.length&&k[1]&&(w=k[1].getValue());var q=A&&w?new Date(A.getFullYear(),A.getMonth(),A.getDate(),w.getHours(),w.getMinutes(),w.getSeconds(),w.getMilliseconds()):A||w||null}else q=k.getValue(),m.domain&&(q=Number(q));q=q&&q.getTime?q.getTime():q&&q.toGregorian?q.toGregorian().getTime():q}return q},isGuid:function(m){"{"===m[0]&&(m=m.substring(1,m.length-1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(m)},validateGUID:function(m,
k){return this.isGuid(m)},isValidPresetValue:function(m){var k=!0;G.some(m,function(A){if(A.isValid&&!A.isValid())return k=!1,!0});return k},createPresetFieldContentNode:function(m){var k=[];if(m.domain){if("codedValue"===m.domain.type){var A=[];G.forEach(m.domain.codedValues,function(l){A.push({name:l.name,id:l.code})});var w=new x({"class":"ee-inputField",name:m.fieldName,store:new n({data:A}),searchAttr:"name",required:!0},e.create("div"))}else{w=null;switch(m.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":w=
{min:m.domain.minValue,max:m.domain.maxValue,places:0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":w={min:m.domain.minValue,max:m.domain.maxValue}}w=new v({"class":"ee-inputField",name:m.fieldName,smallDelta:1,constraints:w,required:!0},e.create("div"))}k.push(w)}else switch(m.type){case "esriFieldTypeGUID":w=new h({"class":"ee-inputField",name:m.fieldName,required:!0,trim:!0},e.create("div"));w.validator=O.hitch(this,this.validateGUID);k.push(w);break;case "esriFieldTypeDate":w=new g({"class":"ee-inputField",
name:m.fieldName,required:!0,fieldType:"date"},e.create("div"));k.push(w);m.format&&m.format.time&&!0===m.format.time&&(m=new f({"class":"ee-inputField",style:"margin-top:2px;",required:!0},e.create("div")),k.push(m));break;case "esriFieldTypeString":w=null;m.length&&Number(m.length)&&0<Number(m.length)&&(w=m.length);if(m.hasOwnProperty("stringFieldOption"))if("richtext"===m.stringFieldOption){var q=document.getElementsByTagName("head")[0];var B=window.apiUrl+"dojox/editor/plugins/resources/css/TextColor.css";
p('link[href\x3d"'+B+'"]',q)[0]||C.loadStyleLink("editor_plugins_resources_TextColor",B);B=window.apiUrl+"dojox/editor/plugins/resources/editorPlugins.css";p('link[href\x3d"'+B+'"]',q)[0]||C.loadStyleLink("editor_plugins_resources_editorPlugins",B);B=window.apiUrl+"dojox/editor/plugins/resources/css/PasteFromWord.css";p('link[href\x3d"'+B+'"]',q)[0]||C.loadStyleLink("editor_plugins_resources_PasteFromWord",B);w={"class":"ee-inputField ee-inputFieldRichText",trim:!0,maxLength:w,fieldType:"richtext",
required:!0};w["class"]+=" atiRichTextField";w.height="100%";w.width="100%";w.name=m.fieldName;w.plugins=["bold","italic","underline",C.getEditorTextColor("smartEditor"),C.getEditorBackgroundColor("smartEditor"),"|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","insertOrderedList","insertUnorderedList","indent","outdent","|","createLink"];w=new b(w,e.create("div"))}else w="textarea"===m.stringFieldOption?new a({"class":"ee-inputField ee-inputFieldTextArea",name:m.fieldName,maxlength:w,
fieldType:"textarea",required:!0},e.create("div")):new h({"class":"ee-inputField",name:m.fieldName,maxlength:w,required:!0,trim:!0},e.create("div"));else w=new h({"class":"ee-inputField",name:m.fieldName,maxlength:w,required:!0,trim:!0},e.create("div"));k.push(w);break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":w=new d({"class":"ee-inputField",name:m.fieldName,required:!0,constraints:{places:0}},e.create("div"));k.push(w);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":w=
new d({"class":"ee-inputField",name:m.fieldName,required:!0},e.create("div"));k.push(w);break;default:w=new t({"class":"ee-unsupportField",name:m.fieldName,value:"N/A",readOnly:!0},e.create("div")),k.push(w)}return k},changeFieldToMostRestrictive:function(m,k){if(!m.hasOwnProperty("type")&&k.hasOwnProperty("type"))return k;k.length&&Number(k.length)&&0<Number(k.length)&&(m.length&&Number(m.length)?k.length<m.length&&(m.length=k.length):m.length=k.length);if(m.type===k.type)switch(k.type){case "esriFieldTypeString":m.hasOwnProperty("stringFieldOption")&&
k.hasOwnProperty("stringFieldOption")&&("richtext"===m.stringFieldOption&&"richtext"!==k.stringFieldOption?m.stringFieldOption=k.stringFieldOption:"textarea"===m.stringFieldOption&&"textbox"===k.stringFieldOption&&(m.stringFieldOption=k.stringFieldOption))}return m}}})},"jimu/dijit/EditorTextColor":function(){define("require dojo dijit dojo/_base/declare dijit/_editor/_Plugin dijit/form/DropDownButton".split(" "),function(O,C,I,G,e,g){C.experimental("dijit.editor.plugins.EditorTextColor");var v=G("dijit.editor.plugins.EditorTextColor",
e,{buttonClass:g,colorPicker:"jimu/dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command="editorTextColor";this.hackCommand="foreColor";this.inherited(arguments);var d="",x=!1;this.params.custom&&(this.params.custom.recordUID&&(d=this.params.custom.recordUID),this.params.custom.forceAttr&&(x=this.params.custom.forceAttr));var t=this;this.button.set("iconClass",this.iconClassPrefix+" "+this.iconClassPrefix+"ForeColor");this.button.set("title",this.getLabel(this.hackCommand));
this.button.loadDropDown=function(h){function f(b){t.button.dropDown=new b({dir:t.editor.dir,ownerDocument:t.editor.ownerDocument,value:t.value,appearance:{showTransparent:!1,showColorPalette:!0,showCoustom:!0,showColorPickerApply:!1,showCoustomRecord:!0},recordUID:d,onChange:function(a){t.editor.execCommand("useCSS",x);t.editor.execCommand("styleWithCSS",!x);t.editor.execCommand(t.hackCommand,a)},onClose:function(){t.button.closeDropDown()}});h()}"string"===typeof t.colorPicker?O([t.colorPicker],
f):f(t.colorPicker)}},updateState:function(){var d=this.editor,x=this.hackCommand;if(d&&d.isLoaded&&x.length){if(this.button){var t=this.get("disabled");this.button.set("disabled",t);if(t)return;try{var h=d.queryCommandValue(x)||""}catch(f){h=""}}""===h?h="#000000":"transparent"===h&&(h="rgba(0, 0, 0, 0)");this.value=h;(d=this.button.dropDown)&&d.getColor&&h!==d.getColor()&&(d.refreshRecords(),d.setColor(h))}}});C.subscribe(I._scopeName+".Editor.getPlugin",null,function(d){if(!d.plugin)switch(d.args.name){case "editorTextColor":d.plugin=
new v}});return v})},"jimu/dijit/EditorBackgroundColor":function(){define("require dojo dijit dojo/_base/declare dijit/_editor/_Plugin dijit/form/DropDownButton".split(" "),function(O,C,I,G,e,g){C.experimental("dijit.editor.plugins.EditorBackgroundColor");var v=G("dijit.editor.plugins.EditorBackgroundColor",e,{buttonClass:g,colorPicker:"jimu/dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command="editorBackgroundColor";this.hackCommand="hiliteColor";this.inherited(arguments);
var d="";this.params.custom&&this.params.custom.recordUID&&(d=this.params.custom.recordUID);var x=this;this.button.set("iconClass",this.iconClassPrefix+" "+this.iconClassPrefix+"HiliteColor");this.button.set("title",this.getLabel(this.hackCommand));this.button.loadDropDown=function(t){function h(f){x.button.dropDown=new f({dir:x.editor.dir,ownerDocument:x.editor.ownerDocument,value:x.value,appearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!0,showColorPickerApply:!1,
showCoustomRecord:!0},recordUID:d,onChange:function(b){x.editor.execCommand("useCSS",!1);x.editor.execCommand("styleWithCSS",!0);x.editor.execCommand(x.hackCommand,b)},onExecute:function(){x.editor.execCommand(x.hackCommand,this.get("value"))},onClose:function(){x.button.closeDropDown()}});t()}"string"===typeof x.colorPicker?O([x.colorPicker],h):h(x.colorPicker)}},updateState:function(){var d=this.editor,x=this.hackCommand;if(d&&d.isLoaded&&x.length){if(this.button){var t=this.get("disabled");this.button.set("disabled",
t);if(t)return;try{var h=d.queryCommandValue(x)||""}catch(f){h=""}}""===h?h="#000000":"transparent"===h&&(h="rgba(0, 0, 0, 0)");this.value=h;(d=this.button.dropDown)&&d.getColor&&h!==d.getColor()&&(d.refreshRecords(),d.setColor(h))}}});C.subscribe(I._scopeName+".Editor.getPlugin",null,function(d){if(!d.plugin)switch(d.args.name){case "editorBackgroundColor":d.plugin=new v}});return v})},"widgets/SmartEditor/RelativeDates":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/on dojo/text!./RelativeDates.html dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/dijit/Popup dojo/dom-class jimu/utils dojo/query dijit/focus ./presetUtils dijit/form/Select jimu/dijit/LayerChooserFromMap jimu/dijit/LayerChooserFromMapWithDropbox jimu/dijit/_filter/ValueProviderFactory dojo/_base/array dojo/dom-style dojo/string dojo/dom-attr ./utils dojo/_base/kernel jimu/filterUtils dijit/form/DateTextBox dijit/form/TimeTextBox dijit/form/NumberTextBox jimu/dijit/RadioBtn".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u){return O([v,C,g],{baseClass:"jimu-widget-smartEditor-setting-relativeDates",templateString:e,selectValuePopup:null,_isFirsTime:!0,initialValue:null,filterUtils:null,postCreate:function(){this.filterUtils=new u;this._eventListener();this._createSelectValuePopUp();this._addLayerSelectors();this._support508ForSelectValuePopUp();G(window,"resize",I.hitch(this,function(){setTimeout(I.hitch(this,function(){this._setFieldPopupDimensions()}),1E3)}))},
_eventListener:function(){this.fixedRadioButton.onStateChange=I.hitch(this,function(){this.dateTypeChanged()});this.currentRadioButton.onStateChange=I.hitch(this,function(){this.dateTypeChanged()});this.PastRadioButton.onStateChange=I.hitch(this,function(){this.dateTypeChanged()});this.futureRadioButton.onStateChange=I.hitch(this,function(){this.dateTypeChanged()});this.own(G(this.yearsTextBox,"change",I.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(G(this.monthsTextBox,"change",
I.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(G(this.daysTextBox,"change",I.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(G(this.minutesTextBox,"change",I.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(G(this.hoursTextBox,"change",I.hitch(this,function(){this._showOrHideWarningContainer()})));this.own(G(this.secondsTextBox,"change",I.hitch(this,function(){this._showOrHideWarningContainer()})));this.customRadioButton.onStateChange=
I.hitch(this,function(){this._dateValueOptionChange()});this.selectValueRadioButton.onStateChange=I.hitch(this,function(){this._dateValueOptionChange()})},dateTypeChanged:function(){x.add(this.fixedDateContent,"esriCTHidden");x.add(this.currentDateContent,"esriCTHidden");x.add(this.pastOrFutureDateContent,"esriCTHidden");x.remove(this.valueLabel,"esriCTHidden");x.add(this.relativeDateWarningContainer,"esriCTHidden");this.fixedRadioButton.checked?(x.remove(this.fixedDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=
this.nls.relativeDates.hintForFixedDateType):this.currentRadioButton.checked?(x.add(this.valueLabel,"esriCTHidden"),x.remove(this.currentDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=this.nls.relativeDates.hintForCurrentDateType):this.PastRadioButton.checked?(x.remove(this.pastOrFutureDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=this.nls.relativeDates.hintForPastDateType):this.futureRadioButton.checked&&(x.remove(this.pastOrFutureDateContent,"esriCTHidden"),this.hintForDateType.innerHTML=
this.nls.relativeDates.hintForFutureDateType)},_createSelectValuePopUp:function(){this.selectValuePopup=new d({titleLabel:this.nls.relativeDates.popupTitle,width:500,maxHeight:450,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,onClick:I.hitch(this,function(){var D=this._getValues();D&&(!x.contains(this.pastOrFutureDateContent,"esriCTHidden")&&this._checkTextboxesWithZeroValue()?x.remove(this.relativeDateWarningContainer,"esriCTHidden"):(x.add(this.relativeDateWarningContainer,
"esriCTHidden"),this.emit("updatePresetValue",D),this.selectValuePopup.close()))})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:I.hitch(this,function(){this.selectValuePopup.close()})}]});this.relativeDates&&this._setValue()},_setFieldPopupDimensions:function(){this.selectValuePopup&&(window.appInfo.isRunInMobile&&600>window.innerWidth?this.selectValuePopup.set("width",window.innerWidth-100):this.selectValuePopup.set("width",750))},_validateFixedDate:function(){return this.dateTextBox.isValid()?
this.timeTextBox.isValid()?!0:(this.timeTextBox.focus(),!1):(this.dateTextBox.focus(),!1)},_validatePastOrFutureDate:function(){return this.yearsTextBox.isValid()?this.monthsTextBox.isValid()?this.daysTextBox.isValid()?this.hoursTextBox.isValid()?this.minutesTextBox.isValid()?this.secondsTextBox.isValid()?!0:(this.secondsTextBox.focus(),!1):(this.minutesTextBox.focus(),!1):(this.hoursTextBox.focus(),!1):(this.daysTextBox.focus(),!1):(this.monthsTextBox.focus(),!1):(this.yearsTextBox.focus(),!1)},
_getValues:function(){var D=!0,z={value:{}};if(this.fixedRadioButton.checked){if(this.customRadioButton.checked&&(D=this._validateFixedDate())&&(z.dateType="fixed",z.dateTime=b.getDateFieldValue({type:"esriFieldTypeDate"},[this.dateTextBox,this.timeTextBox])),this.selectValueRadioButton.checked&&(z.dateType="fixed",this._getChooseFromLayerInfo()?z.chooseFromLayerInfo=this._getChooseFromLayerInfo():z.chooseFromLayerInfo=null,z.chooseFromLayerInfo&&z.chooseFromLayerInfo.selectedValue)){var L=z.chooseFromLayerInfo.selectedValue;
"Invalid Date"!=new Date(L)?(this._isSelectedDateFieldHasTime()||(L=this.filterUtils.formatDate(L)),z.dateTime=this._convertToEpoch(new Date(L))):z.dateTime=parseInt(L)}}else if(this.currentRadioButton.checked)z.dateType="current";else if(this.PastRadioButton.checked){if(D=this._validatePastOrFutureDate())z=this._getValuesOfPastOrFutureDijits(),z.dateType="past"}else this.futureRadioButton.checked&&(D=this._validatePastOrFutureDate())&&(z=this._getValuesOfPastOrFutureDijits(),z.dateType="future");
return D?z:D},_support508ForSelectValuePopUp:function(){var D=h(".jimu-btn-vacation",this.selectValuePopup.domNode)[0];t.initFirstFocusNode(this.selectValuePopup.domNode,this.selectValuePopup.closeBtnNode);f.focus(this.selectValuePopup.closeBtnNode);t.initLastFocusNode(this.selectValuePopup.domNode,D)},_setValue:function(){if("fixed"===this.relativeDates.dateType)if(this.fixedRadioButton.domNode.click(),this.relativeDates.hasOwnProperty("chooseFromLayerInfo"))this.selectValueRadioButton.domNode.click();
else{this.customRadioButton.domNode.click();var D=new Date(parseInt(this.relativeDates.dateTime,10));this.dateTextBox.set("value",D);this.timeTextBox.set("value",D)}"current"===this.relativeDates.dateType&&this.currentRadioButton.domNode.click();"past"===this.relativeDates.dateType&&(this.PastRadioButton.domNode.click(),this._setValuesOfPastOrFutureDijits());"future"===this.relativeDates.dateType&&(this.futureRadioButton.domNode.click(),this._setValuesOfPastOrFutureDijits())},_setValuesOfPastOrFutureDijits:function(){this.yearsTextBox.set("value",
this.relativeDates.year);this.monthsTextBox.set("value",this.relativeDates.month);this.daysTextBox.set("value",this.relativeDates.day);this.hoursTextBox.set("value",this.relativeDates.hour);this.minutesTextBox.set("value",this.relativeDates.minute);this.secondsTextBox.set("value",this.relativeDates.second)},_getValuesOfPastOrFutureDijits:function(){var D={};D.year=this.yearsTextBox.value;D.month=this.monthsTextBox.value;D.day=this.daysTextBox.value;D.hour=this.hoursTextBox.value;D.minute=this.minutesTextBox.value;
D.second=this.secondsTextBox.value;return D},_checkTextboxesWithZeroValue:function(){return 0!==this.yearsTextBox.value||0!==this.monthsTextBox.value||0!==this.daysTextBox.value||0!==this.hoursTextBox.value||0!==this.minutesTextBox.value||0!==this.secondsTextBox.value?!1:!0},_showOrHideWarningContainer:function(){this._checkTextboxesWithZeroValue()?x.remove(this.relativeDateWarningContainer,"esriCTHidden"):x.add(this.relativeDateWarningContainer,"esriCTHidden")},_addLayerSelectors:function(){var D=
this._createLayerChooserMapArgs();D=new n(D);D.startup();this.layerSelector=new p({layerChooser:D});this.layerSelector.placeAt(this.layerSelectorDiv);this.layerSelector.startup();if(0<this.layerSelector.layerChooser.getAllItems().length)var z=this.layerSelector.layerChooser.getAllItems()[0].layerInfo.layerObject;this.relativeDates&&this.relativeDates.chooseFromLayerInfo&&this.relativeDates.chooseFromLayerInfo.layerId&&this._isFirsTime&&(D=this.layerInfos.getLayerInfoById(this.relativeDates.chooseFromLayerInfo.layerId))&&
(z=D.layerObject);this.layerSelector.setSelectedLayer(z);this._addLayerFieldsOptions()},_createLayerChooserMapArgs:function(){return{multiple:!1,createMapResponse:this.map.webMapResponse,filter:this._createFiltersForLayerSelector()}},_createFiltersForLayerSelector:function(){var D=n.createFilterByLayerType(["FeatureLayer","Table"]);var z=n.createImageServiceLayerFilter(!0);D=n.orCombineFilters([D,z]);dateLayerfilter=this._createDateLayerfilter();return n.andCombineFilters([D,dateLayerfilter])},_createDateLayerfilter:function(){return function(D){var z=
!1;D.getLayerObject().then(function(L){L&&L.fields&&k.some(L.fields,function(F){if("esriFieldTypeDate"===F.type)return z=!0})});return z}},_addLayerFieldsOptions:function(){this.fieldsDropdown&&this.fieldsDropdown.destroy();this.valueProviderFactory&&(this.valueProviderFactory=null);this.valueProvider&&this.valueProvider.destroy();this.fieldsDropdown=new a({style:{width:"100%"}});this.fieldsDropdown.placeAt(this.fieldsDropdownDiv);this.fieldsDropdown.startup();this.fieldsDropdown.set("options",this._createFieldsDropDownOpt());
this.fieldsDropdown.options&&0<this.fieldsDropdown.options.length&&this.fieldsDropdown.set("value",this.fieldsDropdown.options[0]);this.relativeDates&&this.relativeDates.chooseFromLayerInfo&&this.relativeDates.chooseFromLayerInfo.field&&this._isFirsTime&&this.fieldsDropdown.set("value",this.relativeDates.chooseFromLayerInfo.field);this._updateLabelForDomainField(this.selectedPresetValue);this.own(G(this.layerSelector,"selection-change",I.hitch(this,function(){this._addLayerFieldsOptions()})));this.own(G(this.fieldsDropdown,
"change",I.hitch(this,function(){A.set(this.domainFieldHint,"display","none");this._createValueProvider();this._updateLabelForDomainField("")})))},_createFieldsDropDownOpt:function(){var D=[];validFieldSet=[];if(this.layerSelector.getSelectedItem()){var z=this.layerSelector.getSelectedItem().layerInfo.layerObject;k.forEach(z.fields,I.hitch(this,function(L){"esriFieldTypeDate"===L.type&&D.push({label:L.alias||L.name,value:L.name})}))}return D},_createValueProvider:function(){var D;this.layerSelector&&
(D=this.layerSelector.getSelectedItem());if(D&&D.layerInfo&&D.layerInfo.layerObject){D=D.layerInfo;var z=D.layerObject;this.valueProviderFactory&&(this.valueProviderFactory=null);this.valueProvider&&this.valueProvider.destroy();this.valueProviderFactory=new m({url:z.url,layerDefinition:z,featureLayerId:D.id});var L;var F=this.fieldsDropdown.getValue();k.some(z.fields,I.hitch(this,function(E){if(E.name===F)return L=E,!0}));if(F&&L){if("esriFieldTypeDate"===L.type){var Q="date";var T="dateOperatorIsOn"}Q=
{fieldObj:{name:F,label:F,dateFormat:"",shortType:Q,type:L.type},operator:T,interactiveObj:"",caseSensitive:!1,valueObj:{type:"unique"}};this.valueProvider=this.valueProviderFactory.getValueProvider(Q,!1);this.own(G(this.valueProvider,"change",I.hitch(this,function(){var E=this.valueProvider.getPartObject()&&this.valueProvider.getPartObject().valueObj.value;this._updateLabelForDomainField(E)})));this.valueProvider&&(this.valueProvider.promptLabel&&x.add(this.valueProvider.promptLabel,"esriCTHidden"),
this.valueProvider.placeAt(this.valueProviderContainer),this.relativeDates&&this.relativeDates.chooseFromLayerInfo&&this.relativeDates.chooseFromLayerInfo.selectedValue&&"Invalid Date"!=new Date(this.relativeDates.chooseFromLayerInfo.selectedValue)&&this._isFirsTime&&(Q.valueObj.value=this.relativeDates.chooseFromLayerInfo.selectedValue,this._isFirsTime=!1),this.valueProvider.setValueObject(Q.valueObj),this.initialValue=Q.valueObj.value?Q.valueObj.value:"")}}},_dateValueOptionChange:function(){this.customRadioButton.checked&&
(x.remove(this.customOptionContentNode,"esriCTHidden"),x.add(this.selectValueOptionContentNode,"esriCTHidden"));this.selectValueRadioButton.checked&&(x.remove(this.selectValueOptionContentNode,"esriCTHidden"),x.add(this.customOptionContentNode,"esriCTHidden"))},_getChooseFromLayerInfo:function(){if(this.valueProvider&&this.valueProvider.checkedNameDiv){var D=this.valueProvider.getPartObject()?this.valueProvider.getPartObject().valueObj.value:"- empty -"!==this.valueProvider.checkedNameDiv.innerHTML&&
this.initialValue?this.initialValue:"";if("ar"===l.locale&&this.layerSelector){var z;if(z=this.layerSelector.getSelectedItem())z=B.getFieldInfosFromWebmap(z.layerInfo),z=b.getFieldInfoByFieldName(z,this.fieldsDropdown.getValue()),"esriFieldTypeDate"===z.type&&(D=t.getDateByDateTimeStr(D),D=t.localizeDateTimeByFieldInfo(D,z))}return{layerId:this.layerSelector.getSelectedItem().layerInfo.layerObject.id,field:this.fieldsDropdown.getValue(),selectedValue:D}}},_convertToEpoch:function(D){return D=(D=D?
new Date(D.getFullYear(),D.getMonth(),D.getDate(),D.getHours(),D.getMinutes(),D.getSeconds(),D.getMilliseconds()):D||null)&&D.getTime?D.getTime():D&&D.toGregorian?D.toGregorian().getTime():D},_updateLabelForDomainField:function(D){var z,L,F={dateType:"fixed",dateTime:""};(L=this.layerSelector?this.layerSelector.getSelectedItem():null)&&L.layerInfo&&L.layerInfo.layerObject&&(L=L.layerInfo.layerObject,L=L.getField(this.fieldsDropdown.getValue()),L.domain&&"esriFieldTypeDate"===L.type&&k.some(L.domain.codedValues,
I.hitch(this,function(Q){if(D==Q.code)return Q=D,"Invalid Date"!=new Date(Q)?(this._isSelectedDateFieldHasTime()||(Q=this.filterUtils.formatDate(Q)),F.dateTime=this._convertToEpoch(new Date(Q))):F.dateTime=parseInt(D),z=w.substitute(this.nls.relativeDates.domainFieldHintLabel,{domainValue:b.getDateFromRelativeInfo(F,!0)}),!0})));z?(q.set(this.domainFieldHint,"innerHTML",z),A.set(this.domainFieldHint,"display","block")):A.set(this.domainFieldHint,"display","none")},_isSelectedDateFieldHasTime:function(){var D=
!1;this.valueProviderFactory&&this.valueProviderFactory.popupInfo&&this.valueProviderFactory.popupInfo.fieldInfos&&k.forEach(this.valueProviderFactory.popupInfo.fieldInfos,I.hitch(this,function(z){z.fieldName===this.fieldsDropdown.value&&z.format&&z.format.time&&(D=!0)}));return D}})})},"jimu/dijit/LayerChooserFromMap":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/store/Memory dojo/Deferred dojo/store/Observable dijit/tree/ObjectStoreModel dojo/promise/all dojo/_base/lang dojo/_base/html dojo/_base/array jimu/utils jimu/dijit/_Tree jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k){var A=I([G,e,g,C],{templateString:'\x3cdiv style\x3d"width:100%;"\x3e\x3cdiv data-dojo-attach-point\x3d"errorTipSection" class\x3d"error-tip-section"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text" data-dojo-attach-point\x3d"errTip"\x3e${nls.noLayersTip}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',_store:null,_id:0,_treeClass:"layer-chooser-tree",createMapResponse:null,multiple:!1,onlyShowVisible:!1,
updateWhenLayerInfosIsShowInMapChanged:!1,onlyShowWebMapLayers:!1,displayTooltipForTreeNode:!1,onlyFilterCurrentLayerWhenAddItem:!1,postMixInProperties:function(){this.nls=window.jimuNls.basicLayerChooserFromMap},postCreate:function(){this.inherited(arguments);b.addClass(this.domNode,"jimu-basic-layer-chooser-from-map");this.multiple=!!this.multiple;this.shelter=new k({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this._createTree();this.basicFilter=f.hitch(this,this.basicFilter);
this.filter=A.andCombineFilters([this.basicFilter,this.filter]);this.createMapResponse&&this.setCreateMapResponse(this.createMapResponse)},basicFilter:function(w){var q=new d;this.onlyShowVisible?q.resolve(w.isShowInMap()):q.resolve(!0);return q},filter:function(w){w=new d;w.resolve(!0);return w},getSelectedItems:function(){var w=this.tree.getSelectedItems();return a.map(w,f.hitch(this,function(q){return this.getHandledItem(q)}))},getAllItems:function(){var w=this.tree.getAllItems(),q=[];a.forEach(w,
f.hitch(this,function(B){"root"!==B.id&&(B=this.getHandledItem(B),q.push(B))}));return q},getHandledItem:function(w){return{name:w.name,layerInfo:w.layerInfo}},_isLeafItem:function(w){return w.isLeaf},setCreateMapResponse:function(w){this.createMapResponse=w;m.getInstance(this.createMapResponse.map,this.createMapResponse.itemInfo).then(f.hitch(this,function(q){this.layerInfosObj=q;this.own(O(this.layerInfosObj,"layerInfosChanged",f.hitch(this,this._onLayerInfosChanged)));this.updateWhenLayerInfosIsShowInMapChanged&&
this.own(O(this.layerInfosObj,"layerInfosIsShowInMapChanged",f.hitch(this,this._onLayerInfosIsShowInMapChanged)));this._buildTree(this.layerInfosObj)}))},_onLayerInfosChanged:function(w,q){this._buildTree(this.layerInfosObj);this.emit("update")},_onLayerInfosIsShowInMapChanged:function(w){this._buildTree(this.layerInfosObj);this.emit("update")},_buildTree:function(w){this._clear();b.setStyle(this.errorTipSection,"display","block");var q=[];this.onlyShowWebMapLayers?(q=w.getLayerInfoArrayOfWebmap(),
q=q.concat(w.getTableInfoArrayOfWebmap())):(q=w.getLayerInfoArray(),q=q.concat(w.getTableInfoArray()));0!==q.length&&(b.setStyle(this.errorTipSection,"display","none"),a.forEach(q,f.hitch(this,function(B){this._addDirectLayerInfo(B)})))},_addDirectLayerInfo:function(w){w&&w.getLayerObject().then(f.hitch(this,function(){this._addItem("root",w)}),f.hitch(this,function(q){console.error(q)}))},_clear:function(){var w=this._store.query({parent:"root"});a.forEach(w,f.hitch(this,function(q){q&&"root"!==
q.id&&this._store.remove(q.id)}))},_addItem:function(w,q){var B=null,l=q.getLayerType(),u=this.filter(q);h({layerType:l,valid:u}).then(f.hitch(this,function(D){if(D.valid){var z=f.hitch(this,function(T,E){this._id++;B={name:q.title||"",parent:w,layerInfo:q,type:D.layerType,layerClass:q.layerObject.declaredClass,id:this._id.toString(),isLeaf:T,hasChildren:E};this._store.add(B)}),L=q.getSubLayers(),F=0===L.length,Q=!0;this.onlyFilterCurrentLayerWhenAddItem?(F&&(Q=!1),z(F,Q)):F?z(F,!1):(L=a.map(L,f.hitch(this,
function(T){return this.filter(T)})),h(L).then(f.hitch(this,function(T){(T=a.some(T,function(E){return E}))&&z(F,T)})))}}))},_getRootItem:function(){return{id:"root",name:"Map Root",type:"root",isLeaf:!1,hasChildren:!0}},_createTree:function(){var w=this._getRootItem();w=new v({data:[w],getChildren:function(q){return this.query({parent:q.id})}});this._store=new x(w);w=new t({store:this._store,query:{id:"root"},mayHaveChildren:f.hitch(this,this._mayHaveChildren)});this.tree=new p({multiple:this.multiple,
model:w,showRoot:!1,isLeafItem:f.hitch(this,this._isLeafItem),style:{width:"100%"},onOpen:f.hitch(this,function(q,B){"root"!==q.id&&this._onTreeOpen(q,B)}),onClick:f.hitch(this,function(q,B,l){this._onTreeClick(q,B,l);this.emit("tree-click",q,B,l)}),getIconStyle:f.hitch(this,function(q,B){var l=null;if(!q||"root"===q.id)return null;var u={width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundImage:""},D=window.location.protocol+"//"+window.location.host+
require.toUrl("jimu");if(q=this._getIconInfo(q,B).imageName)u.backgroundImage="url("+D+"/css/images/"+q+")",l=u;return l}),getIconClass:f.hitch(this,function(q,B){return this._getIconInfo(q,B).className}),getTooltip:f.hitch(this,function(q){return this.displayTooltipForTreeNode?q.layerInfo.title:""})});b.addClass(this.tree.domNode,this._treeClass);this.tree.placeAt(this.shelter.domNode,"before")},_mayHaveChildren:function(w){return w.hasChildren},_getIconInfo:function(w,q){var B="",l="";"ArcGISDynamicMapServiceLayer"===
w.type||"ArcGISTiledMapServiceLayer"===w.type?q?(B="mapserver_open.png",l="mapservice-layer-icon open"):(B="mapserver_close.png",l="mapservice-layer-icon close"):"GroupLayer"===w.type?q?(B="group_layer2.png",l="group-layer-icon open"):(B="group_layer1.png",l="group-layer-icon close"):"FeatureLayer"===w.type?(w=n.getTypeByGeometryType(w.layerInfo.layerObject.geometryType),"point"===w?(B="point_layer1.png",l="point-layer-icon"):"polyline"===w?(B="line_layer1.png",l="line-layer-icon"):"polygon"===w&&
(B="polygon_layer1.png",l="polygon-layer-icon")):"Table"===w.type?(B="table.png",l="table-icon"):"ArcGISImageServiceLayer"===w.type||"ArcGISImageServiceVectorLayer"===w.type?(B="image_layer.png",l="iamge-layer-icon"):q?(B="mapserver_open.png",l="mapservice-layer-icon open"):(B="mapserver_close.png",l="mapservice-layer-icon close");return{imageName:B,className:l}},_onTreeOpen:function(w,q){if("root"!==w.id){var B=[];q=[];B=w.layerInfo.getSubLayers();w.checked||(this.shelter.show(),q=a.map(B,f.hitch(this,
function(l){return l.getLayerObject()})),h(q).then(f.hitch(this,function(){this.domNode&&(a.forEach(B,f.hitch(this,function(l){this._addItem(w.id,l)})),w.checked=!0,this.shelter.hide())}),f.hitch(this,function(l){console.error(l);this.shelter.hide()})))}},_onTreeClick:function(w,q,B){},destroy:function(){this.shelter&&(this.shelter.destroy(),this.shelter=null);this.tree&&this.tree.destroy();this.inherited(arguments)}});A.createFilterByLayerType=function(w){f.isArrayLike(w)||(w=[]);return function(q){var B=
new d;if(0===w.length)B.resolve(!0);else{var l=[];q.traversal(function(u){l.push(u.getLayerType())});h(l).then(function(u){for(var D=0;D<u.length;D++)for(var z=0;z<w.length;z++)if(u[D]===w[z]){B.resolve(!0);return}B.resolve(!1)},function(u){console.error(u);B.reject(u)})}return B}};A.createFeaturelayerFilter=function(w,q,B,l){var u=["point","polyline","polygon"];w&&0<w.length?(w=a.filter(w,function(D){return 0<=u.indexOf(D)}),0===w.length&&(w=u)):w=u;return function(D){var z=D.getLayerType();D=D.getLayerObject();
return h({layerType:z,layerObject:D}).then(function(L){var F=L.layerType;L=L.layerObject;if("ArcGISDynamicMapServiceLayer"===F||"ArcGISTiledMapServiceLayer"===F||"GroupLayer"===F||"FeatureCollection"===F)return!0;if("FeatureLayer"===F){F=n.getTypeByGeometryType(L.geometryType);F=0<=a.indexOf(w,F);var Q=A._shouldPassStatisticsCheck(l,L);return L.url?(L=n.isFeaturelayerUrlSupportQuery(L.url,L.capabilities),F&&L&&Q):q&&F}return"Table"===F?(F=n.isFeaturelayerUrlSupportQuery(L.url,L.capabilities),L=A._shouldPassStatisticsCheck(l,
L),B&&F&&L):!1})}};A.createImageServiceLayerFilter=function(w,q){return function(B){var l=B.getLayerType();B=B.getLayerObject();return h({layerType:l,layerObject:B}).then(function(u){var D=u.layerType,z=u.layerObject;return"ArcGISImageServiceLayer"===D||"ArcGISImageServiceVectorLayer"===D?w?n.isImageServiceSupportQuery(u.layerObject.capabilities)?q?A._shouldPassStatisticsCheck(q,z):!0:!1:!0:!1})}};A._shouldPassStatisticsCheck=function(w,q){return w?(w=!1,w=q.advancedQueryCapabilities?!!q.advancedQueryCapabilities.supportsStatistics:
!!q.supportsStatistics):!0};A.createQueryableLayerFilter=function(w){var q=A.createFeaturelayerFilter(["point","polyline","polygon"],!1,!0,w);w=A.createImageServiceLayerFilter(!0,w);return A.orCombineFilters([q,w])};A.andCombineFilters=function(w){return A._combineFilters(w,!0)};A.orCombineFilters=function(w){return A._combineFilters(w,!1)};A._combineFilters=function(w,q){return function(B){var l=new d,u=a.map(w,function(D){return D(B)});h(u).then(function(D){var z=!1;z=q?a.every(D,function(L){return L}):
a.some(D,function(L){return L});l.resolve(z)},function(D){console.error(D);l.reject(D)});return l}};return A})},"dijit/tree/ObjectStoreModel":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/when ../Destroyable".split(" "),function(O,C,I,G,e,g,v){return I("dijit.tree.ObjectStoreModel",v,{store:null,labelAttr:"name",labelType:"text",root:null,query:null,constructor:function(d){e.mixin(this,d);this.childrenCache={}},getRoot:function(d,x){if(this.root)d(this.root);
else{var t=this.store.query(this.query);t.then&&this.own(t);g(t,e.hitch(this,function(h){if(1!=h.length)throw Error("dijit.tree.ObjectStoreModel: root query returned "+h.length+" items, but must return exactly one");this.root=h[0];d(this.root);t.observe&&t.observe(e.hitch(this,function(f){this.onChange(f)}),!0)}),x)}},mayHaveChildren:function(){return!0},getChildren:function(d,x,t){var h=this.store.getIdentity(d);if(this.childrenCache[h])g(this.childrenCache[h],x,t);else{var f=this.childrenCache[h]=
this.store.getChildren(d);f.then&&this.own(f);f.observe&&this.own(f.observe(e.hitch(this,function(b,a,n){this.onChange(b);a!=n&&g(f,e.hitch(this,"onChildrenChange",d))}),!0));g(f,x,t)}},isItem:function(){return!0},getIdentity:function(d){return this.store.getIdentity(d)},getLabel:function(d){return d[this.labelAttr]},newItem:function(d,x,t,h){return this.store.put(d,{parent:x,before:h})},pasteItem:function(d,x,t,h,f,b){var a=new G;if(x===t&&!h&&!b)return a.resolve(!0),a;x&&!h?this.getChildren(x,e.hitch(this,
function(n){n=[].concat(n);var p=O.indexOf(n,d);n.splice(p,1);this.onChildrenChange(x,n);a.resolve(this.store.put(d,{overwrite:!0,parent:t,oldParent:x,before:b,isCopy:!1}))})):a.resolve(this.store.put(d,{overwrite:!0,parent:t,oldParent:x,before:b,isCopy:!0}));return a},onChange:function(){},onChildrenChange:function(){},onDelete:function(){}})})},"jimu/dijit/_Tree":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_TreeNode.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/event dojo/query dojo/aspect dojo/on dojo/keys dojo/Evented dijit/registry dijit/Tree jimu/utils".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p){var m=O([n._TreeNode,b],{templateString:G,declaredClass:"jimu._TreeNode",isLeaf:!1,groupId:"",postCreate:function(){this.inherited(arguments);g.addClass(this.domNode,"jimu-tree-node");this.isLeaf=!!this.isLeaf;this.groupId?(this.checkNode=g.toDom('\x3cinput type\x3d"radio" /\x3e'),this.checkNode.name=this.groupId):this.checkNode=g.toDom('\x3cinput type\x3d"checkbox" /\x3e');g.addClass(this.checkNode,"jimu-tree-check-node");g.place(this.checkNode,this.contentNode,
"first");this.own(h(this.checkNode,"click",e.hitch(this,this._onClick)));this.own(h(this.rowNode,"keydown",e.hitch(this,function(k,A){A.target=k;A.keyCode!==f.ENTER&&A.keyCode!==f.SPACE||this._onClick(A)},this.checkNode)));this.isLeaf?this.groupId?g.setStyle(this.checkNode,"display","none"):g.setStyle(this.checkNode,"display","inline"):g.setStyle(this.checkNode,"display","none");this.isLeaf?g.addClass(this.domNode,"jimu-tree-leaf-node"):g.addClass(this.domNode,"jimu-tree-not-leaf-node")},select:function(){this.isLeaf&&
(this.checkNode.checked=!0,g.addClass(this.domNode,"jimu-tree-selected-leaf-node"))},unselect:function(){this.isLeaf&&(this.checkNode.checked=!1,g.removeClass(this.domNode,"jimu-tree-selected-leaf-node"))},toggleSelect:function(){this.isLeaf&&(this.checkNode.checked?this.unselect():this.select())},_onClick:function(k){(k.target||k.srcElement)===this.checkNode?this.tree._onCheckNodeClick(this,this.checkNode.checked,k):this.tree._onClick(this,k)},_onChange:function(){this.isLeaf&&setTimeout(e.hitch(this,
function(){this.checkNode.checked?this.emit("tn-select",this):this.emit("tn-unselect",this)}),100)},destroy:function(){delete this.tree;this.inherited(arguments)}});return O([n,b],{declaredClass:"jimu._Tree",openOnClick:!0,multiple:!0,uniqueId:"",showRoot:!1,postMixInProperties:function(){this.inherited(arguments);this.uniqueId="tree_"+p.getRandomString()},postCreate:function(){this.inherited(arguments);g.addClass(this.domNode,"jimu-tree");this.own(t.before(this,"onClick",e.hitch(this,this._jimuBeforeClick)));
this.rootLoadingIndicator&&g.setStyle(this.rootLoadingIndicator,"display","none");this.dndController.singular=!0;g.setAttr(this.domNode,"tabindex",0)},removeItem:function(k){this.model.store.remove(k)},getAllItems:function(){var k=this.getAllTreeNodeWidgets();return v.map(k,e.hitch(this,function(A){var w=A.item;w.selected=A.checkNode.checked;return w}))},getSelectedItems:function(){var k=this.getAllTreeNodeWidgets();k=v.filter(k,e.hitch(this,function(A){return A.checkNode.checked}));return v.map(k,
e.hitch(this,function(A){return A.item}))},getFilteredItems:function(k){var A=this.getAllTreeNodeWidgets();A=v.map(A,e.hitch(this,function(w){var q=w.item;q.selected=w.checkNode.checked;return q}));return v.filter(A,e.hitch(this,function(w){return k(w)}))},getTreeNodeByItemId:function(k){for(var A=this._getAllTreeNodeDoms(),w=0;w<A.length;w++){var q=a.byNode(A[w]);if(q.item.id.toString()===k.toString())return q}return null},selectItem:function(k){(k=this.getTreeNodeByItemId(k))&&k.isLeaf&&this.selectNodeWidget(k)},
unselectItem:function(k){(k=this.getTreeNodeByItemId(k))&&k.isLeaf&&k.unselect()},getAllLeafTreeNodeWidgets:function(){var k=this.getAllTreeNodeWidgets();return v.filter(k,e.hitch(this,function(A){return A.isLeaf}))},getAllTreeNodeWidgets:function(){var k=this._getAllTreeNodeDoms();return v.map(k,e.hitch(this,function(A){return a.byNode(A)}))},isLeafItem:function(k){return k&&k.isLeaf},_getAllTreeNodeDoms:function(){return x(".dijitTreeNode",this.domNode)},_createTreeNode:function(k){k.isLeaf=this.isLeafItem(k.item);
this.multiple||(k.groupId=this.uniqueId);return new m(k)},_onTreeNodeSelect:function(k){this.emit("item-select",{item:k.item,treeNode:k})},_onTreeNodeUnselect:function(k){this.emit("item-unselect",{item:k.item,treeNode:k})},selectNodeWidget:function(k){this.multiple||this.unselectAllLeafNodeWidgets();k.select()},_jimuBeforeClick:function(k,A,w){A.isLeaf&&(g.hasClass(w.target||w.srcElement,"jimu-tree-check-node")||(this.multiple?A.toggleSelect():this.selectNodeWidget(A)));return arguments},_onCheckNodeClick:function(k,
A,w){!this.multiple&&A&&this.unselectAllLeafNodeWidgets();d.stop(w);this.focusNode(k);setTimeout(e.hitch(this,function(){A?this.selectNodeWidget(k):k.unselect();this.onClick(k.item,k,w)}),0)},unselectAllLeafNodeWidgets:function(){var k=this.getAllLeafTreeNodeWidgets();v.forEach(k,e.hitch(this,function(A){A.unselect()}))}})})},"dijit/Tree":function(){define("dojo/_base/array dojo/aspect dojo/cookie dojo/_base/declare dojo/Deferred dojo/promise/all dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/errors/create dojo/fx dojo/has dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/topic dojo/touch dojo/when ./a11yclick ./focus ./registry ./_base/manager ./_Widget ./_TemplatedMixin ./_Container ./_Contained ./_CssStateMixin ./_KeyNavMixin dojo/text!./templates/TreeNode.html dojo/text!./templates/Tree.html ./tree/TreeStoreModel ./tree/ForestStoreModel ./tree/_dndSelector dojo/query!css2".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D,z,L,F,Q,T,E,M,J,P,R){function Y(N){return p.delegate(N.promise||N,{addCallback:function(U){this.then(U)},addErrback:function(U){this.otherwise(U)}})}var Z=G("dijit._TreeNode",[D,z,L,F,Q],{item:null,isTreeNode:!0,label:"",_setLabelAttr:function(N){this.labelNode["html"==this.labelType?"innerHTML":"innerText"in this.labelNode?"innerText":"textContent"]=N;this._set("label",N);b("dojo-bidi")&&this.applyTextDir(this.labelNode)},labelType:"text",
isExpandable:null,isExpanded:!1,state:"NotLoaded",templateString:E,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);this.isExpandable&&this.labelNode.setAttribute("aria-expanded",this.isExpanded);this.setSelected(!1)},_setIndentAttr:function(N){var U=Math.max(N,0)*this.tree._nodePixelIndent+"px";t.set(this.domNode,
"backgroundPosition",U+" 0px");t.set(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",U);O.forEach(this.getChildren(),function(ca){ca.set("indent",N+1)});this._set("indent",N)},markProcessing:function(){this.state="Loading";this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(N){var U=this.tree,ca=U.model;U._v10Compat&&N===ca.root&&(N=null);this._applyClassAndStyle(N,"icon","Icon");this._applyClassAndStyle(N,"label","Label");this._applyClassAndStyle(N,
"row","Row");this.tree._startPaint(!0)},_applyClassAndStyle:function(N,U,ca){var ja="_"+U+"Class";U+="Node";var ia=this[ja];this[ja]=this.tree["get"+ca+"Class"](N,this.isExpanded);d.replace(this[U],this[ja]||"",ia||"");t.set(this[U],this.tree["get"+ca+"Style"](N,this.isExpanded)||{})},_updateLayout:function(){var N=this.getParent();N=!N||!N.rowNode||"none"==N.rowNode.style.display;d.toggle(this.domNode,"dijitTreeIsRoot",N);d.toggle(this.domNode,"dijitTreeIsLast",!N&&!this.getNextSibling())},_setExpando:function(N){var U=
["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"];N=N?0:this.isExpandable?this.isExpanded?1:2:3;d.replace(this.expandoNode,U[N],U);this.expandoNodeText.innerHTML=["*","-","+","*"][N]},expand:function(){if(this._expandDeferred)return Y(this._expandDeferred);this._collapseDeferred&&(this._collapseDeferred.cancel(),delete this._collapseDeferred);this.isExpanded=!0;this.labelNode.setAttribute("aria-expanded","true");(this.tree.showRoot||this!==this.tree.rootNode)&&
this.containerNode.setAttribute("role","group");d.add(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","true");var N=f.wipeIn({node:this.containerNode,duration:u.defaultDuration}),U=this._expandDeferred=new e(function(){N.stop()});C.after(N,"onEnd",function(){U.resolve(!0)},!0);N.play();return Y(U)},collapse:function(){if(this._collapseDeferred)return Y(this._collapseDeferred);
this._expandDeferred&&(this._expandDeferred.cancel(),delete this._expandDeferred);this.isExpanded=!1;this.labelNode.setAttribute("aria-expanded","false");this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","false");d.remove(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);var N=f.wipeOut({node:this.containerNode,duration:u.defaultDuration}),U=this._collapseDeferred=new e(function(){N.stop()});C.after(N,"onEnd",
function(){U.resolve(!0)},!0);N.play();return Y(U)},indent:0,setChildItems:function(N){var U=this.tree,ca=U.model,ja=[],ia=U.focusedChild,X=this.getChildren();O.forEach(X,function(W){L.prototype.removeChild.call(this,W)},this);this.defer(function(){O.forEach(X,function(W){if(!W._destroyed&&!W.getParent()){U.dndController.removeTreeNode(W);(function ra(pa){var sa=ca.getIdentity(pa.item),qa=U._itemNodesMap[sa];1==qa.length?delete U._itemNodesMap[sa]:(sa=O.indexOf(qa,pa),-1!=sa&&qa.splice(sa,1));O.forEach(pa.getChildren(),
ra)})(W);if(U.persist){var ba=O.map(W.getTreePath(),function(pa){return U.model.getIdentity(pa)}).join("/"),ha;for(ha in U._openedNodes)ha.substr(0,ba.length)==ba&&delete U._openedNodes[ha];U._saveExpandedNodes()}U.lastFocusedChild&&!v.isDescendant(U.lastFocusedChild.domNode,U.domNode)&&delete U.lastFocusedChild;ia&&!v.isDescendant(ia.domNode,U.domNode)&&U.focus();W.destroyRecursive()}})});this.state="Loaded";N&&0<N.length?(this.isExpandable=!0,O.forEach(N,function(W){var ba=ca.getIdentity(W),ha=
U._itemNodesMap[ba];if(ha)for(var na=0;na<ha.length;na++)if(ha[na]&&!ha[na].getParent()){var pa=ha[na];pa.set("indent",this.indent+1);break}pa||(pa=this.tree._createTreeNode({item:W,tree:U,isExpandable:ca.mayHaveChildren(W),label:U.getLabel(W),labelType:U.model&&U.model.labelType||"text",tooltip:U.getTooltip(W),ownerDocument:U.ownerDocument,dir:U.dir,lang:U.lang,textDir:U.textDir,indent:this.indent+1}),ha?ha.push(pa):U._itemNodesMap[ba]=[pa]);this.addChild(pa);(this.tree.autoExpand||this.tree._state(pa))&&
ja.push(U._expandNode(pa))},this),O.forEach(this.getChildren(),function(W){W._updateLayout()})):this.isExpandable=!1;this._setExpando&&this._setExpando(!1);this._updateItemClasses(this.item);N=g(ja);this.tree._startPaint(N);return Y(N)},getTreePath:function(){for(var N=this,U=[];N&&N!==this.tree.rootNode;)U.unshift(N.item),N=N.getParent();U.unshift(this.tree.rootNode.item);return U},getIdentity:function(){return this.tree.model.getIdentity(this.item)},removeChild:function(N){this.inherited(arguments);
var U=this.getChildren();0==U.length&&(this.isExpandable=!1,this.collapse());O.forEach(U,function(ca){ca._updateLayout()})},makeExpandable:function(){this.isExpandable=!0;this._setExpando(!1)},setSelected:function(N){this.labelNode.setAttribute("aria-selected",N?"true":"false");d.toggle(this.rowNode,"dijitTreeRowSelected",N)},focus:function(){B.focus(this.focusNode)}});b("dojo-bidi")&&Z.extend({_setTextDirAttr:function(N){!N||this.textDir==N&&this._created||(this._set("textDir",N),this.applyTextDir(this.labelNode),
O.forEach(this.getChildren(),function(U){U.set("textDir",N)},this))}});var da=G("dijit.Tree",[D,T,z,Q],{baseClass:"dijitTree",store:null,model:null,query:null,label:"",showRoot:!0,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:!1,openOnDblClick:!1,templateString:M,persist:!1,autoExpand:!1,dndController:R,dndParams:"onDndDrop itemCreator onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),onDndDrop:null,itemCreator:null,
onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(N,U){k.publish(this.id,p.mixin({tree:this,event:N},U||{}))},postMixInProperties:function(){this.tree=this;this.autoExpand&&(this.persist=!1);this._itemNodesMap={};!this.cookieName&&this.id&&(this.cookieName=this.id+"SaveStateCookie");this.expandChildrenDeferred=new e;this.pendingCommandsPromise=this.expandChildrenDeferred.promise;this.inherited(arguments)},postCreate:function(){this._initState();
var N=this;this.own(m(this.containerNode,m.selector(".dijitTreeNode",A.enter),function(ja){N._onNodeMouseEnter(l.byNode(this),ja)}),m(this.containerNode,m.selector(".dijitTreeNode",A.leave),function(ja){N._onNodeMouseLeave(l.byNode(this),ja)}),m(this.containerNode,m.selector(".dijitTreeRow",q.press),function(ja){N._onNodePress(l.getEnclosingWidget(this),ja)}),m(this.containerNode,m.selector(".dijitTreeRow",q),function(ja){N._onClick(l.getEnclosingWidget(this),ja)}),m(this.containerNode,m.selector(".dijitTreeRow",
"dblclick"),function(ja){N._onDblClick(l.getEnclosingWidget(this),ja)}));this.model||this._store2model();this.own(C.after(this.model,"onChange",p.hitch(this,"_onItemChange"),!0),C.after(this.model,"onChildrenChange",p.hitch(this,"_onItemChildrenChange"),!0),C.after(this.model,"onDelete",p.hitch(this,"_onItemDelete"),!0));this.inherited(arguments);if(this.dndController){p.isString(this.dndController)&&(this.dndController=p.getObject(this.dndController));for(var U={},ca=0;ca<this.dndParams.length;ca++)this[this.dndParams[ca]]&&
(U[this.dndParams[ca]]=this[this.dndParams[ca]]);this.dndController=new this.dndController(this,U)}this._load();this.onLoadDeferred=Y(this.pendingCommandsPromise);this.onLoadDeferred.then(p.hitch(this,"onLoad"))},_store2model:function(){this._v10Compat=!0;a.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var N={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};this.params.mayHaveChildren&&(N.mayHaveChildren=
p.hitch(this,"mayHaveChildren"));this.params.getItemChildren&&(N.getChildren=p.hitch(this,function(U,ca,ja){this.getItemChildren(this._v10Compat&&U===this.model.root?null:U,ca,ja)}));this.model=new P(N);this.showRoot=!!this.label},onLoad:function(){},_load:function(){this.model.getRoot(p.hitch(this,function(N){var U=this.rootNode=this.tree._createTreeNode({item:N,tree:this,isExpandable:!0,label:this.label||this.getLabel(N),labelType:this.model.labelType||"text",textDir:this.textDir,indent:this.showRoot?
0:-1});this.showRoot?(this.domNode.setAttribute("aria-multiselectable",!this.dndController.singular),this.rootLoadingIndicator.style.display="none"):(U.rowNode.style.display="none",this.domNode.setAttribute("role","presentation"),this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("aria-multiselectable"),this["aria-label"]?(U.containerNode.setAttribute("aria-label",this["aria-label"]),this.domNode.removeAttribute("aria-label")):this["aria-labelledby"]&&(U.containerNode.setAttribute("aria-labelledby",
this["aria-labelledby"]),this.domNode.removeAttribute("aria-labelledby")),U.labelNode.setAttribute("role","presentation"),U.labelNode.removeAttribute("aria-selected"),U.containerNode.setAttribute("role","tree"),U.containerNode.setAttribute("aria-expanded","true"),U.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular));this.containerNode.appendChild(U.domNode);N=this.model.getIdentity(N);this._itemNodesMap[N]?this._itemNodesMap[N].push(U):this._itemNodesMap[N]=[U];U._updateLayout();
this._expandNode(U).then(p.hitch(this,function(){this._destroyed||(this.rootLoadingIndicator.style.display="none",this.expandChildrenDeferred.resolve(!0))}))}),p.hitch(this,function(N){console.error(this,": error loading root: ",N)}))},getNodesByItem:function(N){if(!N)return[];N=p.isString(N)?N:this.model.getIdentity(N);return[].concat(this._itemNodesMap[N])},_setSelectedItemAttr:function(N){this.set("selectedItems",[N])},_setSelectedItemsAttr:function(N){var U=this;return this.pendingCommandsPromise=
this.pendingCommandsPromise.always(p.hitch(this,function(){var ca=O.map(N,function(ia){return!ia||p.isString(ia)?ia:U.model.getIdentity(ia)}),ja=[];O.forEach(ca,function(ia){ja=ja.concat(U._itemNodesMap[ia]||[])});this.set("selectedNodes",ja)}))},_setPathAttr:function(N){return N.length?Y(this.set("paths",[N]).then(function(U){return U[0]})):Y(this.set("paths",[]).then(function(U){return U[0]}))},_setPathsAttr:function(N){function U(ja,ia){var X=ja.shift(),W=O.filter(ia,function(ba){return ba.getIdentity()==
X})[0];if(W)return ja.length?ca._expandNode(W).then(function(){return U(ja,W.getChildren())}):W;throw new da.PathError("Could not expand path at "+X);}var ca=this;return Y(this.pendingCommandsPromise=this.pendingCommandsPromise.always(function(){return g(O.map(N,function(ja){ja=O.map(ja,function(ia){return ia&&p.isObject(ia)?ca.model.getIdentity(ia):ia});if(ja.length)return U(ja,[ca.rootNode]);throw new da.PathError("Empty path");}))}).then(function(ja){ca.set("selectedNodes",ja);return ca.paths}))},
_setSelectedNodeAttr:function(N){this.set("selectedNodes",[N])},_setSelectedNodesAttr:function(N){this.dndController.setSelection(N)},expandAll:function(){function N(ca){return U._expandNode(ca).then(function(){var ja=O.filter(ca.getChildren()||[],function(ia){return ia.isExpandable});return g(O.map(ja,N))})}var U=this;return Y(N(this.rootNode))},collapseAll:function(){function N(ca){var ja=O.filter(ca.getChildren()||[],function(ia){return ia.isExpandable});ja=g(O.map(ja,N));return!ca.isExpanded||
ca==U.rootNode&&!U.showRoot?ja:ja.then(function(){return U._collapseNode(ca)})}var U=this;return Y(N(this.rootNode))},mayHaveChildren:function(){},getItemChildren:function(){},getLabel:function(N){return this.model.getLabel(N)},getIconClass:function(N,U){return!N||this.model.mayHaveChildren(N)?U?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf"},getLabelClass:function(){},getRowClass:function(){},getIconStyle:function(){},getLabelStyle:function(){},getRowStyle:function(){},getTooltip:function(){return""},
_onDownArrow:function(N,U){(N=this._getNext(U))&&N.isTreeNode&&this.focusNode(N)},_onUpArrow:function(N,U){if(N=U.getPreviousSibling())for(U=N;U.isExpandable&&U.isExpanded&&U.hasChildren();)U=U.getChildren(),U=U[U.length-1];else if(N=U.getParent(),this.showRoot||N!==this.rootNode)U=N;U&&U.isTreeNode&&this.focusNode(U)},_onRightArrow:function(N,U){U.isExpandable&&!U.isExpanded?this._expandNode(U):U.hasChildren()&&(U=U.getChildren()[0])&&U.isTreeNode&&this.focusNode(U)},_onLeftArrow:function(N,U){U.isExpandable&&
U.isExpanded?this._collapseNode(U):(N=U.getParent())&&N.isTreeNode&&(this.showRoot||N!==this.rootNode)&&this.focusNode(N)},focusLastChild:function(){var N=this._getLast();N&&N.isTreeNode&&this.focusNode(N)},_getFirst:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0]},_getLast:function(){for(var N=this.rootNode;N.isExpanded;){var U=N.getChildren();if(!U.length)break;N=U[U.length-1]}return N},_getNext:function(N){if(N.isExpandable&&N.isExpanded&&N.hasChildren())return N.getChildren()[0];
for(;N&&N.isTreeNode;){var U=N.getNextSibling();if(U)return U;N=N.getParent()}return null},childSelector:".dijitTreeRow",isExpandoNode:function(N,U){return v.isDescendant(N,U.expandoNode)||v.isDescendant(N,U.expandoNodeText)},_onNodePress:function(N,U){this.focusNode(N)},__click:function(N,U,ca,ja){var ia=this.isExpandoNode(U.target,N);N.isExpandable&&(ca||ia)?this._onExpandoClick({node:N}):(this._publish("execute",{item:N.item,node:N,evt:U}),this[ja](N.item,N,U),this.focusNode(N));U.stopPropagation();
U.preventDefault()},_onClick:function(N,U){this.__click(N,U,this.openOnClick,"onClick")},_onDblClick:function(N,U){this.__click(N,U,this.openOnDblClick,"onDblClick")},_onExpandoClick:function(N){N=N.node;this.focusNode(N);N.isExpanded?this._collapseNode(N):this._expandNode(N)},onClick:function(){},onDblClick:function(){},onOpen:function(){},onClose:function(){},_getNextNode:function(N){a.deprecated(this.declaredClass+"::_getNextNode(node) is deprecated. Use _getNext(node) instead.","","2.0");return this._getNext(N)},
_getRootOrFirstNode:function(){a.deprecated(this.declaredClass+"::_getRootOrFirstNode() is deprecated. Use _getFirst() instead.","","2.0");return this._getFirst()},_collapseNode:function(N){N._expandNodeDeferred&&delete N._expandNodeDeferred;if("Loading"!=N.state&&N.isExpanded){var U=N.collapse();this.onClose(N.item,N);this._state(N,!1);this._startPaint(U);return U}},_expandNode:function(N){if(N._expandNodeDeferred)return N._expandNodeDeferred;var U=this.model,ca=N.item,ja=this;N._loadDeferred||(N.markProcessing(),
N._loadDeferred=new e,U.getChildren(ca,function(ia){N.unmarkProcessing();N.setChildItems(ia).then(function(){N._loadDeferred.resolve(ia)})},function(ia){console.error(ja,": error loading "+N.label+" children: ",ia);N._loadDeferred.reject(ia)}));U=N._loadDeferred.then(p.hitch(this,function(){var ia=N.expand();this.onOpen(N.item,N);this._state(N,!0);return ia}));this._startPaint(U);return U},focusNode:function(N){for(var U=[],ca=this.domNode;ca&&ca.tagName&&"IFRAME"!==ca.tagName.toUpperCase();ca=ca.parentNode)U.push({domNode:ca.contentWindow||
ca,scrollLeft:ca.scrollLeft||0,scrollTop:ca.scrollTop||0});this.focusChild(N);this.defer(function(){for(var ja=0,ia=U.length;ja<ia;ja++)U[ja].domNode.scrollLeft=U[ja].scrollLeft,U[ja].domNode.scrollTop=U[ja].scrollTop},0)},_onNodeMouseEnter:function(){},_onNodeMouseLeave:function(){},_onItemChange:function(N){var U=this.model.getIdentity(N);if(U=this._itemNodesMap[U]){var ca=this.getLabel(N),ja=this.getTooltip(N);O.forEach(U,function(ia){ia.set({item:N,label:ca,tooltip:ja});ia._updateItemClasses(N)})}},
_onItemChildrenChange:function(N,U){N=this.model.getIdentity(N);(N=this._itemNodesMap[N])&&O.forEach(N,function(ca){ca.setChildItems(U)})},_onItemDelete:function(N){N=this.model.getIdentity(N);var U=this._itemNodesMap[N];U&&(O.forEach(U,function(ca){this.dndController.removeTreeNode(ca);var ja=ca.getParent();ja&&ja.removeChild(ca);this.lastFocusedChild&&!v.isDescendant(this.lastFocusedChild.domNode,this.domNode)&&delete this.lastFocusedChild;this.focusedChild&&!v.isDescendant(this.focusedChild.domNode,
this.domNode)&&this.focus();ca.destroyRecursive()},this),delete this._itemNodesMap[N])},_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var N=I(this.cookieName);N&&O.forEach(N.split(","),function(U){this._openedNodes[U]=!0},this)}},_state:function(N,U){if(!this.persist)return!1;var ca=O.map(N.getTreePath(),function(ja){return this.model.getIdentity(ja)},this).join("/");if(1===arguments.length)return this._openedNodes[ca];U?this._openedNodes[ca]=!0:delete this._openedNodes[ca];
this._saveExpandedNodes()},_saveExpandedNodes:function(){if(this.persist&&this.cookieName){var N=[],U;for(U in this._openedNodes)N.push(U);I(this.cookieName,N.join(","),{expires:365})}},destroy:function(){this._curSearch&&(this._curSearch.timer.remove(),delete this._curSearch);this.rootNode&&this.rootNode.destroyRecursive();this.dndController&&!p.isString(this.dndController)&&this.dndController.destroy();this.rootNode=null;this.inherited(arguments)},destroyRecursive:function(){this.destroy()},resize:function(N){N&&
x.setMarginBox(this.domNode,N);this._nodePixelIndent=x.position(this.tree.indentDetector).w||this._nodePixelIndent;this.expandChildrenDeferred.then(p.hitch(this,function(){this.rootNode.set("indent",this.showRoot?0:-1);this._adjustWidths()}))},_outstandingPaintOperations:0,_startPaint:function(N){this._outstandingPaintOperations++;this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);var U=p.hitch(this,function(){this._outstandingPaintOperations--;0>=this._outstandingPaintOperations&&
!this._adjustWidthsTimer&&this._started&&(this._adjustWidthsTimer=this.defer("_adjustWidths"))});w(N,U,U)},_adjustWidths:function(){this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);this.containerNode.style.width="auto";this.containerNode.style.width=this.domNode.scrollWidth>this.domNode.offsetWidth?"auto":"100%"},_createTreeNode:function(N){return new Z(N)},focus:function(){this.lastFocusedChild?this.focusNode(this.lastFocusedChild):this.focusFirstChild()}});
b("dojo-bidi")&&da.extend({_setTextDirAttr:function(N){N&&this.textDir!=N&&(this._set("textDir",N),this.rootNode.set("textDir",N))}});da.PathError=h("TreePathError");da._TreeNode=Z;return da})},"dijit/tree/TreeStoreModel":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(O,C,I,G){return I("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(e){G.mixin(this,
e);this.connects=[];e=this.store;if(!e.getFeatures()["dojo.data.api.Identity"])throw Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");e.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([C.after(e,"onNew",G.hitch(this,"onNewItem"),!0),C.after(e,"onDelete",G.hitch(this,"onDeleteItem"),!0),C.after(e,"onSet",G.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var e;e=this.connects.pop();)e.remove()},getRoot:function(e,g){this.root?e(this.root):
this.store.fetch({query:this.query,onComplete:G.hitch(this,function(v){if(1!=v.length)throw Error("dijit.tree.TreeStoreModel: root query returned "+v.length+" items, but must return exactly one");this.root=v[0];e(this.root)}),onError:g})},mayHaveChildren:function(e){return O.some(this.childrenAttrs,function(g){return this.store.hasAttribute(e,g)},this)},getChildren:function(e,g,v){var d=this.store;if(d.isItemLoaded(e)){for(var x=[],t=0;t<this.childrenAttrs.length;t++){var h=d.getValues(e,this.childrenAttrs[t]);
x=x.concat(h)}var f=0;this.deferItemLoadingUntilExpand||O.forEach(x,function(a){d.isItemLoaded(a)||f++});0==f?g(x):O.forEach(x,function(a,n){d.isItemLoaded(a)||d.loadItem({item:a,onItem:function(p){x[n]=p;0==--f&&g(x)},onError:v})})}else{var b=G.hitch(this,arguments.callee);d.loadItem({item:e,onItem:function(a){b(a,g,v)},onError:v})}},isItem:function(e){return this.store.isItem(e)},fetchItemByIdentity:function(e){this.store.fetchItemByIdentity(e)},getIdentity:function(e){return this.store.getIdentity(e)},
getLabel:function(e){return this.labelAttr?this.store.getValue(e,this.labelAttr):this.store.getLabel(e)},newItem:function(e,g,v){var d={parent:g,attribute:this.childrenAttrs[0]},x;this.newItemIdAttr&&e[this.newItemIdAttr]?this.fetchItemByIdentity({identity:e[this.newItemIdAttr],scope:this,onItem:function(t){t?this.pasteItem(t,null,g,!0,v):(x=this.store.newItem(e,d))&&void 0!=v&&this.pasteItem(x,g,g,!1,v)}}):(x=this.store.newItem(e,d))&&void 0!=v&&this.pasteItem(x,g,g,!1,v)},pasteItem:function(e,g,
v,d,x){var t=this.store,h=this.childrenAttrs[0];g&&O.forEach(this.childrenAttrs,function(b){if(t.containsValue(g,b,e)){if(!d){var a=O.filter(t.getValues(g,b),function(n){return n!=e});t.setValues(g,b,a)}h=b}});if(v)if("number"==typeof x){var f=t.getValues(v,h).slice();f.splice(x,0,e);t.setValues(v,h,f)}else t.setValues(v,h,t.getValues(v,h).concat(e))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(e,g){g&&this.getChildren(g.item,G.hitch(this,function(v){this.onChildrenChange(g.item,
v)}))},onDeleteItem:function(e){this.onDelete(e)},onSetItem:function(e,g){if(-1!=O.indexOf(this.childrenAttrs,g))this.getChildren(e,G.hitch(this,function(v){this.onChildrenChange(e,v)}));else this.onChange(e)}})})},"dijit/tree/ForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(O,C,I,G,e){return C("dijit.tree.ForestStoreModel",e,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(g){this.root=
{store:this,root:!0,id:g.rootId,label:g.rootLabel,children:g.rootChildren}},mayHaveChildren:function(g){return g===this.root||this.inherited(arguments)},getChildren:function(g,v,d){g===this.root?this.root.children?v(this.root.children):this.store.fetch({query:this.query,onComplete:G.hitch(this,function(x){this.root.children=x;v(x)}),onError:d}):this.inherited(arguments)},isItem:function(g){return g===this.root?!0:this.inherited(arguments)},fetchItemByIdentity:function(g){if(g.identity==this.root.id){var v=
g.scope||I.global;g.onItem&&g.onItem.call(v,this.root)}else this.inherited(arguments)},getIdentity:function(g){return g===this.root?this.root.id:this.inherited(arguments)},getLabel:function(g){return g===this.root?this.root.label:this.inherited(arguments)},newItem:function(g,v,d){return v===this.root?(this.onNewRootItem(g),this.store.newItem(g)):this.inherited(arguments)},onNewRootItem:function(){},pasteItem:function(g,v,d,x,t){if(v===this.root&&!x)this.onLeaveRoot(g);this.inherited(arguments,[g,
v===this.root?null:v,d===this.root?null:d,x,t]);if(d===this.root)this.onAddToRoot(g)},onAddToRoot:function(g){console.log(this,": item ",g," added to root")},onLeaveRoot:function(g){console.log(this,": item ",g," removed from root")},_requeryTop:function(){var g=this.root.children||[];this.store.fetch({query:this.query,onComplete:G.hitch(this,function(v){this.root.children=v;if(g.length!=v.length||O.some(g,function(d,x){return v[x]!=d}))this.onChildrenChange(this.root,v)})})},onNewItem:function(g,
v){this._requeryTop();this.inherited(arguments)},onDeleteItem:function(g){-1!=O.indexOf(this.root.children,g)&&this._requeryTop();this.inherited(arguments)},onSetItem:function(g,v,d,x){this._requeryTop();this.inherited(arguments)}})})},"dijit/tree/_dndSelector":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/dnd/common dojo/dom dojo/mouse dojo/on dojo/touch ../a11yclick ./_dndContainer".split(" "),function(O,C,I,G,e,g,v,d,x,t,h){return C("dijit.tree._dndSelector",
h,{constructor:function(){this.selection={};this.anchor=null;this.events.push(d(this.tree.domNode,x.press,G.hitch(this,"onMouseDown")),d(this.tree.domNode,x.release,G.hitch(this,"onMouseUp")),d(this.tree.domNode,x.move,G.hitch(this,"onMouseMove")),d(this.tree.domNode,t.press,G.hitch(this,"onClickPress")),d(this.tree.domNode,t.release,G.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var f=[],b=this.selection,a;for(a in b)f.push(b[a]);return f},selectNone:function(){this.setSelection([]);
return this},destroy:function(){this.inherited(arguments);this.selection=this.anchor=null},addTreeNode:function(f,b){this.setSelection(this.getSelectedTreeNodes().concat([f]));b&&(this.anchor=f);return f},removeTreeNode:function(f){var b=O.filter(this.getSelectedTreeNodes(),function(a){return!g.isDescendant(a.domNode,f.domNode)});this.setSelection(b);return f},isTreeNodeSelected:function(f){return f.id&&!!this.selection[f.id]},setSelection:function(f){var b=this.getSelectedTreeNodes();O.forEach(this._setDifference(b,
f),G.hitch(this,function(a){a.setSelected(!1);this.anchor==a&&delete this.anchor;delete this.selection[a.id]}));O.forEach(this._setDifference(f,b),G.hitch(this,function(a){a.setSelected(!0);this.selection[a.id]=a}));this._updateSelectionProperties()},_setDifference:function(f,b){O.forEach(b,function(a){a.__exclude__=!0});f=O.filter(f,function(a){return!a.__exclude__});O.forEach(b,function(a){delete a.__exclude__});return f},_updateSelectionProperties:function(){var f=this.getSelectedTreeNodes(),b=
[],a=[];O.forEach(f,function(n){var p=n.getTreePath();a.push(n);b.push(p)},this);f=O.map(a,function(n){return n.item});this.tree._set("paths",b);this.tree._set("path",b[0]||[]);this.tree._set("selectedNodes",a);this.tree._set("selectedNode",a[0]||null);this.tree._set("selectedItems",f);this.tree._set("selectedItem",f[0]||null)},onClickPress:function(f){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(f.target,this.current))){"mousedown"==f.type&&v.isLeft(f)&&f.preventDefault();
var b="keydown"==f.type?this.tree.focusedChild:this.current;if(b){var a=e.getCopyKeyState(f),n=b.id;this.singular||f.shiftKey||!this.selection[n]?(this._doDeselect=!1,this.userSelect(b,a,f.shiftKey)):this._doDeselect=!0}}},onClickRelease:function(f){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==f.type?this.tree.focusedChild:this.current,e.getCopyKeyState(f),f.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(f,
b){if(f===b)return 0;if("sourceIndex"in document.documentElement)return f.sourceIndex-b.sourceIndex;if("compareDocumentPosition"in document.documentElement)return f.compareDocumentPosition(b)&2?1:-1;if(document.createRange){var a=doc.createRange();a.setStartBefore(f);f=doc.createRange();f.setStartBefore(b);return a.compareBoundaryPoints(a.END_TO_END,f)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");},userSelect:function(f,b,a){if(this.singular)this.anchor==
f&&b?this.selectNone():(this.setSelection([f]),this.anchor=f);else if(a&&this.anchor){b=this._compareNodes(this.anchor.rowNode,f.rowNode);a=this.anchor;0>b?b=a:(b=f,f=a);for(a=[];b!=f;)a.push(b),b=this.tree._getNext(b);a.push(f);this.setSelection(a)}else this.selection[f.id]&&b?this.removeTreeNode(f):b?this.addTreeNode(f,!0):(this.setSelection([f]),this.anchor=f)},getItem:function(f){return{data:this.selection[f],type:["treeNode"]}},forInSelectedItems:function(f,b){b=b||I.global;for(var a in this.selection)f.call(b,
this.getItem(a),a,this)}})})},"dijit/tree/_dndContainer":function(){define("dojo/aspect dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/on dojo/touch".split(" "),function(O,C,I,G,e,g){return C("dijit.tree._dndContainer",null,{constructor:function(v,d){this.tree=v;this.node=v.domNode;G.mixin(this,d);this.containerState="";I.add(this.node,"dojoDndContainer");this.events=[e(this.node,g.enter,G.hitch(this,"onOverEvent")),e(this.node,g.leave,G.hitch(this,"onOutEvent")),O.after(this.tree,"_onNodeMouseEnter",
G.hitch(this,"onMouseOver"),!0),O.after(this.tree,"_onNodeMouseLeave",G.hitch(this,"onMouseOut"),!0),e(this.node,"dragstart, selectstart",function(x){x.preventDefault()})]},destroy:function(){for(var v;v=this.events.pop();)v.remove();this.node=this.parent=null},onMouseOver:function(v){this.current=v},onMouseOut:function(){this.current=null},_changeState:function(v,d){var x="dojoDnd"+v;v=v.toLowerCase()+"State";I.replace(this.node,x+d,x+this[v]);this[v]=d},_addItemClass:function(v,d){I.add(v,"dojoDndItem"+
d)},_removeItemClass:function(v,d){I.remove(v,"dojoDndItem"+d)},onOverEvent:function(){this._changeState("Container","Over")},onOutEvent:function(){this._changeState("Container","")}})})},"jimu/dijit/LayerChooserFromMapWithDropbox":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/Deferred dijit/popup dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/LayerChooserFromMapWithDropbox.html jimu/LayerInfos/LayerInfos".split(" "),function(O,
C,I,G,e,g,v,d,x,t,h,f){return O([x,t,g],{templateString:h,baseClass:"jimu-layer-chooser-from-map-withdropbox",declaredClass:"jimu.dijit.LayerChooserFromMapWithDropbox",_selectedItem:null,_isLayerChooserShow:!1,layerInfosObj:null,layerChooser:null,customClass:"",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.queryableLayerSource;this.nls.customSelectLayer=this.label?this.label:this.nls.selectLayer},postCreate:function(){this.inherited(arguments);this.layerInfosObj=
f.getInstanceSync();this.layerChooser.domNode.style.zIndex=1;this.layerChooser.tree.domNode.style.borderTop="0";this.layerChooser.tree.domNode.style.maxHeight="290px";this.own(G(this.layerChooser,"tree-click",C.hitch(this,this._onTreeClick)));this.own(G(this.layerChooser,"update",C.hitch(this,this._onLayerChooserUpdate)));this.own(G(document.body,"click",C.hitch(this,this._onBodyClicked)));this.own(G(document.body,"keydown",C.hitch(this,function(b){b.keyCode===e.ENTER&&this._onBodyClicked(b)})));
this.own(G(this.layerChooser.domNode,"keydown",C.hitch(this,function(b){b.keyCode===e.ESCAPE&&this.hideLayerChooser()})))},destroy:function(){this.hideLayerChooser();this.layerChooser&&this.layerChooser.destroy();this.layerChooser=null;this.inherited(arguments)},getLayerChooser:function(){return this.layerChooser},setSelectedLayer:function(b){var a=new v;if(b){var n=this.layerInfosObj.getLayerOrTableInfoById(b.id);n?this.layerChooser.filter(n).then(C.hitch(this,function(p){p?(this._onSelectNewItem({layerInfo:n,
name:n.title,url:b.url}),a.resolve(!0)):a.resolve(!1)}),C.hitch(this,function(){a.resolve(!1)})):a.resolve(!1)}else this._onSelectNewItem(null),a.resolve(!0);return a},getSelectedItem:function(){return this._selectedItem},getSelectedItems:function(){return[this._selectedItem]},_onBodyClicked:function(b){b=b.target||b.srcElement;b===this.domNode||I.isDescendant(b,this.domNode)||b===this.layerChooser.domNode||I.isDescendant(b,this.layerChooser.domNode)||this.hideLayerChooser()},_onDropDownClick:function(b){b.stopPropagation();
b.preventDefault();this._isLayerChooserShow?this.hideLayerChooser():(this.isActive=!0,this.showLayerChooser())},_onDropDownKeydown:function(b){b.keyCode===e.ENTER&&this._onDropDownClick(b)},_getSelectedItems:function(){return this.layerChooser.getSelectedItems()},showLayerChooser:function(){this.layerChooser.domNode.style.minWidth=this.domNode.clientWidth+2+"px";d.open({parent:this,popup:this.layerChooser,around:this.domNode});var b=this.layerChooser.domNode.parentNode;b&&(I.addClass(b,"jimu-layer-chooser-from-map-withdropbox-popup"),
this.customClass&&I.addClass(b,this.customClass),this.layerChooser.tree.domNode.focus());this._isLayerChooserShow=!0},hideLayerChooser:function(){d.close(this.layerChooser);this._isLayerChooserShow=!1;this.isActive&&(this.dropDownBtn.focus(),this.isActive=!1)},_onLayerChooserUpdate:function(){this._selectedItem&&this.layerChooser.onlyShowVisible&&!this._selectedItem.layerInfo.isShowInMap()&&(this._selectedItem=null,this.emit("selection-change",[]))},_onSelectNewItem:function(b){var a=C.getObject("layerInfo.id",
!1,this._selectedItem)||-1,n=C.getObject("layerInfo.id",!1,b)||-1;a=a!==n;this._selectedItem=b;this.hideLayerChooser();b=C.getObject("layerInfo.title",!1,this._selectedItem)||"";this.layerNameNode.innerHTML=b;I.setAttr(this.layerNameNode,"title",b);b=C.getObject("layerInfo.layerObject",!1,this._selectedItem);a&&this.emit("selection-change",[b])},_onTreeClick:function(){var b=this._getSelectedItems();this._onSelectNewItem(0<b.length?b[0]:null)}})})},"widgets/SmartEditor/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/geometry/Extent jimu/utils esri/dijit/AttributeInspector".split(" "),
function(O,C,I,G,e,g){var v={};v.ATI=O([g],{constructor:function(){this._aiConnects=[];this._selection=[];this._toolTips=[]}});v.checkIfFieldAliasAlreadyExists=function(d,x){return 0<=d.split(",").indexOf(x)};v.pointToExtent=function(d,x,t){var h=d.extent.getWidth()/d.width;t*=h;return new G(x.x-t,x.y-t,x.x+t,x.y+t,d.spatialReference)};v.filterOnlyUpdatedAttributes=function(d,x,t){if(null===x||void 0===x)return d;var h={},f;for(f in d)d.hasOwnProperty(f)&&(f===t.objectIdField||f===t.globalIdField?
h[f]=d[f]:(null!==d[f]||""!==x[f])&&d[f]!==x[f]&&(h[f]=d[f]));return h};v.mergeFieldInfosWithConfiguration=function(d,x){var t=[],h=this.getDefaultEditableFieldInfos(d,!1);x&&x.fieldInfos?(I.forEach(x.fieldInfos,function(a){I.some(h,function(n){if(a.fieldName===n.fieldName)return t.push(this.mergeLastToFirst(n,a)),!0},this)},this),I.forEach(h,function(a){0===I.filter(t,function(n){return n.fieldName===a.fieldName},this).length&&t.push(a)},this)):t=h;var f=[];d.layerObject.hasOwnProperty("globalIdField")&&
void 0!==d.layerObject.globalIdField&&null!==d.layerObject.globalIdField&&f.push(d.layerObject.globalIdField);d.layerObject.hasOwnProperty("objectIdField")&&void 0!==d.layerObject.objectIdField&&null!==d.layerObject.objectIdField&&f.push(d.layerObject.objectIdField);if(d.layerObject.hasOwnProperty("editFieldsInfo")&&void 0!==d.layerObject.editFieldsInfo&&null!==d.layerObject.editFieldsInfo)for(var b in d.layerObject.editFieldsInfo)d.layerObject.editFieldsInfo.hasOwnProperty(b)&&f.push(d.layerObject.editFieldsInfo[b]);
return t=t.filter(function(a){return-1!==I.indexOf(f,a.fieldName)?!1:a.isEditableOnLayer})};v.getDefaultEditableFieldInfos=function(d,x){var t=[],h=this.getFieldInfosFromWebmap(d);d=this.getFieldInfosLayer(d);if(void 0===h||null===h)h=d;else{var f=[];I.forEach(d,function(b){0===I.filter(h,function(a){return a.name===b.fieldName}).length&&(b.isEditableOnLayer=b.editable,f.push(b))});0<f.length&&(h=h.concat(f))}I.forEach(h,function(b){!1===b.hasOwnProperty("isEditableOnLayer")&&(b.isEditableOnLayer=
b.editable);!1===b.editable&&(b.isEditable=b.editable);!1===b.isEditable&&(b.editable=b.isEditable);!0===b.editable&&(b.visible=!0);b.fieldName=b.name;!0===b.editable&&!0===x?t.push(C.clone(b)):!1===x&&t.push(C.clone(b))});return t};v.updatePopupDateFormat=function(d){var x={shortDate:{datePattern:"M/d/y"},shortDateLE:{datePattern:"d/M/y"},longMonthDayYear:{datePattern:"MMMM d, y"},dayShortMonthYear:{datePattern:"d MMM y"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",
timePattern:"h:mm a",timeEnabled:!0},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",timeEnabled:!0},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",timeEnabled:!0},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",timeEnabled:!0},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",timeEnabled:!0},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",timeEnabled:!0},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",timeEnabled:!0},
shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",timeEnabled:!0},longMonthYear:{datePattern:"MMMM y"},shortMonthYear:{datePattern:"MMM y"},year:{datePattern:"y"}},t="",h;for(h in x)if(e.isEqual(d,x[h])){t=h;break}return t};v.getFieldInfosFromWebmap=function(d){var x=null,t=d.getPopupInfo();t&&t.fieldInfos&&(x=[],I.forEach(t.fieldInfos,function(h){I.some(d.layerObject.fields,function(f){if(f.name===h.fieldName)return f=this.mergeFirstToLast(h,f),f.format&&f.format.dateFormat&&(f.format.dateFormat.hasOwnProperty("datePattern")||
f.format.dateFormat.hasOwnProperty("timePattern"))&&(f.format.dateFormat=this.updatePopupDateFormat(f.format.dateFormat)),f.format&&f.format.dateFormat&&f.format.dateFormat.toLowerCase()&&0<=f.format.dateFormat.toLowerCase().indexOf("time")&&(f.format.time=!0),x.push(f),!0},this)},this));return x};v.getFieldInfosLayer=function(d){var x=[];d&&d.layerObject&&I.forEach(d.layerObject.fields,function(t){var h=e.getDefaultPortalFieldInfo(t);h=this.mergeFirstToLast(h,t);h.format&&h.format.dateFormat&&(h.format.dateFormat.hasOwnProperty("datePattern")||
h.format.dateFormat.hasOwnProperty("timePattern"))&&(h.format.dateFormat=this.updatePopupDateFormat(h.format.dateFormat));h.format&&h.format.dateFormat&&h.format.dateFormat.toLowerCase()&&0<=h.format.dateFormat.toLowerCase().indexOf("time")&&(h.format.time=!0);h.visible=!0;x.push(h)},this);return x};v.getConfigInfos=function(d,x,t,h,f){var b=[],a=d.getLayerInfoArrayOfWebmap(),n=[];f&&(n=d.getTableInfoArrayOfWebmap(),a=a.concat(n));I.forEach(a,function(p){var m=!1;"Table"!==p.layerObject.type&&"Feature Layer"!==
p.layerObject.type||!p.layerObject.url||(p.layerObject.isEditable&&p.layerObject.isEditable()&&t?m=!0:void 0!==t&&!1===t&&(m=!0));if(!0===m){var k=this.getConfigInfo(p,x);k.layerInfo=p;!0===k.featureLayer.layerAllowsDelete&&!1===k.featureLayer.layerAllowsCreate&&!1===k.featureLayer.layerAllowsUpdate?console.warn(k.layerInfo.title+" delete only not supported"):h&&!0===h?!0===I.some(x,function(A){return A.featureLayer.id===k.featureLayer.id})&&b.push(k):b.push(k)}},this);return b};v.getConfigInfo=function(d,
x){var t=null,h=this.createDefaultConfigInfo(d);!1===I.some(x,function(f){return f.featureLayer&&f.featureLayer.id===d.layerObject.id?(t=C.clone(f),t.fieldInfos=this.mergeFieldInfosWithConfiguration(d,t),t=this.mergeDefaultWithConfig(t,h),!0):!1},this)&&(t=h);return t};v.mergeDefaultWithConfig=function(d,x){d.featureLayer=x.featureLayer;!0===d.allowDelete&&!1===d.featureLayer.layerAllowsDelete&&(d.allowDelete=!1);!1===d.disableGeometryUpdate&&!1===d.featureLayer.layerAllowGeometryUpdates&&(d.disableGeometryUpdate=
!0);!1===d.featureLayer.layerAllowsCreate&&!0===d.featureLayer.layerAllowsUpdate&&(d.allowUpdateOnly=!0);return d};v.createDefaultConfigInfo=function(d){var x=!1,t=!1,h=!1,f=!1;try{var b=d.layerObject.getEditCapabilities();b.canCreate&&(x=!0);b.canUpdate&&(f=t=!0);b.canDelete&&(h=!0)}catch(a){d.layerObject.hasOwnProperty("capabilities")&&(-1===String(d.layerObject.capabilities).indexOf("Update")&&-1===String(d.layerObject.capabilities).indexOf("Delete")&&-1===String(d.layerObject.capabilities).indexOf("Create")&&
-1!==String(d.layerObject.capabilities).indexOf("Editing")?x=h=t=!0:(-1!==String(d.layerObject.capabilities).indexOf("Update")&&(f=t=!0),-1!==String(d.layerObject.capabilities).indexOf("Delete")&&(h=!0),-1!==String(d.layerObject.capabilities).indexOf("Create")&&(x=!0)))}d.layerObject.hasOwnProperty("allowGeometryUpdates")&&(f=d.layerObject.allowGeometryUpdates);"Table"===d.layerObject.type&&d.layerObject.url&&d.getCapabilitiesOfWebMap()&&(t=d.getCapabilitiesOfWebMap(),d.layerObject.isEditable&&d.layerObject.isEditable()&&
t&&-1<t.toLowerCase().indexOf("editing")?t=!0:h=t=x=!1,f=!1);f=f&&t;return{featureLayer:{id:d.layerObject.id,layerAllowsCreate:x,layerAllowsUpdate:t,layerAllowsDelete:h,layerAllowGeometryUpdates:f},disableGeometryUpdate:!f,allowUpdateOnly:!x,allowDelete:!1,fieldInfos:this.mergeFieldInfosWithConfiguration(d,null),_editFlag:x||t?!0:!1}};v.mergeLastToFirst=function(){for(var d={},x=0,t=arguments.length,h;x<t;x++)for(h in arguments[x])arguments[x].hasOwnProperty(h)&&(d[h]=arguments[x][h]);return d};v.mergeFirstToLast=
function(){for(var d={},x=arguments.length-1,t;0<=x;x--)for(t in arguments[x])arguments[x].hasOwnProperty(t)&&(d[t]=arguments[x][t]);return d};v.isObjectEmpty=function(d){if(d)for(var x in d)if(d.hasOwnProperty(x))return!1;return!0};v.addDateTimeFormat=function(d){d&&d.format&&null!==d.format&&d.format.dateFormat&&null!==d.format.dateFormat&&0<=d.format.dateFormat.toString().toUpperCase().indexOf("TIME")&&(d.format.time=!0)};v.isDuplicateGroupName=function(d,x){var t=!1;I.some(x,C.hitch(this,function(h){if(d.toLowerCase()===
h.toLowerCase())return t=!0}));return t};return v})},"widgets/SmartEditor/presetBuilderBackwardCompatibility":function(){define(["dojo/_base/lang","dojo/_base/array","jimu/utils","./presetUtils"],function(O,C,I,G){var e={createPresetGroups:function(g,v){e.config=g;e._jimuLayerInfos=v;if(g.editor.presetInfos&&0<Object.keys(g.editor.presetInfos).length&&(g.attributeActionGroups?g.attributeActionGroups&&!g.attributeActionGroups.hasOwnProperty("Preset")&&(g.attributeActionGroups.Preset={}):g.attributeActionGroups=
{Intersection:{},Address:{},Coordinates:{},Preset:{}},!(g.attributeActionGroups&&g.attributeActionGroups.Preset&&0<Object.keys(g.attributeActionGroups.Preset).length)))for(var d in g.editor.presetInfos)e._addPresetGroupForField(g.editor.configInfos||g.editor.layerInfos,d)},_getDomainListForPresetGroup:function(g,v,d){var x=[];C.forEach(v.domain.codedValues,O.hitch(this,function(t){var h={showInList:!0,value:t.code,label:t.name,isDefault:!1};g.showOnlyDomainFields=!0;var f=e.config.editor.presetInfos[d][0];
"esriFieldTypeInteger"===g.dataType&&(f=Number(f));0<e.config.editor.presetInfos[d].length?t.code===f&&(h.isDefault=!0):0===x.length&&(h.isDefault=!0);x.push(h)}));return x},_addPresetGroupForField:function(g,v){var d;C.some(g,O.hitch(this,function(x){if(d)return!0;if(x.fieldValues&&x.fieldValues[v])for(var t=x.fieldValues[v],h=0;h<t.length;h++)if("Preset"===t[h].actionName&&t[h].enabled){t[h].attributeActionGroupName=v;var f=e._jimuLayerInfos.getLayerOrTableInfoById(x.featureLayer.id);if(f&&f.layerObject&&
f.layerObject.fields){h=G.getFieldInfoByFieldName(f.layerObject.fields,v);f=I.getDefaultPortalFieldInfo(h).label+" ("+v+")";t={};t.name=f;0<["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(h.type)?t.dataType="esriFieldTypeInteger":t.dataType=h.type;t.showOnlyDomainFields=!1;t.hideInPresetDisplay=!1;t.appliedOn=e._getPresetFieldsForAppliedOn(h,t);if(h.domain&&"range"!==h.domain.type)t.presetValue=e._getDomainListForPresetGroup(t,
h,v);else if("esriFieldTypeDate"===h.type){var b,a;0<e.config.editor.presetInfos[v].length?(isNaN(e.config.editor.presetInfos[v][0])||""===e.config.editor.presetInfos[v][0]||(a=new Date(e.config.editor.presetInfos[v][0])),e.config.editor.presetInfos[v][1]&&!isNaN(e.config.editor.presetInfos[v][1])&&(b=new Date(e.config.editor.presetInfos[v][1])),b=a&&b?new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds()):a,t.presetValue=b?{dateType:"fixed",
dateTime:b.getTime()}:{dateType:"fixed",dateTime:""}):t.presetValue={dateType:"fixed",dateTime:""}}else t.presetValue=0<e.config.editor.presetInfos[v].length?e.config.editor.presetInfos[v][0]:null;e.config.attributeActionGroups.Preset[t.name]=t;d=!0;break}}!d&&x.relationshipInfos&&0<x.relationshipInfos.length&&(d=e._addPresetGroupForField(x.relationshipInfos,v))}));return d},_isPresetEnabledForLayer:function(g,v,d,x){if(g.fieldValues[v.name])for(var t=g.fieldValues[v.name],h=0;h<t.length;h++)if("Preset"===
t[h].actionName&&t[h].enabled){var f=e._jimuLayerInfos.getLayerOrTableInfoById(g.featureLayer.id).layerObject.fields;G.getFieldInfoByFieldName(f,v.name).type===v.type&&(t[h].attributeActionGroupName=x.name,d.hasOwnProperty(g.featureLayer.id)?d[g.featureLayer.id].push(v.name):d[g.featureLayer.id]=[v.name])}return d},_getPresetFieldsForAppliedOn:function(g,v){var d={};C.forEach(e.config.editor.configInfos||e.config.editor.layerInfos,O.hitch(this,function(x){x.fieldValues&&x.fieldValues[g.name]&&(d=
e._isPresetEnabledForLayer(x,g,d,v));x.relationshipInfos&&0<x.relationshipInfos.length&&C.forEach(x.relationshipInfos,O.hitch(this,function(t){t.fieldValues&&t.fieldValues[g.name]&&(d=e._isPresetEnabledForLayer(t,g,d,v))}))}));return d}};return e})},"widgets/SmartEditor/smartAttributes":function(){define("dojo/Evented dojo dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dojo/on dojo/query dijit/registry jimu/filterUtils jimu/dijit/Filter jimu/BaseWidgetSetting".split(" "),function(O,
C,I,G,e,g,v,d,x,t,h,f){return I([f,O],{_attrInspector:null,_fieldValidation:null,_feature:null,_fieldInfo:null,_gdbRequiredFields:null,_notEditableFields:null,_fieldNameToAlias:null,_fieldsWithRules:null,_attTable:null,_filterUtils:null,_mapLayer:null,OPERATORS:null,constructor:function(){this.inherited(arguments);G.mixin(this,arguments[0]);String.prototype.endsWith||(String.prototype.endsWith=function(a,n){if(void 0===n||n>this.length)n=this.length;return this.substring(n-a.length,n)===a});this.useFieldName=
!1;this._mapLayer=this._feature.getLayer();this._attTable=d("td.atiLabel",this._attrInspector.domNode);if(0<this._attTable.length){var b=this._attTable[0];b&&b.hasAttribute("data-fieldname")&&(this.useFieldName=!0)}this._processLayer();this._filterUtils=new t;this.OPERATORS=G.clone(this._filterUtils.OPERATORS);void 0!==this._attTable&&null!==this._attTable&&this._bindEvents()},_processLayer:function(){this._gdbRequiredFields=[];this._notEditableFields=[];this._fieldsWithRules=[];e.forEach(this._fieldInfo,
function(b){if(!0===this.useFieldName||!1===b.hasOwnProperty("label"))var a=b.fieldName;else a=b.label,0<=a.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')&&(a=a.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',""));!1===b.nullable&&!0===b.isEditable&&this._gdbRequiredFields.push(a);!1!==b.isEditable&&!1!==b.isEditableSettingInWebmap||this._notEditableFields.push(a);this._fieldValidation&&this._fieldValidation.hasOwnProperty(b.fieldName)&&this._fieldsWithRules.push(a)},this)},
toggleFields:function(b){b="undefined"!==typeof b&&null!==b?b:!0;if(void 0!==this._attTable&&null!==this._attTable&&void 0!==this._fieldValidation&&null!==this._fieldValidation&&void 0!==this._feature&&null!==this._feature){var a=null,n=[],p;e.forEach(this._fieldInfo,G.hitch(this,function(m){if(!0===this.useFieldName||!1===m.hasOwnProperty("label"))var k=m.fieldName;else k=m.label,0<=k.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')&&(k=k.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',
""));a=null;p=this.validateField(m.fieldName);a=p[1];if("Required"===a&&"esriFieldTypeDate"===m.type){var A=this._getDijitForField(m.fieldName);A&&1<A.length&&null===A[1].get("value")&&(p[2]=!1)}p[2]&&"esriFieldTypeDate"===m.type&&(A=this._getDijitForField(m.fieldName))&&1<A.length&&null===A[0].get("value")&&(p[2]=!1);!1===p[2]&&n.push({fieldName:m.fieldName});!0===p[0]&&this.toggleFieldOnAttributeInspector(k,a,p[2],b,m.isEditable)}));return n}},_getDijitForField:function(b){var a;e.some(this._attrInspector._currentLInfo.fieldInfos,
G.hitch(this,function(n){if(n.fieldName===b)return a=n.dijit,!0}));return a},validateField:function(b){var a=null;if(this._fieldValidation.hasOwnProperty(b)){if(0===this._fieldValidation[b].length)return[!1,null,!0];var n=[!1,null,null];e.some(this._fieldValidation[b],function(p){if(void 0!==p.filter&&null!==p.filter&&(a=p.filter,n=[!0,null,null],this.processFilter(a,this._feature)))return"Required"===p.actionName?!1===this._feature.attributes.hasOwnProperty(b)?(n=[!0,p.actionName,!1],!0):null===
this._feature.attributes[b]||""===this._feature.attributes[b]?(n=[!0,p.actionName,!1],!0):this.myIsNaN(this._feature.attributes[b])?(n=[!0,p.actionName,!1],!0):(n=[!0,p.actionName,!0],!0):(n=[!0,p.actionName,null,p.submitWhenHidden],!0)},this);return n}return[!1,null,null]},_bindEvents:function(){void 0!==this._attTable&&null!==this._attTable&&0<this._attTable.length&&e.forEach(this._attTable,function(b){b=this._getRowInfo(b);-1!==this._fieldsWithRules.indexOf(b[3])&&"dijit.form.FilteringSelect"===
b[2].declaredClass&&v(b[2],"change",G.hitch(this,this._smartComboValidate()))},this)},process_relative_date:function(b,a,n){var p=new Date,m=this._isNumeric(a);if(void 0===b||null===b||""===b)return a;if(b==this.OPERATORS.dateOperatorMinutes&&!0===m)return p.setMinutes(p.getMinutes()-a);if(b==this.OPERATORS.dateOperatorHours&&!0===m)return p.setHours(p.getHours()-a);if(b==this.OPERATORS.dateOperatorDays&&!0===m)return p.setDate(p.getDate()-a);if(b==this.OPERATORS.dateOperatorWeeks&&!0===m)return p.setDate(p.getDate()-
7*a);if(b==this.OPERATORS.dateOperatorMonths&&!0===m)return p.setMonth(p.getMonth()-a);if(b==this.OPERATORS.dateOperatorYears&&!0===m)return p.setFullYear(p.getFullYear()-a);if("today"==b.toLowerCase())return(new Date(p.setDate(p.getDate()))).setHours(23,59,59,999);if("tomorrow"==b.toLowerCase())return(new Date(p.setDate(p.getDate()+1))).setHours(23,59,59,999);if("yesterday"==b.toLowerCase())return(new Date(p.setDate(p.getDate()-1))).setHours(23,59,59,999);if("thisweek"==b.toLowerCase()){var k=(new Date(p.setDate(p.getDate()-
p.getDay()))).setHours(0,0,0,0),A=(new Date(p.setDate(p.getDate()-p.getDay()+6))).setHours(23,59,59,999);return!0===n?k:A}if("thismonth"==b.toLowerCase())return k=(new Date(p.getFullYear(),p.getMonth(),1)).getTime(),A=(new Date(p.getFullYear(),p.getMonth()+1,0)).setHours(23,59,59,999),!0===n?k:A;if("thisquarter"==b.toLowerCase()){b=new Date(p.getTime());var w=b.getFullYear();b.setHours(0,0,0,0);a=(new Date(w,2,31)).setHours(23,59,59,999);m=(new Date(w,5,30)).setHours(23,59,59,999);var q=(new Date(w,
8,30)).setHours(23,59,59,999);w=(new Date(w,11,31)).setHours(23,59,59,999);b<=a&&(k=(new Date(p.getFullYear(),0,1)).getTime(),A=m);b<=m&&(k=a,A=m);b<=q&&(k=m,A=q);b<=w&&(k=q,A=w);return!0===n?k:A}return"thisyear"==b.toLowerCase()?(A=(new Date(p.getFullYear(),11,31)).setHours(23,59,59,999),k=(new Date(p.getFullYear(),0,1)).getTime(),!0===n?k:A):a},process_part:function(b){var a=null,n=null,p=null,m=null,k=null,A=null;b.valueObj.hasOwnProperty("value")&&(a=void 0===b.valueObj.virtualDate||null===b.valueObj.virtualDate?
null:b.valueObj.virtualDate,k=void 0===b.valueObj.range||null===b.valueObj.range?null:b.valueObj.range,n=b.valueObj.value);b.valueObj.hasOwnProperty("value1")&&(a=void 0===b.valueObj.virtualDate1||null===b.valueObj.virtualDate1?null:b.valueObj.virtualDate1,null===a&&(a=void 0===b.valueObj.virtualDate||null===b.valueObj.virtualDate?null:b.valueObj.virtualDate),k=void 0===b.valueObj.range1||null===b.valueObj.range1?null:b.valueObj.range1,n=b.valueObj.value1);b.valueObj.hasOwnProperty("value2")&&(p=
void 0===b.valueObj.virtualDate2||null===b.valueObj.virtualDate2?null:b.valueObj.virtualDate2,null===p&&(p=void 0===b.valueObj.virtualDate||null===b.valueObj.virtualDate?null:b.valueObj.virtualDate),A=void 0===b.valueObj.range2||null===b.valueObj.range2?null:b.valueObj.range2,m=b.valueObj.value2);"esriFieldTypeDate"==b.fieldObj.type&&(b.operator==this.OPERATORS.dateOperatorInTheLast?(null!==k&&(n=this.process_relative_date(k,n)),null!==A&&(m=this.process_relative_date(A,m))):b.operator==this.OPERATORS.dateOperatorNotInTheLast?
(null!==k&&(n=this.process_relative_date(k,n)),null!==A&&(m=this.process_relative_date(A,m))):b.operator==this.OPERATORS.dateOperatorIsIn?(n=this.process_relative_date(a,n,!0),m=this.process_relative_date(p,m,!1)):b.operator==this.OPERATORS.dateOperatorIsNotIn?(n=this.process_relative_date(a,n,!0),m=this.process_relative_date(p,m,!1)):(null!==a&&(n=this.process_relative_date(a,n,!1)),null!==p&&(m=this.process_relative_date(p,m,!1))));return[n,m]},processFilter:function(b){var a=[];e.forEach(b.parts,
function(n){if(n.hasOwnProperty("parts"))a.push(this.processFilter(n,this._feature));else{var p=this.process_part(n),m=p[0];p=p[1];switch(n.valueObj.type){case "value":a.push(this.validatePart(n.operator,this._feature.attributes[n.fieldObj.name],m,p,n.caseSensitive));break;case "unique":a.push(this.validatePart(n.operator,this._feature.attributes[n.fieldObj.name],m,p,n.caseSensitive));break;case "field":this._feature.attributes.hasOwnProperty(m)&&(m=this._feature.attributes[m]),a.push(this.validatePart(n.operator,
this._feature.attributes[n.fieldObj.name],m,p,n.caseSensitive))}}},this);return this.ruleValid(a,b.logicalOperator)},ruleValid:function(b,a){var n=!1;if(void 0===a||null===a)a="OR";e.some(b,function(p){if("OR"===a){if(!0===p)return n=!0;n=!1}else{if(!1===p)return n=!1,!0;n=!0}});return n},myIsNaN:function(b){return b!==b},_isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},validatePart:function(b,a,n,p,m){var k=null;if(void 0===b||null===b)return!1;0===b.lastIndexOf("string",0)?!1===
m&&(void 0!==a&&null!==a&&(a=String(a).toUpperCase()),void 0!==n&&null!==n&&(n=String(n).toUpperCase()),void 0!==p&&null!==p&&(p=String(p).toUpperCase())):0===b.lastIndexOf("date",0)&&(void 0!==n&&null!==n&&(n=new Date(n)),void 0!==p&&null!==p&&(p=new Date(p)));switch(b){case this.OPERATORS.stringOperatorIs:if(a===n)return!0;break;case this.OPERATORS.stringOperatorIsNot:if(a!==n)return!0;break;case this.OPERATORS.stringOperatorStartsWith:if(null===a&&null===n)return!0;if(null===a&&null!==n)break;
if(null!==a&&null===n)break;if(0===a.lastIndexOf(n,0))return!0;break;case this.OPERATORS.stringOperatorEndsWith:if(null===a&&null===n)return!0;if(null===a&&null!==n)break;if(null!==a&&null===n)break;return a.endsWith(n);case this.OPERATORS.stringOperatorContains:if(null===a&&null===n)return!0;if(null===a&&null!==n)break;if(null!==a&&null===n)break;if(0<=String(a).toUpperCase().indexOf(n.toUpperCase()))return!0;break;case this.OPERATORS.stringOperatorDoesNotContain:if(null===a&&null===n)break;if(null===
a&&null!==n||null!==a&&null===n||!(0<=String(a).toUpperCase().indexOf(n.toUpperCase())))return!0;break;case this.OPERATORS.stringOperatorIsBlank:return void 0===a||null===a||""===a;case this.OPERATORS.stringOperatorIsNotBlank:return void 0!==a&&null!==a&&""!==a;case this.OPERATORS.numberOperatorIs:if(this._isNumeric(a))return String(a)===String(n);break;case this.OPERATORS.numberOperatorIsNot:if(this._isNumeric(a))return String(a)!==String(n);break;case this.OPERATORS.numberOperatorIsAtLeast:if(this._isNumeric(a)&&
this._isNumeric(n))return Number(a)>=Number(n);break;case this.OPERATORS.numberOperatorIsLessThan:if(this._isNumeric(a)&&this._isNumeric(n))return Number(a)<Number(n);break;case this.OPERATORS.numberOperatorIsAtMost:if(this._isNumeric(a)&&this._isNumeric(n))return Number(a)<=Number(n);break;case this.OPERATORS.numberOperatorIsGreaterThan:if(this._isNumeric(a)&&this._isNumeric(n))return Number(a)>Number(n);break;case this.OPERATORS.numberOperatorIsBetween:if(this._isNumeric(a)&&this._isNumeric(n)&&
this._isNumeric(p))return Number(a)>Number(n)&&Number(a)<Number(p);break;case this.OPERATORS.numberOperatorIsNotBetween:if(this._isNumeric(a)&&this._isNumeric(n)&&this._isNumeric(p))return Number(a)<=Number(n)||Number(a)>=Number(p);break;case this.OPERATORS.numberOperatorIsBlank:if(null===a||void 0===a||!1===this._isNumeric(a))return!0;break;case this.OPERATORS.numberOperatorIsNotBlank:if(null!==a&&void 0!==a&&!0===this._isNumeric(a))return!0;break;case this.OPERATORS.dateOperatorIsOn:if(void 0===
a||null===a)break;if(void 0===n||null===n)break;k=new Date(a);return n.toDateString()===k.toDateString();case this.OPERATORS.dateOperatorIsNotOn:if(void 0===a||null===a)break;if(void 0===n||null===n)break;k=new Date(a);return n.toDateString()!==k.toDateString();case this.OPERATORS.dateOperatorIsBefore:if(null===a||void 0===a)break;if(void 0===n||null===n)break;return a<n.getTime();case this.OPERATORS.dateOperatorIsAfter:if(null===a||void 0===a)break;if(void 0===n||null===n)break;return a>n.getTime();
case this.OPERATORS.dateOperatorIsOnOrBefore:if(null===a||void 0===a)break;if(void 0===n||null===n)break;return a<=n.getTime();case this.OPERATORS.dateOperatorIsOnOrAfter:if(null===a||void 0===a)break;if(void 0===n||null===n)break;return a>=n.getTime();case this.OPERATORS.dateOperatorInTheLast:if(null===a||void 0===a)break;if(void 0===n||null===n)break;return a>n.getTime()&&a<=(new Date).getTime();case this.OPERATORS.dateOperatorNotInTheLast:if(null===a||void 0===a)break;if(void 0===n||null===n)break;
return a<=n.getTime()||a>=(new Date).getTime();case this.OPERATORS.dateOperatorIsIn:if(null===a||void 0===a)break;if(void 0===n||null===n)break;if(void 0===p||null===p)break;return a>=n.getTime()&&a<=p.getTime();case this.OPERATORS.dateOperatorIsNotIn:if(null===a||void 0===a)break;if(void 0===n||null===n)break;if(void 0===p||null===p)break;return a<n.getTime()||a>p.getTime();case this.OPERATORS.dateOperatorIsBetween:if(null===a||void 0===a)break;if(void 0===n||null===n)break;if(void 0===p||null===
p)break;return a>=n.getTime()&&a<=p.getTime();case this.OPERATORS.dateOperatorIsNotBetween:if(null===a||void 0===a)break;if(void 0===n||null===n)break;if(void 0===p||null===p)break;return a<n.getTime()||a>p.getTime();case this.OPERATORS.dateOperatorIsBlank:if(null===a||void 0===a)return!0;break;case this.OPERATORS.dateOperatorIsNotBlank:if(null!==a&&void 0!==a)return!0}return!1},_processChildNodes:function(b,a){b.disabled=a;!0===a?b.style&&(b.style.pointerEvents="none"):b.style&&(b.style.pointerEvents=
"auto");e.forEach(b.childNodes,function(n){n.disabled=a;!0===a?n.style&&(n.style.pointerEvents="none"):n.style&&(n.style.pointerEvents="auto");0<n.childNodes.length&&this._processChildNodes(n,a)},this)},_smartComboValidate:function(){this.toggleFields()},_getRowInfo:function(b){var a=b.parentNode.childNodes[1].childNodes[0],n=null,p=null;1<b.parentNode.childNodes[1].childNodes.length&&(n=b.parentNode.childNodes[1].childNodes[1],g.contains(n,"esriCTValuePickerButton")&&(p=b.parentNode.childNodes[1].childNodes[1],
n=null),3===b.parentNode.childNodes[1].childNodes.length&&(p=b.parentNode.childNodes[1].childNodes[2]));var m=!0===this.useFieldName?b.hasAttribute("data-fieldname")?b.getAttribute("data-fieldname"):b.childNodes[0].data:b.childNodes[0].data;b=b.parentNode;var k=x.getEnclosingWidget(a);return[a,b,k,m,n,p]},_removeRequireFieldMarkings:function(b,a,n){var p=null;void 0===n||null===n?(g.contains(b,"dijitComboBoxError")&&g.remove(b,"dijitComboBoxError"),g.contains(b,"dijitTextBoxError")&&g.remove(b,"dijitTextBoxError"),
g.contains(b,"dijitValidationTextBox")&&g.remove(b,"dijitValidationTextBox"),g.contains(b,"dijitValidationTextBoxError")&&g.remove(b,"dijitValidationTextBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError"),p=d(".dijitValidationContainer",a),e.forEach(p,function(m){m.parentNode.removeChild(m)})):(p=G.isFunction(n.isValid)?n.isValid():!0,"dijit.form.TextBox"===n.declaredClass&&!0===p?(g.contains(b,"dijitTextBoxError")&&g.remove(b,"dijitTextBoxError"),g.contains(b,"dijitValidationTextBox")&&
g.remove(b,"dijitValidationTextBox"),g.contains(b,"dijitValidationTextBoxError")&&g.remove(b,"dijitValidationTextBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError"),p=d(".dijitValidationContainer",a),e.forEach(p,function(m){m.parentNode.removeChild(m)})):"dijit.form.ValidationTextBox"===n.declaredClass&&!0===p?(g.contains(b,"dijitTextBoxError")&&g.remove(b,"dijitTextBoxError"),g.contains(b,"dijitTextBoxDisabled")&&g.remove(b,"dijitTextBoxDisabled"),g.contains(b,"dijitValidationTextBoxError")&&
g.remove(b,"dijitValidationTextBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError")):"dijit.form.DateTextBox"===n.declaredClass&&!0===p?(g.contains(b,"dijitTextBoxError")&&g.remove(b,"dijitTextBoxError"),g.contains(b,"dijitValidationTextBox")&&g.remove(b,"dijitValidationTextBox"),g.contains(b,"dijitValidationTextBoxError")&&g.remove(b,"dijitValidationTextBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError"),p=d(".dijitValidationContainer",a),e.forEach(p,function(m){m.parentNode.removeChild(m)})):
"dijit.form.TimeTextBox"===n.declaredClass&&!0===p?(g.contains(b,"dijitTextBoxError")&&g.remove(b,"dijitTextBoxError"),g.contains(b,"dijitValidationTextBox")&&g.remove(b,"dijitValidationTextBox"),g.contains(b,"dijitValidationTextBoxError")&&g.remove(b,"dijitValidationTextBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError"),p=d(".dijitValidationContainer",a),e.forEach(p,function(m){m.parentNode.removeChild(m)})):"dijit.form.FilteringSelect"===n.declaredClass&&!0===p?(g.contains(b,"dijitTextBoxError")&&
g.remove(b,"dijitTextBoxError"),g.contains(b,"dijitComboBoxError")&&g.remove(b,"dijitComboBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError"),g.contains(b,"dijitValidationTextBoxError")&&g.remove(b,"dijitValidationTextBoxError")):!0===p&&(g.contains(b,"dijitComboBoxError")&&g.remove(b,"dijitComboBoxError"),g.contains(b,"dijitTextBoxError")&&g.remove(b,"dijitTextBoxError"),g.contains(b,"dijitValidationTextBox")&&g.remove(b,"dijitValidationTextBox"),g.contains(b,"dijitValidationTextBoxError")&&
g.remove(b,"dijitValidationTextBoxError"),g.contains(b,"dijitError")&&g.remove(b,"dijitError"),p=d(".dijitValidationContainer",a),e.forEach(p,function(m){m.parentNode.removeChild(m)})))},_removeRedAst:function(b,a){-1===this._gdbRequiredFields.indexOf(a)&&(b=d("a.asteriskIndicator",b),0<b.length&&e.forEach(b,function(n){n.parentNode.removeChild(n)}))},_removeHideRule:function(b){g.contains(b,"hideField")&&g.remove(b,"hideField")},_removeDisableRule:function(b,a,n){-1===this._notEditableFields.indexOf(b)&&
(g.contains(a,"dijitTextBoxDisabled")&&g.remove(a,"dijitTextBoxDisabled"),g.contains(a,"dijitComboBoxDisabled")&&g.remove(a,"dijitComboBoxDisabled"),g.contains(a,"dijitValidationTextBoxDisabled")&&g.remove(a,"dijitValidationTextBoxDisabled"),g.contains(a,"dijitDisabled")&&g.remove(a,"dijitDisabled"),(b=x.getEnclosingWidget(a))&&b.set("readOnly",!1));n&&this._processChildNodes(a,!1)},_remove:function(b,a,n,p,m,k){this._removeRequireFieldMarkings(n,p,m);this._removeRedAst(b[0],a);this._removeDisableRule(a,
n,k);this._removeHideRule(p)},toggleFieldOnAttributeInspector:function(b,a,n,p,m){p="undefined"!==typeof p&&null!==p?p:!0;if(void 0===this._gdbRequiredFields||null===this._gdbRequiredFields)this._gdbRequiredFields=[];if(void 0===this._notEditableFields||null===this._notEditableFields)this._notEditableFields=[];if(void 0!==this._attTable&&null!==this._attTable){if(0<this._attTable.length){var k=C.filter(this._attTable,G.hitch(this,function(u){return u.childNodes&&0<u.childNodes.length?!0===this.useFieldName?
u.hasAttribute("data-fieldname")?u.getAttribute("data-fieldname")===b:u.childNodes[0].data===b:u.childNodes[0].data===b:!1})),A=null;if(null!==k&&0<k.length){var w=this._getRowInfo(k[0]),q=w[0];A=w[4];var B=w[5],l=w[1];w=w[2];if(void 0!==w&&null!==w)switch(a){case "Hide":this._removeRequireFieldMarkings(q,l,w);this._removeRedAst(k[0],b);this._removeDisableRule(b,q,m);A&&this._removeDisableRule(b,A,m);B&&g.remove(B,"disabled");g.add(l,"hideField");break;case "Disabled":this._removeRedAst(k[0],b);this._removeHideRule(l);
this._removeRequireFieldMarkings(q,l,w);g.add(q,["dijitValidationTextBox","dijitTextBoxDisabled","dijitComboBoxDisabled","dijitValidationTextBoxDisabled","dijitDisabled"]);this._processChildNodes(q,!0);null!==A&&(this._removeRequireFieldMarkings(A,l,w),g.add(A,["dijitValidationTextBox","dijitTextBoxDisabled","dijitComboBoxDisabled","dijitValidationTextBoxDisabled","dijitDisabled"]),this._processChildNodes(A,!0));B&&g.add(B,"disabled");break;case "Required":this._removeDisableRule(b,q,m);A&&this._removeDisableRule(b,
A,m);B&&g.remove(B,"disabled");this._removeHideRule(l);!0===n?(this._removeRequireFieldMarkings(q,l,w),A&&g.contains(A,"dijitTextBoxError","dijitError")&&g.remove(A,"dijitTextBoxError","dijitError")):"dijit.form.TextBox"===w.declaredClass?(A=d(".dijitValidationContainer",l),0===A.length&&(a=document.createElement("div"),a.setAttribute("class","dijitReset dijitValidationContainer"),n=document.createElement("input"),n.setAttribute("class","dijitReset dijitInputField dijitValidationIcon dijitValidationInner"),
n.setAttribute("value","x"),n.setAttribute("type","text"),n.setAttribute("tabindex","-1"),n.setAttribute("readonly","readonly"),n.setAttribute("role","presentation"),a.appendChild(n),q.insertBefore(a,q.childNodes[0])),g.add(q,["dijitTextBoxError","dijitValidationTextBox","dijitValidationTextBoxError","dijitError"])):"dijit.form.ValidationTextBox"===w.declaredClass?(A=d(".dijitValidationContainer",l),g.add(q,["dijitTextBoxError","dijitValidationTextBox","dijitValidationTextBoxError","dijitError"])):
"dijit.form.FilteringSelect"===w.declaredClass?g.add(q,["dijitTextBoxError","dijitComboBoxError","dijitError","dijitValidationTextBoxError"]):w.get("value")?(g.remove(q,"dijitTextBoxError","dijitError"),A&&g.add(A,["dijitTextBoxError","dijitError"])):g.add(q,["dijitTextBoxError","dijitError"]);q=d("a.asteriskIndicator",k[0]);a=d("span.atiRequiredField",k[0]);-1===this._gdbRequiredFields.indexOf(b)&&0===q.length&&0===a.length&&(q=document.createElement("a"),q.setAttribute("class","asteriskIndicator"),
q.innerHTML=" *",k[0].appendChild(q));break;case "Value":break;default:p&&(this._remove(k,b,q,l,w,m),B&&g.remove(B,"disabled"),A&&this._removeDisableRule(b,A,m))}}}this.emit("onFieldToggle")}}})})},"widgets/SmartEditor/attributeInspectorTools":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/query dojo/on dojo/dom-class dojo/topic dijit/registry jimu/utils jimu/BaseWidgetSetting".split(" "),function(O,C,I,G,e,g,v,d,x,t){return O([t],{_attrInspector:null,_feature:null,_fieldInfo:null,
_guidFields:null,_guidFieldNames:null,_intFieldNames:null,_dblFieldNames:null,_dateFieldNames:null,_stringFields:null,_requiredNonDomainIntFields:null,_requiredNonDomainDecFields:null,_fieldNameToAlias:null,_attTable:null,_mapLayer:null,constructor:function(){this.inherited(arguments);C.mixin(this,arguments[0]);this._mapLayer=this._feature.getLayer();this._processLayer();this._fieldInfo=I.filter(this._fieldInfo,function(h){return h.label?!0:!1});this._attTable=G("td.atiLabel",this._attrInspector.domNode);
void 0!==this._attTable&&null!==this._attTable&&(this._checkDisplayFormat(),this._addValidation())},_checkFeatureData:function(h){I.forEach(this._fieldInfo,function(f){if(h.hasOwnProperty(f.fieldName))switch(f.type){case "esriFieldTypeString":0<f.length&&null!==h[f.fieldName]&&void 0!==h[f.fieldName]&&h[f.fieldName].length>f.length&&(h[f.fieldName]=h[f.fieldName].substring(0,f.length));break;case "esriFieldTypeGUID":this._isGuid(h[f.fieldName],!1)&&("{"!==h[f.fieldName][0]&&(h[f.fieldName]="{"+h[f.fieldName]),
"}"!==h[f.fieldName][h[f.fieldName].length-1]&&(h[f.fieldName]+="}"));break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":this.isNumeric(h[f.fieldName])&&(h[f.fieldName]=parseFloat(h[f.fieldName]));break;case "esriFieldTypeDate":this.isNumeric(h[f.fieldName])&&(h[f.fieldName]=parseInt(h[f.fieldName],10));break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":this.isNumeric(h[f.fieldName])&&(h[f.fieldName]=parseInt(h[f.fieldName],10))}},this);return h},_processLayer:function(){this._guidFields=
[];this._guidFieldNames=[];this._dateFieldNames=[];this._intFieldNames=[];this._dblFieldNames=[];this._stringFields=[];this._requiredNonDomainIntFields=[];this._requiredNonDomainDecFields=[];I.forEach(this._fieldInfo,function(h){if(h.hasOwnProperty("label")&&h.hasOwnProperty("type")){var f=h.label;0<=f.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')&&(f=f.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',""));switch(h.type){case "esriFieldTypeString":this._stringFields.push(h.fieldName);
break;case "esriFieldTypeGUID":this._guidFields.push(f);this._guidFieldNames.push(h.fieldName);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":!1!==h.nullable||void 0!==h.domain&&null!==h.domain||this._requiredNonDomainDecFields.push(f);this._dblFieldNames.push(h.fieldName);break;case "esriFieldTypeDate":this._dateFieldNames.push(h.fieldName);break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":!1!==h.nullable||void 0!==h.domain&&null!==h.domain||this._requiredNonDomainIntFields.push(f),
this._intFieldNames.push(h.fieldName)}}},this)},formValid:function(){var h=!0;if(void 0===this._attTable||null===this._attTable)return h;0<this._attTable.length&&I.some(this._attTable,function(f){if(f=this._getRowInfo(f)){if(void 0===f[0]||null===f[0])return!1;h=C.isFunction(f[0].isValid)?f[0].isValid():!g.contains(f[2],"dijitError");return!h}return!0},this);return h},triggerFormValidation:function(){if(void 0!==this._attTable&&null!==this._attTable&&0<this._attTable.length){var h=null;I.forEach(this._attTable,
function(f){if((f=this._getRowInfo(f))&&void 0!==f[0]&&null!==f[0]){null===h&&(h=f[0]);var b=!0;C.isFunction(f[0].isValid)?b=f[0].isValid():e.emit(f[0],"change",{bubbles:!0,cancelable:!0});!1===b&&f[0].set("state","Error")}},this)}},_addValidation:function(){void 0!==this._attTable&&null!==this._attTable&&(0!==this._guidFields.length||0!==this._requiredNonDomainIntFields.length||0!==this._requiredNonDomainDecFields.length)&&0<this._attTable.length&&I.forEach(this._attTable,function(h){var f=this._getRowInfo(h);
f&&(-1!==this._guidFields.indexOf(f[1])?"dijit.form.ValidationTextBox"===f[0].declaredClass?f[0].validator=C.hitch(this,this._validateGUID):"dijit.form.TextBox"===f[0].declaredClass&&(f[0].isValid=C.hitch(this,this._validateGUID_IsValid(f[0])),e(f[0],"change",C.hitch(this,function(){!1===this._isGuid(f[0].get("value"),!0)?g.add(f[2],["dijitTextBoxError","dijitValidationTextBox","dijitValidationTextBoxError","dijitError"]):(g.contains(f[2],"dijitTextBoxError")&&g.remove(f[2],"dijitTextBoxError"),g.contains(f[2],
"dijitValidationTextBox")&&g.remove(f[2],"dijitValidationTextBox"),g.contains(f[2],"dijitValidationTextBoxError")&&g.remove(f[2],"dijitValidationTextBoxError"),g.contains(f[2],"dijitError")&&g.remove(f[2],"dijitError"));v.publish("smartEditor/validate",null)})),f[0].validator=C.hitch(this,this._validateGUID)):-1===this._requiredNonDomainIntFields.indexOf(f[1])&&this._requiredNonDomainDecFields.indexOf(f[1]))},this)},_isGuid:function(h,f){if(!0===f&&(""===h||null===h))return!0;if(""===h||null===h)return!1;
"{"===h[0]&&(h=h.substring(1,h.length-1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(h)},_validateGUID_IsValid:function(h){return function(){return this._isGuid(h.get("value"),!0)}},_validateGUID:function(h,f){return this._isGuid(h,!0)},isNumeric:function(h){return!isNaN(parseFloat(h))&&isFinite(h)},isInt:function(h){var f;if(f=!isNaN(h))h=parseFloat(h),f=(h|0)===h;return f},_validateInt:function(h,f){return this.isInt(h)},_validateDec:function(h,
f){return this.isNumeric(h)},_getRowInfo:function(h){try{if(h&&h.parentNode){var f=h.parentNode.childNodes[1].childNodes[0];return[d.getEnclosingWidget(f),h.childNodes[0].data,f]}return null}catch(b){return console.log(b),null}},_checkDisplayFormat:function(){var h=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"];void 0!==this._attTable&&null!==this._attTable&&0<this._attTable.length&&I.forEach(this._attTable,C.hitch(this,function(f){var b=this._getRowInfo(f),
a=f.getAttribute("data-fieldname");b&&a&&I.some(this._fieldInfo,C.hitch(this,function(n){if(n.name===a&&-1!==h.indexOf(n.type)&&!n.domain)return n.hasOwnProperty("format")&&n.format&&n.format.hasOwnProperty("digitSeparator")&&!n.format.digitSeparator&&(b[0].constraints.pattern="#.",isNaN(b[0].value)||b[0].set("value",b[0].value)),!0}))}))}})})},"widgets/SmartEditor/relatedTables":function(){define("dojo/_base/declare dojo/Evented dojo/on dojo/string dojo/keys dojo/string dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/_base/array dojo/dom-construct esri/graphic jimu/dijit/Message dijit/_WidgetBase ./presetUtils dojo/query esri/tasks/RelationshipQuery dojo/dom-geometry dojo/dom-class".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A){return O([a,C],{newRelatedFeature:{},_validRelations:[],isSaveEnable:!1,postCreate:function(){this._validRelations=[]},startup:function(){this._createTable()},_createTable:function(){var w=h.create("div",{"class":"relatedTablesContainer"},this.domNode);t.forEach(this.relationshipInfo,x.hitch(this,function(q,B){q.featureLayer&&q.hasOwnProperty("relationshipId")&&this._createRelatedTableItem(q,w,B)}));0<p(".relatedTableTitleContainer",this.domNode).length?
this.emit("addRelatedItemContent",!0):this.emit("addRelatedItemContent",!1)},_getKeyField:function(w){var q;var B=w;w=w.toLowerCase();for(q in this.parentFeature.attributes)if(w===q.toLowerCase()){B=q;break}return B},_createRelatedTableItem:function(w,q,B){var l,u={};if(l=this.layerInfosObj.getLayerOrTableInfoById(w.featureLayer.id)){var D=h.create("div",{"class":"relatedTableTitleContainer"},q);v.set(D,"layerId",l.id);v.set(D,"relationshipId",w.relationshipId);v.set(D,"parentFeatureOID",this.parentFeature.attributes[this.parentFeature._layer.objectIdField]);
I(D,"click",x.hitch(this,function(z){z=v.get(z.currentTarget,"relatedRecordCount");(null===z||z&&0!==parseInt(z,10))&&this.emit("titleClicked",l.id,w.relationshipId,!1,this.parentFeatureIndexInAI,this.parentFeature.attributes[this.parentFeature._layer.objectIdField],this.newRelatedFeature[w.relationshipId].foreignKeyField)}));q=h.create("div",{"class":"relatedTableTitle esriCTEllipsis relatedTableFields",innerHTML:l.title,tabindex:"-1",title:l.title,"aria-label":l.title,role:"button"},D);I(q,"keydown",
x.hitch(this,function(z){z.keyCode!==e.ENTER&&z.keyCode!==e.SPACE||D.click()}));h.create("div",{"class":"esriCTLoadingIcon hidden"},D);h.create("div",{"class":"esriCTRelatedTableRecordsCount"},D);u=this._checkRelationShip(l,w.relationshipId);u.isValidRelation?(this._createNewGraphics(w.relationshipId,l.id,u.primaryKeyField,u.foreignKeyField),this._validRelations.push(w)):h.destroy(D);this._canAddFeatures(w,l)&&"Table"===l.layerObject.type?(q=G.substitute(this.nls.createNewFeatureLabel,{layerTitle:l.title}),
q=h.create("div",{"class":"relatedTableIcons itemTitleCreateNew relatedTableFields",title:this.nls.addNewFeature,"aria-label":q,role:"button",tabindex:"-1"},D),v.set(q,"tableId",l.id),I(q,"click",x.hitch(this,function(z){this._createNewButtonClick(z,w,l,D)})),I(q,"keydown",x.hitch(this,function(z){z.keyCode!==e.ENTER&&z.keyCode!==e.SPACE||this._createNewButtonClick(z,w,l,D)})),this.relationshipInfo.length-1===B&&A.add(q,"esriCTLastRelatedItem")):this.relationshipInfo.length-1===B&&A.add(q,"esriCTLastRelatedItem");
u.isValidRelation&&this.getRelatedRecordsCount(w.relationshipId,l.id)}},_createNewButtonClick:function(w,q,B,l){w.stopPropagation();w=this.newRelatedFeature[q.relationshipId];this.isSaveEnable?b({message:this.nls.pendingFeatureSaveMsg}):(this.parentFeature.attributes.hasOwnProperty(w.primaryKeyField)||(w.primaryKeyField=this._getKeyField(w.primaryKeyField)),void 0===this.parentFeature.attributes[w.primaryKeyField]||null===this.parentFeature.attributes[w.primaryKeyField]?(q=n.getFieldInfoByFieldName(this.parentFieldInfos,
w.primaryKeyField).label||w.primaryKeyField,q=g.substitute(this.nls.invalidRelationShipMsg,{parentKeyField:q}),b({message:q})):(this.newRelatedFeature[q.relationshipId].attributes[this.newRelatedFeature[q.relationshipId].foreignKeyField]=this.parentFeature.attributes[this.newRelatedFeature[q.relationshipId].primaryKeyField],this.emit("addRelatedRecord",this.newRelatedFeature[q.relationshipId],l,B.id,this.parentFeatureIndexInAI,this.newRelatedFeature[q.relationshipId].foreignKeyField)))},_canAddFeatures:function(w,
q){q=q.layerObject.getEditCapabilities();return!w.allowUpdateOnly&&w._editFlag&&q.canCreate?!0:!1},_checkRelationShip:function(w,q){var B=!0;var l=this._getRelationShipById(this.parentFeature._layer,q);w=this._getRelationShipById(w.layerObject,q);if(l&&l.keyField&&w&&w.keyField){var u=l.keyField;var D=w.keyField}else B=!1;return{isValidRelation:B,foreignKeyField:D,primaryKeyField:u}},_createNewGraphics:function(w,q,B,l){var u={};q=this.layerInfosObj.getLayerOrTableInfoById(q);0<q.layerObject.templates.length?
u=q.layerObject.templates[0].prototype.attributes:0<q.layerObject.types.length&&(u=q.layerObject.types[0].templates[0].prototype.attributes);u=new f(null,null,x.clone(u));u.attributes.hasOwnProperty(l)&&(u.attributes[l]=this.parentFeature.attributes[B]);this.newRelatedFeature[w]=u;this.newRelatedFeature[w].primaryKeyField=B;this.newRelatedFeature[w].foreignKeyField=l;this.newRelatedFeature[w].featureLayer=q;return!0},_getRelationShipById:function(w,q){var B;t.some(w.relationships,x.hitch(this,function(l){if(l.id===
q)return B=l,!0}));return B},updateFeatureInstance:function(w){this.parentFeature&&(this.parentFeature.attributes=x.clone(w))},displayRelatedRecordCount:function(w,q){q=p("[relationshipid \x3d "+q+"]",this.domNode);var B=p(".relatedTableIcons.itemTitleCreateNew",this.domNode);var l=p(".esriCTLoadingIcon",q[0])[0];A.add(l,"hidden");var u=p(".esriCTRelatedTableRecordsCount",q[0])[0];A.remove(u,"hidden");l=p(".relatedTableTitle",q[0])[0];v.set(u,"innerHTML","("+w+")");var D=G.substitute(this.nls.relatedFeatureCount,
{layerTitle:l.innerHTML,featureCount:w});v.set(l,"aria-label",D);v.set(q[0],"relatedRecordCount",w);u=k.position(u).w;if("auto"===u||void 0===u||""===u||0===u)u=8+7*w.toString().length;u=0<B.length?u+35:u+10;d.set(l,"width","calc(100% - "+u+"px)");0===w?A.add(q[0],"esriCTRelatedTableTitleDefaultCursor"):A.remove(q[0],"esriCTRelatedTableTitleDefaultCursor")},updateRelatedRecordsCount:function(){t.forEach(this._validRelations,x.hitch(this,function(w){this.getRelatedRecordsCount(w.relationshipId,w.featureLayer.id)}))},
_showLoadingIndicator:function(w){var q=p("[relationshipid \x3d "+w+"]",this.domNode);w=p(".relatedTableIcons.itemTitleCreateNew",this.domNode);var B=p(".esriCTLoadingIcon",q[0])[0];var l=p(".esriCTRelatedTableRecordsCount",q[0])[0];q=p(".relatedTableTitle",q[0])[0];A.remove(B,"hidden");A.add(l,"hidden");l=20;l=0<w.length?l+35:l+10;d.set(q,"width","calc(100% - "+l+"px)")},getRelatedRecordsCount:function(w,q){var B=this.parentFeature._layer;var l=this.parentFeature.attributes[this.parentFeature._layer.objectIdField];
var u=new m;q=this.layerInfosObj.getLayerOrTableInfoById(q).layerObject.objectIdField;u.returnGeometry=!1;u.outSpatialReference=this.mapSpatialReference;u.relationshipId=w;u.objectIds=[l];u.outFields=[q];this._showLoadingIndicator(w);B.queryRelatedFeatures(u,x.hitch(this,function(D){(D=D[l]&&D[l].features)?this.displayRelatedRecordCount(D.length,w):this.displayRelatedRecordCount(0,w)}),x.hitch(this,function(){this.displayRelatedRecordCount(0,w)}))}})})},"widgets/SmartEditor/AttachmentUploader":function(){define("dojo/Evented dojo dojo/_base/declare dojo/_base/lang dojo/on dojo/keys dojo/dom-construct dojo/dom-style dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./AttachmentUploader.html dojo/i18n!esri/nls/jsapi".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f){return I([x,O,t],{declaredClass:"jimu-widget-smartEditor-attachmentuploader",templateString:h,widgetsInTemplate:!0,_inputCount:0,_inputIndex:1,currentAction:null,constructor:function(){this.nls=G.mixin(this.nls,f.widgets.attachmentEditor)},_fileSelected:function(b){b=b.target||b.srcElement;0<b.value.length&&(C.style(b.parentNode.childNodes[0],"display","inline-block"),this._addInput(),"block"===d.get(this.attachmentsRequiredMsg,"display")&&d.set(this.attachmentsRequiredMsg,
"display","none"));this.emit("attachmentAdded")},clear:function(){if(void 0!==this._attachmentList&&null!==this._attachmentList){for(;this._attachmentList.firstChild;)this._attachmentList.removeChild(this._attachmentList.firstChild);this._addInput()}},_deleteAttachment:function(b){b=b.target||b.srcElement;b.parentNode.parentNode.removeChild(b.parentNode);this._hasAddedAnyAttachments()||"Required"!==this.currentAction||"none"===d.get(this.attachmentsRequiredMsg,"display")&&d.set(this.attachmentsRequiredMsg,
"display","block");this.emit("attachmentDeleted")},_reflect:function(b){return b.then(function(a){return{state:"fulfilled",value:a}},function(a){return{state:"rejected",error:a}})},_addInput:function(){for(var b=0;b<this._attachmentList.childNodes.length;b++)if(this._attachmentList.childNodes[b].childNodes[this._inputIndex].value){if(0===this._attachmentList.childNodes[b].childNodes[this._inputIndex].value.length)return}else return;b=v.create("div",{id:"delInput"+String(this._inputCount),"class":"deleteAttachment",
tabindex:"0","aria-label":this.nls.deleteAttachment||this.deleteAttachmentText||"",role:"button"});b.innerHTML="X";C.style(b,"display","none");this.own(e(b,"click",G.hitch(this,this._deleteAttachment)));this.own(e(b,"keydown",G.hitch(this,function(p){p.keyCode!==g.ENTER&&p.keyCode!==g.SPACE||this._deleteAttachment(p)})));var a=v.create("form",{id:"formInput"+String(this._inputCount)}),n=v.create("input",{id:"fileInput"+String(this._inputCount),type:"file","class":"attInput",name:"attachment"});a.appendChild(b);
a.appendChild(n);this._attachmentList.appendChild(a);this.own(e(n,"change",G.hitch(this,this._fileSelected)));this._inputCount+=1},startup:function(){this._addInput()},destroy:function(){this.inherited(arguments)},postAttachments:function(b,a){if(b&&"esri.layers.FeatureLayer"===b.declaredClass&&b.getEditCapabilities&&b.addAttachment){for(var n=[],p=0;p<this._attachmentList.childNodes.length;p++)0<this._attachmentList.childNodes[p].childNodes[this._inputIndex].value.length&&n.push(b.addAttachment(a,
this._attachmentList.childNodes[p]));return 0===n.length?null:n.map(this._reflect)}},_hasAddedAnyAttachments:function(){for(var b=!1,a=0;a<this._attachmentList.childNodes.length;a++)if(this._attachmentList.childNodes[a].childNodes[this._inputIndex].value&&0<this._attachmentList.childNodes[a].childNodes[this._inputIndex].value.length){b=!0;break}return b}})})},"jimu/dijit/EditorXssFilter":function(){define("dojo/_base/declare dojo/_base/array dijit/_WidgetBase dojo/_base/lang dojo/Evented libs/arcgis-html-sanitizer/arcgis-html-sanitizer".split(" "),
function(O,C,I,G,e,g){var v=null,d=O([I,e],{baseClass:"jimu-editor-xss-filter",declaredClass:"jimu.dijit.EditorXssFilter",sanitizer:null,xss:null,whiteList:{},graphicsWhiteList:{},postCreate:function(){this.whiteList=this._getWhiteList();this.sanitizer=new g({whiteList:this.whiteList,safeAttrValue:G.hitch(this,function(x,t,h,f){return"style"===t?this.xss.friendlyAttrValue(h).replace(/"/g,"'"):"img"===x&&"src"===t?this.xss.escapeAttrValue(h):this.xss.safeAttrValue(x,t,h,f)}),onTag:G.hitch(this,function(x,
t,h){if(h.isWhite&&this._isInWhiteList(x,this.graphicsWhiteList))return t}),onIgnoreTagAttr:G.hitch(this,function(x,t,h,f){if("data-"===t.substr(0,5))return t+'\x3d"'+this.xss.escapeAttrValue(h)+'"'}),onIgnoreTag:G.hitch(this,function(x,t,h){if("o:"===x.substr(0,2)||"!--[if"===x||"!--[endif]--"===x)return t})},!0);this.xss=this.sanitizer.xss},sanitize:function(x){return this.sanitizer.sanitize(x)},_getWhiteList:function(){var x="title height width class style font-family id align text-align".split(" "),
t={div:x,h1:x,h2:x,h3:x,h4:x,h5:x,h6:x,span:x,p:x,s:x,strong:x,em:x,u:x,ol:x,ul:x,li:x,a:["href","target"].concat(x),img:["src","alt","border"].concat(x),blockquote:x,font:["face","size","color"].concat(x),pre:x,code:x,b:x,i:x,wbr:x,video:"autoplay controls loop muted poster preload".split(" ").concat(x),audio:["autoplay","controls","loop","muted","preload"].concat(x),source:["media","src","type"].concat(x),table:["cellpadding","cellspacing","border"].concat(x),tbody:[].concat(x),tr:["valign"].concat(x),
td:["valign","colspan","rowspan","nowrap"].concat(x),th:["valign","colspan","rowspan","nowrap"].concat(x),hr:x,html:x,title:x,link:["rel","href"],style:["type"].concat(x),body:x};this.graphicsWhiteList={animate:[],animateMotion:[],animateTransform:[],circle:[],clipPath:[],"color-profile":[],defs:[],desc:[],discard:[],ellipse:[],feBlend:[],feColorMatrix:[],feComponentTransfer:[],feComposite:[],feConvolveMatrix:[],feDiffuseLighting:[],feDisplacementMap:[],feDistantLight:[],feDropShadow:[],feFlood:[],
feFuncA:[],feFuncB:[],feFuncG:[],feFuncR:[],feGaussianBlur:[],feImage:[],feMerge:[],feMergeNode:[],feMorphology:[],feOffset:[],fePointLight:[],feSpecularLighting:[],feSpotLight:[],feTile:[],feTurbulence:[],filter:[],foreignObject:[],g:[],hatch:[],hatchpath:[],line:[],linearGradient:[],marker:[],mask:[],mesh:[],meshgradient:[],meshpatch:[],meshrow:[],metadata:[],mpath:[],path:[],pattern:[],polygon:[],polyline:[],radialGradient:[],rect:[],set:[],solidcolor:[],stop:[],svg:[],switch:[],symbol:[],text:[],
textPath:[],title:[],tspan:[],use:[],view:[],object:[],canvas:x};return this._extendObjectOfArrays([t,{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],
em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align",
"valign"],tt:[],u:[],ul:[],video:"autoplay controls loop preload src height width".split(" ")},this.graphicsWhiteList])},_extendObjectOfArrays:function(x){var t={};C.forEach(x,function(h){var f=Object.keys(h);C.forEach(f,function(b){Array.isArray(h[b])&&Array.isArray(t[b])?t[b]=t[b].concat(h[b]):t[b]=h[b]},this)},this);return t},_isInWhiteList:function(x,t){t=Object.keys(t);var h=!1;C.forEach(t,function(f){x===f&&(h=!0)},this);return h}});d.getInstance=function(){null===v&&(v=new d);return v};return d})},
"widgets/SmartEditor/SEFilterEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dijit/_TemplatedMixin dijit/_WidgetBase jimu/utils".split(" "),function(O,C,I,G,e,g,v){return O([g,e],{name:"SEFilterEditor",baseClass:"jimu-widget-sefilterEditor",declaredClass:"jimu.dijit.SEFilterEditor",templateString:"\x3cdiv style\x3d'width:100%'\x3e\x3cdiv data-dojo-attach-point\x3d'filterEditorDiv'\x3e\x3c/div\x3e\x3c/div\x3e",_templatePicker:null,_layers:null,map:null,
nls:null,_origGetItemsFromLayerFunc:null,gpFilterTemplates:!1,postCreate:function(){this._createFilterTool()},_createFilterTool:function(){this._createLayerFilter();this._createTemplateFilter();this._loadTemplates()},_createLayerFilter:function(){this.selectDropDown=G.create("select",{"class":"flDropDown templatePicker",tabindex:"0","aria-label":this.nls.filterEditor.filterLayerLabel});G.place(this.selectDropDown,this.filterEditorDiv);this.selectDropDown.onchange=C.hitch(this,function(){var d=!0;
""===this.filterTextBox.value||this.gpFilterTemplates||(d=!1);this._onLayerFilterChanged(d)})},removeOptions:function(d){var x;for(x=d.options.length-1;0<=x;x--)d.remove(x)},_loadTemplates:function(){var d=this.selectDropDown.value===this.nls.filterEditor.all||""===this.selectDropDown.value?null:this.selectDropDown.value,x=v.sanitizeHTML(this.filterTextBox.value),t=!1;this.removeOptions(this.selectDropDown);var h=G.create("option",{value:this.nls.filterEditor.all,innerHTML:this.nls.filterEditor.all});
G.place(h,this.selectDropDown);for(h=0;h<this._layers.length;h++){var f=this._layers[h];!0===f.visible&&!0===f.visibleAtMapScale&&(null!==d&&f.id===d&&(t=!0),f=G.create("option",{value:f.id,innerHTML:f.name}),G.place(f,this.selectDropDown))}!0===t&&(this.selectDropDown.value=d,this._onLayerFilterChanged());null!==x&&""!==x&&(this.filterTextBox.value=x,this._onTemplateFilterChanged())},setTemplatePicker:function(d,x){this._layers=x;this._templatePicker=d;this._overrideTemplatePicker();this._loadTemplates()},
_createTemplateFilter:function(){this.filterTextBox=G.create("input",{"class":"searchtextbox templatePicker",type:"text",placeholder:this.nls.filterEditor.searchTemplates},this.filterEditorDiv);this.filterTextBox.onkeyup=C.hitch(this,function(){this._onTemplateFilterChanged()});this._overrideTemplatePicker()},_overrideTemplatePicker:function(){this._origGetItemsFromLayerFunc=this._templatePicker._getItemsFromLayer;this._templatePicker._getItemsFromLayer=C.hitch(this,function(){var d=this._origGetItemsFromLayerFunc.apply(this._templatePicker,
arguments);var x=v.sanitizeHTML(this.filterTextBox.value);x&&(d=I.filter(d,function(t){var h=!1,f=new RegExp(x,"ig");t.hasOwnProperty("label")&&t.label.match(f)&&0<t.label.match(f).length&&(h=!0);t.hasOwnProperty("template")&&t.template.hasOwnProperty("name")&&t.template.name.match(f)&&0<t.template.name.match(f).length&&(h=!0);return h},x));0===d.length&&(this._templatePicker.grid.noDataMessage=this.nls.filterEditor.noAvailableTempaltes,this._templatePicker.grid.params.noDataMessage=this.nls.filterEditor.noAvailableTempaltes,
this._templatePicker.grid.messagesNode.innerText=this.nls.filterEditor.noAvailableTempaltes);return d})},_onLayerFilterChanged:function(d){var x=!0;this._templatePicker.clearSelection();var t=this.selectDropDown.options[this.selectDropDown.selectedIndex].text;""!==t&&(t===this.nls.filterEditor.all?(t=this._filter_layers(v.sanitizeHTML(this.filterTextBox.value)),x=0!==t.length,this._templatePicker.attr("featureLayers",t),!0===this.gpFilterTemplates||d?this._templatePicker.attr("grouping",!0):this._templatePicker.attr("grouping",
!1)):(d=this.map.getLayer(this.selectDropDown.value),this._templatePicker.attr("featureLayers",[d]),this._templatePicker.attr("grouping",!1)),this._templatePicker.update(),x||(this._templatePicker.grid.messagesNode.innerText=this.nls.filterEditor.noAvailableTempaltes))},_filter_layers:function(d){return I.filter(this._layers,C.hitch(this,function(x){if(!1===x.visible||!1===x.visibleAtMapScale)return!1;if(""===d)return!0;var t=I.filter(x.templates,function(h){var f=!1,b=new RegExp(d,"ig");h.hasOwnProperty("name")&&
h.name.match(b)&&0<h.name.match(b).length&&(f=!0);return f},d);type_items=I.filter(x.types,function(h){return 0<I.filter(h.templates,function(f){var b=!1,a=new RegExp(d,"ig");f.hasOwnProperty("name")&&f.name.match(a)&&0<f.name.match(a).length&&(b=!0);return b},d).length},d);return 0<type_items.length||0<t.length}))},_onTemplateFilterChanged:function(){var d=this.selectDropDown.options[this.selectDropDown.selectedIndex].text,x=v.sanitizeHTML(this.filterTextBox.value),t=!0;d===this.nls.filterEditor.all&&
(t=this._filter_layers(x),this._templatePicker.attr("featureLayers",t),t=0!==t.length);d===this.nls.filterEditor.all?""===x?this._templatePicker.attr("grouping",!0):!0===this.gpFilterTemplates?this._templatePicker.attr("grouping",!0):this._templatePicker.attr("grouping",!1):this._templatePicker.attr("grouping",!1);this._templatePicker.update();t||(this._templatePicker.grid.messagesNode.innerText=this.nls.filterEditor.noAvailableTempaltes)},addNewLayerInEditor:function(d){var x=!1,t=!0;I.some(this.selectDropDown.options,
C.hitch(this,function(f){if(f.value===d.id)return x=!0}));if(!x){var h=G.create("option",{value:d.id,innerHTML:d.name});G.place(h,this.selectDropDown.options[0],"after")}this._layers.splice(0,0,d);""===this.filterTextBox.value||this.gpFilterTemplates||(t=!1);this._onLayerFilterChanged(t)},removeLayerFromEditor:function(d){var x=!0;I.some(this._layers,C.hitch(this,function(t,h){if(t.id===d.id)return this._layers.splice(h,1),!0}));I.some(this.selectDropDown.options,C.hitch(this,function(t,h){if(t.value===
d.id)return this.selectDropDown.remove(h),""!==this.filterTextBox.value&&(x=!1),this._onLayerFilterChanged(x),!0}))}})})},"widgets/SmartEditor/SEDrawingOptions":function(){define(["esri/toolbars/draw"],function(O){return{select:[{id:"seNewSelection",iconClass:"seToolbarIcon seNewSelectionIcon",label:window.apiNls.widgets.editor.tools.NLS_selectionNewLbl}],esriGeometryPoint:[{id:"sePointTool",iconClass:"seToolbarIcon sePointIcon",_disabledIcon:"seToolbarIcon sePointIconDisabled",_drawType:O.POINT,
label:window.apiNls.widgets.editor.tools.NLS_pointLbl},{id:"seSelectFeaturesPointToRect",iconClass:"feature-action icon-select-by-rect",label:"",_drawType:"EXTENT"},{id:"seSelectFeaturesPointToLine",iconClass:"feature-action icon-select-by-polygon",label:"",_drawType:"POLYGON"},{id:"seSelectFeaturesPointToLasso",iconClass:"feature-action icon-select-by-freehand-polygon",label:"",_drawType:"FREEHAND_POLYGON"}],esriGeometryPolyline:[{id:"seDrawPolyline",iconClass:"seToolbarIcon sePolylineIcon",_disabledIcon:"seToolbarIcon sePolylineIconDisabled",
_drawType:O.POLYLINE,label:window.apiNls.widgets.editor.tools.NLS_polylineLbl},{id:"seDrawFreehandPolyline",iconClass:"seToolbarIcon seFreehandPolylineIcon",_disabledIcon:"seToolbarIcon seFreehandPolylineIcon",_drawType:O.FREEHAND_POLYLINE,label:window.apiNls.widgets.editor.tools.NLS_freehandPolylineLbl},{id:"seDrawRectPolyline",iconClass:"seToolbarIcon seRectangleIcon",_disabledIcon:"seToolbarIcon seRectangleIcon",_drawType:O.RECTANGLE,label:window.apiNls.widgets.editor.tools.NLS_rectangleLbl},{id:"seDrawArrowPolyline",
iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:O.ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLbl},{id:"seDrawArrowUpPolyline",iconClass:"seToolbarIcon seArrowUpIcon",_disabledIcon:"seToolbarIcon seArrowUpIcon",_drawType:O.UP_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowUpLbl},{id:"seDrawDownArrowPolyline",iconClass:"seToolbarIcon seArrowDownIcon",_disabledIcon:"seToolbarIcon seArrowDownIcon",_drawType:O.DOWN_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowDownLbl},
{id:"seDrawLeftArrowPolyline",iconClass:"seToolbarIcon seArrowLeftIcon",_disabledIcon:"seToolbarIcon arrowLeftIcon",_drawType:O.LEFT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLeftLbl},{id:"seDrawRightArrowPolyline",iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:O.RIGHT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowRightLbl},{id:"seDrawCirclePolyline",iconClass:"seToolbarIcon seCircleIcon",_disabledIcon:"seToolbarIcon seCircleIcon",
_drawType:O.CIRCLE,label:window.apiNls.widgets.editor.tools.NLS_circleLbl},{id:"seDrawEllipsePolyline",iconClass:"seToolbarIcon seEllipseIcon",_disabledIcon:"seToolbarIcon seEllipseIcon",_drawType:O.ELLIPSE,label:window.apiNls.widgets.editor.tools.NLS_ellipseLbl},{id:"seDrawTrianglePolyline",iconClass:"seToolbarIcon seTriangleIcon",_disabledIcon:"seToolbarIcon seTriangleIcon",_drawType:O.TRIANGLE,label:window.apiNls.widgets.editor.tools.NLS_triangleLbl},{id:"seSelectFeaturesLineToRect",iconClass:"feature-action icon-select-by-rect",
label:"",_drawType:"EXTENT"},{id:"seSelectFeaturesLineToLine",iconClass:"feature-action icon-select-by-polygon",label:"",_drawType:"POLYGON"},{id:"seSelectFeaturesLineToLasso",iconClass:"feature-action icon-select-by-freehand-polygon",label:"",_drawType:"FREEHAND_POLYGON"}],esriGeometryPolygon:[{id:"seDrawPolygon",iconClass:"seToolbarIcon sePolygonIcon",_disabledIcon:"seToolbarIcon sePolygonIconDisabled",_drawType:O.POLYGON,label:window.apiNls.widgets.editor.tools.NLS_polygonLbl},{id:"seDrawFreehandPolygon",
iconClass:"seToolbarIcon seFreehandPolygonIcon",_disabledIcon:"seToolbarIcon seFreehandPolygonIconDisabled",_drawType:O.FREEHAND_POLYGON,label:window.apiNls.widgets.editor.tools.NLS_freehandPolygonLbl},{id:"seDrawRect",iconClass:"seToolbarIcon seRectangleIcon",_disabledIcon:"seToolbarIcon seRectangleIcon",_drawType:O.RECTANGLE,label:window.apiNls.widgets.editor.tools.NLS_rectangleLbl},{id:"seDrawArrow",iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:O.ARROW,
label:window.apiNls.widgets.editor.tools.NLS_arrowLbl},{id:"seDrawArrowUp",iconClass:"seToolbarIcon seArrowUpIcon",_disabledIcon:"seToolbarIcon seArrowUpIcon",_drawType:O.UP_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowUpLbl},{id:"seDrawDownArrow",iconClass:"seToolbarIcon seArrowDownIcon",_disabledIcon:"seToolbarIcon seArrowDownIcon",_drawType:O.DOWN_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowDownLbl},{id:"seDrawLeftArrow",iconClass:"seToolbarIcon seArrowLeftIcon",_disabledIcon:"seToolbarIcon arrowLeftIcon",
_drawType:O.LEFT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowLeftLbl},{id:"seDrawRightArrow",iconClass:"seToolbarIcon seArrowIcon",_disabledIcon:"seToolbarIcon seArrowIcon",_drawType:O.RIGHT_ARROW,label:window.apiNls.widgets.editor.tools.NLS_arrowRightLbl},{id:"seDrawCircle",iconClass:"seToolbarIcon seCircleIcon",_disabledIcon:"seToolbarIcon seCircleIcon",_drawType:O.CIRCLE,label:window.apiNls.widgets.editor.tools.NLS_circleLbl},{id:"seDrawEllipse",iconClass:"seToolbarIcon seEllipseIcon",
_disabledIcon:"seToolbarIcon seEllipseIcon",_drawType:O.ELLIPSE,label:window.apiNls.widgets.editor.tools.NLS_ellipseLbl},{id:"seDrawTriangle",iconClass:"seToolbarIcon seTriangleIcon",_disabledIcon:"seToolbarIcon seTriangleIcon",_drawType:O.TRIANGLE,label:window.apiNls.widgets.editor.tools.NLS_triangleLbl},{id:"seSelectFeaturesPolygonToRect",iconClass:"feature-action icon-select-by-rect",label:"",_drawType:"EXTENT"},{id:"seSelectFeaturesPolygonToLine",iconClass:"feature-action icon-select-by-polygon",
label:"",_drawType:"POLYGON"},{id:"seSelectFeaturesPolygonToLasso",iconClass:"feature-action icon-select-by-freehand-polygon",label:"",_drawType:"FREEHAND_POLYGON"}]}})},"widgets/SmartEditor/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/kernel ./PortalAnalysis".split(" "),function(O,C,I,G,e,g,v,d){var x=null,t=O([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,constructor:function(h){this.portalUrl=
h},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.portalAnalysis=this.userPortalUrl=this.userRole=null},loadPrivileges:function(h){h&&this.portalUrl!==h&&(this._clearLoadedInfo(),this.portalUrl=h);if(this._privilegeLoaded())return h=new I,h.resolve(!0),h;h=G.getPortal(this.portalUrl);return h.haveSignIn()?this._loadUserInfo(h):this._signIn(h)},_signIn:function(h){return h.loadSelfInfo().then(C.hitch(this,function(f){var b=G.getPortal(f.portalHostname);return null===b?!1:null===b.credential?
this._loadUserInfo(b):b.signIn().then(C.hitch(this,function(a){return this._loadUserInfo(b,a)}),function(){return!1})}),function(){return!1})},_registerOrgCredential:function(h,f){f=e.getStandardPortalUrl(f);h=C.clone(h.toJson());f+="/sharing/rest";h.server=f;h.resources=[f];v.id.registerToken(h)},_loadUserInfo:function(h,f){return h.loadSelfInfo().then(C.hitch(this,function(b){this.userPortalUrl=b.urlKey?b.urlKey+"."+b.customBaseUrl:this.portalUrl;return b&&b.user?(this.userRole=new g({id:b.user.roleId?
b.user.roleId:b.user.role,role:b.user.role}),b.user.privileges&&this.userRole.setPrivileges(b.user.privileges),this.portalSelf=b,f&&this._registerOrgCredential(f,this.userPortalUrl),this.portalAnalysis=new d(this.userRole,this.portalSelf),!0):!1}),function(){return!1})},_privilegeLoaded:function(){return null!==this.portalSelf},getUser:function(){return this._privilegeLoaded()?this.portalSelf.user:null},isAdmin:function(){return this._privilegeLoaded()?this.userRole.isAdmin():!1},getUserPortal:function(){return this._privilegeLoaded()?
this.userPortalUrl:null},isPortal:function(){return null!==this.portalSelf&&!0===this.portalSelf.isPortal},canPerformAnalysis:function(){return null!==this.portalAnalysis&&this.portalAnalysis.canPerformAnalysis()},hasPrivileges:function(h){return null!==this.portalAnalysis&&this.portalAnalysis.hasPrivileges(h)}});t.getInstance=function(h){null===x&&(x=new t(h));return x};return t})},"widgets/SmartEditor/PortalAnalysis":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","esri/lang"],
function(O,C,I,G){return O([],{userRole:null,portalSelf:null,constructor:function(e,g){this.userRole=e;this.portalSelf=g},canPerformAnalysis:function(){var e=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?e=!0:this.userRole&&this.userRole.isCustom()&&(e=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(e=e&&G.isDefined(this.portalSelf.helperServices.analysis)&&G.isDefined(this.portalSelf.helperServices.analysis.url));
return e},hasPrivileges:function(e){return C.isArray(e)?I.every(e,function(g){return"networkanalysis"===g?this._canPerformNetworkAnalysis():"geoenrichment"===g?this._canPerformGeoEnrichment():"elevation"===g?this._canPerformElevationAnalysis():"drivetimearea"===g?this._canPerformDriveAnalysis():"planroutes"===g?this._canPerformPlanRoutesAnalysis():"od"===g?this._canPerformODAnalysis():!1},this):!0},_canPerformNetworkAnalysis:function(){var e=G.isDefined(this.portalSelf.helperServices.asyncClosestFacility)&&
G.isDefined(this.portalSelf.helperServices.asyncServiceArea)&&G.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&e&&this.userRole.canUseNetworkAnalysis()},_canPerformGeoEnrichment:function(){var e=G.isDefined(this.portalSelf.helperServices.geoenrichment);return this.canPerformAnalysis()&&e&&this.userRole.canUseGeoenrichment()},_canPerformElevationAnalysis:function(){var e=G.isDefined(this.portalSelf.helperServices.elevation);return this.canPerformAnalysis()&&e&&
this.userRole.canUseElevation()},_canPerformPlanRoutesAnalysis:function(){var e=G.isDefined(this.portalSelf.helperServices.routingUtilities)&&G.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&e&&this.userRole.canUseNetworkAnalysis()},_canPerformODAnalysis:function(){var e=G.isDefined(this.portalSelf.helperServices.routingUtilities)&&G.isDefined(this.portalSelf.helperServices.asyncRoute);return this.canPerformAnalysis()&&e&&this.userRole.canUseNetworkAnalysis()},
_canPerformDriveAnalysis:function(){var e=G.isDefined(this.portalSelf.helperServices.routingUtilities)&&G.isDefined(this.portalSelf.helperServices.asyncServiceArea);return this.canPerformAnalysis()&&e&&this.userRole.canUseNetworkAnalysis()},_canPerformNearestAnalysis:function(){var e=G.isDefined(this.portalSelf.helperServices.routingUtilities)&&G.isDefined(this.portalSelf.helperServices.asyncClosestFacility);return this.canPerformAnalysis()&&e&&this.userRole.canUseNetworkAnalysis()}})})},"widgets/SmartEditor/XYCoordinates":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/on dojo/text!./XYCoordinates.html dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/Popup dojo/dom-attr dojo/dom-class esri/geometry/coordinateFormatter esri/SpatialReference dijit/form/ValidationTextBox".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f){return O([v,C,g],{baseClass:"jimu-widget-smartEditor-XYCoordinates",templateString:e,fieldsPopup:null,postCreate:function(){this._createPopUp();this._eventListener();h.load();this.config.editor.hasOwnProperty("defaultCoordinateSystem")&&this.coordinatesDropDown.set("value",this.config.editor.defaultCoordinateSystem)},_eventListener:function(){this.own(G(this.coordinatesDropDown,"change",I.hitch(this,this._onChangeDropDown)));this.own(G(this.xAttributeTextBox,"change",
I.hitch(this,this._onTextBoxValueChanged)));this.own(G(this.yAttributeTextBox,"change",I.hitch(this,this._onTextBoxValueChanged)));this.mgrsTextBox.validator=I.hitch(this,this._mgrsValidator)},_onChangeDropDown:function(){t.add(this.xyOptions,"esriCTHidden");t.add(this.mgrsOptions,"esriCTHidden");"Map Spatial Reference"===this.coordinatesDropDown.value?(t.remove(this.xyOptions,"esriCTHidden"),x.set(this.xAttributeTextBoxLabel,"innerHTML",this.nls.xAttributeTextBoxLabel),x.set(this.yAttributeTextBoxLabel,
"innerHTML",this.nls.yAttributeTextBoxLabel),this.xAttributeTextBox.set("value",""),this.yAttributeTextBox.set("value",""),x.set(this.xAttributeTextBox,"aria-label",this.nls.xAttributeTextBoxLabel),x.set(this.yAttributeTextBox,"aria-label",this.nls.yAttributeTextBoxLabel)):"MGRS"===this.coordinatesDropDown.value?(t.remove(this.mgrsOptions,"esriCTHidden"),this.mgrsTextBox.set("value","")):(t.remove(this.xyOptions,"esriCTHidden"),x.set(this.xAttributeTextBoxLabel,"innerHTML",this.nls.latitudeTextBoxLabel),
x.set(this.yAttributeTextBoxLabel,"innerHTML",this.nls.longitudeTextBoxLabel),this.xAttributeTextBox.set("value",""),this.yAttributeTextBox.set("value",""),x.set(this.xAttributeTextBox,"aria-label",this.nls.latitudeTextBoxLabel),x.set(this.yAttributeTextBox,"aria-label",this.nls.longitudeTextBoxLabel))},_createPopUp:function(){this.fieldsPopup=new d({titleLabel:this.nls.coordinatePopupTitle,width:400,maxHeight:300,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,id:"okButton",
onClick:I.hitch(this,function(){this._getData();this.mgrsTextBox.set("value","");this.xAttributeTextBox.set("value","");this.yAttributeTextBox.set("value","");this.fieldsPopup.close()})},{label:this.nls.cancel,id:"cancelButton",classNames:["jimu-btn-vacation"],onClick:I.hitch(this,function(){this.xAttributeTextBox.set("value","");this.yAttributeTextBox.set("value","");this.fieldsPopup.close()})}]});this.fieldsPopup.disableButton(0);x.set(this.fieldsPopup.disabledButtons[0],"tabindex","-1")},_getData:function(){if("MGRS"===
this.coordinatesDropDown.value){var b=h.fromMgrs(this.mgrsTextBox.get("value"),new f(4326),"automatic");b&&this.emit("gotoSelectedLocation",{coordinateSystem:"Latitude/Longitude",firstPoint:b.y,secondPoint:b.x})}else this.emit("gotoSelectedLocation",{coordinateSystem:this.coordinatesDropDown.getValue(),firstPoint:this.xAttributeTextBox.getValue(),secondPoint:this.yAttributeTextBox.getValue()})},_mgrsValidator:function(){var b=null;""!==this.mgrsTextBox.get("value")&&(b=h.fromMgrs(this.mgrsTextBox.get("value"),
new f(4326),"automatic"));if(null===b)return this.fieldsPopup.disableButton(0),x.set(this.fieldsPopup.disabledButtons[0],"tabindex","-1"),!1;this.fieldsPopup.enableButton(0);x.set(this.fieldsPopup.enabledButtons[0],"tabindex","0");return!0},_onTextBoxValueChanged:function(){isNaN(this.xAttributeTextBox.value)||isNaN(this.yAttributeTextBox.value)?(this.fieldsPopup.disableButton(0),x.set(this.fieldsPopup.disabledButtons[0],"tabindex","-1")):(this.fieldsPopup.enableButton(0),x.set(this.fieldsPopup.enabledButtons[0],
"tabindex","0"))}})})},"esri/geometry/coordinateFormatter":function(){define("require exports ../layers/vectorTiles/core/Error ./pe ./Point ../SpatialReference".split(" "),function(O,C,I,G,e,g){function v(t){var h=null;t||(t=new g(4326));if(t.wkid){if(h=G.PeFactory.geogcs(t.wkid),!h)throw new I("coordinate-formatter:invalid-spatial-reference","wkid is not valid");}else if(t.wkt){if(h=G.PeFactory.fromString(G.PeDefs.PE_TYPE_GEOGCS,t.wkt),!h)throw new I("coordinate-formatter:invalid-spatial-reference",
"wkt is not valid");}else throw new I("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");return h}function d(t){var h=-1;switch(t){case "automatic":h=G.PeNotationMgrs.PE_MGRS_STYLE_AUTO;break;case "new-180-in-zone-01":h=G.PeNotationMgrs.PE_MGRS_STYLE_NEW|G.PeNotationMgrs.PE_MGRS_180_ZONE_1_PLUS;break;case "new-180-in-zone-60":h=G.PeNotationMgrs.PE_MGRS_STYLE_NEW;break;case "old-180-in-zone-01":h=G.PeNotationMgrs.PE_MGRS_STYLE_OLD|G.PeNotationMgrs.PE_MGRS_180_ZONE_1_PLUS;
break;case "old-180-in-zone-60":h=G.PeNotationMgrs.PE_MGRS_STYLE_OLD}return h}function x(t){var h=-1;switch(t){case "latitude-band-indicators":h=G.PeNotationUtm.PE_UTM_OPTS_NONE;break;case "north-south-indicators":h=G.PeNotationUtm.PE_UTM_OPTS_NS}return h}Object.defineProperty(C,"__esModule",{value:!0});C.isLoaded=function(){return G.isLoaded()};C.isSupported=function(){return G.isSupported()};C.load=function(){return G.load()};C.fromLatitudeLongitude=function(t,h){var f=[];t=t.replace(/\u2032/g,
"'");var b=v(h);return G.PeNotationDms.dms_to_geog(b,1,[t],f)?new e(f[0][0],f[0][1],h||new g(4326)):null};C.fromMgrs=function(t,h,f){var b=[],a=d(f);if(-1===a)return console.warn("invalid conversionMode: "+f),null;f=v(h);return G.PeNotationMgrs.mgrs_to_geog_extended(f,1,[t],a,b)?new e(b[0][0],b[0][1],h||new g(4326)):null};C.fromUsng=function(t,h){var f=[];!h&&/\(.+27/.test(t)&&(h=new g(4267));var b=v(h);return G.PeNotationUsng.usng_to_geog(b,1,[t],f)?new e(f[0][0],f[0][1],h||new g(4326)):null};C.fromUtm=
function(t,h,f){var b=[],a=x(f);if(-1===a)return console.warn("invalid conversionMode: "+f),null;f=v(h);return G.PeNotationUtm.utm_to_geog(f,1,[t],a,b)?new e(b[0][0],b[0][1],h||new g(4326)):null};C.toLatitudeLongitude=function(t,h,f){void 0===f&&(f=0);var b=[[t.x,t.y]],a=[];t=v(t.spatialReference);var n=0;switch(h){case "dd":n=G.PeNotationDms.geog_to_dd(t,1,b,f,a);break;case "ddm":n=G.PeNotationDms.geog_to_ddm(t,1,b,f,a);break;case "dms":n=G.PeNotationDms.geog_to_dms(t,1,b,f,a);break;default:return console.warn("invalid format: "+
h),null}return n?a[0]:null};C.toMgrs=function(t,h,f,b){void 0===f&&(f=0);void 0===b&&(b=!1);var a=[[t.x,t.y]],n=[];t=v(t.spatialReference);var p=d(h);if(-1===p)return console.warn("invalid conversionMode: "+h),null;b&&(p|=G.PeNotationMgrs.PE_MGRS_ADD_SPACES);return G.PeNotationMgrs.geog_to_mgrs_extended(t,1,a,f,!1,p,n)?n[0]:null};C.toUsng=function(t,h,f){void 0===h&&(h=0);void 0===f&&(f=!1);var b=[[t.x,t.y]],a=[];t=v(t.spatialReference);return G.PeNotationUsng.geog_to_usng(t,1,b,h,!1,f,a)?a[0]:null};
C.toUtm=function(t,h,f){void 0===f&&(f=!1);var b=[[t.x,t.y]],a=[];t=v(t.spatialReference);var n=x(h);if(-1===n)return console.warn("invalid conversionMode: "+h),null;f&&(n|=G.PeNotationUtm.PE_UTM_OPTS_ADD_SPACES);return G.PeNotationUtm.geog_to_utm(t,1,b,n,a)?a[0]:null}})},"esri/layers/vectorTiles/core/Error":function(){define(["require","exports","./tsSupport/extendsHelper","./lang","./Message"],function(O,C,I,G,e){O=function(g){function v(d,x,t){var h=g.call(this,d,x,t)||this;return h instanceof
v?h:new v(d,x,t)}I(v,g);v.prototype.toJSON=function(){return{name:this.name,message:this.message,details:G.clone(this.details),dojoType:this.dojoType}};v.fromJSON=function(d){var x=new v(d.name,d.message,d.details);null!=d.dojoType&&(x.dojoType=d.dojoType);return x};return v}(e);O.prototype.type="error";return O})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,I){C.__proto__=
I}||function(C,I){for(var G in I)I.hasOwnProperty(G)&&(C[G]=I[G])};return function(C,I){function G(){this.constructor=C}O(C,I);C.prototype=null===I?Object.create(I):(G.prototype=I.prototype,new G)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(O,C,I,G,e,g){function v(a){return void 0!==a&&null!==a}function d(a){return v(a)?a:""}function x(a,n,p){var m=p.match(/([^\(]+)(\([^\)]+\))?/i),
k=C.trim(m[1]);p=n[a];m=JSON.parse((m[2]?C.trim(m[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var A=m.utcOffset;if(-1===f.indexOf(k))k=C.getObject(k),C.isFunction(k)&&(p=k(p,a,n,m));else if("number"===typeof p||"string"===typeof p&&p&&!isNaN(Number(p)))switch(p=Number(p),k){case "NumberFormat":a=C.mixin({},m);n=parseFloat(a.places);if(isNaN(n)||0>n)a.places=Infinity;return G.format(p,
a);case "DateString":p=new Date(p);if(m.local||m.systemLocale)return m.systemLocale?p.toLocaleDateString()+(m.hideTime?"":" "+p.toLocaleTimeString()):p.toDateString()+(m.hideTime?"":" "+p.toTimeString());p=p.toUTCString();m.hideTime&&(p=p.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return p;case "DateFormat":return p=new Date(p),v(A)&&(p=I.add(p,"minute",p.getTimezoneOffset()-A)),e.format(p,m)}return d(p)}function t(a,n){var p;if(n)for(p in a)a.hasOwnProperty(p)&&(void 0===a[p]?delete a[p]:a[p]instanceof
Object&&t(a[p],!0));else for(p in a)a.hasOwnProperty(p)&&void 0===a[p]&&delete a[p];return a}function h(a){if(!a||"object"!=typeof a||C.isFunction(a))return a;if(a instanceof Int8Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Date)return new a.constructor(a);if(a instanceof ArrayBuffer)return a.slice(0,a.byteLength);
if("function"===typeof a.clone)a=a.clone();else if("function"===typeof a.map&&"function"===typeof a.forEach)a=a.map(h);else if("function"===typeof a.notifyChange&&"function"===typeof a.watch)a=a.clone();else{var n={},p,m={};for(p in a){var k=a[p];var A=!(p in m)||m[p]!==k;if(!(p in n)||n[p]!==k&&A)n[p]=h?h(k):k}a=n}return a}var f=["NumberFormat","DateString","DateFormat"],b=/<\/?[^>]+>/g;return{equals:function(a,n){return a===n||"number"===typeof a&&isNaN(a)&&"number"===typeof n&&isNaN(n)||C.isFunction((a||
{}).getTime)&&C.isFunction((n||{}).getTime)&&a.getTime()==n.getTime()||C.isFunction((a||{}).equals)&&a.equals(n)||C.isFunction((n||{}).equals)&&n.equals(a)||!1},mixin:C.mixin,valueOf:function(a,n){for(var p in a)if(a[p]==n)return p;return null},stripTags:function(a){if(a){var n=typeof a;if("string"===n)a=a.replace(b,"");else if("object"===n)for(var p in a)(n=a[p])&&"string"===typeof n&&(n=n.replace(b,"")),a[p]=n}return a},substitute:function(a,n,p){if(v(p))if(C.isObject(p)){var m=p.first;var k=p.dateFormat;
var A=p.numberFormat}else m=p;if(n&&"{*}"!==n)return C.replace(n,C.hitch({obj:a},function(q,B){q=B.split(":");return 1<q.length?(B=q[0],q.shift(),x(B,this.obj,q.join(":"))):k&&-1!==(k.properties||[]).indexOf(B)?x(B,this.obj,k.formatter||"DateString"):A&&-1!==(A.properties||[]).indexOf(B)?x(B,this.obj,A.formatter||"NumberFormat"):d(this.obj[B])}));n=[];var w;n.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+g.fieldsSummary+'"\x3e\x3ctbody\x3e');for(w in a)if(p=a[w],k&&-1!==(k.properties||
[]).indexOf(w)?p=x(w,a,k.formatter||"DateString"):A&&-1!==(A.properties||[]).indexOf(w)&&(p=x(w,a,A.formatter||"NumberFormat")),n.push("\x3ctr\x3e\x3cth\x3e"+w+"\x3c/th\x3e\x3ctd\x3e"+d(p)+"\x3c/td\x3e\x3c/tr\x3e"),m)break;n.push("\x3c/tbody\x3e\x3c/table\x3e");return n.join("")},filter:function(a,n,p){n=[C.isString(a)?a.split(""):a,p||O.global,C.isString(n)?new Function("item","index","array",n):n];p={};var m;a=n[0];for(m in a)n[2].call(n[m],a[m],m,a)&&(p[m]=a[m]);return p},startsWith:function(a,
n,p){p=p||0;return a.indexOf(n,p)===p},endsWith:function(a,n,p){if("number"!==typeof p||!isFinite(p)||Math.floor(p)!==p||p>a.length)p=a.length;p-=n.length;a=a.indexOf(n,p);return-1!==a&&a===p},isDefined:v,fixJson:t,clone:h}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(O,C,I){return function(){function G(e,g,v){this instanceof G&&(this.name=e,this.message=g&&I.substitute(g,v,function(d){return null==d?"":d})||"",this.details=v)}G.prototype.toString=
function(){return"["+this.name+"]: "+this.message};return G}()})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(O,C,I,G,e){function g(m){function k(B,l,u){B[l]=u(B[l])}C._pe=m;f.init();b.init();a.init();n.init();p.init();C.PeGCSExtent=function(B){function l(){return null!==B&&B.apply(this,arguments)||this}I(l,B);l.prototype.destroy=function(){C._pe.destroy(this)};return l}(C._pe.PeGCSExtent);for(var A=0,w=[C._pe.PeDatum,
C._pe.PeGeogcs,C._pe.PeGeogtran,C._pe.PeObject,C._pe.PeParameter,C._pe.PePrimem,C._pe.PeProjcs,C._pe.PeSpheroid,C._pe.PeUnit];A<w.length;A++)m=w[A],k(m.prototype,"getName",function(B){return function(){return B.call(this,Array(f.PE_NAME_MAX))}});A=0;for(w=[C._pe.PeGeogtran,C._pe.PeProjcs];A<w.length;A++)m=w[A],k(m.prototype,"getParameters",function(B){return function(){for(var l=Array(f.PE_PARM_MAX),u=B.call(this),D=0;D<l.length;D++){var z=C._pe.getValue(u,"*");l[D]=z?C._pe.wrapPointer(z,C._pe.PeParameter):
null;u+=Int32Array.BYTES_PER_ELEMENT}return l}});k(C._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var l=this.getSize();if(!l)return null;var u=[],D=B.call(this);t(u,l,D);return u}});k(C._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var l=C._pe._pe_getPeGTlistExtendedGTsSize();return function(){var u=null,D=B.call(this);if(!C._pe.compare(D,C._pe.NULL)){u=[D];var z=this.getSteps();if(1<z){D=C._pe.getPointer(D);for(var L=1;L<z;L++)u.push(C._pe.wrapPointer(D+l*L,C._pe.PeGTlistExtendedGTs))}}return u}});
var q=C._pe._pe_getPeHorizonSize();m=function(B){return function(){var l=this._cache;l||(this._cache=l=new Map);if(l.has(B))return l.get(B);var u=null,D=B.call(this);if(!C._pe.compare(D,C._pe.NULL)){u=[D];var z=D.getNump();if(1<z){D=C._pe.getPointer(D);for(var L=1;L<z;L++)u.push(C._pe.wrapPointer(D+q*L,C._pe.PeHorizon))}}l.set(B,u);return u}};k(C._pe.PeProjcs.prototype,"horizonGcsGenerate",m);k(C._pe.PeProjcs.prototype,"horizonPcsGenerate",m);C._pe.PeObject.prototype.toString=function(B){void 0===
B&&(B=f.PE_STR_OPTS_NONE);C._pe.ensureCache.prepare();var l=C._pe.getPointer(this),u=C._pe.ensureInt8(Array(f.PE_BUFFER_MAX));return C._pe.UTF8ToString(C._pe._pe_object_to_string_ext(l,B,u))}}function v(m){if(m){var k=C._pe.getClass(m);k&&(k=C._pe.getCache(k))&&(m=C._pe.getPointer(m))&&delete k[m]}}function d(m,k){var A=[];k=Array(k);for(var w=0;w<m;w++)A.push(C._pe.ensureInt8(k));return A}function x(m){if(Array.isArray(m[0])){var k=[];m.forEach(function(A){k.push(A[0],A[1])})}else k=m;return k}function t(m,
k,A,w){void 0===w&&(w=!1);if(w)for(w=0;w<2*k;w++)m[w]=C._pe.getValue(A+w*Float64Array.BYTES_PER_ELEMENT,"double");else{var q=0===m.length;for(w=0;w<k;w++)q&&(m[w]=Array(2)),m[w][0]=C._pe.getValue(A,"double"),m[w][1]=C._pe.getValue(A+Float64Array.BYTES_PER_ELEMENT,"double"),A+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(C,"__esModule",{value:!0});var h;C._pe=null;C.isLoaded=function(){return!!C._pe};C.isSupported=function(){return!!e("esri-wasm")};C.load=function(){if(h)return h.promise;
h=new G;O(["./support/pe-wasm"],function(m){m({locateFile:function(k){return O.toUrl("./support/"+k)},onAbort:function(k){h.reject(Error(k))}}).then(function(k){g(k);h.resolve()})});return h.promise};(function(m){function k(q,B,l){C._pe.ensureCache.prepare();var u=x(l),D=l===u;u=C._pe.ensureFloat64(u);(q=C._pe._pe_geog_to_proj(C._pe.getPointer(q),B,u))&&t(l,B,u,D);return q}function A(q,B,l){return w(q,B,l,0)}function w(q,B,l,u){C._pe.ensureCache.prepare();var D=x(l),z=l===D;D=C._pe.ensureFloat64(D);
(q=C._pe._pe_proj_to_geog_center(C._pe.getPointer(q),B,D,u))&&t(l,B,D,z);return q}m.geogToProj=k;m.projGeog=function(q,B,l,u){switch(u){case f.PE_TRANSFORM_P_TO_G:return A(q,B,l);case f.PE_TRANSFORM_G_TO_P:return k(q,B,l)}return 0};m.projToGeog=A;m.projToGeogCenter=w})(C.PeCSTransformations||(C.PeCSTransformations={}));var f;(function(m){m.init=function(){m.PE_BUFFER_MAX=C._pe.PeDefs.prototype.PE_BUFFER_MAX;m.PE_NAME_MAX=C._pe.PeDefs.prototype.PE_NAME_MAX;m.PE_MGRS_MAX=C._pe.PeDefs.prototype.PE_MGRS_MAX;
m.PE_USNG_MAX=C._pe.PeDefs.prototype.PE_USNG_MAX;m.PE_DD_MAX=C._pe.PeDefs.prototype.PE_DD_MAX;m.PE_DDM_MAX=C._pe.PeDefs.prototype.PE_DDM_MAX;m.PE_DMS_MAX=C._pe.PeDefs.prototype.PE_DMS_MAX;m.PE_UTM_MAX=C._pe.PeDefs.prototype.PE_UTM_MAX;m.PE_PARM_MAX=C._pe.PeDefs.prototype.PE_PARM_MAX;m.PE_TYPE_NONE=C._pe.PeDefs.prototype.PE_TYPE_NONE;m.PE_TYPE_GEOGCS=C._pe.PeDefs.prototype.PE_TYPE_GEOGCS;m.PE_TYPE_PROJCS=C._pe.PeDefs.prototype.PE_TYPE_PROJCS;m.PE_TYPE_GEOGTRAN=C._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;
m.PE_TYPE_COORDSYS=C._pe.PeDefs.prototype.PE_TYPE_COORDSYS;m.PE_TYPE_UNIT=C._pe.PeDefs.prototype.PE_TYPE_UNIT;m.PE_STR_OPTS_NONE=C._pe.PeDefs.prototype.PE_STR_OPTS_NONE;m.PE_STR_AUTH_NONE=C._pe.PeDefs.prototype.PE_STR_AUTH_NONE;m.PE_STR_AUTH_TOP=C._pe.PeDefs.prototype.PE_STR_AUTH_TOP;m.PE_STR_NAME_CANON=C._pe.PeDefs.prototype.PE_STR_NAME_CANON;m.PE_PARM_X0=C._pe.PeDefs.prototype.PE_PARM_X0;m.PE_PARM_ND=C._pe.PeDefs.prototype.PE_PARM_ND;m.PE_TRANSFORM_1_TO_2=C._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;
m.PE_TRANSFORM_2_TO_1=C._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;m.PE_TRANSFORM_P_TO_G=C._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;m.PE_TRANSFORM_G_TO_P=C._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;m.PE_HORIZON_RECT=C._pe.PeDefs.prototype.PE_HORIZON_RECT;m.PE_HORIZON_POLY=C._pe.PeDefs.prototype.PE_HORIZON_POLY;m.PE_HORIZON_LINE=C._pe.PeDefs.prototype.PE_HORIZON_LINE;m.PE_HORIZON_DELTA=C._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(f=C.PeDefs||(C.PeDefs={}));(function(m){function k(B,l){var u=null,D=w[B];
D||(D={},w[B]=D);D.hasOwnProperty(String(l))?u=D[l]:(B=C._pe.PeFactory.prototype.factoryByType(B,l),C._pe.compare(B,C._pe.NULL)||(u=B,D[l]=u));return u=A(u)}function A(B){if(B){var l=B.getType();switch(l){case f.PE_TYPE_GEOGCS:B=C._pe.castObject(B,C._pe.PeGeogcs);break;case f.PE_TYPE_PROJCS:B=C._pe.castObject(B,C._pe.PeProjcs);break;case f.PE_TYPE_GEOGTRAN:B=C._pe.castObject(B,C._pe.PeGeogtran);break;default:l&f.PE_TYPE_UNIT&&(B=C._pe.castObject(B,C._pe.PeUnit))}}return B}var w={},q={};m.initialize=
function(){C._pe.PeFactory.prototype.initialize(null)};m.coordsys=function(B){return k(f.PE_TYPE_COORDSYS,B)};m.factoryByType=k;m.fromString=function(B,l){var u=null,D=q[B];D||(D={},q[B]=D);D.hasOwnProperty(l)?u=D[l]:(B=C._pe.PeFactory.prototype.fromString(B,l),C._pe.compare(B,C._pe.NULL)||(u=B,D[l]=u));return u=A(u)};m.geogcs=function(B){return k(f.PE_TYPE_GEOGCS,B)};m.geogtran=function(B){return k(f.PE_TYPE_GEOGTRAN,B)};m.getCode=function(B){return C._pe.PeFactory.prototype.getCode(B)};m.projcs=
function(B){return k(f.PE_TYPE_PROJCS,B)};m.unit=function(B){return k(f.PE_TYPE_UNIT,B)}})(C.PeFactory||(C.PeFactory={}));C.PeGCSExtent=null;var b;(function(m){var k;m.init=function(){m.PE_GTLIST_OPTS_COMMON=C._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;k=C._pe._pe_getPeGTlistExtendedEntrySize()};m.getGTlist=function(A,w,q,B,l,u){var D=null,z=new C._pe.PeInteger(u);try{var L=C._pe.PeGTlistExtended.prototype.getGTlist(A,w,q,B,l,z);if(u=z.val)if(D=[L],1<u){var F=C._pe.getPointer(L);for(A=1;A<
u;A++)D.push(C._pe.wrapPointer(F+k*A,C._pe.PeGTlistExtendedEntry))}}finally{C._pe.destroy(z)}return D}})(b=C.PeGTlistExtended||(C.PeGTlistExtended={}));(function(m){m.destroy=function(k){if(k&&k.length){for(var A=0;A<k.length;A++){var w=k[A];v(w);w.getEntries().forEach(function(q){v(q);q=q.getGeogtran();v(q);q.getParameters().forEach(v);[q.getGeogcs1(),q.getGeogcs2()].forEach(function(B){v(B);var l=B.getDatum();v(l);v(l.getSpheroid());v(B.getPrimem());v(B.getUnit())})})}C._pe.PeGTlistExtendedEntry.prototype.Delete(k[0])}}})(C.PeGTlistExtendedEntry||
(C.PeGTlistExtendedEntry={}));(function(m){m.geogToGeog=function(k,A,w,q,B){C._pe.ensureCache.prepare();var l=x(w),u=w===l;l=C._pe.ensureFloat64(l);var D=0;q&&(D=C._pe.ensureFloat64(q));(k=C._pe._pe_geog_to_geog(C._pe.getPointer(k),A,l,D,B))&&t(w,A,l,u);return k}})(C.PeGTTransformations||(C.PeGTTransformations={}));(function(m){function k(w,q,B,l,u,D){C._pe.ensureCache.prepare();switch(w){case "dd":var z=C._pe._pe_geog_to_dd;var L=f.PE_DD_MAX;break;case "ddm":z=C._pe._pe_geog_to_ddm;L=f.PE_DDM_MAX;
break;case "dms":z=C._pe._pe_geog_to_dms,L=f.PE_DMS_MAX}w=0;q&&(w=C._pe.getPointer(q));q=x(l);q=C._pe.ensureFloat64(q);L=d(B,L);l=C._pe.ensureInt32(L);if(u=z(w,B,q,u,l))for(z=0;z<B;z++)D[z]=C._pe.UTF8ToString(L[z]);return u}function A(w,q,B,l,u){C._pe.ensureCache.prepare();switch(w){case "dd":var D=C._pe._pe_dd_to_geog;break;case "ddm":D=C._pe._pe_ddm_to_geog;break;case "dms":D=C._pe._pe_dms_to_geog}w=0;q&&(w=C._pe.getPointer(q));q=l.map(function(z){return C._pe.ensureString(z)});l=C._pe.ensureInt32(q);
q=C._pe.ensureFloat64(Array(2*B));(D=D(w,B,l,q))&&t(u,B,q);return D}m.geog_to_dms=function(w,q,B,l,u){return k("dms",w,q,B,l,u)};m.dms_to_geog=function(w,q,B,l){return A("dms",w,q,B,l)};m.geog_to_ddm=function(w,q,B,l,u){return k("ddm",w,q,B,l,u)};m.ddm_to_geog=function(w,q,B,l){return A("ddm",w,q,B,l)};m.geog_to_dd=function(w,q,B,l,u){return k("dd",w,q,B,l,u)};m.dd_to_geog=function(w,q,B,l){return A("dd",w,q,B,l)}})(C.PeNotationDms||(C.PeNotationDms={}));var a;(function(m){m.init=function(){m.PE_MGRS_STYLE_NEW=
C._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;m.PE_MGRS_STYLE_OLD=C._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;m.PE_MGRS_STYLE_AUTO=C._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;m.PE_MGRS_180_ZONE_1_PLUS=C._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;m.PE_MGRS_ADD_SPACES=C._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};m.geog_to_mgrs_extended=function(k,A,w,q,B,l,u){C._pe.ensureCache.prepare();var D=0;k&&(D=C._pe.getPointer(k));k=x(w);w=C._pe.ensureFloat64(k);k=d(A,f.PE_MGRS_MAX);
var z=C._pe.ensureInt32(k);if(q=C._pe._pe_geog_to_mgrs_extended(D,A,w,q,B,l,z))for(B=0;B<A;B++)u[B]=C._pe.UTF8ToString(k[B]);return q};m.mgrs_to_geog_extended=function(k,A,w,q,B){C._pe.ensureCache.prepare();var l=0;k&&(l=C._pe.getPointer(k));k=w.map(function(u){return C._pe.ensureString(u)});w=C._pe.ensureInt32(k);k=C._pe.ensureFloat64(Array(2*A));(q=C._pe._pe_mgrs_to_geog_extended(l,A,w,q,k))&&t(B,A,k);return q}})(a=C.PeNotationMgrs||(C.PeNotationMgrs={}));(function(m){m.geog_to_usng=function(k,
A,w,q,B,l,u){C._pe.ensureCache.prepare();var D=0;k&&(D=C._pe.getPointer(k));k=x(w);w=C._pe.ensureFloat64(k);k=d(A,f.PE_MGRS_MAX);var z=C._pe.ensureInt32(k);if(q=C._pe._pe_geog_to_usng(D,A,w,q,B,l,z))for(B=0;B<A;B++)u[B]=C._pe.UTF8ToString(k[B]);return q};m.usng_to_geog=function(k,A,w,q){C._pe.ensureCache.prepare();var B=0;k&&(B=C._pe.getPointer(k));k=w.map(function(l){return C._pe.ensureString(l)});w=C._pe.ensureInt32(k);k=C._pe.ensureFloat64(Array(2*A));(B=C._pe._pe_usng_to_geog(B,A,w,k))&&t(q,A,
k);return B}})(C.PeNotationUsng||(C.PeNotationUsng={}));var n;(function(m){m.init=function(){m.PE_UTM_OPTS_NONE=C._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;m.PE_UTM_OPTS_ADD_SPACES=C._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;m.PE_UTM_OPTS_NS=C._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};m.geog_to_utm=function(k,A,w,q,B){C._pe.ensureCache.prepare();var l=0;k&&(l=C._pe.getPointer(k));k=x(w);w=C._pe.ensureFloat64(k);k=d(A,f.PE_UTM_MAX);var u=C._pe.ensureInt32(k);if(q=C._pe._pe_geog_to_utm(l,
A,w,q,u))for(l=0;l<A;l++)B[l]=C._pe.UTF8ToString(k[l]);return q};m.utm_to_geog=function(k,A,w,q,B){C._pe.ensureCache.prepare();var l=0;k&&(l=C._pe.getPointer(k));k=w.map(function(u){return C._pe.ensureString(u)});w=C._pe.ensureInt32(k);k=C._pe.ensureFloat64(Array(2*A));(q=C._pe._pe_utm_to_geog(l,A,w,q,k))&&t(B,A,k);return q}})(n=C.PeNotationUtm||(C.PeNotationUtm={}));var p;(function(m){var k=new Map;m.init=function(){m.PE_PCSINFO_OPTION_NONE=C._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;m.PE_PCSINFO_OPTION_DOMAIN=
C._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;m.PE_POLE_OUTSIDE_BOUNDARY=C._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;m.PE_POLE_POINT=C._pe.PePCSInfo.prototype.PE_POLE_POINT};m.generate=function(A,w){void 0===w&&(w=m.PE_PCSINFO_OPTION_DOMAIN);var q;if(k.has(A)){var B=k.get(A);B[w]&&(q=B[w])}q||(q=C._pe.PePCSInfo.prototype.generate(A,w),B||(B=[],k.set(A,B)),B[w]=q);return q}})(p=C.PePCSInfo||(C.PePCSInfo={}));(function(m){m.version_string=function(){return C._pe.PeVersion.prototype.version_string()}})(C.PeVersion||
(C.PeVersion={}));C._init=g})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,I){C.__proto__=I}||function(C,I){for(var G in I)I.hasOwnProperty(G)&&(C[G]=I[G])};return function(C,I){function G(){this.constructor=C}O(C,I);C.prototype=null===I?Object.create(I):(G.prototype=I.prototype,new G)}}()})},"widgets/SmartEditor/coordinateUtils":function(){define("dojo/_base/lang dojo/Deferred esri/geometry/webMercatorUtils esri/SpatialReference esri/geometry/coordinateFormatter esri/geometry/Point".split(" "),
function(O,C,I,G,e,g){var v={};e.load();v.getProjectedGeometry=function(d,x,t){var h=new C;if(I.canProject(d,x)){var f=I.project(d,x);h.resolve(f)}else t.project([d],x,function(b){f=b[0];h.resolve(f)},function(){h.reject(null)});return h.promise};v.getMapCoordinates=function(d){switch(d.type){case "polygon":var x=d.getCentroid();break;case "polyline":x=d.getPoint(0,0);break;case "point":x=d}return x};v.getCoordinatesData=function(d,x){var t={};var h=new C;var f=new G(4326);t.MapSpatialReference=v.getMapCoordinates(d);
v.getProjectedGeometry(t.MapSpatialReference,f,x).then(O.hitch(this,function(b){t.LatLong=b;this._getMGRSCoordinatesData(h,t)}),O.hitch(this,function(){t.LatLong={x:"",y:""};t.MGRS={MGRS:""};h.resolve(t)}));return h.promise};v._getMGRSCoordinatesData=function(d,x){var t="";t=new g(x.LatLong.x,x.LatLong.y,new G({wkid:4326}));t=e.toMgrs(t,"automatic",5);x.MGRS={MGRS:t};d.resolve(x)};v.getCoordinatesDataWhenXYEmpty=function(d){var x={},t=new C;x.MapSpatialReference={x:"",y:""};x.LatLong=d;this._getMGRSCoordinatesData(t,
x);return t.promise};return v})},"widgets/SmartEditor/addressUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred esri/request jimu/portalUtils jimu/dijit/Message dijit/_WidgetBase".split(" "),function(O,C,I,G,e,g,v){return O([v],{_initialLoad:!0,postCreate:function(){},locateAddress:function(d){var x=new I;if(this.canGeocode){var t={};t={f:"json",location:JSON.stringify(d),distance:100,outSR:JSON.stringify(d.spatialReference),forStorage:!0};this.userToken&&(t.token=this.userToken);
G({url:this.config.geocoderSettings.url+"/reverseGeocode",content:t,callbackParamName:"callback"}).then(C.hitch(this,function(h){this._initialLoad=!1;h&&h.address&&(h=h.address);x&&x.resolve(h)}),C.hitch(this,function(){this._initialLoad&&(this._initialLoad=!1,new g({message:this.nls.unableToUseLocator}));x.resolve({})}))}else x.resolve({});return x.promise}})})},"widgets/SmartEditor/Intersection":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/BaseWidgetSetting esri/tasks/query esri/tasks/QueryTask esri/geometry/Extent esri/geometry/geometryEngine esri/SpatialReference esri/geometry/webMercatorUtils dojo/_base/array".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h){return O([G],{baseClass:"jimu-widget-smartEditor-widgets-intersection",layerFieldsObj:{},queriedLayers:[],layersInvolvedInIgnoreLayerRanking:[],maxToleranceForlayer:{},maxToleranceForlayerInPx:{},completeFeatures:{},postCreate:function(){this.startup();this.layerFieldsObj={};this.queriedLayers=[];this.maxToleranceForlayer={};this.maxToleranceForlayerInPx={};this.layersInvolvedInIgnoreLayerRanking=[];this.completeFeatures=[]},startup:function(){},_canGetGeodesicBuffers:function(f){var b=
new x(4326);return f&&t.canProject(f,b)?!0:!1},_getbufferedGeometry:function(f,b){return(f=this._canGetGeodesicBuffers(f)?d.geodesicBuffer([f],[b],"meters",!0):d.buffer([f],[b],"meters",!0))&&0<f.length?f[0]:null},getToleranceValueInMeters:function(f){var b=0;f&&(f.useDefault?(b=this.defaultToleranceSettings.value,f=this.defaultToleranceSettings.unit):(b=f.value,f=f.unit),b=this.convertToMeters(b,f));return b},setMaxToleranceForLayer:function(f,b){var a=this.getToleranceValueInMeters(b);if(b&&"px"===
b.unit&&!b.useDefault){if(b=b.value,!this.maxToleranceForlayerInPx.hasOwnProperty(f)||this.maxToleranceForlayerInPx[f]<b)this.maxToleranceForlayerInPx[f]=b}else 0<a&&(!this.maxToleranceForlayer.hasOwnProperty(f)||this.maxToleranceForlayer[f]<a)?this.maxToleranceForlayer[f]=a:0===a&&(b=this.defaultPixelsTolerance,!this.maxToleranceForlayerInPx.hasOwnProperty(f)||this.maxToleranceForlayerInPx[f]<b)&&(this.maxToleranceForlayerInPx[f]=b)},convertToMeters:function(f,b){var a=f;switch(b){case "meters":a=
f;break;case "feet":a=.3048*f;break;case "kilometers":a=1E3*f;break;case "miles":a=1609.34*f}return a},getDistinctLayers:function(f,b){var a=new I;var n=new I;var p={};this.layerFieldsObj={};this.queriedLayers=[];this.ignoreLayerRanking=!1;this.drawnGeometry=b;if(f.fieldValues){for(var m in f.fieldValues){p[m]=[];for(var k=0;k<f.fieldValues[m].length;k++){var A=f.fieldValues[m][k];if("Intersection"===A.actionName&&A.enabled){A.ignoreLayerRanking&&(this.ignoreLayerRanking=!0);for(var w=0;w<A.fields.length;w++){var q=
A.fields[w];-1===p[m].indexOf(q.layerId)&&p[m].push(q.layerId);-1===this.layersInvolvedInIgnoreLayerRanking.indexOf(q.layerId)&&A.ignoreLayerRanking&&this.layersInvolvedInIgnoreLayerRanking.push(q.layerId);this.setMaxToleranceForLayer(q.layerId,q.toleranceSettings)}}}}this._getIntersectionsForEachField(p,b,n)}else n.resolve({});n.then(C.hitch(this,function(){var B={},l;if(f.fieldValues)for(var u in f.fieldValues){B[u]={};for(var D=0;D<f.fieldValues[u].length;D++){var z=f.fieldValues[u][D];if("Intersection"===
z.actionName&&z.enabled)if(z.ignoreLayerRanking){var L=this._getClosestFeature(z.fields);B[u]=L.attr;for(var F={},Q=0;Q<z.fields.length;Q++){var T=z.fields[Q];F.hasOwnProperty(T.layerId)||(F[T.layerId]=[]);-1===F[T.layerId].indexOf(T.field)&&F[T.layerId].push(T.field)}if(L.intersectingFeatures&&1<L.intersectingFeatures.length){var E=[];h.forEach(L.intersectingFeatures,function(J){for(var P=F[J.layerId],R=0;R<P.length;R++)if(J.attributes&&J.attributes.hasOwnProperty(P[R])){var Y=J.attributes[P[R]];
null!==Y&&""!==Y&&0>E.indexOf(Y)&&E.push(Y)}});1<E.length&&(l||(l={}),l[u]=E)}}else for(T=0;T<z.fields.length;T++){var M=z.fields[T];Q=M.layerId;if(!B[u].hasOwnProperty(Q)&&(L=this._getProcessedFeature(Q,M.toleranceSettings))&&L.attributes){z=L.attributes;T={};T[M.field]=z[M.field];B[u][Q]=T;L.intersectingFeatures&&1<L.intersectingFeatures.length&&"esriCTUseLayerName"!==M.field&&(E=[],h.forEach(L.intersectingFeatures,function(J){J=J.attributes[M.field];null!==J&&""!==J&&0>E.indexOf(J)&&E.push(J)}),
1<E.length&&(l||(l={}),l[u]=E));break}}}}a.resolve({result:B,multipleValues:l})}));return a.promise},_getIntersectingFeatures:function(f,b){var a,n;var p=[];var m=0;if(n=this._jimuLayerInfos.getLayerOrTableInfoById(f))var k=n.layerObject;else return p;if(this.completeFeatures.hasOwnProperty(f)&&(n=this.completeFeatures[f],b&&"px"!==b.unit&&(m=this.getToleranceValueInMeters(b)),0<n.length&&(m?a=this._getbufferedGeometry(this.drawnGeometry,m):this.maxToleranceForlayer.hasOwnProperty(f)&&this.maxToleranceForlayer[f]||
this.maxToleranceForlayerInPx.hasOwnProperty(f)&&this.maxToleranceForlayerInPx[f]?a="point"===this.drawnGeometry.type?this.maxToleranceForlayerInPx.hasOwnProperty(f)?this.pointToExtent(this.map,this.drawnGeometry,this.maxToleranceForlayerInPx[f]):this.pointToExtent(this.map,this.drawnGeometry,this.defaultPixelsTolerance):this.drawnGeometry:p=n,a)))for(f=0;f<n.length;f++)b=n[f],b.geometry&&d.intersects(a,b.geometry)&&(b.attributes.esriCTUseLayerName=k.name,p.push(b));return p},_getClosestFeature:function(f){var b,
a,n=[];var p={};f=this._resetFieldsWithMapLayerOrder(f);for(b=0;b<f.length;b++){var m=[];var k=f[b].layerId;m=this._getIntersectingFeatures(k,f[b].toleranceSettings);for(a=0;a<m.length;a++)this.drawnGeometry&&m[a].geometry&&(m[a].distanceToLocation=d.distance(this.drawnGeometry,m[a].geometry,"meters")),m[a].layerId=k,m[a].fields?m[a].fields.push(f[b].field):m[a].fields=[f[b].field];n=n.concat(m)}if(0<n.length){n.sort(function(q,B){return q.distanceToLocation<B.distanceToLocation?-1:q.distanceToLocation>
B.distanceToLocation?1:0});var A=n[0].attributes;f=this._jimuLayerInfos.getLayerOrTableInfoById(n[0].layerId).layerObject;A.esriCTUseLayerName=f.name;var w={};h.forEach(n[0].fields,function(q){w[q]=A[q]});p[n[0].layerId]=w}return{attr:p,intersectingFeatures:n}},_resetFieldsWithMapLayerOrder:function(f){var b=[];var a=this._jimuLayerInfos.getLayerInfoArray();h.forEach(a,C.hitch(this,function(n){h.forEach(f,C.hitch(this,function(p){n.newSubLayers&&0<n.newSubLayers.length?h.forEach(n.newSubLayers,C.hitch(this,
function(m){m.id===p.layerId&&b.push(p)})):n.id===p.layerId&&b.push(p)}))}));return b},_getProcessedFeature:function(f,b){var a=[];a=this._getIntersectingFeatures(f,b);if(0<a.length){var n=a[0].attributes;f=this._jimuLayerInfos.getLayerOrTableInfoById(f).layerObject;n.esriCTUseLayerName=f.name}return{attributes:n,intersectingFeatures:a}},_getIntersectionsForEachField:function(f,b,a){var n=Object.keys(f);var p=0;this.maxToleranceForlayer&&(p=Object.keys(this.maxToleranceForlayer).length);if(0<n.length){var m=
n[0];(this.ignoreLayerRanking||0<p?this._asyncIntersectionRequests(f[m],b):this._syncIntersectionRequests(f[m],b)).then(C.hitch(this,function(){this.ignoreLayerRanking||0<p?f[m]&&0===f[m].length&&delete f[m]:delete f[m];this._getIntersectionsForEachField(f,b,a)}))}else a.resolve()},_filterQueriedLayers:function(f){for(var b in this.layerFieldsObj){var a=f.indexOf(b);-1<a&&f.splice(a,1)}return f},_asyncIntersectionRequests:function(f,b,a){a||(a=new I);f=this._filterQueriedLayers(f);0<f.length?this._getIntersectedFeatures(f[0],
b).then(C.hitch(this,function(n){f.splice(0,1);0<f.length?(this._asyncIntersectionRequests(f,b,a),this._intersectionResult(n)):this._intersectionResult(n,a)})):a.resolve();return a.promise},_syncIntersectionRequests:function(f,b,a){a||(a=new I);f=this._filterQueriedLayers(f);0<f.length?this._getIntersectedFeatures(f[0],b).then(C.hitch(this,function(n){0<n.features.length?this._intersectionResult(n,a):(f.splice(0,1),0<f.length?this._syncIntersectionRequests(f,b,a):this._intersectionResult(n,a))})):
a.resolve();return a.promise},_intersectionResult:function(f,b){f.layerId&&(this.layerFieldsObj[f.layerId]={},f.features&&0<f.features.length&&(this.layerFieldsObj[f.layerId]=f.featuresAttributes));b&&b.resolve()},pointToExtent:function(f,b,a){if(0===a)return b;var n=f.extent.getWidth()/f.width;a*=n;return new v(b.x-a,b.y-a,b.x+a,b.y+a,f.spatialReference)},_getAppropriateGeometryForQuery:function(f,b){if(this.maxToleranceForlayer.hasOwnProperty(f))var a=this._getbufferedGeometry(b,this.maxToleranceForlayer[f]);
else a=b,"point"===b.type&&(a=this.maxToleranceForlayerInPx.hasOwnProperty(f)?this.pointToExtent(this.map,b,this.maxToleranceForlayerInPx[f]):this.pointToExtent(this.map,b,this.defaultPixelsTolerance));return a},_getIntersectedFeatures:function(f,b){var a;var n=new I;if(this._jimuLayerInfos.getLayerOrTableInfoById(f)){var p=this._jimuLayerInfos.getLayerOrTableInfoById(f);var m=this._jimuLayerInfos.getLayerOrTableInfoById(f).layerObject}else return n.resolve({layerId:f,features:[],featuresAttributes:{}}),
n.promise;var k=m.objectIdField||null;var A=new e;var w=new g(m.url);A.geometry=this._getAppropriateGeometryForQuery(f,b);A.outFields=["*"];if(p=p&&(p.subId||0===p.subId)&&p.parentLayerInfo&&p.parentLayerInfo.layerObject?this._getSubLayerDefinitionExpression(p.subId,p.parentLayerInfo):m&&m.getDefinitionExpression?m.getDefinitionExpression():"")A.where=p;-1<this.layersInvolvedInIgnoreLayerRanking.indexOf(f)||this.maxToleranceForlayer.hasOwnProperty(f)||this.maxToleranceForlayerInPx.hasOwnProperty(f)?
(A.returnGeometry=!0,A.outSpatialReference=new x(b.spatialReference.toJson())):A.returnGeometry=!1;w.execute(A,C.hitch(this,function(q){q&&q.features&&0<q.features.length?(k&&q.features.sort(function(B,l){B=parseInt(B.attributes[k],10);l=parseInt(l.attributes[k],10);return B>l?-1:1}),a=q.features[0].attributes):(q={features:[]},a={});this.completeFeatures[f]=q.features;n.resolve({layerId:f,features:q.features,featuresAttributes:a})}),C.hitch(this,function(){this.completeFeatures[f]=[];n.resolve({layerId:f,
features:[],featuresAttributes:{}})}));return n.promise},_getSubLayerDefinitionExpression:function(f,b){return b&&b.layerObject&&b.layerObject.layerDefinitions?b.layerObject.layerDefinitions[f]:b.parentLayerInfo?this._getSubLayerDefinitionExpression(f,b.parentLayerInfo):""}})})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l){O=I("esri.dijit.LocateButton",[d,t,C],{templateString:b,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new B(O.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(u,D){u=G.mixin({},this.options,u);this.domNode=
D;this._i18n=a;D=navigator.geolocation;var z=window.hasOwnProperty("isSecureContext");z=z&&window.isSecureContext||!z&&"https:"===window.location.protocol;z&&D||(u.visible=!1);D||console.log("LocateButton::navigator.geolocation unsupported.");z||console.log("LocateButton::navigator.geolocation requires a secure origin.");this.set("map",u.map);this.set("theme",u.theme);this.set("visible",u.visible);this.set("scale",u.scale);this.set("highlightLocation",u.highlightLocation);this.set("symbol",u.symbol);
this.set("infoTemplate",u.infoTemplate);this.set("geolocationOptions",u.geolocationOptions);this.set("useTracking",u.useTracking);this.set("setScale",u.setScale);this.set("centerAt",u.centerAt);this.set("timeout",u.timeout);this.set("graphicsLayer",u.graphicsLayer);this.set("clearOnTrackingStop",u.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",G.hitch(this,function(){this.get("tracking")&&
!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(h(this._locateNode,x,G.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||(this.set("visible",!1),console.log("LocateButton::map required"));if(this.get("map").loaded)this._init();else h.once(this.get("map"),"load",G.hitch(this,function(){this._init()}))},
destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var u=this.get("highlightGraphic"),D=this.get("graphicsLayer");u&&(D?D.remove(u):this.get("map").graphics.remove(u),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?
this.get("tracking")?m.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):m.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):m.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){n.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();
this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(u){return u?{coords:G.mixin({},u.coords),timestamp:u.timestamp}:{}},_startTracking:function(){n.add(this._locateNode,this._css.tracking);this._removeWatchPosition();var u=navigator.geolocation.watchPosition(G.hitch(this,function(D){D=this._positionToObject(D);this._setPosition(D).then(G.hitch(this,function(z){this._locateEvent(z)}),G.hitch(this,function(z){z||(z=Error("LocateButton::Error setting the position."));
this._locateError(z)}))}),G.hitch(this,function(D){this.set("tracking",!1);D||(D=Error("LocateButton::Could not get tracking position."));this._locateError(D)}),this.get("geolocationOptions"));this.set("watchId",u)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var u=new f;this._removePrivateVars();var D=setTimeout(G.hitch(this,function(){clearTimeout(D);u.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));
navigator.geolocation.getCurrentPosition(G.hitch(this,function(z){z=this._positionToObject(z);clearTimeout(D);this._setPosition(z).then(G.hitch(this,function(L){u.resolve(L)}),G.hitch(this,function(L){L||(L=Error("LocateButton::Error setting map position."));u.reject(L)}))}),G.hitch(this,function(z){z||(z=Error("LocateButton::Could not get current position."));u.reject(z)}),this.get("geolocationOptions"));return u.promise},_locate:function(){var u=new f;this._showLoading();if(navigator.geolocation)this.get("useTracking")?
this.get("tracking")?(this._startTracking(),u.resolve({tracking:!0})):(this._stopTracking(),u.resolve({tracking:!1})):this._getCurrentPosition().then(G.hitch(this,function(z){this._locateEvent(z);u.resolve(z)}),G.hitch(this,function(z){z||(z=Error("LocateButton::Could not get current position."));this._locateError(z);u.reject(z)}));else{var D=Error("LocateButton::geolocation unsupported");this._locateError(D);u.reject(D)}this._setTitle();return u.promise},_projectPoint:function(u){var D=new f,z=this.get("map").spatialReference,
L=z.wkid;z.isWebMercator()?(u=k.geographicToWebMercator(u),D.resolve(u)):v.defaults.geometryService&&4326!==L?(L=new l,L.geometries=[u],L.outSR=z,v.defaults.geometryService.project(L).then(G.hitch(this,function(F){F&&F.length?D.resolve(F[0]):D.reject(Error("LocateButton::Point was not projected."))}),function(F){F||(F=Error("LocateButton::please specify a geometry service on esri/config to project."));D.reject(F)})):D.resolve(u);return D.promise},_getScale:function(u){var D=this.get("scale");return u&&
u.coords?D||u.coords.accuracy||5E4:D||5E4},_createPoint:function(u){var D;u&&u.coords&&(D=new A([u.coords.longitude,u.coords.latitude],new w({wkid:4326})));return D},_setPosition:function(u){var D=new f,z,L;this._removePrivateVars();if((this._position=u)&&u.coords){if(z=this._createPoint(u))this._graphic=L=this._createGraphic(z,u);var F=this._getScale(u);this._scale=F;z?this._projectPoint(z).then(G.hitch(this,function(Q){this._graphic=L=this._createGraphic(Q,u);var T={graphic:L,scale:F,position:u};
this.get("setScale")&&this.get("map").setScale(F);this.get("centerAt")?this.get("map").centerAt(Q).then(G.hitch(this,function(){D.resolve(T)}),G.hitch(this,function(E){E||(E=Error("LocateButton::Could not center map."));D.reject(E)})):D.resolve(T)}),G.hitch(this,function(Q){Q||(Q=Error("LocateButton::Error projecting point."));D.reject(Q)})):(z=Error("LocateButton::Invalid point"),D.reject(z))}else z=Error("LocateButton::Invalid position"),D.reject(z);return D.promise},_createGraphic:function(u,D){if(u){D=
{position:D};var z=new q(u,this.get("symbol"),D,this.get("infoTemplate"))}return z},_locateEvent:function(u){if(u.graphic){var D=this.get("highlightGraphic"),z=this.get("graphicsLayer");D?(D.setGeometry(u.graphic.geometry),D.setAttributes(u.graphic.attributes),D.setInfoTemplate(u.graphic.infoTemplate),D.setSymbol(u.graphic.symbol)):(D=u.graphic,this.get("highlightLocation")&&(z?z.add(D):this.get("map").graphics.add(D)));this.set("highlightGraphic",D)}this._hideLoading();this.emit("locate",u)},_locateError:function(u){u=
{graphic:this._graphic,scale:this._scale,position:this._position,error:u};this._hideLoading();this.emit("locate",u)},_showLoading:function(){this.get("useTracking")||n.add(this._locateNode,this._css.loading)},_hideLoading:function(){this.get("useTracking")||n.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(u,D,z){n.remove(this.domNode,
D);n.add(this.domNode,z)},_visible:function(){this.get("visible")?p.set(this.domNode,"display","block"):p.set(this.domNode,"display","none")}});e("extend-esri")&&G.setObject("dijit.LocateButton",O,g);return O})},"jimu/dijit/FeatureSetChooserForMultipleLayers":function(){define("dojo/on dojo/sniff dojo/mouse dojo/query dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/FeatureSetChooserForMultipleLayers.html dijit/popup dijit/TooltipDialog jimu/utils jimu/dijit/DrawBox jimu/dijit/_FeatureSetChooserCore jimu/SelectionManager jimu/dijit/FeatureActionPopupMenu".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q){return t([h,f,b,e],{baseClass:"jimu-multiple-layers-featureset-chooser",declaredClass:"jimu.dijit.FeatureSetChooserForMultipleLayers",templateString:a,drawBox:null,_instances:null,_tooltipDialogTimeoutId1:-1,_tooltipDialogClientX1:-1,_tooltipDialogTimeoutId2:-1,_tooltipDialogClientX2:-1,_tooltipTimeout:1E3,_currentGeoTypeInfo:null,_geoTypeInfos:null,map:null,updateSelection:!1,fullyWithin:!1,geoTypes:null,actions:null,postMixInProperties:function(){this.inherited(arguments);
this.nls=window.jimuNls.featureSetChooser;var B="POINT EXTENT POLYGON CIRCLE POLYLINE FREEHAND_POLYGON".split(" ");this.geoTypes&&0<this.geoTypes.length&&(this.geoTypes=d.filter(this.geoTypes,v.hitch(this,function(l){return 0<=B.indexOf(l)})));this.geoTypes&&0!==this.geoTypes.length||(this.geoTypes=["EXTENT"])},postCreate:function(){this.inherited(arguments);this._instances=[];this.popupMenu=q.getInstance();G(".select-text",this.domNode)[0].innerHTML=this.nls.select;G(".clear-text",this.domNode)[0].innerHTML=
window.jimuNls.common.clear;this._initTooltipDialogs();this._initDrawBox();this._geoTypeInfos=[];this.actions=[];0===this.geoTypes.length&&this.geoTypes.push("EXTENT");1===this.geoTypes.length?g.addClass(this.domNode,"single-geotype"):g.addClass(this.domNode,"multiple-geotypes");var B={POINT:["icon-select-by-point",this.nls.selectByPoint,this.drawBox.pointIcon],EXTENT:["icon-select-by-rect",this.nls.selectByRectangle,this.drawBox.extentIcon],POLYGON:["icon-select-by-polygon",this.nls.selectByPolygon,
this.drawBox.polygonIcon],CIRCLE:["icon-select-by-circle",this.nls.selectByCircle,this.drawBox.circleIcon],POLYLINE:["icon-select-by-line",this.nls.selectByLine,this.drawBox.polylineIcon],FREEHAND_POLYGON:["icon-select-by-freehand-polygon",this.nls.selectByFreehandPolygon,this.drawBox.freehandPolygonIcon]},l=-1;d.forEach("POINT EXTENT POLYGON CIRCLE POLYLINE FREEHAND_POLYGON".split(" "),v.hitch(this,function(u){var D=B[u];if(0<=this.geoTypes.indexOf(u)){var z={geoType:u,action:{iconClass:D[0],label:D[1],
data:{}},dom:D[2]};D={iconClass:D[0],label:D[1],data:{},onExecute:v.hitch(this,this._onDrawItemClicked,z)};this._geoTypeInfos.push(z);this.actions.push(D);"EXTENT"===u&&(l=this._geoTypeInfos.length-1)}}));this.own(O(this.btnSelect,"click",v.hitch(this,function(){m.simulateClickEvent(this._currentGeoTypeInfo.dom);this._hideDrawItems()})));0<=l?(this._setCurrentGeoInfo(this._geoTypeInfos[l]),g.addClass(this.geoTypeIcon,"icon-select-by-rect")):(this._setCurrentGeoInfo(this._geoTypeInfos[0]),g.addClass(this.geoTypeIcon,
this._geoTypeInfos[0].action.iconClass));this.deactivate()},_initTooltipDialogs:function(){var B=C("mac")?"\u2318":"Ctrl",l="- "+this.nls.newSelectionTip+" ("+this.nls.dragMouse+")",u="- "+this.nls.addSelectionTip+" (Shift+"+this.nls.dragBox+")",D="- "+this.nls.removeSelectionTip+" ("+B+"+"+this.nls.dragBox+")",z="- "+this.nls.newSelectionTip+" ("+this.nls.drawShap+")",L="- "+this.nls.addSelectionTip+" (Shift+"+this.nls.darw+")",F="- "+this.nls.removeSelectionTip+" ("+B+"+"+this.nls.darw+")";B=g.create("div",
{innerHTML:'\x3cdiv class\x3d"title"\x3e\x3c/div\x3e\x3cdiv class\x3d"item new-selection-item"\x3e\x3c/div\x3e\x3cdiv class\x3d"item add-selection-item"\x3e\x3c/div\x3e\x3cdiv class\x3d"item remove-selection-item"\x3e\x3c/div\x3e',"class":"dialog-content"});var Q=G(".title",B)[0],T=G(".new-selection-item",B)[0],E=G(".add-selection-item",B)[0],M=G(".remove-selection-item",B)[0];this.tooltipDialog1=new p({content:B});g.addClass(this.tooltipDialog1.domNode,"jimu-multiple-layers-featureset-chooser-tooltipdialog");
this.own(O(this.btnSelect,"mousemove",v.hitch(this,function(J){this._tooltipDialogClientX1=J.clientX})));this.own(O(this.btnSelect,I.enter,v.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId1);this._tooltipDialogTimeoutId1=-1;this._tooltipDialogTimeoutId1=setTimeout(v.hitch(this,function(){if(this.tooltipDialog1){var J=this._currentGeoTypeInfo.geoType;"EXTENT"===J?(T.innerHTML=l,E.innerHTML=u,M.innerHTML=D,Q.innerHTML=this.nls.selectByRectangle):(T.innerHTML=z,E.innerHTML=L,M.innerHTML=
F,"POLYGON"===J?Q.innerHTML=this.nls.selectByPolygon:"CIRCLE"===J?Q.innerHTML=this.nls.selectByCircle:"POLYLINE"===J?Q.innerHTML=this.nls.selectByLine:"FREEHAND_POLYGON"===J?Q.innerHTML=this.nls.selectByFreehandPolygon:"POINT"===J&&(Q.innerHTML=this.nls.selectByPoint));n.open({parent:this.getParent(),popup:this.tooltipDialog1,around:this.btnSelect,position:["below"]});0<=this._tooltipDialogClientX1&&(this.tooltipDialog1.domNode.parentNode.style.left=this._tooltipDialogClientX1+"px")}}),this._tooltipTimeout)})));
this.own(O(this.btnSelect,I.leave,v.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId1);this._tooltipDialogTimeoutId1=-1;this._hideTooltipDialog(this.tooltipDialog1)})));B=g.create("div",{innerHTML:this.nls.unselectAllSelectionTip,"class":"dialog-content"});this.tooltipDialog2=new p({content:B});g.addClass(this.tooltipDialog2.domNode,"jimu-multiple-layers-featureset-chooser-tooltipdialog");this.own(O(this.btnClear,"mousemove",v.hitch(this,function(J){this._tooltipDialogClientX2=J.clientX})));
this.own(O(this.btnClear,I.enter,v.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId2);this._tooltipDialogTimeoutId2=-1;this._tooltipDialogTimeoutId2=setTimeout(v.hitch(this,function(){this.tooltipDialog2&&(n.open({parent:this.getParent(),popup:this.tooltipDialog2,around:this.btnClear,position:["below"]}),0<=this._tooltipDialogClientX2&&(this.tooltipDialog2.domNode.parentNode.style.left=this._tooltipDialogClientX2+"px"))}),this._tooltipTimeout)})));this.own(O(this.btnClear,I.leave,v.hitch(this,
function(){clearTimeout(this._tooltipDialogTimeoutId2);this._tooltipDialogTimeoutId2=-1;this._hideTooltipDialog(this.tooltipDialog2)})))},_onArrowClicked:function(B){B.stopPropagation();B=g.position(B.target);this._showDrawItems(B)},_setCurrentGeoInfo:function(B){var l=this._currentGeoTypeInfo&&this._currentGeoTypeInfo.geoType;this._currentGeoTypeInfo&&g.removeClass(this.currentDrawItem,this._currentGeoTypeInfo.geoType);this._currentGeoTypeInfo=B;g.addClass(this.currentDrawItem,this._currentGeoTypeInfo.geoType);
this.isActive()?l!==this._currentGeoTypeInfo.geoType&&m.simulateClickEvent(this._currentGeoTypeInfo.dom):m.simulateClickEvent(this._currentGeoTypeInfo.dom)},_showDrawItems:function(B){this.popupMenu.setActions(this.actions);this.popupMenu.markAsSelected(this._currentGeoTypeInfo.action);this.popupMenu.show(B)},_hideDrawItems:function(){this.popupMenu.hide()},_onDrawItemClicked:function(B){this._hideDrawItems();this._setCurrentGeoInfo(B);g.removeClass(this.geoTypeIcon,"icon-select-by-point icon-select-by-circle icon-select-by-rect icon-select-by-polygon icon-select-by-line icon-select-by-freehand-polygon".split(" "));
switch(B.geoType){case "POLYGON":g.addClass(this.geoTypeIcon,"icon-select-by-polygon");break;case "CIRCLE":g.addClass(this.geoTypeIcon,"icon-select-by-circle");break;case "POLYLINE":g.addClass(this.geoTypeIcon,"icon-select-by-line");break;case "FREEHAND_POLYGON":g.addClass(this.geoTypeIcon,"icon-select-by-freehand-polygon");break;case "POINT":g.addClass(this.geoTypeIcon,"icon-select-by-point");break;default:g.addClass(this.geoTypeIcon,"icon-select-by-rect")}},_initDrawBox:function(){this.drawBox=
new k({map:this.map,showClear:!0,keepOneGraphic:!0,deactivateAfterDrawing:!1,geoTypes:this.geoTypes});this.own(O(this.drawBox,"user-clear",v.hitch(this,this._onDrawBoxUserClear)));this.own(O(this.drawBox,"draw-end",v.hitch(this,this._onDrawEnd)));this.own(O(this.drawBox,"draw-activate",v.hitch(this,function(){this.map.infoWindow.hide();g.addClass(this.currentDrawItem,"pressed");g.addClass(this.btnSelect,"selected")})));this.own(O(this.drawBox,"draw-deactivate",v.hitch(this,function(){g.removeClass(this.currentDrawItem,
"pressed");g.removeClass(this.btnSelect,"selected")})));this.own(O(this.btnClear,"click",v.hitch(this,function(){m.simulateClickEvent(this.drawBox.btnClear)})))},disable:function(){this.drawBox.disable();g.addClass(this.domNode,"disabled")},enable:function(){this.drawBox.enable();g.removeClass(this.domNode,"disabled")},isActive:function(){return this.drawBox.isActive()},activate:function(){if(!this.isActive()){var B=this._currentGeoTypeInfo;B||(B=this._geoTypeInfos[0]);this._setCurrentGeoInfo(B)}},
deactivate:function(){this.drawBox.deactivate()},setFeatureLayers:function(B){var l=d.filter(this._instances,v.hitch(this,function(D){return 0>B.indexOf(D.featureLayer)}));d.forEach(l,v.hitch(this,function(D){this._removeInstance(D)}));var u=d.map(this._instances,v.hitch(this,function(D){return D.featureLayer}));d.forEach(B,v.hitch(this,function(D){0>u.indexOf(D)&&this.addFeatureLayer(D)}))},addFeatureLayer:function(B){"esri.layers.FeatureLayer"!==B.declaredClass||this._findInstanceByLayer(B)||(B=
new A({map:this.map,featureLayer:B,drawBox:this.drawBox,updateSelection:this.updateSelection,fullyWithin:this.fullyWithin}),this._instances.push(B))},removeFeatureLayer:function(B){"esri.layers.FeatureLayer"===B.declaredClass&&(B=this._findInstanceByLayer(B))&&this._removeInstance(B)},setDisplayLayerVisibility:function(B,l){(B=w.getInstance().getDisplayLayer(B.id))&&(l?B.show():B.hide())},_removeInstance:function(B){if(B){var l=this._instances.indexOf(B);0<=l&&(B.destroy(),this._instances.splice(l,
1))}},_findInstanceByLayer:function(B){var l=null;d.some(this._instances,v.hitch(this,function(u){return u.featureLayer===B?(l=u,!0):!1}));return l},clear:function(B){d.forEach(this._instances,v.hitch(this,function(l){l.clear(B)}))},destroy:function(){this._hideTooltipDialog(this.tooltipDialog1);this._hideTooltipDialog(this.tooltipDialog2);d.forEach(this._instances,v.hitch(this,function(B){B.destroy()}));this._instances=[];this.drawBox&&this.drawBox.destroy();this.drawBox=null;this.inherited(arguments)},
_hideTooltipDialog:function(B){B&&n.close(B)},_onDrawBoxUserClear:function(){this.clear(!0);this.emit("user-clear")},_onDrawEnd:function(B,l,u,D,z,L){this.drawBox.clear();0<this._instances.length&&setTimeout(v.hitch(this,function(){if(0<this._instances.length){this.emit("loading");this.disable();var F=d.map(this._instances,v.hitch(this,function(Q){return Q.getFeatures()}));x(F).always(v.hitch(this,function(){this.enable();this._currentGeoTypeInfo&&m.simulateClickEvent(this._currentGeoTypeInfo.dom);
this.emit("unloading",B,l,u,D,z,L)}))}}),50)}})})},"jimu/dijit/_FeatureSetChooserCore":function(){define("dojo/on dojo/sniff dojo/Evented dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/declare jimu/utils jimu/symbolUtils jimu/SelectionManager jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/symbols/jsonUtils esri/geometry/geometryEngine".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m){return v([I],{baseClass:"jimu-featureset-chooser-core",
_middleFeatureLayer:null,_isLoading:!1,_def:null,_isDestroyed:!1,_handles:null,selectionManager:null,layerInfosObj:null,layerInfo:null,map:null,featureLayer:null,drawBox:null,updateSelection:!1,fullyWithin:!1,constructor:function(k){e.mixin(this,k);this.layerInfosObj=h.getInstanceSync();this.selectionManager=t.getInstance();this.featureLayer.getSelectionSymbol()||this.selectionManager.setSelectionSymbol(this.featureLayer);k=d.getFeatureLayerDefinition(this.featureLayer);delete k.id;this._middleFeatureLayer=
new n({layerDefinition:k,featureSet:null},{id:"featureLayer_"+d.getRandomString()});k=null;var A=this._middleFeatureLayer.geometryType;"esriGeometryPoint"===A?k=x.getDefaultMarkerSymbol():"esriGeometryPolyline"===A?k=x.getDefaultLineSymbol():"esriGeometryPolygon"===A&&(k=p.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}));this._middleFeatureLayer.setSelectionSymbol(k);k=O(this.drawBox,"user-clear",e.hitch(this,
this._onDrawBoxUserClear));A=O(this.drawBox,"draw-end",e.hitch(this,this._onDrawEnd));this._handles=[k,A];if(this.layerInfo=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))k=O(this.layerInfo,"filterChanged",e.hitch(this,this._handleFilterChange)),this._handles.push(k)},hideMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.hide();var k=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);k&&k.hide()}},showMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.show();
var k=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);k&&k.show()}},clear:function(k){this.drawBox.clear();this._clearMiddleFeatureLayer();k&&this.selectionManager.clearSelection(this.featureLayer)},getFeatures:function(){var k=new G,A=e.hitch(this,function(){var q=this.syncGetFeatures();k.resolve(q)}),w=e.hitch(this,function(q){k.reject(q)});1===this._getDeferredStatus(this._def)?this._def.then(A,w):A();return k},syncGetFeatures:function(){return(this.updateSelection?this.featureLayer:
this._middleFeatureLayer).getSelectedFeatures()},isLoading:function(){return 1===this._getDeferredStatus(this._def)},_onLoading:function(){this.drawBox.deactivate();this.emit("loading")},_onUnloading:function(){this.emit("unloading")},_getDeferredStatus:function(k){var A=0;return A=k?k.isResolved()?2:k.isRejected()?-1:1:0},_onDrawEnd:function(k,A,w,q,B,l){if(this.isLoading())throw"should not draw when loading";if(this.featureLayer.visible){var u=new G;this._def=u;var D=n.SELECTION_NEW;q&&(D=n.SELECTION_ADD);
C("mac")?l&&(D=n.SELECTION_SUBTRACT):B&&(D=n.SELECTION_SUBTRACT);this.emit("loading");this._getFeaturesByGeometry(k.geometry).then(e.hitch(this,function(z){this.selectionManager.updateSelectionByFeatures(this.updateSelection?this.featureLayer:this._middleFeatureLayer,z,D);this._onUnloading();u.resolve(z)}),e.hitch(this,function(z){console.error(z);this._onUnloading();u.reject(z)}))}},_addTolerance:function(k){var A=2.54*this.map.getScale()/9600;return m.buffer(k,10*A,"meters")},_getFeaturesByGeometry:function(k){"point"!==
k.type&&"polyline"!==k.type||"esriGeometryPoint"!==this.featureLayer.geometryType||(k=this._addTolerance(k));var A=new G,w=[];if(this.featureLayer.getMap()&&this.featureLayer.mode!==n.MODE_SELECTION)k=this.selectionManager.getClientFeaturesByGeometry(this.featureLayer,k,this.fullyWithin),0<k.length&&(w=g.map(k,e.hitch(this,function(B){return new f(B.toJson())}))),A.resolve(w);else{w=new b;w.geometry=k;w.outSpatialReference=this.map.spatialReference;w.returnGeometry=!0;w.spatialRelationship=this.fullyWithin?
b.SPATIAL_REL_CONTAINS:b.SPATIAL_REL_INTERSECTS;(k=this.featureLayer.getDefinitionExpression())||(k="1\x3d1");if(this.layerInfo){var q=this.layerInfo.getFilter();q&&(k="("+k+") AND ("+q+")")}k&&(w.where=k);w.outFields=["*"];(new a(this.featureLayer.url)).execute(w).then(e.hitch(this,function(B){A.resolve(B.features)}),e.hitch(this,function(B){A.reject(B)}))}return A},_onDrawBoxUserClear:function(){this.clear()},_clearMiddleFeatureLayer:function(){this._middleFeatureLayer&&(this._middleFeatureLayer.clear(),
this.selectionManager.clearSelection(this._middleFeatureLayer))},_handleFilterChange:function(){var k=this.layerInfo.getFilter()||"1\x3d1",A=this.featureLayer.getSelectedFeatures(),w=this.featureLayer.objectIdField;if(A&&0<A.length){var q=g.map(A,function(l){return l.attributes[w]}),B=new b;B.where=w+" in ("+q.join(",")+") AND "+k;(new a(this.featureLayer.url)).executeForIds(B).then(e.hitch(this,function(l){g.forEach(A,function(u){0<=l.indexOf(u.attributes[w])?u.show():u.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.featureLayer)&&
this.selectionManager._updateDisplayLayer(this.featureLayer,A,n.SELECTION_NEW);this.featureLayer.emit("selection-complete",{features:this.featureLayer.getSelectedFeatures()})}),e.hitch(this,function(l){console.error(l)}))}},destroy:function(){this._isDestroyed||(g.forEach(this._handles,e.hitch(this,function(k){k.remove()})),this._handles=null,this.clear());this._isDestroyed=!0}})})},"widgets/SmartEditor/copy-features":function(){define("dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/query dojo/string dojo/keys jimu/dijit/CheckBox dojo/dom-class dojo/dom-attr ./highlightSymbolUtils esri/layers/GraphicsLayer dojo/text!./copy-features.html jimu/dijit/Message esri/tasks/query esri/tasks/QueryTask dojo/Deferred dojo/promise/all jimu/dijit/LoadingIndicator dijit/ProgressBar dojo/dom-style jimu/dijit/Popup ./fieldsMapping".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D,z,L){return I([O,G,C],{templateString:m,layerLabel:null,featuresList:null,checkBoxNodes:{},layerCheckBoxNodes:{},featuresByLayerId:{},featureTitlesByLayerId:{},highlightGraphicsLayer:null,allChildCheckboxes:[],loading:null,fieldsMappingObj:null,layerOrderSequence:[],startup:function(){this.inherited(arguments);this.highlightGraphicsLayer=this._createNewGraphicsLayer("highlightGraphicsLayer");this.loading=new l({hidden:!0});this.loading.placeAt(this.parentDomNode)},
postCreate:function(){this.checkBoxNodes={};this.layerCheckBoxNodes={};this.featuresByLayerId={};this.featureTitlesByLayerId={};this.fieldsMappingObj=this.highlightGraphicsLayer=null;this.layerOrderSequence=[];this.applyEditsProgress=new u(null,this.applyEditsProgressParentNode);D.set(this.applyEditsProgress.domNode,"display","none");this.own(d(this.cancelBtn,"click",e.hitch(this,function(){this.cancelBtnClicked()})));this.own(d(this.cancelBtn,"keydown",e.hitch(this,function(F){F.keyCode!==h.ENTER&&
F.keyCode!==h.SPACE||this.cancelBtnClicked()})));this.own(d(this.createMultipleFeaturesBtn,"click",e.hitch(this,this._createMultipleFeaturesBtnClicked)));this.own(d(this.createMultipleFeaturesBtn,"keydown",e.hitch(this,function(F){F.keyCode!==h.ENTER&&F.keyCode!==h.SPACE||this._createMultipleFeaturesBtnClicked()})));this.own(d(this.createSingleFeatureBtn,"click",e.hitch(this,this._createSingleFeatureBtnClicked)));this.own(d(this.createSingleFeatureBtn,"keydown",e.hitch(this,function(F){F.keyCode!==
h.ENTER&&F.keyCode!==h.SPACE||this._createSingleFeatureBtnClicked()})));this.own(d(this.fieldsMatchingBtn,"click",e.hitch(this,this._fieldMatchingBtnClicked)));this.own(d(this.fieldsMatchingBtn,"keydown",e.hitch(this,function(F){F.keyCode!==h.ENTER&&F.keyCode!==h.SPACE||this._fieldMatchingBtnClicked()})))},selectFeaturesToCopy:function(F,Q){var T;this.allChildCheckboxes=[];if(F&&0<F.length){this.checkBoxNodes={};this.layerCheckBoxNodes={};this.featuresByLayerId={};this.featureTitlesByLayerId={};this.targetLayerDetails=
Q;var E=this.targetLayerDetails.featureLayer.geometryType;this._changeWarningNote(E);this._showHideSingleFeatureButton(E);this._showHideMultipleFeatureButton(E);b.remove(this.mainNode,"esriCTHidden");Q=new q;this._processSelectedFeatures(F,Q).then(e.hitch(this,function(){v.empty(this.layerListTable);var M=[];g.forEach(this.layerInfosObj.getLayerInfoArray(),e.hitch(this,function(P){if(this.featureTitlesByLayerId.hasOwnProperty(P.id))return M.push(P.id),this._createFeatureListUI(P.id,E),!0}));for(var J in this.featureTitlesByLayerId)this.featureTitlesByLayerId.hasOwnProperty(J)&&
-1===M.indexOf(J)&&(this.layerInfosObj.getLayerInfoById(J)||this.map._layers.hasOwnProperty(J))&&this._createFeatureListUI(J,E);this._canExpandFirstLayerNode()&&x(".esriCTExpandCollapseNode",this.domNode)[0].click();this._highlightFeatures();this.updateSingleFeatureButtonText();T=Object.keys(this.layerCheckBoxNodes);"esriGeometryPoint"===E&&this.hideMultipleFeatureButton&&1===this.allChildCheckboxes.length&&this.layerCheckBoxNodes&&1===T.length&&(this.layerCheckBoxNodes[T[0]].setStatus(!0),this.layerCheckBoxNodes[T[0]].domNode.click(),
this.allChildCheckboxes[0].setValue(!0))}))}},_canExpandFirstLayerNode:function(){var F=!1,Q=[];Q=Object.keys(this.layerCheckBoxNodes);this.layerCheckBoxNodes&&1===Q.length?F=!0:1<Q.length&&this.layerOrderSequence&&this.layerOrderSequence[0]&&10>=this.layerOrderSequence[0]&&(F=!0);return F},_processSelectedFeatures:function(F,Q){var T={},E,M;this.featuresByLayerId={};this.featureTitlesByLayerId={};g.forEach(F,e.hitch(this,function(J){this.featuresByLayerId[J._layer.id]||(this.featuresByLayerId[J._layer.id]=
[],this.featureTitlesByLayerId[J._layer.id]=[]);this.featuresByLayerId[J._layer.id].push(J);if(this.layerInfosObj.getLayerInfoById(J._layer.id)){var P=this.layerInfosObj.getLayerInfoById(J._layer.id).layerObject.objectIdField;P=J.getTitle()?J.getTitle():J.attributes[P]}else P=J.attributes&&0<Object.keys(J.attributes).length?J.attributes[Object.keys(J.attributes)[0]]:this.nls.copyFeatures.geometryLabel;this.featureTitlesByLayerId[J._layer.id].push(P)}));this.loading.show();for(M in this.featuresByLayerId)M&&
this.layerInfosObj.getLayerInfoById(M)?(F=this._getObjectIdFieldOfLayer(M),F=this._getSelectedFeatureObjectIds(this.featuresByLayerId[M],F),T[M]=this._getFeatureByChunks(M,F)):T[M]=this.featuresByLayerId[M];B(T).then(e.hitch(this,function(J){for(E in J)E&&this.layerInfosObj.getLayerInfoById(E)&&this._updateGeometryForSelectedFeature(E,J);this._highlightFeatures();setTimeout(e.hitch(this,function(){this.loading.hide()}),1E3)}),e.hitch(this,function(){this.loading.hide();k({message:this.nls.copyFeatures.copyFeatureUpdateGeometryError})}));
return Q.resolve(null)},_getObjectIdFieldOfLayer:function(F){return this.layerInfosObj.getLayerInfoById(F).layerObject.objectIdField},_updateGeometryForSelectedFeature:function(F,Q){var T=this._getObjectIdFieldOfLayer(F);g.forEach(this.featuresByLayerId[F],e.hitch(this,function(E){g.some(Q[F],e.hitch(this,function(M){if(M.attributes[T]===E.attributes[T])return E.geometry=M.geometry,!0}))}))},_getSelectedFeatureObjectIds:function(F,Q){var T=[];g.forEach(F,e.hitch(this,function(E){T.push(E.attributes[Q])}));
return T},_getFeatureByChunks:function(F,Q){var T=this.layerInfosObj.getLayerInfoById(F);var E=new q;var M=[];for(T=null===T.layerObject.url||""===T.layerObject.url?Q.length:T.layerObject.maxRecordCount||999;0<Q.length;)M.push(this._getSelectedFeatureGeometry(F,Q.splice(0,T)));B(M).then(e.hitch(this,function(J){var P=[];g.forEach(J,e.hitch(this,function(R){P=P.concat(R.features)}));E.resolve(P)}));return E.promise},_getSelectedFeatureGeometry:function(F,Q){var T=this.layerInfosObj.getLayerInfoById(F);
F=new w(T.getUrl());var E=new A;E.outFields=[T.layerObject.objectIdField];E.objectIds=Q;E.returnGeometry=!0;E.outSpatialReference=this.map.spatialReference;return(null===T.layerObject.url||""===T.layerObject.url?T.layerObject.queryFeatures(E):F.execute(E)).promise},_createFeatureEntries:function(F,Q,T,E){g.forEach(this.featureTitlesByLayerId[F],e.hitch(this,function(M){M=this._createListNode(M,Q,!0,F,T,E);this.checkBoxNodes[F].push(M);this.allChildCheckboxes.push(M)}))},_createListNode:function(F,
Q,T,E,M,J){var P=v.create("div",{"class":"jimu-widget-row esriCTCopyFeaturesNode"});var R=v.create("div",{"class":"jimu-float-leading checkBoxNode",style:"width: calc(100% - 20px)"},P);M="esriGeometryPoint"===M&&this.hideMultipleFeatureButton?!1:!0;R=new f({label:F,checked:M},R);a.set(R.domNode,"layerName",F);T?(b.add(P,"esriCTCopyFeaturesChildNode"),a.set(R.domNode,"parentLayerId",E),d(R.domNode,"click",e.hitch(this,this._childNodeStateChanged)),a.set(J,"expandLayerId",E),v.place(P,J)):(this._updateParentCheckBoxLabel(R,
F,this.featureTitlesByLayerId[E].length,E),T=v.create("div",{"class":"esriCTExpandCollapseNode collapsed",tabindex:"0",role:"button","aria-label":F,"aria-expanded":"false"}),v.place(T,P,"first"),a.set(R.domNode,"layerId",E),a.set(R.domNode,"layerName",F),a.set(T,"layerId",E),M||(this._updateParentCheckBoxLabel(R,F,0,E),R.setStatus(!1)),d(R.domNode,"click",e.hitch(this,this._parentNodeStateChanged)),v.place(P,Q,"first"),this.own(d(T,"click",e.hitch(this,function(Y){this._expandButtonClicked(Y)}))),
this.own(d(T,"keydown",e.hitch(this,function(Y){Y.keyCode!==h.ENTER&&Y.keyCode!==h.SPACE||this._expandButtonClicked(Y)}))));return R},_expandButtonClicked:function(F){var Q=a.get(F.currentTarget,"layerId");if(Q=x("[expandLayerId\x3d"+Q+"]",this.domNode)[0])b.contains(F.currentTarget,"expanded")?(b.replace(F.currentTarget,"collapsed","expanded"),a.set(F.currentTarget,"aria-expanded","false"),b.add(Q,"esriCTHidden")):(b.replace(F.currentTarget,"expanded","collapsed"),a.set(F.currentTarget,"aria-expanded",
"true"),b.remove(Q,"esriCTHidden"))},_parentNodeStateChanged:function(F){F=a.get(F.currentTarget,"layerId");var Q=this.layerCheckBoxNodes[F],T=a.get(Q.domNode,"layerName");if(Q.getStatus()){var E=this.checkBoxNodes[F],M=Q.getValue();g.forEach(E,e.hitch(this,function(J){M?J.setValue(!0):J.setValue(!1)}));M?this._updateParentCheckBoxLabel(Q,T,this.featureTitlesByLayerId[F].length,F):this._updateParentCheckBoxLabel(Q,T,0,F);this._highlightFeatures()}this.updateSingleFeatureButtonText()},_childNodeStateChanged:function(F){var Q=
a.get(F.currentTarget,"parentLayerId"),T=a.get(this.layerCheckBoxNodes[Q].domNode,"layerName"),E=this.layerCheckBoxNodes[Q],M=this.checkBoxNodes[Q],J=!1;E.getStatus()||g.forEach(this.allChildCheckboxes,e.hitch(this,function(P){P.getValue()&&P.domNode!==F.currentTarget&&(P.setValue(!1),P=a.get(P.domNode,"parentLayerId"),this._updateParentCheckBoxLabel(this.layerCheckBoxNodes[P],a.get(this.layerCheckBoxNodes[P].domNode,"layerName"),0,P))}));this._highlightFeatures();g.some(M,e.hitch(this,function(P){if(P.getValue())return J=
!0}));E.setValue(J,!1);this.updateSingleFeatureButtonText();M=this.checkBoxNodes[Q].filter(e.hitch(this,function(P){return!0===P.checked}));this._updateParentCheckBoxLabel(E,T,M.length,Q)},_updateParentCheckBoxLabel:function(F,Q,T,E){F.setLabel(t.substitute(this.nls.copyFeatures.layerLabel,{layerName:Q,selectedFeatures:T,totalFeatures:this.featureTitlesByLayerId[E].length}));a.set(F.domNode,"aria-label",t.substitute(this.nls.copyFeatures.layerAriaLabel,{layerName:Q,selectedFeatures:T,totalFeatures:this.featureTitlesByLayerId[E].length}))},
updateSingleFeatureButtonText:function(){var F=0;g.some(this.allChildCheckboxes,e.hitch(this,function(Q){Q.getValue()&&F++;if(1<F)return!0}));1===F||1===this.allChildCheckboxes.length?(a.set(this.createSingleFeatureBtn,"innerHTML",this.nls.copyFeatures.createOneSingleFeature),a.set(this.createSingleFeatureBtn,"aria-label",this.nls.copyFeatures.createOneSingleFeature),a.set(this.createSingleFeatureBtn,"title",this.nls.copyFeatures.createOneSingleFeature),b.add(this.createMultipleFeaturesBtn,"esriCTCanCreateOnlyOneFeature"),
"esriGeometryPoint"===this.targetLayerDetails.featureLayer.geometryType&&b.remove(this.createSingleFeatureBtn,"esriCTHidden")):(a.set(this.createSingleFeatureBtn,"innerHTML",this.nls.copyFeatures.createSingleFeature),a.set(this.createSingleFeatureBtn,"aria-label",this.nls.copyFeatures.createSingleFeature),a.set(this.createSingleFeatureBtn,"title",this.nls.copyFeatures.createSingleFeature),b.remove(this.createMultipleFeaturesBtn,"esriCTCanCreateOnlyOneFeature"),"esriGeometryPoint"===this.targetLayerDetails.featureLayer.geometryType&&
b.add(this.createSingleFeatureBtn,"esriCTHidden"))},cancelBtnClicked:function(){b.add(this.mainNode,"esriCTHidden");this.highlightGraphicsLayer.clear();this.emit("cancelBtnClicked")},_createMultipleFeaturesBtnClicked:function(){var F=[],Q;(Q=this._getSelectedFeaturesForCopy())&&0<Q.length&&(g.forEach(Q,e.hitch(this,function(T){T&&T.geometry&&F.push(T)})),this.emit("createMultipleFeatures",F))},_createSingleFeatureBtnClicked:function(){var F;(F=this._getSelectedFeaturesForCopy())&&0<F.length&&this.emit("createSingleFeature",
F)},_fieldMatchingBtnClicked:function(){var F=[],Q={id:this.targetLayerDetails.featureLayer.id,fields:this.targetLayerDetails.fieldInfos,fieldValues:this.targetLayerDetails.fieldValues},T=[];g.forEach(this.layerInfosObj.getLayerInfoArray(),e.hitch(this,function(M){this.featuresByLayerId.hasOwnProperty(M.id)&&(T.push(M.id),F.push(this._getSourceLayerInfo(M.id)))}));for(var E in this.featuresByLayerId)this.featuresByLayerId.hasOwnProperty(E)&&-1===T.indexOf(E)&&this.layerInfosObj.getLayerInfoById(E)&&
(T.push(E),F.push(this._getSourceLayerInfo(E)));for(E in this.featuresByLayerId)this.featuresByLayerId.hasOwnProperty(E)&&-1===T.indexOf(E)&&this.map._layers.hasOwnProperty(E)&&F.push(this._createGraphicLayerInfo(E));this.fieldsMappingObj=new L({nls:this.nls,sourceLayerDetails:F,targetLayerDetails:Q,fieldMappingDetails:this.fieldMappingDetails,usePresetValues:this.usePresetValues,overrideDefaultsByCopiedFeature:this.config.editor.overrideDefaultsByCopiedFeature});this.own(d(this.fieldsMappingObj,
"field-mapping-changed",e.hitch(this,function(M){this.fieldMappingDetails=M.fieldMappingDetails;this.config.editor.overrideDefaultsByCopiedFeature=M.overrideDefaultsByCopiedFeature})))},_getConfiguredFieldInfos:function(F,Q){var T=[];g.forEach(Q,function(E){var M=this._getFieldInfoByFieldName(F,E.fieldName);E=e.mixin(e.clone(M),E);T.push(E)},this);return T},_getFieldInfoByFieldName:function(F,Q){var T={};g.some(F,function(E){if(E.name===Q)return e.mixin(T,E),!0});return T},_validateSelectedFeature:function(F){(!F||
0>=F.length)&&k({message:this.nls.copyFeatures.selectFeatureToCopyMessage})},_getSelectedFeaturesForCopy:function(){var F,Q=[];for(F in this.featuresByLayerId){var T=this._getSelectedFeaturesByLayerId(F);0<T.length&&(Q=Q.concat(T))}this._validateSelectedFeature(Q);return Q},_getSelectedFeaturesByLayerId:function(F){var Q=[];g.forEach(this.checkBoxNodes[F],e.hitch(this,function(T,E){T.getValue()&&Q.push(this.featuresByLayerId[F][E])}));return Q},_showHideSingleFeatureButton:function(F){"esriGeometryPoint"===
F?b.add(this.createSingleFeatureBtn,"esriCTHidden"):b.remove(this.createSingleFeatureBtn,"esriCTHidden")},_showHideMultipleFeatureButton:function(F){"esriGeometryPoint"!==F&&this.hideMultipleFeatureButton?b.add(this.createMultipleFeaturesBtn,"esriCTHidden"):b.remove(this.createMultipleFeaturesBtn,"esriCTHidden")},_createNewGraphicsLayer:function(F){var Q={};if(F+=this.widgetId)this.map._layers[F]&&this.map.removeLayer(this.map._layers[F]),Q={id:F};F=new p(Q);this.map.addLayer(F);return F},_highlightFeatures:function(){this.highlightGraphicsLayer.clear();
for(var F in this.featureTitlesByLayerId)this._highlightSingleLayerFeatures(F)},_highlightSingleLayerFeatures:function(F){var Q=this.map.getLayer(F);F=this._getSelectedFeaturesByLayerId(F);g.forEach(F,e.hitch(this,function(T){T=n.getHighLightSymbol(T,Q);this.highlightGraphicsLayer.add(T)}))},_changeWarningNote:function(F){F="esriGeometryPoint"===F&&this.hideMultipleFeatureButton?this.nls.copyFeatures.canNotSaveMultipleFeatureWarning:"esriGeometryPoint"!==F&&this.hideMultipleFeatureButton?this.nls.copyFeatures.createOnlyOneMultipartFeatureWarning:
this.nls.copyFeatures.multipleFeatureSaveWarning;a.set(this.warningMessage,"innerHTML",F);a.set(this.warningMessage,"aria-label",F)},setProgressPercentage:function(F){F=parseFloat(F.toFixed());0>=F?(this.applyEditsProgress.set({value:0}),D.set(this.applyEditsProgress.domNode,"display","block")):100<=F?(this.applyEditsProgress.set({value:100}),D.set(this.applyEditsProgress.domNode,"display","none")):this.applyEditsProgress.set({value:F})},_createFeatureListUI:function(F,Q){var T=this.layerInfosObj.getLayerInfoById(F)||
this.map._layers[F];(T=T.title?T.title:T.name)||(T=this.useLayerIdAsLayerName(F));var E=v.create("div",{},this.layerListTable);var M=v.create("div",{"class":"esriCTHidden"});v.place(M,E,"last");this.layerCheckBoxNodes[F]=this._createListNode(T,E,!1,F,Q);this.checkBoxNodes[F]||(this.checkBoxNodes[F]=[]);0<this.featureTitlesByLayerId[F].length&&(this._createFeatureEntries(F,E,Q,M),this.layerOrderSequence.push(this.featureTitlesByLayerId[F].length))},_getSourceLayerInfo:function(F){var Q=this.layerInfosObj.getLayerInfoById(F);
var T=this.editUtils.getFieldInfosFromWebmap(Q)||Q.layerObject.fields;if(Q&&Q.layerObject&&T)return Q=Q.title?Q.title:Q.name,{id:F,fields:T,name:Q}},_createGraphicLayerInfo:function(F){var Q=this.map._layers[F];var T=Q.graphics&&0<Q.graphics.length&&Q.graphics[0].attributes&&0<Object.keys(Q.graphics[0].attributes).length?this._createGraphicLayerFields(Q.graphics[0]):[];if(Q&&T)return(Q=Q.title?Q.title:Q.name)||(Q=this.useLayerIdAsLayerName(F)),{id:F,fields:T,name:Q}},useLayerIdAsLayerName:function(F){return F.includes("directions_routeLayer_esri_dijit_Directions")?
this.nls.copyFeatures.directionsRouteLabel:F.includes("directions_waypointsEventLayer_esri_dijit_Directions")?this.nls.copyFeatures.directionsWaypointsLabel:F.includes("directions_stopLayer_esri_dijit_Directions")?this.nls.copyFeatures.diretionsStopLabel:F},_createGraphicLayerFields:function(F){var Q=[],T;for(T in F.attributes){var E;F.attributes.hasOwnProperty(T)&&(E=isNaN(F.attributes[T])?{name:T,type:"esriFieldTypeString",alias:T,length:256,editable:!0,nullable:!0,defaultValue:null,description:null,
isViewOverride:!1,fieldName:T,label:T,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"}:{name:T,type:"esriFieldTypeDouble",alias:T,editable:!0,nullable:!0,defaultValue:null,description:null,isViewOverride:!1,fieldName:T,label:T,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",format:{places:2,digitSeparator:!0}});Q.push(E)}return Q}})})},"widgets/SmartEditor/highlightSymbolUtils":function(){define("dojo/_base/lang dojo/_base/array esri/geometry/Point esri/geometry/Polygon esri/geometry/Polyline esri/graphic esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color".split(" "),
function(O,C,I,G,e,g,v,d,x,t){var h={getHighLightSymbol:function(f,b){switch(f&&f.geometry&&f.geometry.type){case "point":return h._getPointSymbol(f,b);case "polyline":return h._getPolyLineSymbol(f,b);case "polygon":return h._getPolygonSymbol(f,b)}},_getSizeInfo:function(f){var b=null;f.renderer.visualVariables&&C.forEach(f.renderer.visualVariables,O.hitch(this,function(a){"sizeInfo"===a.type&&(b=a)}));return b},_getPointSymbol:function(f,b){var a,n;var p=!1;var m=new v(v.STYLE_SQUARE,null,new d(d.STYLE_SOLID,
new t([0,255,255,1]),3));m.setColor(null);m.size=30;if(b&&b.renderer)if(b.renderer.symbol)p=!0,m=h._updatePointSymbolProperties(m,b.renderer.symbol);else if(b.renderer.infos&&0<b.renderer.infos.length){for(n=0;n<b.renderer.infos.length;n++){b.typeIdField?a=f.attributes[b.typeIdField]:b.renderer.attributeField&&(a=f.attributes[b.renderer.attributeField]);var k=b.renderer.infos[n].value;void 0!==a&&null!==a&&""!==a&&void 0!==k&&null!==k&&""!==k&&a.toString()===k.toString()&&(p=!0,m=h._updatePointSymbolProperties(m,
b.renderer.infos[n].symbol))}!p&&b.renderer.defaultSymbol&&(p=!0,m=h._updatePointSymbolProperties(m,b.renderer.defaultSymbol))}b&&b.graphics&&0<b.graphics.length&&b._getSymbol(f)&&((a=f.getShape())&&a.shape?a.shape.hasOwnProperty("r")?(p=!0,m.size=2*a.shape.r+10):a.shape.hasOwnProperty("width")&&(p=!0,b.renderer&&b.renderer.infos&&0<b.renderer.infos.length&&(m=h._updatePointSymbolProperties(m,b.renderer.infos[0].symbol)),m.size=a.shape.width+10):b.renderer&&b.renderer.visualVariables&&(p=b._getRenderer(f),
a=h._getSizeInfo(b))&&(b=p.getSize(f,{sizeInfo:a,shape:b._getSymbol(f),resolution:b&&b.getResolutionInMeters&&b.getResolutionInMeters()}),null!==b&&(m.size=b+10)));b=new I(f.geometry.x,f.geometry.y,f.geometry.spatialReference);return new g(b,m,f.attributes)},_updatePointSymbolProperties:function(f,b){if(b.hasOwnProperty("height")&&b.hasOwnProperty("width")){var a=b.height;var n=b.width;a=(a>n?a:n)+10;f.size=a}b.hasOwnProperty("size")&&(!a||a<b.size)&&(f.size=b.size+10);b.hasOwnProperty("xoffset")&&
(f.xoffset=b.xoffset);b.hasOwnProperty("yoffset")&&(f.yoffset=b.yoffset);return f},_getPolyLineSymbol:function(f,b){var a,n;var p=5;if(b&&b.renderer)if(b.renderer.symbol&&b.renderer.symbol.hasOwnProperty("width"))p=b.renderer.symbol.width;else if(b.renderer.infos&&0<b.renderer.infos.length)for(n=0;n<b.renderer.infos.length;n++){b.typeIdField?a=f.attributes[b.typeIdField]:b.renderer.attributeField&&(a=f.attributes[b.renderer.attributeField]);var m=b.renderer.infos[n].value;void 0!==a&&null!==a&&""!==
a&&void 0!==m&&null!==m&&""!==m&&a.toString()===m.toString()&&b.renderer.infos[n].symbol.hasOwnProperty("width")&&(p=b.renderer.infos[n].symbol.width)}else b.renderer.defaultSymbol&&b.renderer.defaultSymbol.hasOwnProperty("width")&&(p=b.renderer.defaultSymbol.width);b=new d(d.STYLE_SOLID,new t([0,255,255,1]),p);var k=new e(f.geometry.spatialReference);f.geometry.paths&&0<f.geometry.paths.length&&C.forEach(f.geometry.paths,function(A){k.addPath(A)});return new g(k,b,f.attributes)},_getPolygonSymbol:function(f){var b=
new x(x.STYLE_SOLID,new d(d.STYLE_SOLID,new t([0,255,255,1]),4),new t([0,0,0,0]));var a=new G(f.geometry.spatialReference);f.geometry.rings&&(a.rings=O.clone(f.geometry.rings));return new g(a,b,f.attributes)}};return h})},"widgets/SmartEditor/fieldsMapping":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/text!./fieldsMapping.html ./fieldMap dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/Popup dojo/dom-construct dojo/_base/array dojo/on jimu/dijit/CheckBox".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f){return O([v,C,g],{baseClass:"jimu-widget-smartEditor-fieldsMapping",templateString:G,fieldsPopup:null,nodes:[],fieldMapBySourceLayer:{},postCreate:function(){this.nodes=[];this.own(h(window,"resize",I.hitch(this,function(){this._setFieldPopupDimensions()})));this.fieldMapBySourceLayer={};this.valuesOverrideCheckbox=new f({label:this.nls.fieldsMapping.fieldsMatchingCheckboxLabel,class:"esriCTFieldCheckbox","aria-label":this.nls.fieldsMapping.fieldsMatchingCheckboxLabel},
this.fieldsMatchingCheckboxNode);this.overrideDefaultsByCopiedFeature&&this.valuesOverrideCheckbox.setValue(this.overrideDefaultsByCopiedFeature);this._addFieldMapping();this._createPopUp()},_createPopUp:function(){this.fieldsPopup=new d({titleLabel:this.nls.fieldsMapping.popupTittle,width:600,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.apply,id:"okButton",onClick:I.hitch(this,function(){for(var b in this.fieldMapBySourceLayer){var a=this.fieldMapBySourceLayer[b].getMatchedFields();
this.fieldMappingDetails.hasOwnProperty(this.targetLayerDetails.id)||(this.fieldMappingDetails[this.targetLayerDetails.id]={});this.fieldMappingDetails[this.targetLayerDetails.id][b]=a}this.emit("field-mapping-changed",{fieldMappingDetails:this.fieldMappingDetails,overrideDefaultsByCopiedFeature:this.valuesOverrideCheckbox.getValue()});this.fieldsPopup.close()})},{label:this.nls.cancel,id:"cancelButton",onClick:I.hitch(this,function(){this.emit("cancelButtonClicked");this.fieldsPopup.close()})}]});
this._setFieldPopupDimensions()},_addFieldMapping:function(){t.forEach(this.sourceLayerDetails,I.hitch(this,function(b){this.fieldMapBySourceLayer[b.id]=new e({nls:this.nls,sourceLayerDetails:b,targetLayerDetails:this.targetLayerDetails,openOnLoad:1===this.sourceLayerDetails.length?!0:!1,fieldMappingDetails:this.fieldMappingDetails,usePresetValues:this.usePresetValues},x.create("div",{"class":"esriCTBottomSpacing"},this.fieldsMappingContainer))}))},_setFieldPopupDimensions:function(){this.fieldsPopup&&
(window.appInfo.isRunInMobile?this.fieldsPopup.set("width",window.innerWidth-100):this.fieldsPopup.set("width",600))}})})},"widgets/SmartEditor/fieldMap":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/text!./fieldMap.html dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting dojo/dom-construct dojo/_base/array dojo/string dojo/on dojo/dom-class dojo/dom-style dojo/dom-attr dijit/form/TextBox dojo/keys dijit/form/Select".split(" "),function(O,C,I,G,e,g,v,d,x,t,h,f,b,a,n,p){return O([g,
C,e],{baseClass:"jimu-widget-smartEditor-fieldsMapping",ValidFieldsByType:{esriFieldTypeOID:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeSmallInteger:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeInteger:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeDouble:["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeSingle:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeGUID:["esriFieldTypeGUID","esriFieldTypeGlobalID"],esriFieldTypeDate:["esriFieldTypeDate"],esriFieldTypeString:"esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeGUID esriFieldTypeDate esriFieldTypeOID esriFieldTypeGlobalID".split(" ")},
templateString:G,sourceLayerDetails:[],targetLayerDetails:{},mappedTargetFields:{},postCreate:function(){this.mappedTargetFields={};this._createFieldMap(this.sourceLayerDetails,this.targetLayerDetails);this.openOnLoad&&this.expandIconNode.click();this._setLabelWidth(window.appInfo.isRunInMobile?500:"");this.own(t(window,"resize",I.hitch(this,function(){this._setLabelWidth(500)})))},_setLabelWidth:function(m){setTimeout(I.hitch(this,function(){for(var k in this.mappedTargetFields)if(this.mappedTargetFields[k]&&
this.mappedTargetFields[k].domNode&&this.mappedTargetFields[k].containerNode){var A=this.mappedTargetFields[k].containerNode.children[0];A&&f.set(A,"width",this.mappedTargetFields[k].domNode.parentElement.clientWidth-50+"px")}}),m?m:1)},_expandCollapse:function(){h.contains(this.fieldsNode,"esriCTHidden")?(h.replace(this.expandIconNode,"esriCTArrowDown","esriCTArrowUp"),h.remove(this.fieldsNode,"esriCTHidden"),h.remove(this.iconParentNode,"esriCTHidden"),h.add(this.layerNameNode,"esriCTLayerNameWidthReduced"),
b.set(this.expandIconNode,"aria-expanded","true"),this._setLabelWidth()):(h.replace(this.expandIconNode,"esriCTArrowUp","esriCTArrowDown"),h.add(this.fieldsNode,"esriCTHidden"),h.add(this.iconParentNode,"esriCTHidden"),h.remove(this.layerNameNode,"esriCTLayerNameWidthReduced"),b.set(this.expandIconNode,"aria-expanded","false"))},_resetSourceFields:function(){if(this.mappedTargetFields)for(var m in this.mappedTargetFields){var k=this.mappedTargetFields[m];if(!k.get("disabled")){for(var A=!1,w=0;w<
k.options.length;w++)if(k.options[w].isDefault){k.set("value",k.options[w].value);A=!0;break}A||k.set("value","esriCTSelectSourceLayerField")}}this._setLabelWidth()},_clearSourceFields:function(){if(this.mappedTargetFields)for(var m in this.mappedTargetFields)this.mappedTargetFields[m].get("disabled")||this.mappedTargetFields[m].set("value","esriCTSelectSourceLayerField");this._setLabelWidth()},_createFieldMap:function(m,k){this.expandIconNode=v.create("div",{"class":"esriCTArrow esriCTArrowUp",role:"button",
tabindex:"0",title:m.name,"aria-label":m.name,"aria-expanded":"false"},this.headerNode);this.layerNameNode=v.create("div",{"class":"esriCTLayerName",dir:"ltr",innerHTML:m.name},this.headerNode);this.iconParentNode=v.create("div",{"class":"esriCTIconParentNode esriCTHidden"},this.headerNode);this.resetButtonNode=v.create("div",{"class":"esriCTResetButton",role:"button",tabindex:"0",title:this.nls.fieldsMapping.resetLabel,"aria-label":this.nls.fieldsMapping.resetLabel},this.iconParentNode);this.clearButtonNode=
v.create("div",{"class":"esriCTClearButton",role:"button",tabindex:"0",title:this.nls.fieldsMapping.clearLabel,"aria-label":this.nls.fieldsMapping.clearLabel},this.iconParentNode);this.own(t(this.layerNameNode,"click",I.hitch(this,this._expandCollapse)));this.own(t(this.expandIconNode,"click",I.hitch(this,this._expandCollapse)));this.own(t(this.expandIconNode,"keydown",I.hitch(this,function(w){w.keyCode!==n.ENTER&&w.keyCode!==n.SPACE||this._expandCollapse()})));this.own(t(this.clearButtonNode,"click",
I.hitch(this,this._clearSourceFields)));this.own(t(this.clearButtonNode,"keydown",I.hitch(this,function(w){w.keyCode!==n.ENTER&&w.keyCode!==n.SPACE||this._clearSourceFields()})));this.own(t(this.resetButtonNode,"click",I.hitch(this,this._resetSourceFields)));this.own(t(this.resetButtonNode,"keydown",I.hitch(this,function(w){w.keyCode!==n.ENTER&&w.keyCode!==n.SPACE||this._resetSourceFields()})));var A=!1;d.forEach(k.fields,I.hitch(this,function(w){var q=w.hasOwnProperty("isEditable")?w.isEditable:
w.editable;"esriFieldTypeGeometry"!==w.type&&"esriFieldTypeBlob"!==w.type&&"esriFieldTypeRaster"!==w.type&&"esriFieldTypeXML"!==w.type&&"esriFieldTypeOID"!==w.type&&"esriFieldTypeGlobalID"!==w.type&&q&&(A=!0,m.fields&&0===m.fields.length&&(A=!1),this._createFieldList(m,w))}));A?h.add(this.noFieldsMatching,"esriCTHidden"):(h.add(this.fieldMappingTableWrapper,"esriCTHidden"),f.set(this.iconParentNode,"display","none"));this._showMatchedFieldsInfo()},_createFieldList:function(m,k){var A=!1;var w=v.create("tr",
{"class":"esriCTFieldsMatchingTableRow"},this.fieldsTbodyNode);var q=v.create("td",{"class":"esriCTFieldsMatchingTableCell esriCTTargetTD","data-th":this.nls.fieldsMapping.fieldsInTargetLayerLabel},w);var B=this._getFieldLabel(k);q=new a({value:B,title:B,disabled:!0},v.create("div",{},q));q.textbox&&h.add(q.textbox,"textLabelEllipsis");w=v.create("td",{"class":"esriCTFieldsMatchingTableCell esriCTSourceTD","data-th":this.nls.fieldsMapping.fieldsInSourceLayerLabel},w);this.targetLayerDetails.fieldValues&&
this.targetLayerDetails.fieldValues[k.name]&&(q=this.targetLayerDetails.fieldValues[k.name])&&0<q.length&&d.some(q,I.hitch(this,function(l){if("Preset"!==l.actionName&&l.enabled||"Preset"===l.actionName&&l.enabled&&this.usePresetValues)return A=!0}));A?(this.mappedTargetFields[k.name]=new a({value:this.nls.fieldsMapping.dynamicValueText,title:this.nls.fieldsMapping.dynamicValueText,disabled:!0},v.create("div",{},w)),this.mappedTargetFields[k.name]&&this.mappedTargetFields[k.name].textbox&&h.add(this.mappedTargetFields[k.name].textbox,
"textLabelEllipsis")):(this.mappedTargetFields[k.name]=new p({options:this._addSourceLayerFieldOptions(k,m),"class":"esriCTFieldsMatchingDropdown"},v.create("div",{},w)),this.own(t(this.mappedTargetFields[k.name],"change",I.hitch(this,this._showMatchedFieldsInfo))),b.set(this.mappedTargetFields[k.name],"aria-label",x.substitute(this.nls.fieldsMapping.selectFieldAriaLabel,{targetField:k.name})),this.fieldMappingDetails&&this.fieldMappingDetails.hasOwnProperty(this.targetLayerDetails.id)&&this.fieldMappingDetails[this.targetLayerDetails.id].hasOwnProperty(m.id)&&
this.fieldMappingDetails[this.targetLayerDetails.id][m.id].hasOwnProperty(k.name)&&(m=this.fieldMappingDetails[this.targetLayerDetails.id][m.id][k.name],""===m&&(m="esriCTSelectSourceLayerField"),this.mappedTargetFields[k.name].set("value",m)),this.own(t(this.mappedTargetFields[k.name].dropDown,"close",I.hitch(this,function(){this._setLabelWidth()}))))},_getFieldLabel:function(m){var k="";m&&m.name&&(k=m.label&&m.label!==m.name?m.label+" ["+m.name+"]":m.name);return k},_addSourceLayerFieldOptions:function(m,
k){var A=[],w=[];if(!k||!k.fields)return A;A.push({label:this.nls.fieldsMapping.selectSourceFieldLabel,value:"esriCTSelectSourceLayerField"});(w=this.ValidFieldsByType[m.type])||console.log(m.type);var q=!1;d.forEach(k.fields,I.hitch(this,function(B){var l=!0;B.hasOwnProperty("visible")&&(l=B.visible);if("esriFieldTypeGeometry"!==B.type&&"esriFieldTypeBlob"!==B.type&&"esriFieldTypeRaster"!==B.type&&"esriFieldTypeXML"!==B.type&&w&&-1<w.indexOf(B.type)&&l){l=m.name.toLowerCase().split(/\s/).join("");
var u=m.alias?m.alias.toLowerCase().split(/\s/).join(""):"";var D=B.name.toLowerCase().split(/\s/).join("");var z=B.alias?B.alias.toLowerCase().split(/\s/).join(""):"";var L=m.label?m.label.toLowerCase().split(/\s/).join(""):"";var F=B.label?B.label.toLowerCase().split(/\s/).join(""):"";!q&&l===D||u&&z&&u===z||u&&u===D||z&&l===z||L&&L===F?(q=!0,A.push({label:this._getFieldLabel(B),value:B.name,selected:!0,isDefault:!0})):A.push({label:this._getFieldLabel(B),value:B.name,selected:!1,isDefault:!1})}}));
return A},getMatchedFields:function(){var m={},k;for(k in this.mappedTargetFields){var A=this.mappedTargetFields[k].get("value");if("esriCTSelectSourceLayerField"===A||this.mappedTargetFields[k].get("disabled"))A="";m[k]=A}return m},_showMatchedFieldsInfo:function(){var m=0,k=0,A;for(A in this.mappedTargetFields)"esriCTSelectSourceLayerField"!==this.mappedTargetFields[A].get("value")&&k++,m++;m=x.substitute(this.nls.fieldsMapping.targetFieldsMatchedLabel,{layerName:this.sourceLayerDetails.name,matchedFields:k,
totalFields:m});b.set(this.layerNameNode,"aria-label",m);b.set(this.layerNameNode,"innerHTML",m);b.set(this.layerNameNode,"title",m);b.set(this.expandIconNode,"aria-label",m);b.set(this.expandIconNode,"title",m)}})})},"widgets/SmartEditor/ValuePicker":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/text!./ValuePicker.html dijit/_TemplatedMixin jimu/BaseWidgetSetting jimu/dijit/Popup jimu/dijit/formSelect jimu/utils".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f){return O([x,C,d],{baseClass:"jimu-widget-smartEditor-multiple-value-picker",templateString:v,allFields:{},isOpen:!0,postCreate:function(){this.inherited(arguments);this.allFields={};this._initControls();this.showDialog()},_isFieldDisabled:function(b){return this.disabledFields&&0!==this.disabledFields.length&&this.disabledFields&&-1<this.disabledFields.indexOf(b)?!0:!1},_initControls:function(){if(this.showForField)this.addField(this.showForField);else if(this.multipleValues)for(var b in this.multipleValues)this._isFieldDisabled(b)||
this.addField(b)},addField:function(b){var a=this.multipleValues[b],n=e.create("div",{class:"esriCTFieldContainer"},this.fieldsContainer);e.create("div",{innerHTML:this.fieldLabels[b],class:"esriCTFieldName"},n);a=this._getFieldsOptionsObj(b,a);this.allFields[b]=new h({style:{width:"270px"},options:a,"aria-label":this.fieldLabels[b]},e.create("div",{},n))},showDialog:function(){this.isOpen=!0;this.fieldsPopup=new t({titleLabel:this.nls.valuePicker.popupTitle,width:310,maxHeight:500,autoHeight:!0,
content:this,class:this.baseClass,buttons:[{label:this.nls.ok,onClick:I.hitch(this,function(){var b={};if(this.showForField)b[this.showForField]=this.allFields[this.showForField].get("value");else for(var a in this.allFields)b[a]=this.allFields[a].get("value");this.emit("value-selected",b);this.fieldsPopup.close()})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:I.hitch(this,function(){this.isOpen=!1;this.fieldsPopup.close()})}],onClose:I.hitch(this,function(){this.isOpen=!1})})},
hideDialog:function(){this.fieldsPopup&&this.isOpen&&(this.isOpen=!1,this.fieldsPopup.close())},_getFieldsOptionsObj:function(b,a){var n=this._getPopupFieldInfo(b);b=f._getValues(this.layerInfo.layerInfo.layerObject,n,b,a);return b=G.map(b,function(p){return{value:p.value,label:p.label+""}})},_getPopupFieldInfo:function(b){var a;if(a=this.layerInfo.layerInfo.getPopupInfo())a=a.fieldInfos,G.some(a,function(p){if(p.fieldName===b)return n=p,!0});else var n=f.getPopupFieldFromLayerField(this.layerInfo.layerInfo.layerObject.getField(b));
return n},setValue:function(b,a){a&&(1<a.length?this.allFields[b].set("value",this.getSelectedValueForDateField(b,a)):this.allFields[b].set("value",a.getValue()))},getSelectedValueForDateField:function(b,a){var n="";var p=this._getPopupFieldInfo(b);var m=f._getValues(this.layerInfo.layerInfo.layerObject,p,b,[a[0].value?a[0].value.getTime():""]);G.some(this.allFields[b].options,I.hitch(this,function(k){if(k.value===m[0].value)return n=k.value,!0}));return n}})})},"widgets/SmartEditor/requiredFields":function(){define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/text!./requiredFields.html dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/Popup dojo/dom-construct dojo/_base/array dojo/string dojo/dom-style dojo/on dojo/dom-class dojo/dom-attr".split(" "),
function(O,C,I,G,e,g,v,d,x,t,h,f,b,a){return O([g,C,e],{baseClass:"jimu-widget-smartEditor-requiredFields",templateString:G,fieldsPopup:null,nodes:[],postCreate:function(){this.nodes=[];this._createPopupContent();this._createPopUp()},_createPopupContent:function(){x.forEach(this.requiredFieldsInfos,I.hitch(this,function(n){var p=n.alias?n.alias:n.name,m=d.create("div",{class:"esriCTFieldContainer esriCTMarginLeft15"},this.fieldsDijitContainer),k=t.substitute(this.nls.requiredFields.foundNullRecordCount,
{fieldName:p,count:this.AttributesCount[n.name]});d.create("div",{innerHTML:k,class:"esriCTFieldName"},m);var A=this.presetUtils.createPresetFieldContentNode(n);this.nodes.push(A);0<A.length&&x.forEach(A,I.hitch(this,function(w){h.set(w,"width","100%");a.set(w,"aria-label",p);w.placeAt(d.create("div",{style:"width:90%"},m));w.startup()}));A[0].hasOwnProperty("fieldType")&&-1!==["richtext","textarea"].indexOf(A[0].fieldType)&&f(A[0],"change",I.hitch(this,function(w){""===w||null===w||void 0===w?(b.add(A[0].domNode,
"ee-error"),A[0].focusNode.focus()):b.remove(A[0].domNode,"ee-error")}))}))},_createPopUp:function(){this.fieldsPopup=new v({titleLabel:this.nls.requiredFields.popupTittle,width:400,maxHeight:300,autoHeight:!0,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,id:"okButton",onClick:I.hitch(this,function(){this._validateFieldsDijits()&&(this._getRequiredFieldsEnteredvalues(),this.fieldsPopup.close())})},{label:this.nls.cancel,id:"cancelButton",classNames:["jimu-btn-vacation"],onClick:I.hitch(this,
function(){this.emit("cancelButtonClicked");this.fieldsPopup.close()})}]})},_getRequiredFieldsEnteredvalues:function(){var n={};x.forEach(this.nodes,I.hitch(this,function(p){var m=p[0].name;if(p[0].hasOwnProperty("fieldType")&&"date"===p[0].fieldType)if(1===p.length)n[m]=(new Date(p[0].getValue())).getTime();else{var k=p[0].getValue().toDateString();p=p[1].getValue().toTimeString();n[m]=(new Date(k+" "+p)).getTime()}else p[0].hasOwnProperty("fieldType")&&-1!==["richtext","textarea"].indexOf(p[0].fieldType)?
(k=this.presetUtils.getFieldInfoByFieldName(this.requiredFieldsInfos,p[0].name).length,p=p[0].getValue(),p.length>k&&(p=p.slice(0,k)),n[m]=p):n[m]=p[0].getValue()}));this.emit("providedValuesToRequiredFields",n)},_validateFieldsDijits:function(){var n=!0;x.some(this.nodes,I.hitch(this,function(p){if(p[0].hasOwnProperty("fieldType")&&-1!==["richtext","textarea"].indexOf(p[0].fieldType)){if(""===p[0].getValue()||null===p[0].getValue()||void 0===p[0].getValue())return b.add(p[0].domNode,"ee-error"),
n=!1,p[0].focusNode.focus(),!0}else{if(!p[0].isValid())return n=!1,p[0].focus(),!0;if(1<p.length&&!p[1].isValid())return n=!1,p[1].focus(),!0}}));return n}})})},"widgets/SmartEditor/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SmartEditor/RelativeDates.html":'\x3cdiv\x3e\r\n    \x3cdiv\x3e\r\n        \x3cdiv class\x3d"esriCTLabel"\x3e${nls.relativeDates.dateTypeLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTRadioButtonContainer"\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"fixedRadioButton" checked\r\n                    data-dojo-attach-point\x3d"fixedRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.fixed}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"fixedRadioButton"\x3e\r\n                    ${nls.relativeDates.fixed}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"currentRadioButton"  data-dojo-attach-point\x3d"currentRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.current}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"currentRadioButton"\x3e\r\n                    ${nls.relativeDates.current}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"PastRadioButton"  data-dojo-attach-point\x3d"PastRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.past}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"PastRadioButton"\x3e\r\n                    ${nls.relativeDates.past}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTDateTypeLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g1\'" type\x3d"radio" name\x3d"jimuradiobtn" id\x3d"futureRadioButton"  data-dojo-attach-point\x3d"futureRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.dateTypeLabel}${nls.relativeDates.future}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"futureRadioButton"\x3e\r\n                    ${nls.relativeDates.future}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTRelativeDatesHint" data-dojo-attach-point\x3d"hintForDateType"\x3e${nls.relativeDates.hintForFixedDateType}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTLabel" style\x3d"margin-top:10px;" data-dojo-attach-point\x3d"valueLabel"\x3e${nls.relativeDates.valueLabel}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTFixedDateContent" data-dojo-attach-point\x3d"fixedDateContent"\x3e\r\n        \x3cdiv class\x3d"esriCTFixedContentWrappper"\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTselectValueLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g2\'" type\x3d"radio" name\x3d"jimuradiobtn2" id\x3d"customRadioButton" checked\r\n                data-dojo-attach-point\x3d"customRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.customLabel}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"customRadioButton"\x3e\r\n                    ${nls.relativeDates.customLabel}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRadioBtn esriCTselectValueLabel"\x3e\r\n                \x3cinput data-dojo-type\x3d"jimu/dijit/RadioBtn" data-dojo-props\x3d"group: \'g2\'" type\x3d"radio" name\x3d"jimuradiobtn2" id\x3d"selectValueRadioButton"\r\n                data-dojo-attach-point\x3d"selectValueRadioButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.relativeDates.popupTitle}"\x3e\r\n                \x3clabel class\x3d"esriCTRadioLabel" for\x3d"selectValueRadioButton"\x3e\r\n                    ${nls.relativeDates.popupTitle}\r\n                \x3c/label\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"customOptionContentNode"\x3e\r\n        \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n            \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.date}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                \x3cdiv style\x3d"width:95%" data-dojo-type\x3d"dijit/form/DateTextBox" required\x3d"false" data-dojo-attach-point\x3d"dateTextBox" tabindex\x3d"0" aria-label\x3d"${nls.date}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n            \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.time}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                \x3cdiv style\x3d"width: 95%" data-dojo-type\x3d"dijit/form/TimeTextBox" required\x3d"false" data-dojo-attach-point\x3d"timeTextBox" tabindex\x3d"0" aria-label\x3d"${nls.time}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTHidden"  data-dojo-attach-point\x3d"selectValueOptionContentNode"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"layerSelectorWrapper" class\x3d"esriCTWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.relativeDates.layerLabel}\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                    \x3cdiv class\x3d"esriCTLayerSelect" style\x3d"width: 95%" data-dojo-attach-point\x3d"layerSelectorDiv"\r\n                    aria-label\x3d"${nls.relativeDates.layerLabel}"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.presetFieldAlias}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                    \x3cdiv class\x3d"esriCTlayerField" style\x3d"width: 95%" data-dojo-attach-point\x3d"fieldsDropdownDiv"\r\n                    aria-label\x3d"${nls.presetFieldAlias}"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPopUpLabel"\x3e${nls.relativeDates.valueLabel}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTFixedContentDijit"\x3e\r\n                    \x3cdiv class\x3d"esriCTlayerFieldvalue" style\x3d"width: 95%" data-dojo-attach-point\x3d"valueProviderContainer"\r\n                    aria-label\x3d"${nls.relativeDates.valueLabel}"\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"esriCTDomainFieldHint esriCTHidden" data-dojo-attach-point\x3d"domainFieldHint"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTRelativeDatesHint"\x3e${nls.relativeDates.valueProviderHint}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden" style\x3d"width:100%" data-dojo-attach-point\x3d"currentDateContent"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden esriCTPastOrFutureDateContent" data-dojo-attach-point\x3d"pastOrFutureDateContent"\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel"\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.years}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"yearsTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.years}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.months}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"monthsTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.months}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.days}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"daysTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.days}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel" style\x3d"margin-top: 5px;"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTMarginForLabel"\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.hours}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"hoursTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.hours}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.minutes}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"minutesTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.minutes}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTFloatLeft"\x3e\r\n                \x3cdiv class\x3d"esriCTValueLabel"\x3e${nls.seconds}\x3c/div\x3e\r\n                \x3cdiv style\x3d"width:112px" data-dojo-type\x3d"dijit/form/NumberSpinner" required\x3d"true" value\x3d"0"\r\n                    data-dojo-props\x3d"constraints:{min:0,places:0},intermediateChanges:true" data-dojo-attach-point\x3d"secondsTextBox" tabindex\x3d"0"\r\n                    aria-label\x3d"${nls.seconds}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden esriCTDatesWarningContainer" data-dojo-attach-point\x3d"relativeDateWarningContainer"\x3e${nls.relativeDates.relativeDateWarning}\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"contentNode" class\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem" tabindex\x3d"-1" aria-selected\x3d"false"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation" style\x3d"display: none;"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"contentNode"\r\n\t\t\tclass\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem"\r\n\t\t\t\t   tabindex\x3d"-1" aria-selected\x3d"false" id\x3d"${id}_label"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\r\n\t\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation"\r\n\t\t style\x3d"display: none;" aria-labelledby\x3d"${id}_label"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/Tree.html":'\x3cdiv role\x3d"tree"\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitTreeIndent" style\x3d"position: absolute; top: -9999px" data-dojo-attach-point\x3d"indentDetector"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTreeExpando dijitTreeExpandoLoading" data-dojo-attach-point\x3d"rootLoadingIndicator"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeContainer" role\x3d"presentation"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/LayerChooserFromMapWithDropbox.html":'\x3cdiv\x3e\r\n\x3ctable role\x3d"listbox" aria-haspopup\x3d"true" data-dojo-attach-point\x3d"dropDownBtn" data-dojo-attach-event\x3d"onclick: _onDropDownClick,onkeydown: _onDropDownKeydown"\r\n  tabindex\x3d"0" title\x3d"${nls.customSelectLayer}" aria-label\x3d"${nls.customSelectLayer}"\x3e\r\n    \x3ccaption class\x3d"screen-readers-only-no-position"\x3e${nls.customSelectLayer}\x3c/caption\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"30px"\x3e\x3c/col\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" data-dojo-attach-point\x3d"layerNameNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"drop-select jimu-float-trailing" data-dojo-attach-point\x3d"dropArrowNode"\x3e\r\n            \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SmartEditor/AttachmentUploader.html":"\x3cdiv class\x3d\"attachmentUploader\" dojoattachpoint\x3d\"attachmentUploader\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${nls.NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n\r\n        \x3cdiv dojoattachpoint\x3d'_attachmentList' style\x3d'white-space:nowrap'\x3e\x3c/div\x3e\r\n\r\n\r\n\r\n    \x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/SmartEditor/XYCoordinates.html":'\x3cdiv class\x3d"esriCTPopupContainer" data-dojo-attach-point\x3d"coordinatesPopup"\x3e\r\n    \x3cdiv class\x3d"esriCTFieldDropdownContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTSelectTitle" title\x3d"${nls.coordinatesSelectTitle}"\x3e${nls.coordinatesSelectTitle}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTFieldInput" style\x3d"width: 100%;"\x3e\r\n            \x3cselect aria-label\x3d"${nls.coordinatesSelectTitle}" style\x3d"width: 99.3%;" data-dojo-attach-point\x3d"coordinatesDropDown" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n                \x3coption value\x3d"Map Spatial Reference"\x3e${nls.mapSpecialReferenceDropdownOption}\x3c/option\x3e\r\n                \x3coption value\x3d"Latitude/Longitude"\x3e${nls.latLongDropdownOption}\x3c/option\x3e\r\n                \x3coption value\x3d"MGRS"\x3e${nls.mgrsDropdownOption}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"xyOptions"\x3e\r\n    \x3cdiv class\x3d"esriCTControlWidth"\x3e\r\n        \x3cdiv class\x3d"esriCTSelectTitle" data-dojo-attach-point\x3d"xAttributeTextBoxLabel"\x3e${nls.xAttributeTextBoxLabel}\x3c/div\x3e\r\n        \x3cdiv\x3e\r\n            \x3cdiv aria-label\x3d"${nls.xAttributeTextBoxLabel}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"xAttributeTextBox"  constraints\x3d"{places:\'0,10\', round:-1}" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                data-dojo-props\x3d"intermediateChanges:true" trim\x3d"true"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"padding-bottom: 5px;"\x3e\r\n        \x3cdiv for\x3d"yAttributeTextBox" class\x3d"esriCTSelectTitle" data-dojo-attach-point\x3d"yAttributeTextBoxLabel"\x3e${nls.yAttributeTextBoxLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTControlWidth"\x3e\r\n            \x3cdiv aria-label\x3d"${nls.yAttributeTextBoxLabel}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"yAttributeTextBox" constraints\x3d"{places:\'0,10\', round:-1}" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                data-dojo-props\x3d"intermediateChanges:true" trim\x3d"true"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"mgrsOptions" class\x3d"esriCTHidden"\x3e\r\n        \x3cdiv class\x3d"esriCTControlWidth"\x3e\r\n            \x3cdiv class\x3d"esriCTSelectTitle"\x3e${nls.mgrsTextBoxLabel}\x3c/div\x3e\r\n            \x3cdiv\x3e\r\n                \x3cdiv aria-label\x3d"${nls.mgrsTextBoxLabel}" class\x3d"esriCTControlWidth" data-dojo-attach-point\x3d"mgrsTextBox"\r\n                    data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"intermediateChanges:false" trim\x3d"true"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/FeatureSetChooserForMultipleLayers.html":'\x3cdiv class\x3d"jimu-not-selectable"\x3e\r\n  \x3cdiv class\x3d"draw-item-btn" tabindex\x3d"0"\x3e\r\n    \x3cdiv class\x3d"current-draw-item" data-dojo-attach-point\x3d"currentDrawItem"\x3e\r\n      \x3cdiv class\x3d"btn-select" data-dojo-attach-point\x3d"btnSelect"\x3e\r\n        \x3cdiv class\x3d"labels"\x3e\r\n            \x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"geoTypeIcon"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"select-text"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"arrow feature-action icon-drop-down" data-dojo-attach-event\x3d"click:_onArrowClicked"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"btn-clear" data-dojo-attach-point\x3d"btnClear" tabindex\x3d"0"\x3e\r\n    \x3cdiv class\x3d"feature-action icon-clear-selection"\x3e\x3c/div\x3e\x3cdiv class\x3d"clear-text"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/copy-features.html":'\x3cdiv class\x3d"esriCTSelectFeaturesContainer"\x3e\r\n  \x3cdiv style\x3d"height: 100%; width: 100%;"\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListTitle"\x3e${nls.copyFeatures.title}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesHint" data-dojo-attach-point\x3d"warningMessage" tabindex\x3d"0" role\x3d"presentation"\r\n      aria-label\x3d"${nls.copyFeatures.multipleFeatureSaveWarning}"\x3e${nls.copyFeatures.multipleFeatureSaveWarning}\x3c/div\x3e\r\n    \x3cdiv style\x3d"width: 100; margin-bottom: 5px;" data-dojo-attach-point\x3d"applyEditsProgressParentNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListContent" data-dojo-attach-point\x3d"layerListTable"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesBtnContainer"\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn"\r\n        data-dojo-attach-point\x3d"createMultipleFeaturesBtn" aria-label\x3d"${nls.copyFeatures.createFeatures}"\r\n        title\x3d"${nls.copyFeatures.createFeatures}"\x3e${nls.copyFeatures.createFeatures}\x3c/div\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn"\r\n        data-dojo-attach-point\x3d"createSingleFeatureBtn" aria-label\x3d"${nls.copyFeatures.createSingleFeature}"\r\n        title\x3d"${nls.copyFeatures.createSingleFeature}"\x3e\r\n        ${nls.copyFeatures.createSingleFeature}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesBtnContainer esriCTBottomBorder"\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn2 jimu-btn" data-dojo-attach-point\x3d"fieldsMatchingBtn"\r\n        aria-label\x3d"${nls.fieldsMapping.popupTittle}"\r\n        title\x3d"${nls.fieldsMapping.popupTittle}"\x3e${nls.fieldsMapping.popupTittle}\r\n      \x3c/div\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn2 jimu-btn" data-dojo-attach-point\x3d"cancelBtn"\r\n        aria-label\x3d"${nls.cancel}" title\x3d"${nls.cancel}"\x3e${nls.cancel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/fieldsMapping.html":'\x3cdiv style\x3d"width: 100%; height: 100%;" \x3e\r\n    \x3cdiv class\x3d"esriCTBottomSpacing"\x3e\r\n        ${nls.fieldsMapping.informativeText}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTBottomSpacing"\x3e\r\n        \x3cdiv  data-dojo-attach-point\x3d"fieldsMatchingCheckboxNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d\'esriCTFieldsMappingContainer\' data-dojo-attach-point\x3d"fieldsMappingContainer"\x3e\r\n    \r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/fieldMap.html":'\x3cdiv class\x3d"esriCTParentNode esriCTBottomSpacing"\x3e\r\n  \x3cdiv class\x3d"esriCTHeader" data-dojo-attach-point\x3d"headerNode"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFiledsContainer esriCTHidden" data-dojo-attach-point\x3d"fieldsNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldMappingTableWrapper"\x3e\r\n      \x3ctable class\x3d"esriCTFieldsMatchingTable" cellspacing\x3d"5"\x3e\r\n        \x3cthead\x3e\r\n          \x3ctr class\x3d"esriCTFieldsMatchingTableRow"\x3e\r\n            \x3cth class\x3d"esriCTFieldsMatchingTableCell"\x3e${nls.fieldsMapping.fieldsInTargetLayerLabel}\x3c/th\x3e\r\n            \x3cth class\x3d"esriCTFieldsMatchingTableCell"\x3e${nls.fieldsMapping.fieldsInSourceLayerLabel}\x3c/th\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/thead\x3e\r\n        \x3ctbody class\x3d"esriCTFieldsMatchingTableRow" data-dojo-attach-point\x3d"fieldsTbodyNode"\x3e\r\n        \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"noFieldsMatching" data-dojo-attach-point\x3d"noFieldsMatching"\x3e\r\n      \x3cspan tabindex\x3d"0" role\x3d"presentation"\x3e${nls.fieldsMapping.noFieldsToMatchLabel}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/ValuePicker.html":'\x3cdiv class\x3d"jimu-widget-smartEditor" style\x3d"max-height: 445px;padding: 0 5px;"\x3e\r\n  \x3cdiv class\x3d"esriCTValuePickerHint" data-dojo-attach-point\x3d"valuePickerHint" tabindex\x3d"0"\r\n    aria-label\x3d"${nls.valuePicker.popupHint}" role\x3d"presentation"\x3e\r\n    ${nls.valuePicker.popupHint}\r\n  \x3c/div\x3e\r\n  \x3cdiv style\x3d"width:100%" data-dojo-attach-point\x3d"fieldsContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/SmartEditor/requiredFields.html":'\x3cdiv style\x3d"max-height: 445px;padding: 0 5px;"\x3e\r\n    \x3cdiv class\x3d"esriCTValuePickerHint"\x3e\r\n        ${nls.requiredFields.displayMsg}\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"width: 100%;" data-dojo-attach-point\x3d"fieldsDijitContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/SmartEditor/Widget.html":'\x3cdiv style\x3d"width:100%; height:100%; min-width:280px;min-width:240px;"\x3e\r\n    \x3c!--\x3cdiv class\x3d"widgetActive widgetIndicator" id\x3d"widgetActiveIndicator" data-dojo-attach-point\x3d"widgetActiveIndicator"\x3e\x3c/div\x3e--\x3e\r\n    \x3cdiv class\x3d"templatePickerMainDiv"\x3e\r\n\r\n        \x3cdiv id\x3d"templatePickerDiv" class\x3d"templatePickerDiv" data-dojo-attach-point\x3d"templatePickerDiv" tabindex\x3d"-1"\x3e\r\n            \x3c!-- aria-label and tabindex set at runtime --\x3e\r\n            \x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"templateTitle"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"spacer"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"drawingOptionsDiv"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"drawingOptionsDiv"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr /\x3e\r\n\r\n        \x3cdiv class\x3d"autoSaveOptionDiv"\x3e\r\n            \x3cdiv\x3e\r\n                \x3cdiv id\x3d"autoSaveSwitch" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-event\x3d"change:_toggleRunTimeAutoSave"\r\n                aria-label\x3d"${nls.autoSaveEdits}" tabindex\x3d"0" checked\x3d"true" label\x3d"${nls.autoSaveEdits}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"presetFieldsTableDiv" class\x3d"presetFieldsTableDiv" data-dojo-attach-point\x3d"presetFieldsTableDiv"\x3e\r\n            \x3cdiv class\x3d" spacer"\x3e\x3c/div\x3e\r\n            \x3cdiv\x3e\r\n                \x3cdiv id\x3d"savePresetValueSwitch" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-event\x3d"change:_setPresetValue"\r\n                aria-label\x3d"${nls.usePresetValues}" tabindex\x3d"0" label\x3d"${nls.usePresetValues}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"spacer"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"presetFieldsTable" data-dojo-attach-point\x3d"presetFieldsTableNode"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"spacer"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"attributeInspectorMainDiv" style\x3d"display:none"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"buttonWrapper" class\x3d"buttonWrapper"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" class\x3d"cancelButton jimu-btn"\x3e${nls.back}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"mainContainer" style\x3d"max-height : calc(100% - 65px); overflow:auto;"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"attributeInspectorNoFeatureMsg" data-dojo-attach-point\x3d"noFeatureWarningMessage" style\x3d"display:none"\x3e\r\n        \x3cdiv tabindex\x3d"0" role\x3d"presentation" data-dojo-attach-point\x3d"noFeatureMessage"\x3e${nls.noFeatureInAIWarning}\x3c/div\x3e\r\n        \x3cdiv class\x3d"noFeatureCancelBtnWrapper"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"noFeatureCancelBtn" tabindex\x3d"0" role\x3d"button" class\x3d"noFeatureCancelBtn jimu-btn"\x3e${nls.cancel}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesMainDiv esriCTHidden" data-dojo-attach-point\x3d"copyFeaturesMainNode"\x3e\r\n    \x3c/div\x3e\r\n',
"url:widgets/SmartEditor/css/style.css":'.jimu-widget-sefilterEditor {}.jimu-widget-sefilterEditor .flDropDown {height: 30px!important; width: 100%; margin-top: 2px; margin-bottom: 10px;}.jimu-widget-sefilterEditor .searchtextbox {height: 30px!important; width: 100%; padding: 5px; margin-bottom: 5px;}.seToolbarIcon {background-image: url("../images/toolbar_icons.png"); width: 16px; height: 16px;}.sePointIcon {background-position: 0px 0px;}.sePointIconDisabled {background-position: -16px 0px;}.sePolylineIcon {background-position: -34px 0px;}.sePolylineIconDisabled {background-position: -50px 0px;}.sePolygonIcon {background-position: -69px 0px;}.sePolygonIconDisabled {background-position: -84px 0px;}.seFreehandPolylineIcon {background-position: -101px 0px;}.seFreehandPolylineIconDisabled {background-position: -118px 0px;}.seFreehandPolygonIcon {background-position: -135px 0px;}.seFreehandPolygonIconDisabled {background-position: -152px 0px;}.seRectangleIcon {background-position: -339px 0px;}.seTriangleIcon {background-position: -356px 0px;}.seEllipseIcon {background-position: -373px 0px;}.seCircleIcon {background-position: -390px 0px;}.seArrowIcon {background-position: -407px 0px;}.seArrowDownIcon {background-position: -424px 0px;}.seArrowLeftIcon {background-position: -441px 0px;}.seArrowUpIcon {background-position: -458px 0px;}.seNewSelectionIcon {background-position: -237px 0px;}.seAddToSelectionIcon {background-position: -254px 0px;}.seRemoveFromSelectionIcon {background-position: -271px 0px;}.seClearSelectionIcon {background-position: -288px 0px;}.drawingOptionsDiv .dijitDropDownButton {margin: 0; width: 100%; text-align: left;} .drawingOptionsDiv .dijitDropDownButton .dijitButtonNode {background: transparent; border: 1px solid #7EABCD; padding: 4px; margin-top: 2px; font-weight: bold; box-shadow: none; border-radius: 4px; text-align: left; width: 100%;}.jimu-rtl .drawingOptionsDiv .dijitDropDownButton .dijitButtonNode {text-align: right;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode .dijitButtonContents {border-color: transparent;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode .dijitInputField {padding: 0 5px;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode .dijitArrowButton {background: transparent; border: 0;}.drawingOptionsDiv .dijitDropDownButton .dijitButtonNode.dijitSelectFocused .dijitArrowButton {padding: 0;}.drawingOptionsDiv .dijitDownArrowButton {position: relative;}.drawingOptionsDiv .dijitArrowButtonInner {position: absolute; right: 8px; top: 3px; background-image: none;} .drawingOptionsDiv .dijitArrowButtonInner:after {content: "\\e681"; font-family: \'CalciteWebCoreIcons\' !important; speak: none; font-style: normal; font-weight: bold; font-variant: normal; text-transform: none; line-height: 1; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;}div[dijitpopupparent\x3d"drawingTool"] .dijitMenuItemIconCell {width: 20px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn {width: 25%; float: left; text-indent: 20px; padding: 5px 0px 5px 0px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTselectValueLabel {width: 50% !important;}.jimu-widget-smartEditor-setting-relativeDates .esriCTDateTypeLabel {min-width: fit-content;}.jimu-widget-smartEditor-setting-relativeDates .esriCTLabel,.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentWrappper {padding: 5px 0px 5px 0px; width: 100%; overflow: hidden;}.jimu-widget-smartEditor-setting-relativeDates .esriCTValueLabel {margin-bottom: 5px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTPastOrFutureDateContent {width: 100%; margin-left: 20px;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTPastOrFutureDateContent {margin-left: none; margin-right: 20px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentLabel {width: 25%; float: left;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentDijit {width: 75%; float: right;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {width: 33%; float: left;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFloatRight {width: 33%; float: right;}.jimu-widget-smartEditor-setting-relativeDates .esriCTHidden {display: none;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioButtonContainer {width: 100%; height: 30px; display: inline-table;}.jimu-widget-smartEditor-setting-relativeDates .esriCTMarginForLabel {width: 100%; padding: 2px 0px 1px 0px; overflow: hidden;}.jimu-widget-smartEditor-setting-relativeDates .esriCTFixedDateContent {width:100%;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatRight,.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentDijit {float:left;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn,.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFixedContentLabel,.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {float: right;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRelativeDatesHint {font-size: 12px; color: #a0acbf; font-style: oblique; width: 100%; margin-top: 5px;}.jimu-widget-smartEditor-setting-relativeDates .esriCTDatesWarningContainer {font-size: 12px; color: red; width: 100%; margin-top: 5px; padding: 5px 0px 5px 0px; overflow: hidden; font-style: italic;}.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioLabel {vertical-align: middle;}.jimu-widget-smartEditor-setting-relativeDates .esriCTPopUpLabel {width: 25%; padding: 0px 10px 0px 0px; word-break: break-word; float: left; line-height: 30px; text-indent: 20px;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTPopUpLabel {float: right}.jimu-widget-smartEditor-setting-relativeDates .esriCTWrapper {width: 100%; overflow: hidden; margin-bottom: 5px; padding-bottom: 5px;}.jimu-rtl .jimu-widget-smartEditor-setting-relativeDates .esriCTPopupSelect{float: left;}@media (max-width: 600px) {.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn {width: 50%;} .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {width: 50%;}}@media (max-width: 320px) {.jimu-widget-smartEditor-setting-relativeDates .esriCTRadioBtn {width: 100%;} .jimu-widget-smartEditor-setting-relativeDates .esriCTFloatLeft {width:100%;}}.jimu-widget-smartEditor-setting-relativeDates .esriCTDomainFieldHint {font-size: 13px; color: #a0acbf; font-style: oblique; margin-top: 5px;}.processing-indicator-panel {display: none; width: 100%; height: 100%; z-index: 500; top: 0; left: 0; position: absolute; background-position: center center; background-image: url(../images/busy.gif); background-repeat: no-repeat;} .processing-indicator-panel.busy {display: block;}.jimu-widget-smartEditor {position: relative;}.autoSaveOptionDiv {display:none;} .widgetIndicator {height: 4px; position:absolute; top:0; z-index:1; width:100%; overflow:hidden; overflow-x: hidden;} .widgetActive {background: #73AD21;} .widgetNotActive {background: red; height: 6px;} .jimu-widget-smartEditor .hideField {display: none;} .jimu-widget-smartEditor .templatePicker {position: relative; height: 296px;} .jimu-widget-smartEditor .grid {height: 100% !important;} .jimu-widget-smartEditor .dojoxGridMasterHeader {height: 0 !important;} .jimu-widget-smartEditor .dojoxGridContent {width: 100% !important;} .jimu-widget-smartEditor .dojoxGridContent div[role\x3dpresentation] {right: 0;} .jimu-widget-smartEditor .dojoxGridRowTable {width: 100%;} .jimu-widget-smartEditor .dojoxGridRow {width: 100%;} .jimu-widget-smartEditor .dojoxGridView {width: 100% !important;} .jimu-widget-smartEditor .esriAttributeInspector {height: 20px; width: 100%;} .jimu-widget-smartEditor .esriAttributeInspector td {display: block; clear: both; height: auto; width: 100%; float: left;}.clearfix:after {content: "."; display: block; height: 0; clear: both; visibility: hidden;}.clearfix {display: inline-block;}* html .clearfix {height: 1%;}.clearfix {display: block;}.clear:after {clear: both; content: "."; display: block; height: 0; visibility: hidden;}.jimu-widget-smartEditor .esriAttributeInspector .atiNavButtons {position: absolute; left: 50%; margin-left: -90px;}.jimu-widget-smartEditor .esriAttributeInspector .asteriskIndicator {color: red !important;}.jimu-widget-smartEditor .esriAttributeInspector .saveButton {float: right; display: inline; margin-bottom: 5px;}.jimu-rtl .jimu-widget-smartEditor .esriAttributeInspector .saveButton {float: left; display: inline;}.jimu-widget-smartEditor .esriAttributeInspector .saveButton.hide {display: none;}.jimu-widget-smartEditor .buttonHeader {float: right;}.jimu-rtl .jimu-widget-smartEditor .buttonHeader {float: left;}.jimu-widget-smartEditor .buttonHeader .saveButton {float: right; margin-left: 5px;}.jimu-rtl .jimu-widget-smartEditor .buttonHeader .saveButton {float: left; margin-left: 0px; margin-right: 5px;}.jimu-widget-smartEditor .buttonHeader .deleteButton {float: left;}.jimu-rtl .jimu-widget-smartEditor .buttonHeader .deleteButton {float: right;}.jimu-widget-smartEditor .cancelButton {float: left;}.jimu-rtl .jimu-widget-smartEditor .cancelButton {float: right;}.jimu-widget-smartEditor .noFeatureCancelBtnWrapper {text-align: center;}.jimu-widget-smartEditor .noFeatureCancelBtn {margin-top: 15px;}.jimu-widget-smartEditor .esriAttributeInspector .deleteButton {float: right; margin-right: 20px;}.jimu-rtl .jimu-widget-smartEditor .esriAttributeInspector .deleteButton {float: left; margin-left: 20px;}.jimu-widget-smartEditor .ee-presetValueTableDiv {height: 100%; width: 100%;}.jimu-widget-smartEditor .ee-presetValueHeaderTable {color: #000000; font-size: 14px; padding: 8px; background-color: #E3E3E3; vertical-align: middle; width: 100%;}.jimu-widget-smartEditor .ee-presetValueBodyTable td {display: block; clear: both; height: auto; width: 100%; float: left;}.jimu-widget-smartEditor .esriCTGroupInfoIcon {width: 16px; height: 20px; margin: 0px 2px 2px 0px; background-repeat: no-repeat; background-size: 16px 16px; background-image: url(../images/desc.png); cursor: pointer; float: left;}.jimu-rtl .jimu-widget-smartEditor .esriCTGroupInfoIcon {float: right;}.jimu-widget-smartEditor .ee-atiLabel {width: 100%; margin-bottom: 3px; line-height: 20px;}.jimu-widget-smartEditor .editRelativeDateIcon {margin: 5px auto; height: 20px; width: 20px; float: right; cursor: pointer;}.jimu-rtl .jimu-widget-smartEditor .editRelativeDateIcon {float: left;}.jimu-widget-smartEditor .atiLabel {width: 100%; margin-top: 6px !important; margin-bottom: 3px !important;}.jimu-widget-smartEditor .ee-presetValueBody {vertical-align: top;}.jimu-widget-smartEditor .ee-presetValueBodyTable {width: 100%;}.jimu-widget-smartEditor .ee-presetValue-label-header-field,.jimu-widget-smartEditor .field-alias-label {width: 40%;}.jimu-widget-smartEditor .ee-presetValue-value-header-field,.jimu-widget-smartEditor .preset-value-editable {width: 100%; margin-bottom: 6px;}.jimu-widget-smartEditor .ee-inputField,.jimu-widget-smartEditor-requiredFields .ee-inputField {width: 100%;}.jimu-widget-smartEditor .ee-inputFieldTextArea {width: 100%!important; resize: vertical; overflow: auto; font-family: inherit; line-height: 20px !important; font-size: 14px; min-height: 70px;}.jimu-widget-smartEditor .ee-inputFieldRichText {width: 100%!important; margin: 5px auto;}.jimu-widget-smartEditor .spacer {height: 12px;}.jimu-widget-smartEditor .spacerSmall {height: 8px;}.jimu-widget-smartEditor .attributeInspectorDiv {padding-top: 8px;}.jimu-widget-smartEditor .esriAttributeInspector .atiField {width: 100%;}.jimu-widget-smartEditor .esriAttributeInspector .dijitTextBox {width: 100%!important;}.jimu-widget-smartEditor .esriAttributeInspector .dijitTextArea {width: 100%!important; min-height: 70px; resize: vertical; overflow: auto; font-family: inherit; line-height: 20px !important; font-size: 14px;}.jimu-widget-smartEditor div.atiAttributes table {width: 98%;}.jimu-widget-smartEditor .processing-indicator {display: none; float: right; width: 40px; height: 40px; background-position: center center; background-image: url(../images/busy.gif); background-repeat: no-repeat; z-index: 999;} .jimu-widget-smartEditor .processing-indicator.busy {display: inline;}.jimu-widget-smartEditor .processing-indicator-panel {display: none; width: 100%; height: 100%; z-index: 500; top: 0; left: 0; position: absolute; background-position: center center; background-image: url(../images/busy.gif); background-repeat: no-repeat;} .jimu-widget-smartEditor .processing-indicator-panel.busy {display: block;}.jimu-widget-smartEditor .updateOnlyText {vertical-align: middle; padding: 10px;}.jimu-widget-smartEditor .attInput {padding-top: 3px; padding-bottom: 3px; display: inline-block;}.jimu-widget-smartEditor .deleteAttachment {padding-right: 5px; cursor: pointer; color: red !important; font-weight: bold;}.jimu-widget-smartEditor .atiNavMessage {display: inline-block; float: none;}.jimu-widget-smartEditor .dijitButtonHover .dijitButtonNode {background-color: transparent !important; background-image: none !important; border: none !important; -webkit-box-shadow: none !important; -moz-box-shadow: none !important; box-shadow: none !important;}.jimu-widget-smartEditor .dijitButton .dijitButtonNode {background-color: transparent !important; background-image: none !important; border: none !important; -webkit-box-shadow: none !important; -moz-box-shadow: none !important; box-shadow: none !important;}.jimu-widget-smartEditor .dijitButton {background-color: transparent !important; background-image: none !important; border: none !important; -webkit-box-shadow: none !important; -moz-box-shadow: none !important; box-shadow: none !important;}.dijitCalendarDateTemplate.dijitCalendarCurrentDate .dijitCalendarDateLabel {color: red; border-color: red;}.dijitCalendarDateTemplate.dijitCalendarHoveredDate .dijitCalendarDateLabel,.dijitCalendarDateTemplate.dijitCalendarEnabledDate:hover .dijitCalendarDateLabel {background-color: greenyellow;}.dijitCalendarDateTemplate.dijitCalendarSelectedDate .dijitCalendarDateLabel,.dijitCalendarDateTemplate.dijitCalendarSelectedDate.dijitCalendarHoveredDate .dijitCalendarDateLabel {background-color: cyan;}.jimu-widget-smartEditor .dijitComboBox \x3e div.dijitArrowButton.dijitDownArrowButton {width: 25px !important;}.jimu-widget-smartEditor .dijitTextBox .dijitInputField {height: 100% !important;}.jimu-widget-smartEditor .dijitComboBox \x3e div.dijitArrowButton.dijitDownArrowButton \x3e input {width: 100%;}.jimu-widget-smartEditor .attwarning {margin-top: 2px; color: brown;}.jimu-widget-smartEditor .presetFieldsTableDiv {display: none;}.jimu-widget-smartEditor .buttonWrapper {text-align: center; margin-bottom: 5px; width: 100%; display: inline-block;}.jimu-widget-smartEditor .footerButton {text-align: center; margin-top: 5px;}.jimu-widget-smartEditor .esriAttributeInspector .atiLayerName {display:none;}.jimu-widget-smartEditor .editDescription {padding : 5px 0 5px 0; outline-offset: -1px;}.jimu-widget-smartEditor .esriCTItemListContainer {float: left; width: 100%; height: calc(100% - 30px); overflow-y: auto;} .jimu-widget-smartEditor .esriCTItemTitleContainer {background-color: #f5f5f5; color: #444; cursor: pointer; border: 1px solid #d9d9d9; width: 100%; display: inline-block; float: left;} .jimu-widget-smartEditor .esriCTItemTitleContainer:focus {outline-offset: -2px;} .jimu-widget-smartEditor .esriCTItemTitle {padding: 15px 5px 15px 5px; text-align: left; border: none; outline: none; width: calc(100% - 35px); float: left; white-space: pre-wrap;} .jimu-rtl .jimu-widget-smartEditor .esriCTItemTitle {float: right; text-align: right;} .jimu-rtl .jimu-widget-smartEditor .esriCTItemHighlighter {float: right;} .jimu-widget-smartEditor .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;} .jimu-widget-smartEditor .esriCTItemContent {height: 0px; padding: 0 5px; overflow: hidden; border-right: 1px solid #d9d9d9; border-left: 1px solid #d9d9d9;} .jimu-widget-smartEditor .esriCTRelatedItemContent {border-bottom: 1px solid #d9d9d9;} .jimu-widget-smartEditor .esriCTItemContentActive {height: auto;} .jimu-widget-smartEditor .esriCTItemListImageLogo {height: 24px; width: 24px; margin-top: 10px; float: left; background-position: center center; background-repeat: no-repeat; background-size: 24px; margin-left: 5px;} .jimu-widget-smartEditor .esriCTItemListImageLogo {float: right; margin-left: auto; margin-right: 5px;} .jimu-widget-smartEditor .esriCTBorder {border: 1px solid grey;} .jimu-widget-smartEditor .esriAttributeInspector .atiNavButtons {float: none;} .jimu-widget-smartEditor .buttonContainer {text-align: center; margin-top: 5px;} .jimu-widget-smartEditor .attributeInspectorMainDiv {height: 100%;} .jimu-widget-smartEditor .detailsContainer {height:100%;} .jimu-widget-smartEditor .esriCTItemHighlighter {height: 44px; width: 5px; float: left;} .jimu-widget-smartEditor .itemTitleArrowIcon {height: 20px; width: 20px; background-size: 20px; background-repeat: no-repeat; background-position: center; float: left; margin-top: 13px;} .jimu-rtl .jimu-widget-smartEditor .itemTitleArrowIcon {margin-left: 5px;} .jimu-widget-smartEditor .itemTitleUpArrow {background-image: url(../images/upArrow.png);} .jimu-widget-smartEditor .itemTitleDownArrow {background-image: url(../images/downArrow.png);} .jimu-widget-smartEditor .esriCTDisableToggling .esriCTItemTitleContainer {cursor: default;} .jimu-widget-smartEditor .esriCTDisableToggling .itemTitleUpArrow {background-image: none;} .jimu-widget-smartEditor .relatedTablesContainer {float: left; margin: 3px; width: 100%;} .jimu-rtl .jimu-widget-smartEditor .relatedTablesContainer {float: right;} .jimu-widget-smartEditor .relatedTableTitleContainer {padding: 7px 0px 7px 0px; width: 100%; float: left; border-bottom: 1px solid #d9d9d9; cursor: pointer; line-height: 20px;}.jimu-widget-smartEditor .esriCTRelatedTableTitleDefaultCursor {cursor: default;}.jimu-widget-smartEditor .relatedTableTitle {float: left;}.jimu-rtl .jimu-widget-smartEditor .relatedTableTitle {float: right;}.jimu-widget-smartEditor .relatedTableIcons {height: 20px; width: 20px; background-size: 20px; background-repeat: no-repeat; background-position: center; float: left; margin-left: 10px;}.jimu-widget-smartEditor .esriCTRelatedTableRecordsCount {float: left;}.jimu-widget-smartEditor .esriCTLoadingIcon {background-image: url(\'../images/loading-icon.gif\'); background-position: center center; background-repeat: no-repeat; height: 20px; width: 20px; float: left;}.jimu-rtl .jimu-widget-smartEditor .esriCTRelatedTableRecordsCount {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTLoadingIcon {float: right;}.jimu-widget-smartEditor .refreshAttributes {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/refresh.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTAutoUpdateOnMode {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/auto-update-on-mode.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTAutoUpdateOffMode {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/auto-update-off-mode.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTMapNavigationLocked {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/map-navigation-locked.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTMapNavigationUnLocked {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/map-navigation-unlocked.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTLocateButtonContainer {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/locate.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTXYCoordinates {height: 35px; width: 35px; background-size: 35px; background-repeat: no-repeat; background-position: center; float: left; background-image: url(../images/xy-coordinates.png); cursor: pointer;}.jimu-widget-smartEditor .esriCTGeometryEditor {margin-right: 5px;}.jimu-rtl .jimu-widget-smartEditor .refreshAttributes {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTAutoUpdateOnMode {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTAutoUpdateOffMode {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTMapNavigationLocked {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTMapNavigationUnLocked {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTLocateButtonContainer {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTXYCoordinates {float: right;}.jimu-rtl .jimu-widget-smartEditor .esriCTGeometryEditor {margin-left: 5px; margin-right: 0px;}.jimu-widget-smartEditor .itemTitleCreateNew {background-image: url(../images/newFeature.png); cursor: pointer;}.jimu-rtl .jimu-widget-smartEditor .itemTitleCreateNew {float: right; margin-right: 5px; margin-left: 0px;}.jimu-widget-smartEditor .itemTitleNextArrow {-webkit-transform: rotate(90deg); -moz-transform: rotate(90deg); -ms-transform: rotate(90deg); -o-transform: rotate(90deg); transform: rotate(90deg); background-image: url(../images/upArrow.png);} .jimu-rtl .jimu-widget-smartEditor .itemTitleNextArrow {-webkit-transform: rotate(270deg); -moz-transform: rotate(270deg); -ms-transform: rotate(270deg); -o-transform: rotate(270deg); transform: rotate(270deg); margin-right: 5px; margin-left: 0px;} .jimu-widget-smartEditor .hidden {display: none;} .dart-panel .jimu-widget-smartEditor .esriCTItemTitleContainer:hover {background-color: #808080;} .dart-panel .jimu-widget-smartEditor .esriCTItemListContainer {border: 1px solid #808080;} .dart-panel .jimu-widget-smartEditor .esriCTItemTitleContainer {background-color: #646464; border-bottom: 1px solid #808080;} .esriCTOverridePanelStyle {height: calc(100% - 20px) !important;} .jimu-widget-smartEditor-XYCoordinates .esriCTHidden {display: none !important;} .jimu-widget-smartEditor-XYCoordinates .esriCTSelectTitle {padding-top: 5px; padding-bottom: 5px; margin-top: 2px;} .jimu-widget-smartEditor-XYCoordinates .esriCTFieldDropdownContainer .claro .dijitSelect {background-color: #f0f0f0; height: 30px;} .jimu-popup .title-label {width: calc(100% - 30px); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;} .jimu-widget-smartEditor .esriCTCopyFeaturesMainContainer {border: 1px solid #d9d9d9; position: absolute; top: 0; background-color: #fff; height: calc(100% + 5px); width: 100%;} .jimu-widget-smartEditor .esriCTSelectFeaturesContainer {height: calc(100% - 10px); width: 100%;} .jimu-widget-smartEditor .esriCTCopyFeaturesListTitle {margin-bottom: 5px; font-weight: bold; font-size: 15px;} .jimu-widget-smartEditor .esriCTCopyFeaturesHint {margin-bottom: 5px; font-weight: bold; color: red;} .jimu-widget-smartEditor .esriCTCopyFeaturesListContent {height: calc(100% - 114px); width: 100%; overflow: auto; border-top: 1px solid #d9d9d9; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9; padding: 5px;} .jimu-widget-smartEditor .esriCTCopyFeaturesListContent .jimu-checkbox {align-items: start;} .jimu-widget-smartEditor .esriCTCopyFeaturesNode {margin-bottom: 8px;} .jimu-widget-smartEditor .esriCTCopyFeaturesNode:after {content: ""; display: table; clear: both;} .jimu-widget-smartEditor .esriCTCopyFeaturesChildNode {margin-left: 35px;} .jimu-rtl .jimu-widget-smartEditor .esriCTCopyFeaturesChildNode {margin-right: 35px;} .jimu-widget-smartEditor .esriCTCopyFeaturesBtn {margin-top: 10px; margin-right: 5px; margin-left: 5px; max-width: 150px; width: 45%;} .jimu-widget-smartEditor .esriCTCopyFeaturesBtn2 {margin-top: 10px; margin-right: 5px; margin-left: 5px; max-width: 185px;} .jimu-widget-smartEditor .esriCTCopyFeaturesBtnContainer {text-align: center; border-left: 1px solid #d9d9d9; border-right: 1px solid #d9d9d9; padding-bottom: 5px;} .jimu-widget-smartEditor .esriCTBottomBorder {border-bottom: 1px solid #d9d9d9;} .jimu-widget-smartEditor .esriCTExpandCollapseNode {float: left; height: 20px; width: 20px; background-size: 20px; background-position: center; background-repeat: no-repeat;} .jimu-rtl .jimu-widget-smartEditor .esriCTExpandCollapseNode {float: right;} .jimu-widget-smartEditor .esriCTCopyFeaturesListContent .expanded {background-image: url(../images/upArrow.png); transform: rotate(180deg); -moz-transform: rotate(180deg) !important; -o-transform: rotate(180deg) !important; -webkit-transform: rotate(180deg) !important; transform: rotate(180deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear;} .jimu-widget-smartEditor .esriCTCopyFeaturesListContent .collapsed {background-image: url(../images/upArrow.png); transform: rotate(90deg); -moz-transform: rotate(90deg) !important; -o-transform: rotate(90deg) !important; -webkit-transform: rotate(90deg) !important; transform: rotate(90deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear;} .jimu-rtl .jimu-widget-smartEditor .esriCTCopyFeaturesListContent .collapsed {transform: rotate(270deg); -moz-transform: rotate(270deg) !important; -o-transform: rotate(270deg) !important; -webkit-transform: rotate(270deg) !important; transform: rotate(270deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear;} .jimu-widget-smartEditor .esriCTHidden {display: none !important;} .jimu-widget-smartEditor .esriCTCopyFeaturesMainDiv {width: 100%; height: 100%; position: absolute; top: 0; left: 0; background-color: #ffffff;} .jimu-widget-smartEditor .esriCTCanCreateOnlyOneFeature {display: none;} .jimu-widget-smartEditor-XYCoordinates .esriCTPopupContainer {padding: 1px;} .jimu-widget-smartEditor-XYCoordinates .esriCTControlWidth {width: 100%} .jimu-popup .content .presetMessageContentDiv:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-smartEditor .esriCTValuePickerButton {height: 25px; width: 25px; float: right; background-image: url(../images/value-picker.png); background-size: 25px; background-repeat: no-repeat; cursor: pointer; margin-top: 5px;}.jimu-widget-smartEditor .esriCTValuePickerButton.disabled {opacity: 0.4;}.jimu-rtl .jimu-widget-smartEditor .esriCTValuePickerButton {float: left;}.jimu-widget-smartEditor .esriAttributeInspector .multipleValueDijit {width: calc(100% - 35px) !important;}.jimu-widget-smartEditor .esriCTValuePickerHint,.jimu-widget-smartEditor-requiredFields .esriCTValuePickerHint {font-size: 12px; color: #a0acbf; font-style: oblique; margin: 5px 0;}.jimu-widget-smartEditor .esriCTFieldContainer,.jimu-widget-smartEditor-requiredFields .esriCTFieldContainer {margin-bottom: 10px;}.jimu-widget-smartEditor .esriCTFieldName,.jimu-widget-smartEditor-requiredFields .esriCTFieldName {margin-bottom: 3px; font-size: 12px;}.jimu-widget-smartEditor .esriCTFieldName .asteriskIndicator {display: none !important;}.jimu-widget-smartEditor-multiple-value-picker .content-static {margin: 10px 10px 0;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {overflow: hidden; width: 220px; float: left;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelect .dijitInputField {overflow: hidden;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {text-align: left;}.jimu-rtl .jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {text-align: right;}.jimu-widget-smartEditor-requiredFields .ee-error {border-color: #d46464 !important; box-shadow: 0px 0px 5px #d46464;}.jimu-widget-smartEditor-requiredFields .esriCTMarginLeft15 {margin-left: 15px;}.jimu-rtl .jimu-widget-smartEditor-requiredFields .esriCTMarginLeft15 {margin-right: 15px; margin-left: 0px;}.claro .dijitSelectLabel,.jimu-widget-smartEditor-fieldsMapping .textLabelEllipsis {text-overflow: ellipsis; text-align: justify; overflow: hidden; vertical-align: middle;}.jimu-rtl .jimu-widget-smartEditor .esriCTCopyFeaturesListContent .jimu-checkbox .label,.jimu-rtl .claro .dijitSelectMenu td.dijitMenuItemLabel,.jimu-rtl .jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingDropdown .dijitSelectLabel,.jimu-rtl .jimu-widget-smartEditor-fieldsMapping .textLabelEllipsis {direction: ltr; text-align: right;}.jimu-widget-smartEditor-XYCoordinates .esriCTFieldInput .dijitSelectLabel {width: 290px;}.jimu-widget-smartEditor-multiple-value-picker .esriCTFieldContainer .dijitSelectLabel {width: 225px;}.jimu-widget-smartEditor-requiredFields .esriCTFieldContainer .dijitSelectLabel {width: 200px;}.jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMappingContainer {width: 100%; height: 100%; max-height: 350px; overflow-y: auto; padding-right: 5px;}.jimu-rtl .jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMappingContainer {padding-left: 5px; padding-right: 0;}.jimu-widget-smartEditor-fieldsMapping .esriCTParentNode {border: 1px solid #a0acbf; border-radius: 3px;}.jimu-widget-smartEditor-fieldsMapping .esriCTHeader {display: inline-block; width: 100%;}.jimu-widget-smartEditor-fieldsMapping .esriCTBottomSpacing {margin-bottom: 8px;}.jimu-widget-smartEditor-fieldsMapping .esriCTLayerName {float: left; margin: 6px 0px; width: calc(100% - 30px); cursor: pointer; word-break: break-all;}.jimu-widget-smartEditor-fieldsMapping .esriCTLayerNameWidthReduced {max-width: calc(100% - 90px);}.jimu-rtl .jimu-widget-smartEditor-fieldsMapping .esriCTLayerName {float: right; text-align: right;}.jimu-widget-smartEditor-fieldsMapping .esriCTResetButton {float: left; margin: 4px; height: 22px; width: 22px; background-size: 22px; background-repeat: no-repeat; background-image: url(../images/reset.png); cursor: pointer;}.esriRtl .jimu-widget-smartEditor-fieldsMapping .esriCTResetButton {float: right;}.jimu-widget-smartEditor-fieldsMapping .esriCTClearButton {float: left; margin: 4px; height: 22px; width: 22px; background-size: 22px; background-repeat: no-repeat; background-image: url(../images/clear.png); cursor: pointer;}.esriRtl .jimu-widget-smartEditor-fieldsMapping .esriCTClearButton {float: right;}.jimu-widget-smartEditor-fieldsMapping .esriCTIconParentNode {float: right;}.esriRtl .jimu-widget-smartEditor-fieldsMapping .esriCTIconParentNode {float: left;}.jimu-widget-smartEditor-fieldsMapping .esriCTFiledsContainer {max-height: 150px; overflow: auto; width: 100%;}.jimu-widget-smartEditor-fieldsMapping .esriCTHidden {display: none;}.jimu-popup\x3e.content {font-size: 14px;}.jimu-widget-smartEditor-fieldsMapping .noFieldsMatching {width: 100%; padding: 10px; text-align: center;}.jimu-widget-smartEditor-fieldsMapping .esriCTArrow {background-image: url("../images/downArrow.png"); height: 20px; width: 20px; float: left; margin: 5px; cursor: pointer;}.esriRtl .jimu-widget-smartEditor-fieldsMapping .esriCTArrowUp {float: right; -moz-transform: rotate(90deg) !important; -o-transform: rotate(90deg) !important; -webkit-transform: rotate(90deg) !important; transform: rotate(90deg) !important;}.esriRtl .jimu-widget-smartEditor-fieldsMapping .esriCTArrowDown {float: right; -moz-transform: rotate(0deg) !important; -o-transform: rotate(0deg) !important; -webkit-transform: rotate(0deg) !important; transform: rotate(0deg) !important;}.jimu-widget-smartEditor-fieldsMapping .esriCTArrowUp {-moz-transform: rotate(-90deg) !important; -o-transform: rotate(-90deg) !important; -webkit-transform: rotate(-90deg) !important; transform: rotate(-90deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear; background-size: 20px;}.jimu-widget-smartEditor-fieldsMapping .esriCTArrowDown {-moz-transform: rotate(0deg) !important; -o-transform: rotate(0deg) !important; -webkit-transform: rotate(0deg) !important; transform: rotate(0deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear; background-size: 20px;}.jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTable {width: calc(100% - 10px); table-layout: fixed; margin: 0 5px 5px 5px;}.jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTableRow {width: 100%}.jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTableCell {width: 50%;}.claro .jimu-widget-smartEditor-fieldsMapping .dijitSelect, .claro .jimu-widget-smartEditor-fieldsMapping .dijitTextBox {width: 100%;}.jimu-widget-smartEditor-fieldsMapping .esriCTFieldCheckbox {margin: 2px 0 0 2px;}.esriRtl .jimu-widget-smartEditor-fieldsMapping .esriCTFieldCheckbox {margin: 2px 2px 0 0;}@media only screen and (max-width: 40em) {.jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTable {border-spacing: 0 10px;} .jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTableRow .esriCTTargetTD {padding: 10px 5px 0 5px; border: 1px solid #a0acbf; border-bottom: none;} .jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTableRow .esriCTSourceTD {padding: 5px 5px 10px 5px; border: 1px solid #a0acbf; border-top: none;} .jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTableCell {width: 100%} .jimu-widget-smartEditor-fieldsMapping .esriCTFieldsMatchingTable thead, .jimu-widget-smartEditor-fieldsMapping thead th.esriCTFieldsMatchingTableCell {display: none;} .jimu-widget-smartEditor-fieldsMapping td.esriCTFieldsMatchingTableCell, .jimu-widget-smartEditor-fieldsMapping th.esriCTFieldsMatchingTableCell {display: block;} .jimu-widget-smartEditor-fieldsMapping td.esriCTFieldsMatchingTableCell[data-th]:before {content: attr(data-th);} .jimu-popup .button-container {padding: 15px 15px;} .jimu-popup .content-static {margin: 15px 14px 0;} .jimu-popup\x3e.content {font-size: 12px !important;} .jimu-widget-smartEditor-fieldsMapping .esriCTFieldCheckbox .label {font-size: 12px !important;} .jimu-widget-smartEditor-fieldsMapping .esriCTLayerName {font-size: 12px !important;}}.jimu-rtl .jimu-widget-smartEditor .drawingOptionsDiv .feature-action {margin-left: 2px;}.jimu-rtl .jimu-widget-smartEditor .templatePickerMainDiv .drawingOptionsDiv .dijitArrowButtonInner {left: 8px; right: auto !important;}',
"*now":function(O){O(['dojo/i18n!*preload*widgets/SmartEditor/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/Stateful dojo dijit dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/aspect dojo/i18n!esri/nls/jsapi dojo/dom dojo/dom-construct dojo/dom-class dojo/dom-style dojo/on dojo/keys dojo/json dojo/topic dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/dijit/Message esri/request esri/dijit/editing/TemplatePicker esri/dijit/AttributeInspector esri/toolbars/draw esri/toolbars/edit esri/tasks/query esri/graphic esri/layers/FeatureLayer dojo/promise/all dojo/Deferred esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/geometry/jsonUtils esri/geometry/Polyline esri/geometry/Polygon esri/tasks/RelationshipQuery dijit/registry ./PresetAllFields ./utils ./presetUtils ./presetBuilderBackwardCompatibility ./smartAttributes ./attributeInspectorTools ./relatedTables jimu/dijit/CheckBox dijit/form/Button dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/form/DateTextBox dijit/form/NumberSpinner dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Editor dijit/form/SimpleTextarea dojo/store/Memory dojo/date/stamp dojo/dom-attr jimu/dijit/Popup ./AttachmentUploader esri/lang esri/renderers/jsonUtils dojox/html/entities jimu/dijit/EditorXssFilter jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/SelectionManager ./SEFilterEditor ./SEDrawingOptions ./PrivilegeUtil ./XYCoordinates jimu/dijit/LoadingIndicator esri/tasks/GeometryService esri/geometry/geometryEngine esri/arcgis/Portal ./coordinateUtils ./addressUtils ./Intersection esri/dijit/LocateButton esri/geometry/Point esri/SpatialReference dijit/focus jimu/dijit/FeatureSetChooserForMultipleLayers ./copy-features ./ValuePicker dojo/string ./requiredFields dijit/Tooltip".split(" "),function(O,
C,I,G,e,g,v,d,x,t,h,f,b,a,n,p,m,k,A,w,q,B,l,u,D,z,L,F,Q,T,E,M,J,P,R,Y,Z,da,N,U,ca,ja,ia,X,W,ba,ha,na,pa,ra,sa,qa,xa,Da,Qa,qb,rb,sb,tb,ub,vb,wb,xb,yb,ma,Ka,ab,Ma,bb,Ra,cb,Aa,db,Va,Wa,eb,Fa,fb,gb,Xa,hb,Ya,Za,Na,ib,jb,kb,Oa,Sa,$a,lb,mb,nb,Ia,ob,pb){return G([w,A],{name:"SmartEditor",baseClass:"jimu-widget-smartEditor",_defaultStartStr:"",_defaultAddPointStr:"",_jimuLayerInfos:null,_mapClick:null,settings:null,templatePicker:null,attrInspector:null,editToolbar:null,_isDirty:!1,updateFeatures:[],currentFeature:null,
currentLayerInfo:null,_attrInspIsCurrentlyDisplayed:!1,_ignoreEditGeometryToggle:!1,_editingEnabled:!1,_usePresetValues:!1,_creationDisabledOnAll:!1,_editGeomSwitch:null,_autoSaveRuntime:!1,_userHasPrivilege:!1,_eventHandler:null,_createOverDef:null,featureReductionEnabledLayers:[],rendererDifferentLayers:[],clusterState:!0,_relatedTablesInfo:{},_traversal:[],_nodesCollection:[],_paginationNodeCollection:[],_buttonsWrapper:[],_attributeInspectorCollection:[],contentWrapper:null,viewedFeatureDetails:[],
viewedLayerDetails:[],currentAction:null,_isPresetTableCreated:!1,_layerClearSelectionHandles:[],_layerChangedOutside:!1,_refreshButton:null,_mapNavigation:null,_locateButtonDiv:null,_xyCoordinates:null,_coordinates:null,_selectTool:null,_selectTemplateIndex:0,copyMultipleFeatureGraphics:[],nullAttributeCountRecord:null,requiredFieldsArray:null,_myLocationInfoDef:null,_moveToGPSDef:null,_myLocationInfoForMultipleFeatures:null,canGeocode:!1,_esriLocatorRegExp:/http(s)?:\/\/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,
allSelectedGeometries:null,objectIdArr:[],processedChunksCount:0,canAutoUpdate:!0,_chunkSizeForPolygonAndLineGeometry:10,_chunkSizeForPointGeometry:100,fieldMappingDetails:{},promptedUserToShowSelectionInAI:!1,pendingSelectAction:!1,graphicsSelectionBuffer:null,postMixInProperties:function(){this.nls=e.mixin(this.nls,window.jimuNls.common);this.nls=e.mixin(this.nls,window.jimuNls.timeUnit)},postCreate:function(){this.inherited(arguments);this.pendingSelectAction=!1;this.fieldMappingDetails={};this._myLocationInfoForMultipleFeatures=
this._moveToGPSDef=this._myLocationInfoDef=null;this._relatedTablesInfo={};this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this.viewedFeatureDetails=[];this.viewedLayerDetails=[];this._isPresetTableCreated=!1;this._layerClearSelectionHandles=[];this._layerChangedOutside=!1;this._selectTool=null;this.editorXssFilter=cb.getInstance();this.copyMultipleFeatureGraphics=[];this.allSelectedGeometries=this.requiredFieldsArray=
this.nullAttributeCountRecord=null;this.objectIdArr=[];this.processedChunksCount=0;this.canAutoUpdate=!0;this.promptedUserToShowSelectionInAI=!1;this.graphicsSelectionBuffer=null;this.config.editor.hasOwnProperty("expandRelatedTableOnLoad")||(this.config.editor.expandRelatedTableOnLoad=!1);this.config.editor.hasOwnProperty("expandMainLayerOnLoad")||(this.config.editor.expandMainLayerOnLoad=!0);this.own(n(this.cancelButton,"click",e.hitch(this,function(){this._performCancelButtonOperation()})));this.own(n(this.cancelButton,
"keydown",e.hitch(this,function(c){c.keyCode!==p.ENTER&&c.keyCode!==p.SPACE||this._performCancelButtonOperation()})));this.own(n(this.noFeatureCancelBtn,"click",e.hitch(this,function(){a.set(this.noFeatureWarningMessage,"display","none");this._showTemplatePicker();this._setWidgetFirstFocusNode("templatePicker",!0)})));this.own(n(this.noFeatureCancelBtn,"keydown",e.hitch(this,function(c){if(c.keyCode===p.ENTER||c.keyCode===p.SPACE)a.set(this.noFeatureWarningMessage,"display","none"),this._showTemplatePicker(),
this._setWidgetFirstFocusNode("templatePicker",!0)})));ma.set(ca.byId("savePresetValueSwitch").domNode,"aria-label",this.nls.usePresetValues);ma.set(ca.byId("autoSaveSwitch").domNode,"aria-label",this.nls.autoSaveEdits);this.openAtStartAysn=!0},_performCancelButtonOperation:function(){this.config.editor.displayPromptOnSave&&this._validateFeatureChanged()?this._promptToResolvePendingEdit(1<this._traversal.length?!1:!0,null,!0).then(e.hitch(this,function(c){this._addingNewRelatedRecord&&"no"!==c?this._processBackButtonInNewRelatedRecord=
!0:this._onCancelButtonClicked();this._setWidgetFirstFocusNode("templatePicker",!0)}),function(){}):this._onCancelButtonClicked()},_setCancelButtonText:function(){this._traversal&&1<this._traversal.length?(ma.set(this.cancelButton,"innerHTML",this.nls.back),ma.set(this.cancelButton,"aria-label",this.nls.back)):(ma.set(this.cancelButton,"innerHTML",this.nls.clearSelection),ma.set(this.cancelButton,"aria-label",this.nls.clearSelection))},onConfigChanged:function(){this.inherited(arguments);this._onCancelButtonClicked()},
_onCancelButtonClicked:function(){if(this.attrInspector){if(this.attrInspector.layerInfos){var c=q.getInstanceSync();g.forEach(this.attrInspector.layerInfos,function(H){var K=H.featureLayer;K.clearSelection();K.refresh();var S=H.featureLayer.url;H.featureLayer.hasOwnProperty("originalLayerId")&&(layID=H.featureLayer.originalLayerId,H.id!=layID&&(K=H.featureLayer,K.clearSelection(),K.refresh(),H=c.getLayerOrTableInfoById(layID),H.layerObject&&(S=H.layerObject.url)));if(S){var V=S.split("/FeatureServer")[0];
g.forEach(c.getLayerInfoArray(),function(aa){"undefined"!==typeof aa.layerObject.url&&null!==aa.layerObject.url&&aa.layerObject.url.includes("/MapServer")&&aa.layerObject.url.includes(V)&&aa.layerObject.refresh()},this)}})}this.attrInspector.destroy()}f.destroy(this.contentWrapper);f.destroy(this.buttonHeader);this.navButtonsDiv&&f.destroy(this.navButtonsDiv);if(this._attributeInspectorCollection&&0<this._attributeInspectorCollection.length){var r=this._attributeInspectorCollection.pop();r&&(this.attrInspector=
r)}this._traversal&&0<this._traversal.length&&this._traversal.pop();0<this._buttonsWrapper.length&&(this.buttonHeader=this._buttonsWrapper.pop());this._setCancelButtonText();this._unLockMapNavigation();if(this._nodesCollection&&0<this._nodesCollection.length){r=this._nodesCollection.pop();var y=this._paginationNodeCollection.pop();if(r){b.remove(r,"hidden");b.remove(this.buttonHeader,"hidden");a.set(this.attrInspector.attributeTable,"display","block");a.set(this.attrInspector.editButtons,"display",
"block");void 0!==this.attrInspector._attachmentEditor&&null!==this.attrInspector._attachmentEditor&&a.set(this.attrInspector._attachmentEditor.domNode,"display","block");a.set(this.attrInspector.deleteBtn.domNode,"display","none");this.attrInspector._featureIdx=this.attrInspector.ctStoredFeatureIndex;this.attrInspector.refresh();setTimeout(e.hitch(this,function(){a.set(this.attrInspector.navButtons,"display",!this.attrInspector._hideNavButtons&&1<this.attrInspector._numFeatures?"":"none");this.attrInspector.navMessage.innerHTML=
Ma.substitute({idx:this.attrInspector._featureIdx+1,of:this.attrInspector.NLS_of,numFeatures:this.attrInspector._numFeatures},this.attrInspector._navMessage);this._toggleAttrInspectorNavButtons();this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null;this.attrInspector._selection&&g.forEach(this.attrInspector._selection,e.hitch(this,function(K){K.setSymbol(this._getSelectionSymbol(K.getLayer().geometryType,!1))}));this.currentFeature.preEditAttrs=
m.parse(m.stringify(this.currentFeature.attributes));this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!0));this.currentLayerInfo=this._getLayerInfoByID(this.currentFeature._layer.id);this._relatedTablesInfo&&this._relatedTablesInfo[this.currentFeature._layer.id]&&this._relatedTablesInfo[this.currentFeature._layer.id].updateRelatedRecordsCount();this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||
this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues);if(1>=this._traversal.length){var H;(H=d(".esriCTItemTitle",this.domNode))&&0<H.length&&(H=H[0],H.style.opacity=this.currentFeature&&this.currentFeature.geometry&&this.currentFeature._layer.visibleAtMapScale?"1":"0.3")}this.currentFeature.hasOwnProperty("allowDelete")?this._toggleDeleteButton(this.currentFeature.allowDelete&&
this.currentLayerInfo.allowDelete):this._toggleDeleteButton(this.currentLayerInfo.allowDelete);this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&2>this._traversal.length&&this._editGeomSwitch.domNode&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check());1<=this._traversal.length&&this._setWidgetFirstFocusNode("AI",!0);this.loading.show();this._createSmartAttributes();this._createAttributeInspectorTools();
this._attributeInspectorTools&&this._attributeInspectorTools.triggerFormValidation();this._validateAttributes();setTimeout(e.hitch(this,function(){!this.attrInspector._attachmentEditor||this.currentLayerInfo.isEditable&&this._getEditFlagValue(this.currentLayerInfo)||this._disableAttachments(this.attrInspector._attachmentEditor,!0,!1);this.loading.hide()}),1E3)}),200);this.contentWrapper=r;this.navButtonsDiv=y;return}}this._attrInspIsCurrentlyDisplayed&&!0===this._attrInspIsCurrentlyDisplayed&&this.attrInspector&&
0===this.attrInspector._numFeatures&&(this._showTemplate(!0),this._setWidgetFirstFocusNode("templatePicker",!0));this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this._removeLayerVisibleHandler()},_createCoordinatesPopup:function(){this._coordinates=new gb({map:this.map,nls:this.nls,config:this.config,geometryService:this.geometryService});n(this._coordinates,"gotoSelectedLocation",e.hitch(this,function(c){this._getUpdatedLocation(c).then(e.hitch(this,function(r){this.currentFeature.setGeometry(r);
this.map.centerAt(r);this.geometryEdited()}),function(){})}))},_getUpdatedLocation:function(c){var r=new M;var y=parseFloat(c.firstPoint);var H=parseFloat(c.secondPoint);"Map Spatial Reference"===c.coordinateSystem?(c=new Oa(y,H,this.map.spatialReference),r.resolve(c)):(c=new Oa(H,y,new Sa(4326)),Na.getProjectedGeometry(c,this.map.spatialReference,this.geometryService).then(e.hitch(this,function(K){r.resolve(K)}),function(){}));return r.promise},_toggleAttrInspectorNavButtons:function(){var c;d(".esriAttrPaginationDiv")&&
this._traversal&&(c=d(".esriAttrPaginationDiv")[this._traversal.length-1]);c&&(this.attrInspector&&1<this.attrInspector._selection.length?(a.set(c,"display","block"),c.nextElementSibling&&(a.set(c.nextElementSibling,"max-height","calc(100% - 65px)"),a.set(c.nextElementSibling,"margin-top","5px"))):(a.set(c,"display","none"),c.nextElementSibling&&(a.set(c.nextElementSibling,"max-height","calc(100% - 40px)"),a.set(c.nextElementSibling,"margin-top","0px"))))},startup:function(){this.inherited(arguments);
this._updatedDrawingOptions();if(this.appConfig.geometryService){this.geometryService=new hb(this.appConfig.geometryService);"TabTheme"===this.appConfig.theme.name&&b.add(this.domNode.parentElement,"esriCTOverridePanelStyle");this._createOverDef=new M;this._getSelectedThemeColor();this.config.editor.hasOwnProperty("displayPresetTop")&&!0===this.config.editor.displayPresetTop&&C.place("presetFieldsTableDiv","templatePickerDiv","before");k.subscribe("smartEditor/validate",e.hitch(this,this._validateEventHandler));
this._progressDiv=f.create("div",{"class":"processing-indicator-panel"});var c=this.getParent().domNode.parentNode;c.insertBefore(this._progressDiv,c.firstChild);this.widgetActiveIndicator=f.create("div",{"class":"widgetActive widgetIndicator"});c.insertBefore(this.widgetActiveIndicator,c.firstChild);void 0===this.config.editor.editDescription||null===this.config.editor.editDescription||"\x3cbr\x3e"===this.config.editor.editDescription?(this.config.editor.editDescription="",this.templateTitle.innerHTML=
this.config.editor.editDescription,a.set(this.templateTitle,"display","none"),ma.set(this.templateTitle,"tabindex","-1")):(c=this.editorXssFilter.sanitize(this.config.editor.editDescription),this.templateTitle.innerHTML=Ra.decode(c),ma.set(this.templateTitle,"aria-label",Aa.stripHTML(this.config.editor.editDescription)),a.set(this.templateTitle,"display","block"),a.set(this.templateTitle,"font-size","11pt"),ma.set(this.templateTitle,"tabindex","0"));this._orignls=t.widgets.attachmentEditor.NLS_attachments;
this.loading=new Xa({hidden:!0});this.loading.placeAt(this.domNode);this.attachmentloading=new Xa({hidden:!0});this.loading.placeAt(this.domNode);this.editToolbar=new L(this.map);this.drawToolbar=new z(this.map);setTimeout(e.hitch(this,function(){this._createDrawingToolbar()}),200);this.own(n(this.editToolbar,"graphic-move-stop, rotate-stop, scale-stop, vertex-move-stop, vertex-click",e.hitch(this,this.geometryEdited)));this.own(n(this.drawToolbar,"draw-complete",e.hitch(this,function(r){r.geometry&&
r.geometry.rings&&1===r.geometry.rings.length&&4>r.geometry.rings[0].length||(this.drawToolbar.deactivate(),this._addGraphicToLocalLayer(r))})));this.privilegeUtil=fb.getInstance();this._setTheme();this.shelter.show();q.getInstance(this.map,this.map.itemInfo).then(e.hitch(this,function(r){r.traversalLayerInfosOfWebmap(function(H){H.getLayerObject()});var y="BoxTheme"===this.appConfig.theme.name?1050:1;this._jimuLayerInfos=r;this._updateConfiguredLayersInfos(this.config.editor.layerInfos).then(e.hitch(this,
function(){setTimeout(e.hitch(this,function(){this.initialLoad=!0;this.privilegeUtil.loadPrivileges(this._getPortalUrl()).then(e.hitch(this,function(H){var K=!0;this._user=null;var S=db.getPortal(this.appConfig.portalUrl),V=this.privilegeUtil.getUser();this._validateUserInfoAndLocator(S).then(e.hitch(this,function(aa){this.canGeocode=aa;H?V&&(this._user=V.username,K=this._initControl(r)):K=this._initControl(r);this.initialLoad=!1}));!1===K&&this._noPrivilegeHandler(window.jimuNls.noEditPrivileges);
this.shelter.hide()}),e.hitch(this,function(){this.initialLoad=!1;this._initControl(r)}));this.shelter.hide();this._workBeforeCreate()}),y)}))}))}else B({message:this.nls.geometryServiceURLNotFoundMSG})},_validateUserInfoAndLocator:function(c){var r=new M;if(this._isLocatorRequired())if(this._isEsriLocator(this.config.geocoderSettings.url))if(this._isEsriLocator(this.config.geocoderSettings.url)&&this._isPortalUser(c)){var y=new Za.Portal("https://www.arcgis.com");this._promptUserForLogin(y).then(e.hitch(this,
function(H){r.resolve(H)}))}else this.privilegeUtil.getUser()?this._checkUserPrivileges(this.privilegeUtil.getUser())?this._hasCredits(this.privilegeUtil.getUser(),c)?this._validateLocatorURL().then(e.hitch(this,function(H){this.userToken=c.credential.token;r.resolve(H)})):(new B({message:Ia.substitute(this.nls.noCreditsOrPrivilegeWarningMessage,{widgetName:this.label})}),r.resolve(!1)):(new B({message:Ia.substitute(this.nls.noCreditsOrPrivilegeWarningMessage,{widgetName:this.label})}),r.resolve(!1)):
(y=new Za.Portal("https://www.arcgis.com"),this._promptUserForLogin(y).then(e.hitch(this,function(H){r.resolve(H)})));else r.resolve(!0);else r.resolve(!1);return r.promise},_checkUserPrivileges:function(c){var r=!1;c&&c.privileges&&-1!==c.privileges.indexOf("premium:user:geocode")&&-1!==c.privileges.indexOf("premium:user:geocode:stored")&&(r=!0);return r},_isPortalUser:function(c){return c.isPortal},_isLocatorRequired:function(){var c=!1;this.config.hasOwnProperty("geocoderSettings")&&this.config.geocoderSettings&&
this.config.geocoderSettings.url&&(c=this._isAddressAttributeActionEnabled());return c},_isAddressAttributeActionEnabled:function(){var c=!1;this.config.hasOwnProperty("attributeActionGroups")&&0<Object.keys(this.config.attributeActionGroups.Address).length?c=!0:this.config.editor.hasOwnProperty("layerInfos")&&g.some(this.config.editor.layerInfos,e.hitch(this,function(r){if(r.fieldValues)for(var y in r.fieldValues)for(var H=0;H<r.fieldValues[y].length;H++){var K=r.fieldValues[y][H];if(K&&"Address"===
K.actionName&&K.enabled)return c=!0}}));return c},_promptUserForLogin:function(c){var r=new M,y=!0,H=new Ka({titleLabel:this.nls.loginPopupTitle,width:400,maxHeight:200,autoHeight:!0,content:Ia.substitute(this.nls.loginPopupMessage,{widgetName:this.label}),buttons:[{label:this.nls.yes,classNames:["jimu-btn"],onClick:e.hitch(this,function(){y=!1;H.close();this._loginUser(c,!0).then(e.hitch(this,function(K){r.resolve(K)}))})},{label:this.nls.no,classNames:["jimu-btn"],onClick:e.hitch(this,function(){H.close()})}],
onClose:e.hitch(this,function(){y&&(new B({message:this.nls.unableToUseLocator}),r.resolve(!1))})});return r.promise},_loginUser:function(c,r){var y=new M;r?c.signIn().then(e.hitch(this,function(){var H=c.getPortalUser();H&&this._checkUserPrivileges(H)?this._hasCredits(H,c)?this._validateLocatorURL().then(e.hitch(this,function(K){this.userToken=H.credential.token;y.resolve(K)})):(new B({message:Ia.substitute(this.nls.noCreditsOrPrivilegeWarningMessage,{widgetName:this.label})}),y.resolve(!1)):(new B({message:Ia.substitute(this.nls.noCreditsOrPrivilegeWarningMessage,
{widgetName:this.label})}),y.resolve(!1))}),e.hitch(this,function(){new B({message:this.nls.unableToUseLocator});y.resolve(!1)})):y.resolve(!1);return y.promise},_validateLocatorURL:function(){var c=new M;if(""!==this.config.geocoderSettings.url){var r=l({url:this.config.geocoderSettings.url,content:{f:"json"},handleAs:"json"});r.then(function(){c.resolve(!0)},e.hitch(this,function(){c.resolve(!1);new B({message:this.nls.unableToUseLocator})}))}else c.resolve(!1),new B({message:this.nls.locatorDisabledWaning});
return c.promise},_hasCredits:function(c,r){var y=0;c&&c.hasOwnProperty("availableCredits")?y=c.availableCredits:r&&r.hasOwnProperty("availableCredits")&&(y=r.availableCredits);return y},_isEsriLocator:function(c){this._esriLocatorRegExp.lastIndex=0;return this._esriLocatorRegExp.test(c)},geometryEdited:function(){var c=!1,r=!1;this.config.editor.hasOwnProperty("autoSaveAttrUpdates")&&this.config.editor.autoSaveAttrUpdates&&this.currentLayerInfo&&!this.currentLayerInfo.isCache&&(c=!0);this._refreshButton&&
this.config.editor.enableAttributeUpdates&&this.config.editor.enableAutomaticAttributeUpdates&&(b.remove(this._refreshButton,"hidden"),b.contains(this._refreshButton,"esriCTAutoUpdateOnMode")&&(this._refreshAttributes(),r=!0));this.geometryChanged=!0;this._enableAttrInspectorSaveButton(this._validateAttributes());!r&&c&&this._autoSaveFeatureEdits()},_noPrivilegeHandler:function(c){this.templateTitle.innerHTML=c;ma.set(this.templateTitle,"aria-label",c);a.set(this.templateTitle,"display","block");
ma.set(this.templateTitle,"tabindex","0");this.templatePicker&&(C.style(this.templatePicker.domNode,"display","none"),this._mapClick&&(this._mapClick.remove(),this._mapClick=null));this.drawingTool&&C.style(this.drawingTool.domNode,"display","none");this.presetFieldsTableDiv&&C.style(this.presetFieldsTableDiv,"display","none");Aa.initFirstFocusNode(this.domNode,this.templateTitle);Aa.initLastFocusNode(this.domNode,this.templateTitle);Aa.focusFirstFocusNode(this.domNode);this.map.setInfoWindowOnClick(!0);
this.shelter.hide()},_getPortalUrl:function(c){return c?Va.getStandardPortalUrl(c):Va.getStandardPortalUrl(this.appConfig.portalUrl)},feature_action_select:function(c,r){r&&c&&0!==c.length&&!this.promptedUserToShowSelectionInAI&&("active"!==this.state&&this.widgetManager.activateWidget(this),c=c[0],this._validateFeatureChanged()&&this.currentFeature?this.config.editor.displayPromptOnSave&&!0===this.config.editor.displayPromptOnSave?(this.pendingSelectAction=!0,this._promptToResolvePendingEdit(!1,
{featureLayer:r,feature:c},!1,!0)):this.load_from_featureaction(r,c):this.load_from_featureaction(r,c))},load_from_featureaction:function(c,r){this.pendingSelectAction=!1;this._clearLayerSelection();this.contentWrapper&&this.contentWrapper.parentNode&&!b.contains(this.contentWrapper,"hidden")&&(this.contentWrapper.parentNode.removeChild(this.contentWrapper),d(".esriAttrPaginationDiv",this.domNode).forEach(e.hitch(this,function(y){f.destroy(y)})));this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=
[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;this.map.infoWindow.hide();0<this.viewedLayerDetails.length?(this.loading.show(),c=this._getLayerInfoByID(this.viewedLayerDetails.shift()),r=this.viewedFeatureDetails.shift(),this._traverseToSelectedFeature(c,r)):c&&r&&this._traverseToSelectedFeature(c,r)},_clearLayerSelection:function(){this._attributeInspectorCollection&&0<this._attributeInspectorCollection.length&&
g.forEach(this._attributeInspectorCollection,function(r){if(r){if(r.layerInfos){var y=q.getInstanceSync();g.forEach(r.layerInfos,function(H){var K=H.featureLayer;K.clearSelection();K.refresh();var S=H.featureLayer.url;H.featureLayer.hasOwnProperty("originalLayerId")&&(layID=H.featureLayer.originalLayerId,H.id!=layID&&(K=H.featureLayer,K.clearSelection(),K.refresh(),H=y.getLayerInfoById(layID),H.layerObject&&(S=H.layerObject.url)));if(S){var V=S.split("/FeatureServer")[0];g.forEach(y.getLayerInfoArray(),
function(aa){"undefined"!==typeof aa.layerObject.url&&null!==aa.layerObject.url&&aa.layerObject.url.includes("/MapServer")&&aa.layerObject.url.includes(V)&&aa.layerObject.refresh()},this)}})}r.destroy()}});if(this.attrInspector){if(this.attrInspector.layerInfos){var c=q.getInstanceSync();g.forEach(this.attrInspector.layerInfos,function(r){var y=r.featureLayer;!y.isQueryable()&&0<=y.graphics.length&&y.remove(y.graphics[0]);y.clearSelection();y.refresh();var H=r.featureLayer.url;r.featureLayer.hasOwnProperty("originalLayerId")&&
(layID=r.featureLayer.originalLayerId,r.id!=layID&&(y=r.featureLayer,y.clearSelection(),y.refresh(),(r=c.getLayerInfoById(layID))&&r.layerObject&&(H=r.layerObject.url)));if(H){var K=H.split("/FeatureServer")[0];g.forEach(c.getLayerInfoArray(),function(S){"undefined"!==typeof S.layerObject.url&&null!==S.layerObject.url&&S.layerObject.url.includes("/MapServer")&&S.layerObject.url.includes(K)&&S.layerObject.refresh()},this)}})}this.attrInspector.destroy()}},_traverseToSelectedFeature:function(c,r){var y=
new M;if(0<this.viewedFeatureDetails.length){var H=this.viewedFeatureDetails[0];this.viewedLayerDetails[0]===this.viewedLayerDetails[1]&&(H=this.viewedFeatureDetails[1])}this.loading.show();this._createAttributeInspector([c],!1,null,y,H);r&&Wa.getInstance().setSelection(c.featureLayer,r).then(e.hitch(this,function(){this.updateFeatures=c.featureLayer.getSelectedFeatures();0<this.updateFeatures.length&&this._showTemplate(!1)}));setTimeout(e.hitch(this,function(){y.then(e.hitch(this,function(){if(0<
this.viewedLayerDetails.length){var K=this.viewedLayerDetails.shift();this.viewedFeatureDetails.shift();0<this.viewedLayerDetails.length&&this.viewedLayerDetails[0]===K&&(this.viewedLayerDetails.shift(),this.viewedFeatureDetails.shift());(K=d("[layerid\x3d'"+K+"']",this.contentWrapper)[0])&&K.click()}0===this.viewedLayerDetails.length&&setTimeout(e.hitch(this,function(){this.loading.hide()}),1500)}))}),1E3)},_getFeatureIndexToSelect:function(c){var r=-1;var y=c.attributes[c._layer.objectIdField];
g.some(this.attrInspector._selection,e.hitch(this,function(H,K){if(H.attributes[H._layer.objectIdField]===y)return r=K,!0}));return r},beginEditingByFeatures:function(c,r,y,H){this._copyFeaturesObj&&(this.currentDrawType=null,this._copyFeaturesObj.cancelBtnClicked());this.cacheLayer&&this.cacheLayer.clear();this.viewedLayerDetails=y;this.viewedFeatureDetails=H;r&&c&&0!==c.length&&this._createOverDef.then(e.hitch(this,function(){setTimeout(e.hitch(this,function(){this.feature_action_select(c,r)}),
this.initialLoad?500:0)}))},onReceiveData:function(c,r,y,H){if(this.config.editor)if("MyLocation"===c&&y.hasOwnProperty("geoLocationResult"))this._moveToGPSDef&&(y.geoLocationResult?this._moveToGPSDef.resolve(y.geoLocationResult):this._fetchCurrentLocation()),this._myLocationInfoDef&&(y.geoLocationResult?this._myLocationInfoDef.resolve(y.geoLocationResult):this._fetchCurrentLocation());else{var K=new M;this.config.editor.displayPromptOnSave&&this.currentFeature&&this._validateFeatureChanged()?(this.pendingSelectAction=
!0,this._promptToResolvePendingEdit(!1,null,!1,!0).then(e.hitch(this,function(){K.resolve()}),function(){K.resolve()})):K.resolve();K.then(e.hitch(this,function(){var S=!0;if(("Select"===c||"AttributeTable"===c)&&y&&y.hasOwnProperty("selectionInfo"))for(var V in y.selectionInfo)y.selectionInfo[V]&&0<y.selectionInfo[V].length&&(S=!1);"Select"!==c&&"AttributeTable"!==c||!y||!y.hasOwnProperty("selectionInfo")||this._attrInspIsCurrentlyDisplayed?("Select"===c||"AttributeTable"===c)&&y&&y.hasOwnProperty("selectionInfo")&&
this._attrInspIsCurrentlyDisplayed&&(this._refreshLayer(),S?this._hideAIForNoFeaturesInSelection():1<this._traversal.length?(this._attrInspIsCurrentlyDisplayed=!1,this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv),g.forEach(this._paginationNodeCollection,e.hitch(this,function(aa){f.destroy(aa)})),g.forEach(this._attributeInspectorCollection,function(aa){aa.destroy()}),this.attrInspector&&this.attrInspector.destroy(),this._navigateToMain(!0),
setTimeout(e.hitch(this,function(){this.fetchDataByName("Select")}),100)):this._toggleAttrInspectorNavButtons(),this.updateFeatures=this.attrInspector._selection):(V=this._getFeaturesToBeSelectedInAI(y.selectionInfo),this._refreshLayer(),S?(S=d(".jimu-widget-smartEditor .templatePickerMainDiv"),"none"===a.get(this.noFeatureWarningMessage,"display")&&S&&"block"!==a.get(S[0],"display")&&this._hideAIForNoFeaturesInSelection()):this.initialLoad&&0<Object.keys(V.selectionInfo).length?(this.promptedUserToShowSelectionInAI=
!0,this._promptUserToShowSelectionInAI(V.selectionInfo,V.layers)):this._showAttributeInspector(V.selectionInfo,V.layers))}));this.config.editor.hasOwnProperty("listenToGF")&&!0===this.config.editor.listenToGF&&"GroupFilter"===c&&(Array.isArray(y.message)?0<y.message.length&&g.forEach(y.message,e.hitch(this,function(S){S.hasOwnProperty("fields")&&S.hasOwnProperty("values")&&(S.hasOwnProperty("groupName")?this._setPresetValueValue(null,S.values[0],S.groupName):g.forEach(S.fields,function(V){this._setPresetValueValue(V,
S.values[0],null)},this))})):y.message.hasOwnProperty("fields")&&y.message.hasOwnProperty("values")&&(y.message.hasOwnProperty("groupName")?this._setPresetValueValue(null,y.message.values[0],y.message.groupName):g.forEach(y.message.fields,function(S){this._setPresetValueValue(S,y.message.values[0],null)},this)))}},_hideAIForNoFeaturesInSelection:function(){C.query(".jimu-widget-smartEditor .attributeInspectorMainDiv")[0].style.display="none";this._attrInspIsCurrentlyDisplayed=!1;a.set(this.noFeatureWarningMessage,
"display","block");g.forEach(this.attrInspector.layerInfos,function(c){c=c.featureLayer;c.clearSelection();c.refresh()});this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv);g.forEach(this._paginationNodeCollection,e.hitch(this,function(c){f.destroy(c)}));this._setWidgetFirstFocusNode("noFeatures",!0)},_getFeaturesToBeSelectedInAI:function(c){var r={},y=[];g.forEach(this.config.editor.configInfos,e.hitch(this,function(H){if(H._orgConfiguredEditFlag&&
H._isEditableByUser||this._hasAnyEditableLayerInRelation([H]))y.push(H),H.layerInfo.layerObject&&0<H.layerInfo.layerObject.getSelectedFeatures().length&&c[H.layerInfo.id]&&0<c[H.layerInfo.id].length&&(r[H.layerInfo.id]=c[H.layerInfo.id])}));return{selectionInfo:r,layers:y}},_refreshLayer:function(){g.forEach(this.config.editor.configInfos,e.hitch(this,function(c){c.layerInfo.layerObject.refresh()}))},_promptUserToShowSelectionInAI:function(c,r){var y=new Ka({titleLabel:this.nls.showSelectionInAITitle,
width:400,maxHeight:200,autoHeight:!0,content:Ia.substitute(this.nls.showSelectionInAIMsg,{widgetName:this.label}),buttons:[{label:this.nls.yes,classNames:["jimu-btn"],onClick:e.hitch(this,function(){this.promptedUserToShowSelectionInAI=!1;this._showAttributeInspector(c,r);y.close()})},{label:this.nls.no,classNames:["jimu-btn"],onClick:e.hitch(this,function(){this.promptedUserToShowSelectionInAI=!1;y.close()})}]})},_showAttributeInspector:function(c,r){if(0<Object.keys(c).length){this.updateFeatures=
[];this._createAttributeInspector(r);for(var y in c){r=this._jimuLayerInfos.getLayerInfoById(y);var H=new F;H.objectIds=c[y];r.layerObject.selectFeatures(H,T.SELECTION_NEW,e.hitch(this,function(K){this.updateFeatures=K;0<this.updateFeatures.length&&!this._attrInspIsCurrentlyDisplayed&&(this._showTemplate(!1),this._setWidgetFirstFocusNode("AI",!0),this._connectLayerSelectionClearedOutside())}),e.hitch(this,function(){this.loading.hide()}))}}else g.forEach(r,e.hitch(this,function(K){K.featureLayer.refresh()}))},
_setTheme:function(){var c;if("DartTheme"===this.appConfig.theme.name)Aa.loadStyleLink("dartOverrideCSS",this.folderUrl+"/css/dartTheme.css",null);else if(c=document.getElementById("dartOverrideCSS"))c.disabled=!0;if("LaunchpadTheme"===this.appConfig.theme.name)Aa.loadStyleLink("launchpadOverrideCSS",this.folderUrl+"/css/launchpadTheme.css",null);else if(c=document.getElementById("launchpadOverrideCSS"))c.disabled=!0;if("DashboardTheme"===this.appConfig.theme.name)Aa.loadStyleLink("dashboardOverrideCSS",
this.folderUrl+"/css/dashboardTheme.css",null);else if(c=document.getElementById("dashboardOverrideCSS"))c.disabled=!0},_mapClickHandler:function(c){if(!0===c&&!1===this._attrInspIsCurrentlyDisplayed){if(this.map.setInfoWindowOnClick(!1),void 0===this._mapClick||null===this._mapClick)this._mapClick=n(this.map,"click",e.hitch(this,this._onMapClick))}else!0===c&&!0===this._attrInspIsCurrentlyDisplayed?(this._mapClick&&(this._mapClick.remove(),this._mapClick=null),this.map.setInfoWindowOnClick(!0)):
(this._mapClick&&(this._mapClick.remove(),this._mapClick=null),this.map.setInfoWindowOnClick(!0),this.drawToolbar&&this.drawToolbar.deactivate())},destroy:function(){this.inherited(arguments);this.attrInspector&&(this.attrInspector.layerInfos&&g.forEach(this.attrInspector.layerInfos,function(r){r=r.featureLayer;r.clearSelection();r.refresh()}),this.attrInspector.destroy());this.attrInspector=null;this.templatePicker&&this.templatePicker.destroy();this.templatePicker=null;this.currentDrawType&&(this.currentDrawType=
null);if(null!==this._menus&&void 0!==this._menus){for(var c in Fa)this._menus.hasOwnProperty(c)&&null!==this._menus[c]&&void 0!==this._menus[c]&&this._menus[c].destroyRecursive(!1);this._menus={}}null!==this.drawingTool&&void 0!==this.drawingTool&&(this.drawingTool.destroyRecursive(!1),this.drawingTool=null);this._enableFeatureReduction();this._removeLocalLayers();this._copyFeaturesObj&&this._copyFeaturesObj.highlightGraphicsLayer&&this._copyFeaturesObj.highlightGraphicsLayer.clear();this._copyFeaturesObj&&
this._copyFeaturesObj.fieldsMappingObj&&this._copyFeaturesObj.fieldsMappingObj.fieldsPopup&&this._copyFeaturesObj.fieldsMappingObj.fieldsPopup.close();this.inherited(arguments)},onActive:function(){if(!0===this._userHasPrivilege&&(b.contains(this.widgetActiveIndicator,"widgetNotActive")&&b.remove(this.widgetActiveIndicator,"widgetNotActive"),b.add(this.widgetActiveIndicator,"widgetActive"),this.map&&(this._disableFeatureReduction(),this.templatePicker&&this.templatePicker.update(),this._mapClickHandler(!0),
this._disconnectLayerSelectionClearedOutside(),!1===this._attrInspIsCurrentlyDisplayed))){var c=null;this.drawingTool&&this.currentDrawType&&(c=this.currentDrawType);this._activateTemplateToolbar(c)}},_enableFeatureReduction:function(){!1===this.clusterState&&(g.forEach(this.featureReductionEnabledLayers,function(c){c.isFeatureReductionEnabled()||c.enableFeatureReduction()}),g.forEach(this.rendererDifferentLayers,function(c){c._layerRenderer&&(c.setRenderer(c._layerRenderer),c.redraw())}),this.clusterState=
!0)},_disableFeatureReduction:function(){!0===this.clusterState&&(g.forEach(this.featureReductionEnabledLayers,function(c){c.isFeatureReductionEnabled()&&c.disableFeatureReduction()}),g.forEach(this.rendererDifferentLayers,function(c){c._serviceRendererJson&&(c.setRenderer(bb.fromJson(c._serviceRendererJson)),c.redraw())}),this.clusterState=!1)},_handleLayerSelectionClear:function(c){c&&c.layerInfos&&g.forEach(c.layerInfos,e.hitch(this,function(r){if(r.featureLayer){var y=n(r.featureLayer,"selection-clear",
e.hitch(this,this._onLayerSelectionCleared));this.own(y);r=n(r.featureLayer,"selection-complete",e.hitch(this,function(){this._attrInspIsCurrentlyDisplayed&&0===this.attrInspector._numFeatures&&(d(".jimu-widget-smartEditor .attributeInspectorMainDiv")[0].style.display="none",this._attrInspIsCurrentlyDisplayed=!1,a.set(this.noFeatureWarningMessage,"display","block"),this._setWidgetFirstFocusNode("noFeatures",!0),this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv),
g.forEach(this._paginationNodeCollection,e.hitch(this,function(H){f.destroy(H)})))}));this.own(r);this._layerClearSelectionHandles.push(y);this._layerSelectionCompleteHandles.push(r)}}))},_onLayerSelectionCleared:function(c){this._LayerSelectionClearedTimer&&clearTimeout(this._LayerSelectionClearedTimer);this._LayerSelectionClearedTimer=setTimeout(e.hitch(this,function(){if(!this._layerChangedOutside){this._layerChangedOutside=!0;this.noFeatureWarningMessage&&a.set(this.noFeatureWarningMessage,"display",
"none");var r={},y=[];g.forEach(this.attrInspector.layerInfos,e.hitch(this,function(H){y.push(H);0<H.featureLayer.getSelectedFeatures().length&&(r[H.featureLayer.id]=this._getFeatureOIDArray(H.featureLayer,H.featureLayer.getSelectedFeatures()));c.target.id===H.featureLayer.id&&H.featureLayer.refresh()}));this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv);g.forEach(this._paginationNodeCollection,e.hitch(this,function(H){f.destroy(H)}));
g.forEach(this._attributeInspectorCollection,function(H){H.destroy()});this.attrInspector&&this.attrInspector.destroy();0<Object.keys(r).length&&1===this._traversal.length?this._showAttributeInspector(r,y):this._navigateToMain()}}),100)},_getFeatureOIDArray:function(c,r){var y=[];g.forEach(r,e.hitch(this,function(H){y.push(Number(H.attributes[c.objectIdField]))}));return y},_navigateToMain:function(c){this._attrInspIsCurrentlyDisplayed=!1;c||this._showTemplatePicker();this._traversal=[];this._nodesCollection=
[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null},_connectLayerSelectionClearedOutside:function(){this._layerChangedOutside=!1;this._disconnectLayerSelectionClearedOutside();this._attrInspIsCurrentlyDisplayed&&(this._attributeInspectorCollection&&0<this._attributeInspectorCollection.length&&g.forEach(this._attributeInspectorCollection,e.hitch(this,
function(c){c&&this._handleLayerSelectionClear(c)})),this.attrInspector&&this._handleLayerSelectionClear(this.attrInspector))},_disconnectLayerSelectionClearedOutside:function(){this._layerClearSelectionHandles&&0<this._layerClearSelectionHandles.length&&g.forEach(this._layerClearSelectionHandles,e.hitch(this,function(c){c.remove()}));this._layerSelectionCompleteHandles&&0<this._layerSelectionCompleteHandles.length&&g.forEach(this._layerSelectionCompleteHandles,e.hitch(this,function(c){c.remove()}));
this._layerClearSelectionHandles=[];this._layerSelectionCompleteHandles=[]},onDeActive:function(){b.contains(this.widgetActiveIndicator,"widgetActive")&&b.remove(this.widgetActiveIndicator,"widgetActive");b.add(this.widgetActiveIndicator,"widgetNotActive");this.map&&this._mapClickHandler(!1);this._enableFeatureReduction();this._connectLayerSelectionClearedOutside()},onOpen:function(){!0===this._userHasPrivilege&&(this._workBeforeCreate(),setTimeout(e.hitch(this,function(){this.widgetManager.activateWidget(this)}),
100));if(this.templatePicker){var c;this.templatePicker.update();(c=d(".esriTemplatePicker",this.domNode))&&c[0]&&("none"===a.get(c[0],"display")?d(".presetFieldsTableDiv")[0].style.display="none":this.config.hasOwnProperty("attributeActionGroups")&&0<Object.keys(this.config.attributeActionGroups.Preset).length&&!b.contains(d(".ee-presetValueTableDiv",this.domNode)[0],"esriCTHidden")&&(d(".presetFieldsTableDiv")[0].style.display="block"),this._attrInspIsCurrentlyDisplayed?this._setWidgetFirstFocusNode("AI",
!0):this._setWidgetFirstFocusNode("templatePicker",!0))}},_addNewLayersInConfig:function(){var c=[],r=[];g.forEach(this.config.editor.configInfos,e.hitch(this,function(y){c.push(y.featureLayer.id)}));g.forEach(this._jimuLayerInfos.getLayerInfoArray(),e.hitch(this,function(y){if(-1===c.indexOf(y.id)&&y.layerObject.url&&"Feature Layer"===y.layerObject.type&&this._isValidLayer(y)){var H={};H=ia.createDefaultConfigInfo(y);!this._isNewLayerAddedInWebMap(H)&&H._editFlag&&(H.layerInfo=y,H.configFeatureLayer=
H.featureLayer,H.featureLayer=H.layerInfo.layerObject,H.allowDelete=H.configFeatureLayer.layerAllowsDelete||!1,r.push(H))}}));0<r.length&&(r.reverse(),g.forEach(r,e.hitch(this,function(y){this.config.editor.configInfos.splice(0,0,y)})))},_isNewLayerAddedInWebMap:function(c){var r=!1;g.some(this._jimuLayerInfos.getLayerInfoArrayOfWebmap(),e.hitch(this,function(y){if(y.id===c.featureLayer.id)return r=!0}));return r},_getTableInfos:function(){var c=[],r=this._jimuLayerInfos.getTableInfoArray();g.forEach(r,
function(y){c.push(y.getLayerObject())},this);return E(c)},_getIntersectionUtils:function(){var c=20;this.config.editor.hasOwnProperty("defaultPixelsTolerance")&&(c=this.config.editor.defaultPixelsTolerance);return new jb({_jimuLayerInfos:this._jimuLayerInfos,map:this.map,defaultToleranceSettings:this.config.editor.defaultToleranceSettings,defaultPixelsTolerance:c})},_initControl:function(c){this._userHasPrivilege=!0;this.own(n(this._jimuLayerInfos,"layerInfosChanged",e.hitch(this,function(r,y){if(!this.config.editor.hasOwnProperty("editAddDataLayers")||
!0===this.config.editor.editAddDataLayers){var H=!1;if("added"===y){if(y=this._doesLayerExist(r.id).layerExist,-1===r.id.indexOf("_lfl")&&"Feature Layer"===r.layerObject.type&&r.layerObject.url&&!y&&this._isValidLayer(r)){var K={},S;K=ia.createDefaultConfigInfo(r);K._editFlag&&(K.layerInfo=r,K.configFeatureLayer=K.featureLayer,K.featureLayer=K.layerInfo.layerObject,K.allowDelete=K.configFeatureLayer.layerAllowsDelete||!1,K.showDeleteButton=!1,this.config.editor.configInfos.splice(0,0,K),H=!0,this.own(n(K.featureLayer,
"visibility-change, scale-visibility-change",e.hitch(this,function(){this._layerScaleClearedTimer&&clearTimeout(this._layerScaleClearedTimer);this._layerScaleClearedTimer=setTimeout(e.hitch(this,function(){this._createEditor(!1)}),200)}))))}}else"removed"===y&&g.some(this.config.editor.configInfos,e.hitch(this,function(V,aa){if(V.featureLayer.id===r.id)return S=r,this.config.editor.configInfos.splice(aa,1),H=!0,this.attrInspector&&this._attrInspIsCurrentlyDisplayed&&this._removeFeaturesFromAI(r.id),
!0}));H&&(this.templatePicker?this._getEditableLayers(this.config.editor.configInfos).then(e.hitch(this,function(V){V&&0===V.length?(this._creationDisabledOnAll=!0,this._showOrHideMainScreenTools(!0),this.drawToolbar&&this.drawToolbar.deactivate(),this.templatePicker&&(this._mapClickHandler(!0),this._clearTemplateSelection()),this._checkForLayersInTemplatePicker()):(this._creationDisabledOnAll=!1,this._showOrHideMainScreenTools(!1),this._isPresetTableCreated||this._createPresetTable(this.config.editor.configInfos),
this.templatePicker.attr("featureLayers",V),this.templatePicker.update(),this.templatePicker.clearSelection())})):this._createEditor(),!0===this.config.editor.useFilterEditor&&this.templatePicker&&this._filterEditor&&(K?this._filterEditor.addNewLayerInEditor(K.featureLayer):this._filterEditor.removeLayerFromEditor(S)),this._setWidgetFirstFocusNode("templatePicker",!0))}})));this._getTableInfos();this.addressUtils=new ib({config:this.config,canGeocode:this.canGeocode,nls:this.nls,userToken:this.userToken,
appConfig:this.appConfig});this._intersectionUtils=this._getIntersectionUtils();c=!1;this.config.editor&&this.config.editor.layerInfos&&(c=0<this.config.editor.layerInfos.length);this.config.editor.hasOwnProperty("honorWebMapConfiguration")&&this.config.editor.honorWebMapConfiguration&&(c=!1);this.config.editor.configInfos=ia.getConfigInfos(this._jimuLayerInfos,this.config.editor.layerInfos,!1,c);!1===c&&g.forEach(this.config.editor.configInfos,function(r){r._editFlag=!0});this.config.editor.hasOwnProperty("editAddDataLayers")&&
!0===this.config.editor.editAddDataLayers&&this._addNewLayersInConfig();this.config.editor.hasOwnProperty("honorWebMapConfiguration")&&this.config.editor.honorWebMapConfiguration&&g.forEach(this.config.editor.configInfos,e.hitch(this,function(r){this._updateConfigWithDefaultWebMapSettings(r)}));if(void 0===this.config.editor.configInfos||null===this.config.editor.configInfos||0===this.config.editor.configInfos.length)return!1;this._processConfig();g.forEach(this.config.editor.configInfos,function(r){r.featureLayer.name=
r.layerInfo.title;r=r.featureLayer;var y=r.renderer,H=y.toJson(),K=m.parse(r._json);K.hasOwnProperty("layerDefinition")&&(K=K.layerDefinition);var S=null;K.hasOwnProperty("drawingInfo")&&K.drawingInfo.hasOwnProperty("renderer")&&(S=K.drawingInfo.renderer);r._layerRenderer=y;r._serviceRendererJson=S;r.hasFeatureReduction&&r.hasFeatureReduction()?this.featureReductionEnabledLayers.push(r):H.hasOwnProperty("type")&&"heatmap"==H.type&&this.rendererDifferentLayers.push(r)},this);this._disableFeatureReduction();
this.config.editor.hasOwnProperty("autoSaveEdits")?this.config.editor.autoSaveEdits&&((this._autoSaveRuntime=this.config.editor.autoSaveEdits)?ca.byId("autoSaveSwitch").set("checked",!0):ca.byId("autoSaveSwitch").set("checked",!1)):this.config.editor.autoSaveEdits=!1;this._createEditor();this.fetchDataByName("GroupFilter");this.widgetManager.activateWidget(this);this._createOverDef.resolve();this._setWidgetFirstFocusNode("templatePicker",!0);this.fetchDataByName("Select");this.fetchDataByName("AttributeTable");
return!0},_showOrHideMainScreenTools:function(c){var r=c?"none":"block";this.templatePicker&&(C.style(this.templatePicker.domNode,"display",r),this.config.editor.autoSaveEdits&&this._createAutoSaveSwitch(!c));this.drawingTool&&C.style(this.drawingTool.domNode,"display",r);this._filterEditor&&C.style(this._filterEditor.domNode,"display",r);this._isPresetTableCreated&&(d(".presetFieldsTableDiv")[0].style.display=r)},_doesLayerExist:function(c){var r=!1,y;g.some(this.config.editor.configInfos,e.hitch(this,
function(H){if(H.featureLayer.id===c)return r=!0,y=H,!0}));return{layerExist:r,layerInfo:y}},_isValidLayer:function(c){var r=!1;c.layerObject&&c.layerObject.infoTemplate&&g.some(c.layerObject.infoTemplate.info.fieldInfos,e.hitch(this,function(y){if(this._isValidField(c,y)&&y.visible)return r=!0}));return r},_isValidField:function(c,r){c=c.layerObject.getField(r.fieldName);r=!1;c&&"esriFieldTypeGeometry"!==c.type&&"esriFieldTypeOID"!==c.type&&"esriFieldTypeBlob"!==c.type&&"esriFieldTypeGlobalID"!==
c.type&&"esriFieldTypeRaster"!==c.type&&"esriFieldTypeXML"!==c.type&&(r=!0);return r},_removeFeaturesFromAI:function(c){var r=new F;var y=this._getLayerAndFeaturesToRemove(c);r.objectIds=y.objectIds;this.AINext.pause();0<y.objectIds.length?y.layer.selectFeatures(r,T.SELECTION_SUBTRACT,e.hitch(this,function(){setTimeout(e.hitch(this,function(){-1<this._traversal.indexOf(c)&&this._traversal.pop();this.AINext.resume();this._refreshLayerTitle()}),500)},function(){setTimeout(e.hitch(this,function(){this.AINext.resume();
this._refreshLayerTitle()}),500)})):this.currentLayerInfo.isCache&&c===this.currentLayerInfo.featureLayer.id&&(this.AINext.resume(),this._showTemplate(!0))},_getLayerAndFeaturesToRemove:function(c){var r,y=[];(this._attributeInspectorCollection&&this._attributeInspectorCollection[0]||this.attrInspector)._selection.forEach(e.hitch(this,function(H){H._layer.id===c&&(r=H._layer,y.push(H.attributes[r.objectIdField]))}));return{layer:r,objectIds:y}},_updateConfigWithDefaultWebMapSettings:function(c,r){r&&
(c.layerInfo=this._jimuLayerInfos.getLayerOrTableInfoById(c.featureLayer.id));var y=ia.createDefaultConfigInfo(c.layerInfo);e.mixin(c,y);c.fieldInfos=ia.getDefaultEditableFieldInfos(c.layerInfo,!1);c.fieldInfos=g.filter(c.fieldInfos,function(H){return"esriFieldTypeBlob"===H.type||"esriFieldTypeGlobalID"===H.type||"esriFieldTypeRaster"===H.type||"esriFieldTypeXML"===H.type||"esriFieldTypeOID"===H.type?!1:!0});c.allowDelete=y.featureLayer.layerAllowsDelete;r&&(c.configFeatureLayer=c.featureLayer,c.featureLayer=
c.layerInfo.layerObject,c.showDeleteButton=!1);c.relationshipInfos&&g.forEach(c.relationshipInfos,e.hitch(this,function(H){this._updateConfigWithDefaultWebMapSettings(H,!0)}))},_addFilterEditor:function(c){if(!0===this.config.editor.useFilterEditor&&this.templatePicker)if(this._filterEditor)this._filterEditor.setTemplatePicker(this.templatePicker,c);else{var r=!1;this.config.editor.hasOwnProperty("groupFilteredTemplates")&&(r=this.config.editor.groupFilteredTemplates);this._filterEditorNode=f.create("div",
{});this.templatePickerDiv.insertBefore(this._filterEditorNode,this.templatePicker.domNode);this._filterEditor=new eb({_templatePicker:this.templatePicker,_layers:c,map:this.map,nls:this.nls,gpFilterTemplates:r},this._filterEditorNode)}},_activateEditToolbar:function(c){var r=c.getLayer();0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate();switch(r.geometryType){case "esriGeometryPoint":this.editToolbar.activate(L.MOVE,c);break;case "esriGeometryPolyline":case "esriGeometryPolygon":this.editToolbar.activate(L.EDIT_VERTICES|
L.MOVE|L.ROTATE|L.SCALE,c)}},_polygonToPolyline:function(c){var r=new da;g.forEach(c.rings,function(y){r.addPath(y)});r.spatialReference=c.spatialReference;return r},_addRelatedFeatureToLocalLayer:function(c,r){var y,H=null;this.attrInspector&&this.attrInspector._attachmentUploader&&null!==this.attrInspector._attachmentUploader&&this.attrInspector._attachmentUploader.clear();this._removeLocalLayers();this.cacheLayer=this._cloneLayer(c.featureLayer.layerObject);var K=n(this.cacheLayer,"load",e.hitch(this,
function(){K.remove();H=this._getLayerInfoForLocalLayer(this.cacheLayer);y=[H];this._createAttributeInspector([H],!0,c.featureLayer.layerObject,null,null,r);var S=e.clone(c.attributes);this._usePresetValues&&this._modifyAttributesWithPresetValues(S,y[0],null,r);var V=new Q(null,null,S);V.preEditAttrs=m.parse(m.stringify(V.attributes));this.cacheLayer.applyEdits([V],null,null,e.hitch(this,function(aa){var fa=new F;fa.objectIds=[aa[0].objectId];this.cacheLayer.selectFeatures(fa,T.SELECTION_NEW,e.hitch(this,
function(){this.currentFeature=this.updateFeatures[0]=V;this.getConfigDefaults();this.geometryChanged=!1;this._attributeInspectorTools&&this._attributeInspectorTools.triggerFormValidation();var ka=this.currentFeature.getLayer();this.currentLayerInfo=this._getLayerInfoByID(ka.id);this.currentLayerInfo.isCache=!0;this._toggleDeleteButton(!1);this._enableAttrInspectorSaveButton(this._validateAttributes(),!0);this._toggleAttrInspectorNavButtons()}))}));this._showTemplate(!1,!1);this.config.editor.hasOwnProperty("autoSaveEdits")&&
!0===this._autoSaveRuntime&&setTimeout(e.hitch(this,function(){this._autoSaveFeatureEdits()}),100)}))},_getCopyAttributes:function(c,r,y){var H=[],K={};var S=new M;var V=new M;var aa=!1,fa=!1,ka=!1,ea;for(ea in c.fieldValues){for(var la=c.fieldValues[ea],oa=0;oa<la.length;oa++)"Address"===la[oa].actionName&&la[oa].enabled&&(aa=!0),"Intersection"===la[oa].actionName&&la[oa].enabled&&(fa=!0),"Coordinates"===la[oa].actionName&&la[oa].enabled&&la[oa].hasOwnProperty("coordinatesSource")&&"myLocation"===
la[oa].coordinatesSource&&(ka=!0);if(aa&&fa&&ka)break}fa&&(y?(y=this._getIntersectionUtils(),H.push(y.getDistinctLayers(c,r))):H.push(this._intersectionUtils.getDistinctLayers(c,r)));H.push(V);Na.getCoordinatesData(r,this.geometryService).then(e.hitch(this,function(ua){K.Coordinates=ua;this._getMyLocationInfo(ka).then(e.hitch(this,function(wa){K.MyLocation=wa;aa?this.addressUtils.locateAddress(ua.MapSpatialReference).then(e.hitch(this,function(Ba){K.Address=Ba;V.resolve(K)})):(K.Address={},V.resolve(K))}))}),
e.hitch(this,function(){K.Coordinates={};K.Address={};K.MyLocation={Coordinates:{}};V.resolve(K)}));E(H).then(e.hitch(this,function(ua){fa?(K.Intersection=ua[0].result,K.multipleValues=ua[0].multipleValues):(K.Intersection={},K.multipleValues=void 0);S.resolve(K)}));return S.promise},_getMyLocationInfo:function(c){var r=new M,y={Coordinates:{}};if(this._myLocationInfoForMultipleFeatures)return r.resolve(this._myLocationInfoForMultipleFeatures),r;c?(this._myLocationInfoDef=new M,this._getNewCurrentLocation(),
this._myLocationInfoDef.then(e.hitch(this,function(H){this._myLocationInfoDef=null;if(H.error&&H.error.message)console.log(H.error.message),r.resolve(y);else if(H&&H.graphic&&H.graphic.geometry){var K=H.graphic.geometry;"NaN"!==H.graphic.geometry.x&&"NaN"!==H.graphic.geometry.y?Na.getCoordinatesData(K,this.geometryService).then(function(S){y.Coordinates=S;r.resolve(y)}):(H=H.graphic.attributes.position.coords,Na.getCoordinatesDataWhenXYEmpty({x:H.longitude,y:H.latitude}).then(function(S){y.Coordinates=
S;r.resolve(y)}))}}),e.hitch(this,function(){r.resolve(y)}))):r.resolve(y);return r},_addGraphicToLocalLayer:function(c,r){var y=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeDouble","esriFieldTypeSingle"];if(void 0!==this.templatePicker&&null!==this.templatePicker&&this.templatePicker.getSelected()){var H=this.templatePicker.getSelected(),K,S=null;this.attrInspector&&(this.attrInspector._attachmentUploader&&null!==this.attrInspector._attachmentUploader&&this.attrInspector._attachmentUploader.clear(),
this.attrInspector.destroy(),this.attrInspector=null);this._removeLocalLayers();this.cacheLayer=this._cloneLayer(this.templatePicker.getSelected().featureLayer);var V=n(this.cacheLayer,"load",e.hitch(this,function(){V.remove();this.cacheLayer.setSelectionSymbol(this._getSelectionSymbol(this.cacheLayer.geometryType,!0));S=this._getLayerInfoForLocalLayer(this.cacheLayer);K=[S];this._createAttributeInspector([S],!0,this.templatePicker.getSelected().featureLayer);this.config.editor.hasOwnProperty("editGeometryDefault")&&
!0===this.config.editor.editGeometryDefault&&setTimeout(e.hitch(this,function(){2>this._traversal.length&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check())}),100);var aa={};H&&H.template&&H.template.prototype&&H.template.prototype.attributes&&(aa=e.clone(H.template.prototype.attributes));"esriGeometryPolyline"===this.cacheLayer.geometryType&&"polygon"===c.geometry.type&&(c.geometry=this._polygonToPolyline(c.geometry));this.loading.show();this._getCopyAttributes(S,c.geometry).then(e.hitch(this,
function(fa){if(r){var ka=e.clone(r),ea=H.featureLayer.id;if(c.layer&&c.layer.id)var la=c.layer.id;if(la&&this.fieldMappingDetails[ea]&&this.fieldMappingDetails[ea][la]){for(var oa in this.fieldMappingDetails[ea][la])aa.hasOwnProperty(oa)||(aa[oa]=null);for(var ua in aa){var wa,Ba;if((!aa.hasOwnProperty(ua)||null===aa[ua]||this.config.editor.overrideDefaultsByCopiedFeature)&&(Ba=this.fieldMappingDetails[ea][la][ua])&&ka.hasOwnProperty(Ba)){var va=this.templatePicker.getSelected().featureLayer.getField(ua);
this._jimuLayerInfos.getLayerInfoById(la)&&this._jimuLayerInfos.getLayerInfoById(la).layerObject&&(wa=this._jimuLayerInfos.getLayerInfoById(la).layerObject.getField(Ba));wa&&wa.domain&&wa.domain.codedValues&&!va.domain?g.some(wa.domain.codedValues,e.hitch(this,function(ta){if(ta.code===ka[Ba])return-1!==y.indexOf(va.type)?aa[ua]=ta.code:aa[ua]=ta.name,!0})):wa&&"esriFieldTypeDate"===wa.type&&"esriFieldTypeDate"!==va.type&&ka[Ba]?(oa=this._getPopupFieldInfo(Ba,this._jimuLayerInfos.getLayerInfoById(la)),
aa[ua]=Aa.getDateTimeStrByFieldInfo(ka[Ba],oa)):aa[ua]=ka[Ba]}}}else for(var ya in ka)if(!aa.hasOwnProperty(ya)||null===aa[ya]||this.config.editor.overrideDefaultsByCopiedFeature)aa[ya]=ka[ya]}this._modifyAttributesWithPresetValues(aa,K[0],fa);this.loading.hide();var Ca=new Q(c.geometry,null,aa);Ca.preEditAttrs=m.parse(m.stringify(Ca.attributes));this.cacheLayer.applyEdits([Ca],null,null,e.hitch(this,function(ta){var za=new F;za.objectIds=[ta[0].objectId];this.cacheLayer.selectFeatures(za,T.SELECTION_NEW,
e.hitch(this,function(){this.currentFeature=this.updateFeatures[0]=Ca;this.getConfigDefaults();this.geometryChanged=!1;this._attributeInspectorTools&&this._attributeInspectorTools.triggerFormValidation();var Ea=this.currentFeature.getLayer();this.currentLayerInfo=this._getLayerInfoByID(Ea.id);this.currentLayerInfo.isCache=!0;this._toggleDeleteButton(!1);this._enableAttrInspectorSaveButton(this._validateAttributes());(Ea=d(".esriAttrPaginationDiv",this.domNode))&&Ea[0]&&a.set(Ea[0],"display","none");
setTimeout(e.hitch(this,function(){this._addValuePicker(fa)}),200)}))}));this._showTemplate(!1,!1);this.config.editor.hasOwnProperty("autoSaveEdits")&&!0===this._autoSaveRuntime&&setTimeout(e.hitch(this,function(){this._autoSaveFeatureEdits()}),100)}))}))}},_cancelEditingFeature:function(c){this.currentFeature&&(c?this._showTemplate(!0,!1):(this.currentFeature.preEditAttrs&&(this.currentFeature.attributes=m.parse(m.stringify(this.currentFeature.preEditAttrs))),this.currentFeature.origGeom&&(this.currentFeature.geometry=
Z.fromJson(this.currentFeature.origGeom)),this.currentFeature.getLayer().refresh(),this.attrInspector.refresh(),this._resetEditingVariables()))},_addDateFormat:function(c){c&&c.format&&null!==c.format&&c.format.dateFormat&&null!==c.format.dateFormat&&0<=c.format.dateFormat.toString().toUpperCase().indexOf("TIME")&&(c.format.time=!0)},_processLayerFields:function(c){g.forEach(c,function(r){void 0!==r.domain&&null!==r.domain&&void 0!==r.domain.type&&null!==r.domain.type&&"range"===r.domain.type&&!1===
r.domain.hasOwnProperty("range")&&(r.domain.range=[r.domain.minValue,r.domain.maxValue])});return c},_iterateCollection:function(c){return function(r){for(var y=0;c[y];y++)r(c[y],y)}},_cloneLayer:function(c){var r=this._processLayerFields(c.fields);r={layerDefinition:{id:0,name:c.name+this.nls.editorCache,type:"Feature Layer",displayField:c.displayField,description:"",copyrightText:"",relationships:[],geometryType:c.geometryType,minScale:0,maxScale:0,extent:c.fullExtent,drawingInfo:{renderer:c.renderer,
transparency:0,labelingInfo:null},hasAttachments:c.hasAttachments,htmlPopupType:"esriServerHTMLPopupTypeAsHTMLText",objectIdField:c.objectIdField,globalIdField:c.globalIdField,typeIdField:c.typeIdField,fields:g.map(r,function(H){return-1<H.name.indexOf("expression/expr")?H:H.toJson()}),types:c.types&&g.map(c.types,function(H){return H.toJson()}),templates:c.templates&&g.map(c.templates,function(H){return H.toJson()}),capabilities:"Create,Delete,Query,Update,Uploads,Editing",editFieldsInfo:void 0===
c.editFieldsInfo?null:c.editFieldsInfo}};var y=c.fields.map(function(H){return H.name});this._eventHandler=this.own(n(c,"visibility-change",e.hitch(this,function(){})));r=new T(r,{id:c.id+"_lfl",outFields:y});r.visible=!0;r.renderer=c.renderer;r.originalLayerId=c.id;r._wabProperties={isTemporaryLayer:!0};this.map.addLayer(r);return r},_endsWith:function(c,r){return-1!==c.indexOf(r,c.length-r.length)},_validateEventHandler:function(){this._enableAttrInspectorSaveButton(this._validateAttributes())},
_validateAttributes:function(c){c="undefined"!==typeof c&&null!==c?c:!0;var r=[],y=!0,H=this._validateRequiredFields(),K=this._validateFeatureChanged(),S=[],V=!0;void 0!==this._smartAttributes&&null!==this._smartAttributes&&(S=this._smartAttributes.toggleFields(c));void 0!==this._attributeInspectorTools&&null!==this._attributeInspectorTools&&(V=this._attributeInspectorTools.formValid());K&&this.currentLayerInfo&&this.currentLayerInfo.attachmentValidations&&(g.forEach(this.currentLayerInfo.attachmentValidations.Actions,
e.hitch(this,function(aa){var fa={};aa.filter&&this._smartAttributes&&(fa.actionType=aa.actionName,fa.result=this._smartAttributes.processFilter(aa.filter),r.push(fa))})),this.attrInspector._attachmentUploader?y=this.performAction(this.attrInspector._attachmentUploader,r,!0):this.attrInspector._attachmentEditor&&(y=this.performAction(this.attrInspector._attachmentEditor,r,!1)));return ia.isObjectEmpty(H)&&0===S.length&&V&&K&&y},performAction:function(c,r,y){var H=!0;a.set(this.attrInspector.attachmentsRequiredMsg,
"display","none");g.some(r,e.hitch(this,function(K){switch(K.actionType){case "Hide":if(K.result)return this.currentAction=K.actionType,c.currentAction=K.actionType,a.set(c.domNode,"display","none"),!0;a.set(c.domNode,"display","block");break;case "Disabled":if(K.result)return this.currentAction=K.actionType,c.currentAction=K.actionType,y?a.set(c.domNode,"display","none"):this._disableAttachments(c,!0,y),!0;this._disableAttachments(c,!1,y);a.set(c.domNode,"display","block");break;case "Required":if(K.result)return this.currentAction=
K.actionType,c.currentAction=K.actionType,a.set(c.domNode,"display","block"),this._hasAddedAnyAttachments(c,y)?(H=!0,a.set(this.attrInspector.attachmentsRequiredMsg,"display","none")):(H=!1,a.set(this.attrInspector.attachmentsRequiredMsg,"display","block")),!0;this.currentAction=null;c.currentAction=null}}));this._setWidgetFirstFocusNode("AI",!1);return H},_disableAttachments:function(c,r,y){var H=r?"none":"block";y||(r=this.attrInspector._attachmentEditor.domNode,d(".attwarning",r)[0]&&a.set(d(".attwarning",
r)[0],"display",H),a.set(c._uploadForm,"display",H),g.forEach(c._attachmentList.childNodes,e.hitch(this,function(K){"#text"!==K.nodeName&&(K=d(".deleteAttachment",K)[0])&&a.set(K,"display",H)})))},_onUpdateAttachmentListAdd508Support:function(){this.attrInspector&&this.attrInspector._attachmentEditor&&x.after(this.attrInspector._attachmentEditor,"_updateConnects",e.hitch(this,function(){this._add508SupportToAttachmentsDeleteBtn()}))},_add508SupportToAttachmentsDeleteBtn:function(){this._support508ToDeleteButtonTimer&&
clearInterval(this._support508ToDeleteButtonTimer);this._support508ToDeleteButtonTimer=setInterval(e.hitch(this,function(){clearInterval(this._support508ToDeleteButtonTimer);this.attrInspector._attachmentEditor&&this.attrInspector._attachmentEditor._attachmentList&&g.forEach(this.attrInspector._attachmentEditor._attachmentList.childNodes,e.hitch(this,function(c){if("#text"!==c.nodeName){var r=d(".deleteAttachment",c)[0];r&&(ma.set(r,"role","button"),ma.set(r,"tabindex","0"),ma.set(r,"aria-label",
this.nls.deleteAttachment),this.own(n(r,"keydown",e.hitch(this,function(y){y.keyCode!==p.ENTER&&y.keyCode!==p.SPACE||r.click()}))))}}))}),300)},_hasAddedAnyAttachments:function(c,r){var y=!1;if(!r)return 0<c._attachmentList.childNodes.length&&"#text"!==c._attachmentList.childNodes[0].nodeName?!0:!1;for(r=0;r<c._attachmentList.childNodes.length;r++)if(c._attachmentList.childNodes[r].childNodes&&0<c._attachmentList.childNodes[r].childNodes.length&&c._attachmentList.childNodes[r].childNodes[1].value&&
0<c._attachmentList.childNodes[r].childNodes[1].value.length){y=!0;break}return y},_getEditFlagValue:function(c,r){var y=!1;c.hasOwnProperty("_orgConfiguredEditFlag")?(y=c._orgConfiguredEditFlag,r&&(y=c._orgConfiguredEditFlag&&c._isEditableByUser)):y=c._editFlag;return y},_toggleEditGeoSwitch:function(c){var r=!1;void 0===this._editGeomSwitch||null===this._editGeomSwitch||1<this._traversal.length||(!1===c&&this.currentLayerInfo.featureLayer.visibleAtMapScale?this.currentLayerInfo&&this._getEditFlagValue(this.currentLayerInfo,
!0)?(C.style(this._editGeomSwitch.domNode.parentNode,"display","block"),r=!0):(C.style(this._editGeomSwitch.domNode.parentNode,"display","none"),r=!1):(C.style(this._editGeomSwitch.domNode.parentNode,"display","none"),r=!1),this._turnEditGeometryToggleOff(),setTimeout(e.hitch(this,function(){r=r&&this._editGeomSwitch.checked;this._toggleAttributeButtonVisibility(r);this._toggleLocateButtonVisibility(r);this._toggleXYCoordinatesButtonVisibility(r);this._toggleMapNavigationButtonVisibility(r)}),500))},
_recordLoadeAttInspector:function(){this.getConfigDefaults()},editGeoCheckChange:function(){return function(){this._editGeometry(this._editGeomSwitch.checked)}},_attributeInspectorChangeRecord:function(c){this._validateFeatureChanged()&&this.currentFeature?this.currentLayerInfo.isCache&&(this.currentLayerInfo.isCache=!1):this._postFeatureSave(c);this._recordLoadeAttInspector()},_addWarning:function(){if(0===d(".attwarning",this.attrInspector.domNode).length){var c=f.create("div",{"class":"attwarning"});
c.innerHTML=this.nls.attachmentSaveDeleteWarning;void 0!==this.attrInspector._attachmentEditor&&null!==this.attrInspector._attachmentEditor&&this.attrInspector._attachmentEditor.domNode.appendChild(c)}},_hasAnyEditableLayerInRelation:function(c){var r=!1;g.forEach(c,e.hitch(this,function(y){if(r)return!0;this._getEditFlagValue(y,!0)?r=!0:y.relationshipInfos&&0<y.relationshipInfos.length&&(r=this._hasAnyEditableLayerInRelation(y.relationshipInfos))}));return r},_processRelationAndShowAttrInspector:function(c,
r,y,H,K,S){var V;this.contentWrapper&&this.contentWrapper.parentNode&&!b.contains(this.contentWrapper,"hidden")&&(this.contentWrapper.parentNode.removeChild(this.contentWrapper),this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv));this.contentWrapper=f.create("div",{"class":"detailsContainer"},this.mainContainer);this.navButtonsDiv=f.create("div",{"class":"esriAttributeInspector esriAttrPaginationDiv"});S||(f.place(this.attrInspector.navButtons,
this.navButtonsDiv,"first"),f.place(this.navButtonsDiv,this.mainContainer,"before"));var aa=f.create("div",{"class":"esriCTItemListContainer"},this.contentWrapper);r&&r.feature&&(y=r.feature._layer,this.currentFeature&&1>=this._traversal.length&&this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!1)),this.currentFeature=r.feature,this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes)),this.currentLayerInfo=this._getLayerInfoByID(y.id),
this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!0)),this._toggleDeleteButton(this.attrInspector._currentLInfo.allowDelete),this.loading.show(),setTimeout(e.hitch(this,function(){this.attrInspector&&this.attrInspector._attachmentEditor&&(!this.currentLayerInfo.isEditable||!this._getEditFlagValue(this.currentLayerInfo)||this.currentLayerInfo&&!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate)&&this._disableAttachments(this.attrInspector._attachmentEditor,
!0,!1);this.loading.hide()}),2E3),setTimeout(e.hitch(this,function(){this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&2>this._traversal.length&&this.currentFeature&&this.currentFeature.geometry&&(this.currentFeature.origGeom=this.currentFeature.geometry.toJson(),!this.currentLayerInfo.disableGeometryUpdate&&this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate&&(!this.currentLayerInfo.featureLayer.hasZ||
this.currentLayerInfo.featureLayer.hasZ&&this.currentLayerInfo.featureLayer.enableZDefaults)&&(!this.currentLayerInfo.featureLayer.hasM||this.currentLayerInfo.featureLayer.hasM&&this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues)?b.contains(this.widgetActiveIndicator,"widgetActive")&&this._activateEditToolbar(this.currentFeature):0!==this.editToolbar.getCurrentState().tool&&(this.editToolbar.deactivate(),this._editingEnabled=!1))}),1E3));y&&(V=this.addItem(y.name,this.config.editor.expandMainLayerOnLoad,
aa,y.id,S,y,!0));if(c&&r.feature){0<this._traversal.length?this._traversal[this._traversal.length-1]=r.feature._layer.id:this._traversal.push(r.feature._layer.id);y=this._getRelationshipInfo(r.feature);c={attributes:e.clone(r.feature.attributes),_layer:r.feature._layer};if(K){var fa=[];g.forEach(K,function(ea){fa.push(ea.attributes[ea._layer.objectIdField])})}if(y&&0<y.length){var ka=[];g.forEach(y,e.hitch(this,function(ea){var la=ea._editFlag;!ea._editFlag&&ea.relationshipInfos&&0<ea.relationshipInfos.length&&
(la=this._hasAnyEditableLayerInRelation(ea.relationshipInfos));la&&ea.featureLayer&&ea.hasOwnProperty("relationshipId")&&ka.push(ea)}));0<ka.length&&((K=d(".esriCTItemContent",aa))&&K[0]&&b.remove(K[0],"esriCTRelatedItemContent"),this._relatedTablesInfo[r.feature._layer.id]={},this._relatedTablesInfo[r.feature._layer.id]=new na({relationshipInfo:ka,layerInfosObj:this._jimuLayerInfos,parentFeature:c,parentFeatureIndexInAI:this.attrInspector._featureIdx,parentFieldInfos:this.currentLayerInfo.fieldInfos,
config:this.config,nls:this.nls,mapSpatialReference:this.map.spatialReference},f.create("div")),this.own(n(this._relatedTablesInfo[r.feature._layer.id],"addRelatedRecord",e.hitch(this,function(ea,la,oa,ua,wa){b.add(this.contentWrapper,"hidden");b.add(this.buttonHeader,"hidden");a.set(this.navButtonsDiv,"display","none");this.attrInspector.ctStoredFeatureIndex=ua;this._attributeInspectorCollection.push(this.attrInspector);this._nodesCollection.push(this.contentWrapper);this._buttonsWrapper.push(this.buttonHeader);
this._paginationNodeCollection.push(this.navButtonsDiv);this._traversal.push(oa);this.currentRelatedDom=la;this._addRelatedFeatureToLocalLayer(ea,wa);this._addingNewRelatedRecord=!0}))),this.own(n(this._relatedTablesInfo[r.feature._layer.id],"titleClicked",e.hitch(this,function(ea,la,oa,ua,wa,Ba){this.addNewRelatedRecord&&(oa=!0,this.addNewRelatedRecord=!1);this._editGeomSwitch.set("checked",!1);!oa&&this.currentFeature&&this.config.editor.displayPromptOnSave&&this._validateFeatureChanged()?this._promptToResolvePendingEdit(!1,
null,!0).then(e.hitch(this,function(){this._fetchRelatedRecords(oa,r.feature._layer,la,ea,wa,ua,fa,Ba);fa=null}),function(){}):this.pendingSelectAction?(this._attrInspIsCurrentlyDisplayed=!1,this.navButtonsDiv&&this.navButtonsDiv.parentNode&&this.navButtonsDiv.parentNode.removeChild(this.navButtonsDiv),g.forEach(this._paginationNodeCollection,e.hitch(this,function(va){f.destroy(va)})),g.forEach(this._attributeInspectorCollection,function(va){va.destroy()}),this.pendingSelectAction=!1):(this._fetchRelatedRecords(oa,
r.feature._layer,la,ea,wa,ua,fa,Ba),fa=null)}))),this.own(n(this._relatedTablesInfo[r.feature._layer.id],"addRelatedItemContent",e.hitch(this,function(ea){ea?this.addItem(this.nls.relatedItemTitle,this.config.editor.expandRelatedTableOnLoad,aa,null,!1,null,!1):(ea=d(".esriCTItemContent",aa))&&ea[0]&&b.add(ea[0],"esriCTRelatedItemContent")}))),this._relatedTablesInfo[r.feature._layer.id].startup())}else this.config.editor.expandMainLayerOnLoad||this._togglePanel(V)}H&&H.resolve()},_checkValidRelationShips:function(c,
r){g.forEach(c,e.hitch(this,function(y){y.featureLayer&&y.hasOwnProperty("relationshipId")&&g.some(r.relationships,e.hitch(this,function(H){}))}))},_fetchRelatedRecords:function(c,r,y,H,K,S,V,aa){this._getRelatedRecordsByRelatedQuery(r,y,H,K).then(e.hitch(this,function(fa){if(fa&&0===fa.length)c&&(b.remove(this.contentWrapper,"hidden"),this.attrInspector.refresh(),setTimeout(e.hitch(this,function(){a.set(this.attrInspector.navButtons,"display",!this.attrInspector._hideNavButtons&&1<this.attrInspector._numFeatures?
"":"none");this.attrInspector.navMessage.innerHTML=Ma.substitute({idx:this.attrInspector._featureIdx+1,of:this.attrInspector.NLS_of,numFeatures:this.attrInspector._numFeatures},this.attrInspector._navMessage);this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null;this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes))}),200));else if(b.add(this.contentWrapper,"hidden"),a.set(this.navButtonsDiv,"display",
"none"),this.attrInspector.ctStoredFeatureIndex=S,this._attributeInspectorCollection.push(this.attrInspector),this._nodesCollection.push(this.contentWrapper),this._buttonsWrapper.push(this.buttonHeader),this._paginationNodeCollection.push(this.navButtonsDiv),this._traversal.push(H),V&&(fa=[],fa=V,V=null),fa&&0<fa.length){var ka=new F;ka.objectIds=fa;if(0<this.viewedLayerDetails.length){var ea=new M;fa=this.viewedFeatureDetails[0];this.viewedLayerDetails[0]===this.viewedLayerDetails[1]&&(fa=this.viewedFeatureDetails[1]);
this._createAttributeInspector([this._getLayerInfoByID(H)],!1,null,ea,fa,aa)}else this._createAttributeInspector([this._getLayerInfoByID(H)],!1,null,null,null,aa);fa=this._jimuLayerInfos.getLayerOrTableInfoById(H).layerObject;this.loading.show();fa.selectFeatures(ka,T.SELECTION_NEW,e.hitch(this,function(la){if(this._addingNewRelatedRecord&&this._processBackButtonInNewRelatedRecord||c)this.currentFeature=null;this.updateFeatures=la;c?this.attrInspector.last():this.attrInspector.first();this.currentFeature=
this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:null;this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes));0<this.updateFeatures.length&&this._showTemplate(!1);this._addingNewRelatedRecord&&this._processBackButtonInNewRelatedRecord&&(this._processBackButtonInNewRelatedRecord=this._addingNewRelatedRecord=!1,this._onCancelButtonClicked());this.loading.hide()}),e.hitch(this,function(){this.loading.hide()}));ea&&ea.then(e.hitch(this,
function(){if(0<this.viewedLayerDetails.length){var la=this.viewedLayerDetails.shift();this.viewedFeatureDetails.shift();0<this.viewedLayerDetails.length&&this.viewedLayerDetails[0]===la&&(this.viewedLayerDetails.shift(),this.viewedFeatureDetails.shift());(la=d("[layerid\x3d'"+la+"']",this.contentWrapper))&&0<la.length&&la[0].click()}0===this.viewedLayerDetails.length&&this.loading.hide()}))}}))},_createAttributeInspector:function(c,r,y,H,K,S){if(2>this._traversal.length&&(this._editGeomSwitch&&(this._editGeomSwitch.destroy(),
this._editGeomSwitch=null),this.editSwitchDiv))for(;this.editSwitchDiv.firstChild;)this.editSwitchDiv.removeChild(this.editSwitchDiv.firstChild);this._setCancelButtonText();S&&g.forEach(c[0].fieldInfos,e.hitch(this,function(ea){ea.name===S&&(ea.isEditable=!1)}));this.config.editor.hasOwnProperty("canSwitchToMultilineInput")&&this.config.editor.canSwitchToMultilineInput&&g.forEach(c,e.hitch(this,function(ea){ea.fieldInfos&&g.forEach(ea.fieldInfos,e.hitch(this,function(la){"esriFieldTypeString"===la.type&&
(!la.hasOwnProperty("stringFieldOption")||"textbox"===la.stringFieldOption)&&this.config.editor.maxLimitToMultilineTextBox<la.length&&(la.stringFieldOption="textarea")}))}));this.attrInspector=ia.ATI({layerInfos:c},v.create("div",{style:{width:"100%",height:"100%"}}));this.attrInspector.startup();this._onUpdateAttachmentListAdd508Support();f.place(this.attrInspector.navMessage,this.attrInspector.nextFeatureButton.domNode,"before");if(2>this._traversal.length){this.editSwitchDiv=f.create("div");this.editSwitchDiv.appendChild(f.create("div",
{"class":"spacer"}));this._editGeomSwitch=new pa({id:"editGeometrySwitch_"+this.attrInspector.id,checked:!1,value:this.nls.editGeometry,tabindex:0,label:this.nls.editGeometry},null);ma.set(ca.byId("editGeometrySwitch_"+this.attrInspector.id).domNode,"aria-label",this.nls.editGeometry);this.editSwitchDiv.appendChild(this._editGeomSwitch.domNode);f.place(this.editSwitchDiv,this.attrInspector.deleteBtn.domNode,"before");this.own(n(this._editGeomSwitch,"Change",e.hitch(this,this.editGeoCheckChange())));
this._xyCoordinates=f.create("div",{"class":"esriCTActionButtons esriCTCustomButtons esriCTXYCoordinates esriCTGeometryEditor hidden",title:this.nls.moveSelectedFeatureToXY,tabindex:0,role:"button","aria-label":this.nls.moveSelectedFeatureToXY},this.attrInspector.deleteBtn.domNode,"after");this.own(n(this._xyCoordinates,"click",e.hitch(this,function(){this._createCoordinatesPopup()})));this.own(n(this._xyCoordinates,"keydown",e.hitch(this,function(ea){ea.keyCode!==p.ENTER&&ea.keyCode!==p.SPACE||this._createCoordinatesPopup()})));
this._locateButtonDiv=f.create("div",{"class":"esriCTActionButtons esriCTCustomButtons esriCTLocateButtonContainer esriCTGeometryEditor hidden",title:this.nls.moveSelectedFeatureToGPS,tabindex:0,role:"button","aria-label":this.nls.moveSelectedFeatureToGPS},this.attrInspector.deleteBtn.domNode,"after");this.own(n(this._locateButtonDiv,"keydown",e.hitch(this,function(ea){if(ea.keyCode===p.ENTER||ea.keyCode===p.SPACE)this._moveToGPSDef=new M,this._getNewCurrentLocation(),this._moveToGPSDef.then(e.hitch(this,
this._moveToGPSDefResolved))})));this.own(n(this._locateButtonDiv,"click",e.hitch(this,function(){this._moveToGPSDef=new M;this._getNewCurrentLocation();this._moveToGPSDef.then(e.hitch(this,this._moveToGPSDefResolved))})));this._mapNavigation=f.create("div",{"class":"esriCTActionButtons esriCTCustomButtons esriCTMapNavigationLocked esriCTGeometryEditor hidden",title:this.nls.mapNavigationLocked,tabindex:0,role:"button","aria-label":this.nls.mapNavigationLocked},this.attrInspector.deleteBtn.domNode,
"after");this.own(n(this._mapNavigation,"click",e.hitch(this,this._toggleMapNavigationButtonState)));this.own(n(this._mapNavigation,"keydown",e.hitch(this,function(ea){ea.keyCode!==p.ENTER&&ea.keyCode!==p.SPACE||this._toggleMapNavigationButtonState()})));if(this.config.editor.enableAttributeUpdates){var V="refreshAttributes";var aa=this.nls.refreshAttributes}this.config.editor.enableAutomaticAttributeUpdates&&(V="esriCTAutoUpdateOnMode",aa=this.nls.automaticAttributeUpdatesOn);this._refreshButton=
f.create("div",{"class":V+" esriCTActionButtons esriCTCustomButtons esriCTGeometryEditor hidden",title:aa,tabindex:0,role:"button","aria-label":aa},this.attrInspector.deleteBtn.domNode,"after");this.own(n(this._refreshButton,"click",e.hitch(this,function(){this.config.editor.enableAutomaticAttributeUpdates?this._toggleAttributeButtonState():this._refreshAttributes()})));this.own(n(this._refreshButton,"keydown",e.hitch(this,function(ea){if(ea.keyCode===p.ENTER||ea.keyCode===p.SPACE)this.config.editor.enableAutomaticAttributeUpdates?
this._toggleAttributeButtonState():this._refreshAttributes()})))}f.create("div",{innerHTML:this.nls.save,"class":"esriCTCustomButtons saveButton jimu-btn jimu-state-disabled",style:"visibility: hidden"},this.attrInspector.deleteBtn.domNode,"after");this.buttonHeader&&b.add(this.buttonHeader,"hidden");this.buttonHeader=f.create("div",{"class":"buttonHeader"},this.buttonWrapper);var fa=f.create("div",{innerHTML:this.nls.save,"class":"esriCTCustomButtons saveButton jimu-btn jimu-state-disabled",tabindex:"-1",
role:"button","aria-label":this.nls.save},this.buttonHeader,"last");a.set(this.attrInspector.deleteBtn.domNode,"display","none");1>d(".deleteButton",this.buttonHeader).length&&(V=f.create("div",{innerHTML:this.nls.deleteText,tabindex:"-1",role:"button","aria-label":this.nls.deleteText,"class":"deleteButton jimu-btn jimu-btn-vacation"},fa,"before"),n(V,"click",e.hitch(this,function(){this._onDeleteButtonClick()})),n(V,"keydown",e.hitch(this,function(ea){ea.keyCode!==p.ENTER&&ea.keyCode!==p.SPACE||
this._onDeleteButtonClick()})));this.config.editor.showActionButtonsAbove?a.set(this.mainContainer,"margin-top","5px"):(f.place(this.buttonWrapper,this.mainContainer,"after"),a.set(this.mainContainer,"margin-bottom","5px"),a.set(this.mainContainer,"margin-top","0px"));this.own(n(fa,"click",e.hitch(this,function(){this._validateFeatureChanged()?(this.map.infoWindow.isShowing&&this.map.infoWindow.hide(),b.contains(fa,"jimu-state-disabled")||this._saveEdit(this.currentFeature)):this._resetEditingVariables()})));
this.own(n(fa,"keydown",e.hitch(this,function(ea){if(ea.keyCode===p.ENTER||ea.keyCode===p.SPACE)this._validateFeatureChanged()?(this.map.infoWindow.isShowing&&this.map.infoWindow.hide(),b.contains(fa,"jimu-state-disabled")||this._saveEdit(this.currentFeature)):this._resetEditingVariables()})));x.after(this.attrInspector,"onLayerSelectionChange",e.hitch(this,function(){"active"!==this.state&&(this._LayerSelectionChangedTimer&&clearTimeout(this._LayerSelectionChangedTimer),this._LayerSelectionChangedTimer=
setTimeout(e.hitch(this,function(){this.attrInspector&&this._attrInspIsCurrentlyDisplayed&&this.attrInspector.first()}),500))}));this.attrInspector._attachmentEditor&&(x.after(this.attrInspector._attachmentEditor,"_onDeleteAttachmentComplete",e.hitch(this,function(){this._hasAddedAnyAttachments(this.attrInspector._attachmentEditor,!1)||"Required"!==this.currentAction||a.set(this.attrInspector.attachmentsRequiredMsg,"display","block");this._enableAttrInspectorSaveButton(this._validateAttributes(),
null,!0)})),x.after(this.attrInspector._attachmentEditor,"_onAddAttachmentComplete",e.hitch(this,function(){"block"===a.get(this.attrInspector.attachmentsRequiredMsg,"display")&&a.set(this.attrInspector.attachmentsRequiredMsg,"display","none");this._enableAttrInspectorSaveButton(this._validateAttributes(),null,!0)})),x.after(this.attrInspector._attachmentEditor,"_getAttachments",e.hitch(this,function(){this.attachmentloading.show();setTimeout(e.hitch(this,function(){if(this.currentLayerInfo&&this.currentLayerInfo.attachmentValidations){if(this.currentLayerInfo.attachmentValidations){var ea=
[];g.forEach(this.currentLayerInfo.attachmentValidations.Actions,e.hitch(this,function(la){var oa={};la.filter&&this._smartAttributes&&(oa.actionType=la.actionName,oa.result=this._smartAttributes.processFilter(la.filter),ea.push(oa))}));this.attrInspector._attachmentUploader?this.performAction(this.attrInspector._attachmentUploader,ea,!0):this.performAction(this.attrInspector._attachmentEditor,ea,!1)}!this.attrInspector._attachmentEditor||this.currentLayerInfo.isEditable&&this._getEditFlagValue(this.currentLayerInfo)||
this._disableAttachments(this.attrInspector._attachmentEditor,!0,!1)}this.attachmentloading.hide()}),1500)})));this.own(n(this.attrInspector,"attribute-change",e.hitch(this,function(ea){this.currentFeature&&(this.currentFeature.attributes[ea.fieldName]=ea.fieldValue,this._validateDateTimeField(),this._enableAttrInspectorSaveButton(this._validateAttributes()),this.canAutoUpdate&&this.currentLayerInfo&&!this.currentLayerInfo.isCache&&this.config.editor.hasOwnProperty("autoSaveAttrUpdates")&&this.config.editor.autoSaveAttrUpdates&&
setTimeout(e.hitch(this,function(){this._autoSaveFeatureEdits()}),100))})));this.AINext=this.own(n.pausable(this.attrInspector,"next",e.hitch(this,function(ea){this.currentFeature&&this.config.editor.displayPromptOnSave&&this._validateFeatureChanged()?this.pendingSelectAction||this._promptToResolvePendingEdit(!1,null,!1).then(e.hitch(this,function(){this._processNextButtonClicked(!0,ea,null,H,K)}),function(){}):(this.currentFeature&&(this.currentFeature.preEditAttrs&&(this.currentFeature.attributes=
m.parse(m.stringify(this.currentFeature.preEditAttrs))),this.currentFeature.origGeom&&(this.currentFeature.geometry=Z.fromJson(this.currentFeature.origGeom))),this._processNextButtonClicked(!0,ea,null,H,K))})))[0];this.attrInspector.attachmentsRequiredMsg=f.create("div",{innerHTML:this.nls.attachmentsRequiredMsg,role:"presentation","aria-label":this.nls.attachmentsRequiredMsg.replace("(*)",""),tabindex:"0",style:"display:none;color:red;margin-top:5px"});1===c.length&&c[0].featureLayer.hasOwnProperty("originalLayerId")&&
!0===this._getLayerInfoByID(c[0].featureLayer.originalLayerId).featureLayer.hasAttachments&&(c=f.create("div"),f.place(c,this.attrInspector.attributeTable,"after"),this.attrInspector._attachmentUploader=new ab({"class":"atiAttachmentEditor",attachmentsRequiredMsg:this.attrInspector.attachmentsRequiredMsg,currentAction:this.currentAction,deleteAttachmentText:this.nls.deleteAttachment},c),this.attrInspector._attachmentUploader.startup(),n(this.attrInspector._attachmentUploader,"attachmentAdded",e.hitch(this,
function(){this._enableAttrInspectorSaveButton(this._validateAttributes())})),n(this.attrInspector._attachmentUploader,"attachmentDeleted",e.hitch(this,function(){this._enableAttrInspectorSaveButton(this._validateAttributes())})));if(this.attrInspector._attachmentUploader)var ka=this.attrInspector._attachmentUploader.domNode;else this.attrInspector._attachmentEditor&&(ka=this.attrInspector._attachmentEditor.domNode);ka&&f.place(this.attrInspector.attachmentsRequiredMsg,ka,"before");r&&this._processRelationAndShowAttrInspector(!1,
null,y,null,null,!0);setTimeout(e.hitch(this,function(){this.attrInspector&&this.config.editor.removeOnSave&&0===this.attrInspector._numFeatures?this._setWidgetFirstFocusNode("templatePicker",!0):setTimeout(e.hitch(this,function(){this._attrInspIsCurrentlyDisplayed&&this._setWidgetFirstFocusNode("AI",!0)}),1E3);setTimeout(e.hitch(this,function(){this._validateDateTimeField();this.currentLayerInfo&&this.attrInspector._attachmentEditor&&!this.currentLayerInfo.isCache&&!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate&&
this._disableAttachments(this.attrInspector._attachmentEditor,!0,!1);this.currentLayerInfo&&this.attrInspector&&this.attrInspector._toolTips&&g.forEach(this.attrInspector._toolTips,e.hitch(this,function(ea){var la;this.currentLayerInfo&&!this.currentLayerInfo.isCache&&(la=new pb({connectId:ea.connectId,label:ea.label}));g.forEach(ea.connectId,e.hitch(this,function(oa){-1<oa.indexOf("dijit_form_FilteringSelect")&&(ea.position=["above-centered"],la&&(la.position=["above-centered"]))}))}))}),1500)}),
1E3)},_moveToGPSDefResolved:function(c){this._moveToGPSDef=null;c.error&&c.error.message?B({message:c.error.message}):c&&c.graphic&&c.graphic.geometry&&("NaN"!==c.graphic.geometry.x&&"NaN"!==c.graphic.geometry.y?(this.currentFeature.setGeometry(c.graphic.geometry),this.geometryEdited()):B({message:this.nls.cantLocateUserLocation}))},_onDeleteButtonClick:function(){this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.config.editor.displayPromptOnDelete?this._promptToDelete():this._deleteFeature()},
_validateDateTimeField:function(){var c;this.attrInspector&&this.attrInspector._currentLInfo&&this.attrInspector._currentLInfo.fieldInfos&&g.some(this.attrInspector._currentLInfo.fieldInfos,e.hitch(this,function(r){"esriFieldTypeDate"===r.type&&r.isEditable&&(c=this._getCurrentFieldDijit(r.fieldName))&&1<c.length&&(null===c[0].get("value")||void 0===c[0].get("value")?(c[1].set("value",null),c[1].set("disabled",!0)):(this.currentLayerInfo.isCache||this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate&&
this._getEditFlagValue(this.currentLayerInfo)&&!c[0].get("disabled"))&&c[1].set("disabled",!1))}))},_processNextButtonClicked:function(c,r,y,H,K){this.currentMultipleValues=null;this._removePreviousValuePickerButtons();this._processRelationAndShowAttrInspector(c,r,y,H,K,!1);this._attributeInspectorChangeRecord(r);this._addWarning();this._toggleAttrInspectorNavButtons()},_toggleDeleteButton:function(c){var r=d(".deleteButton",this.buttonHeader);0<r.length&&(r=r[0],!0===c?(r.style.display="block",ma.set(r,
"tabindex","0")):(r.style.display="none",ma.set(r,"tabindex","-1")))},_activateTemplateToolbar:function(c){c=c||null;var r=null;if(this.templatePicker){var y=this.templatePicker.getSelected();if(y&&null!==y){r=y.featureLayer.geometryType;if(void 0!==y.template&&null!==y.template&&void 0!==y.template.drawingTool&&null!==y.template.drawingTool)switch(y.template.drawingTool){case "esriFeatureEditToolNone":switch(y.featureLayer.geometryType){case "esriGeometryPoint":c=null!==c?c:z.POINT;break;case "esriGeometryPolyline":c=
null!==c?c:z.POLYLINE;break;case "esriGeometryPolygon":c=null!==c?c:z.POLYGON}break;case "esriFeatureEditToolPoint":c=null!==c?c:z.POINT;break;case "esriFeatureEditToolLine":c=null!==c?c:z.POLYLINE;break;case "esriFeatureEditToolAutoCompletePolygon":case "esriFeatureEditToolPolygon":c=null!==c?c:z.POLYGON;break;case "esriFeatureEditToolCircle":c=null!==c?c:z.CIRCLE;break;case "esriFeatureEditToolEllipse":c=null!==c?c:z.ELLIPSE;break;case "esriFeatureEditToolRectangle":c=null!==c?c:z.RECTANGLE;break;
case "esriFeatureEditToolFreehand":switch(y.featureLayer.geometryType){case "esriGeometryPoint":c=null!==c?c:z.POINT;break;case "esriGeometryPolyline":c=null!==c?c:z.FREEHAND_POLYLINE;break;case "esriGeometryPolygon":c=null!==c?c:z.FREEHAND_POLYGON}break;default:switch(y.featureLayer.geometryType){case "esriGeometryPoint":c=null!==c?c:z.POINT;break;case "esriGeometryPolyline":c=null!==c?c:z.POLYLINE;break;case "esriGeometryPolygon":c=null!==c?c:z.POLYGON}}else switch(y.featureLayer.geometryType){case "esriGeometryPoint":c=
null!==c?c:z.POINT;break;case "esriGeometryPolyline":c=null!==c?c:z.POLYLINE;break;case "esriGeometryPolygon":c=null!==c?c:z.POLYGON}"EXTENT"!==c&&"POLYGON"!==c&&"FREEHAND_POLYGON"!==c&&this.drawToolbar.activate(c);this._setDrawingToolbar(r,c)}else this.drawToolbar&&(this._setDrawingToolbar("select",null,!0),this.drawToolbar.deactivate())}else this.drawToolbar&&(this._setDrawingToolbar("select",null),this.drawToolbar.deactivate())},_templatePickerNeedsToBeCreated:function(){return!0},_drawingToolClick:function(c,
r){return function(){r.hasOwnProperty("_drawType")&&(this.currentDrawType=r._drawType);!r.hasOwnProperty("_drawType")||"EXTENT"!==r._drawType&&"POLYGON"!==r._drawType&&"FREEHAND_POLYGON"!==r._drawType?"select"!==c&&(this.drawingTool.set("label",r.label),this.drawingTool.set("iconClass",r.iconClass),this._selectTool&&this._selectTool.isActive()&&(this._selectTool.deactivate(),this.map.setInfoWindowOnClick(!1)),r.hasOwnProperty("_drawType")&&this.drawToolbar.activate(r._drawType),this.currentShapeType=
c):(this.drawingTool.set("label",r.label),this.drawingTool.set("iconClass",r.iconClass),this.drawToolbar&&this.drawToolbar.deactivate(),this._selectTool&&(this._selectTool.setFeatureLayers(this._getOrClearSelectableLayers(!1)),this._selectTool._setCurrentGeoInfo(this._getSelectedGeoTypeInfo(r._drawType)),this._selectTool.activate()))}},_menus:{},drawingTool:null,_setDrawingToolbar:function(c,r,y){if(null!==this.drawingTool&&void 0!==this.drawingTool){null!==this.currentShapeType&&void 0!==this.currentShapeType&&
this.currentShapeType===c||this.drawingTool.set("dropDown",this._menus[c]);this.currentShapeType=c;this.currentDrawType=null;g.some(Fa[c],function(H){return H.hasOwnProperty("_drawType")&&H._drawType===r||null===r?(this.drawingTool.set("label",H.label),this.drawingTool.set("iconClass",H.iconClass),this.currentDrawType=H._drawType,!0):!1},this);if(null===this.currentDrawType||void 0===this.currentDrawType)this.drawingTool.set("label",Fa[c][0].label),this.drawingTool.set("iconClass",Fa[c][0].iconClass),
Fa[c][0].hasOwnProperty("_drawType")&&(this.currentDrawType=Fa[c][0]._drawType);this._changeSelectToolState(y)}},_getSelectedGeoTypeInfo:function(c){var r;g.some(this._selectTool._geoTypeInfos,e.hitch(this,function(y){if(y.geoType===c)return r=y,!0}));return r},_createDrawingToolbar:function(){if(this.config.editor.hasOwnProperty("displayShapeSelector")){if(!0===this.config.editor.displayShapeSelector||this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting)this._menus=
this._createDrawingMenus(),this.drawingTool=new sa({label:"",name:"drawingTool",id:"drawingTool"},this.drawingOptionsDiv),this.drawingTool.startup(),this.drawingTool&&this.drawingTool.domNode&&!this.templatePicker&&C.style(this.drawingTool.domNode,"display","none"),this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting&&this._initializeSelectToolWidget(),this._setDrawingToolbar("select",null)}else this.config.editor.displayShapeSelector=
!1,this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&(this.config.editor.createNewFeaturesFromExisting=!1)},_createMenu:function(c){var r=new qa({style:"display: none;"});g.forEach(c,function(y){if(!this.config.editor.displayShapeSelector&&this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&this.config.editor.createNewFeaturesFromExisting){var H=!1;if(y.hasOwnProperty("_drawType")&&("EXTENT"===y._drawType||"POLYGON"===y._drawType||"FREEHAND_POLYGON"===y._drawType)||
"seNewSelection"===y.id||"sePointTool"===y.id||"seDrawPolyline"===y.id||"seDrawPolygon"===y.id)H=!0}else if(H=!0,y.hasOwnProperty("_drawType")&&"EXTENT"===y._drawType||"POLYGON"===y._drawType||"FREEHAND_POLYGON"===y._drawType)H=this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&this.config.editor.createNewFeaturesFromExisting?!0:!1;H&&this._addMenuItem(y,r,c)},this);r.startup();return r},_createDrawingMenus:function(){var c={},r;for(r in Fa)c[r]=this._createMenu(Fa[r]);return c},
_createEditor:function(c){var r=null;void 0!==this.config.editor&&null!==this.config.editor&&this._getEditableLayers(this.config.editor.configInfos).then(e.hitch(this,function(y){if(1>y.length)this._creationDisabledOnAll=!0,this.currentLayerInfo&&!this.currentLayerInfo.isCache&&this._attrInspIsCurrentlyDisplayed&&!0===this._attrInspIsCurrentlyDisplayed&&(this.attrInspector.refresh(),this.attrInspector.first());else if(this._templatePickerNeedsToBeCreated()){if(this._attrInspIsCurrentlyDisplayed&&
!0===this._attrInspIsCurrentlyDisplayed){this._recreateOnNextShow=!0;this.currentLayerInfo.isCache||(this.attrInspector.refresh(),this.attrInspector.first());return}if(this.templatePicker&&null!==this.templatePicker){var H=this.currentDrawType;r=this.templatePicker.getSelected();null===r&&this.drawToolbar&&this.drawToolbar.deactivate();this._select_change_event.remove();this.templatePicker.destroy();this._resetEditingVariables();this.drawToolbar&&this.drawToolbar.deactivate();this.drawingTool&&this._setDrawingToolbar("select",
null,c)}else this._createAutoSaveSwitch(this.config.editor.autoSaveEdits);this.templatePickerNode=f.create("div",{"class":"eeTemplatePicker"});this.templatePickerDiv.appendChild(this.templatePickerNode);this.templatePicker=new u({featureLayers:y,"class":"esriTemplatePicker",grouping:!0,maxLabelLength:"25",showTooltip:!1},this.templatePickerNode);this.templatePicker.startup();ma.set(this.templatePicker.domNode,"tabindex","-1");x.after(this.templatePicker,"update",e.hitch(this,function(){this._handle508AccessibilityForTemplatePicker();
setTimeout(e.hitch(this,function(){this._handle508AccessibilityForTemplatePicker()}),2E3);this._checkForLayersInTemplatePicker()}));this._addFilterEditor(y);if(null!==r&&this.templatePicker){var K=Object.getOwnPropertyNames(this.templatePicker._itemWidgets),S=[];g.forEach(this.templatePicker._flItems,function(V){g.forEach(V,function(aa){S.push(aa)})});S.length===K.length?!1===g.some(S,function(V,aa){if(r.featureLayer.id===V.layer.id&&V.template.name===r.template.name&&V.template.drawingTool===r.template.drawingTool&&
V.template.description===r.template.description&&V.type===r.type)return V=C.byId(K[aa]),n.emit(V,"click",{bubbles:!0,cancelable:!0}),this._activateTemplateToolbar(H),!0},this)&&(this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,c)):(this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,c))}else this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,
c);this._select_change_event=n(this.templatePicker,"selection-change",e.hitch(this,this._template_change));this.own(this._select_change_event)}(this._creationDisabledOnAll=1>y.length?!0:!1)?(this.drawToolbar&&this.drawToolbar.deactivate(),this.drawingTool&&this._setDrawingToolbar("select",null,c),this.templatePicker&&(C.style(this.templatePicker.domNode,"display","none"),this.config.editor.autoSaveEdits&&this._createAutoSaveSwitch(!1),b.contains(this.widgetActiveIndicator,"widgetNotActive")||this._mapClickHandler(!0),
this._clearTemplateSelection()),this.drawingTool&&C.style(this.drawingTool.domNode,"display","none"),this._filterEditor&&C.style(this._filterEditor.domNode,"display","none"),this._isPresetTableCreated&&(d(".presetFieldsTableDiv")[0].style.display="none")):(this.templatePicker&&C.style(this.templatePicker.domNode,"display","block"),this.config.editor.autoSaveEdits&&this._createAutoSaveSwitch(!0),this.drawingTool&&C.style(this.drawingTool.domNode,"display","block"),this._filterEditor&&C.style(this._filterEditor.domNode,
"display","block"),this._isPresetTableCreated&&(d(".presetFieldsTableDiv")[0].style.display="block"));this.config.editor.configInfos&&!this._isPresetTableCreated&&this._createPresetTable(this.config.editor.configInfos);this._checkForLayersInTemplatePicker();setTimeout(e.hitch(this,function(){this._handle508AccessibilityForTemplatePicker();this._setWidgetFirstFocusNode("templatePicker",!1)}),2E3)}))},_checkForLayersInTemplatePicker:function(){if(this.templatePicker&&"none"!==a.get(this.templatePicker.domNode,
"display"))if(void 0===this.config.editor.editDescription||null===this.config.editor.editDescription||"\x3cbr\x3e"===this.config.editor.editDescription)this.config.editor.editDescription="",this.templateTitle.innerHTML=this.config.editor.editDescription,a.set(this.templateTitle,"display","none"),ma.set(this.templateTitle,"tabindex","-1");else{var c=this.editorXssFilter.sanitize(this.config.editor.editDescription);this.templateTitle.innerHTML=Ra.decode(c);ma.set(this.templateTitle,"aria-label",Aa.stripHTML(this.config.editor.editDescription));
a.set(this.templateTitle,"display","block");ma.set(this.templateTitle,"tabindex","0")}else{var r=!1,y=!1,H=!0;c="";g.some(this.config.editor.configInfos,e.hitch(this,function(K){if(this._getEditFlagValue(K)&&K.allowUpdateOnly)return y=!0}));g.some(this.config.editor.configInfos,e.hitch(this,function(K){if(this._getEditFlagValue(K)&&K.configFeatureLayer.layerAllowsCreate&&!K.allowUpdateOnly)return r=!0,H=y=!1,!0}));r?c=this._checkForLayersVisibilityInMap(!0)?this._doesAllLayersOutOfMapScale()?this.nls.noVisibleCreateLayerWarning:
this.config.editor.editDescription:this.nls.checkLayerVisibilityInWebMapWarning:y?c=this._checkForLayersVisibilityInMap(!1)?this._doesAllLayersOutOfMapScale()?this.nls.noVisibleUpdateLayerWarning:this.config.editor.editDescription:this.nls.checkLayerVisibilityInWebMapWarning:H?this._checkIfLayerHasRelations()?(c=this._getLayersRelationShipInfo(this.config.editor.configInfos,!0),c.canCreate?c=this.config.editor.editDescription:(c=this._getLayersRelationShipInfo(this.config.editor.configInfos,!1),c=
c.canUpdate?this.config.editor.editDescription:this.nls.noEditableLayerWarning)):c=this.nls.noEditableLayerWarning:c=this.nls.noEditableLayerWarning;a.set(this.templateTitle,"display","block");ma.set(this.templateTitle,"tabindex","0");ma.set(this.templateTitle,"innerHTML",c);ma.set(this.templateTitle,"aria-label",c)}},_doesAllLayersOutOfMapScale:function(){var c=!0;g.some(this.config.editor.configInfos,e.hitch(this,function(r){if(r.allowUpdateOnly&&r.layerInfo&&r.layerInfo.layerObject&&r.layerInfo.layerObject.visibleAtMapScale&&
r.layerInfo.layerObject.visible)return c=!1,!0}));return c},_checkForLayersVisibilityInMap:function(c){var r=!1;g.some(this.config.editor.configInfos,e.hitch(this,function(y){if(void 0===c){if(y&&y.relationshipInfos&&0<y.relationshipInfos.length&&y.layerInfo._visible)return r=!0}else if(c&&this._getEditFlagValue(y)){if(y.layerInfo&&y.layerInfo._visible)return r=!0}else if(!c&&y.allowUpdateOnly&&y.layerInfo&&y.layerInfo._visible)return r=!0}));return r},_checkIfLayerHasRelations:function(){var c=!1;
g.some(this.config.editor.configInfos,e.hitch(this,function(r){if(r.hasOwnProperty("relationshipInfos")&&0<r.relationshipInfos.length)return c=!0}));return c},_getLayersRelationShipInfo:function(c,r){var y={canCreate:!1,canUpdate:!1};g.some(c,e.hitch(this,function(H){if(H.relationshipInfos&&0<H.relationshipInfos.length&&(y=this._getRelationShipDetails(H,r),y.canCreate||y.canUpdate))return!0}));return y},_getRelationShipDetails:function(c,r){var y={canCreate:!1,canUpdate:!1};g.some(c.relationshipInfos,
e.hitch(this,function(H){if(r){if(H._editFlag)if(H.allowUpdateOnly)y.canUpdate=!0;else return y.canCreate=!0,y.canUpdate=!1,!0}else if(H._editFlag&&H.allowUpdateOnly)return y.canUpdate=!0;if(!y.canCreate&&!y.canUpdate&&H.relationshipInfos&&0<H.relationshipInfos.length&&(y=this._getLayersRelationShipInfo([H],r),y.canCreate||y.canUpdate))return!0}));return y},_handle508AccessibilityForTemplatePicker:function(){var c=d("div[role\x3d'grid']",this.templatePickerDiv);var r=d("[type\x3d'checkbox']",this.templatePickerDiv);
var y=d("[dojoattachpoint\x3d'lastFocusNode']",this.templatePickerDiv);c&&c[0]&&ma.set(c[0],"tabindex","-1");g.forEach(r,e.hitch(this,function(H){ma.set(H,"tabindex","-1")}));y&&y[0]&&ma.set(y[0],"tabindex","-1");(c=d(".dojoxGridMasterMessages",this.domNode))&&0<c.length&&ma.set(c[0],"tabindex","-1")},isGuid:function(c){"{"===c[0]&&(c=c.substring(1,c.length-1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(c)},_template_change:function(){this._deactivateAllTools();
this.currentShapeType=this.currentDrawType=null;this._currentSelectedTemplate=Object.create(this.templatePicker.getSelected());this._activateTemplateToolbar()},validateGUID:function(c,r){return this.isGuid(c)},_createPresetTable:function(c){this._isPresetTableCreated||this._processConfigForBackwardPresetInfos(c);this.config.hasOwnProperty("attributeActionGroups")&&0<Object.keys(this.config.attributeActionGroups.Preset).length&&(this.config.attributeActionGroups.hasOwnProperty("presetOrder")||(this.config.attributeActionGroups.presetOrder=
Object.keys(this.config.attributeActionGroups.Preset)),this._isPresetTableCreated||(this._isPresetTableCreated=!0,this._initPresetFieldsTable(c)),this.templatePicker&&!b.contains(d(".ee-presetValueTableDiv",this.domNode)[0],"esriCTHidden")?d(".presetFieldsTableDiv")[0].style.display="block":d(".presetFieldsTableDiv")[0].style.display="none")},_processConfigForBackwardPresetInfos:function(c){var r=[];!this.config.editor.hasOwnProperty("presetInfos")&&c&&(g.forEach(c,e.hitch(this,function(y){y.fieldValues=
{};g.forEach(y.fieldInfos,e.hitch(this,function(H){if(H.hasOwnProperty("canPresetValue")&&H.canPresetValue){var K=[{actionName:"Intersection",enabled:!1},{actionName:"Address",enabled:!1},{actionName:"Coordinates",enabled:!1},{actionName:"Preset",enabled:!0}];y.fieldValues[H.fieldName]=e.clone(K);r[H.fieldName]=[]}}))})),this.config.editor.presetInfos=r);W.createPresetGroups(this.config,this._jimuLayerInfos)},_presetChange:function(){this._toggleUsePresetValues(!0)},_createAutoSaveSwitch:function(c){c?
d(".autoSaveOptionDiv")[0].style.display="block":d(".autoSaveOptionDiv")[0].style.display="none"},_toggleRunTimeAutoSave:function(){this._autoSaveRuntime=!1===this._autoSaveRuntime?!0:!1;this._createAutoSaveSwitch(this.config.editor.autoSaveEdits)},_deleteFeature:function(){if(this.currentFeature){this._resetEditingVariables();var c=this.currentFeature.getLayer();if(null===c.url)c.clear(),this._showTemplate(!0);else{var r=d(".processing-indicator"),y=d(".processing-indicator-panel"),H=d(".saveButton",
this.buttonHeader)[0];g.forEach(r,function(K){b.contains(K,"busy")||b.add(K,"busy")});g.forEach(y,function(K){b.contains(K,"busy")||b.add(K,"busy")});b.contains(H,"hide")||b.add(H,"hide");c.applyEdits(null,null,[this.currentFeature],e.hitch(this,function(K,S,V){if(V&&0<V.length&&V[0].hasOwnProperty("error"))B({message:V[0].error.toString()});else if(this.updateFeatures.splice(this.updateFeatures.indexOf(this.currentFeature),1),this.updateFeatures&&0<this.updateFeatures.length)if("Table"===c.type){var aa=
[];this.loading.show();g.forEach(this.updateFeatures,function(fa){aa.push(fa.attributes[c.objectIdField])});K=new F;K.objectIds=aa;c.selectFeatures(K,T.SELECTION_NEW,e.hitch(this,function(fa){this.updateFeatures=fa;this.attrInspector.refresh();this.attrInspector.first();this.loading.hide()}),e.hitch(this,function(){this.loading.hide()}))}else this.attrInspector.refresh(),this.attrInspector.first();else 2>this._traversal.length?(this._showTemplate(!0),this._setWidgetFirstFocusNode("templatePicker",
!0)):(n.emit(this.cancelButton,"click",{cancelable:!0,bubbles:!0}),this._setWidgetFirstFocusNode("AI",!0));g.forEach(r,function(fa){b.contains(fa,"busy")&&b.remove(fa,"busy")});g.forEach(y,function(fa){b.contains(fa,"busy")&&b.remove(fa,"busy")});b.contains(H,"hide")&&b.remove(H,"hide")}),e.hitch(this,function(K){B({message:K.message.toString()+"\n"+K.details});g.forEach(r,function(S){b.contains(S,"busy")&&b.remove(S,"busy")});g.forEach(y,function(S){b.contains(S,"busy")&&b.remove(S,"busy")});b.contains(H,
"hide")&&b.remove(H,"hide")}))}}},_editGeometry:function(c){if(!c||!(this._ignoreEditGeometryToggle||this.currentLayerInfo&&!this._getEditFlagValue(this.currentLayerInfo))){if(!0===c){if(this.currentLayerInfo&&this.currentLayerInfo.disableGeometryUpdate&&!this.currentLayerInfo.isCache||this.currentLayerInfo&&!this.currentLayerInfo.isCache&&(!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&
!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues))return;this.map.setInfoWindowOnClick(!1);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();!1===this._editingEnabled&&this.currentFeature&&this.currentFeature.geometry?(this._editingEnabled=!0,this.currentFeature.origGeom=this.currentFeature.geometry.toJson(),setTimeout(e.hitch(this,function(){this._activateEditToolbar(this.currentFeature)}),100)):(0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate(),this._editingEnabled=
!1)}else this.map.setInfoWindowOnClick(!0),this.editToolbar.deactivate(),this._editingEnabled=!1;this._toggleAttributeButtonVisibility(c);this._toggleLocateButtonVisibility(c);this._toggleXYCoordinatesButtonVisibility(c);this._toggleMapNavigationButtonVisibility(c);this._setWidgetFirstFocusNode("AI",!1)}},_toggleAttributeButtonState:function(){this._refreshButton&&b.contains(this._refreshButton,"esriCTAutoUpdateOnMode")?(b.replace(this._refreshButton,"esriCTAutoUpdateOffMode","esriCTAutoUpdateOnMode"),
ma.set(this._refreshButton,"title",this.nls.automaticAttributeUpdatesOff)):this._refreshButton&&b.contains(this._refreshButton,"esriCTAutoUpdateOffMode")&&(b.replace(this._refreshButton,"esriCTAutoUpdateOnMode","esriCTAutoUpdateOffMode"),ma.set(this._refreshButton,"title",this.nls.automaticAttributeUpdatesOn),this._refreshAttributes())},_toggleAttributeButtonVisibility:function(c){this.config.editor.enableAttributeUpdates&&this.currentLayerInfo&&(this.currentLayerInfo.isCache||this.currentLayerInfo.isEditable)?
b.remove(this._refreshButton,"hidden"):b.add(this._refreshButton,"hidden")},_toggleLocateButtonVisibility:function(c){c&&this.config.editor.enableMovingSelectedFeatureToGPS&&this.currentFeature&&this.currentFeature.geometry&&"point"===this.currentFeature.geometry.type?b.remove(this._locateButtonDiv,"hidden"):b.add(this._locateButtonDiv,"hidden")},_toggleXYCoordinatesButtonVisibility:function(c){c&&this.config.editor.enableMovingSelectedFeatureToXY&&this.currentFeature&&this.currentFeature.geometry&&
"point"===this.currentFeature.geometry.type?b.remove(this._xyCoordinates,"hidden"):b.add(this._xyCoordinates,"hidden")},_toggleMapNavigationButtonState:function(){b.contains(this._mapNavigation,"esriCTMapNavigationUnLocked")?this._lockMapNavigation():b.contains(this._mapNavigation,"esriCTMapNavigationLocked")&&this._unLockMapNavigation()},_lockMapNavigation:function(){this._mapNavigation&&(b.replace(this._mapNavigation,"esriCTMapNavigationLocked","esriCTMapNavigationUnLocked"),ma.set(this._mapNavigation,
"title",this.nls.mapNavigationLocked),this.map.disableMapNavigation())},_unLockMapNavigation:function(){this._mapNavigation&&(b.replace(this._mapNavigation,"esriCTMapNavigationUnLocked","esriCTMapNavigationLocked"),ma.set(this._mapNavigation,"title",this.nls.mapNavigationUnLocked),this.map.enableMapNavigation())},_toggleMapNavigationButtonVisibility:function(c){c&&this.config.editor.enableLockingMapNavigation?b.remove(this._mapNavigation,"hidden"):b.add(this._mapNavigation,"hidden");this._unLockMapNavigation()},
_enableAttrInspectorSaveButton:function(c,r,y){var H=d(".saveButton",this.buttonHeader)[0],K=!1;H&&(c?(b.contains(H,"jimu-state-disabled")&&(b.remove(H,"jimu-state-disabled"),ma.set(H,"tabindex","0")),K=!0,ma.set(H,"tabindex","0"),this._setWidgetFirstFocusNode("AI",!1)):b.contains(H,"jimu-state-disabled")||(b.add(H,"jimu-state-disabled"),ma.set(H,"tabindex","-1"),this._setWidgetFirstFocusNode("AI",!1)),!r&&this.currentFeature&&this._relatedTablesInfo[this.currentFeature._layer.id]&&(this._relatedTablesInfo[this.currentFeature._layer.id].isSaveEnable=
K),this.currentLayerInfo.showAttachments&&y&&0===ca.findWidgets(this.attrInspector.attributeTable).length&&this._setWidgetFirstFocusNode("AI",!0))},_setConfiguredFieldInfos:function(c,r){var y=[];g.forEach(r,function(H){var K=X.getFieldInfoByFieldName(c,H.fieldName);H=e.mixin(e.clone(K),H);y.push(H)});return y},_getLayerInfoByID:function(c){0<c.indexOf("_lfl")&&(c=c.replace("_lfl",""));if(this._traversal&&0<this._traversal.length){var r=this.config.editor.configInfos;g.some(this._traversal,function(S,
V){g.some(r,function(aa){if(aa.featureLayer.id===S)return r=aa,!0});1<this._traversal.length&&V+1<this._traversal.length&&(r=r.relationshipInfos)},this);if(!r.layerInfo&&r.featureLayer&&r.featureLayer.id){r.layerInfo=this._jimuLayerInfos.getLayerOrTableInfoById(r.featureLayer.id);var y=ia.getConfigInfo(r.layerInfo,{}),H=r.layerInfo.layerObject;this._removeSpacesInLayerTemplates(H);r.fieldInfos=this._setConfiguredFieldInfos(y.fieldInfos,r.fieldInfos);this.processConfigForRuntime(r);r.configFeatureLayer=
y.featureLayer;r.featureLayer=H;r.showDeleteButton=!1}return r}var K=null;this.config.editor.configInfos.some(function(S){return S.featureLayer.id===c?(K=S,!0):!1});return K},_initPresetFieldsTable:function(c){var r=f.create("div",{"class":"ee-presetValueTableDiv templatePicker"},this.presetFieldsTableNode),y=f.create("div",{"class":"bodyDiv"},r);y=f.create("table",{"class":"ee-presetValueBodyTable"},y);y=f.create("tbody",{"class":"ee-presetValueBody",id:"eePresetValueBody"},y,"first");c=new ja({nls:this.nls,
parentNode:y,configInfos:c,_jimuLayerInfos:this._jimuLayerInfos,_configuredPresetInfos:this.config.attributeActionGroups.Preset,presetOrder:this.config.attributeActionGroups.presetOrder,showingInWidget:!0,map:this.map});this.own(n(c,"presetValueChanged",e.hitch(this,this._presetChange)));c.hasAtLeastOneGroupInDisplay||(b.add(r,"esriCTHidden"),a.set(ca.byId("savePresetValueSwitch").domNode,"display","none"));c.enableUsePresetValueCheckBox&&this._presetChange()},_dateClick:function(c,r){return function(){void 0!==
c&&null!==c&&c.set("value",new Date);void 0!==r&&null!==r&&r.set("value",new Date)}},_getEditableLayers:function(c){var r=[],y=[],H=new M;this.loading.show();g.forEach(c,function(K){var S,V=!1;if(V=K.hasOwnProperty("_orgConfiguredEditFlag")?K._orgConfiguredEditFlag:K._editFlag)K=this._jimuLayerInfos.getLayerInfoByTopLayerId(K.featureLayer.id),K.layerObject&&K.layerObject.visible&&K.layerObject.isVisibleAtScale(this.map.getScale())&&K.layerObject.isEditable()&&(S=K.isEditable());S||(S=new M,S.resolve(!1));
y.push(S)},this);E(y).then(e.hitch(this,function(K){g.forEach(K,e.hitch(this,function(S,V){c[V]&&(c[V].hasOwnProperty("_orgConfiguredEditFlag")||(c[V]._orgConfiguredEditFlag=e.clone(c[V]._editFlag)),c[V]._isEditableByUser=S,c[V].allowUpdateOnly?c[V]._editFlag=!1:S?r.push(this.map.getLayer(c[V].featureLayer.id)):c[V]._editFlag=!1)}));H.resolve(r);this.loading.hide()}));return H.promise},_updateConfiguredLayersInfos:function(c){var r=[],y=new M;this.loading.show();g.forEach(c,function(H){H=this._jimuLayerInfos.getLayerInfoByTopLayerId(H.featureLayer.id);
var K;H&&(K=H.isEditable());r.push(K)},this);E(r).then(e.hitch(this,function(H){g.forEach(H,e.hitch(this,function(K,S){K||(c[S]._editFlag=!1,c[S].relationshipInfos&&0<c[S].relationshipInfos.length&&this._updateConfiguredRelations(c[S].relationshipInfos))}));y.resolve();this.loading.hide()}));return y.promise},_updateConfiguredRelations:function(c){g.forEach(c,function(r){r._editFlag=!1;r.relationshipInfos&&0<r.relationshipInfos.length&&this._updateConfiguredRelations(r.relationshipInfos)},this)},
_getClonedRelationInfo:function(c){for(var r=[],y=0;y<c.length;y++){var H={},K;for(K in c[y])c[y].hasOwnProperty(K)&&"featureLayer"!==K&&"layerInfo"!==K&&(H[K]="relationshipInfos"===K?this._getClonedRelationInfo(c[y][K]):e.clone(c[y][K]));r.push(H)}return r},_getLayerInfoForLocalLayer:function(c){var r=this._getLayerInfoByID(c.originalLayerId);if(null!==r){var y={};for(var H in r)r.hasOwnProperty(H)&&"featureLayer"!==H&&"layerInfo"!==H&&(y[H]="relationshipInfos"===H?this._getClonedRelationInfo(r[H]):
e.clone(r[H]));y.featureLayer=c}return y},_getSelectionSymbol:function(c,r){if(!c||""===c)return null;switch(c){case "esriGeometryPoint":var y=!0===r?new J(J.STYLE_CIRCLE,20,new P(P.STYLE_SOLID,new Y([0,230,169,1]),2),new Y([0,230,169,.65])):new J(J.STYLE_CIRCLE,20,new P(P.STYLE_SOLID,new Y([92,92,92,1]),2),new Y([255,255,0,.65]));break;case "esriGeometryPolyline":y=!0===r?new P(P.STYLE_SOLID,new Y([0,255,255,.65]),2):new P(P.STYLE_SOLID,new Y([255,255,0,.65]),2);break;case "esriGeometryPolygon":y=
!0===r?(new R).setColor(new Y([0,230,169,.65])):(new R).setColor(new Y([255,255,0,.65])),c=new P(P.STYLE_SOLID,new Y([192,192,192,1]),2),y.setOutline(c)}return y},_hasPresetValueFields:function(c){return c.some(function(r){return!1===r.allowUpdateOnly?r.fieldInfos?r.fieldInfos.some(function(y){return!0===y.canPresetValue}):!1:!1},this)},_setPresetValueValue:function(c,r,y){var H=!0,K,S=d("#eePresetValueBody")[0];y&&(H=!1);S&&(S=d(".preset-value-editable .ee-inputField"),g.forEach(S,e.hitch(this,function(V){var aa=
I.byNode(V);if(void 0!==aa&&null!==aa){V=aa.get("name");aa.get("isdategroup");if(H){var fa=V.split(" ");1<fa.length&&(V=fa[1],y="("+c+")")}y&&V.toLowerCase()===y.toLowerCase()&&(aa.esriCTisDateGroup?(K={dateType:"fixed",dateTime:(new Date(r)).getTime()},aa.esriCTPresetGroup.presetValue=K,K.dateTime?aa.set("value",X.getDateFromRelativeInfo(aa.esriCTPresetGroup.presetValue,!0)):aa.set("value","")):aa.esriCTDomainList?g.some(aa.store.data,function(ka){if(ka.id===r)return aa.set("value",r),!0}):"dijit.form.NumberTextBox"===
aa.declaredClass?aa.set("value",parseFloat(r)):aa.set("value",r))}})));y&&this.config.attributeActionGroups.Preset&&this.config.attributeActionGroups.Preset[y]&&this.config.attributeActionGroups.Preset[y].hideInPresetDisplay&&(this.config.attributeActionGroups.Preset[y].presetValue=K?K:r,this._presetChange())},_modifyAttributesWithPresetValues:function(c,r,y,H){var K=[],S={},V=[],aa=[];if(r.fieldValues){for(var fa in r.fieldValues)for(var ka=0;ka<r.fieldValues[fa].length;ka++){var ea=r.fieldValues[fa][ka],
la=!1,oa;r.fieldInfos&&(oa=X.getFieldInfoByFieldName(r.fieldInfos,fa));if(y&&"Intersection"===ea.actionName&&ea.enabled){for(var ua=0;ua<ea.fields.length;ua++){var wa=ea.fields[ua];if(y.Intersection.hasOwnProperty(fa)&&y.Intersection[fa].hasOwnProperty(wa.layerId)&&y.Intersection[fa][wa.layerId].hasOwnProperty(wa.field)){c[fa]=y.Intersection[fa][wa.layerId][wa.field];oa&&"esriFieldTypeString"===oa.type&&(c[fa]=this._getFormattedFieldValue(c[fa],wa));la=!0;y.multipleValues&&y.multipleValues.hasOwnProperty(fa)&&
0>aa.indexOf(fa)&&aa.push(fa);break}}if(la)break}if(y&&"Address"===ea.actionName&&ea.enabled&&y.Address.hasOwnProperty(ea.field)){c[fa]=y.Address[ea.field];break}if(y&&"Coordinates"===ea.actionName&&ea.enabled){ea.coordinatesSource&&"myLocation"===ea.coordinatesSource?(ka=y.MyLocation.Coordinates.hasOwnProperty(ea.coordinatesSystem),"xy"===ea.field||"yx"===ea.field?c[fa]=ka?this._getOutputString(ea.coordinatesSystem,y.MyLocation.Coordinates[ea.coordinatesSystem],ea.field):"":(c[fa]=ka?y.MyLocation.Coordinates[ea.coordinatesSystem][ea.field]:
"",oa&&"esriFieldTypeString"===oa.type&&(c[fa]=c[fa].toString()))):"xy"===ea.field||"yx"===ea.field?c[fa]=this._getOutputString(ea.coordinatesSystem,y.Coordinates[ea.coordinatesSystem],ea.field):(c[fa]=y.Coordinates[ea.coordinatesSystem][ea.field],oa&&"esriFieldTypeString"===oa.type&&(c[fa]=c[fa].toString()));break}if((!H||H!==fa)&&"Preset"===ea.actionName&&ea.enabled&&this._usePresetValues){K.push(fa);ea.attributeActionGroupName&&(S[fa]=ea.attributeActionGroupName,0>V.indexOf(ea.attributeActionGroupName)&&
V.push(ea.attributeActionGroupName));break}}if(y)if(y.multipleValues&&0<aa.length){var Ba={};g.forEach(aa,function(ya){Ba[ya]=y.multipleValues[ya]});y.multipleValues=Ba}else y.multipleValues=null}if(0<K.length){r=this._getPresetValueForGroup(V);g.forEach(K,e.hitch(this,function(ya){!c.hasOwnProperty(ya)&&S.hasOwnProperty(ya)&&(c[ya]=null)}));for(var va in c)c.hasOwnProperty(va)&&0<=K.indexOf(va)&&S.hasOwnProperty(va)&&(c[va]=r[S[va]])}},_getFormattedFieldValue:function(c,r){var y=ia.getFieldInfosFromWebmap(this._jimuLayerInfos.getLayerInfoById(r.layerId));
r=X.getFieldInfoByFieldName(y,r.field);if(null===c||void 0===c)c="";r&&"esriFieldTypeDate"===r.type&&""!==c&&(r.format||(r.format={dateFormat:"shortDate"}),c=Aa.localizeDateByFieldInfo(new Date(c),r));return c},_getPresetValueForGroup:function(c){for(var r={},y=this.config.attributeActionGroups.Preset,H=0;H<c.length;H++)if(y.hasOwnProperty(c[H])){var K=y[c[H]];K.showOnlyDomainFields||"esriFieldTypeString"!==K.dataType&&"esriFieldTypeInteger"!==K.dataType&&"esriFieldTypeGUID"!==K.dataType?"esriFieldTypeDate"!==
K.dataType||K.showOnlyDomainFields?K.selectedDomainValue&&(r[c[H]]=K.selectedDomainValue):(K=(K=X.getDateFromRelativeInfo(K.presetValue))&&K.getTime?K.getTime():K&&K.toGregorian?K.toGregorian().getTime():K,r[c[H]]=K):r[c[H]]=K.presetValue}return r},processConfigForRuntime:function(c){var r=[];c&&(c._editFlag||(c.isEditable=!1),r=g.filter(c.fieldInfos,function(y){return"esriFieldTypeBlob"===y.type||"esriFieldTypeGlobalID"===y.type||"esriFieldTypeRaster"===y.type||"esriFieldTypeXML"===y.type?!1:!0===
y.isEditable?!0:y.visible}),this.config.editor.hasOwnProperty("honorWebMapConfiguration")&&this.config.editor.honorWebMapConfiguration&&0===r.length&&(r=g.filter(c.fieldInfos,function(y){return"esriFieldTypeBlob"===y.type||"esriFieldTypeGlobalID"===y.type||"esriFieldTypeRaster"===y.type||"esriFieldTypeXML"===y.type?!1:!0})),c.fieldInfos=r)},_newAttrInspectorNeeded:function(){var c=!1;!this.attrInspector||1<this.attrInspector.layerInfos.length?c=!0:(c=this.attrInspector.layerInfos[0].featureLayer.id,
c=0<c.indexOf("_lfl")?0>c.indexOf(this.templatePicker.getSelected().featureLayer.id):!0);c&&this.attrInspector?(this.attrInspector.destroy(),this.attrInspector=null):this._attachmentUploader&&null!==this._attachmentUploader&&this._attachmentUploader.clear();return c},_onMapClick:function(c){this._copyFeaturesObj&&(this._copyFeaturesObj.cancelBtnClicked(),this.templatePicker&&this._clearTemplateSelection());if(this._byPass&&!0===this._byPass)this._byPass=!1;else{var r=!1;this.templatePicker&&(r=this.templatePicker.getSelected()?
!0:!1);!this._attrInspIsCurrentlyDisplayed&&c.mapPoint&&!1===r&&(c.graphic&&c.graphic.geometry&&"point"===c.graphic.geometry.type&&(c.mapPoint=new Oa(c.graphic.geometry.toJson())),this._processOnMapClick(c))}},_attachmentsComplete:function(c,r,y){return function(H){var K="";g.forEach(H,function(V){V&&"rejected"===V.state&&V.error&&Ma.isDefined(V.error.code)&&(K=400===V.error.code?K+t.widgets.attachmentEditor.NLS_fileNotSupported+"\x3cbr/\x3e":K+V.error.message||(V.error.details&&V.error.details.length&&
V.error.details[0])+"\x3cbr/\x3e")},this);if(""!==K)var S=new Ka({titleLabel:this.nls.attachmentLoadingError,width:400,maxHeight:200,autoHeight:!0,content:K,buttons:[{label:this.nls.back,classNames:["jimu-btn"],onClick:e.hitch(this,function(){S.close()})}],onClose:e.hitch(this,function(){})});return this._completePost(c,r,y)}},_selectComplete:function(c,r){return function(){this._removeLocalLayers();this.currentFeature=null;this._showTemplate(!1);r.resolve("success")}},_completePost:function(c,r,
y){this._createAttributeInspector([this.currentLayerInfo]);var H=new F;H.objectIds=[r];c.selectFeatures(H,T.SELECTION_NEW,e.hitch(this,this._selectComplete(c,y)),e.hitch(this,function(){y.resolve("failed")}))},_postChanges:function(c){var r=new M,y=this._changed_feature(c,!1);c=y[0];var H=y[1];y=y[2];var K=null,S=null;null===c?r.resolve("success"):"Add"===y?(1<this._traversal.length&&(this.addNewRelatedRecord=!0),K=this._jimuLayerInfos.getLayerOrTableInfoById(H).layerObject,S=K.applyEdits([c],null,
null),this.addDeferred(S,c,K,r)):(K=this._jimuLayerInfos.getLayerOrTableInfoById(H).layerObject,0===Object.keys(c.attributes).length&&null===c.geometry?r.resolve("success"):1===Object.keys(c.attributes).length&&c.attributes.hasOwnProperty(K.objectIdField)&&null===c.geometry?r.resolve("success"):(S=K.applyEdits(null,[c],null),this.addDeferred(S,c,K,r)));return r.promise},_changed_feature:function(c,r){var y=null,H=null,K=null,S=null;r=r||!1;var V=null;if(c){y=new Q(null,null,m.parse(m.stringify(c.attributes)));
if(void 0!==this._smartAttributes&&null!==this._smartAttributes)for(V in y.attributes)!0===y.attributes.hasOwnProperty(V)&&(K=this._smartAttributes.validateField(V),"Hide"===K[1]&&!0!==K[3]&&delete y.attributes[V]);for(V in y.attributes)!0===y.attributes.hasOwnProperty(V)&&""===y.attributes[V]&&(y.attributes[V]=null);this._attributeInspectorTools?(y.attributes=this._attributeInspectorTools._checkFeatureData(y.attributes),c.preEditAttrs&&(y.preEditAttrs=this._attributeInspectorTools._checkFeatureData(m.parse(m.stringify(c.preEditAttrs))))):
c.preEditAttrs&&(y.preEditAttrs=m.parse(m.stringify(c.preEditAttrs)));if(c.getLayer().originalLayerId){if(K=this._jimuLayerInfos.getLayerOrTableInfoById(c.getLayer().originalLayerId).layerObject)y.geometry=c.geometry,y.symbol=null,H="Add",r=!0}else void 0!==this.geometryChanged&&null!==this.geometryChanged&&!0===this.geometryChanged&&(y.geometry=c.geometry),K=c.getLayer(),(c=ia.filterOnlyUpdatedAttributes(y.attributes,y.preEditAttrs,K))&&!ia.isObjectEmpty(c)?y.attributes=c:y.attributes=[],y.symbol=
null,H="Update";S=K.id;y&&r&&y.attributes.hasOwnProperty(K.objectIdField)&&delete y.attributes[K.objectIdField];K.globalIdField&&y.attributes.hasOwnProperty(K.globalIdField)&&delete y.attributes[K.globalIdField];if(K.editFieldsInfo)for(V in K.editFieldsInfo)K.editFieldsInfo.hasOwnProperty(V)&&y.attributes.hasOwnProperty(K.editFieldsInfo[V])&&delete y.attributes[K.editFieldsInfo[V]]}return[y,S,H]},getUniqueFieldErrorMsg:function(c){var r="",y="",H={};H=c.split("with unique index '");c=c.split("duplicate key value is (");
2<=H.length&&(r=H[1].split(".")[0].split("_Index")[0]);2<=c.length&&(y=c[1].split(")")[0]);H=X.getFieldInfoByFieldName(this.attrInspector._currentLInfo.fieldInfos,r);"esriFieldTypeDate"===H.type&&y.indexOf(!1)&&(y=y.split(".")[0]);return Ia.substitute(this.nls.uniqueValueErrorMessage,{fieldName:H.label||H.name||y})},addDeferred:function(c,r,y,H){c.then(e.hitch(this,function(K,S){S&&0<S.length&&S[0].hasOwnProperty("error")?(K=S[0].error.toString(),-1!==K.toLowerCase().indexOf("cannot insert duplicate key row")&&
(K=this.getUniqueFieldErrorMsg(K)),B({message:K}),H.resolve("failed")):S&&0<S.length?(r.preEditAttrs=m.parse(m.stringify(r.attributes)),y.refresh(),this.geometryChanged=!1,H.resolve("success")):K&&0<K.length&&K[0].hasOwnProperty("error")?(K=K[0].error.toString(),-1!==K.toLowerCase().indexOf("cannot insert duplicate key row")&&(K=this.getUniqueFieldErrorMsg(K)),B({message:K}),H.resolve("failed")):K&&0<K.length&&(r.preEditAttrs=m.parse(m.stringify(r.attributes)),S=null,this.attrInspector._attachmentUploader&&
(S=this.attrInspector._attachmentUploader.postAttachments(y,K[0].objectId)),void 0===S||null===S||0===S.length?this.addNewRelatedRecord?H.resolve("success"):this._completePost(y,K[0].objectId,H):E(S).then(e.hitch(this,this._attachmentsComplete(y,K[0].objectId,H))))}),e.hitch(this,function(K){B({message:K.message.toString()+"\n"+K.details});H.resolve("failed")}))},_processOnMapClick:function(c){var r=this.config.editor.hasOwnProperty("featuresSelectionTolerance")?this.config.editor.featuresSelectionTolerance:
20;this.map.infoWindow.hide();g.forEach(this._attributeInspectorCollection,function(S){S.destroy()});this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this._createAttributeInspector(this.config.editor.configInfos);var y=this.map.getLayersVisibleAtScale().filter(e.hitch(this,function(S){return S.type&&"Feature Layer"===S.type&&S.url?g.some(this.config.editor.configInfos,e.hitch(this,
function(V){return V.layerId===S.id&&this._hasAnyEditableLayerInRelation([V])?!0:!1})):!1}));y=y.filter(e.hitch(this,function(S){try{return this.map.getLayer(S.id).visible}catch(V){return console.log(V+" Check for visible failed"),!0}}));var H=[],K=[];this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;g.forEach(y,e.hitch(this,function(S){S.setSelectionSymbol(this._getSelectionSymbol(S.geometryType,!1));var V=new F;V.geometry=ia.pointToExtent(this.map,c.mapPoint,r);V=S.selectFeatures(V,
T.SELECTION_NEW,e.hitch(this,function(aa){var fa=[],ka=[];g.forEach(aa,function(ea){ea.allowDelete=!0;S.getEditCapabilities({feature:ea}).canDelete||(ea.allowDelete=!1);ea.preEditAttrs=m.parse(m.stringify(ea.attributes));ka.push(ea)},this);0<fa.length&&(aa=new F,aa.objectIds=fa,fa=S.selectFeatures(aa,T.SELECTION_SUBTRACT,e.hitch(this,function(ea){console.log(ea.length)})),K.push(fa));H=H.concat(ka)}));K.push(V)}));0===K.length?(this._byPass=!0,this.map.popupManager._showPopup(c),this._byPass=!1):
E(K).then(e.hitch(this,function(){this.updateFeatures=H;0<this.updateFeatures.length?this._showTemplate(!1):(this._byPass=!0,this.map.popupManager._showPopup(c),this._byPass=!1)}))},_attachLayerHandler:function(){this._eventHandler=this.own(n(this.currentFeature._layer,"visibility-change",e.hitch(this,function(){})))},_removeLayerVisibleHandler:function(){null!==this._eventHandler&&(g.forEach(this._eventHandler,e.hitch(this,function(c){"function"===typeof c.remove&&c.remove()})),this._eventHandler=
null)},_postFeatureSave:function(c){this.updateFeatures&&1<this.updateFeatures.length&&g.forEach(this.updateFeatures,e.hitch(this,function(r){r.setSymbol(this._getSelectionSymbol(r.getLayer().geometryType,!1))}));c&&c.feature&&(this.geometryChanged=!1,this.currentFeature=c.feature,this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes)),this._attachLayerHandler(),this.currentLayerInfo=this._getLayerInfoByID(this.currentFeature._layer.id),this.currentLayerInfo.isCache=
!1,this._createSmartAttributes(),this._createAttributeInspectorTools(),this._attributeInspectorTools.triggerFormValidation(),this._validateAttributes(),this._enableAttrInspectorSaveButton(!1),this.currentFeature.hasOwnProperty("allowDelete")?this._toggleDeleteButton(this.currentFeature.allowDelete&&this.currentLayerInfo.allowDelete):this._toggleDeleteButton(this.currentLayerInfo.allowDelete),this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||
this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues),this.currentFeature.setSymbol(this._getSelectionSymbol(c.feature.getLayer().geometryType,!0)))},_promptToDelete:function(){var c=new Ka({titleLabel:this.nls.deletePromptTitle,width:400,maxHeight:200,autoHeight:!0,content:this.nls.deletePrompt,buttons:[{label:this.nls.yes,classNames:["jimu-btn"],onClick:e.hitch(this,
function(){this._deleteFeature();c.close()})},{label:this.nls.no,classNames:["jimu-btn"],onClick:e.hitch(this,function(){c.close()})}],onClose:e.hitch(this,function(){})})},_promptToResolvePendingEdit:function(c,r,y,H){var K=!this._validateAttributes();H=K?-1:0;var S=new M;K=[{label:this.nls.yes,classNames:["jimu-btn"],disable:K,onClick:e.hitch(this,function(){this._saveEdit(this.currentFeature,c,!0).then(e.hitch(this,function(){null!==r&&void 0!==r&&(r.hasOwnProperty("featureLayer")&&r.hasOwnProperty("feature")?
this.load_from_featureaction(r.featureLayer,r.feature):this._postFeatureSave(r));S.resolve("yes")}));V.close()})},{label:this.nls.no,classNames:["jimu-btn"],onClick:e.hitch(this,function(){this._cancelEditingFeature(c);null!==r&&void 0!==r&&(r.hasOwnProperty("featureLayer")&&r.hasOwnProperty("feature")?this.load_from_featureaction(r.featureLayer,r.feature):this._postFeatureSave(r));V.close();S.resolve("no")})}];y&&!0===y&&K.push({label:this.nls.back,classNames:["jimu-btn"],onClick:e.hitch(this,function(){S.reject();
V.close()})});var V=new Ka({titleLabel:this.nls.savePromptTitle,width:400,maxHeight:200,autoHeight:!0,content:this.nls.savePrompt,buttons:K,onClose:e.hitch(this,function(){})});ma.set(V.disabledButtons[0],"tabindex",H);return S.promise},_removeLocalLayers:function(){this.cacheLayer&&null!==this.cacheLayer&&(this.cacheLayer.clearSelection(),this.cacheLayer.clear(),this.map.removeLayer(this.cacheLayer),this.cacheLayer=null);this.updateFeatures=[]},_removeSpacesInLayerTemplates:function(c){if(c){var r=
g.filter(c.fields,e.hitch(this,function(y){return!1===y.nullable&&!0===y.editable}));g.forEach(r,e.hitch(this,function(y){g.forEach(c.templates,function(H){" "===H.prototype.attributes[y.name]&&(H.prototype.attributes[y.name]=H.prototype.attributes[y.name].trim())})}))}},_resetEditingVariables:function(){this._editingEnabled=!1;this.editToolbar&&0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate()},_feature_removed:function(c,r){return function(){this.attrInspector._featureIdx>=
r&&0!==r&&(this.currentFeature=null,this.attrInspector.previous());this.updateFeatures.splice(this.updateFeatures.indexOf(c),1);this.currentFeature&&this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!1));this.attrInspector&&this.attrInspector._currentFeature&&(this.currentFeature=this.attrInspector._currentFeature,this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes)));this.currentLayerInfo&&this.currentLayerInfo.featureLayer&&
this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&this.attrInspector._currentFeature&&setTimeout(e.hitch(this,function(){2>this._traversal.length&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check())}),100);this.currentFeature&&this.currentFeature.setSymbol(this._getSelectionSymbol(this.currentFeature.getLayer().geometryType,!0));this._refreshLayerTitle()}},_saveEdit:function(c,
r,y){var H=new M;this._enableAttrInspectorSaveButton(!1);this.config.editor.editGeometryDefault||this._turnEditGeometryToggleOff();if(this._validateAttributes()){var K=d(".processing-indicator"),S=d(".processing-indicator-panel"),V=d(".saveButton",this.buttonHeader)[0];g.forEach(K,function(aa){b.contains(aa,"busy")||b.add(aa,"busy")});g.forEach(S,function(aa){b.contains(aa,"busy")||b.add(aa,"busy")});V&&!b.contains(V,"hide")&&b.add(V,"hide");this._postChanges(c).then(e.hitch(this,function(aa){var fa=
!1;if("failed"===aa)H.resolve("failed"),this.addNewRelatedRecord=!1;else{this.addNewRelatedRecord&&(fa=!0,this.attrInspector.destroy(),f.destroy(this.contentWrapper),f.destroy(this.buttonHeader),f.destroy(this.navButtonsDiv),this.attrInspector=this._attributeInspectorCollection.pop(),a.set(this.attrInspector.attributeTable,"display","block"),a.set(this.attrInspector.editButtons,"display","block"),a.set(this.attrInspector.deleteBtn.domNode,"display","none"),this.attrInspector._featureIdx=this.attrInspector.ctStoredFeatureIndex,
this.attrInspector.refresh(),setTimeout(e.hitch(this,function(){a.set(this.attrInspector.navButtons,"display",!this.attrInspector._hideNavButtons&&1<this.attrInspector._numFeatures?"":"none");this.attrInspector.navMessage.innerHTML=Ma.substitute({idx:this.attrInspector._featureIdx+1,of:this.attrInspector.NLS_of,numFeatures:this.attrInspector._numFeatures},this.attrInspector._navMessage);(this.currentFeature=this.attrInspector._numFeatures?this.attrInspector._selection[this.attrInspector._featureIdx]:
null)&&this.currentFeature.attributes&&(this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes)))}),200),this.contentWrapper=this._nodesCollection.pop(),this.buttonHeader=this._buttonsWrapper.pop(),this.navButtonsDiv=this._paginationNodeCollection.pop(),this._traversal.pop(),this.currentRelatedDom&&(aa=ma.get(this.currentRelatedDom,"relatedRecordCount"))&&0===parseInt(aa,10)&&ma.set(this.currentRelatedDom,"relatedRecordCount",1),this.currentRelatedDom.click());this.currentFeature&&
this.currentFeature.attributes&&(this.currentFeature.preEditAttrs=m.parse(m.stringify(this.currentFeature.attributes)));this._relatedTablesInfo[c._layer.id]&&this._relatedTablesInfo[c._layer.id].updateFeatureInstance(c.attributes);this.config.editor.removeOnSave&&1>=this.updateFeatures.length&&1>=this._traversal.length&&!fa&&(r=!0);if(r&&!0===r)this._showTemplate(!0);else if(this.config.editor.removeOnSave&&1>=this.updateFeatures.length&&1<this._traversal.length)n.emit(this.cancelButton,"click",{cancelable:!0,
bubbles:!0});else if(this._resetEditingVariables(),this.map.setInfoWindowOnClick(!0),!0!==this.config.editor.removeOnSave||fa)this.currentFeature&&this.currentFeature.hasOwnProperty("allowDelete")?this._toggleDeleteButton(this.currentFeature.allowDelete&&this.currentLayerInfo.allowDelete):this._toggleDeleteButton(this.currentLayerInfo.allowDelete&&this.currentLayerInfo.configFeatureLayer.layerAllowsDelete),this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||
this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues),this.currentLayerInfo.featureLayer.visibleAtMapScale&&this.config.editor.hasOwnProperty("editGeometryDefault")&&!0===this.config.editor.editGeometryDefault&&setTimeout(e.hitch(this,function(){2>this._traversal.length&&(this._editGeomSwitch.set("checked",!0),this._editGeomSwitch.check())}),100),c.setSymbol(this._getSelectionSymbol(c.getLayer().geometryType,
!0));else{fa=c.getLayer();aa=new F;aa.objectIds=[c.attributes[fa.objectIdField]];var ka=this.attrInspector._selection.indexOf(c);fa.selectFeatures(aa,T.SELECTION_SUBTRACT,e.hitch(this,this._feature_removed(c,ka)))}H.resolve("success");this.config.editor.removeOnSave&&0===this.attrInspector._numFeatures||r?this._setWidgetFirstFocusNode("templatePicker",!0):this._setWidgetFirstFocusNode("AI",!0)}g.forEach(K,function(ea){b.contains(ea,"busy")&&b.remove(ea,"busy")});g.forEach(S,function(ea){b.contains(ea,
"busy")&&b.remove(ea,"busy")});b.contains(V,"hide")&&b.remove(V,"hide")}),e.hitch(this,function(){g.forEach(K,function(aa){b.contains(aa,"busy")&&b.remove(aa,"busy")});g.forEach(S,function(aa){b.contains(aa,"busy")&&b.remove(aa,"busy")});b.contains(V,"hide")&&b.remove(V,"hide")}))}return H.promise},_showTemplate:function(c){this._attrInspIsCurrentlyDisplayed=!c;c?(this._mapClickHandler(!0),this._showTemplatePicker(),this._traversal=[],this._nodesCollection=[],this._paginationNodeCollection=[],this._buttonsWrapper=
[],this._attributeInspectorCollection=[],this._relatedTablesInfo={},this.currentFeature=null,this.geometryChanged=!1,this.currentLayerInfo=null):(this._mapClickHandler(!1),d(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display="none",d(".jimu-widget-smartEditor .attributeInspectorMainDiv")[0].style.display="block",a.set(this.noFeatureWarningMessage,"display","none"),this.attrInspector&&(!this.currentFeature&&this.attrInspector&&0<this.attrInspector._numFeatures&&this.attrInspector.first(),
this.attrInspector.refresh(),this._createSmartAttributes(),this._createAttributeInspectorTools(),this._attributeInspectorTools&&this._attributeInspectorTools.triggerFormValidation(),this.currentFeature&&this.currentFeature.getLayer().originalLayerId?this._enableAttrInspectorSaveButton(this._validateAttributes()):(this._validateAttributes(!1),this._enableAttrInspectorSaveButton(!1)),this.currentLayerInfo.isCache&&!0===this.currentLayerInfo.isCache?this._toggleEditGeoSwitch(!1):this._toggleEditGeoSwitch(this.currentLayerInfo.disableGeometryUpdate||
!this.currentLayerInfo.configFeatureLayer.layerAllowsUpdate||this.currentLayerInfo.featureLayer.hasZ&&!this.currentLayerInfo.featureLayer.enableZDefaults||this.currentLayerInfo.featureLayer.hasM&&!this.currentLayerInfo.featureLayer.allowUpdateWithoutMValues),this._addWarning(),this._setWidgetFirstFocusNode("AI",!0)),this._recordLoadeAttInspector())},_createAttributeInspectorTools:function(){if(void 0!==this.currentFeature&&null!==this.currentFeature){var c=d("td.atiLabel",this.attrInspector.domNode);
void 0!==c&&null!==c&&(this._attributeInspectorTools=new ha({_attrInspector:this.attrInspector,_feature:this.currentFeature,_fieldInfo:this.currentLayerInfo.fieldInfos}))}},_createSmartAttributes:function(){if(void 0!==this.currentFeature&&null!==this.currentFeature){var c=d("td.atiLabel",this.attrInspector.domNode);void 0!==c&&null!==c&&(c=null,void 0!==this.currentLayerInfo&&null!==this.currentLayerInfo&&void 0!==this.currentLayerInfo.fieldValidations&&null!==this.currentLayerInfo.fieldValidations&&
(c=this.currentLayerInfo.fieldValidations),null!==c&&(this._smartAttributes=new ba({_attrInspector:this.attrInspector,_fieldValidation:c,_feature:this.currentFeature,_fieldInfo:this.currentLayerInfo.fieldInfos,_url:this.currentLayerInfo.featureLayer.url}),this.own(n(this._smartAttributes,"onFieldToggle",e.hitch(this,function(){this._add508SupportToAttachmentsDeleteBtn("AI")})))))}},_showTemplatePicker:function(){var c=d(".jimu-widget-smartEditor .attributeInspectorMainDiv");0<c.length&&(c[0].style.display=
"none");c=d(".jimu-widget-smartEditor .templatePickerMainDiv");0<c.length&&(c[0].style.display="block");if(this.templatePicker&&(c=0,this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(c=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow),this.config.editor.hasOwnProperty("keepTemplateSelected")?!0!==this.config.editor.keepTemplateSelected&&this._clearTemplateSelection():this._clearTemplateSelection(),
this.templatePicker)){var r=null;this.drawingTool&&this.currentDrawType&&(r=this.currentDrawType);this._activateTemplateToolbar(r);var y=c,H=null,K=null;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(H=this.templatePicker._selectedInfo,y=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow,K=this.templatePicker.getSelected(),this._selectTemplateIndex=y);this.templatePicker.update();
this.templatePicker.grid.scrollToRow(y);setTimeout(e.hitch(this,function(){null!==K&&this.templatePicker&&this.templatePicker.grid.store.fetch({onComplete:e.hitch(this,function(V){var aa=(V=this.templatePicker._locate(K,H,V))&&this.templatePicker.grid.views.views[0].getCellNode(V[0],V[1]);aa&&(this._selectTemplateIndex>this.templatePicker.grid.rowsPerPage&&this.templatePicker._rowClicked({cellNode:aa,rowIndex:V[0],cellIndex:V[1]},!0),this.templatePicker.grid.scrollToRow(y))})})}),500)}this._resetEditingVariables();
var S=[];this.updateFeatures&&g.forEach(this.updateFeatures,e.hitch(this,function(V){V=V.getLayer();S&&-1===S.indexOf(V.id)&&(S.push(V.id),V.clearSelection(),V.refresh())}));this._clearLayerSelection();this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;this._removeLocalLayers();!0===this._recreateOnNextShow&&(this._recreateOnNextShow=!1,this._createEditor());this._creationDisabledOnAll?(this.templatePicker&&C.style(this.templatePicker.domNode,"display","none"),this.drawingTool&&
C.style(this.drawingTool.domNode,"display","none")):(this.templatePicker&&C.style(this.templatePicker.domNode,"display","block"),this.drawingTool&&C.style(this.drawingTool.domNode,"display","block"));this._copyFeaturesObj&&this._copyFeaturesObj.cancelBtnClicked()},_setPresetValue:function(){this._usePresetValues=ca.byId("savePresetValueSwitch").checked},_toggleUsePresetValues:function(c){var r=ca.byId("savePresetValueSwitch");c?r.check():r.uncheck();this._usePresetValues=r.checked},_turnEditGeometryToggleOff:function(){1<
this._traversal.length||!this._editGeomSwitch||!this._editGeomSwitch.checked||(this.editToolbar&&0!==this.editToolbar.getCurrentState().tool&&this.editToolbar.deactivate(),this._editingEnabled=!1,this._ignoreEditGeometryToggle=!0,this._editGeomSwitch.set("checked",!1),this._editGeomSwitch.uncheck(),this.map.setInfoWindowOnClick(!0),setTimeout(e.hitch(this,function(){this._ignoreEditGeometryToggle=!1}),2))},_validateFeatureChanged:function(){if(this.currentFeature){if(void 0!==this.geometryChanged&&
null!==this.geometryChanged&&!0===this.geometryChanged)return!0;var c=this._changed_feature(this.currentFeature,!0),r=c[0];c=c[2];if(null!==r&&0===Object.keys(r.attributes).length&&"Add"!==c)return!1}return!0},_validateRequiredFields:function(){var c={};if(!this.currentFeature)return c;var r=this.currentFeature.getLayer();r=g.filter(r.fields,e.hitch(this,function(y){return!1===y.nullable&&!0===y.editable}));g.forEach(r,e.hitch(this,function(y){if("esriFieldTypeDate"===y.type){var H=this._getCurrentFieldDijit(y.name);
H&&0<H.length&&(null!==H[0].get("value")&&void 0!==H[0].get("value")?H[1]&&null===H[1].get("value")?(H[1].set("required",!0),H=d("td[data-fieldname\x3d"+y.name+"]",this.attrInspector.domNode)[0].parentNode,b.add(H.childNodes[1].childNodes[1],["dijitTextBoxError","dijitError"]),c[y.alias]="null"):(H=d("td[data-fieldname\x3d"+y.name+"]",this.attrInspector.domNode)[0].parentNode,b.remove(H.childNodes[1].childNodes[1],["dijitTextBoxError","dijitError"])):c[y.alias]="null")}else if("undefined"===this.currentFeature.attributes[y.name])c[y.alias]=
"undefined";else if(null===this.currentFeature.attributes[y.name])c[y.alias]="null";else switch(y.type){case "esriFieldTypeString":if(""===this.currentFeature.attributes[y.name]||this.currentFeature.attributes[y.name]&&this.currentFeature.attributes[y.name].hasOwnProperty("trim")&&""===this.currentFeature.attributes[y.name].trim())c[y.alias]="Empty string"}}));return c},_worksAfterClose:function(){t.toolbars.draw.start=this._defaultStartStr;t.toolbars.draw.addPoint=this._defaultAddPointStr},_workBeforeCreate:function(){var c=
"\x3cbr/\x3e("+this.nls.pressStr+"\x3cb\x3e"+this.nls.ctrlStr+"\x3c/b\x3e "+this.nls.snapStr+")";this._defaultStartStr=t.toolbars.draw.start;this._defaultAddPointStr=t.toolbars.draw.addPoint;t.toolbars.draw.start+=c;t.toolbars.draw.addPoint+=c},_getDefaultFieldInfos:function(c){var r=ia.getFieldInfosFromWebmap(c.id,this._jimuLayerInfos);if(void 0===r||null===r)r=ia.getFieldInfosLayer(c.id,this._jimuLayerInfos);r&&(r=g.filter(r,function(y){return y.visible||y.isEditable}));return r},_getDefaultLayerInfos:function(){for(var c=
[],r,y=this.map.graphicsLayerIds.length-1;0<=y;y--)if(r=this.map.getLayer(this.map.graphicsLayerIds[y]),"Feature Layer"===r.type&&r.url){var H={featureLayer:{}};H.featureLayer.id=r.id;H.disableGeometryUpdate=!1;H.allowUpdateOnly=!1;(r=this._getDefaultFieldInfos(r))&&0<r.length&&(H.fieldInfos=r);c.push(H)}return c},_converConfiguredLayerInfos:function(c){g.forEach(c,function(r){var y;if(!r.featureLayer.id&&r.featureLayer.url){if(y=this.getLayerObjectFromMapByUrl(this.map,r.featureLayer.url))r.featureLayer.id=
y.id}else y=this.map.getLayer(r.featureLayer.id);var H=r.featureLayer.id;r.featureLayer.hasOwnProperty("originalLayerId")&&(H=r.featureLayer.originalLayerId);if(y){var K=[],S=ia.getFieldInfosFromWebmap(H,this._jimuLayerInfos);if(void 0===S||null===S)S=ia.getFieldInfosLayer(H,this._jimuLayerInfos);g.forEach(S,function(V){V.fieldName!==y.globalIdField&&V.fieldName!==y.objectIdField&&"esriFieldTypeGeometry"!==V.type&&"esriFieldTypeOID"!==V.type&&"esriFieldTypeBlob"!==V.type&&"esriFieldTypeGlobalID"!==
V.type&&"esriFieldTypeRaster"!==V.type&&"esriFieldTypeXML"!==V.type&&(V=this.getFieldInfoFromWebmapFieldInfos(V,r.fieldInfos),!0===V.visible&&K.push(V))},this);0!==K.length&&(r.fieldInfos=K)}},this);return c},getLayerObjectFromMapByUrl:function(c,r){for(var y=null,H=0;H<c.graphicsLayerIds.length;H++){var K=c.getLayer(c.graphicsLayerIds[H]);if(K.url.toLowerCase()===r.toLowerCase()){y=K;break}}return y},getFieldInfoFromWebmapFieldInfos:function(c,r){var y={};(r=g.filter(r,function(K){return c.fieldName===
K.fieldName}))&&(y=1<=r.length?r[0]:c);y.label=void 0===y.label?c.label:y.label;y.visible=void 0===y.visible?c.visible:y.visible;y.isEditableSettingInWebmap=void 0===c.isEditable?!0:c.isEditable;y.isEditable=void 0===y.isEditable?c.isEditable:y.isEditable;y.canPresetValue=void 0===y.canPresetValue?!1:y.canPresetValue;y.format=void 0===c.format?null:c.format;for(var H in c)c.hasOwnProperty(H)&&!1===y.hasOwnProperty(H)&&(y[H]=c[H]);return y},getConfigDefaults:function(){this.config.editor.hasOwnProperty("editGeometryDefault")&&
!0===this.config.editor.editGeometryDefault?setTimeout(e.hitch(this,function(){2>this._traversal.length&&this._editGeomSwitch.domNode&&b.contains(this.widgetActiveIndicator,"widgetActive")&&this._editGeomSwitch.check()}),100):this._turnEditGeometryToggleOff()},_processConfig:function(){g.forEach(this.config.editor.configInfos,function(c){c.hasOwnProperty("_editFlag")||(c._editFlag=!0);var r=c.layerInfo.layerObject;r&&(!1===c.allowUpdateOnly?this.own(n(r,"visibility-change, scale-visibility-change",
e.hitch(this,function(){this._layerScaleClearedTimer&&clearTimeout(this._layerScaleClearedTimer);this._layerScaleClearedTimer=setTimeout(e.hitch(this,function(){this._createEditor(!1)}),200)}))):this.own(n(r,"visibility-change, scale-visibility-change",e.hitch(this,function(){this.templatePicker&&"none"!==a.get(this.templatePicker.domNode,"display")||this._getEditableLayers(this.config.editor.configInfos).then(e.hitch(this,function(){this._checkForLayersInTemplatePicker()}))}))),this._removeSpacesInLayerTemplates(r),
this.processConfigForRuntime(c),c.configFeatureLayer=c.configFeatureLayer?c.configFeatureLayer:c.featureLayer,c.featureLayer=r,c.showDeleteButton=!1)},this)},onClose:function(){this._worksAfterClose();this._mapClickHandler(!1);this._removeLayerVisibleHandler();this._unLockMapNavigation();this._coordinates&&this._coordinates.fieldsPopup&&this._coordinates.fieldsPopup.domNode&&this._coordinates.fieldsPopup.close();this.valuePicker&&this.valuePicker.hideDialog();this.templatePicker&&this.templatePicker.getSelected()&&
this.templatePicker.clearSelection();this.drawingTool&&d("[dijitpopupparent\x3d'drawingTool']").forEach(function(c){b.add(c,"hidden")})},_update:function(){},resize:function(){this._update();this._copyFeaturesObj&&!b.contains(this.copyFeaturesMainNode,"esriCTHidden")&&this._resetCopyFeatureListHeight()},onNormalize:function(){setTimeout(e.hitch(this,this._update),100)},onMinimize:function(){console.log("min")},onMaximize:function(){setTimeout(e.hitch(this,this._update),100)},addItem:function(c,r,
y,H,K,S,V){var aa=f.create("div",{"class":"esriCTItem"},null);this._createItemTitle(c,aa,K?!0:r,K,S);this._createItemContent(aa,K?!0:r,H,V);K&&(b.add(aa,"esriCTDisableToggling"),ma.set(aa.children[0],"tabindex","-1"));y.appendChild(aa);return aa},_createItemTitle:function(c,r,y,H,K){var S=f.create("div",{"class":"esriCTItemTitleContainer",tabindex:"0",role:"button","aria-label":c},r);f.create("div",{"class":"esriCTItemHighlighter"},S);var V=f.create("div",{"class":"esriCTItemTitle esriCTFloatLeft",
innerHTML:c,title:c},S);c===this.nls.relatedItemTitle&&ma.set(S,"isRelatedItem","true");1>=this._traversal.length&&K&&!K.visibleAtMapScale&&(V.style.opacity="0.3");c=f.create("div",{"class":"itemTitleArrowIcon"},S);y?b.add(c,"itemTitleUpArrow"):b.add(c,"itemTitleDownArrow");this.own(n(S,"click",e.hitch(this,function(aa){b.contains(aa.currentTarget.parentElement,"esriCTDisableToggling")||H||this._togglePanel(r)})));this.own(n(S,"keydown",e.hitch(this,function(aa){if(aa.keyCode===p.ENTER||aa.keyCode===
p.SPACE)b.contains(aa.currentTarget.parentElement,"esriCTDisableToggling")||H||this._togglePanel(r)})))},_createItemContent:function(c,r,y,H){var K=f.create("div",{"class":"esriCTItemContent esriCTRelatedItemContent"},c);H?((y=Ra.decode(this._fetchLayerDescription(y)))&&f.create("div",{"class":"editDescription",innerHTML:this.editorXssFilter.sanitize(y),role:"presentation",tabindex:"0","aria-label":Aa.stripHTML(y)},K),f.place(this.attrInspector.domNode,K,"last")):this._relatedTablesInfo[this.attrInspector._currentFeature._layer.id]&&
this._relatedTablesInfo[this.attrInspector._currentFeature._layer.id].domNode&&f.place(this._relatedTablesInfo[this.attrInspector._currentFeature._layer.id].domNode,K,"last");r&&this._togglePanel(c)},_togglePanel:function(c){var r=d(".esriCTItemTitle",c)[0];var y=d(".itemTitleArrowIcon",c)[0];var H=d(".esriCTItemContent",c)[0];var K=d(".esriCTItemHighlighter",c)[0];r&&H&&!b.contains(c,"esriCTDisableToggling")&&(b.contains(H,"esriCTItemContentActive")?(a.set(K,"backgroundColor","transparent"),b.replace(y,
"itemTitleDownArrow","itemTitleUpArrow"),r.innerHTML===this.nls.relatedItemTitle?this._setTabIndexToListItems(c,!0,"-1"):this._setTabIndexToListItems(c,!1,"-1")):(a.set(K,"backgroundColor",this.config.selectedThemeColor),b.replace(y,"itemTitleUpArrow","itemTitleDownArrow"),r.innerHTML===this.nls.relatedItemTitle?this._setTabIndexToListItems(c,!0,"0"):this._setTabIndexToListItems(c,!1,"0")),b.toggle(H,"esriCTItemContentActive"));this._setWidgetFirstFocusNode("AI",!1)},_setTabIndexToListItems:function(c,
r,y){r?(c=d(".relatedTableFields",c),g.forEach(c,e.hitch(this,function(H){ma.set(H,"tabindex",y)}))):(c=ca.findWidgets(this.attrInspector.domNode),g.forEach(c,e.hitch(this,function(H){H.focusNode&&ma.set(H.focusNode,"tabindex",y)})),g.forEach(d(".esriCTCustomButtons",this.attrInspector.domNode),e.hitch(this,function(H){ma.set(H,"tabindex",y)})),(c=d(".editDescription",this.attrInspector.domNode.parentElement))&&0<c.length&&ma.set(c[0],"tabindex",y),this._editGeomSwitch&&this._editGeomSwitch.domNode&&
ma.set(this._editGeomSwitch.domNode,"tabindex",y),this._setTabIndexToAttachmentSection(y))},_setTabIndexToAttachmentSection:function(c){if(this.attrInspector._attachmentEditor){var r;var y=this.attrInspector._attachmentEditor._attachmentList;(r=this.attrInspector._attachmentEditor._uploadForm)&&"block"===a.get(r,"display")&&ma.set(r.children[0],"tabindex",c);y&&0<y.childNodes.length&&g.forEach(y.childNodes,e.hitch(this,function(H){"#text"!==H.nodeName&&(ma.set(H.children[0],"tabindex",c),ma.set(H.children[1],
"tabindex",c))}))}},_fetchLayerDescription:function(c){var r=this.config.editor.layerInfos;this._traversal&&0<this._traversal.length?g.some(this._traversal,function(H,K){g.some(r,function(S){if(S.featureLayer.id===H)return r=S,!0});1<this._traversal.length&&K+1<this._traversal.length&&(r=r.relationshipInfos)},this):g.some(r,function(H){if(H.featureLayer.id===c)return r=H,!0});if(r.editDescription)var y=r.editDescription;"\x3cbr\x3e"===y&&(y="");return y},_getRelationshipInfo:function(c){var r=c._layer.id;
if(this._traversal&&0<this._traversal.length){var y=this.config.editor.configInfos;g.some(this._traversal,function(K,S){g.some(y,function(V){if(V.featureLayer.id===K)return y=V,!0});1<this._traversal.length&&S+1<this._traversal.length&&(y=y.relationshipInfos)},this);return y.relationshipInfos}var H=null;this.config.editor.configInfos.some(function(K){return K.featureLayer.id===r?(H=K.relationshipInfos,!0):!1});return H},_getSelectedThemeColor:function(){this.config.selectedThemeColor="#000000";var c=
this.appConfig.theme.name;var r=this.appConfig&&this.appConfig.theme&&this.appConfig.theme.styles?this.appConfig.theme.styles[0]:"default";this.appConfig&&this.appConfig.theme&&this.appConfig.theme.customStyles&&this.appConfig.theme.customStyles.mainBackgroundColor?this.config.selectedThemeColor=this.appConfig.theme.customStyles.mainBackgroundColor:l({url:"./themes/"+c+"/manifest.json",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,function(y){var H;if(y&&y.styles&&
0<y.styles.length)for(H=0;H<y.styles.length;H++){var K=y.styles[H];if(K.name===r){this.config.selectedThemeColor=K.styleColor;break}}}))},_getRelatedRecordsByRelatedQuery:function(c,r,y,H){var K=new M,S=new U,V=this._jimuLayerInfos.getLayerOrTableInfoById(y).layerObject.objectIdField;S.returnGeometry=!1;S.outSpatialReference=this.map.spatialReference;S.relationshipId=r;S.objectIds=[H];S.outFields=[V];this.loading.show();c.queryRelatedFeatures(S,e.hitch(this,function(aa){var fa=[];g.forEach(aa[H]&&
aa[H].features,function(ka){fa.push(ka.attributes[V])});this.loading.hide();K.resolve(fa)}),e.hitch(this,function(){this.loading.hide();K.resolve([])}));return K},_getCurrentFieldDijit:function(c){var r;g.some(this.attrInspector._currentLInfo.fieldInfos,e.hitch(this,function(y){if(y.name===c)return r=y.dijit,!0}));return r},_updateRefreshButtonState:function(){var c;if(this._refreshButton&&this.config.editor.enableAttributeUpdates)if(this.config.editor.enableAutomaticAttributeUpdates)b.remove(this._refreshButton,
"hidden"),b.contains(this._refreshButton,"esriCTAutoUpdateOnMode")&&this._refreshAttributes();else if(ma.has(this._refreshButton,"hasGeometryDependency"))(c=ma.get(this._refreshButton,"hasGeometryDependency"))&&b.remove(this._refreshButton,"hidden");else if(this.currentLayerInfo.fieldValues){c=!1;for(var r in this.currentLayerInfo.fieldValues){for(var y=0;y<this.currentLayerInfo.fieldValues[r].length;y++){var H=this.currentLayerInfo.fieldValues[r][y];if("Intersection"===H.actionName&&H.enabled){c=
!0;break}if("Address"===H.actionName&&H.enabled){c=!0;break}if("Coordinates"===H.actionName&&H.enabled){c=!0;break}}if(c)break}ma.set(this._refreshButton,"hasGeometryDependency",c);c&&b.remove(this._refreshButton,"hidden")}},_refreshAttributes:function(){this.config.editor.hasOwnProperty("autoSaveAttrUpdates")&&this.config.editor.autoSaveAttrUpdates&&this.currentLayerInfo&&!this.currentLayerInfo.isCache&&(this.canAutoUpdate=!1);this.loading.show();this._getCopyAttributes(this.currentLayerInfo,this.currentFeature.geometry).then(e.hitch(this,
function(c){var r=[];if(this.currentLayerInfo.fieldValues){for(var y in this.currentLayerInfo.fieldValues)for(var H=0;H<this.currentLayerInfo.fieldValues[y].length;H++){var K=this.currentLayerInfo.fieldValues[y][H],S=!1,V=!0,aa=null,fa;this.currentLayerInfo.fieldInfos&&(fa=X.getFieldInfoByFieldName(this.currentLayerInfo.fieldInfos,y));if(c&&"Intersection"===K.actionName&&K.enabled){for(aa=0;aa<K.fields.length;aa++){var ka=K.fields[aa];if(c.Intersection.hasOwnProperty(y)&&c.Intersection[y].hasOwnProperty(ka.layerId)&&
c.Intersection[y][ka.layerId].hasOwnProperty(ka.field)){aa=c.Intersection[y][ka.layerId][ka.field];fa&&"esriFieldTypeString"===fa.type&&(aa=this._getFormattedFieldValue(aa,ka));this._setValuesInDijits(y,aa);S=!0;V=!1;c.multipleValues&&c.multipleValues.hasOwnProperty(y)&&0>r.indexOf(y)&&r.push(y);break}}if(S)break}if(c&&"Address"===K.actionName&&K.enabled&&c.Address.hasOwnProperty(K.field)){aa=c.Address[K.field];this._setValuesInDijits(y,aa);V=!1;break}if(c&&"Coordinates"===K.actionName&&K.enabled){K.coordinatesSource&&
"myLocation"===K.coordinatesSource?(H=c.MyLocation.Coordinates.hasOwnProperty(K.coordinatesSystem),aa="xy"===K.field||"yx"===K.field?H?this._getOutputString(K.coordinatesSystem,c.MyLocation.Coordinates[K.coordinatesSystem],K.field):"":H?c.MyLocation.Coordinates[K.coordinatesSystem][K.field]:""):aa="xy"===K.field||"yx"===K.field?this._getOutputString(K.coordinatesSystem,c.Coordinates[K.coordinatesSystem],K.field):c.Coordinates[K.coordinatesSystem][K.field];this._setValuesInDijits(y,aa);V=!1;break}if("Preset"===
K.actionName&&K.enabled&&this._usePresetValues){V=!1;break}V&&K.enabled&&("Intersection"===K.actionName||"Address"===K.actionName||"Coordinates"===K.actionName)&&this._setValuesInDijits(y,null)}if(c)if(c.multipleValues&&0<r.length){var ea={};g.forEach(r,function(la){ea[la]=c.multipleValues[la]});c.multipleValues=ea}else c.multipleValues=null;this._addValuePicker(c)}this.loading.hide();setTimeout(e.hitch(this,function(){this.config.editor.hasOwnProperty("autoSaveAttrUpdates")&&this.config.editor.autoSaveAttrUpdates&&
this.currentLayerInfo&&!this.currentLayerInfo.isCache&&!c.multipleValues&&(this._validateFeatureChanged()&&this._autoSaveFeatureEdits(),this.canAutoUpdate=!0);$a.curNode&&$a.curNode.blur()},100))}))},_setValuesInDijits:function(c,r){var y=this._getCurrentFieldDijit(c);c=null;y&&y.set?(y.domNode&&b.contains(y.domNode,"atiTextAreaField")&&void 0!==r&&null!==r&&(r=r.toString()),y.domNode&&b.contains(y.domNode,"atiRichTextField")&&void 0!==r&&(r=null===r?"":r.toString()),y.set("value",r,!0),y.focus()):
y&&0<y.length&&(r&&(c=new Date(r)),y[0]&&y[0].set("value",c,!0),1<y.length&&y[1]&&y[1].set("value",c,!0))},_getOrClearSelectableLayers:function(c){var r,y,H=!1,K=!1;var S=[];if(!this.initialLoad&&void 0!==this.initialLoad){c&&(r=Wa.getInstance());this.config.editor.hasOwnProperty("copyLineToPoint")&&this.config.editor.copyLineToPoint.enabled&&(H=!0);this.config.editor.hasOwnProperty("copyPolygonToPoint")&&this.config.editor.copyPolygonToPoint.enabled&&(K=!0);if(this.templatePicker&&(y=this.templatePicker.getSelected())){var V=
y.featureLayer;V=V.geometryType}for(var aa in this.map._layers)this.map._layers.hasOwnProperty(aa)&&(y=this.map._layers[aa],y.hasOwnProperty("type")&&"Feature Layer"===y.type&&(c?r.clearSelection(y):V&&y.hasOwnProperty("geometryType")&&y.geometryType===V?S.push(y):"esriGeometryPoint"===V&&("esriGeometryPolyline"===y.geometryType&&H||"esriGeometryPolygon"===y.geometryType&&K)&&S.push(y)));if(!c)return S}},_getSelectedFeature:function(){var c=[];var r=this._getOrClearSelectableLayers(!1);g.forEach(r,
e.hitch(this,function(y){c=c.concat(y.getSelectedFeatures())}));return c},_initializeSelectToolWidget:function(){this.graphicsSelectionBuffer=null;this._selectTool=new lb({map:this.map,updateSelection:!0,geoTypes:["POLYGON","EXTENT","FREEHAND_POLYGON"],fullyWithin:!1});this._selectTool.setFeatureLayers(this._getOrClearSelectableLayers(!1));this.own(n(this._selectTool.drawBox,"draw-end",e.hitch(this,function(c){this.graphicsSelectionBuffer=c.geometry})));this.own(n(this._selectTool,"unloading",e.hitch(this,
function(){this.loading.show();var c=this._getSelectedFeature();var r=this._getGraphicsArray();r=this._getValidGraphics(r);r=r.filter(e.hitch(this,function(y){return Ya.intersects(this.graphicsSelectionBuffer,y.geometry)}));g.forEach(r,e.hitch(this,function(y){c.push(y)}));0===c.length?B({message:this.nls.noFeatureSelectedMessage}):(this._selectTool.deactivate(),this._copyFeaturesObj||this._createCopyFeaturesInstance(),r=this._getLayerInfoByID(this.templatePicker.getSelected().featureLayer.id),this._copyFeaturesObj.selectFeaturesToCopy(c,
r),this._setWidgetFirstFocusNode("copyFeatures",!0),this._getOrClearSelectableLayers(!0),this._displayCopyFeatureDiv(),this._resetCopyFeatureListHeight(),this.graphicsSelectionBuffer=null);this.loading.hide()})))},_getGraphicsArray:function(){var c=[],r=this._getlLayerIdsToSkip(),y;for(y in this.map._layers)if(this.map._layers.hasOwnProperty(y)){var H=this.map._layers[y];-1===r.indexOf(y)&&!H.type&&H.graphics&&0<H.graphics.length&&(c=c.concat(H.graphics))}return c},_getValidGraphics:function(c){var r=
!1,y=!1,H=[],K=this.templatePicker.getSelected().featureLayer.geometryType;this.config.editor.hasOwnProperty("copyLineToPoint")&&this.config.editor.copyLineToPoint.enabled&&(r=!0);this.config.editor.hasOwnProperty("copyPolygonToPoint")&&this.config.editor.copyPolygonToPoint.enabled&&(y=!0);switch(K){case "esriGeometryPoint":var S="point";break;case "esriGeometryPolyline":S="polyline";break;case "esriGeometryPolygon":S="polygon"}g.forEach(c,e.hitch(this,function(V){V.geometry&&V.geometry.type&&(S===
V.geometry.type&&H.push(V),"point"===S&&("polyline"===V.geometry.type&&r||"polygon"===V.geometry.type&&y)&&H.push(V))}));return H},_resetCopyFeatureListHeight:function(){var c=d(".esriCTCopyFeaturesListTitle",this.copyFeaturesMainNode);c&&0<c.length&&(c=c[0]);c=a.getComputedStyle(c).height;c=parseFloat(c);c+=5;var r=d(".esriCTCopyFeaturesHint",this.copyFeaturesMainNode);r&&0<r.length&&(r=r[0]);r=a.getComputedStyle(r).height;r=parseFloat(r);r+=5;var y=0;this._copyFeaturesObj&&"none"!==this._copyFeaturesObj.applyEditsProgress.domNode.style.display&&
(y=a.getComputedStyle(this._copyFeaturesObj.applyEditsProgress.domNode).height,y=parseFloat(y),y+=5);var H=d(".esriCTCopyFeaturesListContent",this.copyFeaturesMainNode);H&&0<H.length&&(H=H[0]);var K=0,S=d(".esriCTCopyFeaturesBtnContainer",this.copyFeaturesMainNode);S&&0<S.length&&g.forEach(S,e.hitch(this,function(V){V=a.getComputedStyle(V).height;V=parseFloat(V);K+=V}));S=a.getComputedStyle(this.copyFeaturesMainNode).height;S=parseFloat(S);a.set(H,"height",S-(c+K+r+y)+"px")},_removeCopyFeaturesInstance:function(){this._copyFeaturesObj.highlightGraphicsLayer.clear();
this._hideCopyFeatureDiv();this._destroyCopyFeatureInstance()},_createCopyFeaturesInstance:function(){this._copyFeaturesObj=new mb({nls:this.nls,layerInfosObj:this._jimuLayerInfos,mainNode:this.copyFeaturesMainNode,appUtils:this.appUtils,map:this.map,parentDomNode:this.domNode,hideMultipleFeatureButton:this._layerHasUniqueFields(),widgetId:this.widgetId,config:this.config,editUtils:ia,fieldMappingDetails:this.fieldMappingDetails,usePresetValues:this._usePresetValues},f.create("div",{},this.copyFeaturesMainNode));
this.own(n(this._copyFeaturesObj,"createSingleFeature",e.hitch(this,function(c){this.loading.show();this._copyFeaturesObj.highlightGraphicsLayer.clear();this._hideCopyFeatureDiv();this._destroyCopyFeatureInstance();c=this._createSingleGeometry(c);var r=this.templatePicker.getSelected().featureLayer;r=this._getLayerInfoByID(r.id);var y=this._updateAllSelectedGeometries([c.graphic],r,c.layerObj)[0];y.layer=c.layerObj;this._checkAndUpdateFeatureGeometry([y],r).then(e.hitch(this,function(H){(y=H[0])?
this._addGraphicToLocalLayer(y,y.attributes):this.loading.hide()}))})));this.own(n(this._copyFeaturesObj,"createMultipleFeatures",e.hitch(this,function(c){this.loading.show();this.allSelectedGeometries=null;if(c&&0<c.length)if(1===c.length){this._removeCopyFeaturesInstance();var r=this.templatePicker.getSelected().featureLayer;r=this._getLayerInfoByID(r.id);var y=this._updateAllSelectedGeometries(c,r)[0];this._checkAndUpdateFeatureGeometry([y],r).then(e.hitch(this,function(H){y=H[0];this.templatePicker.hasOwnProperty("_selectedInfo")&&
this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(this._selectTemplateIndex=this.templatePicker._selectedInfo.selRow);y?this._addGraphicToLocalLayer(y,y.attributes):this.loading.hide()}))}else this.allSelectedGeometries=c,setTimeout(e.hitch(this,function(){this._addSelectedFeatureInTheLayer(c)}),100);else this._removeCopyFeaturesInstance()})));this.own(n(this._copyFeaturesObj,"cancelBtnClicked",e.hitch(this,function(){this._onCopyFeatureCancelButtonClicked()})));this._copyFeaturesObj.startup()},
_layerHasUniqueFields:function(){var c,r=!1;(c=this.templatePicker.getSelected().featureLayer)&&c.indexes&&0<c.indexes.length&&g.some(c.indexes,e.hitch(this,function(y){var H=m.parse(c._json);if(H.hasOwnProperty("geometryField")){if(y.isUnique&&y.fields!==c.objectIdField&&y.fields!==c.globalIdField&&y.fields!==H.geometryField.name)return r=!0}else if(y.isUnique&&y.fields!==c.objectIdField&&y.fields!==c.globalIdField)return r=!0}));return r},_destroyCopyFeatureInstance:function(){this._copyFeaturesObj&&
(this._copyFeaturesObj.destroy(),this._copyFeaturesObj=null);f.empty(this.copyFeaturesMainNode)},_onCopyFeatureCancelButtonClicked:function(){this._hideCopyFeatureDiv();this._destroyCopyFeatureInstance();this._setWidgetFirstFocusNode("templatePicker",!0);this.templatePicker&&this.templatePicker.clearSelection()},_isNumeric:function(c){return!isNaN(parseFloat(c))&&isFinite(c)},_isGuid:function(c,r){if(!0===r&&(""===c||null===c))return!0;if(""===c||null===c)return!1;"{"===c[0]&&(c=c.substring(1,c.length-
1));return/^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi.test(c)},_checkFeatureData:function(c,r){g.forEach(c,function(y){if(r.hasOwnProperty(y.fieldName))switch(y.type){case "esriFieldTypeString":0<y.length&&null!==r[y.fieldName]&&void 0!==r[y.fieldName]&&r[y.fieldName].length>y.length&&(r[y.fieldName]=r[y.fieldName].substring(0,y.length));break;case "esriFieldTypeGUID":this._isGuid(r[y.fieldName],!1)&&("{"!==r[y.fieldName][0]&&(r[y.fieldName]=
"{"+r[y.fieldName]),"}"!==r[y.fieldName][r[y.fieldName].length-1]&&(r[y.fieldName]+="}"));break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":this._isNumeric(r[y.fieldName])&&(r[y.fieldName]=parseFloat(r[y.fieldName]));break;case "esriFieldTypeDate":this._isNumeric(r[y.fieldName])&&(r[y.fieldName]=parseInt(r[y.fieldName],10));break;case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":this._isNumeric(r[y.fieldName])&&(r[y.fieldName]=parseInt(r[y.fieldName],10))}},this);return r},_addSelectedFeatureInTheLayer:function(c){var r=
["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeDouble","esriFieldTypeSingle"],y=this.templatePicker.getSelected()||this._currentSelectedTemplate;var H=[];this.copyMultipleFeatureGraphics=[];this.requiredFieldsArray=this.nullAttributeCountRecord=null;var K=this._getLayerInfoByID(y.featureLayer.id),S=!1,V;for(V in K.fieldValues){for(var aa=K.fieldValues[V],fa=0;fa<aa.length;fa++)"Coordinates"===aa[fa].actionName&&aa[fa].enabled&&aa[fa].hasOwnProperty("coordinatesSource")&&"myLocation"===
aa[fa].coordinatesSource&&(S=!0);if(S)break}c=this._updateAllSelectedGeometries(c,K);this._checkAndUpdateFeatureGeometry(c,K).then(e.hitch(this,function(ka){this.nullAttributeCountRecord={};y&&y.template&&y.template.prototype&&y.template.prototype.attributes&&(this.nullAttributeCountRecord=e.clone(y.template.prototype.attributes));for(var ea in this.nullAttributeCountRecord)this.nullAttributeCountRecord[ea]=0;this.requiredFieldsArray=this._getRequiredFields(K.fieldInfos);this._myLocationInfoForMultipleFeatures=
null;this._getMyLocationInfo(S).then(e.hitch(this,function(la){this._myLocationInfoForMultipleFeatures=la;g.forEach(ka,e.hitch(this,function(oa){oa=this._getCopyAttributes(K,oa.geometry,!0);H.push(oa)}));E(H).then(e.hitch(this,function(oa){g.forEach(ka,e.hitch(this,function(va,ya){ya=oa[ya];var Ca=e.clone(va.attributes),ta={};y&&y.template&&y.template.prototype&&y.template.prototype.attributes&&(ta=e.clone(y.template.prototype.attributes));for(var za=0;za<this.requiredFieldsArray.length;za++)ta.hasOwnProperty(this.requiredFieldsArray[za])||
(ta[this.requiredFieldsArray[za]]=null,this.nullAttributeCountRecord.hasOwnProperty(this.requiredFieldsArray[za])||(this.nullAttributeCountRecord[this.requiredFieldsArray[za]]=0));za=y.featureLayer.id;var Ea=va.layer.id;if(this.fieldMappingDetails[za]&&this.fieldMappingDetails[za][Ea]){for(var Pa in this.fieldMappingDetails[za][Ea])ta.hasOwnProperty(Pa)||(ta[Pa]=null);for(var Ga in ta){var Ha;if(!ta.hasOwnProperty(Ga)||null===ta[Ga]||this.config.editor.overrideDefaultsByCopiedFeature){var Ja=this.fieldMappingDetails[za][Ea][Ga];
var Ta=this.templatePicker.getSelected().featureLayer.getField(Ga);Ja&&(this._jimuLayerInfos.getLayerInfoById(Ea)&&this._jimuLayerInfos.getLayerInfoById(Ea).layerObject&&(Ha=this._jimuLayerInfos.getLayerInfoById(Ea).layerObject.getField(Ja)),Ha&&Ha.domain&&Ha.domain.codedValues&&!Ta.domain?g.some(Ha.domain.codedValues,e.hitch(this,function(Ua){if(Ua.code===Ca[Ja])return-1!==r.indexOf(Ta.type)?ta[Ga]=Ua.code:ta[Ga]=Ua.name,!0})):Ha&&"esriFieldTypeDate"===Ha.type&&"esriFieldTypeDate"!==Ta.type&&Ca[Ja]?
(Pa=this._getPopupFieldInfo(Ja,this._jimuLayerInfos.getLayerInfoById(Ea)),ta[Ga]=Aa.getDateTimeStrByFieldInfo(Ca[Ja],Pa)):ta[Ga]=Ca[Ja])}}}else for(Ga in Ca)if(!ta.hasOwnProperty(Ga)||null===ta[Ga]||this.config.editor.overrideDefaultsByCopiedFeature)ta[Ga]=Ca[Ga];this._modifyAttributesWithPresetValues(ta,K,ya);for(var La in ta)Ha=this._trimAttrValue(ta[La]),-1!==this.requiredFieldsArray.indexOf(La)&&ta.hasOwnProperty(La)&&-1!==[null,void 0,""].indexOf(Ha)&&(this.nullAttributeCountRecord[La]+=1);this.copyMultipleFeatureGraphics.push({attributes:ta,
geometry:va.geometry})}));var ua=[],wa;for(wa in this.nullAttributeCountRecord)0<this.nullAttributeCountRecord[wa]&&ua.push(X.getFieldInfoByFieldName(K.fieldInfos,wa));if(0<ua.length)this.loading.hide(),ua=new ob({requiredFieldsInfos:ua,nls:this.nls,presetUtils:X,AttributesCount:this.nullAttributeCountRecord}),this.own(n(ua,"providedValuesToRequiredFields",e.hitch(this,function(va){this.loading.show();var ya=[];g.forEach(this.copyMultipleFeatureGraphics,e.hitch(this,function(Ca){var ta=Ca.attributes,
za;for(za in ta){var Ea=this._trimAttrValue(ta[za]);-1!==this.requiredFieldsArray.indexOf(za)&&ta.hasOwnProperty(za)&&-1!==[null,void 0,""].indexOf(Ea)&&(ta[za]=va[za])}ta=this._checkFeatureData(K.fieldInfos,ta);Ca=new Q(Ca.geometry,null,ta);Ca.preEditAttrs=m.parse(m.stringify(Ca.attributes));ya.push(Ca)}));this._applyEdits(ya)})));else{var Ba=[];g.forEach(this.copyMultipleFeatureGraphics,e.hitch(this,function(va){var ya=va.attributes;ya=this._checkFeatureData(K.fieldInfos,ya);va=new Q(va.geometry,
null,ya);va.preEditAttrs=m.parse(m.stringify(va.attributes));Ba.push(va)}));this._applyEdits(Ba)}}),e.hitch(this,function(oa){this.loading.hide();B({message:this.nls.addingFeatureError+" "+oa.message})}))}))}))},_getPopupFieldInfo:function(c,r){var y;if(y=r.getPopupInfo())r=y.fieldInfos,g.some(r,function(K){if(K.fieldName===c)return H=K,!0});else var H=Aa.getPopupFieldFromLayerField(r.layerObject.getField(c));return H},_applyEdits:function(c){var r=[];this._copyFeaturesObj.setProgressPercentage(0);
this._resetCopyFeatureListHeight();c=this._createApplyEditsChunks(c);E(c).then(e.hitch(this,function(y){var H=0;g.forEach(y,e.hitch(this,function(S){g.forEach(S,e.hitch(this,function(V){r.push(V);H++}))}));0===H&&this._removeCopyFeaturesInstance();if(0<H){y=this._getLayerInfoByID(this.templatePicker.getSelected().featureLayer.id);this._copyFeaturesObj.selectFeaturesToCopy(r,y);var K=Ia.substitute(this.nls.addingFeatureErrorCount,{copyFeatureErrorCount:H})}0===this.objectIdArr.length&&0<H?(this.loading.hide(),
this._promptUserToCopyFailedFeatures(K)):(0<this.objectIdArr.length&&0<H&&this._promptUserToCopyFailedFeatures(K),this._selectFeaturesInTheLayer(this.objectIdArr));this.loading.hide()}))},_changeSelectToolState:function(c){this._getOrClearSelectableLayers(!1===c||void 0===c?!1:!0);("EXTENT"===this.currentDrawType||"POLYGON"===this.currentDrawType||"FREEHAND_POLYGON"===this.currentDrawType)&&this.templatePicker&&this.templatePicker.getSelected()&&this._selectTool?this._selectTool.activate():this._selectTool&&
this._selectTool.isActive()&&this._selectTool.deactivate();this.currentDrawType&&this.map.setInfoWindowOnClick(!1)},_addMenuItem:function(c,r,y){c=e.mixin(c,{onClick:e.hitch(this,this._drawingToolClick(y,c))});c=new xa(c);r.addChild(c)},_hideCopyFeatureDiv:function(){b.add(this.copyFeaturesMainNode,"esriCTHidden");d(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display="block";var c=null,r=null;if(this.templatePicker&&this.templatePicker.grid){c=this.templatePicker.getSelected();var y=
0;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(r=this.templatePicker._selectedInfo,y=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow);this.templatePicker.update();this.templatePicker.grid.scrollToRow(y);setTimeout(e.hitch(this,function(){this.config.editor.hasOwnProperty("keepTemplateSelected")&&!0===this.config.editor.keepTemplateSelected&&null!==c&&this.templatePicker.grid.store.fetch({onComplete:e.hitch(this,
function(H){var K=(H=this.templatePicker._locate(c,r,H))&&this.templatePicker.grid.views.views[0].getCellNode(H[0],H[1]);K&&y>this.templatePicker.grid.rowsPerPage&&this.templatePicker._rowClicked({cellNode:K,rowIndex:H[0],cellIndex:H[1]},!0)})});this.templatePicker.grid.scrollToRow(y)}),500)}},_displayCopyFeatureDiv:function(){d(".jimu-widget-smartEditor .templatePickerMainDiv")[0].style.display="none";b.remove(this.copyFeaturesMainNode,"esriCTHidden");if("DashboardTheme"===this.appConfig.theme.name){var c=
d(".esriCTCopyFeaturesMainDiv",this.domNode)[0];var r=a.get(c.parentElement).backgroundColor;a.set(c,"backgroundColor",r)}},_createSingleGeometry:function(c){var r;(r=c[0]._layer.geometryType)||(r=this._getGeometryTypeFromGraphic(c[0].geometry.type));if("esriGeometryPolyline"===r)var y=this._createSinglePolyline(c);else"esriGeometryPolygon"===r?y=this._createSinglePolygon(c):"esriGeometryPoint"===r&&(y=c[0].geometry);return{graphic:new Q(y,null,c[0].attributes),layerObj:c[0].getLayer()}},_createSinglePolyline:function(c){var r=
new da(new Sa(c[0].geometry.spatialReference));g.forEach(c,e.hitch(this,function(y){y.geometry&&y.geometry.paths&&g.forEach(y.geometry.paths,function(H){r.addPath(H)})}));return r},_createSinglePolygon:function(c){var r=new N(new Sa(c[0].geometry.spatialReference));g.forEach(c,e.hitch(this,function(y){y.geometry&&y.geometry.rings&&g.forEach(y.geometry.rings,function(H){r.addRing(H)})}));return r},_selectFeaturesInTheLayer:function(c){var r=(this.templatePicker.getSelected()||this._currentSelectedTemplate).featureLayer;
var y=this._getLayerInfoByID(r.id);this.map.infoWindow.hide();g.forEach(this._attributeInspectorCollection,function(S){S.destroy()});if(r.isQueryable()){this._traversal=[];this._nodesCollection=[];this._paginationNodeCollection=[];this._buttonsWrapper=[];this._attributeInspectorCollection=[];this._relatedTablesInfo={};this._createAttributeInspector([y],!0,r);y=this.map.getLayersVisibleAtScale().filter(e.hitch(this,function(S){return S.type&&"Feature Layer"===S.type&&S.url?g.some(this.config.editor.configInfos,
e.hitch(this,function(V){return V.layerId===S.id&&this._hasAnyEditableLayerInRelation([V])?!0:!1})):!1}));y=y.filter(e.hitch(this,function(S){try{return this.map.getLayer(S.id).visible}catch(V){return console.log(V+" Check for visible failed"),!0}}));var H=[];this.currentFeature=null;this.geometryChanged=!1;this.currentLayerInfo=null;y=new F;var K=Date.now();y.objectIds=c;y.where=K+" \x3d "+K;y.outFields=["*"];r.selectFeatures(y,T.SELECTION_NEW,e.hitch(this,function(S){var V=[];g.forEach(S,function(aa){aa.allowDelete=
!0;r.getEditCapabilities({feature:aa}).canDelete||(aa.allowDelete=!1);aa.preEditAttrs=m.parse(m.stringify(aa.attributes));V.push(aa)},this);H=H.concat(V);0<H.length&&(this.updateFeatures=H,this.config.editor.removeOnSave?(this.loading.hide(),this._copyFeaturesObj||this._clearTemplateSelection()):this._showTemplate(!1))}),e.hitch(this,function(){B({message:this.nls.selectingFeatureError});this.loading.hide()}))}else this.loading.hide()},_clearTemplateSelection:function(){var c=null,r=null;if(this.templatePicker&&
this.templatePicker.grid){c=this.templatePicker.getSelected();var y=this._selectTemplateIndex;this.templatePicker._selectedInfo&&this.templatePicker._selectedInfo.hasOwnProperty("selRow")&&(r=this.templatePicker._selectedInfo,this._selectTemplateIndex=y=0<this.templatePicker._selectedInfo.selRow?this.templatePicker._selectedInfo.selRow-1:this.templatePicker._selectedInfo.selRow);this.templatePicker.grid.scrollToRow(y);setTimeout(e.hitch(this,function(){this.templatePicker&&(this.templatePicker.clearSelection(),
this.config.editor.hasOwnProperty("keepTemplateSelected")&&!0===this.config.editor.keepTemplateSelected&&null!==c&&this.templatePicker.grid.store.fetch({onComplete:e.hitch(this,function(H){var K=(H=this.templatePicker._locate(c,r,H))&&this.templatePicker.grid.views.views[0].getCellNode(H[0],H[1]);K&&(this.templatePicker._rowClicked({cellNode:K,rowIndex:H[0],cellIndex:H[1]},!0),this._activateTemplateToolbar(null),this.templatePicker.grid.scrollToRow(y))})}),this._selectTemplateIndex=0,this.templatePicker.grid.scrollToRow(y))}),
500)}},_updatedDrawingOptions:function(){for(var c in Fa)g.forEach(Fa[c],e.hitch(this,function(r,y){r.hasOwnProperty("_drawType")&&("EXTENT"===r._drawType?Fa[c][y].label=this.nls.copyFeaturesWithRect:"POLYGON"===r._drawType?Fa[c][y].label=this.nls.copyFeaturesWithPolygon:"FREEHAND_POLYGON"===r._drawType&&(Fa[c][y].label=this.nls.copyFeaturesWithLasso))}))},_deactivateAllTools:function(){this.drawToolbar&&this.drawToolbar.deactivate();this._selectTool&&this._selectTool.deactivate()},_updateAllSelectedGeometries:function(c,
r,y){var H=[],K=this._getInfoDetails(r);g.forEach(c,e.hitch(this,function(S){var V=S.getLayer();if(null===V||""===V||void 0===V)V=y;var aa=this._getLayerInfoByID(V.id);aa||(aa=this._jimuLayerInfos.getLayerOrTableInfoById(V.id)?ia.createDefaultConfigInfo(this._jimuLayerInfos.getLayerOrTableInfoById(V.id)):this._jimuLayerInfos.getLayerInfoById(V.id)?ia.createDefaultConfigInfo(this._jimuLayerInfos.getLayerInfoById(V.id)):V);if(aa){aa=aa.fieldInfos?this._getInfoDetails(aa):S.attributes&&0<Object.keys(S.attributes).length?
this._createGraphicLayerFields(S):[];var fa={};var ka=r.featureLayer.id;if(this.fieldMappingDetails[ka]&&this.fieldMappingDetails[ka][V.id])fa=e.clone(S.attributes);else for(var ea in S.attributes)ka=ea.toLowerCase(),K.hasOwnProperty(ka)&&aa.hasOwnProperty(ka)&&K[ka].type===aa[ka].type&&(fa[K[ka].name]=e.clone(S.attributes[ea]));S=new Q(S.geometry,null,fa);S.layer=V;H.push(S)}}));return H},_checkAndUpdateFeatureGeometry:function(c,r){var y=[];var H=new M;g.forEach(c,e.hitch(this,function(K){var S=
K.layer.geometryType;S||(S=this._getGeometryTypeFromGraphic(K.geometry.type));S!==r.featureLayer.geometryType&&y.push(this._getUpdatedGeometry(S,K))}));E(y).then(e.hitch(this,function(){H.resolve(c)}));return H.promise},_getUpdatedGeometry:function(c,r){var y=new M;featureGeometry=r.geometry;if("esriGeometryPolygon"===c)c=featureGeometry.getCentroid(),Ya.intersects(c,featureGeometry)?(r.geometry=featureGeometry.getCentroid(),y.resolve()):this.geometryService.labelPoints([featureGeometry],e.hitch(this,
function(K){r.geometry=K[0];y.resolve()}));else{c=0;var H=new da({paths:featureGeometry.paths.flat(),spatialReference:featureGeometry.spatialReference});"end"===this.config.editor.copyLineToPoint.type&&(c=H.paths.length-1);r.geometry=new Oa(H.paths[c][0],H.paths[c][1],this.map.spatialReference);y.resolve()}return y.promise},_getInfoDetails:function(c){var r={};g.forEach(c.fieldInfos,e.hitch(this,function(y){r[y.name.toLowerCase()]={name:y.name,type:y.type}}));return r},_setWidgetFirstFocusNode:function(c,
r){c=this._getFirstAndLastFocusNode(c);c.firstNode&&c.lastNode&&(Aa.initFirstFocusNode(this.domNode,c.firstNode),Aa.initLastFocusNode(this.domNode,c.lastNode),r&&Aa.isAutoFocusFirstNodeWidget(this)&&Aa.focusFirstFocusNode(this.domNode))},_getFirstAndLastFocusNode:function(c){var r={};if("templatePicker"===c)r.firstNode=this._getFirstFocusNodeForTemplatePickerScreen(),r.lastNode=this._getLastFocusNodeForTemplatePickerScreen();else if("AI"===c){if(this.attrInspector&&this.attrInspector.attributeTable){var y,
H;c=ca.findWidgets(this.attrInspector.attributeTable);this.attrInspector.domNode.parentElement&&this.attrInspector.domNode.parentElement.parentElement&&((y=d(".esriCTItemContent",this.attrInspector.domNode.parentElement.parentElement))&&0<y.length&&(H=b.contains(y[0],"esriCTItemContentActive")?"0":"-1"),this._setTabIndexToListItems(null,!1,H));g.forEach(c,e.hitch(this,function(K){K.focusNode&&ma.get(K.focusNode,"disabled")&&(ma.set(K.focusNode,"disabled",!1),ma.set(K.focusNode,"readonly",!0));if(K.focusNode&&
K.domNode.parentElement&&K.domNode.parentElement.parentElement){var S=d(".atiLabel",K.domNode.parentElement.parentElement);S&&S[0]&&(S=S[0].innerHTML,0<=S.indexOf('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e')?(S=S.replace('\x3ca class\x3d"asteriskIndicator"\x3e *\x3c/a\x3e',""),ma.set(K.focusNode,"aria-required","true")):0<=S.indexOf('\x3cspan class\x3d"atiRequiredField"\x3e *\x3c/span\x3e')?(S=S.replace('\x3cspan class\x3d"atiRequiredField"\x3e *\x3c/span\x3e',""),ma.set(K.focusNode,"aria-required",
"true")):ma.set(K.focusNode,"aria-required","false"),ma.set(K.focusNode,"aria-label",S))}}))}r.firstNode=this._getFirstFocusNodeForAttributeInspectorScreen();r.lastNode=this._getLastFocusNodeForAttributeInspectorScreen()}else"copyFeatures"===c?r=this._getFirstAndLastFocusNodeForCopyFeaeturesScreen():"noFeatures"===c&&(r.firstNode=this.noFeatureMessage,r.lastNode=this.noFeatureCancelBtn);return r},_getFirstFocusNodeForTemplatePickerScreen:function(){if(this.config.editor.hasOwnProperty("displayPresetTop")&&
!0===this.config.editor.displayPresetTop&&"block"===a.get(this.presetFieldsTableDiv,"display"))var c=ca.byId("savePresetValueSwitch").domNode;else"block"===a.get(this.templateTitle,"display")?c=this.templateTitle:this.config.editor.useFilterEditor?c=this._filterEditor.selectDropDown:this.drawingTool&&!0===this.config.editor.displayShapeSelector||this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting?c=this.drawingTool.focusNode:this.config.editor.autoSaveEdits?
c=ca.byId("autoSaveSwitch").domNode:"block"===a.get(this.presetFieldsTableDiv,"display")&&(c=ca.byId("savePresetValueSwitch").domNode);return c},_getLastFocusNodeForTemplatePickerScreen:function(){if(this.config.editor.hasOwnProperty("displayPresetTop")&&!1===this.config.editor.displayPresetTop&&"block"===a.get(this.presetFieldsTableDiv,"display")){var c=d("#eePresetValueBody")[0];c&&(c=d(".preset-value-editable .ee-inputField"),c.reverse(),g.some(c,e.hitch(this,function(y){if(!b.contains(y.parentElement.parentElement,
"esriCTHidden"))return r=1<y.parentElement.children.length?y.parentElement.children[1]:y,!0})));if(!r)var r=ca.byId("savePresetValueSwitch").domNode}else if(this.config.editor.autoSaveEdits&&!this._creationDisabledOnAll)r=ca.byId("autoSaveSwitch").domNode;else if((!0===this.config.editor.displayShapeSelector||this.config.editor.hasOwnProperty("createNewFeaturesFromExisting")&&!0===this.config.editor.createNewFeaturesFromExisting)&&!this._creationDisabledOnAll&&this.drawingTool)r=this.drawingTool.focusNode;
else if(this._filterEditor&&this.config.editor.useFilterEditor&&!this._creationDisabledOnAll)r=this._filterEditor.filterTextBox;else if("block"===a.get(this.templateTitle,"display"))r=this.templateTitle;else if("block"===a.get(this.presetFieldsTableDiv,"display")){if(c=d("#eePresetValueBody")[0])c=d(".preset-value-editable .ee-inputField"),c.reverse(),g.some(c,e.hitch(this,function(y){if(!b.contains(y.parentElement.parentElement,"esriCTHidden"))return r=1<y.parentElement.children.length?y.parentElement.children[1]:
y,!0}));r||(r=ca.byId("savePresetValueSwitch").domNode)}return r},_getFirstFocusNodeForAttributeInspectorScreen:function(){if(this.config.editor.showActionButtonsAbove)var c=this.cancelButton;else if(1===this.attrInspector._numFeatures){var r=d(".esriCTItem",this.contentWrapper);var y=d(".editDescription",this.contentWrapper);r&&0<r.length&&!b.contains(r[0],"esriCTDisableToggling")?c=r[0].children[0]:y&&0<y.length?c=y[0]:this.attrInspector&&this.attrInspector.attributeTable&&(r=ca.findWidgets(this.attrInspector.attributeTable),
g.some(r,e.hitch(this,function(H){if(H.focusNode&&!b.contains(H.domNode.parentElement.parentElement,"hideField"))return c=H.focusNode,!0})),!c&&this.attrInspector._attachmentEditor&&"block"===a.get(this.attrInspector._attachmentEditor.domNode,"display")&&((r=this.attrInspector._attachmentEditor._attachmentList.childNodes)&&0<r.length&&r[0].children?c=r[0].children[0]:c||this.attrInspector._attachmentEditor._uploadForm&&"block"===a.get(this.attrInspector._attachmentEditor._uploadForm,"display")&&(c=
this.attrInspector._attachmentEditor._uploadForm.children[0])),!c&&this.attrInspector._attachmentUploader&&this.attrInspector._attachmentUploader.attachmentUploader&&(r=d("form",this.attrInspector._attachmentUploader.attachmentUploader))&&0<r.length&&(r=r[0],c="none"!==a.get(r.children[0],"display")?r.children[0]:r.children[1]),2>this._traversal.length&&this._editGeomSwitch.domNode&&!c&&"block"===a.get(this._editGeomSwitch.domNode.parentNode,"display")&&(c=this._editGeomSwitch.domNode),c||(c=this.cancelButton))}else 1<
this.attrInspector._numFeatures&&this.attrInspector.navButtons&&(c=ca.findWidgets(this.attrInspector.navButtons)[0].focusNode);return c},_getLastFocusNodeForAttributeInspectorScreen:function(){if(!this.config.editor.showActionButtonsAbove){var c=d(".saveButton",this.buttonHeader)[0];if(c&&b.contains(c,"jimu-state-disabled"))if(c=d(".deleteButton",this.buttonHeader),0<c.length){c=c[0];var r="block"===a.get(c,"display")?c:this.cancelButton}else r=this.cancelButton;else r=c}c=d(".detailsContainer",this.mainContainer);
c=g.filter(c,function(y){if(!b.contains(y,"hidden"))return y});c=d(".esriCTRelatedItemContent",c[0]);!r&&c&&0<c.length&&(b.contains(c[0],"esriCTItemContentActive")?r=d(".esriCTLastRelatedItem",c[0])[0]:(c=d("[isrelateditem\x3dtrue]",this.mainContainer))&&0<c.length&&(r=c[c.length-1]));r||(c=d(".esriCTActionButtons",this.attrInspector.domNode),g.forEach(c,e.hitch(this,function(y){"block"===a.get(y,"display")&&(r=y)})));2>this._traversal.length&&this._editGeomSwitch.domNode&&!r&&"block"===a.get(this._editGeomSwitch.domNode.parentNode,
"display")&&(r=this._editGeomSwitch.domNode);!r&&this.attrInspector._attachmentEditor&&"block"===a.get(this.attrInspector._attachmentEditor.domNode,"display")&&(this.attrInspector._attachmentEditor._uploadForm&&"block"===a.get(this.attrInspector._attachmentEditor._uploadForm,"display")?r=this.attrInspector._attachmentEditor._uploadForm:(c=this.attrInspector._attachmentEditor._attachmentList.childNodes)&&0<c.length&&(c=c[c.length-1],r="block"===a.get(c.children[1],"display")?c.children[1]:c.children[0]));
!r&&this.attrInspector&&this.attrInspector.attributeTable&&(c=ca.findWidgets(this.attrInspector.attributeTable),c.reverse(),g.some(c,e.hitch(this,function(y){if(y.focusNode&&!b.contains(y.domNode.parentElement.parentElement,"hideField"))return r=y.focusNode,!0})));!r&&1<this.attrInspector._numFeatures&&this.attrInspector&&this.attrInspector.navButtons&&(c=ca.findWidgets(this.attrInspector.navButtons),r=c[c.length-1].focusNode);!r&&this.config.editor.showActionButtonsAbove&&(c=d(".saveButton",this.buttonHeader)[0],
r=b.contains(c,"jimu-state-disabled")?this.cancelButton:c);return r},_getFirstAndLastFocusNodeForCopyFeaeturesScreen:function(){return{firstNode:this._copyFeaturesObj.warningMessage,lastNode:this._copyFeaturesObj.cancelBtn}},_canShowValuePicker:function(){var c=this.config.editor.hasOwnProperty("showValuePicker")?this.config.editor.showValuePicker:!1;this.config.editor.hasOwnProperty("autoSaveEdits")&&!0===this._autoSaveRuntime&&(c=!1);return c},_addValuePicker:function(c){var r,y={},H=[],K;this._removePreviousValuePickerButtons();
if(c.multipleValues&&this._canShowValuePicker()){for(var S in c.multipleValues)if(this.currentLayerInfo.fieldInfos&&(r=X.getFieldInfoByFieldName(this.currentLayerInfo.fieldInfos,S)),r&&"esriFieldTypeString"===r.type&&c.Intersection.hasOwnProperty(S)){var V=Object.keys(c.Intersection[S])[0];var aa=ia.getFieldInfosFromWebmap(this._jimuLayerInfos.getLayerInfoById(V));(K=X.getFieldInfoByFieldName(aa,Object.keys(c.Intersection[S][V])[0]))&&"esriFieldTypeDate"===K.type&&g.forEach(c.multipleValues[S],e.hitch(this,
function(fa,ka){if(null===fa||void 0===fa)fa="";K.format||(K.format={dateFormat:"shortDate"});""!==fa&&(fa=Aa.localizeDateByFieldInfo(new Date(fa),K));c.multipleValues[S][ka]=fa.toString()}))}this.currentMultipleValues=c.multipleValues;r=d("tr",this.attrInspector.attributeTable);g.forEach(r,e.hitch(this,function(fa){var ka=ma.get(fa.children[0],"data-fieldname");if(ka&&this.currentMultipleValues.hasOwnProperty(ka)){var ea=ma.get(fa.children[0],"innerHTML");y[ka]=ea;var la=this._getCurrentFieldDijit(ka),
oa=!1;la&&(1<la.length?(oa=b.contains(la[0].domNode,"dijitDisabled"),b.add(la[0].domNode,"multipleValueDijit"),b.add(la[1].domNode,"multipleValueDijit")):(oa=b.contains(la.domNode,"dijitDisabled"),b.add(la.domNode,"multipleValueDijit")));oa&&H.push(ka);this._createValuePickerButton(ka,ea,fa.children[1],oa,la)}}));H.length!==Object.keys(y).length&&this._showValuePicker(null,y,H)}else this.currentMultipleValues=null,c.multipleValues=null},_removePreviousValuePickerButtons:function(){d(".esriCTValuePickerButton",
this.attrInspector.attributeTable).forEach(f.destroy);d(".multipleValueDijit",this.attrInspector.attributeTable).removeClass("multipleValueDijit")},_createValuePickerButton:function(c,r,y,H,K){var S={},V="esriCTValuePickerButton";H&&(V+=" disabled");S[c]=r;var aa=f.create("div",{"class":V,tabindex:0,role:"button","aria-label":this.nls.valuePicker.buttonTooltip},y);this.own(n(aa,"click",e.hitch(this,function(){b.contains(aa,"disabled")||this._showValuePicker(c,S,[],K)})));this.own(n(aa,"keydown",e.hitch(this,
function(fa){fa.keyCode!==p.ENTER&&fa.keyCode!==p.SPACE||b.contains(aa,"disabled")||this._showValuePicker(c,S,[],K)})))},_showValuePicker:function(c,r,y,H){this.currentMultipleValues&&(this.valuePicker&&this.valuePicker.hideDialog(),this.valuePicker=new nb({nls:this.nls,multipleValues:this.currentMultipleValues,layerInfo:this.currentLayerInfo,showForField:c,fieldLabels:r,disabledFields:y}),c&&this.valuePicker.setValue(this.valuePicker.showForField,H),this.own(n(this.valuePicker,"value-selected",e.hitch(this,
function(K){this.config.editor.hasOwnProperty("autoSaveAttrUpdates")&&this.config.editor.autoSaveAttrUpdates&&(this.canAutoUpdate=!1);var S=d("tr",this.attrInspector.attributeTable);g.forEach(S,e.hitch(this,function(V){(V=ma.get(V.children[0],"data-fieldname"))&&K.hasOwnProperty(V)&&this._setValuesInDijits(V,K[V])}));this.config.editor.hasOwnProperty("autoSaveAttrUpdates")&&this.config.editor.autoSaveAttrUpdates&&setTimeout(e.hitch(this,function(){this.currentLayerInfo&&!this.currentLayerInfo.isCache&&
this._autoSaveFeatureEdits();this.canAutoUpdate=!0}),100)}))))},_getRequiredFields:function(c){var r=[];g.forEach(c,e.hitch(this,function(y){!y.nullable&&y.editable&&r.push(y.name)}));return r},_trimAttrValue:function(c){return"string"===typeof c?c.trim():c},_refreshLayerTitle:function(){var c=d(".esriCTItemTitle",this.domNode)[0];this.attrInspector._currentFeature&&ma.set(c,"innerHTML",Aa.sanitizeHTML(this.attrInspector._currentFeature._layer.name))},_getNewCurrentLocation:function(){var c=!1;this.appConfig&&
this.appConfig.widgetOnScreen&&this.appConfig.widgetOnScreen.widgets&&0<this.appConfig.widgetOnScreen.widgets.length&&g.some(this.appConfig.widgetOnScreen.widgets,e.hitch(this,function(r){if(r.hasOwnProperty("name")&&"MyLocation"===r.name&&r.hasOwnProperty("visible")&&!0===r.visible)return this.publishData({type:"getCurrentLocation"}),c=!0}));c?setTimeout(e.hitch(this,function(){if(this._moveToGPSDef)var r=this._moveToGPSDef;else this._myLocationInfoDef&&(r=this._myLocationInfoDef);r&&!r.isResolved()&&
this._fetchCurrentLocation()}),1E3):this._fetchCurrentLocation()},_fetchCurrentLocation:function(){var c=new kb({map:this.map,highlightLocation:!1,setScale:!1,centerAt:!1,geolocationOptions:{enableHighAccuracy:!0}});this.own(n(c,"locate",e.hitch(this,function(r){this._moveToGPSDef&&this._moveToGPSDef.resolve(r);this._myLocationInfoDef&&this._myLocationInfoDef.resolve(r);setTimeout(e.hitch(this,function(){c.destroy()}),50)})));this.own(n(c,"load",e.hitch(this,function(){c.locate()})));c.startup()},
_getOutputString:function(c,r,y){return"xy"===y?r.x+" "+r.y:r.y+" "+r.x},_createApplyEditsChunks:function(c){this.objectIdArr=[];var r=[];var y=this._chunkSizeForPointGeometry;var H=this.templatePicker.getSelected()||this._currentSelectedTemplate;H.featureLayer&&"esriGeometryPoint"!==H.featureLayer.geometryType&&(y=this._chunkSizeForPolygonAndLineGeometry);H=Math.ceil(c.length/y);for(var K=this.processedChunksCount=0;K<H;K++){var S=c.splice(0,y);var V=this.allSelectedGeometries.splice(0,y);S=this._performApplyEditsOnChunks(H,
S,V);r.push(S)}return r},_performApplyEditsOnChunks:function(c,r,y){var H=[],K=new M;(this.templatePicker.getSelected()||this._currentSelectedTemplate).featureLayer.applyEdits(r,null,null,e.hitch(this,function(S){this._calculateProgressPecentage(c);g.forEach(S,e.hitch(this,function(V,aa){V.success?(this.objectIdArr.push(V.objectId),this._copyFeaturesObj.highlightGraphicsLayer.remove(y[aa])):H.push(y[aa])}));K.resolve(H)}),e.hitch(this,function(S){console.log(S);this._calculateProgressPecentage(c);
K.resolve(y)}));return K.promise},_calculateProgressPecentage:function(c){this.processedChunksCount+=1;c=100*this.processedChunksCount/c;this._copyFeaturesObj.setProgressPercentage(c);100<=c&&this._resetCopyFeatureListHeight()},_autoSaveFeatureEdits:function(){var c=d(".saveButton",this.buttonHeader)[0];c&&n.emit(c,"click",{cancelable:!0,bubbles:!0})},_promptUserToCopyFailedFeatures:function(c){var r=new Ka({titleLabel:this.nls.copyFeatureFailedPopupTitle,width:485,maxHeight:250,autoHeight:!0,"class":this.baseClass,
content:c,buttons:[{label:this.nls.no,onClick:e.hitch(this,function(){r.close()})},{label:this.nls.tryAgainButtonLabel,onClick:e.hitch(this,function(){this._copyFeaturesObj&&this._copyFeaturesObj.createMultipleFeaturesBtn.click();r.close()})}]})},_getGeometryTypeFromGraphic:function(c){switch(c){case "point":c="esriGeometryPoint";break;case "polyline":c="esriGeometryPolyline";break;case "polygon":c="esriGeometryPolygon"}return c},_createGraphicLayerFields:function(c){var r=[],y;for(y in c.attributes){var H;
c.attributes.hasOwnProperty(y)&&(H=isNaN(c.attributes[y])?{name:y,type:"esriFieldTypeString",alias:y,length:256,editable:!0,nullable:!0,defaultValue:null,description:null,isViewOverride:!1,fieldName:y,label:y,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"}:{name:y,type:"esriFieldTypeDouble",alias:y,editable:!0,nullable:!0,defaultValue:null,description:null,isViewOverride:!1,fieldName:y,label:y,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",format:{places:2,digitSeparator:!0}});
r.push(H)}return r},_getlLayerIdsToSkip:function(){var c=["map_graphics","labels"],r;for(r in this.map._layers)if(this.map._layers.hasOwnProperty(r)){var y=this.map._layers[r];(y.hasOwnProperty("type")&&"Feature Layer"===y.type&&y.hasWebGLSurface()||!y.getMap())&&this.map._layers.hasOwnProperty("displayLayer_of_"+r)&&c.push(this.map._layers["displayLayer_of_"+r].id)}return c}})});