// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/AddData/search/SearchContext":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(K,g){return K(null,{allowArcGISOnline:!0,arcgisOnlinePortal:null,orgId:null,portal:null,username:null,constructor:function(x){g.mixin(this,x)}})})},"widgets/AddData/search/util":function(){define(["dojo/_base/array","dojo/aspect","dojo/io-query","esri/InfoTemplate","esri/layers/WFSLayer"],function(K,g,x,p,r){return{checkMixedContent:function(h){"string"===typeof window.location.href&&
0===window.location.href.indexOf("https://")&&"string"===typeof h&&0===h.indexOf("http://")&&(h="https:"+h.substring("5"));return h},endsWith:function(h,b){return-1!==h.indexOf(b,h.length-b.length)},escapeForLucene:function(h){return h.replace(RegExp('(\\+|\\-|\\\x26|\\!|\\(|\\)|\\{|\\}|\\[|\\]|\\^|\\"|\\~|\\*|\\?|\\:|\\\\)',"g"),"\\$1")},findLayersAdded:function(h,b){var a=[],c=[],l=[],k={itemIds:c,layers:l};if(!h)return k;var n="string"===typeof b&&0<b.length;K.forEach(h.layerIds,function(d){a.push(d)});
K.forEach(h.graphicsLayerIds,function(d){a.push(d)});K.forEach(a,function(d){(d=h.getLayer(d))&&"string"===typeof d.xtnItemId&&0<d.xtnItemId.length&&(!n||d.xtnItemId===b)&&(l.push(d),-1===c.indexOf(d.xtnItemId)&&c.push(d.xtnItemId))});return k},loadWFSByUrl:function(h,b,a,c,l,k){var n,d,e,u=this.makeOGCRequestInfo(c);c=u.url;var z=new r;var A=z.on("error",function(t){A&&A.remove();h.reject(t.error)});z.fromJson(u,function(t){try{if(A&&A.remove(),t&&t.push&&0<t.length){var w=t[0],q={url:c,version:z._version,
name:w.name};e=w.name||w.title;if("string"===typeof q.version&&0<q.version.length&&"string"===typeof q.name&&0<q.name.length){var E=new r({id:l,infoTemplate:new p});"string"===typeof e&&0<e.length&&(E.name=e);n=E.on("error",function(B){n&&n.remove();h.reject(B.error)});d=g.after(E,"_describeFeatureTypeResponse",function(){d&&d.remove();E.fields&&0<E.fields.length&&a._setFeatureLayerInfoTemplate(E)});E.fromJson(q,function(){n&&n.remove();E.xtnAddData=!0;b&&k&&b.addLayer(E);h.resolve(E)})}else h.reject(Error("Error loading WFSLayer, missing version and/or layer"))}else h.reject(Error("Error loading WFSLayer, no layers"))}catch(B){console.warn("Error loading WFSLayer",
c),console.error(B),h.reject(B)}})},makeOGCRequestInfo:function(h){var b={url:h},a=h.indexOf("?");if(-1!==a){b.url=h.substring(0,a);var c;h=h.substring(a+1,h.length);if("string"===typeof h&&0<h.length){var l=x.queryToObject(h),k={};if(l){for(c in l)l.hasOwnProperty(c)&&(h=l[c],a=c.toLowerCase(),"request"!==a&&"service"!==a&&("version"===a?"string"===typeof h&&0<h.length&&(b.version=h):"name"===a?"string"===typeof h&&0<h.length&&(b.name=h):k[c]=h));h=x.objectToQuery(k);"string"===typeof h&&0<h.length&&
(b.url=b.url+"?"+h)}}}return b},setNodeText:function(h,b){h.innerHTML="";b&&h.appendChild(document.createTextNode(b))},setNodeTitle:function(h,b){h.title="";b&&h.setAttribute("title",b)},setNodeHTML:function(h,b){h.innerHTML="";b&&(h.innerHTML=b)}}})},"esri/layers/WFSLayer":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/on ../request ../kernel ../graphic ../renderers/jsonUtils ../symbols/jsonUtils ../Color ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent ../geometry/Point ../geometry/Multipoint ../geometry/Polyline ../geometry/Polygon ./LabelClass ./GraphicsLayer".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C,G,D){K=K([D],{declaredClass:"esri.layers.WFSLayer",constructor:function(f){this.geometryType=this.describeFeatureTypeUrl=this.getFeatureUrl=this.layerNamespace="";this.fields=[];this.spatialReferences=[];this.fullExtent=null;this.visible=!0;this.renderer=null;this.id="WFSLayer";this._url="";this._version="1.1.0";this._layerName="";this._nsLayerNames={};this._layerDefinedGeometryType="esriGeometryComplex";this._wkid=3857;this._mode="snapshot";
this._maxFeatures=100;this._inverseResponse=this._inverseFilter=!1;this._nsGeometryFieldName=this._getFeatureRequest=this._nsFields="";this._graphicArray=[];this._gmlNS="http://www.opengis.net/gml";this._layerEventHandlers=[];this.customParameters=this._describeFeatureTypeCallback=this._getCapabilitiesCallback=null;this.showLabels=!0;this.labelingInfo=null;f&&(f.id&&(this.id=f.id),this.showLabels=null!==f.showLabels?f.showLabels:!0);this.onError=x.hitch(this,this.onError);this._errorSupport=x.hitch(this,
this._errorSupport);this._parseGml=x.hitch(this,this._parseGml);this._getCapabilities=x.hitch(this,this._getCapabilities);this._getCapabilitiesResponse=x.hitch(this,this._getCapabilitiesResponse);this._describeFeatureTypeResponse=x.hitch(this,this._describeFeatureTypeResponse);this._pointSymbol=new e(e.STYLE_CIRCLE,6,new u(u.STYLE_SOLID,new d([0,255,0]),1),new d([255,0,0]));this._lineSymbol=new u(u.STYLE_SOLID,new d([0,255,0]),3);this._polygonSymbol=new z(z.STYLE_SOLID,new u(u.STYLE_SOLID,new d([255,
0,0]),2),new d([255,255,0,.25]));this.loaded=!1;this._isProjectedOk=!0},initialize:function(f,m){f.id&&(this.id=f.id);f.url&&(this._url=f.url);f.version&&(this._version=f.version);this.customParameters=f.customParameters;this._getCapabilities(m)},selectLayer:function(f,m){this._layerName=f.layerName;this._wkid=f.wkid;this._mode=f.mode;this._maxFeatures=f.maxFeatures;this._inverseResponse=f.swapXY;this._inverseFilter=f.swapXYFilter;this.geometryType=f.geometryType;this._describeFeatureType(m);this.loaded=
!0},toJson:function(){var f={};f.id=this.id;f.url=this._url;f.version=this._version;f.mode="snapshot"===this._mode?0:1;f.name=this._layerName;f.geometryType=this.geometryType;f.wkid=this._wkid;f.maxFeatures=this._maxFeatures;f.swapXY=this._inverseResponse;f.swapXYFilter=this._inverseFilter;f.pointSymbol=this._pointSymbol.toJson();f.lineSymbol=this._lineSymbol.toJson();f.polygonSymbol=this._polygonSymbol.toJson();f.showLabels=this.showLabels;this.labelingInfo&&(f.labelingInfo=p.map(this.labelingInfo,
function(m){return m.toJson()}));this.customParameters&&(f.customParameters=this.customParameters);return f},fromJson:function(f,m){f.id&&(this.id=f.id);f.url&&(this._url=f.url);f.version&&(this._version=f.version);f.mode&&(this._mode=0===f.mode?"snapshot":"onDemand");f.name&&(this._layerName=f.name);f.geometryType&&(this.geometryType=f.geometryType);f.wkid&&(this._wkid=f.wkid);f.maxFeatures&&(this._maxFeatures=f.maxFeatures);f.swapXY&&(this._inverseResponse=f.swapXY);f.swapXYFilter&&(this._inverseFilter=
f.swapXYFilter);f.pointSymbol&&(this._pointSymbol=n.fromJson(f.pointSymbol));f.lineSymbol&&(this._lineSymbol=n.fromJson(f.lineSymbol));f.polygonSymbol&&(this._polygonSymbol=n.fromJson(f.polygonSymbol));this.showLabels=null!=f.showLabels?f.showLabels:!0;f.labelingInfo&&(this.labelingInfo=p.map(f.labelingInfo,function(y){return new G(y)}));this.customParameters=f.customParameters;this._getCapabilities(m);this.loaded=!0},setPointSymbol:function(f){this._pointSymbol=f},setLineSymbol:function(f){this._lineSymbol=
f},setPolygonSymbol:function(f){this._polygonSymbol=f},_setMap:function(f){this._map=f;var m=this.inherited(arguments);this._map&&(this._layerEventHandlers.push(this._map.on("extent-change",x.hitch(this,"refresh"))),this._layerEventHandlers.push(this.on("visibility-change",x.hitch(this,"_visibilityChange"))));this._getFeature();this.refresh();return m},_unsetMap:function(){for(var f=0;f<this._layerEventHandlers.length;f++)r.disconnect(this._layerEventHandlers[f]);this.refresh();this.inherited(arguments)},
refresh:function(){this.clear();this.redraw();"ondemand"===this._mode.toLowerCase()&&this._fireUpdateStart()},redraw:function(){if(this.visible)for(var f=0;f<this._graphicArray.length;f++){var m=this._graphicArray[f],y=m.geometry,v=null;"point"===y.type?v=this.renderer?this.renderer.getSymbol(m):this._pointSymbol:"multipoint"===y.type?v=this.renderer?this.renderer.getSymbol(m):this._pointSymbol:"polyline"===y.type?v=this.renderer?this.renderer.getSymbol(m):this._lineSymbol:"polygon"===y.type&&(v=
this.renderer?this.renderer.getSymbol(m):this._polygonSymbol);m.setSymbol(v);this.add(m)}},_visibilityChange:function(f){this.visible=f.visible;this.redraw()},onUpdateStart:function(){this._getFeature()},onUpdateEnd:function(){this.clear();this.redraw()},setLabelingInfo:function(f){f?(this.labelingInfo=f,this._fixLabelExpr()):delete this.labelingInfo;this.onLabelingInfoChange()},onLabelingInfoChange:function(){},_fixLabelExpr:function(){var f=/\[([^\[\]]+)\]/ig,m,y=this,v=function(F,H){F=y._getField(H,
!0);return"["+(F&&F.name||H)+"]"};p.forEach(this.labelingInfo,function(F){if(m=F.labelExpression)F.labelExpression=m.replace(f,v)})},_getField:function(f,m){var y=this.fields;if(!y||0===y.length)return null;var v;m&&(f=f.toLowerCase());p.some(y,function(F){var H=!1;(H=m?F&&F.name.toLowerCase()===f?!0:!1:F&&F.name===f?!0:!1)&&(v=F);return H});return v},setCustomParameters:function(f){this.customParameters=f;this._getFeature();this.refresh()},_getCapabilities:function(f){this._getCapabilitiesCallback=
f;f=x.trim(this._url);if(""===f)this.onError("WFSLayer: url is invalid");else if("1.0.0"!==this._version&&"1.1.0"!==this._version&&"2.0.0"!==this._version)this.onError("WFSLayer: version is invalid");else if(""!==f){var m=f.indexOf("?");m=this._checkForUrlInUrl(f,m);m="?"===f.charAt(f.length-1)?"":-1===m?"?":"\x26";f=f+m+"service\x3dWFS\x26request\x3dGetCapabilities\x26version\x3d"+this._version;f=this._appendCustomParameters(f);a({url:f,handleAs:"text",headers:{"Content-Type":null}},{usePost:!1}).then(this._getCapabilitiesResponse,
this._errorSupport)}},_errorSupport:function(f){this.onError(f)},_getCapabilitiesResponse:function(f){var m,y,v,F=new DOMParser;try{var H=F.parseFromString(f,"text/xml"),L=this._readExceptionReport(H,f);if(L)this.onError("WFSLayer: getCapabilities - returns exception: "+L);else{var N=H.documentElement.attributes.getNamedItem("version");if(N){this._version=N.value;var Q="2.0.0"===this._version?"http://www.opengis.net/wfs/2.0":"http://www.opengis.net/wfs";if("2.0.0"===this._version){var R=H.getElementsByTagNameNS("http://www.opengis.net/ows/1.1",
"Operation");for(m=0;m<R.length;m++){if((v=R[m].attributes.getNamedItem("name"))&&"DescribeFeatureType"===v.value){var W=R[m].getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Get");this.describeFeatureTypeUrl=W[0].attributes.getNamedItem("xlink:href").value}if(v&&"GetFeature"===v.value){var Z=R[m].getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Post");this.getFeatureUrl=Z[0].attributes.getNamedItem("xlink:href").value}}}else if("1.1.0"===this._version)for(R=H.getElementsByTagNameNS("http://www.opengis.net/ows",
"Operation"),m=0;m<R.length;m++)(v=R[m].attributes.getNamedItem("name"))&&"DescribeFeatureType"===v.value&&(W=R[m].getElementsByTagNameNS("http://www.opengis.net/ows","Get"),this.describeFeatureTypeUrl=W[0].attributes.getNamedItem("xlink:href").value),v&&"GetFeature"===v.value&&(Z=R[m].getElementsByTagNameNS("http://www.opengis.net/ows","Post"))&&Z.length&&(this.getFeatureUrl=Z[0].attributes.getNamedItem("xlink:href").value);else if("1.0.0"===this._version){var X=H.getElementsByTagNameNS(Q,"DescribeFeatureType");
if(!X||!X.length){this.onError("WFSLayer: getCapabilities - no describeFeatureType info");return}W=X[0].getElementsByTagNameNS(Q,"Get");this.describeFeatureTypeUrl=W[0].attributes.getNamedItem("onlineResource").value;var M=H.getElementsByTagNameNS(Q,"GetFeature");if(!M||!M.length){this.onError("WFSLayer: getCapabilities - no GetFeature info");return}(Z=M[0].getElementsByTagNameNS(Q,"Post"))&&Z.length&&(this.getFeatureUrl=Z[0].attributes.getNamedItem("onlineResource").value)}this._nsLayerNames={};
f=[];var U=H.getElementsByTagNameNS(Q,"FeatureTypeList");for(m=0;m<U.length;m++){var T=U[m].getElementsByTagNameNS(Q,"FeatureType");for(y=0;y<T.length;y++){var V=T[y],I=V.getElementsByTagNameNS(Q,"Name")[0],J=I.textContent,O=J.indexOf(":"),S=J.substring(0,O),P=J.substring(O+1),Y=I.lookupNamespaceURI(S);null===Y&&(Y=I.lookupNamespaceURI(null));this._nsLayerNames[P]={prefix:S,namespace:Y};var aa=V.getElementsByTagNameNS(Q,"Title"),ba=0<aa.length?aa[0].textContent:"";""===ba&&(ba=P);this.spatialReferences=
this._readFactoryCodes(this._version,V);var ea=this._readDefaultBBOX(this._version,V);f.push({name:P,title:ba,spatialReferences:this.spatialReferences,extent:ea})}}this._describeFeatureType();var ca=this._getCapabilitiesCallback;ca&&ca(f)}else this.onError("WFSLayer: getCapabilities - document not recognized.")}}catch(na){this.onError("WFSLayer: getCapabilities - parsing error")}},_readFactoryCodes:function(f,m){var y,v=[];if("2.0.0"===f||"1.1.0"===f){f=m.getElementsByTagNameNS("*","DefaultSRS");
this._addCodeList(v,f[0]);f=m.getElementsByTagNameNS("*","DefaultCRS");this._addCodeList(v,f[0]);f=m.getElementsByTagNameNS("*","OtherSRS");for(y=0;y<f.length;y++)this._addCodeList(v,f[y]);f=m.getElementsByTagNameNS("*","OtherCRS");for(y=0;y<f.length;y++)this._addCodeList(v,f[y])}else"1.0.0"===f&&(f=m.getElementsByTagNameNS("*","SRS"),this._addCodeList(v,f[0]));for(m=!1;0<v.length;){4326===v[0]&&(m=!0);break}m||v.push(4326);return v},_addCodeList:function(f,m){m&&(m=m.textContent.match(/\d+/g),0<
m.length&&(m=parseInt(m[m.length-1],10),84===m&&(m=4326),f.push(m)))},_readDefaultBBOX:function(f,m){if("2.0.0"===f||"1.1.0"===f){var y=m.getElementsByTagNameNS("*","WGS84BoundingBox");if(!y[0]||!y[0].attributes)return[];var v=y[0].getElementsByTagNameNS("*","LowerCorner");var F=y[0].getElementsByTagNameNS("*","UpperCorner");if(0>=v.length||0>=F.length)return[];var H=v[0].textContent;y=H.indexOf(" ");v=H.substring(0,y);H=H.substring(y+1);y=F[0].textContent;f=y.indexOf(" ");F=y.substring(0,f);y=y.substring(f+
1)}else if("1.0.0"===f){y=m.getElementsByTagNameNS("*","LatLongBoundingBox");if(!y[0]||!y[0].attributes)return[];v=y[0].attributes.getNamedItem("minx").value;H=y[0].attributes.getNamedItem("miny").value;F=y[0].attributes.getNamedItem("maxx").value;y=y[0].attributes.getNamedItem("maxy").value}v=parseFloat(v,10);H=parseFloat(H,10);F=parseFloat(F,10);y=parseFloat(y,10);return[v,H,F,y]},_describeFeatureType:function(f){if(""!==this._layerName)if(""===this.describeFeatureTypeUrl)this.onError("WFSLayer: invalid describeFeatureType url");
else if(""===this._wkid)this.onError("WFSLayer: invalid wkid");else if("snapshot"!==this._mode&&"onDemand"!==this._mode)this.onError("WFSLayer: invalid mode");else if(""===this._maxFeatures||0>this._maxFeatures||1E6<this._maxFeatures)this.onError("WFSLayer: invalid maxFeatures");else if(this._describeFeatureTypeCallback=f,f=x.trim(this.describeFeatureTypeUrl),""!==f){var m=f.indexOf("?");m=this._checkForUrlInUrl(f,m);var y="?"===f.charAt(f.length-1)?"":-1===m?"?":"\x26",v=this._nsLayerNames[this._layerName];
if(void 0===v)this.onError("WFSLayer: invalid layerName");else m=v.prefix,v=v.namespace,f=f+y+"service\x3dWFS\x26request\x3dDescribeFeatureType\x26version\x3d"+this._version,f+="\x26typeName\x3d",""!==m&&(f+=m+":"),f+=encodeURIComponent(this._layerName),""!==m&&(f+="\x26namespace\x3dxmlns("+m+"\x3d"+encodeURIComponent(v)+")"),f=this._appendCustomParameters(f),a({url:f,handleAs:"text",headers:{"Content-Type":null}},{usePost:!1}).then(this._describeFeatureTypeResponse,this._errorSupport)}},_describeFeatureTypeResponse:function(f){var m=
(new DOMParser).parseFromString(f,"text/xml");if(f=this._readExceptionReport(m,f))this.onError("WFSLayer: DescribeFeatureType - returns exception: "+f);else{this.fields=[];f=m.getElementsByTagNameNS("http://www.w3.org/2001/XMLSchema","schema");for(m=0;m<f.length;m++){var y=this._readAllFields(f[m]);null!==y&&(this._layerDefinedGeometryType=y[0],this.fields=y[1])}this.geometryType&&""!==this.geometryType||(this.geometryType=this._layerDefinedGeometryType);for(m=0;m<this.fields.length;m++)f=this.fields[m],
"esriFieldTypeGeometry"===f.type&&(this._nsGeometryFieldName=f.name);this.layerNamespace=this._nsLayerNames[this._layerName].namespace;if(0===this.fields.length)this.onError("WFSLayer: DescribeFeatureType - can't get fields");else this._getFeature(),(m=this._describeFeatureTypeCallback)&&m(this.fields)}},_readAllFields:function(f){for(var m=f.childNodes,y=0;y<m.length;y++){var v=m[y];if("element"===v.localName){var F=v.attributes;if(F.name.value===this._layerName)return(m=F.type)?(v=m.value,m=v.indexOf(":"),
v=v.substring(m+1),this._readFieldsFromGlobalComplextType(f,v)):this._readFieldsFromLocalComplextType(v)}}return null},_readFieldsFromGlobalComplextType:function(f,m){f=f.childNodes;for(var y=0;y<f.length;y++){var v=f[y];if("complexType"===v.localName&&v.attributes.name.value===m)return this._readFieldsFromLocalComplextType(v)}return null},_readFieldsFromLocalComplextType:function(f){for(var m=[],y="esriGeometryComplex",v=f.getElementsByTagNameNS("http://www.w3.org/2001/XMLSchema","element"),F=0;F<
v.length;F++){var H=v[F],L="",N=H.attributes.getNamedItem("name");N&&(L=N.value);if(""!==L){var Q=f="",R=H.attributes.getNamedItem("type");N="unknown";if(null!==R){Q=R.value;var W=Q.indexOf(":");f=Q.substring(0,W);Q=Q.substring(W+1);N=R.lookupNamespaceURI(f);null===N&&(N=R.lookupNamespaceURI(null))}if(""===Q){H=H.childNodes;for(var Z=0;Z<H.length;Z++)if(f=H[Z],"simpleType"===f.localName){f=f.childNodes;for(Z=0;Z<f.length;Z++)if(node2=f[Z],"restriction"===node2.localName){R=node2.attributes.getNamedItem("base");
Q=R.value;W=Q.indexOf(":");f=Q.substring(0,W);Q=Q.substring(W+1);break}if(""!==Q)break}}H="Unknown";switch(Q){case "integer":case "nonPositiveInteger":case "negativeInteger":case "long":case "int":case "short":case "byte":case "nonNegativeInteger":case "unsignedLong":case "unsignedInt":case "unsignedShort":case "unsignedByte":case "positiveInteger":H="esriFieldTypeInteger";m.push({name:L,alias:L,type:H,wfsNamespace:N});break;case "float":case "double":case "decimal":H="esriFieldTypeDouble";m.push({name:L,
alias:L,type:H,wfsNamespace:N});break;case "boolean":case "string":case "gYearMonth":case "gYear":case "gMonthDay":case "gDay":case "gMonth":case "anyURI":case "QName":case "NOTATION":case "normalizedString":case "token":case "language":case "IDREFS":case "ENTITIES":case "NMTOKEN":case "NMTOKENS":case "Name":case "NCName":case "ID":case "IDREF":case "ENTITY":H="esriFieldTypeString";m.push({name:L,alias:L,type:H,wfsNamespace:N});break;case "duration":case "dateTime":case "time":case "date":H="esriFieldTypeDate";
m.push({name:L,alias:L,type:H,wfsNamespace:N});break;case "PointPropertyType":case "MultiPointPropertyType":H="esriFieldTypeGeometry";y="esriGeometryPoint";m.push({name:L,alias:L,type:H,wfsNamespace:N});break;case "MultiCurvePropertyType":case "MultiLineStringPropertyType":H="esriFieldTypeGeometry";y="esriGeometryPolyline";m.push({name:L,alias:L,type:H,wfsNamespace:N});break;case "MultiSurfacePropertyType":case "MultiPolygonPropertyType":H="esriFieldTypeGeometry";y="esriGeometryPolygon";m.push({name:L,
alias:L,type:H,wfsNamespace:N});break;case "GeometryPropertyType":case "MultiGeometryPropertyType":H="esriFieldTypeGeometry",y="esriGeometryComplex",m.push({name:L,alias:L,type:H,wfsNamespace:N})}}}return[y,m]},_getFeature:function(){var f="\x3c?xml version\x3d'1.0' encoding\x3d'utf-8'?\x3e\n\x3cGetFeature \n xmlns:xsi\x3d'http://www.w3.org/2001/XMLSchema-instance'\n xmlns:gml\x3d'http://www.opengis.net/gml'\n xmlns:ogc\x3d'http://www.opengis.net/ogc'\n xmlns:wfs\x3d'http://www.opengis.net/wfs'\n";
f="2.0.0"===this._version?f+" xmlns\x3d'http://www.opengis.net/wfs/2.0'\n":f+" xmlns\x3d'http://www.opengis.net/wfs'\n";var m=this._nsLayerNames[this._layerName];if(void 0===m)this.onError("WFSLayer: invalid layerName");else{var y=m.prefix;m=m.namespace;if("ondemand"===this._mode.toLowerCase()&&""===this._nsGeometryFieldName)this.onError("WFSLayer: GetFeature - can't use 'onDemand' mode as geometryFieldName is unknown.");else if(f+=" xmlns:"+y+"\x3d'"+m+"'\n",f="2.0.0"===this._version?f+(" version\x3d'"+
this._version+"' service\x3d'WFS' count\x3d'"+this._maxFeatures+"'\x3e\n"):f+(" version\x3d'"+this._version+"' service\x3d'WFS' maxFeatures\x3d'"+this._maxFeatures+"'\x3e\n"),f="2.0.0"===this._version?f+(" \x3cQuery typeNames\x3d'"+y+":"+this._layerName+"' srsName\x3d'EPSG:"+this._wkid+"'\x3e\n"):f+(" \x3cwfs:Query typeName\x3d'"+y+":"+this._layerName+"' srsName\x3d'EPSG:"+this._wkid+"'\x3e\n"),"ondemand"===this._mode.toLowerCase()&&(f=f+"  \x3cogc:Filter xmlns:ogc\x3d'http://www.opengis.net/ogc'\x3e\n   \x3cogc:BBOX\x3e\n    \x3cogc:PropertyName\x3e"+
(y+":"+this._nsGeometryFieldName+"\x3c/ogc:PropertyName\x3e\n"),f+="    \x3cgml:Box srsName\x3d'EPSG:"+this._wkid+"'\x3e\n",f=this._inverseFilter?f+"      \x3cgml:coordinates\x3e{ymin},{xmin} {ymax},{xmax}\x3c/gml:coordinates\x3e\n":f+"      \x3cgml:coordinates\x3e{xmin},{ymin} {xmax},{ymax}\x3c/gml:coordinates\x3e\n",f+="    \x3c/gml:Box\x3e\n   \x3c/ogc:BBOX\x3e\n  \x3c/ogc:Filter\x3e\n"),f="2.0.0"===this._version?f+" \x3c/Query\x3e\n":f+" \x3c/wfs:Query\x3e\n",this._getFeatureRequest=f+"\x3c/GetFeature\x3e\n",
""===this.getFeatureUrl)this.onError("WFSLayer: getFeature - server doesn't support POST method.");else if(""!==this._getFeatureRequest&&this._map&&null!==this._map.spatialReference.wkid){f=this._getFeatureRequest;if("ondemand"===this._mode.toLowerCase()){f=this._map.extent.xmin;y=this._map.extent.ymin;m=this._map.extent.xmax;var v=this._map.extent.ymax,F={},H=this._map.spatialReference,L=new A(this._wkid);this._projectFromSRToSR(H,L,f,y,F)&&(f=F.x,y=F.y);this._projectFromSRToSR(H,L,m,v,F)&&(m=F.x,
v=F.y);f=this._getFeatureRequest.replace(/{xmin}/,f).replace(/{ymin}/,y).replace(/{xmax}/,m).replace(/{ymax}/,v)}y=this._appendCustomParameters(this.getFeatureUrl);a({url:y,handleAs:"text",headers:{"Content-Type":"text/xml"},postData:f},{usePost:!0}).then(this._parseGml,this._errorSupport)}}},_parseGml:function(f){if(this._map&&this._map.spatialReference&&this._map.spatialReference.wkid){var m=(new DOMParser).parseFromString(f,"text/xml");if(f=this._readExceptionReport(m,f))this.onError("WFSLayer: GetFeature - returns exception: "+
f);else this._gmlNS="2.0.0"===this._version?"http://www.opengis.net/gml/3.2":"http://www.opengis.net/gml",""===this._wkid&&(this._wkid=this._map.spatialReference.wkid),this._graphicArray=this._readFeatureMembers(m,this._wkid,2,this._nsLayerNames[this._layerName].namespace,this._layerName),this.fullExtent=this._createFullExtent(this._graphicArray),this.onLabelingInfoChange(),"ondemand"===this._mode.toLowerCase()?this._fireUpdateEnd():this.refresh()}},_limit4326:function(f){for(var m=0;m<f.length;m++){var y=
f[m].geometry;4326===y.spatialReference.wkid&&(y.x=this._limit4326X(y.x),y.y=this._limit4326Y(y.y))}},_limit4326X:function(f){180<=f&&(f=179.99);-180>=f&&(f=-179.99);return f},_limit4326Y:function(f){90<=f&&(f=89.99);-90>=f&&(f=-89.99);return f},_createFullExtent:function(f){for(var m=null,y=0;y<f.length;y++){var v=f[y].geometry,F=null;(F="point"===v.geometryType?new w(v.x,v.y,v.x,v.y,v.spatialReference):v.getExtent())&&(m=null===m?F:m.union(F))}return m},_readExceptionReport:function(f,m){return 0<
f.getElementsByTagNameNS("*","ExceptionReport").length||0<f.getElementsByTagNameNS("*","ServiceExceptionReport").length?m:""},_readFeatureMembers:function(f,m,y,v,F){var H=this._readWkidFromNode(f);-1!=H&&(m=H);H=this._readSrsDimension(f);0!==H&&(y=H);var L=[];var N=f.getElementsByTagNameNS("*","featureMembers");for(H=0;H<N.length;H++){var Q=N[H];var R=Q.getElementsByTagNameNS(v,F);0===R.length&&(R=Q.getElementsByTagNameNS(null,F));0===R.length&&(R=Q.getElementsByTagNameNS("*",F));for(Q=0;Q<R.length;Q++)this._readLayer(L,
R[Q],m,y)}N=f.getElementsByTagNameNS("*","featureMember");for(H=0;H<N.length;H++)for(Q=N[H],R=Q.getElementsByTagNameNS(v,F),0===R.length&&(R=Q.getElementsByTagNameNS(null,F)),0===R.length&&(R=Q.getElementsByTagNameNS("*",F)),Q=0;Q<R.length;Q++)this._readLayer(L,R[Q],m,y);N=f.getElementsByTagNameNS("*","member");for(H=0;H<N.length;H++)for(Q=N[H],R=Q.getElementsByTagNameNS(v,F),0===R.length&&(R=Q.getElementsByTagNameNS(null,F)),0===R.length&&(R=Q.getElementsByTagNameNS("*",F)),Q=0;Q<R.length;Q++)this._readLayer(L,
R[Q],m,y);return L},_readLayer:function(f,m,y,v){var F=this._readSrsDimension(m);0!==F&&(v=F);var H=m.childNodes,L="",N=null;for(m=0;m<H.length;m++){var Q=H[m];if(1==Q.nodeType&&(F=Q.localName,"boundedBy"!==F)){Q=this._readGeometry(Q,y,v);if(!this._isProjectedOk){this._isProjectedOk=!0;console.error("WFSLayer: could not project geometry.");break}if(null!==Q&&(N=Q,L=F,"point"!==N.geometryType||"esriGeometryPolygon"!==this.geometryType&&"esriGeometryPolyline"!==this.geometryType))break}}if(N){y={};
for(m=0;m<H.length;m++)if(Q=H[m],F=Q.localName,v=Q.textContent,F!==L)for(Q=0;Q<this.fields.length;Q++){var R=this.fields[Q];R.name==F&&(y[F]="esriFieldTypeDouble"===R.type?parseFloat(v,10):"esriFieldTypeInteger"===R.type?parseInt(v,10):v.trim())}this._convertWFSGeometryToGraphicObjects(f,N,y)}},_convertWFSGeometryToGraphicObjects:function(f,m,y){if("point"===m.geometryType&&("esriGeometryPoint"===this.geometryType||"esriGeometryComplex"===this.geometryType)){var v=new l;m=new q(m);v.setGeometry(m);
v.setAttributes(y);f.push(v)}else if("multipoint"===m.geometryType&&("esriGeometryPoint"===this.geometryType||"esriGeometryComplex"===this.geometryType))v=new l,m=new E(m),v.setGeometry(m),v.setAttributes(y),f.push(v);else if("polyline"===m.geometryType&&("esriGeometryPolyline"===this.geometryType||"esriGeometryComplex"===this.geometryType))v=new l,m=new B(m),v.setGeometry(m),v.setAttributes(y),f.push(v);else if("polygon"===m.geometryType&&("esriGeometryPolygon"===this.geometryType||"esriGeometryComplex"===
this.geometryType))v=new l,m=new C(m),v.setGeometry(m),v.setAttributes(y),f.push(v);else if("multigeometry"===m.geometryType)for(v=0;v<m.length;v++)this._convertWFSGeometryToGraphicObjects(f,m[v],y)},_readGeometry:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);var F=f.getElementsByTagNameNS(this._gmlNS,"MultiSurface");if(1<=F.length)for(v=0;v<F.length;)return this._readMultiSurface(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"MultiCurve");
if(1<=F.length){var H=[];for(v=0;v<F.length;v++){var L=this._readMultiCurve(F[v],m,y);for(f=0;f<L.length;f++)H.push(L[f])}return{geometryType:"polyline",paths:H,spatialReference:{wkid:this._map.spatialReference.wkid}}}F=f.getElementsByTagNameNS(this._gmlNS,"MultiGeometry");for(v=0;v<F.length;)return this._readMultiGeometry(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Geometry");for(v=0;v<F.length;)return this._readGeometry(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"GeometryCollection");
for(v=0;v<F.length;)return this._readGeometryCollection(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Surface");for(v=0;v<F.length;)return this._readSurface(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Curve");for(v=0;v<F.length;)return this._readCurve(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"MultiPolygon");for(v=0;v<F.length;)return this._readMultiPolygon(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Polygon");for(v=0;v<F.length;)return this._readPolygon(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,
"MultiLineString");for(v=0;v<F.length;)return this._readMultiLineString(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"LineString");for(v=0;v<F.length;){m=this._readLineString(F[v],m,y);y={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.wkid}};v=[];for(f=0;f<m.length;f++)v.push(m[f]);y.paths.push(v);return y}F=f.getElementsByTagNameNS(this._gmlNS,"LinearRing");for(v=0;v<F.length;)return this._readLinearRing(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Box");
if(1<=F.length)for(v=0;v<F.length;)return this._readBox(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Envelope");for(v=0;v<F.length;)return this._readEnvelope(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"MultiPoint");if(1<=F.length)for(v=0;v<F.length;)return this._readMultiPoint(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"Point");for(v=0;v<F.length;)return this._readPoint(F[v],m,y);return null},_readGeometryCollection:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);
0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"geometryMember");for(f=0;f<F.length;f++){var H=this._readGeometryMember(F[f],m,y);v.push(H)}return v},_readMultiGeometry:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,
"geometryMember");for(f=0;f<F.length;f++){var H=this._readGeometryMember(F[f],m,y);v.push(H)}return v},_readSurface:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);var F=[];F.geometryType="multigeometry";F.spatialReference={wkid:this._map.spatialReference.wkid};var H=f.getElementsByTagNameNS(this._gmlNS,"Point");for(v=0;v<H.length;v++)F.push(this._readPoint(H[v],m,y));H=f.getElementsByTagNameNS(this._gmlNS,"patches");for(v=0;v<H.length;v++){f=
this._readPatches(H[v],m,y);for(var L=0;L<f.length;L++)F.push(f[L])}return F},_readMultiSurface:function(f,m,y){var v;var F=this._readWkidFromNode(f);-1!=F&&(m=F);F=this._readSrsDimension(f);0!==F&&(y=F);var H=[];H.geometryType="multigeometry";H.spatialReference={wkid:this._map.spatialReference.wkid};var L=f.getElementsByTagNameNS(this._gmlNS,"surfaceMember");for(F=0;F<L.length;F++){var N=this._readSurfaceMember(L[F],m,y);for(v=0;v<N.length;v++)H.push(N[v])}L=f.getElementsByTagNameNS(this._gmlNS,
"surfaceMembers");for(F=0;F<L.length;F++)for(f=this._readSurfaceMembers(L[F],m,y),v=0;v<f.length;v++)H.push(f[v]);return H},_readCurve:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.wkid}};var F=f.getElementsByTagNameNS(this._gmlNS,"segments");for(f=0;f<F.length;f++)for(var H=this._readSegments(F[f],m,y),L=0;L<H.length;L++)v.paths.push(H[L]);return v},_readSegments:function(f,
m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"LineStringSegment");for(f=0;f<F.length;f++){var H=this._readLineStringSegment(F[f],m,y);v.push(H)}return v},_readLineStringSegment:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,
"posList");0<f.length;)return this._readPosList(f[0],m,y)},_readMultiCurve:function(f,m,y){var v;var F=this._readWkidFromNode(f);-1!=F&&(m=F);F=this._readSrsDimension(f);0!==F&&(y=F);var H=[];H.spatialReference={wkid:this._map.spatialReference.wkid};var L=f.getElementsByTagNameNS(this._gmlNS,"curveMember");for(F=0;F<L.length;F++){var N=this._readCurveMember(L[F],m,y);for(v=0;v<N.length;v++)H.push(N[v])}L=f.getElementsByTagNameNS(this._gmlNS,"curveMembers");for(F=0;F<L.length;F++)for(N=this._readCurveMembers(L[F],
m,y),v=0;v<N.length;v++)H.push(N[v]);return H},_readGeometryMember:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);var F=f.getElementsByTagNameNS(this._gmlNS,"Point");for(v=0;v<F.length;)return this._readPoint(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"LineString");for(v=0;v<F.length;){m=this._readLineString(F[v],m,y);y={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.wkid}};v=[];for(f=0;f<m.length;f++)v.push(m[f]);
y.paths.push(v);return y}F=f.getElementsByTagNameNS(this._gmlNS,"Polygon");for(v=0;v<F.length;)return this._readPolygon(F[v],m,y);return null},_readSurfaceMember:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"Polygon");for(f=0;f<F.length;f++){var H=this._readPolygon(F[f],m,y);v.push(H)}return v},_readSurfaceMembers:function(f,
m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"Polygon");for(f=0;f<F.length;f++){var H=this._readPolygon(F[f],m,y);v.push(H)}return v},_readCurveMember:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};
var F=f.getElementsByTagNameNS(this._gmlNS,"LineString");for(f=0;f<F.length;f++){var H=this._readLineString(F[f],m,y);v.push(H)}return v},_readCurveMembers:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"LineString");for(f=0;f<F.length;f++){var H=this._readLineString(F[f],m,y);v.push(H)}return v},_readBox:function(f,
m,y){var v,F,H,L,N=this._readWkidFromNode(f);-1!=N&&(m=N);N=this._readSrsDimension(f);0!==N&&(y=N);N={geometryType:"polygon",rings:[],spatialReference:{wkid:this._map.spatialReference.wkid}};var Q=f.getElementsByTagNameNS(this._gmlNS,"coordinates");for(v=0;v<Q.length;v++)if(F=this._readCoordinates(Q[v],m,y)){if(1<=F.length){var R=H=F[0][0];var W=L=F[0][1]}1<=F.length&&(H=F[1][0],L=F[1][1]);N.rings.push([[R,W],[R,L],[H,L],[H,W],[R,W]]);return N}Q=f.getElementsByTagNameNS(this._gmlNS,"coord");return 2<=
Q.length?((f=this._readCoord(Q[0],m,y))&&1<=f.length&&(R=H=f[0][0],W=L=f[0][1]),(m=this._readCoord(Q[1],m,y))&&1<=m.length&&(H=m[0][0],L=m[0][1]),N.rings.push([[R,W],[R,L],[H,L],[H,W],[R,W]]),N):null},_readEnvelope:function(f,m,y){var v,F;var H=this._readWkidFromNode(f);-1!=H&&(m=H);H=this._readSrsDimension(f);0!==H&&(y=H);var L=f.getElementsByTagNameNS(this._gmlNS,"lowerCorner");for(H=0;H<L.length;H++){var N=this._readCoordinates(L[H],m,y);N&&(v=N[0])}L=f.getElementsByTagNameNS(this._gmlNS,"upperCorner");
for(H=0;H<L.length;H++)(f=this._readCoordinates(L[H],m,y))&&(F=f[0]);return v&&F?{geometryType:"polygon",rings:[[[v[0],v[1]],[v[0],F[1]],[F[0],F[1]],[F[0],v[1]],[v[0],v[1]]]],spatialReference:{wkid:this._map.spatialReference.wkid}}:null},_readPolygon:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);var F={geometryType:"polygon",rings:[],spatialReference:{wkid:this._map.spatialReference.wkid}};var H=f.getElementsByTagNameNS(this._gmlNS,"outerBoundaryIs");
for(v=0;v<H.length;v++){var L=this._readOuterBoundaryIs(H[v],m,y);F.rings.push(L)}H=f.getElementsByTagNameNS(this._gmlNS,"innerBoundaryIs");for(v=0;v<H.length;v++)L=this._readInnerBoundaryIs(H[v],m,y),F.rings.push(L);H=f.getElementsByTagNameNS(this._gmlNS,"exterior");for(v=0;v<H.length;v++)L=this._readExterior(H[v],m,y),F.rings.push(L);H=f.getElementsByTagNameNS(this._gmlNS,"interior");for(v=0;v<H.length;v++)L=this._readInterior(H[v],m,y),F.rings.push(L);return F},_readPolygonMember:function(f,m,
y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"Polygon");0<f.length;)return this._readPolygon(f[0],m,y);return null},_readMultiPolygon:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.geometryType="multigeometry";v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"polygonMember");for(f=0;f<F.length;f++){var H=
this._readPolygonMember(F[f],m,y);v.push(H)}return v},_readOuterBoundaryIs:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<f.length;)return this._readLinearRing(f[0],m,y);return null},_readInnerBoundaryIs:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<f.length;)return this._readLinearRing(f[0],
m,y);return null},_readExterior:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<f.length;)return this._readLinearRing(f[0],m,y);return null},_readInterior:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<f.length;)return this._readLinearRing(f[0],m,y);return null},_readPatches:function(f,
m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v=[];v.spatialReference={wkid:this._map.spatialReference.wkid};var F=f.getElementsByTagNameNS(this._gmlNS,"PolygonPatch");for(f=0;f<F.length;f++)v.push(this._readPolygon(F[f],m,y));return v},_readLineString:function(f,m,y){var v,F;var H=this._readWkidFromNode(f);-1!=H&&(m=H);H=this._readSrsDimension(f);0!==H&&(y=H);var L=[];L.spatialReference={wkid:this._map.spatialReference.wkid};var N=f.getElementsByTagNameNS(this._gmlNS,
"coordinates");for(H=0;H<N.length;H++)if(F=this._readCoordinates(N[H],m,y))for(v=0;v<F.length;v++){var Q=F[v];L.push(Q)}N=f.getElementsByTagNameNS(this._gmlNS,"coord");for(H=0;H<N.length;H++)if(F=this._readCoord(N[H],m,y))for(v=0;v<F.length;v++)Q=F[v],L.push(Q);N=f.getElementsByTagNameNS(this._gmlNS,"posList");for(H=0;H<N.length;H++)if(F=this._readPosList(N[H],m,y))for(v=0;v<F.length;v++)Q=F[v],L.push(Q);return L},_readLineStringMember:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);
v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"LineString");0<f.length;)return this._readLineString(f[0],m,y);return null},_readMultiLineString:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.wkid}};var F=f.getElementsByTagNameNS(this._gmlNS,"lineStringMember");for(f=0;f<F.length;f++){var H=this._readLineStringMember(F[f],
m,y);H&&v.paths.push(H)}return 1<=v.paths.length?v:null},_readPoint:function(f,m,y){var v;var F=this._readWkidFromNode(f);-1!=F&&(m=F);F=this._readSrsDimension(f);0!==F&&(y=F);var H=f.getElementsByTagNameNS(this._gmlNS,"coordinates");for(F=0;F<H.length;F++)if(v=this._readCoordinates(H[F],m,y))return{geometryType:"point",x:v[0][0],y:v[0][1],spatialReference:{wkid:this._map.spatialReference.wkid}};H=f.getElementsByTagNameNS(this._gmlNS,"pos");for(F=0;F<H.length;F++)if((v=this._readPos(H[F],m,y))&&0<
v.length)return{geometryType:"point",x:v[0][0],y:v[0][1],spatialReference:{wkid:this._map.spatialReference.wkid}};H=f.getElementsByTagNameNS(this._gmlNS,"coord");for(F=0;F<H.length;F++)if(f=this._readCoord(H[F],m,y))return{geometryType:"point",x:f[0][0],y:f[0][1],spatialReference:{wkid:this._map.spatialReference.wkid}};return null},_readPointMember:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);for(f=f.getElementsByTagNameNS(this._gmlNS,"Point");0<
f.length;)return this._readPoint(f[0],m,y);return null},_readMultiPoint:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);v={geometryType:"multipoint",points:[],spatialReference:{wkid:this._map.spatialReference.wkid}};var F=f.getElementsByTagNameNS(this._gmlNS,"pointMember");for(f=0;f<F.length;f++){var H=this._readPointMember(F[f],m,y);H&&v.points.push([H.x,H.y])}return 1<=v.points.length?v:null},_readLinearRing:function(f,m,y){var v=this._readWkidFromNode(f);
-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);var F=f.getElementsByTagNameNS(this._gmlNS,"coordinates");for(v=0;v<F.length;)return this._readCoordinates(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"posList");for(v=0;v<F.length;)return this._readCoordinates(F[v],m,y);F=f.getElementsByTagNameNS(this._gmlNS,"pos");for(v=0;v<F.length;)return this._readPos(F[v],m,y)},_readCoordinatesBody:function(f,m,y){var v=new A(f);m=m.trim();var F=[];F.spatialReference={wkid:this._map.spatialReference.wkid};
f=this._isReverse(f,this.version);if(m)if(2===y){if((m=m.match(/[0123456789.\-\+eE]+/g))&&2<=m.length)for(y=0;y<m.length;y+=2){var H=parseFloat(m[y]);var L=parseFloat(m[y+1]);if(f){var N=L;L=H;H=N}N={};this._projectFromSRToSR(v,this._map.spatialReference,H,L,N)&&(H=N.x,L=N.y);F.push([H,L])}}else if(3===y&&(m=m.match(/[0123456789.\-\+eE]+/g))&&3<=m.length)for(y=0;y<m.length;y+=3)H=parseFloat(m[y]),L=parseFloat(m[y+1]),f&&(N=L,L=H,H=N),N={},this._projectFromSRToSR(v,this._map.spatialReference,H,L,N)&&
(H=N.x,L=N.y),F.push([H,L]);return F},_readCoord:function(f,m,y){var v,F=this._readWkidFromNode(f);-1!=F&&(m=F);F=new A(m);var H=this._readSrsDimension(f);0!==H&&(y=H);var L=this._isReverse(m,this.version),N=[];N.spatialReference={wkid:this._map.spatialReference.wkid};H=0;var Q=f.getElementsByTagNameNS(this._gmlNS,"X");for(v=0;v<Q.length;){H=this._readFloat(Q[v],m,y);break}var R=0;Q=f.getElementsByTagNameNS(this._gmlNS,"Y");for(v=0;v<Q.length;){R=this._readFloat(Q[v],m,y);break}L&&(f=R,R=H,H=f);f=
{};this._projectFromSRToSR(F,this._map.spatialReference,H,R,f)&&(H=f.x,R=f.y);N.push(L?[R,H]:[H,R]);return N},_readCoordinates:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);return this._readCoordinatesBody(m,f.textContent,y)},_readPos:function(f,m,y){var v=this._readWkidFromNode(f);-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);return this._readCoordinatesBody(m,f.textContent,y)},_readPosList:function(f,m,y){var v=this._readWkidFromNode(f);
-1!=v&&(m=v);v=this._readSrsDimension(f);0!==v&&(y=v);return this._readCoordinatesBody(m,f.textContent,y)},_projectFromSRToSR:function(f,m,y,v,F){if(t.canProject(f,m))return f=new q(y,v,f),m=t.project(f,m),F.x=m.x,F.y=m.y,!0;F.x=y;F.y=v;return this._isProjectedOk=!1},_readFloat:function(f){return(f=f.textContent)?parseFloat(f):0},_readSrsDimension:function(f){return f.attributes&&(f=f.attributes.getNamedItem("srsDimension"))?parseInt(f.value,10):0},_readWkidFromNode:function(f){return f.attributes&&
(f=f.attributes.getNamedItem("srsName"))&&(f=f.value.match(/\d+/g))&&0<f.length?(f=parseInt(f[f.length-1],10),84===f&&(f=4326),parseInt(f,10)):-1},_isReverse:function(f,m){return this._inverseResponse},_appendCustomParameters:function(f){if(this.customParameters)for(var m in this.customParameters)f+=(-1===f.indexOf("?")?"?":"\x26")+m+"\x3d"+encodeURIComponent(this.customParameters[m]);return f},_checkForUrlInUrl:function(f,m){var y=f.toLowerCase().lastIndexOf("http");-1<m&&y>m&&(-1<f.indexOf("?",
y)||-1!==f.indexOf("\x26",y)||(m=-1));return m}});h("extend-esri")&&x.setObject("layers.WFSLayer",K,c);return K})},"widgets/AddData/search/SearchPane":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SearchPane.html dojo/i18n!../nls/strings ./SearchBox ./BBoxOption ./ScopeOptions ./TypeOptions ./SortOptions ./ResultsPane ./Paging ./ResultCount".split(" "),function(K,
g,x,p,r,h,b,a,c,l){return K([h,b,a],{i18n:l,templateString:c,qDefaultFilter:null,qRequiredFilter:null,searchOnStart:!0,searchContext:null,wabWidget:null,_dfd:null,postCreate:function(){this.inherited(arguments);x.forEach(this.getComponents(),function(k){k.searchPane=this},this)},startup:function(){this._started||(this.inherited(arguments),this.bindEvents(),this.searchOnStart&&this.search())},_onFilterPlaceholderChanged:function(){r.contains(this.filterPlaceholder,"opened")?(r.remove(this.filterPlaceholder,
"opened"),r.remove(this.filterWrapper,"show")):(this.filterWrapper.style.top=this.headerNode.clientHeight+"px",r.add(this.filterPlaceholder,"opened"),r.add(this.filterWrapper,"show"))},_onSearchBoxPlaceholderChanged:function(){},bindEvents:function(){this.own(p(this.filterPlaceholder,"click",g.hitch(this,this._onFilterPlaceholderChanged)))},buildQueryParams:function(k){var n=null;"string"===typeof this.qRequiredFilter&&0<this.qRequiredFilter.length&&(n=this.qRequiredFilter);var d={q:n,canSortByRelevance:!1};
x.forEach(this.getComponents(),function(e){e.appendQueryParams(d,k)});delete d.canSortByRelevance;null===d.q&&"string"===typeof this.qDefaultFilter&&0<this.qDefaultFilter.length&&(d.q=this.qDefaultFilter);return d},getComponents:function(){return[this.searchBox,this.bboxOption,this.scopeOptions,this.typeOptions,this.sortOptions,this.resultsPane,this.paging,this.resultCount]},resize:function(){this.contentNode.style.top=this.headerNode.clientHeight+1+"px"},search:function(){var k=this,n={},d=this.buildQueryParams(n);
if(null!==d&&null!==d.q){d&&null===d.sortField&&(d.sortOrder="desc");var e=this.searchContext.portal;n.scopeIsArcGISOnline&&this.searchContext.arcgisOnlinePortal&&(e=this.searchContext.arcgisOnlinePortal);null!==this._dfd&&this._dfd.cancel("Search aborted.",!1);var u=null;this._dfd=u=e.queryItems(d).then(function(z){u.isCanceled()||(z.queryParams||(z.queryParams={start:z.start,num:z.num},z.nextQueryParams||"undefined"===typeof z.nextStart||-1===z.nextStart||(z.nextQueryParams={start:z.nextStart})),
x.forEach(k.getComponents(),function(A){A.processResults(z)}))}).otherwise(function(z){console.warn("searchError",z)})}},_showLayers:function(){this.wabWidget&&this.wabWidget.showLayers()}})})},"widgets/AddData/search/SearchBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/on dojo/keys ./SearchComponent dojo/text!./templates/SearchBox.html dojo/i18n!../nls/strings".split(" "),function(K,g,x,p,r,h,b){return K([r],{i18n:b,templateString:h,postCreate:function(){this.inherited(arguments);
this._checkClearButton();this.own(x(this.searchTextBox,"keyup",g.hitch(this,function(a){this._checkClearButton();a.keyCode===p.ENTER&&this.search()})))},_checkClearButton:function(){},clearButtonClicked:function(){this.searchTextBox.value="";this._checkClearButton();this.search()},searchButtonClicked:function(){this.search()},appendQueryParams:function(a){var c=this.searchTextBox.value;null!==c&&(c=g.trim(c));null!==c&&0<c.length&&(a.canSortByRelevance=!0,c="("+c+")",a.q=null!==a.q&&0<a.q.length?
a.q+(" AND "+c):c)}})})},"widgets/AddData/search/SearchComponent":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin"],function(K,g,x,p){return K([g,x,p],{isSearchComponent:!0,searchPane:null,template:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments)},appendQueryParams:function(r,h){},processResults:function(r){},getConfig:function(){return this.searchPane&&this.searchPane.wabWidget&&this.searchPane.wabWidget.config?
this.searchPane.wabWidget.config:{}},getMap:function(){return this.searchPane&&this.searchPane.wabWidget?this.searchPane.wabWidget.map:null},search:function(){this.searchPane&&this.searchPane.search()}})})},"widgets/AddData/search/BBoxOption":function(){define(["dojo/_base/declare","./SearchComponent","dojo/text!./templates/BBoxOption.html","dojo/i18n!../nls/strings","dijit/form/CheckBox"],function(K,g,x,p){return K([g],{i18n:p,templateString:x,postCreate:function(){this.inherited(arguments);this.bboxToggle.set("checked",
!0)},bboxClicked:function(){this.search()},_getBBox:function(){var r;if(r=this.getMap())if(r=r.geographicExtent)return r.xmin+","+r.ymin+","+r.xmax+","+r.ymax;return null},appendQueryParams:function(r){if(this.bboxToggle.get("checked")){var h=this._getBBox();null!==h&&(r.canSortByRelevance=!0,r.bbox=h)}}})})},"widgets/AddData/search/ScopeOptions":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class ./SearchComponent dojo/text!./templates/ScopeOptions.html dojo/i18n!../nls/strings ./util".split(" "),
function(K,g,x,p,r,h,b,a){return K([r],{i18n:b,templateString:h,curatedFilter:null,postCreate:function(){this.inherited(arguments)},startup:function(){this._started||(this.inherited(arguments),this.initOptions())},hideDropdown:function(){p.remove(this.scopePlaceholder,"opened");p.remove(this.btnGroup,"show")},initOptions:function(){var c=this.searchPane.searchContext,l="string"===typeof c.username&&0<c.username.length,k=this.getConfig().scopeOptions;this.curatedFilter=k.Curated.filter;var n=null;
c=function(d,e){var u=k[d];u&&u.allow?("string"===typeof u.label&&0<g.trim(u.label).length?a.setNodeText(e,g.trim(u.label)):l||"MyOrganization"!==d||a.setNodeText(e,b.search.scopeOptions.anonymousContent),k.defaultScope===d&&(n=e)):e.style.display="none"};c("MyContent",this.MyContentToggle);c("MyOrganization",this.MyOrganizationToggle);c("Curated",this.CuratedToggle);c("ArcGISOnline",this.ArcGISOnlineToggle);n||(k.MyOrganization.allow?n=this.MyOrganizationToggle:k.ArcGISOnline.allow?n=this.ArcGISOnlineToggle:
k.Curated.allow?n=this.CuratedToggle:k.MyContent.allow&&(n=this.MyContentToggle));n&&(p.add(n,"active"),this.scopePlaceholderText.innerHTML=n.innerHTML)},optionClicked:function(c){this.toggleClassName(c);this.hideDropdown();this.search()},scopePlaceholderClicked:function(c){c.preventDefault();p.contains(this.scopePlaceholder,"opened")?this.hideDropdown():this.showDropdown()},showDropdown:function(){p.add(this.scopePlaceholder,"opened");p.add(this.btnGroup,"show")},toggleClassName:function(c){x.forEach(this.btnGroup.children,
function(l){p.remove(l,"active")});p.add(c.target,"active");this.scopePlaceholderText.innerHTML=c.target.innerHTML},appendQueryParams:function(c,l){var k=null;x.some(this.btnGroup.children,function(A){if(p.contains(A,"active"))return k=A.getAttribute("data-option-name"),!0});"undefined"===typeof k&&(k=null);var n=null,d=this.curatedFilter,e=this.searchPane.searchContext,u=e.username,z=e.orgId;"MyContent"===k?"string"===typeof u&&0<u.length&&(n="(owner:"+a.escapeForLucene(u)+")"):"MyOrganization"===
k?"string"===typeof z&&0<z.length&&(n="(orgid:"+a.escapeForLucene(z)+")"):"Curated"===k?"string"===typeof d&&0<d.length&&(n=d):"ArcGISOnline"===k&&e.allowArcGISOnline&&(l.scopeIsArcGISOnline=!0);null!==n&&0<n.length&&(n="("+n+")",c.q=null!==c.q&&0<c.q.length?c.q+(" AND "+n):n)}})})},"widgets/AddData/search/TypeOptions":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on ./SearchComponent dojo/text!./templates/TypeOptions.html dojo/i18n!../nls/strings esri/layers/VectorTileLayer dijit/TooltipDialog dijit/form/DropDownButton jimu/dijit/CheckBox".split(" "),
function(K,g,x,p,r,h,b,a){return K([r],{i18n:b,templateString:h,postCreate:function(){this.inherited(arguments);a&&a.supported()||(console.warn("AddData: Vector Tile is not supported."),this.vectorTileNode.style.display="none");this.own(p(this.tooltipDialog,"open",x.hitch(this,function(){this.tooltipDialog.domNode.className+=" "+this.searchPane.wabWidget.appConfig.theme.name})));this.own(p(this.mapServiceToggle,"change",x.hitch(this,function(){this.search()})));this.own(p(this.featureServiceToggle,
"change",x.hitch(this,function(){this.search()})));this.own(p(this.imageServiceToggle,"change",x.hitch(this,function(){this.search()})));this.own(p(this.vectorTileServiceToggle,"change",x.hitch(this,function(){this.search()})));this.own(p(this.kmlToggle,"change",x.hitch(this,function(){this.search()})));this.own(p(this.wmsToggle,"change",x.hitch(this,function(){this.search()})));this.own(p(this.wfsToggle,"change",x.hitch(this,function(){this.search()})));this.own(p(this.wmtsToggle,"change",x.hitch(this,
function(){this.search()})))},getOptionWidgets:function(){return[this.mapServiceToggle,this.featureServiceToggle,this.imageServiceToggle,this.vectorTileServiceToggle,this.kmlToggle,this.wmsToggle,this.wfsToggle,this.wmtsToggle]},optionClicked:function(){},appendQueryParams:function(c){var l=function(e,u){0<e.length&&(e+=" OR ");return e+u},k="",n="",d=!1;g.forEach(this.getOptionWidgets(),function(e){var u=e.domNode.getAttribute("data-option-q");n=l(n,u);e.getValue()&&(k=l(k,u),d=!0)});d||(k=n);null!==
k&&0<k.length&&(k="("+k+")",c.q=null!==c.q&&0<c.q.length?c.q+(" AND "+k):k)}})})},"esri/layers/VectorTileLayer":function(){(function(){var K=function(){try{var x=window.WebGLRenderingContext}catch(c){x=!1}try{for(var p=document.createElement("canvas"),r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],h=null,b=0;b<r.length;++b){try{h=p.getContext(r[b])}catch(c){}if(h)break}var a=h}catch(c){a=!1}return x&&a?!0:!1}(),g=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];K&&g.push("./VectorTileLayerImpl");
define(g,function(x,p,r,h,b,a){b=a?a:b.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var c=new r;c.reject(Error("esri.layers.VectorTileLayer is not supported"));c.promise.otherwise(x.hitch(this,function(l){this._errorHandler(l)}))}});b.ACCESS_TOKEN=null;b.supported=function(){return K};p("extend-esri")&&x.setObject("layers.VectorTileLayer",b,h);return b})})()},"widgets/AddData/search/SortOptions":function(){define("dojo/_base/declare dojo/on dojo/dom-class ./SearchComponent dojo/text!./templates/SortOptions.html dojo/i18n!../nls/strings dijit/form/Select".split(" "),
function(K,g,x,p,r,h){return K([p],{i18n:h,templateString:r,sortField:null,sortOrder:null,postCreate:function(){this.inherited(arguments);this.updateSortOrderButton();var b=this;this.own(this.sortSelect.on("change",function(){var a=b.sortField=b.sortSelect.get("value");if(""===a)b.sortOrder=null;else if("title"===a||"owner"===a)b.sortOrder="asc";else if("avgrating"===a||"numviews"===a||"modified"===a)b.sortOrder="desc";b.updateSortOrderButton();b.search()}));this.own(g(this.sortSelect.dropDown,"open",
function(){var a=this.domNode.parentElement;a&&x.add(a,"add-data-widget-popup")}))},sortOrderClicked:function(){"asc"===this.sortOrder?(this.sortOrder="desc",this.updateSortOrderButton(),this.search()):"desc"===this.sortOrder&&(this.sortOrder="asc",this.updateSortOrderButton(),this.search())},updateSortOrderButton:function(){var b=this.sortOrderBtn;b.style.visibility=null!==this.sortField&&0<this.sortField.length?"visible":"hidden";"desc"===this.sortOrder?x.add(b,"descending"):x.remove(b,"descending")},
appendQueryParams:function(b){b.sortField=null;b.sortOrder=null;var a=this.sortField,c=this.sortOrder;null!==a&&0<a.length?(b.sortField=a,null!==c&&0<c.length&&(b.sortOrder=c)):b.canSortByRelevance||(b.sortField="numviews",b.sortOrder="desc")}})})},"widgets/AddData/search/ResultsPane":function(){define("dojo/_base/declare dojo/_base/array ./SearchComponent dojo/text!./templates/ResultsPane.html dojo/i18n!../nls/strings ./ItemCard ./util".split(" "),function(K,g,x,p,r,h,b){return K([x],{i18n:r,templateString:p,
postCreate:function(){this.inherited(arguments)},addItem:function(a){a.placeAt(this.itemsNode)},destroyItems:function(){this.noMatchNode.style.display="none";this.noMatchNode.innerHTML="";this.destroyDescendants(!1)},showNoMatch:function(){b.setNodeText(this.noMatchNode,r.search.resultsPane.noMatch);this.noMatchNode.style.display="block"},processResults:function(a){this.destroyItems();var c=a.results;if(c&&0<c.length){var l=b.findLayersAdded(this.getMap(),null).itemIds;g.forEach(a.results,function(k){this.addItem(new h({item:k,
canRemove:-1!==l.indexOf(k.id),resultsPane:this}))},this)}else this.showNoMatch()}})})},"widgets/AddData/search/ItemCard":function(){define("dojo/_base/declare dojo/_base/array dojo/date/locale dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/ItemCard.html dojo/i18n!../nls/strings ./util ./LayerLoader".split(" "),function(K,g,x,p,r,h,b,a,c,l,k){return K([r,h,b],{i18n:c,templateString:a,canRemove:!1,item:null,resultsPane:null,_dfd:null,postCreate:function(){this.inherited(arguments)},
startup:function(){this._started||(this.inherited(arguments),this.render())},addClicked:function(){var n=this,d=this.addButton;if(!p.contains(d,"disabled"))if(p.add(d,"disabled"),this.canRemove){var e=this.resultsPane.getMap();l.setNodeText(n.messageNode,c.search.item.messages.removing);var u=l.findLayersAdded(e,this.item.id).layers;g.forEach(u,function(z){e.removeLayer(z)});this.canRemove=!1;l.setNodeText(n.messageNode,"");l.setNodeText(this.addButton,c.search.item.actions.add);p.remove(d,"disabled")}else l.setNodeText(n.messageNode,
c.search.item.messages.adding),(new k).addItem(this.item,this.resultsPane.getMap()).then(function(z){z?(n.canRemove=!0,l.setNodeText(n.messageNode,""),l.setNodeText(n.addButton,c.search.item.actions.remove)):l.setNodeText(n.messageNode,c.search.item.messages.addFailed);p.remove(d,"disabled")}).otherwise(function(z){console.warn("Add layer failed.");console.warn(z);l.setNodeText(n.messageNode,c.search.item.messages.addFailed);p.remove(d,"disabled");z&&"string"===typeof z.message&&0<z.message.length&&
console.log("")})},detailsClicked:function(){var n=this.item;n=l.checkMixedContent(n.portalUrl)+"/home/item.html?id\x3d"+encodeURIComponent(n.id);window.open(n)},formatDate:function(n){"number"===typeof n&&(n=new Date(n));return x.format(n,{selector:"date",datePattern:c.search.item.dateFormat})},render:function(){l.setNodeText(this.titleNode,this.item.title);l.setNodeTitle(this.titleNode,this.item.title);this._renderThumbnail();this._renderTypeOwnerDate();this.canRemove&&l.setNodeText(this.addButton,
c.search.item.actions.remove)},_renderThumbnail:function(){var n=this.thumbnailNode,d=this.item.thumbnailUrl;n.innerHTML="";d=l.checkMixedContent(d);var e=document.createElement("IMG");e.src=d||"widgets/AddData/images/placeholder_120x80.png";n.appendChild(e)},_renderTypeOwnerDate:function(){var n=this.item;var d=c.search.item.types[n.type];if("undefined"===typeof d||null===d)d=n.type;d=c.search.item.typeByOwnerPattern.replace("{type}",d);d=d.replace("{owner}",n.owner);l.setNodeText(this.typeByOwnerNode,
d)}})})},"widgets/AddData/search/LayerLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/promise/all dojo/Deferred dojo/json dojo/i18n!../nls/strings ./util esri/lang esri/request esri/arcgis/utils esri/layers/ArcGISDynamicMapServiceLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISTiledMapServiceLayer esri/layers/DynamicLayerInfo esri/layers/FeatureLayer esri/layers/ImageParameters esri/layers/ImageServiceParameters esri/layers/KMLLayer esri/layers/LayerDrawingOptions esri/layers/MosaicRule esri/layers/RasterFunction esri/layers/RasterXLayer esri/layers/TileInfo esri/layers/VectorTileLayer esri/layers/WFSLayer esri/layers/WMSLayer esri/layers/WMSLayerInfo esri/layers/WMTSLayer esri/layers/WMTSLayerInfo esri/layers/WebTiledLayer esri/dijit/PopupTemplate esri/InfoTemplate esri/renderers/jsonUtils esri/geometry/Extent esri/SpatialReference jimu/utils".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C,G,D,f,m,y,v,F,H,L,N,Q,R,W,Z,X){return K(null,{item:null,itemUrl:null,map:null,serviceUrl:null,constructor:function(M){g.mixin(this,M)},addItem:function(M,U){var T=new h;this.map=U;this.item=M;this.itemUrl=this._checkMixedContent(M.itemUrl);this.serviceUrl=this._checkMixedContent(M.url);if("Feature Service"===M.type)return this._addFeatureService();if("Image Service"===M.type)return this._addImageService();if("KML"===M.type)return this._addKML();
if("Map Service"===M.type)return this._addMapService();if("Vector Tile Service"===M.type)return this._addVectorTileService();if("WFS"===M.type)return this._addWFS();if("WMS"===M.type)return this._addWMS();if("WMTS"===M.type)return this._addWMTS();console.warn("Unsupported item type: ",M.type);T.resolve(null);return T},_addFeatureService:function(){var M=this,U=new h,T=this.serviceUrl,V=this.item,I={},J=null,O=[],S=[];M._readItemJsonData().then(function(P){(I=P||{},I.layers)&&0<I.layers.length&&x.forEach(I.layers,
function(Y){"undefined"!==typeof Y.id&&null!==Y.id&&(null===J&&(J=[]),J.push(Y.id))});return M._readRestInfo(T)}).then(function(P){if(!P||"string"!==typeof P.type||"Feature Layer"!==P.type&&"Table"!==P.type){var Y=[];P&&P.layers&&0<P.layers.length&&x.forEach(P.layers,function(aa){Y.push(aa)});P&&P.tables&&0<P.tables.length&&x.forEach(P.tables,function(aa){Y.push(aa)});0<Y.length?x.forEach(Y,function(aa){var ba=!0;null!==J&&0<J.length&&(ba=x.some(J,function(ea){return ea===aa.id}));ba&&(ba=new A(T+
"/"+aa.id,{id:M._generateLayerId(),outFields:["*"]}),O.push(M._waitForLayer(ba)))}):console.warn("No layers or tables...")}else P=new A(T,{id:M._generateLayerId(),outFields:["*"]}),O.push(M._waitForLayer(P));return r(O)}).then(function(P){x.forEach(P,function(Y){S.push(Y)});S.reverse();return S}).then(function(){x.forEach(S,function(P){var Y=M._processFeatureLayer(P,V,I);P.arcgisProps={title:Y.title};P._titleForLegend=Y.title;l.isDefined(P.title)||(P.title=Y.title);M._addLayer(P)})}).then(function(){U.resolve(S)}).otherwise(function(P){U.reject(P)});
return U},_addImageService:function(){var M=this,U=new h;M._readItemJsonData().then(function(T){return M._newImageServiceLayer(T||{})}).then(function(T){M._addLayer(T);U.resolve(T)}).otherwise(function(T){U.reject(T)});return U},_addKML:function(){var M=this,U=new h;M._newKMLLayer().then(function(T){T&&(T.title=M.item.title);M._addLayer(T);U.resolve(T)}).otherwise(function(T){U.reject(T)});return U},_addMapService:function(){var M=this,U=new h;M._readItemJsonData().then(function(T){return M._newMapServiceLayer(T||
{})}).then(function(T){M._addLayer(T);U.resolve(T)}).otherwise(function(T){U.reject(T)});return U},_addVectorTileService:function(){var M=this,U=new h;M._newVectorTileLayer().then(function(T){M._addLayer(T);U.resolve(T)}).otherwise(function(T){U.reject(T)});return U},_addWFS:function(){var M=this,U=new h;M._readItemJsonData().then(function(T){return M._newWFSLayer(T||{})}).then(function(T){T&&(T.title=M.item.title);M._addLayer(T);U.resolve(T)}).otherwise(function(T){console.log("Error adding WFS",
T);U.reject(T)});return U},_addWMS:function(){var M=this,U=new h;M._readItemJsonData().then(function(T){return M._newWMSLayer(T||{})}).then(function(T){T&&(T.title=M.item.title);M._addLayer(T);U.resolve(T)}).otherwise(function(T){U.reject(T)});return U},_addWMTS:function(){var M=this,U=new h;M._readItemJsonData().then(function(T){return M._newWMTSLayer(T||{})}).then(function(T){T&&(T.title=M.item.title);M._addLayer(T);U.resolve(T)}).otherwise(function(T){U.reject(T)});return U},_addLayer:function(M){var U=
this.item;M&&(M.xtnItemId=U.id,M.xtnAddData=!0,!M.arcgisProps&&U&&(M.arcgisProps={title:U.title},M._titleForLegend=U.title),l.isDefined(M.title)||(M.title=U.title),M._wabProperties={itemLayerInfo:{itemId:U.id,itemUrl:this.itemUrl,portalUrl:U.portalUrl}},this.map.addLayer(M))},_checkMixedContent:function(M){return c.checkMixedContent(M)},_checkUrl:function(M){return n._checkUrl(M)},_checkVectorTileUrl:function(M,U){var T=new h;if(function(I,J){return-1!==I.indexOf(J,I.length-J.length)}(M,".json"))return U.styleUrl=
M,T.resolve(M),T;var V={url:null,content:{},handleAs:"json",callbackParamName:"callback"};this.itemUrl?(V.url=this.itemUrl+"/resources/styles/root.json",k(V,{}).then(function(){U.styleUrl=V.url;T.resolve(V.url)}).otherwise(function(){V.url=M+"/resources/styles/root.json";k(V,{}).then(function(){U.styleUrl=V.url;T.resolve(V.url)}).otherwise(function(){U.url=M;T.resolve(M)})})):(V.url=M+"/resources/styles/root.json",k(V,{}).then(function(){U.styleUrl=V.url;T.resolve(V.url)}).otherwise(function(){U.url=
M;T.resolve(M)}));return T},_generateLayerId:function(){return this._generateLayerIds(1)[0]},_generateLayerIds:function(M){var U,T=[];for(U=0;U<M;U++)T.push(this._generateRandomId());return T},_generateRandomId:function(){var M=null;M="function"===typeof Date.now?Date.now():(new Date).getTime();var U=(""+Math.random()).replace("0.","r");return(M+""+U).replace(/-/g,"")},_makeFeatureLayerTitle:function(M,U,T){try{if(U&&T&&U===T)return U;if(U&&T){var V=T.indexOf(U);if(0===V){var I=T.substring(V+U.length+
1);if(13<=I.length){var J=/^\d+$/;if(J.test(I))return U}}}}catch(O){}return M.replace("{serviceName}",U).replace("{layerName}",T)},_newImageServiceLayer:function(M){var U=new h,T=this._generateLayerId(),V=this.serviceUrl,I=this.serviceUrl,J={mapLayerId:T,bandIds:null,format:null,compressionQuality:null,opacity:1,visibility:!0};l.isDefined(M.visibility)&&!1===M.visibility&&(J.visibility=!1);l.isDefined(M.opacity)&&(J.opacity=M.opacity);l.isDefined(M.minScale)&&!l.isDefined(J.minScale)&&(J.minScale=
M.minScale);l.isDefined(M.maxScale)&&!l.isDefined(J.maxScale)&&(J.maxScale=M.maxScale);l.isDefined(M.refreshInterval)&&!l.isDefined(J.refreshInterval)&&(J.refreshInterval=M.refreshInterval);!M.popupInfo||J.popupInfo||J.disablePopup||(J.popupInfo=M.popupInfo);M.renderingRule&&!J.renderingRule&&(J.renderingRule=M.renderingRule,M.renderingRule.functionName&&(J.renderingRule.rasterFunction=M.renderingRule.functionName));M.bandIds&&!J.bandIds&&(J.bandIds=M.bandIds);M.mosaicRule&&!J.mosaicRule&&(J.mosaicRule=
M.mosaicRule);M.format&&!J.format&&(J.format=M.format);l.isDefined(M.compressionQuality)&&!l.isDefined(J.compressionQuality)&&(J.compressionQuality=M.compressionQuality);!M.layerDefinition||!M.layerDefinition.definitionExpression||l.isDefined(J.layerDefinition)&&l.isDefined(J.layerDefinition.definitionExpression)||(J.layerDefinition=J.layerDefinition||{},J.layerDefinition.definitionExpression=M.layerDefinition.definitionExpression);M=new w;null!==J.bandIds&&(M.bandIds=J.bandIds);null!==J.format&&
(M.format=J.format,null!==J.compressionQuality&&(M.compressionQuality=J.compressionQuality));if(J.renderingRule&&J.renderingRule.rasterFunction){var O=new C(J.renderingRule);M.renderingRule=O}J.mosaicRule&&(O=new B(J.mosaicRule),M.mosaicRule=O);l.isDefined(J.noData)&&(M.noData=J.noData);l.isDefined(J.noDataInterpretation)&&(M.noDataInterpretation=J.noDataInterpretation);l.isDefined(J.interpolation)&&(M.interpolation=J.interpolation);var S={imageServiceParameters:M,opacity:J.opacity,visible:J.visibility};
l.isDefined(J.mapLayerId)&&(S.id=J.mapLayerId);l.isDefined(J.minScale)&&(S.minScale=J.minScale);l.isDefined(J.maxScale)&&(S.maxScale=J.maxScale);l.isDefined(J.refreshInterval)&&(S.refreshInterval=J.refreshInterval);l.isDefined(J.resourceInfo)&&(S.resourceInfo=J.resourceInfo);var P=this,Y,aa;P._readRestInfo(V).then(function(ba){var ea=null;if(ba&&ba.tileInfo&&ba.singleFusedMapCache)return ea="Raster"===ba.cacheType?new G(V,{id:T}):new u(V,{id:T}),P._waitForLayer(ea).then(function(ca){aa=ca});ea=new e(P._checkUrl(I),
S);return P._waitForLayer(ea).then(function(ca){Y=ca})}).then(function(){if(Y){var ba=Y;J.layerDefinition&&J.layerDefinition.definitionExpression&&ba.setDefinitionExpression(J.layerDefinition.definitionExpression,!0);!J.disablePopup&&J.popupInfo&&ba.setInfoTemplate(new N(J.popupInfo));U.resolve(ba)}else aa?U.resolve(aa):U.resolve()}).otherwise(function(ba){U.reject(ba)});return U},_newInfoTemplate:function(M,U){if(M)try{return new N({description:M.description,title:M.title,showAttachments:M.showAttachments,
fieldInfos:M.fieldInfos,mediaInfos:M.mediaInfos})}catch(T){console.error(T)}M=new Q;l.isDefined(U)&&M.setTitle(U);return M},_newKMLLayer:function(){var M={id:this._generateLayerId()};M=new q(this.serviceUrl,M);return this._waitForLayer(M)},_newMapServiceLayer:function(M){var U=this,T=new h,V=this.serviceUrl,I=this._generateLayerId();k({url:V,content:{f:"json"},handleAs:"json",callbackParamName:"callback"},{}).then(function(J){var O=null;O={id:I};if(J.tileInfo)O=new u(V,O);else if(J&&J.supportedImageFormatTypes&&
-1!==J.supportedImageFormatTypes.indexOf("PNG32")&&(O.imageParameters=new t,O.imageParameters.format="png32"),O=new d(V,O),M&&M.layers&&0<M.layers.length){var S=[],P,Y=[],aa,ba=[],ea;x.forEach(M.layers,function(ca){ca.layerDefinition&&ca.layerDefinition.definitionExpression&&(S[ca.id]=ca.layerDefinition.definitionExpression);if(ca.layerDefinition&&ca.layerDefinition.source){P=null;ea=ca.layerDefinition.source;if("mapLayer"===ea.type){var na=x.filter(J.layers,function(oa){return oa.id===ea.mapLayerId});
na.length&&(P=g.mixin(na[0],ca))}else P=g.mixin({},ca);P&&(P.source=ea,delete P.popupInfo,P=new z(P),M.visibleLayers&&(na="string"===typeof M.visibleLayers?M.visibleLayers.split(","):M.visibleLayers,-1<x.indexOf(na,ca.id)?P.defaultVisibility=!0:P.defaultVisibility=!1),Y.push(P))}ca.layerDefinition&&ca.layerDefinition.source&&ca.layerDefinition.drawingInfo&&(aa=new E(ca.layerDefinition.drawingInfo),ba[ca.id]=aa)});0<S.length&&O.setLayerDefinitions(S);0<Y.length&&(O.setDynamicLayerInfos(Y,!0),0<ba.length&&
O.setLayerDrawingOptions(ba,!0))}U._waitForLayer(O).then(function(ca){var na=null;x.forEach(ca.layerInfos,function(oa){var ma=null;M&&x.some(M.layers,function(xa){if(oa.id===xa.id)return ma=xa,!0});var ha=null;ma&&ma.popupInfo&&(ha=ma.popupInfo);ha&&(null===na&&(na={}),na[oa.id]={infoTemplate:U._newInfoTemplate(ha,oa.name)})});null===ca.infoTemplates&&(na?ca.infoTemplates=na:U._setDynamicLayerInfoTemplates(ca));T.resolve(ca)},function(ca){T.reject(ca)})},function(J){T.reject(J)});return T},_getVisibleFeatureLayers:function(M,
U){if(!M||!U||0===U.length)return[];U=","+U+",";var T=[],V,I=",";for(V=0;V<M.length;V++)if(null!==M[V].subLayerIds){if(-1===U.indexOf(","+M[V].id+",")||-1<I.indexOf(","+M[V].id+","))I+=M[V].subLayerIds.toString()+","}else-1<U.indexOf(","+M[V].id+",")&&-1===I.indexOf(","+M[V].id+",")&&T.push(M[V].id);return T},_newPopupInfo:function(M,U){if(M&&M.fields){var T={title:M.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]};"string"===typeof U&&0<U.length&&(T.title=U);x.forEach(M.fields,
function(V){var I=X.getDefaultPortalFieldInfo(V);I.visible=!0;I.isEditable=V.editable;T.fieldInfos.push(I)});return T}return null},_newVectorTileLayer:function(){var M=this,U=new h,T={},V=this.serviceUrl,I=this._generateLayerId();"string"===typeof V&&0<V.length?this._checkVectorTileUrl(V,T).then(function(J){"string"===typeof J&&0<J.length?(J=M._checkMixedContent(J),J=new f(J,{id:I,opacity:1,visible:!0}),M._waitForLayer(J).then(function(O){U.resolve(O)},function(O){U.reject(O)})):U.resolve(null)},
function(J){U.reject(J)}):U.resolve(null);return U},_newWFSLayer:function(M){var U=new h;try{var T=this._generateLayerId();if(M&&M.wfsInfo&&M.layerDefinition)var V={id:T,mode:M.mode,showLabels:!0,title:M.title,url:this._checkMixedContent(M.url),customParameters:M.wfsInfo.customParameters,maxFeatures:M.wfsInfo.maxFeatures,name:M.wfsInfo.name,swapXY:M.wfsInfo.swapXY,version:M.wfsInfo.version,geometryType:M.layerDefinition.geometryType,labelingInfo:M.layerDefinition.drawingInfo.labelingInfo};else{var I=
this.serviceUrl;I?c.loadWFSByUrl(U,map,this,I,T,!1):U.reject(Error("Error adding WFS, no URL"));return U}var J=new m,O=J.on("error",function(S){O&&O.remove();U.reject(S.error)});J.fromJson(V,function(){try{O&&O.remove();if(M&&M.wfsInfo&&M.layerDefinition){l.isDefined(M.opacity)&&J.setOpacity(M.opacity);l.isDefined(M.visibility)&&J.setVisibility(M.visibility);(M.minScale||M.maxScale)&&J.setScaleRange(M.minScale,M.maxScale);var S=M.layerDefinition.drawingInfo;S&&S.renderer&&(J.renderer=R.fromJson(S.renderer,
{geometryType:V.geometryType}));M.popupInfo&&J.setInfoTemplate(new N(M.popupInfo))}U.resolve(J)}catch(P){console.error("Error adding WFS",P),U.reject(ex)}})}catch(S){console.error("Error adding WFS",S),U.reject(S)}return U},_newWMSLayer:function(M){var U=this,T=this.item,V=!1,I=null,J={id:this._generateLayerId()};if(M){var O=[],S=[];x.forEach(M.layers,function(P){V=!0;S.push(new v({name:P.name,title:P.title,legendURL:P.legendURL,queryable:P.queryable,showPopup:P.showPopup}));O.push(P.name)},this);
M.visibleLayers&&(O=M.visibleLayers);J={customLayerParameters:M.customLayerParameters,customParameters:M.customParameters,layerInfos:S,version:M.version,maxWidth:M.maxWidth,maxHeight:M.maxHeight,featureInfoFormat:M.featureInfoFormat,getFeatureInfoURL:M.featureInfoUrl,getMapURL:M.mapUrl,spatialReferences:M.spatialReferences,title:M.title,copyright:M.copyright,minScale:M.minScale||0,maxScale:M.maxScale||0,format:M.format};T&&T.extent&&(T=new W(T.extent[0][0],T.extent[0][1],T.extent[1][0],T.extent[1][1],
new Z({wkid:4326})),J.extent=T);M.spatialReferences&&0<M.spatialReferences.length&&(I=M.spatialReferences[0]);J={id:this._generateLayerId(),visibleLayers:O,format:"png",transparent:M.firstLayer?!1:!0,opacity:M.opacity,visible:null!==M.visibility?M.visibility:!0,resourceInfo:J,refreshInterval:M.refreshInterval}}M=new y(this.serviceUrl,J);M=this._waitForLayer(M);M.then(function(P){V||U._setWMSVisibleLayers(P);I&&P.spatialReference&&(P.spatialReference.wkid=I)});return M},_newWMTSLayer:function(M){if(M){var U=
new L(M.templateUrl,{id:this._generateLayerId(),visible:null!==M.visibility?M.visibility:!0,opacity:M.opacity,copyright:M.copyright,fullExtent:M.fullExtent&&new W(M.fullExtent),initialExtent:M.fullExtent&&new W(M.fullExtent),subDomains:M.subDomains,tileInfo:M.tileInfo?new D(M.tileInfo):null,refreshInterval:M.refreshInterval,wmtsInfo:M.wmtsInfo});if(l.isDefined(M.minScale)||l.isDefined(M.maxScale))U.loaded?U.setScaleRange(M.minScale,M.maxScale):p.connect(U,"onLoad",function(){U.setScaleRange(M.minScale,
M.maxScale)});return this._waitForLayer(U)}var T=new h;T.resolve();return T},_processFeatureLayer:function(M,U,T){var V=this,I=a.search.featureLayerTitlePattern,J=null;T&&T.layers&&0<T.layers.length?x.some(T.layers,function(O){var S=!1;if(O.id===M.layerId){if(O.popupInfo){var P=O.popupInfo;P=b.parse(b.stringify(P));P=new N(P);M.setInfoTemplate(P);S=!0}l.isDefined(O.showLabels)&&M.setShowLabels(O.showLabels);l.isDefined(O.refreshInterval)&&M.setRefreshInterval(O.refreshInterval);l.isDefined(O.showLegend)&&
console.log("");l.isDefined(O.timeAnimation)&&!1===O.timeAnimation&&console.log("");if(P=O.layerDefinition){P.definitionExpression&&M.setDefinitionExpression(P.definitionExpression);P.displayField&&M.displayField(P.displayField);if(P.drawingInfo){if(P.drawingInfo.renderer){var Y=b.parse(b.stringify(P.drawingInfo.renderer));var aa=R.fromJson(Y);Y.type&&"classBreaks"===Y.type&&(aa.isMaxInclusive=!0);M.setRenderer(aa)}l.isDefined(P.drawingInfo.transparency)&&M.setOpacity(1-P.drawingInfo.transparency/
100)}l.isDefined(P.minScale)&&M.setMinScale(P.minScale);l.isDefined(P.maxScale)&&M.setMaxScale(P.maxScale);l.isDefined(P.defaultVisibility)&&!1===P.defaultVisibility&&M.setVisibility(!1)}S||V._setFeatureLayerInfoTemplate(M,O.popupInfo);J={url:M.url,id:M.id,itemId:U.id,title:V._makeFeatureLayerTitle(I,U.title,M.name)};return!0}}):(J={url:M.url,id:M.id,itemId:U.id,title:V._makeFeatureLayerTitle(I,U.title,M.name)},V._setFeatureLayerInfoTemplate(M,null,J.title));return J},_readItemJsonData:function(){return k({url:this.itemUrl+
"/data",content:{f:"json"},handleAs:"json"},{})},_readRestInfo:function(M){return k({url:M,content:{f:"json"},handleAs:"json",callbackParamName:"callback"},{})},_setDynamicLayerInfoTemplates:function(M){var U=this,T=null,V=[],I=function(J){var O=U._readRestInfo(M.url+"/"+J.id);O.then(function(S){try{var P=U._newPopupInfo(S);P&&(T[J.id]={infoTemplate:U._newInfoTemplate(P)})}catch(Y){console.warn("Error setting popup."),console.error(Y)}});return O};null===M.infoTemplates&&x.forEach(M.layerInfos,function(J){null===
T&&(T={});J.subLayerIds||V.push(I(J))});0<V.length&&r(V).then(function(){T&&(M.infoTemplates=T)}).otherwise(function(J){console.warn("Error reading sublayers.");console.error(J)})},_setFeatureLayerInfoTemplate:function(M,U,T){U||(U=this._newPopupInfo(M,T));U=this._newInfoTemplate(U,T);M.setInfoTemplate(U)},_setWMSVisibleLayers:function(M){var U=[];M&&(x.some(M.layerInfos,function(T){if("string"===typeof T.name&&0<T.name.length)if(10>U.length)U.push(T.name);else return!0}),10>=U.length&&M.setVisibleLayers(U))},
_waitForLayer:function(M){var U=new h,T=[];if(M.loaded)return U.resolve(M),U;if(M.loadError)return U.reject(M.loadError),U;var V=function(){x.forEach(T,function(I){I.remove()})};T.push(M.on("load",function(I){V();U.resolve(I.layer)}));T.push(M.on("error",function(I){V();I=I.error;try{I.message&&-1!==I.message.indexOf("Unable to complete")?(console.warn("layerAccessError",I),U.reject(Error(a.search.layerInaccessible))):U.reject(I)}catch(J){U.reject(I)}}));return U}})})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),
function(K,g,x,p,r,h){K=K(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(b){var a=this.bbox||this.extent;b=(a=a&&b&&a._normalize(!0))?a.spatialReference.wkid||x.toJson(a.spatialReference.toJson()):null;
var c=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:b,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:c?c.wkid||x.toJson(c.toJson()):b,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?x.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?x.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?
x.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};b=this.timeExtent;a.time=b?b.toJson().join(","):null;return h.filter(a,function(l){if(null!==l&&void 0!==l)return!0})}});g.mixin(K,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",
NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});p("extend-esri")&&g.setObject("layers.ImageServiceParameters",K,r);return K})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C){var G=g([w],{declaredClass:"esri.layers.KMLLayer",serviceUrl:u.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(D,f){D||console.log("KMLLayer:constructor - please provide url for the KML file");this._url=u.urlToObject(this.url=D);this._outSR=f&&f.outSR||new z({wkid:4326});this._options=p.mixin({},f);n.defaults.kmlService&&(this.serviceUrl=n.defaults.kmlService);if(D=this.linkInfo=f&&f.linkInfo)this.visible=
!!D.visibility,this._waitingForMap=!!D.viewFormat;(!D||D&&D.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=p.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(D){if(D){var f=D.type,m=D.id,y;switch(f){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(D=this["_"+f])&&(y=p.getObject("_mode._featureMap."+m,!1,D));break;case "GroundOverlay":if(D=this._groundLyr){var v=D.getImages();f=v.length;for(D=0;D<f;D++)if(v[D].id===
m){y=v[D];break}}break;case "ScreenOverlay":break;case "NetworkLink":r.some(this._links,function(F){return F.linkInfo&&F.linkInfo.id===m?(y=F,!0):!1});break;case "Folder":f=(v=this.folders)?v.length:0;for(D=0;D<f;D++)if(v[D].id===m){y=v[D];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return y}},getLayers:function(){var D=[];this._groundLyr&&D.push(this._groundLyr);this._fLayers&&(D=D.concat(this._fLayers));this._links&&r.forEach(this._links,function(f){f.declaredClass&&
D.push(f)});return D},setFolderVisibility:function(D,f){D&&(this._fireUpdateStart(),(D.visible=f)&&(f=this._areLocalAncestorsVisible(D)),this._setState(D,f),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},onRefresh:function(){},onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(D){var f=this;this._fireUpdateStart();this._io=e({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(D),model:"simple",folders:"",refresh:this.loaded?!0:
void 0,outSR:h.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(m){f._io=null;f._initLayer(m)},error:function(m){f._io=null;m=p.mixin(Error(),m);m.message="Unable to load KML: "+(m.message||"");f._fireUpdateEnd(m);f._errorHandler(m)}})},_initLayer:function(D){if(this.loaded){var f=[];r.forEach(this.folders,function(N){N.visible&&f.push(N.id)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale;this._options.opacity=this.opacity;this._removeInternalLayers()}this.name=
D.name;this.description=D.description;this.snippet=D.snippet;this.visibility=D.visibility;this.featureInfos=D.featureInfos;var m,y=this.folders=D.folders,v=[];if(y){var F=y.length;for(m=0;m<F;m++){var H=y[m]=new q(y[m]);-1===H.parentFolderId&&v.push(H)}}y=this._links=D.networkLinks;F=y?y.length:0;for(m=0;m<F;m++)if(!y[m].viewRefreshMode||-1===y[m].viewRefreshMode.toLowerCase().indexOf("onregion")){var L=p.mixin({},this._options);L.linkInfo=y[m];L.id&&(L.id=L.id+"_"+m);H=y[m]=new G(y[m].href,L);H._parentLayer=
this;H._parentFolderId=this._getLinkParentId(H.linkInfo.id);H._linkErrorHandle=H.on("error,network-link-error",p.hitch(H,function(N){this._parentLayer.onNetworkLinkError(N.error)}))}if((y=D.groundOverlays)&&0<y.length)for(L=p.mixin({},this._options),L.id&&(L.id+="_mapImage"),H=this._groundLyr=new B(L),F=y.length,m=0;m<F;m++)H.addImage(new E(y[m]));(D=p.getObject("featureCollection.layers",!1,D))&&0<D.length&&(this._fLayers=[],r.forEach(D,function(N,Q){var R=p.getObject("featureSet.features",!1,N);
R&&0<R.length&&(L=p.mixin({outFields:["*"],infoTemplate:N.popupInfo?new t(N.popupInfo):null,editable:!1},this._options),L.id&&(L.id=L.id+"_"+Q),L.webgl=!1,N.layerDefinition.capabilities="Query,Data",N=new C(N,L),N.geometryType&&(this["_"+N.geometryType]=N),this._fLayers.push(N))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(F=v.length,m=0;m<F;m++)H=v[m],this._setState(H,H.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),r.forEach(this.folders,function(N){-1<
r.indexOf(f,N.id)?this.setFolderVisibility(N,!0):this.setFolderVisibility(N,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var D=this._map;this._fireUpdateStart();this._links&&r.forEach(this._links,function(v){v.declaredClass&&(D.addLayer(v),v._waitingForMap&&(v._waitingForMap=null,v.visible?v._parseKml(D):v._wMap=D))});var f=D.spatialReference,m=this._outSR;if(!f.equals(m))if(f.isWebMercator()&&4326===m.wkid)var y=A.geographicToWebMercator;else if(m.isWebMercator()&&
4326===f.wkid)y=A.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return}this._groundLyr&&(y&&r.forEach(this._groundLyr.getImages(),function(v){v.extent=y(v.extent)}),D.addLayer(this._groundLyr));(f=this._fLayers)&&0<f.length&&r.forEach(f,function(v){if(y){var F=v.graphics,H,L,N=F?F.length:0;for(H=0;H<N;H++)(L=F[H].geometry)&&F[H].setGeometry(y(L))}D.addLayer(v)});
this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var D=this._map;this._links&&r.forEach(this._links,function(f){f.declaredClass&&f._io&&f._io.cancel();f._linkErrorHandle&&(f._linkErrorHandle.remove(),f._linkErrorHandle=null)});D&&r.forEach(this.getLayers(),D.removeLayer,D)},_setState:function(D,f){D=D.featureInfos;var m,y,v=D?D.length:0,F=f?"show":"hide",H=f?"_resume":"_suspend";for(y=0;y<v;y++){var L=D[y];if(m=this.getFeature(L))if("Folder"===L.type)this._setState(m,f&&m.visible);
else if("NetworkLink"===L.type)this._setInternalVisibility(m,f);else if(m[H])m[H]();else m[F]()}},_areLocalAncestorsVisible:function(D){var f=D.parentFolderId;for(D=D.visible;D&&-1!==f;)f=this.getFeature({type:"Folder",id:f}),D=D&&f.visible,f=f.parentFolderId;return D},_setInternalVisibility:function(D,f){var m=D._parentLayer,y=D._parentFolderId;for(f=f&&D.visible;f&&m;)f=f&&m.visible,-1<y&&(f=f&&m._areLocalAncestorsVisible(m.getFeature({type:"Folder",id:y}))),y=m._parentFolderId,m=m._parentLayer;
this._setIntState(D,f)},_setIntState:function(D,f){D&&r.forEach(D.getLayers(),function(m){m.linkInfo?D._setIntState(m,f&&m.visible&&D._areLocalAncestorsVisible(D.getFeature({type:"Folder",id:m._parentFolderId}))):m.setVisibility(f)})},_getLinkParentId:function(D){var f=-1;this.folders&&r.some(this.folders,function(m){return m.networkLinkIds&&-1!==r.indexOf(m.networkLinkIds,D)?(f=m.id,!0):!1});return f},_checkAutoRefresh:function(){var D=this.linkInfo;if(D)if(this.visible){if(this.loaded&&this._map){var f=
D.refreshMode,m=D.refreshInterval,y=D.viewRefreshMode;D=D.viewRefreshTime;f&&-1!==f.toLowerCase().indexOf("oninterval")&&0<m&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*m));y&&-1!==y.toLowerCase().indexOf("onstop")&&0<D&&!this._extChgHandle&&(this._extChgHandle=x.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),x.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);
this._timeoutHandle=null},_getQueryParameters:function(D){D=D||this._map;var f={},m=this.linkInfo,y=D&&D.extent;if(this._url.query){p.mixin(f,this._url.query);var v=!!this._url.query.token}k.id&&!v&&(v=k.id.findCredential(this._url.path))&&(f.token=v.token);if(m){v=m.viewFormat;var F=m.httpQuery;m=m.viewBoundScale;if(y&&v){var H=y,L=y,N=y.spatialReference;N&&(N.isWebMercator()?H=A.webMercatorToGeographic(y):4326===N.wkid&&(L=A.geographicToWebMercator(y)));y=H.getCenter();L=Math.max(L.getWidth(),L.getHeight());
m&&(H=H.expand(m));v=v.replace(/\[bboxWest\]/ig,H.xmin).replace(/\[bboxEast\]/ig,H.xmax).replace(/\[bboxSouth\]/ig,H.ymin).replace(/\[bboxNorth\]/ig,H.ymax).replace(/\[lookatLon\]/ig,y.x).replace(/\[lookatLat\]/ig,y.y).replace(/\[lookatRange\]/ig,L).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,y.x).replace(/\[lookatTerrainLat\]/ig,y.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,y.x).replace(/\[cameraLat\]/ig,y.y).replace(/\[cameraAlt\]/ig,
L).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,D.width).replace(/\[vertPixels\]/ig,D.height).replace(/\[terrainEnabled\]/ig,0);p.mixin(f,a.queryToObject(v))}F&&(F=F.replace(/\[clientVersion\]/ig,k.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,K.locale),p.mixin(f,a.queryToObject(F)))}D=[];for(var Q in f)d.isDefined(f[Q])&&D.push(Q+"\x3d"+f[Q]);return(D=D.join("\x26"))?"?"+D:""},setScaleRange:function(D,
f){this.inherited(arguments);r.forEach(this.getLayers(),function(m){m.setScaleRange(D,f)})},setOpacity:function(D){this.opacity!=D&&(r.forEach(this.getLayers(),function(f){f.setOpacity(D)}),this.opacity=D,this.onOpacityChange(D))},_setMap:function(D,f){this.inherited(arguments);this._map=D;var m=this._div=c.create("div",null,f);l.set(m,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return m},_unsetMap:function(D,f){this._io&&this._io.cancel();this._stopAutoRefresh();x.disconnect(this._extChgHandle);
delete this._extChgHandle;this._removeInternalLayers();var m=this._div;m&&(f.removeChild(m),c.destroy(m));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(D){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,D),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&D&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(D){var f,
m=[];(D=this.getFeature({type:"Folder",id:D}))&&(f=r.map(D.featureInfos,function(y){if("esriGeometryPoint"===y.type||"esriGeometryPolyline"===y.type||"esriGeometryPolygon"===y.type)return y.id},this))&&0<f.length&&r.forEach(this._fLayers,function(y){var v;var F=y.toJson();F.featureSet.features&&0<F.featureSet.features.length&&(v=r.filter(F.featureSet.features,function(H){if(-1!==r.indexOf(f,H.attributes[y.objectIdField]))return H},this));v&&0<v.length&&(F.featureSet.features=v,m.push(F))},this);return m},
getFeatureCount:function(D){D=this.getFeature({type:"Folder",id:D});var f={points:0,polylines:0,polygons:0};D&&r.forEach(D.featureInfos,function(m){"esriGeometryPoint"===m.type&&(f.points+=1);"esriGeometryPolyline"===m.type&&(f.polylines+=1);"esriGeometryPolygon"===m.type&&(f.polygons+=1)});return f},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});b("extend-esri")&&p.setObject("layers.KMLLayer",G,k);return G})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../lang"],function(K,g,x,p,r){K=K(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(h){g.mixin(this,h);r.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});x("extend-esri")&&g.setObject("layers.KMLFolder",K,p);return K})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),function(K,g,x,p,r,h){K=K([h],{declaredClass:"esri.layers.KMLGroundOverlay",
constructor:function(b){r.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});x("extend-esri")&&g.setObject("layers.KMLGroundOverlay",K,p);return K})},"esri/layers/RasterXLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/function/StretchFunction ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C,G,D,f,m,y,v,F,H,L,N,Q,R,W,Z,X,M,U,T){var V=e.defaults.map.zoomDuration;K=K([T],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(I,J){J=J||{};this.tileMode=null!=J.tileMode?J.tileMode:this.tileMode;this.useWebGL=null!=J.useWebGL?
J.useWebGL:this.useWebGL;this.roaming=null!=J.roaming?J.roaming:this.roaming;this.drawMode=null!=J.drawMode?J.drawMode:this.drawMode;this.bandIds=J.bandIds&&0<J.bandIds.length?J.bandIds:null;this.renderer=J.renderer;this._customModules=J.customModules;this.useMapTime=null!=J.useMapTime?J.useMapTime:!0;if(J.multidimensionalDefinition&&0<J.multidimensionalDefinition.length){var O=new F;O.multidimensionalDefinition=J.multidimensionalDefinition.map(function(S){return S.toJson?S:new H(S)});O.method=F.METHOD_NONE;
this.mosaicRule=O}this.infoTemplate=J.infoTemplate;this.drawMode||(this._contextType=J._contextType||J.drawType);this._supportLegacyPropMethods=!1!==J.legacySupport;this._rasterHandler=new U({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(I,J);c(this,"load",g.hitch(this,function(){k(this._rasterHandler._connected||this._rasterHandler._connectionPromise,g.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,
raster:{rasterInfo:this.raster.rasterInfo,rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=g.hitch(this,this._animatePan2d)},setOpacity:function(I){this.opacity!==
I&&(this.opacity=I,this.onOpacityChange(I))},onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>h("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(I,J,O,S){this._canDraw()&&(this.useWebGL||(O?this._context.clearRect(I,J,O,S):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},
onResume:function(){this.inherited(arguments);this._toggleTime();z.show(this._div);if("css-transforms"===this._map.navigationMode){var I=this._map.__visibleDelta;this._left=this._tdx=I.x;this._top=this._tdy=I.y;a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(g.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();
z.hide(this._div);clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var I=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?I&&(I.src||I.texture):I)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(I);else{this.tileManager.tiles.forEach(function(O){O&&(O.update=null,O.completed=!1,O.processedPixelBlock=null,O.renderedPixelBlock=null)});I.processedPixelBlock=
null;var J=this.raster.rasterFunction?this.raster.rasterFunction.read(I):{extent:I.extent,pixelBlock:I.src[this.tileManager.identifiers[0]]&&I.src[this.tileManager.identifiers[0]].pixelBlock};I.renderedPixelBlock=null;I=this._rasterRenderer?this._rasterRenderer.draw(J):J;this._drawOneFrame(I)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(I.processedPixelBlock=null,J=this.raster.rasterFunction?this.raster.rasterFunction.read(I):{extent:I.extent,pixelBlock:I.src?
I.src[this.tileManager.identifiers[0]]&&I.src[this.tileManager.identifiers[0]].pixelBlock:I.pixelBlock},I.renderedPixelBlock=null,I=this._rasterRenderer?this._rasterRenderer.draw(J):J,this._drawOneFrame(I))},getCurrentResolution:function(){var I=this._map.extent;return new m((I.xmax-I.xmin)/this._map.width,(I.ymax-I.ymin)/this._map.height,I.spatialReference)},getCustomRasterFields:function(I){var J=I?I.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,O={name:this._rasterFieldPrefix+"ServicePixelValue",
alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString"};I=this.fields?g.clone(this.fields):[];I.push(O);(O=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<O.length&&(O=p.filter(O,function(S){return"esriFieldTypeOID"!==S.type&&"value"!==S.name.toLowerCase()}),O=p.map(O,function(S){var P=g.clone(S);P.name=J+S.name;return P}),I=I.concat(O));return I},setRenderer:function(I,J){if(this.loaded&&I){if(I.declaredClass&&-1<
I.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=I;this._rasterRenderer.bind({layer:this});var O=this.bandIds=I.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:O});this._params&&(this._params.bandIds=O&&0<O.length?O.join(","):null);this.renderer=this._getCommonRenderer(I)}else O=g.clone(I.toJson?I.toJson():I),"rasterStretch"===O.type&&(O.bandIndex=this.bandIds,O.bandIndex&&1<O.bandIndex.length||!O.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(O.type=
"rgb"),this._rasterRenderer=Z.create(O),this.renderer=I.declaredClass?I:this._getCommonRenderer(this._rasterRenderer),this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var S=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}J||(S?S.then(g.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(I,J){this.bandIds=I;this.raster&&this.raster.setFetchParameters({bandIds:I});
this._params&&(this._params.bandIds=I&&0<I.length?I.join(","):null);this.setRenderer(this.renderer,J)},_setTime:function(I){I=I?I.toJson():null;this._params&&(this._params.time=I);this.raster.setFetchParameters({time:I});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(I){this.infoTemplate=I;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(I,J){var O=I&&I.multidimensionalDefinition;if(O&&this.loaded){var S=O&&O[0].variableName;
""===S&&(S=this._multidimensionalInfo.variables[0].name,O.forEach(function(Y){Y.variableName=S}));if("ImageService"===this.raster.sourceType){var P=this.raster._getAllDimensionDefinition(O,S);P.defChanged&&(I.multidimensionalDefinition=P.definition,this.setMosaicRule(I,!0))}this.raster.setFetchParameters({multidimensionalDefinition:O});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();S&&this._updateRasterInfo(S);J||this.refresh()}},_updateRasterInfo:function(I){var J=this.raster.rasterInfo,
O=this.getHistograms({variableName:I});I=this.getStatistics(I);(new n([O,I])).then(g.hitch(this,function(S){S[0][0]&&(J.histograms=S[0][1].histograms);S[1][0]&&(J.statistics=S[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(I){if(I&&!(1>I.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var J,O;var S=this.infoTemplate.info.fieldInfos;for(J=0;J<I.length;J++){var P=I[J];for(O=0;O<S.length;O++)if(S[O].fieldName.toLowerCase()===
P.name.toLowerCase()&&S[O].fieldName!==P.name){S[O].fieldName=P.name;break}}}},getPixelData:function(I){return this.tileMode?I?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(I){var J=new r;this.identify(I.geometry).then(function(O){var S=O.pixelValue;this.hasStdTime()&&S&&S.length&&null!=S[0]&&(S=S.map(function(aa){return this.getStdTimeValue(aa)}.bind(this)).join(", "));
if(S){O={ObjectId:0,"Raster.ServicePixelValue":S};var P=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(P&&0<P.length&&(P=p.filter(P,function(aa){if(aa&&aa.attributes)return aa.attributes.hasOwnProperty("Value")?aa.attributes.Value==S:aa.attributes.VALUE==S}),0<P.length&&(P=g.clone(P[0]))))for(var Y in P.attributes)P.attributes.hasOwnProperty(Y)&&(O[this._rasterFieldPrefix+Y]=P.attributes[Y]);Y=new t(new D(this.projectedFullExtent||this.fullExtent),null,O);Y.setInfoTemplate(this.infoTemplate);
Y._layer=this;this._lastPopup=[Y];J.resolve([Y])}else this._lastPopup=[],J.resolve()}.bind(this),function(O){this._lastPopup=[];J.resolve(O)});return J},getPopupFromTiles:function(){return this._lastPopup},identify:function(I,J){return this.raster?this.raster.identify(I):(I=new r,I.reject("layer must be initialized to identify"),I.promise)},_getCommonRenderer:function(I){switch(I.rendererName){case "RGB":case "Stretch":return new E(I.toCommonRendererJson());case "UniqueValue":return new B(I.toCommonRendererJson());
case "ClassBreaks":return new q(I.toCommonRendererJson());case "Colormap":return new C(I.toCommonRendererJson());case "ShadedRelief":return new G(I.toCommonRendererJson())}},_getProjectedFullExtent:function(I){return this.raster.getProjectedFullExtent(I).then(g.hitch(this,function(J){this.projectedFullExtent=J}))},_initialize:function(I,J){J=J||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]=
{method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]={method:"onSpatialReferenceChange"});this.raster={};var O=J.raster?J.raster.url:I;O&&-1<O.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(O,J);var S=g.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);
this.onLoad(this);var P=this._loadCallback;P&&(delete this._loadCallback,P(this))});(I?R.create(g.mixin({url:I},J)):J.raster&&J.raster.open()).then(g.hitch(this,function(P){if(P){this.raster=P;var Y=this._getSourceImageServiceRaster();this.url||(this.url=Y&&Y.url);this.url&&(this._url=A.urlToObject(I));var aa=J.minScale,ba=J.maxScale,ea=P.tileInfo&&"Raster"===P.tileInfo.tileType;null==ba&&(ba=ea&&J.zoomFactor?P.tileInfo.lods[P.tileInfo.lods.length-1].scale/J.zoomFactor:this.maxScale);null==aa&&(aa=
ea&&J.zoomFactor?P.tileInfo.lods[0].scale*J.zoomFactor:this.minScale);Y&&"ImageService"===Y.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(I,J);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new v(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;
this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=
this._defaultMultidimensionalDefinition);null==aa||this._hasMin||this.setMinScale(aa);null==ba||this._hasMax||this.setMaxScale(ba);this._workInitPromise?this._workInitPromise.then(S,S):S()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var I=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(I&&"ImageService"===
I.sourceType)return I},_addLegacySupport:function(I,J){this._url=A.urlToObject(I);J=J||{};this.format=(I=J.imageServiceParameters)&&I.format;this.compressionTolerance=I&&I.compressionTolerance?I.compressionTolerance:.01;this.interpolation=I?I.interpolation:null;this.compressionQuality=I?I.compressionQuality:null;this.bandIds=I&&I.bandIds||J&&J.bandIds||null;this.mosaicRule||(this.mosaicRule=I?I.mosaicRule:null);this.renderingRule||(this.renderingRule=I?I.renderingRule:null);this.useMapDimensionValue=
J.hasOwnProperty("useMapDimensionValue")?!!J.useMapDimensionValue:!0;this.hasImageFilter=J.hasImageFilter;this.activeMapDimensions=J.activeMapDimensions;this._params=g.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},I?I.toJson():{});this.pixelFilter=J.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=g.hitch(this,this._queryVisibleRastersHandler);
this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var O={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},S,P=new N;Object.keys(O).forEach(g.hitch(this,function(Y){this[Y]=g.hitch(this,function(aa,ba){S=
{};S[O[Y]]=aa;this.raster&&(this.raster.setFetchParameters(S),P[Y].bind(this)(aa,ba))})}));this.setDisableClientCaching=function(Y){P.setDisableClientCaching.bind(this)(Y);var aa=this._getSourceImageServiceRaster();aa?aa.disableClientCaching=Y:null}.bind(this);this.setDefinitionExpression=P.setDefinitionExpression.bind(this);this.setUseMapTime=P.setUseMapTime.bind(this);this._toggleTime=P._toggleTime.bind(this);this._onTimeExtentChangeHandler=P._onTimeExtentChangeHandler.bind(this);this.setPixelFilter=
P.setPixelFilter.bind(this);this.getHistograms=P.getHistograms.bind(this);this.getRasterFunctionInfos=P.getRasterFunctionInfos.bind(this);this.getKeyProperties=P.getKeyProperties.bind(this);this.getRasterAttributeTable=P.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=P.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=P._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=P._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=
P.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(Y){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=P.getMultidimensionalInfo.bind(this);this.getColormap=P.getColormap.bind(this);this.getRenderingRuleColormap=P.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=P.getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultMultidimensionalDefinition=P._getDefaultMultidimensionalDefinition.bind(this);this._getDefaultDimensionValue=P._getDefaultDimensionValue.bind(this);this.getStatistics=P.getStatistics.bind(this)},_addGeneralProperties:function(){var I=this._getSourceImageServiceRaster();if(I){var J=["minScale","maxScale","tileInfo"];Object.keys(I.serviceInfo).forEach(function(P){null==this[P]&&-1===J.indexOf(P)&&(this[P]=I.serviceInfo[P])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);this.bands=I.rasterInfo.statistics;var O,S=[];this.fields=this.fields||[];for(O=0;O<this.fields.length;O++)S.push(new y(this.fields[O]));this.fields=S;this.version=this.currentVersion;this.defaultMosaicRule=I.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var I=Z.createDefaultRenderer(this);if(null!=I){var J=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;
if(this._multidimensionalInfo&&J&&"Stretch"===I.rendererName){var O=this.mosaicRule.multidimensionalDefinition[0].variableName;(J=this._multidimensionalInfo.variables.filter(function(S){return S.name===O})[0])&&J.histograms&&J.histograms.length&&(I.histograms=J.histograms,6===I.stretchType&&(I.dra=!1));J&&J.statistics&&J.statistics.length&&(I.statistics=J.statistics.map(function(S){return[S.min,S.max,S.mean,S.stddev||S.standardDeviation]}),6!==I.stretchType&&(I.dra=!1))}this.setRenderer(I,!0)}}},
setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var I=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;if(I)switch(I.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{I=this.raster.dataType&&this.raster.dataType.toLowerCase();var J=!!this.raster.rasterInfo.colormap;
this.raster.rasterInfo.vat||J||"thematic"===I||"StdTime"===I?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(I,J){this.inherited(arguments);I.spatialReference&&
(I.spatialReference.ics||I.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=new X(null,{refTileInfo:I.tileInfo,spatialReference:I.spatialReference,extent:this.raster.rasterInfo.extent});var O=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};
this._tileParams.size=O.cols+","+O.rows;this.tileManager=new M({tileInfo:O,layer:this,mapSR:I.spatialReference})}this._dragOrigin={x:0,y:0};O=this._div=b.create("div",null,J);var S={width:I.width+"px",height:I.height+"px",position:"absolute"};"css-transforms"===I.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(S[d._css.names.transform]=d._css.translate(I.__visibleDelta.x,I.__visibleDelta.y),this._left=I.__visibleDelta.x,this._top=I.__visibleDelta.y):this._left=this._top=0;a.set(O,S);this._canvas=
b.create("canvas",{width:I.width+"px",height:I.height+"px",style:"position: absolute;"},O);u.isDefined(this.opacity)&&a.set(O,"opacity",this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=!0);this._context||
console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(I.acquireWebGLContext(this),this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||this.setDefaultRenderer();
this.interpolation||this.setDefaultInterpolation();this._mapWidth=I.width;this._mapHeight=I.height;this._connects=[];this._connects.push(x.connect(I,"onPan",this,this._panHandler));this._connects.push(x.connect(I,"onPanEnd",this,this._panEndHandler));"css-transforms"===I.navigationMode?this._connects.push(x.connect(I,"onScale",this,this._onScaleHandler)):(this._connects.push(x.connect(I,"onZoom",this,this._onZoomHandler)),this._connects.push(x.connect(I,"onZoomEnd",this,this._onZoomEndHandler)));
this._connects.push(x.connect(I,"onResize",this,this._onResizeHandler));this._connects.push(x.connect(I,"onExtentChange",this,this._extentChangeHandler));this._connects.push(x.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(x.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:I.width,height:I.height};this.evaluateSuspension();if(this.suspended&&!I.loaded)var P=x.connect(I,"onLoad",this,function(){x.disconnect(P);
P=null;this.evaluateSuspension()});return O},_unsetMap:function(I,J){this.useWebGL&&I.releaseWebGLContext(this);p.forEach(this._connects,x.disconnect,this);var O=this._div;O&&(J.removeChild(O),b.destroy(O));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(I){"CancelError"!==I.name&&(this.clear(),
this.onError(I))},_clonePixelData:function(I){if(null===I||I.texture)return I;var J={};I.extent&&(J.extent=g.clone(I.extent));var O=I.pixelBlock;null!=O&&(J.pixelBlock=O.clone());J.texture=I.texture;return J},_setPixelData:function(I){if(I){I=this._clonePixelData(I);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(I)):this.pixelFilter(I));this.pixelData=I;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;this._drawPixelData()}this._rasterReadPromise=
null},_requestData:function(I,J,O){this._rasterReadPromise&&this._rasterReadPromise.cancel();I=g.clone(I)._normalize(!0);this._rasterReadPromise=this.raster.read({extent:I,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(g.hitch(this,function(S){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=S&&S.srcData?{extent:S.extent,src:S.srcData}:S,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!0),this._setPixelData(S))}),g.hitch(this,
this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(I){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,
d._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);if(this._canDraw()&&this.drawMode&&this.drawMode&&(I=I||this.pixelData)&&I.pixelBlock){var J=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(I):I;I=J.pixelBlock;var O=this._context,S=O.createImageData(I.width,I.height);S.data.set(I.getAsRGBA());J=J.extent;var P=this._map.extent,Y=this.getCurrentResolution(),aa=0,ba=0;Math.abs(J.xmin-
P.xmin)>Y.x&&(aa=Math.round((J.xmin-P.xmin)/Y.x));Math.abs(P.ymax-J.ymax)>Y.y&&(ba=Math.round((P.ymax-J.ymax)/Y.y));"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,
{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(aa,ba,I.width,I.height):this.clear();O.putImageData(S,aa,ba,0,0,I.width,I.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var I=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition;I=I&&I.length?I[0]:this._defaultMultidimensionalDefinition[0];var J=this.raster.rasterInfo.multidimensionalInfo.variables,
O=I?I.variableName:J[0].name;return J.some(function(S){if(S.name===O)return!S.dimensions||0===S.dimensions.length||S.dimensions.some(function(P){return"StdTime"===P.name})})},getStdTimeValue:function(I){return(new Date(864E5*(I-25569))).toString()},computeHistograms:function(I){I=new r;var J=this.getPixelData(!0);if(J&&J.pixelBlock&&J.pixelBlock.pixels&&((new Q({}))._calculateStatisticsHistograms(J),J.pixelBlock.histograms))return I.resolve({histograms:J.pixelBlock.histograms}),I;I.reject();return I},
_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(I,J){return this.tileManager.updateTile(I,
!0).then(g.hitch(this,function(O){(this._hasTilingEffects||this.useWebGL||J)&&this._drawOneFrame(O)}))},_drawOneFrame:function(I,J){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||this._levelChange)this._levelChange=
!1,this._resetDrawing();if(I&&(I.renderedPixelBlock||I.pixelBlock)&&this._canDraw()&&this.drawMode){J=I.extent;var O=this._map.extent;if(!this._isExtentOutSide(J,O)){var S=I.pixelBlock||I.renderedPixelBlock,P=this._context,Y=P.createImageData(S.width,S.height);Y.data.set((I.renderedPixelBlock||I.pixelBlock).getAsRGBA());I=this.getCurrentResolution();var aa=0,ba=0;Math.abs(J.xmin-O.xmin)>I.x&&(aa=Math.round((J.xmin-O.xmin)/I.x));Math.abs(O.ymax-J.ymax)>I.y&&(ba=Math.round((O.ymax-J.ymax)/I.y));P.putImageData(Y,
aa,ba,0,0,S.width,S.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(I,J){return I.xmax<=J.xmin||I.xmin>=J.xmax||I.ymax<=J.ymin||I.ymin>=J.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var I=this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(I,this._startRect.left,this._startRect.top)}this._dragOrigin=
{x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,
-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var I=this._frames,J=0,O;for(O=0;O<I.length;O++)if(I[O].completed)J++;else if(I[O].tileData.renderedPixelBlock){I[O].completed=!0;var S=I[O].tileData;break}else if(I[O].tileData._fetched&&
!I[O].tileData.src){I[O].completed=!0;break}else if(I[O].tileData.update&&I[O].tileData.update.isFulfilled()&&!I[O].tileData.renderedPixelBlock){I[O].completed=!0;break}else I[O].tileData.fetch&&(!0===I[O].tileData.fetch||I[O].tileData.fetch.isCanceled()||I[O].tileData.fetch.isRejected())?(I[O].completed=!0,J++):this._isExtentOutSide(I[O].tileData.extent,this._map.extent)&&(I[O].completed=!0,J++);if(S){J++;var P=S.extent,Y=this._map.extent,aa=this.getCurrentResolution(),ba=O=0;Math.abs(P.xmin-Y.xmin)>
aa.x&&(O=Math.round((P.xmin-Y.xmin)/aa.x));Math.abs(Y.ymax-P.ymax)>aa.y&&(ba=Math.round((Y.ymax-P.ymax)/aa.y));S.renderedPixelBlock?(P=S.renderedPixelBlock,Y=this._context.createImageData(P.width,P.height),Y.data.set(S.renderedPixelBlock.getAsRGBA()),this._context.putImageData(Y,O,ba,0,0,P.width,P.height)):this.clear(O,ba,S.width,S.height)}J===I.length?(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(g.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=
requestAnimationFrame(g.hitch(this,this._drawAllFrames))},_fetchTiles:function(I,J){if(!this.suspended&&this.loaded){this._cancelAnimation();var O=this.tileManager,S=!(O.xformSetting.requireProjection&&O.xformSetting.requirePE)||W.load();k(S,g.hitch(this,function(){O.updateExtent(I,this.getCurrentResolution());this._resetCss=!1;O.fetchTiles(J);J&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<O.tiles.length?(O.fillupTiles(),O._validateRawPixelBlocks(O.originalPixelData)?this._updateAllTilesOnce(O.originalPixelData):
O.originalPixelData&&O.originalPixelData.src&&O.tiles.some(function(P){return P.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),O.tiles.forEach(g.hitch(this,function(P){P.update&&!P.updateCompleted&&P.update.then(function(Y){P.updateCompleted||(P.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&this._drawOneFrame(Y)}.bind(this))}))):this._hasTilingEffects&&k(O.fetchAllCompleted.isResolved()||O.fetchAllCompleted,g.hitch(this,function(){this._updateAllTilesOnce(O.originalPixelData)})):
(this._frames=O.tiles.map(function(P){return{completed:!1,tileData:P}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(I,J){this._drawTile=!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=J,!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+J.x,this._top=this._map.__visibleDelta.y+J.y,
a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+J.x+"px",top:this._startRect.top+J.y+"px"});this.tileMode&&this._fetchTiles(I)},_panEndHandler:function(I,J){J&&(this._startRect.left+=J.x,this._startRect.top+=J.y);this.oldData=null;this._roamingAnimation&&(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(I,J){var O={},S=d._css.names;a.set(this._canvas,S.transition,
J?"none":S.transformName+" "+V+"ms ease");this._matrix=I;I=this._multiply?l.multiply(I,this._multiply):I;if(this._tdx||this._tdy)I=l.multiply(I,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});O[S.transform]=d._css.matrix(I);a.set(this._canvas,O)},_onZoomHandler:function(I,J,O){var S=this._startRect;I=S.width*J;J*=S.height;var P=S.left-(I-S.width)*(O.x-S.left)/S.width;O=S.top-(J-S.height)*(O.y-S.top)/S.height;a.set(this._canvas,{left:P+"px",top:O+"px",width:I+"px",height:J+"px"});this._endRect=
{left:P,top:O,width:I,height:J}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(I,J,O){a.set(this._div,{width:J+"px",height:O+"px"});a.set(this._canvas,{width:J+"px",height:O+"px"});this._startRect.width=this._canvas.width=J;this._startRect.height=this._canvas.height=O;this.useWebGL&&this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(I,J,O,S){if(this.loaded&&!this.suspended&&(!J||0!==
J.x||0!==J.y||O)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(J&&(this._dragOrigin.x+=J.x,this._dragOrigin.y+=J.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&this.tileMode&&this.useWebGL||O||a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),O&&(a.set(this._canvas,d._css.names.transition,"none"),this._multiply=this._multiply?l.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();
var P=this._map;J=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(aa){return aa._rasterId}):[this.raster._rasterId];var Y={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||(J.forEach(function(aa,ba){Y[aa]={extent:P.extent,pixelBlock:new L({width:P.width,height:P.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}),this.tileManager.originalPixelData={extent:P.extent,src:Y}),this.projectedFullExtent?this._fetchTiles(I,!0):this._getProjectedFullExtent(P.spatialReference).then(g.hitch(this,
function(){this._fetchTiles(I,!0)}))):this._requestData(P.extent,P.width,P.height)}},_visibilityChangeHandler:function(I){I?z.show(this._div):z.hide(this._div)},_opacityChangeHandler:function(I){a.set(this._div,"opacity",I)}});h("extend-esri")&&g.setObject("layers.RasterXLayer",K,d);return K})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(K,g,x,p,r,h,b){return K([x,b],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,
5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=
a.raster.histograms);this.rasterInfo=g.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?
a.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments,l=c.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l;else{var k=a.pixelBlock,n=k.pixels.length,d=6===c.stretchType&&(c.dra||!l)||3===c.stretchType&&c.dra;d&&(k.statistics||k.calculateStatistics(),this._calculateStatisticsHistograms(a));
if(c.dra)if(k.statistics||k.calculateStatistics(),d)this._statistics=k.statistics,this._histograms=k.histograms;else for(c=k.statistics,this._statistics=[],a=0;a<n;a++)this._statistics[a]=[c[a].minValue,c[a].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:
this.srcStatistics,this._histograms=l,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var c=[],l;for(l=0;l<a.length;l++)c[l]=1<a[l]?2<a[l]?6.5+Math.pow(a[l]-2,2.5):6.5+100*Math.pow(2-a[l],4):1;return c}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,
l=c.pixels;c=c.width*c.height;var k=l.length,n,d;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var e=this.LUT,u=this.LUTOffset;for(n=0;n<k;n++){var z=e[n];for(d=0;d<c;d++){var A=l[n][d];l[n][d]=z[A-u]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var c=a.pixelType,l=a.pixels,k=a.mask,n=l.length,d,e,u=function(D){this.min=-.5;this.max=255.5;this.size=256;g.mixin(this,D);this.counts=this.counts||new Uint32Array(this.size)},z=[],A,t;for(d=
0;d<n;d++){var w=new u;var q=w.counts;var E=l[d];if("U8"===c)if(k)for(e=0;e<a.width*a.height;e++)k[e]&&q[E[e]]++;else for(e=0;e<a.width*a.height;e++)q[E[e]]++;else{var B=a.statistics[d].minValue;var C=a.statistics[d].maxValue;w.min=B;w.max=C;C=(C-B)/256;var G=new Uint32Array(257);if(k)for(e=0;e<a.width*a.height;e++)k[e]&&G[Math.floor((E[e]-B)/C)]++;else for(e=0;e<a.width*a.height;e++)G[Math.floor((E[e]-B)/C)]++;for(e=0;255>e;e++)q[e]=G[e];q[255]=G[255]+G[256]}z.push(w);E=[];B=a.statistics[d].minValue;
C=a.statistics[d].maxValue;for(e=t=A=G=0;e<w.size;e++)G+=q[e],A+=e*q[e];A/=G;for(e=0;e<w.size;e++)t+=q[e]*Math.pow(e-A,2);q=Math.sqrt(t/(G-1));e=(A+.5)*(w.max-w.min)/w.size+w.min;w=q*(w.max-w.min)/w.size;E.push(B);E.push(C);E.push(e);E.push(w);a.statistics[d]={min:B,minValue:B,max:C,maxValue:C,mean:e,stddev:w}}a.histograms=z},_getCutOffPoints:function(a){var c=this.functionArguments,l=999;a&&a.pixelBlock?l=a.pixelBlock.pixels.length:a&&a.texture&&(l=3);a=Math.min(l,this._statistics.length);var k=
[],n=[],d,e;switch(c.stretchType){case 5:for(d=0;d<a;d++)k[d]=this._statistics[d][0],n[d]=this._statistics[d][1];break;case 3:for(d=0;d<a;d++)k[d]=this._statistics[d][2]-c.numberOfStandardDeviations*this._statistics[d][3],n[d]=this._statistics[d][2]+c.numberOfStandardDeviations*this._statistics[d][3],k[d]<this._statistics[d][0]&&(k[d]=this._statistics[d][0]),n[d]>this._statistics[d][1]&&(n[d]=this._statistics[d][1]);break;case 6:for(d=0;d<a;d++){l=this._histograms[d];var u=new Uint32Array(l.size);
var z=l.counts;var A=0;var t=-.5===l.min&&1===(l.max-l.min)/z?.5:0;for(e=0;e<l.size;e++)A+=z[e],u[e]=A;z=c.minPercent*A/100;for(e=0;e<l.size;e++)if(u[e]>z){k[d]=l.min+(l.max-l.min)/l.size*(e+t);break}z=(1-c.maxPercent/100)*A;for(e=l.size-2;0<=e;e--)if(u[e]<z){n[d]=l.min+(l.max-l.min)/l.size*(e+2-t);break}}break;default:for(d=0;d<l;d++)k[d]=0,n[d]=255}return{minCutOff:k,maxCutOff:n}},_createLUT:function(a){var c=this.functionArguments,l=a.pixelBlock,k=l.pixelType;if("U8"===k||"U16"===k||"S8"===k||
"S16"===k){if(this._LUTSignature&&(k=this._computeLutSignature(),k.length===this._LUTSignature.length&&!k.some(function(f,m){return f!==this._LUTSignature[m]}.bind(this))))return;k=l.pixels.length;var n=[],d=[],e=c.max,u=c.min,z=c.gamma,A=e-u,t=this._getCutOffPoints(a);a=t.minCutOff;t=t.maxCutOff;var w=0,q=256;"S8"===l.pixelType?w=-127:"S16"===l.pixelType&&(w=-32767);if("U16"===l.pixelType||"S16"===l.pixelType)q=65536;for(l=0;l<k;l++)n[l]=t[l]-a[l];var E=this._gammaCorrection;if(c.useGamma)for(l=
0;l<k;l++){var B=[];for(c=0;c<q;c++){var C=c+w;var G=(C-a[l])/n[l];var D=1;1<z[l]&&(D-=Math.pow(1/A,G*E[l]));C<t[l]&&C>a[l]?B[c]=Math.floor(D*A*Math.pow(G,1/z[l]))+u:C>t[l]?B[c]=e:C<a[l]&&(B[c]=u)}d[l]=B}else for(l=0;l<k;l++){B=[];for(c=0;c<q;c++)C=c+w,B[c]=C<a[l]?u:C>t[l]?e:Math.floor((C-a[l])/n[l]*A)+u;d[l]=B}this.LUT=d;this.LUTOffset=w;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,c=[],l,k;c.push(a.stretchType);c.push(a.min);c.push(a.max);
c.push(a.numberOfStandardDeviations);if(this._statistics)for(l=0;l<this._statistics.length;l++)for(k=0;k<this._statistics[l].length;k++)c.push(this._statistics[l][k]);c.push(a.dra?1:0);c.push(a.minPercent);c.push(a.maxPercent);if(a.gamma)for(l=0;l<this._statistics.length;l++)c.push(a.gamma[l]);c.push(a.useGamma?1:0);return c},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=this.functionArguments,l=a.pixelBlock,k=l.pixels,n=l.mask;l=l.width*l.height;var d=
k.length,e=[],u=[],z=c.max,A=c.min,t=c.gamma,w=z-A;var q=this._getCutOffPoints(a);var E=q.minCutOff,B=q.maxCutOff;for(q=0;q<d;q++)e[q]=B[q]-E[q];if(c.useGamma&&null!==t&&t.length>=d)for(q=0;q<d;q++)u[q]=1<t[q]?2<t[q]?6.5+Math.pow(t[q]-2,2.5):6.5+100*Math.pow(2-t[q],4):1;if(c.useGamma)if(void 0!==n&&null!==n)for(c=0;c<l;c++){if(n[c])for(q=0;q<d;q++){var C=k[q][c];var G=(C-E[q])/e[q];var D=1;1<t[q]&&(D-=Math.pow(1/w,G*u[q]));C<B[q]&&C>E[q]?k[q][c]=Math.floor(D*w*Math.pow(G,1/t[q]))+A:C>B[q]?k[q][c]=
z:C<E[q]&&(k[q][c]=A)}}else for(c=0;c<l;c++)for(q=0;q<d;q++)C=k[q][c],G=(C-E[q])/e[q],D=1,1<t[q]&&(D-=Math.pow(1/w,G*u[q])),C<B[q]&&C>E[q]?k[q][c]=Math.floor(D*w*Math.pow(G,1/t[q]))+A:C>B[q]?k[q][c]=z:C<E[q]&&(k[q][c]=A);else if(void 0!==n&&null!==n)for(c=0;c<l;c++){if(n[c])for(q=0;q<d;q++)C=k[q][c],C<B[q]&&C>E[q]?k[q][c]=Math.floor((C-E[q])/e[q]*w)+A:C>B[q]?k[q][c]=z:C<E[q]&&(k[q][c]=A)}else for(c=0;c<l;c++)for(q=0;q<d;q++)C=k[q][c],C<B[q]&&C>E[q]?k[q][c]=Math.floor((C-E[q])/e[q]*w)+A:C>B[q]?k[q][c]=
z:C<E[q]&&(k[q][c]=A);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var c=this._statistics.length,l,k=[];for(l=0;l<c;l++){var n=this._statistics[l][2];"U8"!==a&&(n=255*(n-this._statistics[l][0])/(this._statistics[l][1]-this._statistics[l][0]));k.push(this._computeGammaValue(n))}return k},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var c=0;0<a&&150!=a&&255>a&&(c=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));c=Math.log((a+c)/255);if(0!==c&&(a=Math.log(a/255)/
c,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,l,k=a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,n=a.pixelBlock,d=this.gl,e=d.drawingBufferWidth,u=d.drawingBufferHeight;if(!n&&this.functionArguments.dra){var z=new Float32Array(e*u*4),A=new Uint8Array(e*u);var t=new Float32Array(e*u);var w=new Float32Array(e*u);var q=
new Float32Array(e*u);d.checkFramebufferStatus(d.FRAMEBUFFER)==d.FRAMEBUFFER_COMPLETE&&d.readPixels(0,0,e,u,d.RGBA,d.FLOAT,z);for(l=0;l<e*u;l++)t[l]=z[4*l],w[l]=z[4*l+1],q[l]=z[4*l+2],A[l]=z[4*l+3];a.pixelBlock=new p({width:e,height:u,pixels:[t,w,q],mask:A});a.pixelBlock.calculateStatistics()}!n&&this.functionArguments.dra&&this._useGPUStats?(t=new Float32Array(k),w=new Float32Array(k)):(this._updateStatistisHistograms(a),z=this._getCutOffPoints(a),t=new Float32Array(k),w=new Float32Array(k),t.set(z.minCutOff.slice(0,
k)),w.set(z.maxCutOff.slice(0,k)));this._initializeProgram({fragment:h.stretch,fragmentName:"Stretch"});z=this._setupTextureData(a);A=this.bindFrameBuffer();this.renderTexture=!1;this._performance.start();if(!n&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[e,u],u_bandCount:k});if(1===k)var E=this._readMinMax(z,2);else{E=this._readMinMax(z,0);var B=this._readMinMax(z,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)l=
this._readHistogram(E,B,a),t=l.minCutOff||t,w=l.minCutOff||w}q=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(k);for(l=0;l<k;l++)a[l]=q/(w[l]-t[l]);this._useGPUStats&&this._initializeProgram({fragment:h.stretch,fragmentName:"Stretch"});d.blendFunc(d.SRC_ALPHA,d.ZERO);q=new Float32Array(3);var C=new Float32Array(3);for(l=0;3>l;l++)q[l]=this.functionArguments.min,C[l]=this.functionArguments.max;l=this.functionArguments.useGamma;var G=this.functionArguments.gamma,D=this._gammaCorrection;
Array.isArray(G)&&G.length>=k||(l=!1);this._setUniforms({u_sourceDim:[e,u],u_bandCount:k,u_minOutput:q,u_maxOutput:C,u_minCutOff:t,u_maxCutOff:w,u_factor:a,u_state:100,u_useGamma:l,u_gamma:G,u_scaled:!c,u_gammaCorrection:D,u_minMaxTexture:!n&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;d.viewport(0,0,e,u);this._bindTexture(z.texture,"u_image");!n&&this.functionArguments.dra&&this._useGPUStats&&(c=d.getUniformLocation(this.rasterProgram,"u_image1"),d.uniform1i(c,1),d.activeTexture(d.TEXTURE1),
d.bindTexture(d.TEXTURE_2D,E.texture),1<k&&(k=d.getUniformLocation(this.rasterProgram,"u_image2"),d.uniform1i(k,2),d.activeTexture(d.TEXTURE2),d.bindTexture(d.TEXTURE_2D,B.texture)));this._drawGL();return{extent:z.extent,texture:A.texture}},_readMinMax:function(a,c){var l=this.gl,k=a.width||l.drawingBufferWidth,n=a.height||l.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var d=a.texture;for(l.activeTexture(l.TEXTURE0);1<k||1<n;){var e=this._createTexture();c=Math.max(Math.ceil(k/
2),1);var u=Math.max(Math.ceil(n/2),1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,c,u,0,l.RGBA,l.FLOAT,null);a=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,a);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e,0);l.viewport(0,0,c,u);l.bindTexture(l.TEXTURE_2D,d);this._setUniforms({u_sourceDim:[k,n]});k=c;n=u;this._drawGL(!0);d=e}a=new Float32Array(k*n*4);l.checkFramebufferStatus(l.FRAMEBUFFER)==l.FRAMEBUFFER_COMPLETE&&l.readPixels(0,0,k,n,
l.RGBA,l.FLOAT,a);return{texture:e,minmax:a}},_readHistogram:function(a,c,l){if(a)try{var k=this.gl,n=k.drawingBufferWidth,d=k.drawingBufferHeight,e,u,z;if(a.texture instanceof WebGLTexture){var A=!0;var t=[1,0,0,1];if(c){var w=a.minmax;var q=c.minmax}else w=[a.minmax[0]],q=[a.minmax[1]]}else for(q=c,w=a,t=new Float32Array(q.length),e=0;e<q.length;e++)t[e]=256/(q[e]-w[e]);var E=new Float32Array(n*d);for(z=0;z<E.length;z++)E[z]=z;if(!this.histogramProgram){var B=r.getShader(k,r.histogram),C=h.getShader(k,
h.constant);this.histogramProgram=this._loadProgram(B,C)}k.blendFunc(k.ONE,k.ONE);k.enable(k.BLEND);k.useProgram(this.histogramProgram);var G=k.getAttribLocation(this.histogramProgram,"a_pixelIndex"),D=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,D);k.bufferData(k.ARRAY_BUFFER,E,k.STATIC_DRAW);k.enableVertexAttribArray(G);k.vertexAttribPointer(G,1,k.FLOAT,!1,0,0);var f=this._setupHistTexture(l),m=this._createTexture();k.getExtension("OES_texture_float");k.texImage2D(k.TEXTURE_2D,0,k.RGBA,257,1,0,
k.RGBA,k.FLOAT,null);var y=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,y);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,m,0);k.viewport(0,0,257,1);var v=k.getUniformLocation(this.histogramProgram,"u_image");k.uniform1i(v,0);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,f);var F=k.getUniformLocation(this.histogramProgram,"u_sourceDim");k.uniform2f(F,n,d);var H=k.getUniformLocation(this.histogramProgram,"u_bandCount");k.uniform1i(H,3);var L=k.getUniformLocation(this.histogramProgram,
"u_halfPixel");k.uniform2f(L,.5/n,.5/d);var N=k.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(A){k.uniform1i(N,1);var Q=k.getUniformLocation(this.histogramProgram,"u_image1");k.uniform1i(Q,1);k.activeTexture(k.TEXTURE1);k.bindTexture(k.TEXTURE_2D,a.texture);if(c){var R=k.getUniformLocation(this.histogramProgram,"u_image2");k.uniform1i(R,2);k.activeTexture(k.TEXTURE2);k.bindTexture(k.TEXTURE_2D,c.texture)}}else{var W=k.getUniformLocation(this.histogramProgram,"u_mins");k.uniform4f(W,
w[0],w[0],w[0],w[0]);k.uniform1i(N,0)}var Z=k.getUniformLocation(this.histogramProgram,"u_color"),X=k.getUniformLocation(this.histogramProgram,"u_factors"),M=k.getUniformLocation(this.histogramProgram,"u_size");k.uniform1f(M,256);a=[];c=[];k.uniform4fv(Z,[1,0,0,1]);k.uniform4fv(X,[t[0],0,0,1]);k.drawArrays(k.POINTS,0,E.length);var U=this.sourceRasterInfo.raster.bandCount;1<U&&(k.uniform4fv(Z,[0,1,0,1]),k.uniform4fv(X,[0,t[0],0,1]),k.drawArrays(k.POINTS,0,E.length),k.uniform4fv(Z,[0,0,1,1]),k.uniform4fv(X,
[0,0,t[0],1]),k.drawArrays(k.POINTS,0,E.length));if(k.checkFramebufferStatus(k.FRAMEBUFFER)==k.FRAMEBUFFER_COMPLETE){var T=new Float32Array(1028);k.readPixels(0,0,257,1,k.RGBA,k.FLOAT,T);k=0;var V=-.5===w[0]&&1===(q[0]-w[0])/256?.5:0;for(e=0;e<U;e++){var I=new Float32Array(257);var J=new Float32Array(257);for(z=k=0;256>z;z++)k+=T[4*z+e],I[z]=k,J[z]=T[4*z+e];J[256]=T[1024+e];I[256]=k+T[1024+e];var O=this.functionArguments.minPercent*k/100;if(q){for(u=0;256>u;u++)if(I[u]>O){a[e]=w[0]+(q[0]-w[0])/256*
(u+V);break}O=(1-this.functionArguments.maxPercent/100)*k;for(u=254;0<=u;u--)if(I[u]<O){c[e]=w[0]+(q[0]-w[0])/256*(u+2-V);break}}}}return{histogram:T,minCutOff:a,maxCutOff:c}}catch(S){console.debug("webgl filter exception: "+S.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var c=this.originalHistTexture=this._createTexture(),l=this.gl;a=a.pixelBlock;var k=a.width,n=a.height;l.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,
0,l.RGBA,k,n,0,l.RGBA,l.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),function(K,g,x,p,r,h){return K(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(b){b&&(this.pixelType=b.outputPixelType||b.OutputPixelType||this.pixelType,this.renderTexture=b.renderTexture,
this._initFunction())},mixinIgnoreCase:function(b,a){var c=Object.keys(b),l=Object.keys(a),k,n,d=c.length;for(k=0;k<l.length;k++){var e=a[l[k]];if(null!=e)for(n=0;n<d;n++)if(c[n].toLowerCase()===l[k].toLowerCase()){b[c[n]]=e;break}}return b},bind:function(b){},setProcessingContext:function(b){if(!b)throw"cannot bind to layer without options";this.useWebGL=!!b.useWebGL;this._tileMode=!!b.tileMode;this._glSetting=b.glSetting;this._rawRasterInfo=b.rawRasterInfo;this._xformSetting=b.xformSetting||this._xformSetting;
if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,c=this.functionArguments.raster2,l=this.functionArguments.dem,k=this.functionArguments.fillRaster,n=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(b);c&&c.functionArguments&&c.setProcessingContext(b);l&&l.functionArguments&&l.setProcessingContext(b);k&&
k.functionArguments&&k.setProcessingContext(b);if(n)for(a=0;a<n.length;a++)n[a]&&n[a].functionArguments&&n[a].setProcessingContext(b);this.bind()}},updateBranchStructure:function(){var b=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&(b+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(b+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(b=a.rasters.length,
a.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(b+=a.dem.updateBranchStructure());return 1===b?0:b},read:function(b){b=this.processRasterArgument(b);return this.useWebGL?this.readGL(b):this.read2D(b)},hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var b,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),
a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],b=0;b<this.functionArguments.rasters.length;b++)a.rasters[b]=this._bindRaster(this.functionArguments.rasters[b]);else a.raster=this._bindRaster(this.functionArguments.raster);return this.sourceRasterInfo=a},processRasterArgument:function(b){var a=this.bind();if(!0!==a)throw a;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,
b),c.raster2=this._readRaster(this.functionArguments.raster2,b);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._readRaster(this.functionArguments.rasters[a],b);else c.raster=this._readRaster(this.functionArguments.raster,b);return c},toJson:function(){var b=this.functionArguments,a=b.raster,c=b.raster2;b=b.rasters;a=a?a.toJson?a.toJson():a:null;c=c?c.toJson?c.toJson():c:null;var l;b&&0<b.length&&(l=b.map(function(k){return k.toJson?
k.toJson():k}));b=g.mixin({},this.functionArguments);b.raster=a;b.raster2=c;b.rasters=l;b=this._fixRasterFunctionJson(b);return{rasterFunction:this.functionName,rasterFunctionArguments:b,outputPixelType:this.pixelType}},_initFunction:function(b){},_getIntegerRange:function(b){switch(b){case "U8":var a=[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(b,
a){return b&&"unknown"!==b.toLowerCase()?b:a},_clonePixelData:function(b){if(null==b)return b;var a={};b.extent&&(a.extent=new r(b.extent.xmin,b.extent.ymin,b.extent.xmax,b.extent.ymax,b.extent.spatialReference));b=b.pixelBlock;if(null==b)return a;a.pixelBlock=b.clone?b.clone():h.prototype.clone(b);return a},_readRaster:function(b,a){if(null==b||"$$"===b)var c=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else b&&b.rasterInfo&&!b.functionArguments?c=this._clonePixelData(a.src[b._rasterId]):isNaN(b)?
b.read&&(c=b.functionArguments?b.read(a):this._clonePixelData(a)):(c=a.src?a.src[Object.keys(a.src)[0]]:a,a=c.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(b)),c=this._clonePixelData(c),c.pixelBlock.pixels=[a],c.isConstant=!0);return c},_bindRaster:function(b){if(b&&"$$"!==b)isNaN(b)?b.rasterInfo?a=b.rasterInfo:b.bind&&b.bind()&&(a=b.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new p(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(b,
a){switch(b){case "U8":b=new Uint8Array(a);break;case "U16":b=new Uint16Array(a);break;case "U32":b=new Uint32Array(a);break;case "S8":b=new Int8Array(a);break;case "S16":b=new Int16Array(a);break;case "S32":b=new Int32Array(a);break;case "U32":b=new Uint32Array(a);break;case "F32":b=new Float32Array(a);break;case "F64":b=new Float64Array(a);break;default:b=new Float32Array(a)}return b},_clampBand:function(b,a,c){if(("F64"===a||"F32"===a)&&!c)return b;var l,k=this._getIntegerRange(a),n=b.length;if(k)for(c=
k[1],k=k[0],a=this._getOutputBand(a,n),l=0;l<n;l++){var d=b[l];a[l]=d>c?c:d<k?k:d}else a=b;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},_addPerformanceMetric:function(b){x.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(b),50<self.rasterFunctionPerformance.length&&
self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(b){for(var a in b)b.hasOwnProperty(a)&&(null==b[a]?delete b[a]:b[a]instanceof Object&&!b[a].sourceType&&this._fixRasterFunctionJson(b[a],!0));return b}})})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(K,g,x,p,r){return K(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",
bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(h){g.mixin(this,h);this.extent=this.extent?this.extent.toJson?this.extent:new x(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?
this.spatialReference:new p(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new r(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?g.clone(this.colormap):null,
attributeTable:this.attributeTable?g.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?g.clone(this.multiDimensionalInfo):null,statistics:this.statistics?g.clone(this.statistics):null,histograms:this.histograms?g.clone(this.histograms):null,catalogInfo:this.catalogInfo?g.clone(this.catalogInfo):null,keyProperties:this.keyProperties?g.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&
this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?g.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),
function(K,g,x,p,r,h,b){return K([b],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,c){if(a||c){var l=c&&c.refTileInfo;a?this.virtual=!1:(this.virtual=!0,g.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),
this.width=this.cols,this.height=this.rows,this.origin||(l?this.origin=l.origin:c.spatialReference.isWebMercator()||c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var a=b.prototype.toJson.apply(this);a.tileType=this.tileType;
a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(K,g,x){K={shaderType:"vertex",getShader:function(p,r){var h=p.createShader(p.VERTEX_SHADER);p.shaderSource(h,r);p.compileShader(h);p.getShaderParameter(h,p.COMPILE_STATUS)||(h=null);return h}};g.mixin(K,x);return K})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaderScripts"],function(K,g,x){K={shaderType:"fragment",getShader:function(p,r){var h=p.createShader(p.FRAGMENT_SHADER);p.shaderSource(h,r);p.compileShader(h);p.getShaderParameter(h,p.COMPILE_STATUS)||(h=null);return h}};g.mixin(K,x);return K})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(K,g,x,p,r,h,b){return K(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return c},_initializeProgram:function(a){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var l=this._glSetting.programUniforms,k="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,n=l[k];if(n)this._uniforms=n.uniforms,this.rasterProgram=n.program;else{var d=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?r.mesh:r.basic,e=r.getShader(c,a.vertex||d),u=p.getShader(c,a.fragment),z=this._loadProgram(e,u),A={rasterProgram:h.getUniforms(c,z)};l[k]={uniforms:A,program:z};this.rasterProgram=
z;this._uniforms=A}c.useProgram(this.rasterProgram);var t=c.getAttribLocation(this.rasterProgram,"a_texCoord"),w=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,w);var q=h.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,q,c.STATIC_DRAW);c.enableVertexAttribArray(t);c.vertexAttribPointer(t,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(E){console.error("webgl exception: "+E.message)}else console.error("WebGL is required.")},_setUniform:function(a,c,l){null!=c&&(l&&!this._uniforms[l]&&(this._uniforms[l]=h.getUniforms(this.gl,this[l])),l=l?this._uniforms[l]:this._uniforms.rasterProgram,(a=l[a]||l[a+"[0]"])&&h.setUniform(this.gl,a,c))},_setUniforms:function(a,c){var l=Object.keys(a),k,n=l.length;for(k=0;k<n;k++)this._setUniform(l[k],a[l[k]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",
!1,c);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,l=this._xformSetting.scale):(a=[0,0],l=[1,1]),this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",l,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),c)):this._setUniform("u_projection",!1,c))):(a=[0,0],l=[1,1],this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",l,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,c){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var l=c&&c.notOriginal,k=c&&c.bandIDs;c&&c.reCreate?c=!1:(c=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(c=k?this._originalBandIDs.join("")===k.join(""):!1);0<this._glSetting.branchCount&&(c=!1);if(c&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};c=this._createTexture();l||(this.originalTexture=c,this._originalBandIDs=k);l=this.gl;var n=a.pixelBlock;this._rawResolution=n?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var d=0;k&&0<k.length&&n&&(d=Math.max.apply(null,k),n.pixels.length>d&&k&&(n.pixels=k.map(function(u){return n.pixels[u]}),n.statistics&&(n.statistics=k.map(function(u){return n.statistics[u]}))));k=n.width;d=n.height;l.getExtension("OES_texture_float");var e=n.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,d,0,l.RGBA,l.FLOAT,e);return{extent:a.extent,texture:c}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var c=h.createBufferTexture(this.gl,!1);a.pingpong.push(c);c=h.createBufferTexture(this.gl,!1);a.pingpong.push(c);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var c=0,l=a.branchCount;if(0<l){for(c=0;c<l;c++){var k=h.createBufferTexture(this.gl,!1);a.branches.push(k)}a.branchIndex=l-1}}},_setupXformTexture:function(a){for(var c=this._createTexture(),l=this.gl,k=4*this._xformSetting.gridConfig.size[0],
n=this._xformSetting.gridConfig.size[1],d=new Float32Array(k*n*4),e=0,u=0;u<this._xformSetting.gridConfig.coefficients.length;u++)d[e++]=this._xformSetting.gridConfig.coefficients[u],2===u%3&&(d[e++]=1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,n,0,l.RGBA,l.FLOAT,d);this._bindTexture(c,"u_transformGrid",a)},_createTexture:function(a){return h.createTexture(this.gl,a)},_bindTexture:function(a,c,l){c=c||"u_image";l=this._uniforms[l||"rasterProgram"];var k=this._getTextureIndex(c);
if(-1!==k){var n=this.gl;n.uniform1i(l[c].location,k);n.activeTexture(n.TEXTURE0+k);n.bindTexture(n.TEXTURE_2D,a)}},_getTextureIndex:function(a,c){c=this._uniforms[c||"rasterProgram"];if(!c||!c[a]||c[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);
a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var c=a.getAttribLocation(this.meshProgram,"a_texCoord"),l=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,l);l=this._xformSetting.meshSize||
[1,1];var k=h.createMesh(l,!0);a.bufferData(a.ARRAY_BUFFER,k,a.STATIC_DRAW);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,l[0]*l[1]*10)}},_setupMeshProgram:function(){var a=r.getShader(this.gl,r.mesh),c=p.getShader(this.gl,p.constant);return this._loadProgram(a,c)},_loadProgram:function(a,c){return h.loadProgram(this.gl,a,c)},_getShaderScript:function(a,
c){c=document.getElementById(c);if(!c)return null;a="";for(c=c.firstChild;c;)3==c.nodeType&&(a+=c.textContent),c=c.nextSibling;return a}})})},"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var K={getUniforms:function(g,x){var p=g.getProgramParameter(x,g.ACTIVE_UNIFORMS),r,h,b={};for(r=0;r<p;r++)(h=g.getActiveUniform(x,r))&&(b[h.name]={location:g.getUniformLocation(x,h.name),info:h});return b},setUniform:function(g,x,p){var r=x.info,h=x.location,b=r.type;if(null==p)console.log("uniform "+
x.info.name+" has null or undefined value");else switch(b){case g.FLOAT:1<r.size?0===p.length?console.log("uniform "+x.info.name+" has length 0"):g.uniform1fv(h,p):g.uniform1f(h,p);break;case g.FLOAT_VEC2:if(0===p.length){console.log("uniform "+x.info.name+" has length 0");break}g.uniform2fv(h,p);break;case g.FLOAT_VEC3:if(0===p.length){console.log("uniform "+x.info.name+" has length 0");break}g.uniform3fv(h,p);break;case g.FLOAT_VEC4:if(0===p.length){console.log("uniform "+x.info.name+" has length 0");
break}g.uniform4fv(h,p);break;case g.INT:case g.BOOL:1<r.size?0===p.length?console.log("uniform "+x.info.name+" has length 0"):g.uniform1iv(h,p):g.uniform1i(h,p);break;case g.INT_VEC2:case g.BOOL_VEC2:if(0===p.length){console.log("uniform "+x.info.name+" has length 0");break}g.uniform2iv(h,p);break;case g.INT_VEC3:case g.BOOL_VEC3:if(0===p.length){console.log("uniform "+x.info.name+" has length 0");break}g.uniform3iv(h,p);break;case g.INT_VEC4:case g.BOOL_VEC4:0===p.length?console.log("uniform "+
x.info.name+" has length 0"):g.uniform4iv(h,p)}},createTexture:function(g,x){var p=g.createTexture();g.bindTexture(g.TEXTURE_2D,p);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,x?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,x?g.LINEAR:g.NEAREST);return p},createBufferTexture:function(g,x,p){x=K.createTexture(g,x);g.getExtension("OES_texture_float");
p=p||[g.drawingBufferWidth,g.drawingBufferHeight];g.texImage2D(g.TEXTURE_2D,0,g.RGBA,p[0],p[1],0,g.RGBA,g.FLOAT,null);p=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,p);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,x,0);return{texture:x,frameBuffer:p}},getShader:function(g,x,p){p=p?g.createShader(g.VERTEX_SHADER):g.createShader(g.FRAGMENT_SHADER);g.shaderSource(p,x);g.compileShader(p);g.getShaderParameter(p,g.COMPILE_STATUS)||(console.log(g.getShaderInfoLog(p)),p=null);
return p},loadProgram:function(g,x,p){var r=g.createProgram();g.attachShader(r,x);g.attachShader(r,p);g.linkProgram(r);g.getProgramParameter(r,g.LINK_STATUS)||(console.warn("failed to load webgl program: "+g.getProgramInfoLog(r)),g.deleteProgram(r),r=null);return r},createMesh:function(g,x){if(!g||1===g[0]&&1===g[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var p=g&&x?new Float32Array(g[0]*g[1]*20):new Float32Array(g[0]*g[1]*12);var r=.9998/g[1],h=.9998/g[0],b,a,c=0;for(b=0;b<g[1];b++)for(a=
0;a<g[0];a++){var l=1E-4+r*b;var k=1E-4+h*a;g&&!x?(p[c++]=l,p[c++]=k,p[c++]=l+r,p[c++]=k,p[c++]=l,p[c++]=k+h,p[c++]=l,p[c++]=k+h,p[c++]=l+r,p[c++]=k,p[c++]=l+r,p[c++]=k+h):(p[c++]=l,p[c++]=k,p[c++]=l,p[c++]=k+h,p[c++]=l,p[c++]=k+h,p[c++]=l+r,p[c++]=k+h,p[c++]=l+r,p[c++]=k+h,p[c++]=l+r,p[c++]=k,p[c++]=l,p[c++]=k,p[c++]=l+r,p[c++]=k,p[c++]=l,p[c++]=k+h,p[c++]=l+r,p[c++]=k)}return p}};return K})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var K={Default:[0,0,0,
0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,
.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,
0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(g){switch(g){case 0:return K.LineDetectionHorizontal;case 1:return K.LineDetectionVertical;case 2:return K.LineDetectionLeftDiagonal;case 3:return K.LineDetectionRightDiagonal;case 4:return K.GradientNorth;case 5:return K.GradientWest;case 6:return K.GradientEast;case 7:return K.GradientSouth;case 8:return K.GradientNorthEast;
case 9:return K.GradientNorthWest;case 10:return K.SmoothArithmeticMean;case 11:return K.Smoothing3x3;case 12:return K.Smoothing5x5;case 13:return K.Sharpening3x3;case 14:return K.Sharpening5x5;case 15:return K.Laplacian3x3;case 16:return K.Laplacian5x5;case 17:return K.SobelHorizontal;case 18:return K.SobelVertical;case 19:return K.Sharpen;case 20:return K.Sharpen2;case 21:return K.PointSpread;default:return K.Default}}};return K})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A){K={customDrivers:[],create:function(t){if(t){if(t.url){var w=d.urlToObject(t.url);var q=w.path;var E=w.query}w=t.serviceInfo;var B=t.rasterFxArgs||{},C=new p,G=x.hitch(this,function(y){console.error(y);this._trycustomDrivers(x.mixin({url:q},t),0,C)});if(q)if(-1===q.toLowerCase().indexOf("imageserver")&&-1===q.toLowerCase().indexOf("mapserver")){var D=new z(x.mixin({},t,{url:q}));t.rasterFx&&(D=new A({rasterFx:t.rasterFx,rasterFxArgs:x.mixin({},B,{raster:D})}));
var f=D}else{f=new p;w=w||this._getServiceInfo(q,E);var m=x.hitch(this,function(y){y.bandCount?D=new e(x.mixin({},{serviceInfo:y},E,t,{url:q})):y.tileInfo&&(D=new u(x.mixin({},{serviceInfo:y},E,this._options,{url:q})));t.rasterFx&&(D=new A({rasterFx:t.rasterFx,rasterFxArgs:x.mixin({},B,{raster:D})}));f.resolve(D)});a(w,m,G)}else f=D=new A({rasterFx:t.rasterFx,rasterFxArgs:x.mixin({},B,{raster:D})});a(f,x.hitch(this,function(y){y?y.open().then(x.hitch(this,function(v){C.resolve(y)}),G):G(Error("There is no raster to open"))}),
G);return C.promise}},register:function(t){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(w){return w.sourceType===t.prototype.sourceType}).length||this.customDrivers.push(t)},_trycustomDrivers:function(t,w,q){q=q||new p;var E=this.customDrivers[w];if(E){var B=new E(t);B.open().then(x.hitch(this,function(C){q.resolve(B)}),x.hitch(this,function(C){this._trycustomDrivers(t,w+1,q)}))}else q.reject("cannot load layer "+(t&&t.url||""));return q.promise},_getServiceInfo:function(t,
w){w=w||{};var q=w.bandIds;w=w.renderingRule;var E=new p(n._dfdCanceller),B={f:"json"};q&&(B.bandIds=q);w&&(B.renderingRule=w.toJson?JSON.stringify(w.toJson()):JSON.stringify(w));E._pendingDfd=k({url:t,content:B,handleAs:"json",callbackParamName:"callback"});E._pendingDfd.then(function(C){E.callback(C)},function(C){E.errback(C)});return E.promise}};b("extend-esri")&&x.setObject("layers.rasterLib.raster.rasterFactory",K,c);return K})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C,G,D,f){K=g([G],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(m){m&&(this._imageServiceParams=m.imageServiceParameters,this._commonReqParams=m._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:m.interpolation,pixelType:m.pixelType,format:m.format||"lerc",compressionQuality:m.compressionQuality,bandIds:m.bandIds,noDataInterpretation:m.noDataInterpretation,
adjustAspectRatio:m.adjustAspectRatio,mosaicRule:m.mosaicRule,renderingRule:m.interpolation}))},open:function(){var m=new p;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),m.resolve(this),m.promise;var y=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),v=x.hitch(this,function(H){this._fixServiceInfo(H);this.serviceInfo=H;this._findCredential();var L=this._parseRasterInfo(H),
N={};H.defaultMosaicMethod?(N.method=H.defaultMosaicMethod,N.operation=H.mosaicOperator,N.sortField=H.sortField,N.sortValue=H.sortValue):N.method=q.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new q(N);this.serviceInfo.defaultMosaicRule.ascending=!0;H=this._getColormap(this);N=this._getHistograms(this);var Q=this._getRasterAttributeTable(this),R=this._getKeyProperties(this),W=this._getMultidimensionalInfo(),Z=this._getSlices();(new c([H,N,Q,R,W,Z])).then(x.hitch(this,function(X){X[0][0]&&(L.colormap=
X[0][1]);X[1][0]&&(L.histograms=X[1][1]);X[2][0]&&(L.vat=X[2][1]);X[3][0]&&(L.keyProperties=X[3][1]);X[4][0]&&(L.multidimensionalInfo=X[4][1],L.multidimensionalInfo&&L.multidimensionalInfo.variables&&L.multidimensionalInfo.variables.forEach(function(M){M.statistics&&(M.statistics.forEach(function(U){U.stddev=U.standardDeviation}),L.statistics||M.statistics.length!==L.bandCount||(L.statistics=M.statistics));!L.histograms&&M.histograms&&M.histograms.length===L.bandCount&&(L.histograms=M.histograms)}));
L.keyProperties=L.keyProperties||{};this._slices=X[5][0]?X[5][1]:null;L.keyProperties&&L.keyProperties.DataType&&(this.dataType=L.keyProperties.DataType);L.keyProperties&&L.keyProperties.DefaultVariable&&(this.defaultVariable=L.keyProperties.DefaultVariable);this.loaded=!0;this.rasterInfo=L;this.setFetchParameters(this._imageServiceParams);m.resolve(this)}))}),F=x.hitch(this,function(H){this.loaded=!0;m.reject(H)});l(y,v,F);return m.promise},setFetchParameters:function(m,y){if(y)this.imageServiceParams=
m;else{var v=this.imageServiceParams;v&&m?Object.keys(m).forEach(function(F){v[F]=m[F]}):this.imageServiceParams=m}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(m){if(m.pixelBlock||m.texture){var y=new p;y.resolve(m);return y.promise}if(!1===m.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(m);if(this._slices){var v=this._getSliceId();if(null==v)return y=new p,y.resolve(m),y.promise}var F=m.extent,H=F.spatialReference.wkid||b.toJson(F.spatialReference.toJson(!1)),
L=m.timeExtent?m.timeExtent.toJson().join(","):null;y=this.url+"/exportImage";var N={};this._slices&&(N.sliceid=v);this.disableClientCaching&&(N._ts=(new Date).getTime());v=x.mixin({},this._commonReqParams,{bbox:F.xmin+","+F.ymin+","+F.xmax+","+F.ymax,imageSR:H,bboxSR:H,size:m.width+","+m.height,time:L},N);return this._requestPixels({url:y,payload:v,decodeParams:{width:m.width,height:m.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:m})},readTile:function(m){var y=
this.tileBoundary&&this.tileBoundary[m.level];if(y&&(y.minRow>m.row||y.maxRow<m.row||y.minCol>m.col||y.maxCol<m.col)){var v=new p;v.resolve(m);return v.promise}if(this._slices&&(v=this._getSliceId(),null==v))return v=new p,v.resolve(m),v.promise;y=this.url+"/tile/"+m.level+"/"+m.row+"/"+m.col;var F={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,useWasm:!0,isPoint:"elevation"===m.tileType.toLowerCase()?!0:!1};v=this._slices?"sliceid\x3d"+
v+"\x26":"";v=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():v.replace(/&$/,"");return this._requestPixels({url:y+(0<v.length?"?"+v:""),payload:{},decodeParams:F,tileOptions:m})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var m=x.clone(this._imageServiceParams.multidimensionalDefinition),y=x.clone(this._imageServiceParams.time);
if(null==this._slices||null==y&&(null==m||0===m.length))return 0;var v=m||this.defaultMultidimensionalDefinition,F=v[0].variableName;v=this._getAllDimensionDefinition(v,F).definition;m=null;if(null==v||0===v.length)return null;if(y&&this.serviceInfo.timeInfo){if(null==y[1]||y[1]===y[0])var H=y[0];else{var L=this.serviceInfo.timeInfo.startTimeField;H=this.rasterInfo.multidimensionalInfo.variables.find(function(R){return R.name===F}).dimensions.find(function(R){return R.name===L}).values.filter(function(R){return Array.isArray(R)?
Math.max(R[0],y[0])<Math.min(R[1],y[1]):R>=y[0]&&R<=y[1]}).sort(function(R,W){R=Array.isArray(R)?R[1]:R;W=Array.isArray(W)?R[1]:W;return Math.abs(y[1]-R)-Math.abs(y[1]-W)})[0]||[y[1]]}v.some(function(R){if(R.dimensionName===L)return R.values[0]=H,!0;if(!R.dimensionName)return R.dimensionName=L,R.isSlice=!0,R.values=[H],!0})||v.push({variableName:F,dimensionName:L,isSlice:!0,values:[H]})}for(var N=0;N<this._slices.length;N++){var Q=this._slices[N].multidimensionalDefinition;if(Q.length===v.length&&
!Q.some(function(R){var W=v.filter(function(X){return R.variableName===X.variableName&&X.dimensionName===R.dimensionName})[0];if(!W)return!0;var Z=Array.isArray(R.values[0])?R.values[0][0]:R.values[0];W=Array.isArray(W.values[0])?W.values[0][0]:W.values[0];return Z!==W})){m=N;break}}return m},_getAllDimensionDefinition:function(m,y){var v=m.map(function(H){return H.dimensionName}),F=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(H){H.name!==y||H.dimensions.length===m.length&&v[0]||
(H.dimensions.forEach(function(L){0>v.indexOf(L.name)&&(v[0]?m.push({variableName:y,dimensionName:L.name,values:[L.values[0]]}):(m[0].dimensionName=L.name,m[0].values=[L.values[0]],L[0]=L.name))}),F=!0)},this);return{defChanged:F,definition:m}},_generateServiceInfo:function(m){var y=this.url,v=new p(t._dfdCanceller);v._pendingDfd=d({url:y,content:{f:"json",renderingRule:m?b.toJson(m.toJson()):null},handleAs:"json",callbackParamName:"callback"});v._pendingDfd.then(function(F){v.callback(F)},function(F){v.errback(F)});
return v},_fixServiceInfo:function(m){var y=m.spatialReference.wkid;m.tileInfo&&0===m.extent.xmin&&360===m.extent.xmax&&y&&null==A[y]&&(m.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(m){var y=new C;y.bandCount=m.bandCount;y.extent=new e(m.fullExtent);y.spatialReference=m.spatialReference;y.pixelType=m.pixelType;y.width=Math.floor((m.fullExtent.xmax-m.fullExtent.xmin)/m.pixelSizeX+.5);y.height=Math.floor((m.fullExtent.ymax-m.fullExtent.ymin)/m.pixelSizeY+.5);y.cellSize=new u({x:m.pixelSizeX,
y:m.pixelSizeY,spatialReference:m.spatialReference});var v;if(m.minValues&&0<m.minValues.length&&m.maxValues&&m.stdvValues&&m.meanValues){var F=[];for(v=0;v<m.minValues.length;v++)F.push({min:m.minValues[v],max:m.maxValues[v],mean:m.meanValues[v],stddev:m.stdvValues[v]});m.bandCount!==F.length&&(F=null)}this.dataType=m.serviceDataType?m.serviceDataType.replace("esriImageServiceDataType",""):"Generic";y.statistics=F;m.objectIdField&&m.fields&&(y.catalogInfo={objectIdField:m.objectIdField,fields:m.fields});
y.timeInfo=m.timeInfo;if(m.tileInfo){this.tileInfo=new f(m.tileInfo);this.tileInfo.tileType=m.cacheType||"Map";y.tileInfo=this.tileInfo;var H=y.extent,L=this.tileInfo.origin,N=this.tileInfo.cols,Q=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(R){return{minCol:Math.floor((H.xmin-L.x+.1*R.resolution)/N/R.resolution),maxCol:Math.floor((H.xmax-L.x-.1*R.resolution)/N/R.resolution),minRow:Math.floor((L.y-H.ymax+.1*R.resolution)/Q/R.resolution),maxRow:Math.floor((L.y-H.ymin-.1*R.resolution)/
Q/R.resolution)}})}return y},_getColormap:function(m){m=this.url+"/colormap";var y=new p(t._dfdCanceller),v={f:"json"},F=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&F?(y._pendingDfd=d({url:m,content:v,handleAs:"json",callbackParamName:"callback"}),y._pendingDfd.then(function(H){y.callback(H.colormap)},function(H){y.errback(H)})):y.callback(null);return y},_getHistograms:function(m){var y=this.url+"/histograms",v=new p(t._dfdCanceller),
F={f:"json"},H=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;m&&m.renderingRule&&(F.renderingRule=b.toJson(m.renderingRule.toJson()),H=!0);10<this.serviceInfo.currentVersion&&H?(v._pendingDfd=d({url:y,content:F,handleAs:"json",callbackParamName:"callback"}),v._pendingDfd.then(function(L){v.callback(L.histograms)},function(L){v.errback(L)})):v.callback(null);return v},_getRasterAttributeTable:function(m){var y=this.url+"/rasterAttributeTable",v=new p(t._dfdCanceller),
F={f:"json"},H=this.serviceInfo.hasRasterAttributeTable;m&&m.renderingRule&&(F.renderingRule=b.toJson(m.renderingRule.toJson()),H=!0);10<this.serviceInfo.currentVersion&&H?(v._pendingDfd=d({url:y,content:F,handleAs:"json",callbackParamName:"callback"}),v._pendingDfd.then(function(L){v.callback(L)},function(L){v.errback(L)})):v.callback(null);return v},_getKeyProperties:function(m){var y=this.url+"/keyProperties",v=new p(t._dfdCanceller),F={f:"json"};m&&m.renderingRule&&(F.renderingRule=b.toJson(m.renderingRule.toJson()));
10<this.serviceInfo.currentVersion?(v._pendingDfd=d({url:y,content:F,handleAs:"json",callbackParamName:"callback"}),v._pendingDfd.then(function(H){v.callback(H)},function(H){v.errback(H)})):v.callback(null);return v},_getMultidimensionalInfo:function(){var m=this.url+"/multidimensionalInfo",y=new p(t._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(y._pendingDfd=d({url:m,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),y._pendingDfd.then(x.hitch(this,
function(v){y.callback(v.multidimensionalInfo)}),function(v){y.errback(v)})):y.callback(null);return y},_getSlices:function(){var m=this.url+"/slices",y=new p(t._dfdCanceller);this.serviceInfo.hasMultidimensions?(y._pendingDfd=d({url:m,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),y._pendingDfd.then(x.hitch(this,function(v){y.callback(v.slices)}),function(v){y.errback(v)})):y.callback(null);return y},_initializationFailed:function(){},_constructGetImageParams:function(){var m=
this.imageServiceParams||{},y=x.mixin({},this._query,{f:"image",interpolation:m.interpolation,pixelType:m.pixelType,format:m.format||"lerc",compressionQuality:m.compressionQuality,bandIds:m.bandIds?m.bandIds.join(","):null,noData:null!=m.noData?m.noData.join(","):null,noDataInterpretation:m.noDataInterpretation,adjustAspectRatio:null==m.adjustAspectRatio?null:m.adjustAspectRatio,mosaicRule:m.mosaicRule?b.toJson(m.mosaicRule.toJson()):null,renderingRule:m.renderingRule?b.toJson(m.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===y.format.toLowerCase()?(y.compressionTolerance=m.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(y.lercVersion=m.lercVersion||2)):"tiff"===y.format.toLowerCase()?y.compression=m.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(y.format.toLowerCase())&&(y.compression=m.compression);this._commonReqParams=y},_getRasterIdentifier:function(m){if(this._rasterId)return this._rasterId;m=this.url.replace("http:","").replace("https:",
"");var y=[],v=this.imageServiceParams||{};y.push(m);y.push(v.interpolation);y.push(v.pixelType);y.push(v.compressionQuality);y.push(v.bandIds?v.bandIds.join(","):"");y.push(v.mosaicRule?b.toJson(v.mosaicRule.toJson()):"");y.push(v.renderingRule?b.toJson(v.renderingRule.toJson()):"");m=y.join("|");return this._rasterId=this._computeSignature(m)},_wrapExtent:function(m){var y=m.spatialReference._getInfo();if(y){var v=y.valid[0];y=y.valid[1];if(m.xmin<v-this.resolution.x||m.xmax>y+this.resolution.y){var F=
new e((m.xmin-v)%(y-v),m.ymin,(m.xmax-y)%(y-v),m.ymax,m.spatialReference);F.xmax<F.xmin&&(F=null)}}return F||m}});a("extend-esri")&&x.setObject("layers.rasterLib.raster.ImageServiceRaster",K,k);return K})},"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C,G,D){return g([n],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(f){if(f){var m=f.url;m&&(m=t.urlToObject(m),this.url=m.path,this._query=m.query);this.dataType=f.dataType;this.serviceInfo=f.serviceInfo;this.rasterInfo=f.rasterInfo;this.tileInfo=f.tileInfo;this.serviceInfo=f.serviceInfo}},open:function(){},read:function(f){},identify:function(f){var m=new p,y=this.rasterInfo.extent;if(G.requirePE(y.spatialReference,
f.spatialReference))G.load().then(x.hitch(this,function(){v=G.project(f,y.spatialReference);m.resolve(v)}),function(){m.reject(Error("cannot project into this spatial reference"))});else{var v=G.project(f,y.spatialReference);m.resolve(v)}return m.then(x.hitch(this,function(F){var H=this.tileInfo,L=H.origin,N=H.lods[H.lods.length-1],Q=(F.x-L.x)/H.cols/N.resolution;F=(L.y-F.y)/H.rows/N.resolution;var R=Math.round((F-Math.floor(F))*H.rows)*H.cols+Math.round((Q-Math.floor(Q))*H.cols);L=new e(L.x+N.resolution*
H.cols*Q,L.y-N.resolution*H.rows*(F+1),L.x+N.resolution*H.cols*(Q+1),L.y-N.resolution*H.rows*F,y.spatialReference);var W=this.getMemberRasters?this.getMemberRasters()[0]:this;return W.read({level:N.level,row:Math.floor(F),col:Math.floor(Q),extent:L,width:H.cols,height:H.rows,virtual:W.tileInfo.virtual,tileType:W.tileInfo.tileType}).then(function(Z){return(Z=Z&&Z.pixelBlock)&&Z.pixels&&0<Z.pixels.length&&(!Z.mask||Z.mask[R])?{pixelValue:Z.pixels.map(function(X){return X[R]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(f,m){var y=new p;if(this.projectedFullExtent&&!m)return y.resolve(this.projectedFullExtent),y.promise;var v=this.rasterInfo.extent;if(G.requirePE(this.rasterInfo.extent.spatialReference,f))G.load().then(x.hitch(this,function(){F=G.project(v,f);this.projectedFullExtent=F=new e(F.toJson());y.resolve(F)}),function(){y.reject(Error("cannot project into this spatial reference"))});else{var F=G.project(v,f);this.projectedFullExtent=F=new e(F.toJson());y.resolve(F)}return y.promise},
setFetchParameters:function(f,m){},_setRasterHandler:function(f){this._rasterHandler=f;this.getMemberRasters&&this.getMemberRasters().forEach(x.hitch(this,function(m){m._rasterHandler=f}))},_findCredential:function(){this.url&&((this._credential=k.id&&k.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new C;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(f){var m=f.url,y=f.payload,v=f.decodeParams,F=f.tileOptions,H=new p(A._dfdCanceller);this._rasterHandler||this._initWorker();var L=this._rasterHandler,N={};m={url:m,handleAs:"arraybuffer",content:y};f.headers&&(m.headers=f.headers);H._pendingDfd=d(m).then(x.hitch(this,function(Q){(L&&this._rasterHandlerInitialized?L.decode({encodedData:Q,decodeParams:v}):B.decode(Q,v)).then(function(R){N.pixelBlock=new E(R);N.extent=F.extent;N.level=F.level;N.row=F.row;N.col=
F.col;N.width=F.width;N.height=F.height;A._resDfd(H,[N])},function(R){A._resDfd(H,[R],!0)})}),function(Q){A._resDfd(H,[Q],!0)});return H},_computeSignature:function(f){if("string"===typeof f){for(var m=new Uint8Array(f.length),y=0;y<f.length;y++)m[y]=f.charCodeAt(y);f=m}y=m=65535;for(var v=f.length,F=Math.floor(v/2),H=0;F;){var L=359<=F?359:F;F-=L;do m+=f[H++]<<8,y+=m+=f[H++];while(--L);m=(m&65535)+(m>>>16);y=(y&65535)+(y>>>16)}v&1&&(y+=m+=f[H]<<8);return((y&65535)+(y>>>16)<<16|(m&65535)+(m>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./Lerc ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(K,g,x,p,r,h,b,a,c,l,k,n){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var d=new ArrayBuffer(4),e=new Uint8Array(d);(new Uint32Array(d))[0]=
1;return 1===e[0]}(),decode:function(d,e){if(void 0===e||null===e)throw"missing decode options";var u;e.format&&(u=e.format.toUpperCase());"BSQ"!==u&&"BIP"!==u&&(u=this._getFormat(d));var z=e.decodeFunc;if(void 0===z||null===z)z=this._getFormatDecoderDfd(u,e.useWasm);return z(d,e)},_getFormatDecoderDfd:function(d,e){if(e&&("LERC"===d||"LERC2"===d))return this._decodeLercWasm.bind(this);var u=null;switch(d){case "LERC":u=this._decodeLerc;break;case "LERC2":u=this._decodeLerc2;break;case "JPEG":u=this._decodeJpeg;
break;case "PNG":u=this._decodePng;break;case "BSQ":u=this._decodeBsq;break;case "BIP":u=this._decodeBip;break;case "TIFF":u=this._decodeTiff;break;default:u=function(z,A){throw"The raster format is not supported";}}u=x.hitch(this,u);return function(z,A){var t=new p;A.isPoint&&A.width&&(A.width++,A.height++);z=u(z,A);A.isPoint&&A.width&&(this._interpolatePointGrid(z),A.width--,A.height--);t.resolve(z);return t}.bind(this)},_getFormat:function(d){d=new Uint8Array(d,0,10);var e="";if(255===d[0]&&216===
d[1])e="JPEG";else if(137===d[0]&&80===d[1]&&78===d[2]&&71===d[3])e="PNG";else if(67===d[0]&&110===d[1]&&116===d[2]&&90===d[3]&&73===d[4]&&109===d[5]&&97===d[6]&&103===d[7]&&101===d[8]&&32===d[9])e="LERC";else if(76===d[0]&&101===d[1]&&114===d[2]&&99===d[3]&&50===d[4]&&32===d[5])e="LERC2";else if(-1<String.fromCharCode.apply(null,d).toLowerCase().indexOf("error"))e="ERROR";else if(73===d[0]&&73===d[1]&&42===d[2]&&0===d[3]||77===d[0]&&77===d[1]&&0===d[2]&&42===d[3])e="TIFF";return e},_validateDecodeParams:function(d){if(!d.height||
Math.floor(d.height)!==d.height)throw"Height not provided.";if(!d.width||Math.floor(d.width)!==d.width)throw"Width not provided.";},_decodeJpeg:function(d,e){if(!c)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(e);d=(new c).decode(d);if(!this._verifyResult(d,e))throw"The decoded image dimensions are incorrect.";e=new r({width:d.width,height:d.height,pixels:d.pixels,pixelType:"U8",mask:d.mask,statistics:null});e.calculateStatistics();return e},_decodePng:function(d,e){if(!l)throw"The png decoder module is not loaded.";
this._validateDecodeParams(e);d=new Uint8Array(d);var u=new l(d);d=new Uint8Array(e.width*e.height*4);u.copyToImageData(d,u.decodePixels());var z=u=0;z=new Uint8Array(e.width*e.height);for(u=0;u<e.width*e.height;u++)z[u]=d[4*u+3];var A=new r({width:e.width,height:e.height,pixels:[],pixelType:"U8",mask:z,statistics:[]});for(u=0;3>u;u++){var t=new Uint8Array(e.width*e.height);for(z=0;z<e.width*e.height;z++)t[z]=d[4*z+u];A.addData({pixels:t})}A.calculateStatistics();return A},_decodeBsq:function(d,e){if(!k)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(e);var u=e.noDataValue;e.pixelType=this._getpixelTypeAndNoData(e.pixelType);d=k.decodeBSQ(d,{bandCount:e.planes,width:e.width,height:e.height,pixelType:e.pixelType,noDataValue:u});e=new r({width:e.width,height:e.height,pixels:d.pixels,pixelType:e.pixelType,mask:d.maskData,statistics:null});e.calculateStatistics();return e},_decodeBip:function(d,e){this._validateDecodeParams(e);var u=e.noDataValue;e.pixelType=this._getpixelTypeAndNoData(e.pixelType);d=k.decodeBIP(d,{bandCount:e.planes,
width:e.width,height:e.height,pixelType:e.pixelType,noDataValue:u});e=new r({width:e.width,height:e.height,pixels:d.pixels,pixelType:e.pixelType,mask:d.maskData,statistics:null});e.calculateStatistics();return e},_decodeTiff:function(d,e){this._validateDecodeParams(e);e.pixelType=this._getpixelTypeAndNoData(e.pixelType);d=n.decode(d);d=new r({width:d.width,height:d.height,pixels:d.pixels,pixelType:d.pixelType,mask:d.maskData,statistics:null});d.calculateStatistics();return d},_decodeLerc:function(d,
e){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(e);var u=e.noDataValue;e.pixelType=this._getpixelTypeAndNoData(e.pixelType);for(var z=0,A,t=0,w,q=d.byteLength-10;t<q;){var E=h.decode(d,{inputOffset:t,encodedMaskData:A,returnMask:0===z?!0:!1,returnEncodedMask:0===z?!0:!1,returnFileInfo:!0,pixelType:e.pixelType,noDataValue:u});t=E.fileInfo.eofOffset;0===z&&(A=E.encodedMaskData,w=new r({width:e.width,height:e.height,pixels:[],
pixelType:e.pixelType,mask:E.maskData,statistics:[]}));z++;if(!this._verifyResult(E,e))throw"The decoded image dimensions are incorrect";w.addData({pixels:E.pixelData,statistics:{minValue:E.minValue,maxValue:E.maxValue,noDataValue:E.noDataValue}})}return w},_decodeLerc2:function(d,e){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(e);e.pixelType=this._getpixelTypeAndNoData(e.pixelType);for(var u=0,z,A,t,w=0,q,E=d.byteLength-
10,B=[],C,G=0;w<E;){A=b.decode(d,{inputOffset:w,maskData:z,returnFileInfo:!0});w=A.fileInfo.eofOffset;z=A.maskData;0===u&&(t=A.fileInfo.numValidPixel,q=new r({width:e.width,height:e.height,pixels:[],dimCount:A.dimCount||1,pixelType:A.fileInfo.pixelType,mask:z,statistics:[]}));A.fileInfo.mask&&0<A.fileInfo.mask.numBytes&&G++;z&&B.push(z);u++;if(!this._verifyResult(A,e))throw"The decoded image dimensions are incorrect";q.addData({pixels:A.pixelData,statistics:{minValue:A.minValue,maxValue:A.maxValue,
noDataValue:A.noDataValue,dimStats:A.dimStats}})}if(1<G){e=q.width*q.height;q.bandMasks=B;z=new Uint8Array(e);z.set(B[0]);for(t=1;t<B.length;t++)for(C=B[t],d=0;d<e;d++)z[d]&=C[d];for(d=t=0;d<e;d++)t+=C[d];q.mask=z}q.validPixelCount=t;return q},_decodeLercWasm:function(d,e){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(e);var u=new p;a.load().then(function(){var z=a.decode(d,{inputOffset:0,noDataValue:e.noDataValue,pixelType:e.pixelType&&
e.pixelType.toUpperCase()});z=new r({width:z.width,height:z.height,pixelType:z.pixelType.toUpperCase(),pixels:z.pixels,mask:z.mask,statistics:z.statistics,validPixelCount:z.validPixelCount});e.isPoint&&e.width&&(this._interpolatePointGrid(z),e.width--,e.height--);u.resolve(z)}.bind(this),function(){u.reject("Cannot load lerc wasm decoder")});return u},_interpolatePointGrid:function(d,e){var u=d.pixels;if(u&&0!==u.length){var z=u.length,A=d.width,t=d.mask,w=A-1,q=d.height-1,E=[],B,C;if(0===(null==
e?1:e)){for(e=0;e<z;e++){var G=u[e];var D=new G.constructor(w*q);for(B=0;B<q;B++){var f=B*A;for(C=0;C<w;C++)D[B*w+C]=G[f+C]}E.push(D)}if(t){var m=new Uint8Array(w*q);for(B=0;B<q;B++)for(f=B*A,C=0;C<w;C++)m[B*w+C]=t[f+C]}}else{for(e=0;e<z;e++){G=u[e];D=new G.constructor(w*q);for(B=0;B<q;B++)for(f=B*A,C=0;C<w;C++)D[B*w+C]=(G[f+C]+G[f+C+1]+G[f+A+C]+G[f+A+C+1])/4;E.push(D)}if(t)for(m=new Uint8Array(w*q),B=0;B<q;B++)for(f=B*A,C=0;C<w;C++)m[B*w+C]=Math.min.apply(null,[t[f+C],t[f+C+1],t[f+A+C],t[f+A+C+1]])}d.width=
w;d.height=q;d.mask=m;d.pixels=E;return d}},_getpixelTypeAndNoData:function(d){return"U1"===d||"U2"===d||"U4"===d||"U8"===d?"U8":d},_verifyResult:function(d,e){return d.height!==e.height||d.width!==e.width?!1:!0}}})},"esri/layers/rasterFormats/Lerc":function(){var K=this&&this.__createBinding||(Object.create?function(r,h,b,a){void 0===a&&(a=b);Object.defineProperty(r,a,{enumerable:!0,get:function(){return h[b]}})}:function(r,h,b,a){void 0===a&&(a=b);r[a]=h[b]}),g=this&&this.__setModuleDefault||(Object.create?
function(r,h){Object.defineProperty(r,"default",{enumerable:!0,value:h})}:function(r,h){r["default"]=h}),x=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var h={};if(null!=r)for(var b in r)"default"!==b&&Object.prototype.hasOwnProperty.call(r,b)&&K(h,r,b);g(h,r);return h},p=this&&this.__read||function(r,h){var b="function"===typeof Symbol&&r[Symbol.iterator];if(!b)return r;r=b.call(r);var a,c=[];try{for(;(void 0===h||0<h--)&&!(a=r.next()).done;)c.push(a.value)}catch(k){var l={error:k}}finally{try{a&&
!a.done&&(b=r["return"])&&b.call(r)}finally{if(l)throw l.error;}}return c};define(["require","exports"],function(r,h){function b(n){var d=n._malloc,e=n._free,u=n._lerc_getBlobInfo,z=n._lerc_getDataRanges,A=n._lerc_decode_4D,t,w=Object.values(n.asm).find(function(E){return E&&"buffer"in E&&E.buffer===n.HEAPU8.buffer}),q=function(E){E=E.map(function(D){return(D>>3<<3)+16});var B=E.reduce(function(D,f){return D+f}),C=d(B);t=new Uint8Array(w.buffer);B=E[0];E[0]=C;for(C=1;C<E.length;C++){var G=E[C];E[C]=
E[C-1]+B;B=G}return E};k.getBlobInfo=function(E){var B,C=new Uint8Array(48),G=new Uint8Array(24),D=p(q([E.length,C.length,G.length]),3),f=D[0],m=D[1];D=D[2];t.set(E,f);t.set(C,m);t.set(G,D);if(B=u(f,E.length,m,D,12,3))throw e(f),"lerc-getBlobInfo: error code is ".concat(B);t=new Uint8Array(w.buffer);C.set(t.slice(m,m+C.length));G.set(t.slice(D,D+G.length));C=new Uint32Array(C.buffer);D=new Float64Array(G.buffer);m=p(C,11);G=m[2];C=m[5];var y=m[10];m={version:m[0],dimCount:G,width:m[3],height:m[4],
validPixelCount:m[6],bandCount:C,blobSize:m[7],maskCount:m[8],dataType:m[1],minValue:D[0],maxValue:D[1],maxZerror:D[2],statistics:[],bandCountWithNoData:y};if(y)return m;if(1===G&&1===C)return e(f),m.statistics.push({minValue:D[0],maxValue:D[1]}),m;var v=G*C*8,F=new Uint8Array(v),H=new Uint8Array(v);D=f;y=0;var L=!1;if(t.byteLength<f+2*v){e(f);L=!0;B=p(q([E.length,v,v]),3);D=B[0];y=B[1];var N=B[2];t.set(E,D)}else B=p(q([v,v]),2),y=B[0],N=B[1];t.set(F,y);t.set(H,N);if(B=z(f,E.length,G,C,y,N))throw e(D),
L||e(y),"lerc-getDataRanges: error code is ".concat(B);t=new Uint8Array(w.buffer);F.set(t.slice(y,y+v));H.set(t.slice(N,N+v));E=new Float64Array(F.buffer);f=new Float64Array(H.buffer);B=m.statistics;for(H=0;H<C;H++)if(1<G){v=E.slice(H*G,(H+1)*G);F=f.slice(H*G,(H+1)*G);N=Math.min.apply(null,v);var Q=Math.max.apply(null,F);B.push({minValue:N,maxValue:Q,dimStats:{minValues:v,maxValues:F}})}else B.push({minValue:E[H],maxValue:f[H]});e(D);L||e(y);return m};k.decode=function(E,B){var C=B.maskCount,G=B.dimCount,
D=B.bandCount,f=B.width,m=B.height,y=B.dataType,v=B.bandCountWithNoData,F=a[y],H=f*m;B=new Uint8Array(H*D);var L=H*G*D*F.size;F=new Uint8Array(L);H=new Uint8Array(D);var N=8*D,Q=new Uint8Array(N),R=p(q([E.length,B.length,F.length,H.length,Q.length]),5),W=R[0],Z=R[1],X=R[2],M=R[3];R=R[4];t.set(E,W);t.set(B,Z);t.set(F,X);t.set(H,M);t.set(Q,R);if(E=A(W,E.length,C,Z,G,f,m,D,y,X,M,R))throw e(W),"lerc-decode: error code is ".concat(E);t=new Uint8Array(w.buffer);F.set(t.slice(X,X+L));B.set(t.slice(Z,Z+B.length));
E=null;if(v)for(H.set(t.slice(M,M+D)),Q.set(t.slice(R,R+N)),E=[],D=0;D<H.length;D++)E.push(H[D]?Q[D]:null);e(W);return{data:F,maskData:B,noDataValues:E}}}Object.defineProperty(h,"__esModule",{value:!0});h.getBlobInfo=h.decode=h.isLoaded=h.load=void 0;var a=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",
size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}],c=null,l=!1;h.load=function(){return c?c:c=(new Promise(function(n,d){r(["./lerc-wasm"],n,d)})).then(x).then(function(n){n=n.default;return n({locateFile:function(d){return r.toUrl("./"+d)}})}).then(function(n){b(n);
l=!0})};h.isLoaded=function(){return l};var k={getBlobInfo:null,decode:null};h.decode=function(n,d){var e;void 0===d&&(d={});var u=null!==(e=d.inputOffset)&&void 0!==e?e:0;e=n instanceof Uint8Array?n.subarray(u):new Uint8Array(n,u);n=k.getBlobInfo(e);var z=k.decode(e,n),A=z.maskData;e=n.width;u=n.height;var t=n.bandCount,w=n.dimCount,q=n.maskCount,E=n.statistics,B=a[n.dataType],C=new B.ctor(z.data.buffer);z=[];for(var G=[],D=e*u,f=D*w,m=0;m<t;m++){var y=C.subarray(m*f,(m+1)*f);if(d.returnPixelInterleavedDims)z.push(y);
else{var v=D,F=w;if(!(2>F)){for(var H=new B.ctor(v*F),L=0,N=0;L<v;L++)for(var Q=0,R=L;Q<F;Q++,R+=v)H[R]=y[N++];y=H}z.push(y)}G.push(A.subarray(m*f,(m+1)*f))}A=0===q?null:1===q?G[0]:new Uint8Array(D);if(1<q)for(A.set(G[0]),m=1;m<G.length;m++)for(C=G[m],f=0;f<D;f++)A[f]&=C[f];m=d.noDataValue;m=null!=m&&B.range[0]<=m&&B.range[1]>=m;if(0<q&&m)for(v=d.noDataValue,m=0;m<t;m++)for(y=z[m],C=G[m]||A,f=0;f<D;f++)0===C[f]&&(y[f]=v);return{width:e,height:u,bandCount:t,pixelType:d.pixelType&&0===n.version?d.pixelType:
B.pixelType,dimCount:w,statistics:E,pixels:z,mask:A,bandMasks:q===t&&1<t?G:null}};h.getBlobInfo=function(n,d){var e,u;void 0===d&&(d={});var z=n instanceof Uint8Array?n.subarray(null!==(e=d.inputOffset)&&void 0!==e?e:0):new Uint8Array(n,null!==(u=d.inputOffset)&&void 0!==u?u:0);return k.getBlobInfo(z)}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(K,g,x){return K(null,{constructor:function(){},decode:function(p){var r=new Uint8Array(p);p=
new x;p.parse(r);var h=p.numComponents,b=p.getData(p.width,p.height,!0),a=p.width*p.height,c=p.eof,l=0,k=0,n=0;if(c<r.length-1){k=(new g(r.subarray(c))).getBytes();var d=new Uint8Array(a);for(l=r=0;l<k.length;l++)for(n=7;0<=n;n--)d[r++]=k[l]>>n&1}r=[];if(1===h&&b.length===a)r=[b,b,b];else{for(l=0;3>l;l++)h=new Uint8Array(a),r.push(h);for(k=n=0;k<a;k++)for(l=0;3>l;l++)r[l][k]=b[n++]}return{width:p.width,height:p.height,pixels:r,mask:d}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var K=
function(){function g(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}g.prototype={ensureBuffer:function(x){var p=this.buffer,r=p?p.byteLength:0;if(x<r)return p;for(var h=512;h<x;)h<<=1;x=new Uint8Array(h);for(h=0;h<r;++h)x[h]=p[h];return this.buffer=x},getByte:function(){for(var x=this.pos;this.bufferLength<=x;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(x){var p=this.pos;if(x){this.ensureBuffer(p+x);for(x=p+x;!this.eof&&this.bufferLength<
x;)this.readBlock();var r=this.bufferLength;x>r&&(x=r)}else{for(;!this.eof;)this.readBlock();x=this.bufferLength}this.pos=x;return this.buffer.subarray(p,x)},lookChar:function(){for(var x=this.pos;this.bufferLength<=x;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var x=this.pos;this.bufferLength<=x;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(x,p,r){for(var h=
x+p;this.bufferLength<=h&&!this.eof;)this.readBlock();return new Stream(this.buffer,x,p,r)},skip:function(x){x||(x=1);this.pos+=x},reset:function(){this.pos=0}};return g}();return function(){function g(c){throw Error(c);}function x(c){var l=0,k=c[l++],n=c[l++];-1!=k&&-1!=n||g("Invalid header in flate stream");8!=(k&15)&&g("Unknown compression method in flate stream");0!=((k<<8)+n)%31&&g("Bad FCHECK in flate stream");n&32&&g("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=l;this.codeBuf=
this.codeSize=0;K.call(this)}if(!self||!self.Uint32Array)return null;var p=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),h=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,
794625,798721,868353,876545]),b=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,
524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,
524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,
524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,
524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,
524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,
524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,
524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];x.prototype=Object.create(K.prototype);x.prototype.getBits=function(c){for(var l=this.codeSize,k=this.codeBuf,n=this.bytes,d=this.bytesPos,e;l<c;)"undefined"==
typeof(e=n[d++])&&g("Bad encoding in flate stream"),k|=e<<l,l+=8;this.codeBuf=k>>c;this.codeSize=l-=c;this.bytesPos=d;return k&(1<<c)-1};x.prototype.getCode=function(c){var l=c[0],k=c[1];c=this.codeSize;for(var n=this.codeBuf,d=this.bytes,e=this.bytesPos;c<k;){var u;"undefined"==typeof(u=d[e++])&&g("Bad encoding in flate stream");n|=u<<c;c+=8}k=l[n&(1<<k)-1];l=k>>16;k&=65535;(0==c||c<l||0==l)&&g("Bad encoding in flate stream");this.codeBuf=n>>l;this.codeSize=c-l;this.bytesPos=e;return k};x.prototype.generateHuffmanTable=
function(c){for(var l=c.length,k=0,n=0;n<l;++n)c[n]>k&&(k=c[n]);for(var d=1<<k,e=new Uint32Array(d),u=1,z=0,A=2;u<=k;++u,z<<=1,A<<=1)for(var t=0;t<l;++t)if(c[t]==u){var w=0,q=z;for(n=0;n<u;++n)w=w<<1|q&1,q>>=1;for(n=w;n<d;n+=A)e[n]=u<<16|t;++z}return[e,k]};x.prototype.readBlock=function(){function c(w,q,E,B,C){for(w=w.getBits(E)+B;0<w--;)q[z++]=C}var l=this.getBits(3);l&1&&(this.eof=!0);l>>=1;if(0==l){var k=this.bytes,n=this.bytesPos,d;"undefined"==typeof(d=k[n++])&&g("Bad block header in flate stream");
var e=d;"undefined"==typeof(d=k[n++])&&g("Bad block header in flate stream");e|=d<<8;"undefined"==typeof(d=k[n++])&&g("Bad block header in flate stream");l=d;"undefined"==typeof(d=k[n++])&&g("Bad block header in flate stream");(l|d<<8)!=(~e&65535)&&g("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;d=this.bufferLength;l=this.ensureBuffer(d+e);this.bufferLength=e=d+e;for(var u=d;u<e;++u){if("undefined"==typeof(d=k[n++])){this.eof=!0;break}l[u]=d}this.bytesPos=n}else{if(1==
l)n=b,d=a;else if(2==l){l=this.getBits(5)+257;d=this.getBits(5)+1;k=this.getBits(4)+4;n=Array(p.length);for(var z=0;z<k;)n[p[z++]]=this.getBits(3);n=this.generateHuffmanTable(n);z=k=0;d=l+d;for(e=Array(d);z<d;)u=this.getCode(n),16==u?c(this,e,2,3,k):17==u?c(this,e,3,3,k=0):18==u?c(this,e,7,11,k=0):e[z++]=k=u;n=this.generateHuffmanTable(e.slice(0,l));d=this.generateHuffmanTable(e.slice(l,d))}else g("Unknown block type in flate stream");e=(l=this.buffer)?l.length:0;for(u=this.bufferLength;;){var A=
this.getCode(n);if(256>A)u+1>=e&&(l=this.ensureBuffer(u+1),e=l.length),l[u++]=A;else{if(256==A){this.bufferLength=u;break}A-=257;A=r[A];var t=A>>16;0<t&&(t=this.getBits(t));k=(A&65535)+t;A=this.getCode(d);A=h[A];t=A>>16;0<t&&(t=this.getBits(t));A=(A&65535)+t;u+k>=e&&(l=this.ensureBuffer(u+k),e=l.length);for(t=0;t<k;++t,++u)l[u]=l[u-A]}}}};return x}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var K=function(){function g(x){this.message="JPEG error: "+x}g.prototype=Error();
g.prototype.name="JpegError";return g.constructor=g}();return function(){function g(){this.decodeTransform=null;this.colorTransform=-1}function x(a,c){for(var l=0,k=[],n,d,e=16;0<e&&!a[e-1];)e--;k.push({children:[],index:0});var u=k[0],z;for(n=0;n<e;n++){for(d=0;d<a[n];d++){u=k.pop();for(u.children[u.index]=c[l];0<u.index;)u=k.pop();u.index++;for(k.push(u);k.length<=n;)k.push(z={children:[],index:0}),u.children[u.index]=z.children,u=z;l++}n+1<e&&(k.push(z={children:[],index:0}),u.children[u.index]=
z.children,u=z)}return k[0].children}function p(a,c,l,k,n,d,e,u,z){function A(){if(0<v)return v--,y>>v&1;y=a[c++];if(255===y){var I=a[c++];if(I)throw new K("unexpected marker "+(y<<8|I).toString(16));}v=7;return y>>>7}function t(I){for(;;){I=I[A()];if("number"===typeof I)return I;if("object"!==typeof I)throw new K("invalid huffman sequence");}}function w(I){for(var J=0;0<I;)J=J<<1|A(),I--;return J}function q(I){if(1===I)return 1===A()?1:-1;var J=w(I);return J>=1<<I-1?J:J+(-1<<I)+1}function E(I,J){var O=
t(I.huffmanTableDC);O=0===O?0:q(O);I.blockData[J]=I.pred+=O;for(O=1;64>O;){var S=t(I.huffmanTableAC),P=S&15;S>>=4;if(0===P){if(15>S)break;O+=16}else O+=S,I.blockData[J+b[O]]=q(P),O++}}function B(I,J){var O=t(I.huffmanTableDC);O=0===O?0:q(O)<<z;I.blockData[J]=I.pred+=O}function C(I,J){I.blockData[J]|=A()<<z}function G(I,J){if(0<F)F--;else for(var O=d;O<=e;){var S=t(I.huffmanTableAC),P=S&15;S>>=4;if(0===P){if(15>S){F=w(S)+(1<<S)-1;break}O+=16}else O+=S,I.blockData[J+b[O]]=q(P)*(1<<z),O++}}function D(I,
J){for(var O=d,S=0,P;O<=e;){P=b[O];switch(H){case 0:S=t(I.huffmanTableAC);P=S&15;S>>=4;if(0===P)15>S?(F=w(S)+(1<<S),H=4):(S=16,H=1);else{if(1!==P)throw new K("invalid ACn encoding");L=q(P);H=S?2:3}continue;case 1:case 2:I.blockData[J+P]?I.blockData[J+P]+=A()<<z:(S--,0===S&&(H=2===H?3:0));break;case 3:I.blockData[J+P]?I.blockData[J+P]+=A()<<z:(I.blockData[J+P]=L<<z,H=0);break;case 4:I.blockData[J+P]&&(I.blockData[J+P]+=A()<<z)}O++}4===H&&(F--,0===F&&(H=0))}var f=l.mcusPerLine,m=c,y=0,v=0,F=0,H=0,L,
N=k.length,Q,R,W,Z;u=l.progressive?0===d?0===u?B:C:0===u?G:D:E;var X=0;l=1===N?k[0].blocksPerLine*k[0].blocksPerColumn:f*l.mcusPerColumn;for(var M,U;X<l;){var T=n?Math.min(l-X,n):l;for(Q=0;Q<N;Q++)k[Q].pred=0;F=0;if(1===N){var V=k[0];for(Z=0;Z<T;Z++)u(V,64*((V.blocksPerLine+1)*(X/V.blocksPerLine|0)+X%V.blocksPerLine)),X++}else for(Z=0;Z<T;Z++){for(Q=0;Q<N;Q++)for(V=k[Q],M=V.h,U=V.v,R=0;R<U;R++)for(W=0;W<M;W++)u(V,64*((V.blocksPerLine+1)*((X/f|0)*V.v+R)+(X%f*V.h+W)));X++}v=0;(V=h(a,c))&&V.invalid&&
(console.log("decodeScan - unexpected MCU data, next marker is: "+V.invalid),c=V.offset);V=V&&V.marker;if(!V||65280>=V)throw new K("marker was not found");if(65488<=V&&65495>=V)c+=2;else break}(V=h(a,c))&&V.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+V.invalid),c=V.offset);return c-m}function r(a,c){a=c.blocksPerLine;for(var l=c.blocksPerColumn,k=new Int16Array(64),n=0;n<l;n++)for(var d=0;d<a;d++){var e=void 0,u=void 0,z=void 0,A=void 0,t=void 0,w=void 0,q=void 0,E=
void 0,B=t=w=A=u=e=void 0,C=void 0,G=void 0,D=void 0,f=64*((c.blocksPerLine+1)*n+d),m=k,y=c.quantizationTable,v=c.blockData;if(!y)throw new K("missing required Quantization Table.");for(var F=0;64>F;F+=8)e=v[f+F],E=v[f+F+1],q=v[f+F+2],w=v[f+F+3],t=v[f+F+4],A=v[f+F+5],z=v[f+F+6],u=v[f+F+7],e*=y[F],0===(E|q|w|t|A|z|u)?(e=5793*e+512>>10,m[F]=e,m[F+1]=e,m[F+2]=e,m[F+3]=e,m[F+4]=e,m[F+5]=e,m[F+6]=e,m[F+7]=e):(E*=y[F+1],q*=y[F+2],w*=y[F+3],t*=y[F+4],A*=y[F+5],z*=y[F+6],u*=y[F+7],D=5793*e+128>>8,G=5793*
t+128>>8,C=q,B=z,t=2896*(E-u)+128>>8,u=2896*(E+u)+128>>8,w<<=4,A<<=4,D=D+G+1>>1,G=D-G,e=3784*C+1567*B+128>>8,C=1567*C-3784*B+128>>8,B=e,t=t+A+1>>1,A=t-A,u=u+w+1>>1,w=u-w,D=D+B+1>>1,B=D-B,G=G+C+1>>1,C=G-C,e=2276*t+3406*u+2048>>12,t=3406*t-2276*u+2048>>12,u=e,e=799*w+4017*A+2048>>12,w=4017*w-799*A+2048>>12,A=e,m[F]=D+u,m[F+7]=D-u,m[F+1]=G+A,m[F+6]=G-A,m[F+2]=C+w,m[F+5]=C-w,m[F+3]=B+t,m[F+4]=B-t);for(y=0;8>y;++y)e=m[y],E=m[y+8],q=m[y+16],w=m[y+24],t=m[y+32],A=m[y+40],z=m[y+48],u=m[y+56],0===(E|q|w|t|
A|z|u)?(e=5793*e+8192>>14,e=-2040>e?0:2024<=e?255:e+2056>>4,v[f+y]=e,v[f+y+8]=e,v[f+y+16]=e,v[f+y+24]=e,v[f+y+32]=e,v[f+y+40]=e,v[f+y+48]=e,v[f+y+56]=e):(D=5793*e+2048>>12,G=5793*t+2048>>12,C=q,B=z,t=2896*(E-u)+2048>>12,u=2896*(E+u)+2048>>12,D=(D+G+1>>1)+4112,G=D-G,e=3784*C+1567*B+2048>>12,C=1567*C-3784*B+2048>>12,B=e,t=t+A+1>>1,A=t-A,u=u+w+1>>1,w=u-w,D=D+B+1>>1,B=D-B,G=G+C+1>>1,C=G-C,e=2276*t+3406*u+2048>>12,t=3406*t-2276*u+2048>>12,u=e,e=799*w+4017*A+2048>>12,w=4017*w-799*A+2048>>12,A=e,e=D+u,u=
D-u,E=G+A,z=G-A,q=C+w,A=C-w,w=B+t,t=B-t,e=16>e?0:4080<=e?255:e>>4,E=16>E?0:4080<=E?255:E>>4,q=16>q?0:4080<=q?255:q>>4,w=16>w?0:4080<=w?255:w>>4,t=16>t?0:4080<=t?255:t>>4,A=16>A?0:4080<=A?255:A>>4,z=16>z?0:4080<=z?255:z>>4,u=16>u?0:4080<=u?255:u>>4,v[f+y]=e,v[f+y+8]=E,v[f+y+16]=q,v[f+y+24]=w,v[f+y+32]=t,v[f+y+40]=A,v[f+y+48]=z,v[f+y+56]=u)}return c.blockData}function h(a,c,l){var k=a.length-1;l=l<c?l:c;if(c>=k)return null;var n=a[c]<<8|a[c+1];if(65472<=n&&65534>=n)return{invalid:null,marker:n,offset:c};
for(c=a[l]<<8|a[l+1];!(65472<=c&&65534>=c);){if(++l>=k)return null;c=a[l]<<8|a[l+1]}return{invalid:n.toString(16),marker:c,offset:l}}if(!self||!self.Uint8ClampedArray)return null;var b=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);g.prototype={parse:function(a){function c(){var y=a[n]<<8|a[n+1];n+=2;return y}function l(){var y=c();y=n+y-2;var v=
h(a,y,n);v&&v.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+v.invalid),y=v.offset);y=a.subarray(n,y);n+=y.length;return y}function k(y){for(var v=Math.ceil(y.samplesPerLine/8/y.maxH),F=Math.ceil(y.scanLines/8/y.maxV),H=0;H<y.components.length;H++){m=y.components[H];var L=Math.ceil(Math.ceil(y.samplesPerLine/8)*m.h/y.maxH),N=Math.ceil(Math.ceil(y.scanLines/8)*m.v/y.maxV);m.blockData=new Int16Array(64*F*m.v*(v*m.h+1));m.blocksPerLine=L;m.blocksPerColumn=N}y.mcusPerLine=
v;y.mcusPerColumn=F}var n=0,d=null,e=null,u=[],z=[],A=[],t=c();if(65496!==t)throw new K("SOI not found");for(t=c();65497!==t;){switch(t){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=l();65504===t&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(d={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],
thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])});65518===t&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&(e={version:w[5]<<8|w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:t=c()+n-2;for(var q;n<t;){var E=a[n++],B=new Uint16Array(64);if(0===E>>4)for(w=0;64>w;w++)q=b[w],B[q]=a[n++];else if(1===E>>4)for(w=0;64>w;w++)q=b[w],B[q]=c();else throw new K("DQT - invalid table spec");u[E&15]=B}break;case 65472:case 65473:case 65474:if(C)throw new K("Only single frame JPEGs supported");
c();var C={};C.extended=65473===t;C.progressive=65474===t;C.precision=a[n++];C.scanLines=c();C.samplesPerLine=c();C.components=[];C.componentIds={};w=a[n++];for(t=B=E=0;t<w;t++){q=a[n];var G=a[n+1]>>4;var D=a[n+1]&15;E<G&&(E=G);B<D&&(B=D);G=C.components.push({h:G,v:D,quantizationId:a[n+2],quantizationTable:null});C.componentIds[q]=G-1;n+=3}C.maxH=E;C.maxV=B;k(C);break;case 65476:q=c();for(t=2;t<q;){E=a[n++];B=new Uint8Array(16);for(w=G=0;16>w;w++,n++)G+=B[w]=a[n];D=new Uint8Array(G);for(w=0;w<G;w++,
n++)D[w]=a[n];t+=17+G;(0===E>>4?A:z)[E&15]=x(B,D)}break;case 65501:c();var f=c();break;case 65498:c();q=a[n++];w=[];for(t=0;t<q;t++){E=C.componentIds[a[n++]];var m=C.components[E];E=a[n++];m.huffmanTableDC=A[E>>4];m.huffmanTableAC=z[E&15];w.push(m)}t=a[n++];q=a[n++];E=a[n++];t=p(a,n,C,w,f,t,q,E>>4,E&15);n+=t;break;case 65535:255!==a[n]&&n--;break;default:if(255===a[n-3]&&192<=a[n-2]&&254>=a[n-2])n-=3;else throw new K("unknown marker "+t.toString(16));}t=c()}this.width=C.samplesPerLine;this.height=
C.scanLines;this.jfif=d;this.eof=n;this.adobe=e;this.components=[];for(t=0;t<C.components.length;t++){m=C.components[t];if(d=u[m.quantizationId])m.quantizationTable=d;this.components.push({output:r(C,m),scaleX:m.h/C.maxH,scaleY:m.v/C.maxV,blocksPerLine:m.blocksPerLine,blocksPerColumn:m.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(a,c){var l=this.width/a,k=this.height/c,n,d,e=0,u=this.components.length,z=a*c*u,A=new Uint8ClampedArray(z),t=new Uint32Array(a);
for(d=0;d<u;d++){var w=this.components[d];var q=w.scaleX*l;var E=w.scaleY*k;e=d;var B=w.output;var C=w.blocksPerLine+1<<3;for(n=0;n<a;n++)w=0|n*q,t[n]=(w&4294967288)<<3|w&7;for(q=0;q<c;q++)for(w=0|q*E,w=C*(w&4294967288)|(w&7)<<3,n=0;n<a;n++)A[e]=B[w+t[n]],e+=u}if(c=this.decodeTransform)for(d=0;d<z;)for(a=w=0;w<u;w++,d++,a+=2)A[d]=(A[d]*c[a]>>8)+c[a+1];return A},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===
this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,l,k,n=0,d=a.length;n<d;n+=3)c=a[n],l=a[n+1],k=a[n+2],a[n]=c-179.456+1.402*k,a[n+1]=c+135.459-.344*l-.714*k,a[n+2]=c-226.816+1.772*l;return a},_convertYcckToRgb:function(a){for(var c,l,k,n,d=0,e=0,u=a.length;e<u;e+=4)c=a[e],l=a[e+1],k=a[e+2],n=a[e+3],a[d++]=-122.67195406894+l*(-6.60635669420364E-5*l+4.37130475926232E-4*k-5.4080610064599E-5*c+4.8449797120281E-4*n-.154362151871126)+k*(-9.57964378445773E-4*k+8.17076911346625E-4*c-.00477271405408747*
n+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*n+.48357088451265)+n*(-3.36197177618394E-4*n+.484791561490776),a[d++]=107.268039397724+l*(2.19927104525741E-5*l-6.40992018297945E-4*k+6.59397001245577E-4*c+4.26105652938837E-4*n-.176491792462875)+k*(-7.78269941513683E-4*k+.00130872261408275*c+7.70482631801132E-4*n-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*n+.25802910206845)+n*(-3.18913117588328E-4*n-.213742400323665),a[d++]=-20.810012546947+l*(-5.70115196973677E-4*
l-2.63409051004589E-5*k+.0020741088115012*c-.00288260236853442*n+.814272968359295)+k*(-1.53496057440975E-5*k-1.32689043961446E-4*c+5.60833691242812E-4*n-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*n+.116935020465145)+n*(-3.43531996510555E-4*n+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,l,k,n=0,d=a.length;n<d;n+=4)c=a[n],l=a[n+1],k=a[n+2],a[n]=434.456-c-1.402*k,a[n+1]=119.541-c+.344*l+.714*k,a[n+2]=481.816-c-1.772*l;return a},_convertCmykToRgb:function(a){for(var c,
l,k,n,d=0,e=1/255,u=0,z=a.length;u<z;u+=4)c=a[u]*e,l=a[u+1]*e,k=a[u+2]*e,n=a[u+3]*e,a[d++]=255+c*(-4.387332384609988*c+54.48615194189176*l+18.82290502165302*k+212.25662451639585*n-285.2331026137004)+l*(1.7149763477362134*l-5.6096736904047315*k-17.873870861415444*n-5.497006427196366)+k*(-2.5217340131683033*k-21.248923337353073*n+17.5119270841813)-n*(21.86122147463605*n+189.48180835922747),a[d++]=255+c*(8.841041422036149*c+60.118027045597366*l+6.871425592049007*k+31.159100130055922*n-79.2970844816548)+
l*(-15.310361306967817*l+17.575251261109482*k+131.35250912493976*n-190.9453302588951)+k*(4.444339102852739*k+9.8632861493405*n-24.86741582555878)-n*(20.737325471181034*n+187.80453709719578),a[d++]=255+c*(.8842522430003296*c+8.078677503112928*l+30.89978309703729*k-.23883238689178934*n-14.183576799673286)+l*(10.49593273432072*l+63.02378494754052*k+50.606957656360734*n-112.23884253719248)+k*(.03296041114873217*k+115.60384449646641*n-193.58209356861505)-n*(22.33816807309886*n+180.12613974708367);return a},
getData:function(a,c,l){if(4<this.numComponents)throw new K("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&l){l=a.length;c=new Uint8ClampedArray(3*l);for(var k=0,n=0;n<l;n++){var d=a[n];c[k++]=d;c[k++]=d;c[k++]=d}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===this.numComponents){if(this._isColorConversionNeeded())return l?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(l)return this._convertCmykToRgb(a)}return a}};
return g}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(K){return function(){function g(p){var r,h;this.data=p;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(h=null;;){var b=this.readUInt32();var a=p=void 0;p=[];for(a=0;4>a;++a)p.push(String.fromCharCode(this.data[this.pos++]));p=p.join("");switch(p){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=
this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":h&&this.animation.frames.push(h);this.pos+=4;h={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};p=this.readUInt16();b=this.readUInt16()||
100;h.delay=1E3*p/b;h.disposeOp=this.data[this.pos++];h.blendOp=this.data[this.pos++];h.data=[];break;case "IDAT":case "fdAT":"fdAT"===p&&(this.pos+=4,b-=4);p=(null!=h?h.data:void 0)||this.imgData;for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)p.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(p=0;0<=b?p<b:p>b;0<=b?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=
this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;case "tEXt":a=this.read(b);b=a.indexOf(0);p=String.fromCharCode.apply(String,a.slice(0,b));this.text[p]=String.fromCharCode.apply(String,a.slice(b+1));break;case "IEND":h&&this.animation.frames.push(h);a:{switch(this.colorType){case 0:case 3:case 4:h=1;break a;case 2:case 6:h=3;break a}h=void 0}this.colors=h;this.hasAlphaChannel=4===(r=this.colorType)||6===r;r=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*
r;a:{switch(this.colors){case 1:r="DeviceGray";break a;case 3:r="DeviceRGB";break a}r=void 0}this.colorSpace=r;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}g.load=function(p,r,h){"function"===typeof r&&(h=r);var b=new XMLHttpRequest;b.open("GET",p,!0);b.responseType="arraybuffer";b.onload=function(){var a=new Uint8Array(b.response||b.mozResponseArrayBuffer);a=new g(a);"function"===typeof(null!=
r?r.getContext:void 0)&&a.render(r);return"function"===typeof h?h(a):void 0};return b.send(null)};g.prototype.read=function(p){var r;var h=[];for(r=0;0<=p?r<p:r>p;0<=p?++r:--r)h.push(this.data[this.pos++]);return h};g.prototype.readUInt32=function(){var p=this.data[this.pos++]<<24;var r=this.data[this.pos++]<<16;var h=this.data[this.pos++]<<8;var b=this.data[this.pos++];return p|r|h|b};g.prototype.readUInt16=function(){var p=this.data[this.pos++]<<8;var r=this.data[this.pos++];return p|r};g.prototype.decodePixels=
function(p){var r,h,b,a,c,l,k,n;null==p&&(p=this.imgData);if(0===p.length)return new Uint8Array(0);p=new K(p);p=p.getBytes();var d=this.pixelBitlength/8;var e=d*this.width;var u=new Uint8Array(e*this.height);var z=p.length;for(h=a=c=0;a<z;){switch(p[a++]){case 0:for(b=r=0;r<e;b=r+=1)u[h++]=p[a++];break;case 1:for(b=l=0;l<e;b=l+=1){r=p[a++];var A=b<d?0:u[h-d];u[h++]=(r+A)%256}break;case 2:for(b=A=0;A<e;b=A+=1){r=p[a++];var t=(b-b%d)/d;l=c&&u[(c-1)*e+t*d+b%d];u[h++]=(l+r)%256}break;case 3:for(b=n=0;n<
e;b=n+=1)r=p[a++],t=(b-b%d)/d,A=b<d?0:u[h-d],l=c&&u[(c-1)*e+t*d+b%d],u[h++]=(r+Math.floor((A+l)/2))%256;break;case 4:for(b=n=0;n<e;b=n+=1){r=p[a++];t=(b-b%d)/d;A=b<d?0:u[h-d];0===c?l=k=0:(l=u[(c-1)*e+t*d+b%d],k=t&&u[(c-1)*e+(t-1)*d+b%d]);var w=A+l-k;b=Math.abs(w-A);t=Math.abs(w-l);w=Math.abs(w-k);A=b<=t&&b<=w?A:t<=w?l:k;u[h++]=(r+A)%256}break;default:throw Error("Invalid filter algorithm: "+p[a-1]);}c++}return u};g.prototype.decodePalette=function(){var p,r,h,b,a;var c=this.palette;var l=this.transparency.indexed||
[];var k=new Uint8Array((l.length||0)+c.length);var n=h=p=r=0;for(b=c.length;h<b;n=h+=3)k[r++]=c[n],k[r++]=c[n+1],k[r++]=c[n+2],k[r++]=null!=(a=l[p++])?a:255;return k};g.prototype.copyToImageData=function(p,r){var h,b;var a=this.colors;var c=null;var l=this.hasAlphaChannel;this.palette.length&&(c=null!=(h=this._decodedPalette)?h:this._decodedPalette=this.decodePalette(),a=4,l=!0);p=p.data||p;var k=p.length;var n=c||r;h=b=0;if(1===a)for(;h<k;)a=c?4*r[h/4]:b,b=n[a++],p[h++]=b,p[h++]=b,p[h++]=b,p[h++]=
l?n[a++]:this.transparency.grayscale&&this.transparency.grayscale===b?0:255,b=a;else for(;h<k;)a=c?4*r[h/4]:b,p[h++]=n[a++],p[h++]=n[a++],p[h++]=n[a++],p[h++]=l?n[a++]:this.transparency.rgb&&this.transparency.rgb[1]===n[a-3]&&this.transparency.rgb[3]===n[a-2]&&this.transparency.rgb[5]===n[a-1]?0:255,b=a};g.prototype.decode=function(){var p=new Uint8Array(this.width*this.height*4);this.copyToImageData(p,this.decodePixels());return p};var x=function(p){(void 0).clearRect(0,0,p.width,p.height);(void 0).putImageData(p,
0,0);p=new Image;p.src=(void 0).toDataURL();return p};g.prototype.decodeFrames=function(p){var r,h;if(this.animation){var b=this.animation.frames;var a=[];var c=r=0;for(h=b.length;r<h;c=++r){c=b[c];var l=p.createImageData(c.width,c.height);var k=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(l,k);c.imageData=l;a.push(c.image=x(l))}return a}};g.prototype.renderFrame=function(p,r){var h=this.animation.frames;var b=h[r];h=h[r-1];0===r&&p.clearRect(0,0,this.width,this.height);1===(null!=
h?h.disposeOp:void 0)?p.clearRect(h.xOffset,h.yOffset,h.width,h.height):2===(null!=h?h.disposeOp:void 0)&&p.putImageData(h.imageData,h.xOffset,h.yOffset);0===b.blendOp&&p.clearRect(b.xOffset,b.yOffset,b.width,b.height);return p.drawImage(b.image,b.xOffset,b.yOffset)};g.prototype.animate=function(p){var r,h=this;var b=0;var a=this.animation;var c=a.numFrames;var l=a.frames;var k=a.numPlays;return(r=function(){var n=b++%c;var d=l[n];h.renderFrame(p,n);if(1<c&&b/c<k)return h.animation._timeout=setTimeout(r,
d.delay)})()};g.prototype.stopAnimation=function(){var p;return clearTimeout(null!=(p=this.animation)?p._timeout:void 0)};g.prototype.render=function(p){p._png&&p._png.stopAnimation();p._png=this;p.width=this.width;p.height=this.height;p=p.getContext("2d");if(this.animation)return this.decodeFrames(p),this.animate(p);var r=p.createImageData(this.width,this.height);this.copyToImageData(r,this.decodePixels());return p.putImageData(r,0,0)};return g}()})},"esri/layers/rasterFormats/Raw":function(){define([],
function(){return{decodeBIP:function(K,g){var x=g.pixelType,p=g.bandCount,r=[],h=g.width*g.height,b=this.getBandCount(K,g);p=p||b;var a=K.byteLength-K.byteLength%(h*this._getPixelLength(x)),c=new x(K,0,h*b),l,k,n;for(l=0;l<p;l++){var d=new x(h);for(k=0;k<h;k++)d[k]=c[k*b+l];r.push(d)}a<K.byteLength-1&&(n=this._decodeMask(K.slice(a),g));return{pixels:r,maskData:n}},decodeBSQ:function(K,g){var x=g.pixelType,p=g.bandCount;if(void 0===p||null===p)p=this.getBandCount(K,g);var r=[],h=g.width*g.height,b=
h*p,a=K.byteLength-K.byteLength%(h*this._getPixelLength(x));x=new x(K,0,b);var c;for(b=0;b<p;b++)r.push(x.subarray(b*h,(b+1)*h));a<K.byteLength-1&&(c=this._decodeMask(K.slice(a),g));return{pixels:r,maskData:c}},getBandCount:function(K,g){return Math.floor(K.byteLength/(g.width*g.height*this._getPixelLength(g.pixelType)))},_getPixelLength:function(K){var g=1;switch(K){case Uint8Array:case Int8Array:case Uint8ClampedArray:g=1;break;case Uint16Array:case Int16Array:g=2;break;case Uint32Array:case Int32Array:case Float32Array:g=
4;break;case Float64Array:g=8}return g},_decodeMask:function(K,g){var x=g.width*g.height;if(8*K.byteLength<x)return null;K=new Uint8Array(K,0,Math.ceil(x/8));g=new Uint8Array(g.width*g.height);var p=0,r=0,h=0,b=0;for(h=0;h<K.length-1;h++)for(r=K[h],b=7;0<=b;b--)g[p++]=r>>b&1;for(b=7;p<x-1;)r=K[K.length-1],g[p++]=r>>b&1,b--;return g}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(K,g){var x=function(){var b=new ArrayBuffer(4),a=new Uint8Array(b);b=new Uint32Array(b);
a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===b[0]},p=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]="CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";
b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";
b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]="INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";
b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]="YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34735]="GEOKEYDIRECTORY";b[34736]=
"GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";return b}(),r=[0,1,1,2,4,8,1,1,2,4,8,4,8],h=function(b,a){var c="UNKNOWN";3===b?c="F32":1===b?8>=a?c="U8":16>=a?c="U16":32>=a&&(c="U32"):2===b&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(b){var a=new DataView(b,0,8),c=a.getUint16(0,!1);if(18761===c)var l=!0;else if(19789===c)l=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,l))throw"unexpected tiff identifier";var k=a.getUint32(4,l);var n=l;var d,e;var u=
k;for(var z=[];u;){var A=(new DataView(b,u,2)).getUint16(0,n);var t=u+2;u=(new DataView(b,t+12*A,4)).getUint32(0,n);var w={};for(d=0;d<A;d++){var q=new DataView(b,t,12);var E=q.getUint16(0,n);var B=q.getUint16(2,n);var C=q.getUint32(4,n);var G=q.getUint32(8,n);t+=12;if(!(7===B||12<B)){var D=e={fieldTag:E,fieldType:B,fieldValueCount:C,fieldValueOffset:G},f=void 0,m=void 0,y=b,v=n,F=[],H=e.fieldType,L=e.fieldValueCount,N=e.fieldValueOffset,Q=N,R=r[H],W=8*R,Z=L*R,X=L*r[H]*8;if(32>=X)if(v||(N>>>=32-X),
1===L)F=[N];else for(f=0;f<L;f++)F.push(N<<W*f>>>32-W);else for(Q=N;Q<N+Z;Q+=R){switch(H){case 1:m=(new DataView(y,Q,1)).getUint8(0);break;case 2:m=(new DataView(y,Q,1)).getUint8(0);break;case 3:m=(new DataView(y,Q,2)).getUint16(0,v);break;case 4:m=(new DataView(y,Q,4)).getUint32(0,v);break;case 5:m=(new DataView(y,Q,4)).getUint32(0,v)/(new DataView(y,Q+4,4)).getUint32(0,v);break;case 6:m=(new DataView(y,Q,1)).getInt8(0);break;case 8:m=(new DataView(y,Q,2)).getInt16(0,v);break;case 9:m=(new DataView(y,
Q,4)).getInt32(0,v);break;case 10:m=(new DataView(y,Q,4)).getInt32(0,v)/(new DataView(y,Q+4,4)).getInt32(0,v);break;case 11:m=(new DataView(y,Q,4)).getFloat32(0,v);break;case 12:m=(new DataView(y,Q,8)).getFloat64(0,v);break;case 7:m=null;break;default:m=null}F.push(m)}if(2===H){var M="",U=F;F=[];for(f=0;f<U.length;f++)0===U[f]&&""!==M?(F.push(M),M=""):M+=String.fromCharCode(U[f]);""===M&&0!==F.length||F.push(M)}D.fieldValues=F;var T=w,V=p[E];void 0===V&&(V="unknown"+E);T[V]={type:B,values:e.fieldValues}}}z.push(w)}if(0===
z.length)throw"no valid image file directory";var I,J=z[0],O=void 0===J.GDAL_NODATA||null===J.GDAL_NODATA?null:parseFloat(J.GDAL_NODATA.values[0]);if(J.TILEOFFSETS){var S=x()===n,P=J.TILEOFFSETS?J.TILEOFFSETS.values:void 0;if(void 0===P)var Y=void 0;else{var aa=J.TILEBYTECOUNTS.values,ba=J.TILEWIDTH.values[0],ea=J.TILELENGTH.values[0],ca=J.IMAGEWIDTH.values[0],na=J.IMAGELENGTH.values[0],oa=ca*na,ma=J.BITSPERSAMPLE.values[0],ha=J.SAMPLESPERPIXEL.values[0],xa=J.SAMPLEFORMAT?J.SAMPLEFORMAT.values[0]:
1,Na=h(xa,ma);if(1!==(J.PLANARCONFIGURATION?J.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var sa=J.COMPRESSION?J.COMPRESSION.values[0]:1;if(1!==sa&&6!==sa&&8!==sa&&32946!==sa)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";if(3<xa)Y=void 0;else{if(3===xa){var ta=new Float32Array(oa*ha);var ya=Float32Array}else 1===xa?8>=ma?(ta=new Uint8Array(oa*
ha),ya=Uint8Array):16>=ma?(ta=new Uint16Array(oa*ha),ya=Uint16Array):32>=ma&&(ta=new Uint32Array(oa*ha),ya=Uint32Array):2===xa&&(8>=ma?(ta=new Int8Array(oa*ha),ya=Int8Array):16>=ma?(ta=new Int16Array(oa*ha),ya=Int16Array):32>=ma&&(ta=new Int32Array(oa*ha),ya=Int32Array));var fa,Ga,ka,Ha,Ta,Ya=Math.ceil(ca/ba);if(0===ma%8)for(fa=0;fa<P.length;fa++){var Za=Math.floor(fa/Ya)*ea;var $a=fa%Ya*ba;var ab=(Za*ca+$a)*ha;if("U8"===Na||"S8"===Na||S)if(8===sa||32946===sa){var ia=new Uint8Array(b,P[fa],aa[fa]);
var Ua=new g(ia);var bb=Ua.getBytes();var ua=new ArrayBuffer(bb.length);ia=new Uint8Array(ua);ia.set(bb);ia.length!==ba*ea*ha*ma/8&&console.log("tile byte counts is different than expected")}else if(6===sa){ia=new Uint8Array(b,P[fa],aa[fa]);var Oa=new K;Oa.parse(ia);var cb=Oa.getData(Oa.width,Oa.height);ua=new ArrayBuffer(cb.length);ia=new Uint8Array(ua);ia.set(cb)}else 1===sa&&(aa[fa]!==ba*ea*ha*ma/8&&console.log("tile byte counts is different than expected"),ua=b.slice(P[fa],P[fa]+aa[fa]));else{if(8===
sa||32946===sa){ia=new Uint8Array(b,P[fa],aa[fa]);Ua=new g(ia);ia=Ua.getBytes();ua=new ArrayBuffer(ia.length);var Ea=new Uint8Array(ua);ia.length!==ba*ea*ha*ma/8&&console.log("tile byte counts is different than expected")}else 1===sa&&(aa[fa]!==ba*ea*ha*ma/8&&console.log("tile byte counts is different than expected"),ua=new ArrayBuffer(aa[fa]),ia=new Uint8Array(b,P[fa],aa[fa]),Ea=new Uint8Array(ua));switch(Na){case "U16":case "S16":for(ka=0;ka<ia.length;ka+=2)Ea[ka]=ia[ka+1],Ea[ka+1]=ia[ka];break;
case "U32":case "S32":case "F32":for(ka=0;ka<ia.length;ka+=4)Ea[ka]=ia[ka+3],Ea[ka+1]=ia[ka+2],Ea[ka+2]=ia[ka+1],Ea[ka+3]=ia[ka]}}var hb=new ya(ua);var Va=0;var Wa=ab;var ib=Math.min(ba,ca-$a);var jb=Math.min(ea,na-Za);for(Ha=0;Ha<jb;Ha++)for(Wa=ab+Ha*ca*ha,Va=Ha*ba*ha,Ta=0;Ta<ib*ha;Ta++,Wa++,Va++)ta[Wa]=hb[Va]}var Pa={width:ca,height:na,pixelType:Na};if(1===ha)Pa.pixels=[ta];else for(Pa.pixels=[],fa=0;fa<ha;fa++){var db=new ya(oa);for(Ga=0;Ga<oa;Ga++)db[Ga]=ta[Ga*ha+fa];Pa.pixels.push(db)}Y=Pa}}}else if(J.STRIPOFFSETS){var kb=
x()===n,za=J.STRIPOFFSETS?J.STRIPOFFSETS.values:void 0;if(void 0===za)Y=void 0;else{var Aa=J.STRIPBYTECOUNTS.values,Ia=J.ROWSPERSTRIP.values,Ba=J.IMAGEWIDTH.values[0],Ja=J.IMAGELENGTH.values[0],Ca=Ba*Ja,qa=J.BITSPERSAMPLE.values[0],pa=J.SAMPLESPERPIXEL.values[0],Ka=J.SAMPLEFORMAT?J.SAMPLEFORMAT.values[0]:1,Qa=h(Ka,qa);if(1!==(J.PLANARCONFIGURATION?J.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var ra=J.COMPRESSION?
J.COMPRESSION.values[0]:1;if(1!==ra&&6!==ra&&8!==ra&&32946!==ra)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ka)Y=void 0;else{if(3===Ka){var va=new Float32Array(Ca*pa);var Da=Float32Array}else 1===Ka?8>=qa?(va=new Uint8Array(Ca*pa),Da=Uint8Array):16>=qa?(va=new Uint16Array(Ca*pa),Da=Uint16Array):32>=qa&&(va=new Uint32Array(Ca*pa),Da=Uint32Array):2===Ka&&(8>=qa?(va=new Int8Array(Ca*pa),Da=Int8Array):16>=qa?(va=new Int16Array(Ca*
pa),Da=Int16Array):32>=qa&&(va=new Int32Array(Ba*Ja*pa),Da=Int32Array));var da,La,la,Ma=Ia;if(0===qa%8)for(da=0;da<za.length;da++){var lb=da*Ia*Ba*pa;Ma=(da+1)*Ia>Ja?Ja-da*Ia:Ia;if("U8"===Qa||"S8"===Qa||kb)if(8===ra||32946===ra){var ja=new Uint8Array(b,za[da],Aa[da]);var Xa=new g(ja);var eb=Xa.getBytes();var wa=new ArrayBuffer(eb.length);ja=new Uint8Array(wa);ja.set(eb);ja.length!==Ma*Ba*pa*qa/8&&console.log("strip byte counts is different than expected")}else if(6===ra){ja=new Uint8Array(b,za[da],
Aa[da]);var Ra=new K;Ra.parse(ja);var fb=Ra.getData(Ra.width,Ra.height);wa=new ArrayBuffer(fb.length);ja=new Uint8Array(wa);ja.set(fb)}else 1===ra&&(Aa[da]!==Ma*Ba*pa*qa/8&&console.log("strip byte counts is different than expected"),wa=b.slice(za[da],za[da]+Aa[da]));else{if(6===ra||8===ra||32946===ra){ja=new Uint8Array(b,za[da],Aa[da]);Xa=new g(ja);ja=Xa.getBytes();wa=new ArrayBuffer(ja.length);var Fa=new Uint8Array(wa);ja.length!==Ma*Ba*pa*qa/8&&console.log("strip byte counts is different than expected")}else 1===
ra&&(Aa[da]!==Ma*Ba*pa*qa/8&&console.log("strip byte counts is different than expected"),wa=new ArrayBuffer(Aa[da]),ja=new Uint8Array(b,za[da],Aa[da]),Fa=new Uint8Array(wa));switch(Qa){case "U16":case "S16":for(la=0;la<ja.length;la+=2)Fa[la]=ja[la+1],Fa[la+1]=ja[la];break;case "U32":case "S32":case "F32":for(la=0;la<ja.length;la+=4)Fa[la]=ja[la+3],Fa[la+1]=ja[la+2],Fa[la+2]=ja[la+1],Fa[la+3]=ja[la]}}var mb=new Da(wa);va.set(mb,lb)}var Sa={width:Ba,height:Ja,pixelType:Qa};if(1===pa)Sa.pixels=[va];
else for(Sa.pixels=[],da=0;da<pa;da++){var gb=new Da(Ca);for(La=0;La<Ca;La++)gb[La]=va[La*pa+da];Sa.pixels.push(gb)}Y=Sa}}}if(null!==O){Y.maskData=new Uint8Array(Y.width*Y.height);if(1E24<Math.abs(O))for(I=0;I<Y.width*Y.height;I++)Y.maskData[I]=1E-6>Math.abs((Y.pixels[0][I]-O)/O)?0:1;else for(I=0;I<Y.width*Y.height;I++)Y.maskData[I]=Y.pixels[0][I]===O?0:1;Y.noDataValue=O}return Y}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n){function d(e){var u=new p;r(e).then(function(z){u.resolve()});return u.promise}return function(){function e(u){this.customModules=u&&u.customModules}e.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};e.prototype.start=function(){this.stop();var u=new p,z=0,A=this.customModules?this.customModules.length+1:1,t=c.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",K,x),w=b.open(t,{client:this}).then(function(q){this._connection=q;z++;
z===A&&(this._connected=!0,u.resolve())}.bind(this));this._openDL=[w];this.customModules&&this.customModules.forEach(function(q){w=b.open(q,{client:this}).then(function(E){z++;z===A&&(this._connected=!0,u.resolve())});this._openDL.push(w);console.log(q)}.bind(this));return this._connectionPromise=u.promise};e.prototype.stop=function(){this._openDL?this._openDL.forEach(function(u){u.isFulfilled()||u.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();
this._connection&&(this._connection.close(),this._connection=null)};e.prototype.decode=function(u){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var z={id:null};return this._connection.invoke("decode",u,[],z).then(function(A){A.targetWorker=z;return A})};e.prototype.process=function(u){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var z={id:null};u.layerId=this.rasterLayer.layerId;var A=new p;
this._connection.invoke("process",u,[],z).then(function(t){t.targetWorker=z;t.src?Object.keys(t.src).forEach(function(w){t.src[w].pixelBlock=new h(t.src[w].pixelBlock)}):t.src=null;t.pixelBlock&&(t.pixelBlock=new h(t.pixelBlock));A.resolve(t)});return A.promise};e.prototype.render=function(u){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var z={id:null};u.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",u,[],z).then(function(A){A.targetWorker=
z;A.pixelBlock=A.pixelBlock?new h(A.pixelBlock):null;return A})};e.prototype.setLayer=function(u){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));this.rasterLayer=u;u=this._connection.broadcast("setLayer",u,[],{id:null});return d(u)};e.prototype.setRasterFunction=function(u){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));u=this._connection.broadcast("setRasterFunction",u,[],{id:null});return d(u)};
e.prototype.setRasterRenderer=function(u){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));u=this._connection.broadcast("setRasterRenderer",u,[],{id:null});return d(u)};return e}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(K,g,x){Object.defineProperty(g,"__esModule",{value:!0});for(var p in x)g.hasOwnProperty(p)||(g[p]=x[p])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(K,g,x,p,r,h,b,a,c){function l(){if(z)return z;for(var A=k+n,t=[],w=function(E){var B=c.create(E).then(function(C){return u[E]=C});t.push(B)},q=0;q<A;q++)w(q);return z=p(t).then(function(){})}Object.defineProperty(g,"__esModule",{value:!0});g.Connection=b;g.RemoteClient=a;(b=navigator.hardwareConcurrency)||(b=x("safari")&&x("mac")||x("trident")?8:2);var k=x("esri-workers-debug")?1:Math.max(1,Math.ceil(b/2)),n=x("esri-workers-debug")?1:Math.max(1,Math.floor(b/2)),d=r.getLogger("esri.core.workers"),
e=0,u=[];g.initialize=function(){l()};g.open=function(A,t,w){void 0===t&&(t={});if(Array.isArray(A))return new g.Connection(A.map(function(B){return new g.RemoteClient(B,t.client)}));if("string"!==typeof A){d.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var q=A;A=t;t={client:q,strategy:w?"dedicated":"distributed"}}var E=t.strategy||"distributed";return"local"===E?h.create(function(B){K([A],function(C){B(g.RemoteClient.connect(C))})}).then(function(B){return new g.Connection([new g.RemoteClient(B,
t.client)])}):l().then(function(){if("dedicated"===E){var B=k+e++;e%=n;return u[B].open(A).then(function(C){return new g.Connection([new g.RemoteClient(C,t.client)])})}return h.all(u.map(function(C){return C.open(A)})).then(function(C){return new g.Connection(C.map(function(G){return new g.RemoteClient(G,t.client)}))})})};g.terminate=function(){for(var A=0;A<u.length;A++)u[A]&&u[A].terminate();u.length=0};var z})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(K,g,x){var p={info:0,warn:1,error:2};K=function(){function r(h){void 0===h&&(h={});this.module=h.module||"";this.writer=h.writer||null;this.level=h.level||null;null!=h.enabled&&(this.enabled=!!h.enabled);r._loggers[this.module]=this;h=this.module.lastIndexOf(".");-1!==h&&(this.parent=r.getLogger(this.module.slice(0,h)))}r.prototype.log=function(h){for(var b=[],a=1;a<arguments.length;a++)b[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(h)&&(a=this._inheritedWriter())&&a.apply(void 0,
[h,this.module].concat(b))};r.prototype.error=function(){for(var h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];this.log.apply(this,["error"].concat(h))};r.prototype.warn=function(){for(var h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];this.log.apply(this,["warn"].concat(h))};r.prototype.info=function(){for(var h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];this.log.apply(this,["info"].concat(h))};r.prototype.getLogger=function(h){return r.getLogger(this.module+"."+h)};r.getLogger=function(h){var b=
r._loggers[h];b||(b=new r({module:h}));return b};r.prototype._parentWithMember=function(h,b){for(var a=this;a&&null==a[h];)a=a.parent;return a?a[h]:b};r.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};r.prototype._consoleWriter=function(h,b){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];console[h].apply(console,["["+b+"]"].concat(a))};r.prototype._matchLevel=function(h){return p[this._parentWithMember("level","error")]<=p[h]};r.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};r._loggers={};return r}();g=K.getLogger("esri");x("dojo-debug-messages")?g.level="info":g.level="warn";return K})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(K,g,x,p,r,h){function b(a){if(a){if("function"!==typeof a.forEach){var c=Object.keys(a),l=c.map(function(e){return a[e]});return b(l).then(function(e){var u={};c.forEach(function(z,
A){return u[z]=e[A]});return u})}var k=new x,n=[],d=a.length;0===d&&k.resolve(n);a.forEach(function(e){var u={promise:e};n.push(u);e.then(function(z){u.value=z}).catch(function(z){u.error=z}).then(function(){--d;0===d&&k.resolve(n)})});return k.promise}}Object.defineProperty(g,"__esModule",{value:!0});g.all=function(a){return r(a)};g.filter=function(a,c){var l=a.slice();return r(a.map(function(k,n){return c(k,n)})).then(function(k){return l.filter(function(n,d){return k[d]})})};g.eachAlways=b;g.create=
function(a,c){var l=new x(c);a(function(k){void 0===k&&(k=null);return p(k).then(l.resolve)},l.reject);return l.promise};g.reject=function(a){var c=new x;c.reject(a);return c.promise};g.resolve=function(a){void 0===a&&(a=null);var c=new x;c.resolve(a);return c.promise};g.after=function(a,c){void 0===c&&(c=null);var l=0,k=new x(function(){l&&(clearTimeout(l),l=0)});l=setTimeout(function(){k.resolve(c)},a);return k.promise};g.timeout=function(a,c,l){var k=0,n=new x(a.cancel);a.then(function(d){n.isFulfilled()||
(n.resolve(d),k&&(clearTimeout(k),k=0))});a.catch(function(d){n.isFulfilled()||(n.reject(d),k&&(clearTimeout(k),k=0))});k=setTimeout(function(){var d=l||new h("promiseUtils:timeout","The wrapped promise did not resolve within "+c+" ms");n.reject(d)},c);return n.promise};g.wrapCallback=function(a){var c=!1,l=new x(function(){return c=!0});a(function(k){c||l.resolve(k)});return l.promise};g.isThenable=function(a){return a&&"function"===typeof a.then};g.when=function(a){return p(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(K,g,x,p,r){K=function(h){function b(a,c,l){var k=h.call(this,a,c,l)||this;return k instanceof b?k:new b(a,c,l)}x(b,h);b.prototype.toJSON=function(){return{name:this.name,message:this.message,details:p.clone(this.details),dojoType:this.dojoType}};b.fromJSON=function(a){var c=new b(a.name,a.message,a.details);null!=a.dojoType&&(c.dojoType=a.dojoType);return c};return b}(r);K.prototype.type="error";return K})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,x){g.__proto__=x}||function(g,x){for(var p in x)x.hasOwnProperty(p)&&(g[p]=x[p])};return function(g,x){function p(){this.constructor=g}K(g,x);g.prototype=null===x?Object.create(x):(p.prototype=x.prototype,new p)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(K,g,x,p,
r,h){function b(e){return void 0!==e&&null!==e}function a(e){return b(e)?e:""}function c(e,u,z){var A=z.match(/([^\(]+)(\([^\)]+\))?/i),t=g.trim(A[1]);z=u[e];A=JSON.parse((A[2]?g.trim(A[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var w=A.utcOffset;if(-1===n.indexOf(t))t=g.getObject(t),g.isFunction(t)&&(z=t(z,e,u,A));else if("number"===typeof z||"string"===typeof z&&z&&!isNaN(Number(z)))switch(z=
Number(z),t){case "NumberFormat":e=g.mixin({},A);u=parseFloat(e.places);if(isNaN(u)||0>u)e.places=Infinity;return p.format(z,e);case "DateString":z=new Date(z);if(A.local||A.systemLocale)return A.systemLocale?z.toLocaleDateString()+(A.hideTime?"":" "+z.toLocaleTimeString()):z.toDateString()+(A.hideTime?"":" "+z.toTimeString());z=z.toUTCString();A.hideTime&&(z=z.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return z;case "DateFormat":return z=new Date(z),b(w)&&(z=x.add(z,"minute",z.getTimezoneOffset()-
w)),r.format(z,A)}return a(z)}function l(e,u){var z;if(u)for(z in e)e.hasOwnProperty(z)&&(void 0===e[z]?delete e[z]:e[z]instanceof Object&&l(e[z],!0));else for(z in e)e.hasOwnProperty(z)&&void 0===e[z]&&delete e[z];return e}function k(e){if(!e||"object"!=typeof e||g.isFunction(e))return e;if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||
e instanceof Float64Array||e instanceof Date)return new e.constructor(e);if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if("function"===typeof e.clone)e=e.clone();else if("function"===typeof e.map&&"function"===typeof e.forEach)e=e.map(k);else if("function"===typeof e.notifyChange&&"function"===typeof e.watch)e=e.clone();else{var u={},z,A={};for(z in e){var t=e[z];var w=!(z in A)||A[z]!==t;if(!(z in u)||u[z]!==t&&w)u[z]=k?k(t):t}e=u}return e}var n=["NumberFormat","DateString","DateFormat"],
d=/<\/?[^>]+>/g;return{equals:function(e,u){return e===u||"number"===typeof e&&isNaN(e)&&"number"===typeof u&&isNaN(u)||g.isFunction((e||{}).getTime)&&g.isFunction((u||{}).getTime)&&e.getTime()==u.getTime()||g.isFunction((e||{}).equals)&&e.equals(u)||g.isFunction((u||{}).equals)&&u.equals(e)||!1},mixin:g.mixin,valueOf:function(e,u){for(var z in e)if(e[z]==u)return z;return null},stripTags:function(e){if(e){var u=typeof e;if("string"===u)e=e.replace(d,"");else if("object"===u)for(var z in e)(u=e[z])&&
"string"===typeof u&&(u=u.replace(d,"")),e[z]=u}return e},substitute:function(e,u,z){if(b(z))if(g.isObject(z)){var A=z.first;var t=z.dateFormat;var w=z.numberFormat}else A=z;if(u&&"{*}"!==u)return g.replace(u,g.hitch({obj:e},function(E,B){E=B.split(":");return 1<E.length?(B=E[0],E.shift(),c(B,this.obj,E.join(":"))):t&&-1!==(t.properties||[]).indexOf(B)?c(B,this.obj,t.formatter||"DateString"):w&&-1!==(w.properties||[]).indexOf(B)?c(B,this.obj,w.formatter||"NumberFormat"):a(this.obj[B])}));u=[];var q;
u.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+h.fieldsSummary+'"\x3e\x3ctbody\x3e');for(q in e)if(z=e[q],t&&-1!==(t.properties||[]).indexOf(q)?z=c(q,e,t.formatter||"DateString"):w&&-1!==(w.properties||[]).indexOf(q)&&(z=c(q,e,w.formatter||"NumberFormat")),u.push("\x3ctr\x3e\x3cth\x3e"+q+"\x3c/th\x3e\x3ctd\x3e"+a(z)+"\x3c/td\x3e\x3c/tr\x3e"),A)break;u.push("\x3c/tbody\x3e\x3c/table\x3e");return u.join("")},filter:function(e,u,z){u=[g.isString(e)?e.split(""):e,z||K.global,g.isString(u)?
new Function("item","index","array",u):u];z={};var A;e=u[0];for(A in e)u[2].call(u[A],e[A],A,e)&&(z[A]=e[A]);return z},startsWith:function(e,u,z){z=z||0;return e.indexOf(u,z)===z},endsWith:function(e,u,z){if("number"!==typeof z||!isFinite(z)||Math.floor(z)!==z||z>e.length)z=e.length;z-=u.length;e=e.indexOf(u,z);return-1!==e&&e===z},isDefined:b,fixJson:l,clone:k}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(K,g,x){return function(){function p(r,
h,b){this instanceof p&&(this.name=r,this.message=h&&x.substitute(h,b,function(a){return null==a?"":a})||"",this.details=b)}p.prototype.toString=function(){return"["+this.name+"]: "+this.message};return p}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(K,g,x){return function(){function p(r){this._clientIdx=0;this._clients=r}p.prototype.broadcast=function(r,h,b){for(var a=[],c=0,l=this._clients;c<l.length;c++)a.push(l[c].invoke(r,
h,b));return a};p.prototype.close=function(){for(var r=0,h=this._clients;r<h.length;r++)h[r].close();this._clients=[]};p.prototype.invoke=function(r,h,b,a){var c=a&&a.client;if(!this._clients||!this._clients.length)return x.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(l){return l.isBusy()?!1:(c=l,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);r=c.invoke(r,h,b);a&&(a.client=c);return r};p.prototype.openPorts=
function(){return x.all(this._clients.map(function(r){return r.openPort()}))};return p}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(K,g,x,p,r,h){function b(e,u){e["delete"](u)}var a=h.MessageType.CLOSE,c=h.MessageType.CANCEL,l=h.MessageType.INVOKE,k=h.MessageType.RESPONSE,n=h.MessageType.OPEN_PORT,d=function(){function e(u){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=u;this._timer=null;this._process=this._process.bind(this)}e.prototype.push=function(u){u.type===h.MessageType.CANCEL?this._cancelledJobIds.add(u.jobId):(this._invokeMessages.push(u),null===this._timer&&(this._timer=setTimeout(this._process,0)))};e.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};e.prototype._process=function(){this._timer=null;for(var u=0,z=this._invokeMessages;u<z.length;u++){var A=z[u];this._cancelledJobIds.has(A.jobId)||
this._invoke(A)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return e}();return function(){function e(u,z,A){this._outJobs=new Map;this._inJobs=new Map;this._queue=new d(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=z;this._port=u;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=A}e.connect=function(u){var z=new MessageChannel;u="function"===typeof u?new u:"default"in u&&"function"===typeof u.default?new u.default:
u;u.remoteClient=new e(z.port1,u,z);return z.port2};e.prototype.close=function(){this._post({type:a});this._close()};e.prototype.isBusy=function(){return 0<this._outJobs.size};e.prototype.invoke=function(u,z,A){var t=this;if(!this._port)return r.reject(new p("remote-client:port-closed","Can't invoke(), port is closed"));var w=h.newJobId(),q=new x(function(){b(t._outJobs,w);t._post({type:c,jobId:w})});this._outJobs.set(w,q);this._post({type:l,jobId:w,methodName:u},z,A);return q.promise};e.prototype.openPort=
function(){var u=this,z=h.newJobId(),A=new x(function(){b(u._outJobs,z);u._post({type:c,jobId:z})});this._outJobs.set(z,A);this._post({type:n,jobId:z});return A.promise};e.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(u){u.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};e.prototype._onMessage=function(u){if(u=h.receiveMessage(u))switch(u.type){case k:this._onResponse(u);
break;case l:this._queue.push(u);break;case c:this._onCancel(u);break;case a:this._close();break;case n:this._onOpenPort(u)}};e.prototype._onCancel=function(u){var z=this._inJobs,A=u.jobId,t=z.get(A);this._queue.push(u);t&&(b(z,A),t.cancel())};e.prototype._onInvoke=function(u){var z=this,A=u.methodName,t=u.jobId;u=u.data;var w=this._inJobs,q=this._client,E=q[A];try{if(!E&&A&&-1!==A.indexOf("."))for(var B=A.split("."),C=0;C<B.length-1;C++)q=q[B[C]],E=q[B[C+1]];if("function"!==typeof E)throw new TypeError(A+
" is not a function");var G=E.call(q,u,this)}catch(D){this._post({type:k,jobId:t,error:h.toInvokeError(D)});return}r.isThenable(G)?(w.set(t,G),G.then(function(D){w.has(t)&&(b(w,t),z._post({type:k,jobId:t},D))}).catch(function(D){w.has(t)&&(b(w,t),D&&"cancel"===D.dojoType||z._post({type:k,jobId:t,error:h.toInvokeError(D||{message:"Error encountered at method "+A})}))})):this._post({type:k,jobId:t},G)};e.prototype._onOpenPort=function(u){var z=new MessageChannel;new e(z.port1,this._client);this._post({type:k,
jobId:u.jobId},z.port2,[z.port2])};e.prototype._onResponse=function(u){var z=u.jobId,A=u.error;u=u.data;var t=this._outJobs;if(t.has(z)){var w=t.get(z);b(t,z);A?w.reject(p.fromJSON(JSON.parse(A))):w.resolve(u)}};e.prototype._post=function(u,z,A){return h.postMessage(this._port,u,z,A)};return e}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(K,g,x){function p(h){return h&&"object"===typeof h&&("result"in h||"transferList"in h)}Object.defineProperty(g,
"__esModule",{value:!0});(function(h){h[h.HANDSHAKE=0]="HANDSHAKE";h[h.CONFIGURE=1]="CONFIGURE";h[h.CONFIGURED=2]="CONFIGURED";h[h.OPEN=3]="OPEN";h[h.OPENED=4]="OPENED";h[h.RESPONSE=5]="RESPONSE";h[h.INVOKE=6]="INVOKE";h[h.CANCEL=7]="CANCEL";h[h.CLOSE=8]="CLOSE";h[h.OPEN_PORT=9]="OPEN_PORT"})(g.MessageType||(g.MessageType={}));var r=0;g.newJobId=function(){return r++};g.isTranferableResult=p;g.toInvokeError=function(h){return h?h.toJSON?JSON.stringify(h):JSON.stringify({name:h.name,message:h.message,
details:h.details,stack:h.stack}):null};g.postMessage=function(h,b,a,c){2===arguments.length||void 0===a&&void 0===c?h.postMessage(b):(x("esri-workers-supports-transfer-arraybuffer")||(c?(c=c.filter(function(l){return!(l instanceof ArrayBuffer)}),c.length||(c=null)):p(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(l){return!(l instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),c?(b.data=a,h.postMessage(b,c)):p(a)?(b.data=a.result,a.transferList?h.postMessage(b,
a.transferList):h.postMessage(b)):(b.data=a,h.postMessage(b)))};g.receiveMessage=function(h){return h?(h=h.data)?"string"===typeof h?JSON.parse(h):h:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(K,g,x,p,r,h,b,a,c){var l=h.getLogger("esri.core.workers"),k=a.MessageType.CANCEL,n=a.MessageType.INVOKE,d=a.MessageType.OPEN,e=a.MessageType.OPENED,
u=a.MessageType.RESPONSE;return function(){function z(A,t){this._outJobs=new Map;this._inJobs=new Map;this.worker=A;this.id=t;A.addEventListener("message",this._onMessage.bind(this));A.addEventListener("error",function(w){w.preventDefault();l.error(w)})}z.create=function(A){return c.createWorker().then(function(t){return new z(t,A)})};z.prototype.terminate=function(){this.worker.terminate()};z.prototype.open=function(A){var t=this,w=a.newJobId(),q=new x(function(E){t._outJobs["delete"](w);t._post({type:k,
jobId:w})});this._outJobs.set(w,q);this._post({type:d,jobId:w,modulePath:A});return q.promise};z.prototype._onMessage=function(A){if(A=a.receiveMessage(A))switch(A.type){case e:case u:this._onResponse(A);break;case k:this._onCancel(A);break;case n:this._onInvoke(A)}};z.prototype._onCancel=function(A){(A=this._inJobs.get(A.jobId))&&A.cancel()};z.prototype._onInvoke=function(A){var t=this,w=A.methodName,q=A.jobId;A=A.data;var E=this._inJobs,B=p.workerMessages[w];try{if("function"!==typeof B)throw new TypeError(w+
" is not a function");var C=B.call(null,A)}catch(G){this._post({type:u,jobId:q,error:a.toInvokeError(G)});return}b.isThenable(C)?(E.set(q,C),C.then(function(G){E["delete"](q);t._post({type:u,jobId:q},G)}).catch(function(G){E["delete"](q);G||(G={message:"Error encountered at method"+w});G.dojoType&&"cancel"===G.dojoType||t._post({type:u,jobId:q,error:a.toInvokeError(G)})})):this._post({type:u,jobId:q},C)};z.prototype._onResponse=function(A){var t=A.jobId,w=A.error;A=A.data;var q=this._outJobs.get(t);
q&&(this._outJobs["delete"](t),w?q.reject(r.fromJSON(JSON.parse(w))):q.resolve(A))};z.prototype._post=function(A,t,w){return a.postMessage(this.worker,A,t,w)};return z}()})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(K,g,x,p,r,h,b,a,c,l,k,n,d){function e(B){return a.create(function(C){function G(f){if(f=
n.receiveMessage(f))switch(f.type){case E:f=B;var m=r.workers.loaderUrl||k.DEFAULT_LOADER_URL;if(null!=r["default"]){var y=x({},r);delete y["default"];y=JSON.parse(JSON.stringify(y))}else y=JSON.parse(JSON.stringify(r));var v=r.workers.loaderConfig;v=k.default({baseUrl:v.baseUrl,locale:p.locale,has:x({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":c("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":c("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},v.has),map:x({},v.map),paths:x({},v.paths),packages:v.packages||[]});f.postMessage({type:q,configure:{esriConfig:y,loaderUrl:m,loaderConfig:v}});break;case w:B.removeEventListener("message",G),B.removeEventListener("error",D),C(B)}}function D(f){f.preventDefault();B.removeEventListener("message",G);B.removeEventListener("error",D);A.warn("Failed to create Worker. Fallback to execute module in main thread",f);B=new d;B.addEventListener("message",G);B.addEventListener("error",
D)}B.addEventListener("message",G);B.addEventListener("error",D)})}Object.defineProperty(g,"__esModule",{value:!0});var u=l.normalize(K.toUrl("./worker.js")),z=!l.hasSameOrigin(u,location.href),A=b.getLogger("esri.core.workers"),t=null,w=n.MessageType.CONFIGURED,q=n.MessageType.CONFIGURE,E=n.MessageType.HANDSHAKE;g.createWorker=function(){if(!c("esri-workers"))return e(new d);if(!z){var B=void 0;try{B=new Worker(u)}catch(C){A.warn("Failed to create Worker. Fallback to execute module in main thread",
event),B=new d}return e(B)}t||(t=h(u,{responseType:"text"}));return t.then(function(C){return new Worker(URL.createObjectURL(new Blob([C.data],{type:"text/javascript"})))}).catch(function(C){A.warn("Failed to create Worker. Fallback to execute module in main thread",C);return new d}).then(function(C){return e(C)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(K){for(var g,x=1,p=arguments.length;x<p;x++){g=arguments[x];for(var r in g)Object.prototype.hasOwnProperty.call(g,
r)&&(K[r]=g[r])}return K}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(K,g,x){Object.defineProperty(x,"workers",{get:function(){return x.defaults.workers},set:function(p){return x.defaults.workers=p}});return x})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(K,g,x,p,r){return function(h,b){h=p.mixin({},{url:h,failOk:!0},b);"array-buffer"===b.responseType?(h.handleAs=
"arraybuffer",delete h.responseType):b.responseType&&(h.handleAs=b.responseType,delete h.responseType);null!==b.query&&(h.content=h.query,delete h.query);if(b.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:b.allowImageDataAccess};delete h.allowImageDataAccess}var c=new r(function(){l.isFulfilled()||l.cancel()});var l=x(h,a).then(function(k){c.resolve({data:k})}).catch(function(k){k&&null!=k.httpCode&&(k.details=k.details||{},k.details.httpStatus=k.httpCode);c.reject(k)});return c.promise}})},
"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(K,g,x,p,r){function h(){var l={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},k=document.createElement("canvas");if(!k)return l;var n=r.createContext(k,{failIfMajorPerformanceCaveat:!0},"webgl");!n&&(n=r.createContext(k,{},"webgl"))&&
(l.majorPerformanceCaveat=!0);if(!n)return l;k=n.getParameter(n.VERSION);if(!k)return l;if(k=k.match(/^WebGL\s+([\d.]*)/))l.version=parseFloat(k[1]),l.available=.94<=l.version,k=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),l.supportsHighPrecisionFragment=k&&0<k.precision,l.supportsVertexShaderSamplers=0<n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l.supportsElementIndexUint=null!==n.getExtension("OES_element_index_uint"),l.supportsStandardDerivatives=null!==n.getExtension("OES_standard_derivatives");
return l}function b(){var l={available:!1,version:0},k=document.createElement("canvas");if(!k)return l;k=r.createContext(k,{},"webgl2");if(!k)return l;l.available=!0;k=k.getParameter(k.VERSION);if(!k)return l;if(k=k.match(/^WebGL\s+([\d.]*)/))l.version=parseFloat(k[1]);return l}(function(){var l=navigator.userAgent,k=l.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);l=l.match(/iPhone/i);k&&x.add("esri-mobile",k);l&&x.add("esri-iPhone",l);x.add("esri-phonegap",!!p.cordova);
x.add("esri-cors",x("esri-phonegap")||"XMLHttpRequest"in p&&"withCredentials"in new XMLHttpRequest);x.add("esri-geolocation",function(){return!!navigator.geolocation});x.add("esri-canvas-svg-support",function(){return!(x("trident")||x("ie"))});x.add("esri-secure-context",function(){if("isSecureContext"in p)return p.isSecureContext;if(p.location&&p.location.origin)return 0===p.location.origin.indexOf("https:")});x.add("esri-wasm","WebAssembly"in p);x("host-webworker")||(x.add("esri-workers","Worker"in
p),x.add("esri-script-sandbox",function(){return"MessageChannel"in p&&"HTMLIFrameElement"in p&&"sandbox"in HTMLIFrameElement.prototype}),x.add("esri-url-encodes-apostrophe",function(){var n=p.document.createElement("a");n.href="?'";return-1<n.href.indexOf("?%27")}),a||(a=h()),x.add("esri-webgl",a.available),x.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),x.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),x.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
x.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),x.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),x.add("esri-featurelayer-webgl-labeling",!0),c||(c=b()),x.add("esri-webgl2",c.available))})();var a=null,c=null;return x})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(K,g){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(K,g){function x(b,a,c){void 0===a&&(a={});switch(c){case "webgl":var l=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":l=["webgl2"];break;default:l=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}c=null;for(var k=0;k<l.length;k++){var n=l[k];try{c=b.getContext(n,a)}catch(d){}if(c)break}return c}function p(b,a){(b=b.parentNode)&&(b.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(g,"__esModule",{value:!0});g.createContextOrErrorHTML=function(b,a,c){void 0===a&&(a={});if(!window.WebGLRenderingContext)return p(b,r),null;a=x(b,a,c);return a?a:(p(b,h),null)};g.createContext=x;var r='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',h='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(K,g,x,p){function r(q){return x.normalize(q)}function h(q){return"data:"===q.slice(0,5)}function b(q){return a(q)||t.test(q)}function a(q){return q&&"/"===q[0]&&"/"===q[1]}function c(q){return x.urlToObject(q)}function l(q){if("string"===typeof q)return new p(n(q));q.scheme||(q.scheme=g.appUrl.scheme);return q}function k(q){if(h(q))return null;var E=q.indexOf("://");if(-1===E&&
a(q))E=2;else if(-1!==E)E+=3;else return null;E=q.indexOf("/",E);return-1===E?q:q.slice(0,E)}function n(q,E,B){void 0===E&&(E=g.appBaseUrl);if(a(q))return B&&B.preserveProtocolRelative?q:"http"===g.appUrl.scheme&&g.appUrl.authority===k(q).slice(2)?"http:"+q:"https:"+q;if(t.test(q))return q;B=e;if("/"===q[0]){var C=E.indexOf("//");C=E.indexOf("/",C+2);E=-1===C?E:E.slice(0,C)}return B(E,q)}function d(q,E,B){void 0===B&&(B=!1);q=l(q);E=l(E);return B||q.scheme===E.scheme?q.host.toLowerCase()===E.host.toLowerCase()&&
q.port===E.port:!1}function e(){for(var q=[],E=0;E<arguments.length;E++)q[E]=arguments[E];if(q&&q.length){E=[];if(b(q[0])){var B=q[0],C=B.indexOf("//");E.push(B.slice(0,C+1));A.test(q[0])&&(E[0]+="/");q[0]=B.slice(C+2)}else"/"===q[0][0]&&E.push("");q=q.reduce(function(G,D){return D?G.concat(D.split("/")):G},[]);for(B=0;B<q.length;B++)C=q[B],".."===C&&0<E.length?E.pop():!C||"."===C&&0!==E.length||E.push(C);return E.join("/")}}function u(q,E,B){if(!(E&&B&&q&&b(q)))return q;var C=q.indexOf("//"),G=q.indexOf("/",
C+2),D=q.indexOf(":",C+2);G=Math.min(0>G?q.length:G,0>D?q.length:D);if(q.slice(C+2,G).toLowerCase()!==E.toLowerCase())return q;E=q.slice(0,C+2);q=q.slice(G);return""+E+B+q}function z(q,E,B){void 0===E&&(E=g.appBaseUrl);if(!b(q))return q;var C=r(q),G=C.toLowerCase();E=r(E).toLowerCase().replace(/\/+$/,"");if((B=B?r(B).toLowerCase().replace(/\/+$/,""):null)&&0!==E.indexOf(B))return q;for(var D=function(y,v,F){F=y.indexOf(v,F);return-1===F?y.length:F},f=D(G,"/",G.indexOf("//")+2),m=-1;G.slice(0,f+1)===
E.slice(0,f)+"/";){m=f+1;if(f===G.length)break;f=D(G,"/",f+1)}if(-1===m||B&&m<B.length)return q;q=C.slice(m);C=E.slice(m-1).replace(/[^/]+/g,"").length;if(0<C)for(G=0;G<C;G++)q="../"+q;else q="./"+q;return q}Object.defineProperty(g,"__esModule",{value:!0});g.normalize=r;g.canUseXhr=function(q){return x.canUseXhr(q)};g.removeTrailingSlash=function(q){return q.replace(/\/+$/,"")};K=Function("return this")();g.appUrl=new p(K.location);g.appBaseUrl=function(){var q=g.appUrl.path;q=q.substring(0,q.lastIndexOf(q.split("/")[q.split("/").length-
1]));return g.appUrl.scheme+"://"+g.appUrl.host+(null!=g.appUrl.port?":"+g.appUrl.port:"")+q}();var A=/^\s*file:/i,t=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;g.isDataProtocol=h;g.isAbsolute=b;g.isProtocolRelative=a;g.urlToObject=c;g.getOrigin=k;g.makeAbsolute=n;g.hasSameOrigin=d;g.join=e;g.removeFile=function(q){var E=0;if(b(q)){var B=q.indexOf("//");-1!==B&&(E=B+2)}B=q.lastIndexOf("/");return B<E?q:q.slice(0,B+1)};g.addProxy=function(q){return x.addProxy(q)};g.makeData=function(q){return q.isBase64?"data:"+
q.mediaType+";base64,"+q.data:"data:"+q.mediaType+","+q.data};var w=/^data:(.*?)(;base64)?,(.*)$/;g.dataComponents=function(q){return(q=q.match(w))?{mediaType:q[1],isBase64:!!q[2],data:q[3]}:null};g.changeDomain=u;g.read=function(q,E){var B=E&&E.url&&E.url.path;q&&B&&(q=n(q,B,{preserveProtocolRelative:!0}));(E=E&&E.portal)&&!E.isPortal&&E.urlKey&&E.customBaseUrl?(B=E.urlKey+"."+E.customBaseUrl,E=d(g.appUrl,g.appUrl.scheme+"://"+B)?u(q,E.portalHostname,B):u(q,B,E.portalHostname)):E=q;return E};g.write=
function(q,E){if(!q)return q;!b(q)&&E&&E.blockedRelativeUrls&&E.blockedRelativeUrls.push(q);var B=n(q);if(E){var C=E.verifyItemRelativeUrls&&E.verifyItemRelativeUrls.rootPath||E.url&&E.url.path;C&&(B=z(B,C,C),B!==q&&E.verifyItemRelativeUrls&&E.verifyItemRelativeUrls.writtenUrls.push(B))}q=B;B=(E=E&&E.portal)&&!E.isPortal&&E.urlKey&&E.customBaseUrl?u(q,E.urlKey+"."+E.customBaseUrl,E.portalHostname):q;return B};g.makeRelative=z;g.removeQueryParameters=function(q){q=c(q);Object.keys(q.query||{});return q.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(K,g,x,p,r){Object.defineProperty(g,"__esModule",{value:!0});g.DEFAULT_LOADER_URL=r.makeAbsolute(r.removeQueryParameters(K.toUrl("./worker-init.js")));g.DEFAULT_CONFIG={baseUrl:function(){var h=r.removeQueryParameters(K.toUrl("dojo/x.js"));return r.makeAbsolute(h.slice(0,h.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};g.default=
function(h){var b={async:h.async,isDebug:h.isDebug,locale:h.locale,baseUrl:h.baseUrl,has:x({},h.has),map:x({},h.map),packages:h.packages&&h.packages.concat()||[],paths:x({},h.paths)};h.hasOwnProperty("async")||(b.async=!0);h.hasOwnProperty("isDebug")||(b.isDebug=!1);h.baseUrl||(b.baseUrl=g.DEFAULT_CONFIG.baseUrl);g.DEFAULT_CONFIG.packages.forEach(function(k){a:{for(var n=b.packages,d=0;d<n.length;d++)if(n[d].name===k.name)break a;k=x({},k);d=r.removeQueryParameters(K.toUrl(k.name+"/x.js"));d=d.slice(0,
d.length-5);k.location=r.makeAbsolute(d);n.push(k)}});h=b.map=b.map||{};for(var a=0,c=Object.keys(g.DEFAULT_CONFIG.map);a<c.length;a++){var l=c[a];h[l]||(h[l]=g.DEFAULT_CONFIG.map[l])}return b}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(K,g,x,p,r){var h=function(){return function(){var c=this,l=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(k){c[k]=
function(){for(var n=[],d=0;d<arguments.length;d++)n[d]=arguments[d];return l[k].apply(l,n)}})}}(),b=p.MutationObserver||p.WebKitMutationObserver,a=function(){if(p.process&&p.process.nextTick)var c=function(n){p.process.nextTick(n)};else if(p.Promise)c=function(n){p.Promise.resolve().then(n)};else if(b){var l=[],k=document.createElement("div");(new b(function(){for(;0<l.length;)l.shift()()})).observe(k,{attributes:!0});c=function(n){l.push(n);k.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=
new h;this._isInitialized=!1;this._workerPostMessage({type:r.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(l){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=l)&&this.addEventListener("message",l)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(l){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=l)&&this.addEventListener("error",l)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(l,k){var n=this;a(function(){n._workerMessageHandler(new MessageEvent("message",{data:l}))})};c.prototype.dispatchEvent=function(l){return this._dispatcher.dispatchEvent(l)};c.prototype.addEventListener=function(l,k,n){this._dispatcher.addEventListener(l,k,n)};c.prototype.removeEventListener=function(l,k,n){this._dispatcher.removeEventListener(l,
k,n)};c.prototype._workerPostMessage=function(l,k){var n=this;a(function(){n.dispatchEvent(new MessageEvent("message",{data:l}))})};c.prototype._workerMessageHandler=function(l){var k=this;if(l=r.receiveMessage(l)){var n=l.jobId;switch(l.type){case r.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:r.MessageType.CONFIGURED});break;case r.MessageType.OPEN:l=l.modulePath,x("esri-webpack")?K(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",l],function(d,e,u,z,A,t,w,q){switch(q){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":e=u;break;case "esri/views/3d/layers/PointCloudWorker":e=z;break;case "esri/views/3d/layers/SceneLayerWorker":e=A;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":e=
t;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":e=w;break;default:e=q}d=d.connect(e);k._workerPostMessage({type:r.MessageType.OPENED,jobId:n,data:d})}):K(["./RemoteClient",l],function(d,e){d=d.connect(e);k._workerPostMessage({type:r.MessageType.OPENED,jobId:n,data:d})})}}};return c}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(K,g,x){function p(r,h){if(Array.isArray(h)){var b=new x;r(h,function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.resolve(a)});return b.promise}return p(r,[h]).then(function(a){return a[0]})}Object.defineProperty(g,"__esModule",{value:!0});g.when=p;g.getAbsMid=function(r,h,b){return h.toAbsMid?h.toAbsMid(r):b.id.replace(/\/[^\/]*$/gi,"/")+r}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(K,g,x){return{create:function(p,r){if(p){var h=p.renderTexture,b=Object.keys(p);
if(p.read&&!r)return p;p.read&&r&&(p=p.toJson());-1<b.indexOf("name")&&b.indexOf(!1)?(p=g.mixin({},p),r=this._parseV2(p,r)):(p="esri.layers.RasterFunction"===p.declaredClass?p.toJson():g.mixin({},p),r=this._parseV1(p,r));r.branchCount=r.updateBranchStructure();r.renderTexture||(r.renderTexture=!!h);return r}},_parseV1:function(p,r){var h=p.rasterFunction,b=p.rasterFunctionArguments,a=p.renderTexture||p.rasterFunctionArguments.renderTexture||!1,c,l,k,n,d,e,u;(n=b.raster||b.Raster)&&n.rasterFunction&&
(c=this._parseV1(n,r));(n=b.raster2||b.Raster2)&&n.rasterFunction&&(l=this._parseV1(n,r));(n=b.rasters||b.Rasters)&&0<n.length&&(k=n.map(g.hitch(this,function(z){return z&&z.rasterFunction?this._parseV1(z,r):z})));(n=b.dem||b.DEM)&&(n.functionName||n.rasterFunction)&&(d=this._parseV1(n,r));(n=b.fillRaster||b.FillRaster)&&(n.functionName||n.rasterFunction)&&(e=this._parseV1(n,r));n=x.functions[h];if(!n)return console.error("Function is not currently supported: "+h),null;h=new n(b);h.variableName&&
(n=b[h.variableName])&&(n.functionName||n.rasterFunction)&&(u=this._parseV1(n,r));p.outputPixelType&&(h.pixelType=p.outputPixelType);"$$"===c?h.functionArguments.raster=r&&r.raster:null!=c?h.functionArguments.raster=c:h.functionArguments.raster||(h.functionArguments.raster=r&&r.raster);null!=l&&(h.functionArguments.raster2=l);null!=k&&(h.functionArguments.rasters=k.map(function(z){"$$"===z&&(z=r&&r.raster);return z}));null!=d&&(h.functionArguments.dem=d);null!=e&&(h.functionArguments.fillRaster=e);
null!=u&&(h.functionArguments[h.variableName]=u);h.renderTexture=a;return h},_parseV2:function(p,r){if(!p)return null;p=g.clone(p);this._bindV2Args(p,r);var h={};this._convertTov1(p,h);return this._parseV1(h,r)},_bindV2Args:function(p,r){(p||r)&&Object.keys(p).forEach(function(h){p[h]["function"]&&p[h].arguments?this._bindV2Args(p[h].arguments,r):null!=r[p[h].name]&&(p[h].value=r[p[h].name])}.bind(this))},_convertV2Types:function(p){if(!p)return null;"ArgumentArray"===p.type?p.elements&&"RasterStatistics"===
p.elements[0].type&&(p=p.elements):p instanceof Array&&0===p.length&&(p=null);return p},_convertTov1:function(p,r){if((p||r)&&p["function"]){var h=p["function"],b=p.arguments;r.rasterFunction=h.type.replace("Function","");r.outputPixelType="UNKNOWN"===h.pixelType?"Unknown":h.pixelType;r.rasterFunctionArguments={};var a;Object.keys(b).forEach(function(c){b[c]["function"]&&b[c].arguments?(r.rasterFunctionArguments[c]={},this._convertTov1(b[c],r.rasterFunctionArguments[c])):(a=b[c].value,r.rasterFunctionArguments[c]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t){return function(){function w(C){C.prototype.supportWebGL&&(E[C.prototype.functionName]=C);C.prototype.support2D&&(q[C.prototype.functionName]=C);B[C.prototype.functionName]=C}var q={},E={},B={};w(x);w(p);w(r);w(h);w(b);w(a);w(c);w(l);w(k);w(n);w(d);w(e);w(u);w(z);w(A);w(t);return{cpu:q,gpu:E,functions:B,register:w,getFunction:function(C){return B[C]},support:function(C,G){return!!("gpu"===G?E:"cpu"===G?q:B)[C]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(K,g,x,p,r,h,b,a){return K([x,b],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=a.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:h.aspect,fragmentName:"Aspect"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),n=this.gl,d=n.drawingBufferWidth;n=n.drawingBufferHeight;var e=l.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/d,1/n],u_cellSize:[(e.xmax-e.xmin)/d,(e.ymax-e.ymin)/n]});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(K){return{hillshade:function(g,x){if(null!==g&&null!==g.pixelBlock&&
null!==g.pixelBlock.pixels){var p=this._clonePixelBlock(g.pixelBlock),r=x.altitude,h=x.azimuth,b=x.zFactor,a=x.psPower,c=x.psFactor,l=x.hillshadeType,k=x.slopeType,n=x.isGCS;1===l&&(b*=2);x=p.width;var d=p.height,e=p.pixels[0],u=p.mask,z=new Uint8Array(x*d);u&&z.set(u);var A=new Uint8Array(x*d),t=(g.extent.xmax-g.extent.xmin)/x,w=(g.extent.ymax-g.extent.ymin)/d,q=b/(8*t),E=b/(8*w);.001<b&&n&&(q/=111E3,E/=111E3);3===k&&(n?(q=111E3*t,E=111E3*w,q=(b+Math.pow(q,a)*c)/(8*q),E=(b+Math.pow(E,a)*c)/(8*E)):
(q=(b+Math.pow(t,a)*c)/(8*t),E=(b+Math.pow(w,a)*c)/(8*w)));n=(90-r)*Math.PI/180;r=Math.cos(n);var B=(360-h+90)*Math.PI/180;h=Math.sin(n)*Math.cos(B);n=Math.sin(n)*Math.sin(B);b=[];a=[];c=[];t=[315,270,225,360,180,0];var C=[60,60,60,60,60,90];k=[3,5,3,2,1,4];var G=k.reduce(function(N,Q){return N+Q});w=k.map(function(N){return N/G});if(1===l){var D=t.length;for(k=0;k<D;k++)r=C[k],h=t[k],n=(90-r)*Math.PI/180,r=Math.cos(n),B=(360-h+90)*Math.PI/180,h=Math.sin(n)*Math.cos(B),n=Math.sin(n)*Math.sin(B),b.push(r),
a.push(h),c.push(n)}var f=0;for(k=1;k<d-1;k++)for(C=k*x,t=1;t<x-1;t++)if(u&&!u[C+t])A[C+t]=0;else{B=0;if(u&&(B=u[C-x+t-1]+u[C-x+t]+u[C-x+t+1]+u[C+t-1]+u[C+t+1]+u[C+x+t-1]+u[C+x+t]+u[C+x+t+1],7>B)){A[C+t]=0;z[C+t]=0;continue}if(7===B){var m=u[C-x+t-1]?e[C-x+t-1]:e[C+t];var y=u[C-x+t]?e[C-x+t]:e[C+t];var v=u[C-x+t+1]?e[C-x+t+1]:e[C+t];B=u[C+t-1]?e[C+t-1]:e[C+t];var F=u[C+t+1]?e[C+t+1]:e[C+t];f=u[C+x+t-1]?e[C+x+t-1]:e[C+t];var H=u[C+x+t]?e[C+x+t]:e[C+t];var L=u[C+x+t+1]?e[C+x+t+1]:e[C+t]}else m=e[C-
x+t-1],y=e[C-x+t],v=e[C-x+t+1],B=e[C+t-1],F=e[C+t+1],f=e[C+x+t-1],H=e[C+x+t],L=e[C+x+t+1];B=(v+F+F+L-(m+B+B+f))*q;y=(f+H+H+L-(m+y+y+v))*E;v=Math.sqrt(1+B*B+y*y);f=0;if(0===l)H=n*y-h*B,H=255*(r+H)/v,0>H&&(H=0),f=H;else if(1===l)for(m=0;m<D;m++)H=c[m]*y-a[m]*B,H=255*(b[m]+H)/v,0>H&&(H=0),f+=H*w[m];A[C+t]=f}for(k=0;k<d;k++)A[k*x]=A[k*x+1],A[(k+1)*x-1]=A[(k+1)*x-2];for(k=1;k<x-1;k++)A[k]=A[k+x],A[k+(d-1)*x]=A[k+(d-2)*x];p.pixelType="U8";p.pixels=[A];p.statistics=[{minValue:0,maxValue:255}];u&&(p.mask=
z);return{extent:g.extent,pixelBlock:p}}},slope:function(g,x){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var p=this._clonePixelBlock(g.pixelBlock),r=x.zFactor,h=x.psPower,b=x.psFactor,a=x.slopeType,c=x.isGCS;x=p.width;var l=p.height,k=p.pixels[0],n=p.mask,d=new Uint8Array(x*l);n&&d.set(n);var e=new Float32Array(x*l),u=(g.extent.xmax-g.extent.xmin)/x,z=(g.extent.ymax-g.extent.ymin)/l,A=r/(8*u),t=r/(8*z);1E-4>Math.abs(r-1)&&c&&(A/=111E3,t/=111E3);3===a&&(c?(A=111E3*u,t=111E3*z,A=
(r+Math.pow(A,h)*b)/(8*A),t=(r+Math.pow(t,h)*b)/(8*t)):(A=(r+Math.pow(u,h)*b)/(8*u),t=(r+Math.pow(z,h)*b)/(8*z)));for(r=1;r<l-1;r++)for(b=r*x,h=1;h<x-1;h++)if(n&&!n[b+h])e[b+h]=0;else{z=0;if(n&&(z=n[b-x+h-1]+n[b-x+h]+n[b-x+h+1]+n[b+h-1]+n[b+h+1]+n[b+x+h-1]+n[b+x+h]+n[b+x+h+1],7>z)){e[b+h]=0;d[b+h]=0;continue}if(7===z){z=n[b-x+h-1]?k[b-x+h-1]:k[b+h];c=n[b-x+h]?k[b-x+h]:k[b+h];u=n[b-x+h+1]?k[b-x+h+1]:k[b+h];var w=n[b+h-1]?k[b+h-1]:k[b+h];var q=n[b+h+1]?k[b+h+1]:k[b+h];var E=n[b+x+h-1]?k[b+x+h-1]:k[b+
h];var B=n[b+x+h]?k[b+x+h]:k[b+h];var C=n[b+x+h+1]?k[b+x+h+1]:k[b+h]}else z=k[b-x+h-1],c=k[b-x+h],u=k[b-x+h+1],w=k[b+h-1],q=k[b+h+1],E=k[b+x+h-1],B=k[b+x+h],C=k[b+x+h+1];w=(u+q+q+C-(z+w+w+E))*A;z=(E+B+B+C-(z+c+c+u))*t;z=Math.sqrt(w*w+z*z);e[b+h]=1===a||3===a?57.2957795*Math.atan(z):100*z}for(r=0;r<l;r++)e[r*x]=e[r*x+1],e[(r+1)*x-1]=e[(r+1)*x-2];for(r=1;r<x-1;r++)e[r]=e[r+x],e[r+(l-1)*x]=e[r+(l-2)*x];p.pixelType="F32";p.pixels=[e];p.statistics=[{minValue:0,maxValue:255}];n&&(p.mask=d);return{extent:g.extent,
pixelBlock:p}}},aspect:function(g){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var x=this._clonePixelBlock(g.pixelBlock),p=x.width,r=x.height,h=x.pixels[0],b=x.mask,a=new Uint8Array(p*r);b&&a.set(b);var c=new Float32Array(p*r),l=1/((g.extent.xmax-g.extent.xmin)/p),k=1/((g.extent.ymax-g.extent.ymin)/r),n,d;for(n=1;n<r-1;n++){var e=n*p;for(d=1;d<p-1;d++)if(b&&!b[e+d])c[e+d]=0;else{var u=0;if(b&&(u=b[e-p+d-1]+b[e-p+d]+b[e-p+d+1]+b[e+d-1]+b[e+d+1]+b[e+p+d-1]+b[e+p+d]+b[e+p+d+1],7>u)){c[e+
d]=0;a[e+d]=0;continue}if(7===u){u=b[e-p+d-1]?h[e-p+d-1]:h[e+d];var z=b[e-p+d]?h[e-p+d]:h[e+d];var A=b[e-p+d+1]?h[e-p+d+1]:h[e+d];var t=b[e+d-1]?h[e+d-1]:h[e+d];var w=b[e+d+1]?h[e+d+1]:h[e+d];var q=b[e+p+d-1]?h[e+p+d-1]:h[e+d];var E=b[e+p+d]?h[e+p+d]:h[e+d];var B=b[e+p+d+1]?h[e+p+d+1]:h[e+d]}else u=h[e-p+d-1],z=h[e-p+d],A=h[e-p+d+1],t=h[e+d-1],w=h[e+d+1],q=h[e+p+d-1],E=h[e+p+d],B=h[e+p+d+1];t=(A+w+w+B-(u+t+t+q))*l;u=(q+E+E+B-(u+z+z+A))*k;0===t&&0===u?u=-1:(u=90-57.29578*Math.atan2(u,-t),0>u&&(u+=
360),360===u?u=0:360<u&&(u%=360));c[e+d]=u}}for(n=0;n<r;n++)c[n*p]=c[n*p+1],c[(n+1)*p-1]=c[(n+1)*p-2];for(n=1;n<p-1;n++)c[n]=c[n+p],c[n+(r-1)*p]=c[n+(r-2)*p];x.pixelType="F32";x.pixels=[c];x.statistics={minValue:0,maxValue:360};b&&(x.mask=a);return{extent:g.extent,pixelBlock:x}}},_clonePixelBlock:function(g){return g.clone?g.clone():K.clone(g)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(K,g,x,p,r,h,b){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=g.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:r.bandArithmetic,fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(d){return parseInt(d,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var l=this.bindFrameBuffer(),k=this.functionArguments.method,n=2<c.length?c.slice(2):null;this._alterBand?this._setUniforms({u_method:k,u_bandId_nir:0,u_bandId_red:1,u_constants:n}):this._setUniforms({u_method:k,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:n});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(K){return{calculate:function(g,x){if(g&&g.pixels&&g.pixels.length){var p=x&&x.bandIndexes;x=x&&x.method;var r=p.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});g=this._clonePixelBlock(g);var h=g.pixels,b=g.mask;switch(x){case 1:h=this._calculateNDVI(b,h[r[0]-1],h[r[1]-1]);break;case 2:h=this._calculateSAVI(b,h[r[0]-1],h[r[1]-1],r[2]);break;case 3:h=this._calculateTSAVI(b,h[r[0]-1],h[r[1]-1],r[2],r[3],r[4]);break;case 4:h=this._calculateMSAVI(b,
h[r[0]-1],h[r[1]-1]);break;case 5:h=this._calculateGEMI(b,h[r[0]-1],h[r[1]-1]);break;case 6:h=this._calculatePVI(b,h[r[0]-1],h[r[1]-1],r[2],r[3]);break;case 7:h=this._calculateGVITM(b,h[r[0]-1],h[r[1]-1],h[r[2]-1],h[r[3]-1],h[r[4]-1],h[r[5]-1]);break;case 8:h=this._calculateSultan(b,h[r[0]-1],h[r[1]-1],h[r[2]-1],h[r[3]-1],h[r[4]-1],h[r[5]-1]);break;case 9:h=this._calculateVARI(b,h[r[0]-1],h[r[1]-1],h[r[2]-1]);break;case 0:h=this._calculateUserDefined(b,h,p)}g.pixels=h;g.pixelType="F32";g.calculateStatistics();
return g}},_clonePixelBlock:function(g){return g.clone?g.clone():K.clone(g)},_parseUserDefined:function(g,x){g=g.replace(" ","");0===g.indexOf("-")&&(g="0"+g);0===g.indexOf("+")&&(g=g.slice(1,g.length));g=g.split("");var p=[],r=[],h="+-*/()".split(""),b,a="";for(b=0;b<g.length;b++){var c=g[b];h.some(function(l){return l===c})?(""!==a&&r.push(parseFloat(a)),p.push(c),a=""):"b"===c.toLowerCase()?(b++,a=c.concat(g[b]),r.push(x[parseInt(a[1],10)-1]),a=""):(a=a.concat(c),b===g.length-1&&r.push(parseFloat(a)))}return{ops:p,
nums:r}},_op:function(g,x,p,r){if(p.constructor===Number&&r.constructor===Number)return p+r;var h;if(p.constructor===Number){var b=r.length;var a=p;p=new Float32Array(b);for(h=0;h<b;h++)p[h]=a}else if(b=p.length,r.constructor===Number)for(a=r,r=new Float32Array(b),h=0;h<b;h++)r[h]=a;a=new Float32Array(b);if(null==g)if("+"===x)for(h=0;h<b;h++)a[h]=p[h]+r[h];else if("-"===x)for(h=0;h<b;h++)a[h]=p[h]-r[h];else if("*"===x)for(h=0;h<b;h++)a[h]=p[h]*r[h];else{if("/"===x)for(h=0;h<b;h++)a[h]=p[h]/r[h]}else if("+"===
x)for(h=0;h<b;h++)g[h]&&(a[h]=p[h]+r[h]);else if("-"===x)for(h=0;h<b;h++)g[h]&&(a[h]=p[h]-r[h]);else if("*"===x)for(h=0;h<b;h++)g[h]&&(a[h]=p[h]*r[h]);else if("/"===x)for(h=0;h<b;h++)g[h]&&(a[h]=p[h]/r[h]);return a},_shrinkOp:function(g,x){g.splice(x,1);var p=x=0,r=0;do{for(x=r=p=0;x<g.length;x++)if("("===g[x])p=x;else if(")"===g[x]){r=x;break}r===p+1&&g.splice(p,2)}while(r===p+1);return g},_getPriorityOpIndex:function(g,x){if(1===g.length)return{opIndex:0,numIndex:0};var p=x=0,r=0,h=-1,b=0;for(x=
0;x<g.length;x++)if("("===g[x])p=x;else if(")"===g[x]){r=x;break}var a=0===r?g:g.slice(p+1,r);for(x=0;x<a.length;x++)if("*"===a[x]||"/"===a[x]){h=x;break}if(!(-1<h))for(x=0;x<a.length;x++)if("+"===a[x]||"-"===a[x]){h=x;break}0<r&&(h+=p+1);for(x=0;x<h;x++)"("===g[x]&&b++;return{opIndex:h,numIndex:h-b}},_calculateUserDefined:function(g,x,p){x=this._parseUserDefined(p,x);p=x.ops;for(var r=x.nums,h,b,a;0<p.length&&(x=this._getPriorityOpIndex(p,r),h=p[x.opIndex],b=r[x.numIndex],a=r[x.numIndex+1],h=this._op(g,
h,b,a),1!==p.length);)p=this._shrinkOp(p,x.opIndex),r.splice(x.numIndex,2,h);return[h]},_calculateNDVI:function(g,x,p){var r=p.length,h=new Float32Array(r),b;if(null==g)for(b=0;b<r;b++){var a=p[b];var c=x[b];h[b]=(c-a)/(c+a)}else for(b=0;b<r;b++)g[b]&&(a=p[b],c=x[b],h[b]=(c-a)/(c+a));return[h]},_calculateSAVI:function(g,x,p,r){var h=p.length,b=new Float32Array(h),a;if(null==g)for(a=0;a<h;a++){var c=p[a];var l=x[a];b[a]=(l-c)/(l+c+r)*(1+r)}else for(a=0;a<h;a++)g[a]&&(c=p[a],l=x[a],b[a]=(l-c)/(l+c+
r)*(1+r));return[b]},_calculateTSAVI:function(g,x,p,r,h,b){var a=p.length,c=new Float32Array(a),l=-h*r+b*(1+r*r);if(null==g)for(b=0;b<a;b++){var k=p[b];var n=x[b];c[b]=r*(n-r*k-h)/(h*n+k+l)}else for(b=0;b<a;b++)g[b]&&(k=p[b],n=x[b],c[b]=r*(n-r*k-h)/(h*n+k+l));return[c]},_calculateMSAVI:function(g,x,p){var r=p.length,h=new Float32Array(r),b;if(null==g)for(b=0;b<r;b++){var a=p[b];var c=x[b];h[b]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a)))}else for(b=0;b<r;b++)g[b]&&(h[b]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*
c+1,2)-8*(c-a))));return[h]},_calculateGEMI:function(g,x,p){var r=p.length,h=new Float32Array(r),b;if(null==g)for(b=0;b<r;b++){var a=p[b];var c=x[b];c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5);h[b]=c*(1-.25*c)-(a-.125)/(1-a)}else for(b=0;b<r;b++)g[b]&&(a=p[b],c=x[b],c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5),h[b]=c*(1-.25*c)-(a-.125)/(1-a));return[h]},_calculatePVI:function(g,x,p,r,h){var b=p.length,a=new Float32Array(b),c,l=Math.sqrt(1+r*r);if(null==g)for(c=0;c<b;c++){var k=p[c];var n=x[c];a[c]=(n-r*k-h)/l}else for(c=
0;c<b;c++)g[c]&&(k=p[c],n=x[c],a[c]=(n-r*k-h)/l);return[a]},_calculateGVITM:function(g,x,p,r,h,b,a){var c=x.length,l=new Float32Array(c),k;if(null==g)for(k=0;k<c;k++)l[k]=-.2848*x[k]-.2435*p[k]-.5436*r[k]+.7243*h[k]+.084*b[k]-1.18*a[k];else for(k=0;k<c;k++)g[k]&&(l[k]=-.2848*x[k]-.2435*p[k]-.5436*r[k]+.7243*h[k]+.084*b[k]-1.18*a[k]);return[l]},_calculateSultan:function(g,x,p,r,h,b,a){p=x.length;var c=new Float32Array(p),l=new Float32Array(p),k=new Float32Array(p),n;if(null==g)for(n=0;n<p;n++)c[n]=
b[n]/a[n]*100,l[n]=b[n]/x[n]*100,k[n]=r[n]/h[n]*(b[n]/h[n])*100;else for(n=0;n<p;n++)g[n]&&(c[n]=b[n]/a[n]*100,l[n]=b[n]/x[n]*100,k[n]=r[n]/h[n]*(b[n]/h[n])*100);return[c,l,k]},_calculateVARI:function(g,x,p,r){var h=x.length,b=new Float32Array(h),a;if(null==g)for(a=0;a<h;a++){var c=x[a];var l=p[a];var k=r[a];b[a]=(l-c)/(l+c-k)}else for(a=0;a<h;a++)if(g[a])for(a=0;a<h;a++)c=x[a],l=p[a],k=r[a],b[a]=(l-c)/(l+c-k);return[b]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(K,g,x,p,r,h,b){return K([p,h],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var c=Object.keys(a[0].attributes);var l=c.filter(function(z){return"alpha"===
z.toLowerCase()})[0];var k=c.filter(function(z){return"value"===z.toLowerCase()})[0];var n=c.filter(function(z){return"red"===z.toLowerCase()})[0];var d=c.filter(function(z){return"green"===z.toLowerCase()})[0];var e=c.filter(function(z){return"blue"===z.toLowerCase()})[0];if(!(k&&n&&d&&e))throw"invalid colormap";a=a.map(function(z){return l?[z.attributes[k],z.attributes[n],z.attributes[d],z.attributes[e],z.attributes[l]]:[z.attributes[k],z.attributes[n],z.attributes[d],z.attributes[e]]});var u=1.1>
Math.max.apply(null,a.map(function(z){return z[1]}));c=l&&1.1>Math.max.apply(null,a.map(function(z){return z[4]}));if(u)for(u=0;u<a.length;u++)a[u][1]=Math.round(255*a[u][1]),a[u][2]=Math.round(255*a[u][2]),a[u][3]=Math.round(255*a[u][3]),c&&(a[u][4]=Math.round(255*a[u][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=g.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=b.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,c){for(var l=0,k=a.length-1,n=0,d=0;l<k;)if(n=Math.floor((l+k)/2),d=a[n],d[0]<c)l=n;else if(d[0]>c)k=n;else return d.slice(1);return null},_sortClr:function(a,c){var l,k=[];for(l=0;l<a.length;l++)k.push(a[l]);for(l=0;l<k.length-1;l++){var n=k[l];for(a=l+1;a<k.length;a++)n[0]>k[a][0]&&(n=k[a],k[a]=k[l],
k[l]=n)}if(c)for(l=0;l<k.length/2;l++)n=k[l],k[k.length-1-l]=k[l],k[l]=n;return k},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(l){return{fromColor:l.toColor,toColor:l.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=b.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?x.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):x.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?x.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
x.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=x.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var c=0;0>a[0][0]&&(c=a[0][0]);var l=[],k=5===a[0].length,n;for(n=0;n<a.length;n++)l[a[n][0]-c]=k?a[n].slice(1):a[n].slice(1).concat([255]);return l},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:r.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,l=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var k=this._clrTexture,n=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:l,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(k,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:n.texture}},_setupColormapTexture:function(a){var c=
this._createTexture(),l=this.gl,k=a.length/4,n=new Float32Array(a.length),d,e=this.renderTexture?255:1;for(d=0;d<a.length;d++)n[d]=a[d]/e;l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,1,0,l.RGBA,l.FLOAT,n);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(K,g,x){return{createAlgorithmicColorRamp:function(p,r){if(!p)return null;var h=p.fromColor,b=p.toColor;if(!h||!b)return null;
void 0===h.r&&3<=h.length&&(h={r:h[0],g:h[1],b:h[2]});void 0===b.r&&3<=b.length&&(b={r:b[0],g:b[1],b:b[2]});var a=p.size||256;p=p.algorithm||"cie-lab";if(1===a)var c=[h.r,h.g,h.b,255];else if(2===a)c=[h.r,h.g,h.b,255,b.r,b.g,h.b,255];else if(-1<p.toLowerCase().indexOf("hsv")){c=x.toHSV(h);b=x.toHSV(b);a=a||256;var l=0===c.s,k=0===b.s;h=c.h;p=b.h;l&&!k?h=c.h=p:k&&!l&&(p=b.h=h);l=Math.abs(p-h);180>l?p=(p-h)/(a-1):(l=360-l,p=h>p?l/(a-1):-l/(a-1));l=(b.s-c.s)/(a-1);k=(b.v-c.v)/(a-1);var n=c.s;c=c.v;var d,
e=new Uint8Array(4*a);for(d=0;d<a-1;d++){var u=x.toRGB({h:h,s:n,v:c});e[4*d]=u.r;e[4*d+1]=u.g;e[4*d+2]=u.b;e[4*d+3]=255;h+=p;n+=l;c+=k;360<h?h-=360:0>h&&(h+=360)}u=x.toRGB(b);e[4*(a-1)]=u.r;e[4*(a-1)+1]=u.g;e[4*(a-1)+2]=u.b;e[4*(a-1)+3]=255;c=e}else if(-1<p.toLowerCase().indexOf("lch")){n=x.toLCH(h);b=x.toLCH(b);a=a||256;c=(b.l-n.l)/(a-1);h=(b.c-n.c)/(a-1);p=(b.h-n.h)/(a-1);l=n.l;k=n.c;n=n.h;e=new Uint8Array(4*a);for(d=0;d<a-1;d++)u=x.toRGB({l:l,c:k,h:n}),e[4*d]=u.r,e[4*d+1]=u.g,e[4*d+2]=u.b,e[4*
d+3]=255,l+=c,k+=h,n+=p;u=x.toRGB(b);e[4*(a-1)]=u.r;e[4*(a-1)+1]=u.g;e[4*(a-1)+2]=u.b;e[4*(a-1)+3]=255;c=e}else if(-1<p.toLowerCase().indexOf("lab")){n=x.toLAB(h);b=x.toLAB(b);a=a||256;c=(b.l-n.l)/(a-1);h=(b.a-n.a)/(a-1);p=(b.b-n.b)/(a-1);l=n.l;k=n.a;n=n.b;e=new Uint8Array(4*a);for(d=0;d<a-1;d++)u=x.toRGB({l:l,a:k,b:n}),e[4*d]=u.r,e[4*d+1]=u.g,e[4*d+2]=u.b,e[4*d+3]=255,l+=c,k+=h,n+=p;u=x.toRGB(b);e[4*(a-1)]=u.r;e[4*(a-1)+1]=u.g;e[4*(a-1)+2]=u.b;e[4*(a-1)+3]=255;c=e}if(r&&!1===r.flattened)for(r=c,
c=[],b=0;b<c/4;b++)c[b]=r.slice(4*b,4*b+4);return c},createMultiPartColorRamp:function(p,r){if(!p)return null;r=r&&g.clone(r)||{flattened:!0};var h=p.colorRamps;if(!h||0===h.length)return null;var b=p.size||256;p=Math.max(Math.floor(b/h.length),1);var a=Math.max(p,b-(h.length-1)*p),c=!1!==r.flattened;r.flattened=!0;b=(h.length-1)*p+a;var l=new Uint8Array(4*b);for(b=0;b<h.length;b++){var k={fromColor:h[b].fromColor,toColor:h[b].toColor,size:b===h.length-1?a:p};l instanceof Array?l.concat(this.createAlgorithmicColorRamp(k,
r)):l.set(this.createAlgorithmicColorRamp(k,r),p*b*4)}if(!c)for(r=l,l=[],b=0;b<l/4;b++)l[b]=r.slice(4*b,4*b+4);return l},createRandomColorRamp:function(p){p=p||{};var r=p.size||256,h=!1===p.flattened;var b=h?new Uint8Array(4*r):[];for(p=0;p<r;p++)h?(b[4*p]=Math.round(255*Math.random()),b[4*p+1]=Math.round(255*Math.random()),b[4*p+2]=Math.round(255*Math.random()),b[4*p+3]=255):b[p]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return b}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(K){return{mask:function(g,x){if(g&&g.pixels&&g.pixels.length){g=this._clonePixelBlock(g);var p=x.includedRanges,r=x.noDataInterpretation;x=x.noDataValues;if(null===p&&null===x)return g;var h=g.pixels,b=g.mask,a=g.width*g.height,c=h.length,l;if(null!==x&&x.length!==c)throw"expect "+c+" elements in noDataValues";if(null!==p&&p.length!==2*c)throw"expect "+2*c+" elements in IncludeRanges";if(null==b){b=new Uint8Array(a);for(l=0;l<a;l++)b[l]=1;g.mask=b}if(0===r)for(r=0;r<c;r++){var k=h[r];var n=
null===p?null:p[2*r];var d=null===p?null:p[2*r+1];var e=null===x?null:parseFloat(x[r]);if(null===n||null===d)for(l=0;l<a;l++){if(b[l]){var u=k[l];u===e&&(b[l]=0)}}else if(null===e)for(l=0;l<a;l++)b[l]&&(u=k[l],u<n||u>d)&&(b[l]=0);else for(l=0;l<a;l++)b[l]&&(u=k[l],u<n||u>d||u===e)&&(b[l]=0)}else{var z=new Uint8Array(a);for(l=0;l<a;l++)z[l]=b[l];for(r=0;r<c;r++)if(k=h[r],n=null===p?null:p[2*r],d=null===p?null:p[2*r+1],e=null===x?null:parseFloat(x[r]),null===n||null===d)for(l=0;l<a;l++)z[l]&&(u=k[l],
u!==e&&(z=0));else if(null===e)for(l=0;l<a;l++)z[l]&&(u=k[l],u<=n&&u<=d&&(z=0));else for(l=0;l<a;l++)z[l]&&(u=k[l],u<=n&&u<=d&&u!==e&&(z=0));for(l=0;l<a;l++)b[l]&&z[l]&&(b[l]=0)}return g}},calculateStatisticsHistograms:function(g,x){g=this._clonePixelBlock(g);x=g.pixelType;var p=g.pixels,r=g.mask,h=p.length,b,a,c=[],l;for(b=0;b<h;b++){var k={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var n=k.counts;var d=p[b];if("U8"===x)if(r)for(a=0;a<g.width*g.height;a++)r[a]&&n[d[a]]++;else for(a=
0;a<g.width*g.height;a++)n[d[a]]++;else{var e=g.statistics[b].minValue;var u=g.statistics[b].maxValue;k.min=e;k.max=u;u=(u-e)/256;var z=new Uint32Array(257);if(r)for(a=0;a<g.width*g.height;a++)r[a]&&z[Math.floor((d[a]-e)/u)]++;else for(a=0;a<g.width*g.height;a++)z[Math.floor((d[a]-e)/u)]++;for(a=0;255>a;a++)n[a]=z[a];n[255]=z[255]+z[256]}c.push(k);e=g.statistics[b].minValue;u=g.statistics[b].maxValue;for(a=z=l=d=0;a<k.size;a++)d+=n[a],l+=a*n[a];l/=d;for(a=0;a<k.size;a++)z+=n[a]*Math.pow(a-l,2);n=
Math.sqrt(z/(d-1));a=(l+.5)*(k.max-k.min)/k.size+k.min;k=n*(k.max-k.min)/k.size;g.statistics[b]={min:e,minValue:e,max:u,maxValue:u,mean:a,stddev:k}}g.histograms=c;return g},buildIndexedColormap:function(g,x){if(!g)return null;var p=0;0>g[0][0]&&(p=g[0][0]);var r=Math.max(256,g[g.length-1][0]-p);if(65536<r)return null;var h=new Uint8Array(4*r),b=[],a=0,c=5===g[0].length;if(x)for(b=g[a],x=b[0]-p;x<r;x++)h[4*x]=b[1],h[4*x+1]=b[2],h[4*x+2]=b[3],h[4*x+3]=c?b[4]:255,x===b[0]-p&&(b=a===g.length-1?b:g[++a]);
else for(x=0;x<g.length;x++)b=g[x],a=4*(b[0]-p),h[a]=b[1],h[a+1]=b[2],h[a+2]=b[3],h[a+3]=c?b[4]:255;return{indexedColormap:h,offset:p,alphaSpecified:c}},colorize:function(g,x){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);var p=g.pixels,r=g.width*g.height,h=g.mask,b=x.indexedColormap,a=x.indexedColormapOffset,c=b&&b.length-1,l=x.indexed2DColormap;x=x.alphaSpecified;if(3<=p.length)throw"colormap only works on single band image";var k=p[0],n=new Uint8Array(k.length),d=new Uint8Array(k.length),
e=new Uint8Array(k.length),u=0;if(b)if(h)for(p=0;p<r;p++)h[p]&&(u=4*(k[p]-a),u<a||u>c?h[p]=0:(n[p]=b[u],d[p]=b[u+1],e[p]=b[u+2],h[p]=b[u+3]));else{h=new Uint8Array(r);for(p=0;p<r;p++)u=4*(k[p]-a),u<a||u>c?h[p]=0:(n[p]=b[u],d[p]=b[u+1],e[p]=b[u+2],h[p]=b[u+3]);g.mask=h}else if(h)for(p=0;p<r;p++)h[p]&&(b=l[k[p]],n[p]=b[0],d[p]=b[1],e[p]=b[2],h[p]=b[3]);else{h=new Uint8Array(r);for(p=0;p<r;p++)b=l[k[p]],n[p]=b[0],d[p]=b[1],e[p]=b[2],h[p]=b[3];g.mask=h}g.pixels=[n,d,e];g.statistics=null;g.pixelType="U8";
g.maskIsAlpha=x;return g}},convolute:function(g,x){g=this._clonePixelBlock(g);var p=g.pixels,r=g.width,h=g.height,b=r*h,a=p.length,c,l,k,n,d=[],e=[],u=x.normalizedKernel,z=x.kernelRows,A=x.kernelCols;for(x=0;x<a;x++){var t=p[x];var w=new Float32Array(b);w.set(t);for(k=1;k<h-1;k++){var q=k*r;for(n=1;n<r-1;n++){for(c=e=0;c<z;c++)for(l=0;l<A;l++)e+=t[q+n+(c-1)*r+l-1]*u[c*A+l];w[q+n]=e}}d.push(w)}g.pixels=d;return g},contrastBrightnessStretch:function(g,x){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);
var p=g.pixels,r=g.mask,h=g.width*g.height,b=p.length;var a=x&&x.contrastOffset;x=x&&x.brightnessOffset;if("U8"!==g.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var c=this._createContrastBrightnessLUT(a,x);if(null==r)for(a=0;a<h;a++)for(x=0;x<b;x++)p[x][a]=c[p[x][a]];else for(a=0;a<h;a++)if(r[a])for(x=0;x<b;x++)p[x][a]=c[p[x][a]];g.pixelType="U8";return g}},isNull:function(g,x){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);x=g.mask;var p=
g.pixels[0],r=p.length,h;if(x){for(h=0;h<r;h++)p[h]=x[h]?0:1;g.mask=null}else if(p.fill)p.fill(0);else for(h=0;h<r;h++)p[h]=0;return g}},setNull:function(g){if(null!==x&&null!==x.pixels){var x=this._clonePixelBlock(g);g=x.mask;var p=x.pixels[0],r=p.length,h;g=g||new Uint8Array(r);for(h=0;h<r;h++)g[h]=p[h]?0:1;x.mask=g;return x}},local:function(g,x){if(!x)return g[0];var p=x.rasterCountNeeded;x=x.functor;var r=this._clonePixelBlock(g[0]);if(null!==r&&null!==r.pixels){var h=r.width*r.height,b;g=(b=
g[1])&&b.pixels[0];var a=b&&b.mask,c=r.mask,l=r.pixels[0];if(2===p)if(!c&&a)c=a;else if(c&&a)for(b=0;b<h;b++)c[b]=c[b]&&a[b]?1:0;r.mask=c;if(1===p)if(null==c)for(b=0;b<h;b++)l[b]=x(l[b]);else for(b=0;b<h;b++)c[b]&&(l[b]=x(l[b]));else if(2===p)if(null==c)for(b=0;b<h;b++)l[b]=x(l[b],g[b]);else for(b=0;b<h;b++)c[b]&&(l[b]=x(l[b],g[b]));r.mask=c;r.calculateStatistics();return r}},remapColor:function(g,x){g=this._clonePixelBlock(g);var p=g.width*g.height,r=x.length,h=Math.floor(r/2),b=x[Math.floor(h)],
a=x[0].value,c=x[x.length-1].value,l=g.pixels[0],k,n,d=!1,e=new Uint8Array(p),u=new Uint8Array(p),z=new Uint8Array(p),A=g.mask,t=4===x[0].mappedColor.length;A&&0!==A.length||(A=new Uint8Array(p),A.fill(t?255:1),g.mask=A);for(n=0;n<p;n++)if(A[n]){var w=l[n];if(w<a||w>c)e[n]=u[n]=z[n]=A[n]=0;else{d=!1;var q=h;var E=b;var B=0;for(k=r-1;1<k-B;){if(w===E.value){d=!0;break}w>E.value?B=q:k=q;q=Math.floor((B+k)/2);E=x[Math.floor(q)]}d||(E=w===x[k].value?x[k]:x[B]);e[n]=E.mappedColor[0];u[n]=E.mappedColor[1];
z[n]=E.mappedColor[2];A[n]=E.mappedColor[3]}}g.pixels=[e,u,z];g.mask=A;g.pixelType="u8";g.maskIsAlpha=t;return g},_clonePixelBlock:function(g){if(g.clone)return g.clone();var x=K.clone(g),p;if(g.pixels&&g.pixels[0]&&0<g.pixels[0].length&&!(x.pixels&&x.pixels[0]&&0<x.pixels[0].length)){x.pixels=[];var r=g.pixels.length;for(p=0;p<r;p++)x.pixels[p]=new g.pixels[p].constructor(g.pixels[p])}if(g.statistics)for(x.statistics=[],r=g.statistics.length,p=0;p<r;p++)x.statistics[p]=K.clone(g.statistics[p]);g.mask&&
(x.mask=new Uint8Array(g.mask));return x},_createContrastBrightnessLUT:function(g,x){if(this._contrastCache&&this._contrastCache.contrastOffset===g&&this._contrastCache.brightnessOffset===x)return this._contrastCache.lut;var p=Math.min(Math.max(g,-100),100),r=Math.min(Math.max(x,-100),100),h,b=new Uint8Array(256);for(h=0;256>h;h++){if(0<p&&100>p)var a=(200*h-25500+510*r)/(2*(100-p))+128;else 0>=p&&-100<p?a=(200*h-25500+510*r)*(100+p)/2E4+128:100===p?(a=200*h-25500+256*(100-p)+510*r,a=0<a?255:0):-100===
p&&(a=128);b[h]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:g,brightnessOffset:x,lut:b};return b}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(K,g,x,p,r,h){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=
this.mixinIgnoreCase({rasters:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],c=[],l=b.rasters.length,k;if(b.rasters[0].statistics)for(k=0;k<l;k++)a.push(b.rasters[k].statistics[0]);if(b.rasters[0].histograms)for(k=0;k<l;k++)c.push(b.rasters[k].histograms[0]);this.rasterInfo=g.mixin(b.rasters[0],{bandCount:l,pixelType:this._calculatePixelType(this.pixelType,b.rasters[0].pixelType),statistics:a,
histograms:c});return!0},read2D:function(b){b=b.rasters;if(null!=b&&0!==b.length){var a=this._clonePixelData(b[0]),c=a.pixelBlock,l=[],k=[];for(n=0;n<b.length;n++)l.push(b[n].pixelBlock.pixels[0]),k.push(b[n].pixelBlock.statistics[0]);c.pixels=l;c.stackedStatistics=k;c.planes=b.length;var n;k=c.width*c.height;for(n=0;n<b.length;n++)if(c=b[n].pixelBlock.mask,d&&c)for(l=0;l<k;l++)d[l]&=c[l];else var d=d||c;a.maks=d;return a}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:r.compositeBand,
fragmentName:"CompositeBand"});var a=b.rasters;if(null!=a&&0!==a.length){a=a.length;var c,l=this.bindFrameBuffer();for(c=0;c<a;c++){var k=this._setupTextureData(b.rasters[c],{notOriginal:0<c});var n=0<c?c.toString():"";this._bindTexture(k.texture,"u_image"+n)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:k.extent,texture:l.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(K,g,x,p,r,h,b){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=g.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(g.hitch(this,function(l){return this._clampBand(l,c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:r.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(K,g,x,p,r,h,b,a){return K([x,
b],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),
statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var l=this._analyzeKernel(),k=a.convolute(c.pixelBlock,{normalizedKernel:l.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(k.pixelType=this.pixelType);k.pixels=k.pixels.map(g.hitch(this,function(n){return this._clampBand(n,k.pixelType)}));return{extent:c.extent,pixelBlock:k}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:h.convolution,fragmentName:"Convolution"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),n=this.gl,d=n.drawingBufferWidth;n=n.drawingBufferHeight;var e=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/
c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/d,1/n],u_kernel:e,u_kernelSize:e.length});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,l=c.reduce(function(d,e){return d+e});0!==l&&1!==l&&(c=c.map(function(d){return d/l}));var k,n=[];for(k=0;k<c.length;k++)n.some(function(d){return d===c[k]})||n.push(c[k]);return{normalizedKernel:c,
distinctValues:n}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,l=this.functionArguments.columns,k=this.functionArguments.kernel,n=[],d,e;for(d=0;d<c;d++)n.push({weights:k.slice(d*l,(d+1)*l)});var u;for(d=1;d<c;d++){var z=n[d].weights;for(k=0;k<d;k++)if(u=n[k].weights){var A=z[0]/u[0];for(e=1;e<l;e++)z[e]/u[e]!==A&&(A=null);null!==A&&(n[d]={row:k,factor:A})}}return n}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(K,g,x,p,r,h){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to extract band function is invalid.");var a=[],c=b.raster.statistics,l=[],k=b.raster.histograms,n=this.functionArguments.bandIDs.length||
b.raster.bandCount;this.functionArguments.bandIDs.forEach(g.hitch(this,function(d){if(d>=n-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+d);d=n-1}if(0>d)return Error("missing band "+d);void 0!==c&&null!==c&&0<c.length&&a.push(c[d]);void 0!==k&&null!==k&&0<k.length&&l.push(k[d])}));this.rasterInfo=g.mixin(b.raster,{bandCount:n,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),statistics:a,histograms:l});return!0},read2D:function(b){b=this._clonePixelData(b.raster);
if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){this._performance.start();var a=b.pixelBlock,c=a.statistics,l=a.pixels,k=l.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return b;var n=[],d=[];this.functionArguments.bandIDs.forEach(function(e){if(e>=k-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+e;e=k-1}if(0>e)throw"missing band "+e;n.push(l[e]);void 0!==c&&null!==c&&0<c.length&&
d.push(c[e])});a.pixels=n;a.statistics=d;a.planes=this.functionArguments.bandIDs.length;return b}},readGL:function(b){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:r.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var c=!!(this._alterBand&&b.raster&&b.raster.texture);b=this._setupTextureData(b.raster,{bandIDs:a});var l=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(b.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(K,g,x,p,r,h,b,a,c,l){return K([x,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(k){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},k);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var n=this._weights.reduce(function(d,
e){return d+e});this._weights=this._weights.map(function(d){return d/n})},bind:function(k){k=this.getSourceRasterInfo(k);if(!k.raster)return Error("The raster input to hillshade function is invalid.");k.raster.statistics&&(this.srcStatistics=k.raster.statistics);this.rasterInfo=g.mixin(k.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(k){this._performance.start();k=k.raster;k=c.hillshade(k,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:k.extent.spatialReference.wkid&&null==r[k.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return k},readGL:function(k){this._performance.start();this._initializeProgram({fragment:b.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var n=this._setupTextureData(k.raster),d=this.bindFrameBuffer(),e=this.gl,u=e.drawingBufferWidth;e=e.drawingBufferHeight;var z=n.extent,A=(z.xmax-z.xmin)/u,t=(z.ymax-z.ymin)/e,w=this.functionArguments.altitude,q=this.functionArguments.azimuth,
E=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(E*=2);var B=E/(8*A),C=E/(8*t);.001<E&&z.spatialReference.wkid&&null==r[z.spatialReference.wkid]&&(B/=111E3,C/=111E3);var G=this.functionArguments.psPower,D=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=z.spatialReference.wkid&&null==r[z.spatialReference.wkid])?(B=111E3*A,C=111E3*t,B=(E+Math.pow(B,G)*D)/(8*B),C=(E+Math.pow(C,G)*D)/(8*C)):(B=(E+Math.pow(A,G)*D)/(8*A),C=(E+Math.pow(t,G)*D)/(8*t)));
var f=(90-w)*Math.PI/180;w=Math.cos(f);var m=(360-q+90)*Math.PI/180;q=Math.sin(f)*Math.cos(m);f=Math.sin(f)*Math.sin(m);G=Array(6);D=Array(6);z=Array(6);var y=this._weights,v;if(1===this.functionArguments.hillshadeType){var F=this._azimuths.length;for(v=0;v<F;v++)w=this._altitudes[v],q=this._azimuths[v],f=(90-w)*Math.PI/180,w=Math.cos(f),m=(360-q+90)*Math.PI/180,q=Math.sin(f)*Math.cos(m),f=Math.sin(f)*Math.sin(m),G[v]=w,D[v]=q,z[v]=f}else G[0]=w,D[0]=q,z[0]=f;G=G.map(function(H){return parseFloat(H)});
D=D.map(function(H){return parseFloat(H)});z=z.map(function(H){return parseFloat(H)});this._setUniforms({u_cellSize:[A,t],u_zfactor:E,u_xFactor:B,u_yFactor:C,u_sinZcosA:q,u_sinZsinA:f,u_cosZ:w,u_sinZcosAs:D,u_sinZsinAs:z,u_cosZs:G,u_weights:y,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:k&&k.raster&&k.raster.pixelBlock?[1/k.raster.pixelBlock.width,1/k.raster.pixelBlock.height]:[1/u,1/e],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(n.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:n.extent,texture:d.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var k=this._indexedColormap,n=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(n=l.buildIndexedColormap(this.functionArguments.colormap))&&n.alphaSpecified,this._indexedColormap=n&&n.indexedColormap,this._indexedColormapOffset=n&&n.offset):n?(this._indexedColormap="multipart"===n.type?this.invert?p.createMultiPartColorRamp(this._invertColorRamp(n)):p.createMultiPartColorRamp(n):this.invert?p.createAlgorithmicColorRamp(this._invertColorRamp(n)):p.createAlgorithmicColorRamp(n),n.fromColor&&n.toColor&&"000"===n.fromColor.slice(0,
3).join("")&&"255255255"===n.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=p.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(k&&this._indexedColormap){n=!0;for(var d=0;d<k.length;d++)if(k[d]!==this._indexedColormap[d]){n=!1;break}n||(this._clrTexture=null)}},_setupColormapTexture:function(k){var n=this._createTexture(),d=this.gl,
e=k.length/4,u=new Float32Array(k.length),z;for(z=0;z<k.length;z++)u[z]=k[z]/255;d.getExtension("OES_texture_float");d.texImage2D(d.TEXTURE_2D,0,d.RGBA,e,1,0,d.RGBA,d.FLOAT,u);return n}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(K,g,x,p,r,h,b){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(l){return l.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(l){return!!l.extent})[0];this.rasterInfo=g.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[];c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(e){return e.pixelBlock});var l=this.functionArguments.operation;if(null===l)return c[0];this._performance.start();var k=this._getOperations(),n=k.operators[l-1];k=k.functors[l-1];
if(!this.functionArguments.rasters){if(1!==n)throw"no sufficient rasters, require "+n;}else if(999!==n&&this.functionArguments.rasters.length!==n)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+n;var d=31===l?b.isNull(a[0]):50===l?b.setNull(a[0]):b.local(a,{rasterCountNeeded:n,functor:k});"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType,d.pixels=d.pixels.map(g.hitch(this,function(e){return this._clampBand(e,d.pixelType)})));d.statistics||d.calculateStatistics();
return{extent:c[0].extent,pixelBlock:d}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,l=this._getWebGLOperations(),k=l.operators[c-1],n=r.local;l="result\x3d"+l.functors[c-1]+";";31!==c&&50!==c&&(l+="result \x3d vec4(result.rgb, a.a);");n=n.replace("vec4 replaceme"+k+";",l);l=this.gl.getParameter(this.gl.VERSION);var d="";if(-1<l.toLowerCase().indexOf("webgl 1.0")||-1<l.toLowerCase().indexOf("webgl 0."))d=this._getPolyfill(c);n=n.replace("vec4 polyfill;",d);
1<k&&(n=n.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",k.toString())));this._initializeProgram({fragment:n,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){c=c.length;l=this.bindFrameBuffer();for(k=0;k<c;k++){n=0<k?k.toString():"";var e=this._setupTextureData(a.rasters[k],{reCreate:!0});this._bindTexture(e.texture,"u_image"+n)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:l.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,c){return a+c},function(a,c){return a-c},function(a,c){return a*c},function(a){return Math.sqrt(a)},function(a,c){return Math.pow(a,c)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,c){return a&c},function(a,c){return a<<c},function(a){return~a},function(a,c){return a|c},function(a,c){return a>>c},function(a,c){return a^c},function(a,c){return a&&c},function(a){return!a},function(a,c){return a||c},function(a,c){return a!=c},function(a){return Math.cos(a)},function(a,c){return Math.cosh(a)},function(a,c){return a/c},function(a,c){return a==c},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,c){return a>c?1:0},function(a,c){return a>=c?1:0},function(a,c){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,c){return a<c?1:0},function(a,c){return a<=c?1:0},function(a){return Math.log(a)},function(a,c){return Math.log10(a)},function(a,c){return Math.log2(a)},999,999,999,999,999,999,function(a,c){return a%c},function(a){return-a},function(a,c){return a!=c?1:0},999,function(a,c){return Math.floor(a)},function(a,c){return Math.ceil(a)},function(a,c){return c?
0:a},function(a,c){return Math.sin(a)},function(a,c){return Math.sinh(a)},function(a,c){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,c){return Math.atan2(a,c)},function(a,c){return a/c},function(a,c){return Math.floor(a/c)},999,999,999,999,999,999,999,999,999,999,function(a,c,l){return a?c:l}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c=
"";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(K,g,x,p,r,h,b){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=g.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:r.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),l=this.functionArguments.includedRanges,k=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(n){return parseFloat(n,10)}):null;this._setUniforms({u_includedRanges:l,u_includedRanges_specified:l?!0:!1,u_noDataValues:k,u_noDataValues_specified:k?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(K,g,x,p,r,h,b){return K([x,h],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=g.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),l;if(this.functionArguments.scaled){var k=c.pixels[0];var n=c.mask;var d=k.length;var e=new Uint8Array(d);if(null==n)for(l=0;l<d;l++)e[l]=100*k[l]+100&255;else for(l=0;l<d;l++)n[l]&&(e[l]=100*k[l]+100&255);c.pixels[0]=e;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:r.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,l=this.functionArguments.infraredBandID,k=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(l,c)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[l,c,l]}:null});var n=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:k}):this._setUniforms({u_bandId_nir:l,u_bandId_red:c,u_scaled:k});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:n.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(K,g,x,p,r,h,
b,a){return K([x,b],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=a.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==p[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:h.slope,fragmentName:"Slope"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),n=this.gl,d=n.drawingBufferWidth;n=n.drawingBufferHeight;var e=l.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/d,1/n],u_cellSize:[(e.xmax-e.xmin)/d,(e.ymax-e.ymin)/n],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(K,g,x,p,r,h,b){return K([p,h],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",
pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);this.rasterInfo=g.mixin(a.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,
"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var c=b.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_remapGL:function(a){this._performance.start();
this._initializeProgram({fragment:r.remap,fragmentName:"Remap"});var c=new Uint8Array(64),l=this.functionArguments.colorBreaks;l.forEach(function(e,u){c[4*u]=e.mappedColor[0];c[4*u+1]=e.mappedColor[1];c[4*u+2]=e.mappedColor[2];c[4*u+3]=1>=e.mappedColor[3]?255*e.mappedColor[3]:e.mappedColor[3]});var k=l[l.length-1],n=k.mappedColor;c[60]=n[0];c[61]=n[1];c[62]=n[2];c[63]=1>=n[3]?255*n[3]:n[3];var d=new Float32Array(16);l.forEach(function(e,u){d[u]=e.value});d[15]=k.value;this._clrTexture||(this._clrTexture=
this._setupColormapTexture(c));l=this._clrTexture;k=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:d});this._bindTexture(l,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:k.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),l=a.length/4,k=new Float32Array(a.length),n=this.renderTexture?255:1,d,e=this.gl;for(d=0;d<a.length;d++)k[d]=a[d]/
n;e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,1,0,e.RGBA,e.FLOAT,k);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(K,g,x,p,r){return K([p,r],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,constructor:function(h){this.functionArguments={raster:null}},
bind:function(h){h=this.getSourceRasterInfo(h);if(!h.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=g.mixin(h.raster,{});return!0},read2D:function(h){return h.raster},readGL:function(h){this._initializeProgram({fragment:x.identity,fragmentName:"identity"});h=this._setupTextureData(h.raster);var b=this.bindFrameBuffer();this._bindTexture(h.texture,"u_image");this._drawGL();return{extent:h.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(K,g,x,p,r){return K([p,r],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(h){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},h)},bind:function(h){h=this.getSourceRasterInfo(h);if(!h.raster)return Error("The raster input to convolution function is invalid.");
this.rasterInfo=g.mixin(h.raster,{bandCount:h.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,h.raster.pixelType),statistics:h.raster.statistics,histograms:h.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(h){this._performance.start();this._initializeProgram({fragment:x.resample,fragmentName:"Resample"});var b=this._setupTextureData(h.raster),a=this.bindFrameBuffer(),c=this.gl,l=c.drawingBufferWidth;c=c.drawingBufferHeight;
var k=h.raster;void 0!==k.pixelBlock?(b=b||this._setupTextureData(k),h=k.pixelBlock.width,k=k.pixelBlock.height):(b=b||k,h=l,k=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[h/l,k/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/l,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),
function(K,g,x,p,r,h,b,a,c){var l=function(){function k(d){n[d.prototype.rendererName]=d}var n={};k(p);k(h);k(b);k(r);k(a);k(c);return n}();return{wellKnownRenderers:l,isSupported:function(k){if(!k)return!1;var n=!0;l[k.rendererName]||(n=!1);return n},create:function(k){if(!k)return null;if(k.rendererName){var n=k.rendererName;k=k.rendererArguments}else n="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(k.type),n="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[n],
"rasterStretch"===k.type&&k.bandIndex&&1<k.bandIndex.length&&(n="RGB");return(n=l[n])?new n(k):null},createDefaultRenderer:function(k){if(k&&k.raster){var n=k.raster.rasterInfo,d=k.raster.dataType;if(n){var e=k.raster.rasterFunction,u=["Stretch","Colormap","ContrastAndBrightness"];if(e&&"U8"===n.pixelType&&-1<u.indexOf(e.functionName))e.renderTexture=!0;else if("Processed"!==d||!(k.useWebGL&&e&&e.renderTexture||!k.useWebGL&&"U8"===n.pixelType)){e&&(n=e.rasterInfo);e=n.bandCount;var z=n.colormap,A=
n.vat;u=n.histograms;u&&0===u.length&&(u=null);var t=n.statistics&&n.statistics.map(function(E){return[E.min,E.max,E.mean,E.stddev]});if(1===e&&z&&0<z.length)var w=this._getDefaultColormapRenderer(A,z);else if(1===e&&A&&A.features&&0<A.features.length)w=new r({});else{z=0;A=!1;d||!k.raster||!k.raster.tileInfo||void 0!==k.raster.tileInfo.tileType&&"Map"!==k.raster.tileInfo.tileType?"U8"===n.pixelType&&"Processed"===d?(z=5,t=t||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],A=!1):"U8"===n.pixelType||"Elevation"===
d?(z=5,A=t?!1:!0):"Scientific"===d||"StdTime"===d?(z=5,A=t?!1:!0,w=this._getDefaultScientificColorRamp()):u&&0<u.length?(z=6,A=!1):t?(z=5,A=!1):(z=6,A=!0):(t=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],z=5,A=!1);t||(z=5,A=!0);k=k.bandIds||k.raster&&k.raster.imageServiceParams&&k.raster.imageServiceParams.bandIds;var q;3<=e&&(q=k&&3===k.length?k.slice():this.getDefaultBandCombination(n));q&&t&&(t=q.map(function(E){return t[E]}));n={stretchType:z,min:0,max:255,dra:A,minPercent:.25,maxPercent:.25,useGamma:!1,
computeGamma:!1,statistics:t,histograms:u,numberOfStandardDeviations:2.5,bandIndex:q};1===e||q&&1===q.length?(w&&(n.colorRamp=w,n.invert=!1),w=new b(n)):w=new h(n)}return w}}}},getDefaultBandCombination:function(k){var n=k.bandCount;if(1===n)return null;if(2===n)return[0];var d=(k=k.keyProperties)&&k.ChangeAnalysisParameters&&k.ChangeAnalysisParameters.AnalysisType;if(d&&("ccdc"===d.toLowerCase()||"landtrendr"===d.toLowerCase()))return[0];k=k&&k.BandProperties;var e;if(k&&k.length===n){var u=this.getWellKnownBandIndexes(k);
k=u.red;d=u.green;var z=u.blue;u=u.nir;null!=k&&null!=d&&null!=z?e=[k,d,z]:null!=u&&null!=k&&null!=d&&(e=[u,k,d])}!e&&3<=n&&(e=[0,1,2]);return e},getWellKnownBandIndexes:function(k){for(var n={},d=0;d<k.length;d++){var e=k[d],u=e.BandName&&e.BandName.toLowerCase();"red"===u?n.red=d:"green"===u?n.green=d:"blue"===u?n.blue=d:"nearinfrared"===u||"nearinfrared_1"===u||"nir"===u?n.nir=d:e.WavelengthMax&&e.WavelengthMin&&(u=e.WavelengthMin,e=e.WavelengthMax,null==n.blue&&410<=u&&480>=u&&480<=e&&540>=e?
n.blue=d:null==n.green&&490<=u&&560>=u&&560<=e&&610>=e?n.green=d:null==n.red&&595<=u&&670>=u&&660<=e&&730>=e?n.red=d:null==n.nir&&700<=u&&860>=u&&800<=e&&950>=e&&(n.nir=d))}return n},_getDefaultColormapRenderer:function(k,n){if(n||n.length){var d=[],e=this._ratContainsColormap(k);if(e)var u=this._getRATValueClassNameMap(k);n.forEach(function(z){var A=u?u[z[0]]:z[0];d.push({color:[z[1],z[2],z[3]],value:z[0],label:e?null!=A?A:"":z[0]})});return new p({colormapInfos:d})}},_ratContainsColormap:function(k){if(!k||
!k.fields)return!1;var n,d,e;return k.fields.some(function(u){u&&u.name&&(u=u.name.toLowerCase(),"red"===u&&(n=!0),"green"===u&&(d=!0),"blue"===u&&(e=!0));return n&&d&&e})},_getRATValueClassNameMap:function(k){if(!k||!k.fields)return null;var n={},d,e;k.fields.forEach(function(u){if("classname"===u.name.toLowerCase()||"class_name"===u.name.toLowerCase())d=u.name;"value"===u.name.toLowerCase()&&(e=u.name)});k.features.forEach(function(u){u=u.attributes;n[u[e]]=d?u[d]:u[e]});return n},_getDefaultScientificColorRamp:function(){return{type:"multipart",
colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(k){return{fromColor:k.toColor,toColor:k.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(K,g,x,p){return K([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",
renderTexture:!0,constructor:function(r){r&&r.colormapInfos&&(r.colormap=r.colormapInfos.map(function(h){return[h.value].concat(h.color)}));this._function=new p(r);this._function.outputPixelType="U8";this._function.renderTexture=!0},draw2D:function(r){this._updateColormapParameters();r=this._clonePixelData(r);return r=this._function._colorize(r)},drawGL:function(r){this._updateColormapParameters();this._function._colorizeGL(r)},toJson:function(){var r=this._function.toJson().rasterFunctionArguments;
return{rendererName:this.rendererName,rendererArguments:r}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(r){return{value:r[0],color:r.slice(1),label:r[0]}})}},_updateColormapParameters:function(){var r=this._function.functionArguments;r.colormap=this.colormap;r.colormapName=this.colormapName;r.colorRamp=this.colorRamp;r.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(K,g,x,p){return K(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(r){r=r||{};this.raster=r.raster||r.Raster||this.raster;this.draw=g.hitch(this,this.draw);this.bind=g.hitch(this,this.bind);r=g.clone(r);Object.keys(r).forEach(function(h){null==r[h]&&delete r[h]});g.mixin(this,r)},bind:function(r){if(!r)throw"failed to bind without options";var h=r;r.layer&&(r=r.layer,h={id:r.id,
rawRasterInfo:r.raster.rasterInfo,glSetting:r._glSetting,xformSetting:r.tileManager&&r.tileManager.xformSetting,useWebGL:r.useWebGL,resampling:r.tileMode&&r.tileManager&&r.tileManager.xformSetting.requireProjection&&!r._hasTilingEffects&&"Thematic"!==r.raster.dataType?1:0,tileMode:r.tileMode});this._rawRasterInfo=h.rawRasterInfo;this.useWebGL=h.useWebGL;this._function&&this._function.setProcessingContext(g.mixin({useProcessedData:!0},h));this._processingContext=h},hasTilingEffects:function(){},draw:function(r){return this.useWebGL?
this.drawGL(r):this.draw2D(r)},toJson:function(){},_clonePixelData:function(r){if(null==r)return r;var h={};r.extent&&(h.extent=new x(r.extent.xmin,r.extent.ymin,r.extent.xmax,r.extent.ymax,r.extent.spatialReference));r=r.processedPixelBlock||r.pixelBlock;if(null==r)return h;h.pixelBlock=r.clone?r.clone():p.prototype.clone(r);return h}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction",
"../../../renderers/colorRampGenerator"],function(K,g,x,p,r){return K([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(h){h&&h.colormap&&(this.colormap=h.colormap,this._function=new p(h),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(h){this.inherited(arguments);if(!this._function){var b=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;
if(!b)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var l=b.fields.filter(function(w){return"value"===w.name.toLowerCase()})[0];if(l)var k=l.name;a||((a=b.fields.filter(function(w){return-1<["classname","category"].indexOf(w.name.toLowerCase())})[0])||(a=b.fields.filter(function(w){return"esriFieldTypeString"===
w.type})[0]),this.alias=(this.field=a=a&&a.name||k)&&a.alias||k);var n=[],d;if(!c){c=[];var e=b.fields.filter(function(w){return"alpha"===w.name.toLowerCase()})[0];var u=b.fields.filter(function(w){return"red"===w.name.toLowerCase()})[0];var z=b.fields.filter(function(w){return"green"===w.name.toLowerCase()})[0];var A=b.fields.filter(function(w){return"blue"===w.name.toLowerCase()})[0];for(l=0;l<b.features.length;l++){var t=b.features[l].attributes;(d=c.some(function(w){w.value===t[a]}))||(e&&u&&
z&&A?c.push({value:t[a],alias:t[a],color:[t[u.name],t[z.name],t[A.name],t[e.name]]}):u&&z&&A?c.push({value:t[a],alias:t[a],color:[t[u.name],t[z.name],t[A.name]]}):c.push({value:t[a],alias:t[a]}))}if(!(u&&z&&A))for(d=r.createRandomColorRamp({size:c.length}),l=0;l<c.length;l++)c[l].color=d[l];this.uniqueValueInfos=c}if(c)c.forEach(function(w){n=n.concat(b.features.filter(function(q){return w.value==q.attributes[a]}).map(function(q){return[q.attributes[k]].concat(w.color||w.symbol&&w.symbol.color)}))}),
this.defaultColor&&b.features.filter(function(w){n.some(function(q){return q[0]===w.attributes[k]})||n.push([w.attributes[k]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=new p({colormap:n});this.colormap=n;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(h){h=this._clonePixelData(h);return h=this._function._colorize(h)},drawGL:function(h){this._function._colorizeGL(h)},
toJson:function(h){var b={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};h&&(b.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:b}},toCommonRendererJson:function(){var h=this.attributeField||this.field1||this.field,b=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",
field1:h,uniqueValueInfos:b}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),function(K,g,x,p,r,h){return K([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);b=g.mixin({},b,{stretchType:this.stretchType});this._stretchFunction=new p(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=b.bandIndex||b.BandIndex;this._function=new r(b);
this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&!this.contrastOffset&&!this.brightnessOffset)return b;this._stretchFunction._stretch(b);var a=b.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c);a&&a.pixels.length>l&&c&&(a.pixels=c.map(function(k){return a.pixels[k]}),
a.statistics&&(a.statistics=c.map(function(k){return a.statistics[k]})));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=h.contrastBrightnessStretch(b.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();b.pixelBlock&&(b=this._clonePixelData(b));var a=b.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c),k=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,
n=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,d,e;a&&a.pixels.length>l&&c&&(a.pixels=c.map(function(u){return a.pixels[u]}),a.statistics&&(a.statistics=c.map(function(u){return a.statistics[u]})),k&&0<k.length&&k.length!==c.length&&(d=c.map(function(u){return k[u]})),n&&0<n.length&&n.length!==c.length&&(e=c.map(function(u){return n[u]})));this._stretchFunction.functionArguments.statistics=d||k;this._stretchFunction.functionArguments.histograms=
e||n;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._function._cbGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=this._stretchFunction.toJson().rasterFunctionArguments;b.bandIndex=this.bandIndex;b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:b}},
toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:g.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:g.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},
_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),
function(K,g,x,p,r,h,b,a){return K([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=g.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(l){null==c[l]&&delete c[l]});this._function=new h(c);this._stretchFunction=new r(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new b(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var l=c.pixelBlock,k=this.bandIndex?this.bandIndex[0]:0;l&&1<l.pixels.length&&l.pixels.length>k&&(l.pixels=[l.pixels[k]],l.statistics&&(l.statistics=[l.statistics[k]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=a.contrastBrightnessStretch(c.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();c.pixelBlock&&(c=this._clonePixelData(c));var l=c.pixelBlock,k=this.bandIndex?this.bandIndex[0]||0:0,n=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,d=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,e,u;l&&1<l.pixels.length&&
l.pixels.length>k&&(l.pixels=[l.pixels[k]],l.statistics&&(l.statistics=[l.statistics[k]]),n&&n.length>k&&(e=[n[k]]),d&&d.length>k&&(u=[d[k]]));this._stretchFunction.functionArguments.statistics=e||n;this._stretchFunction.functionArguments.histograms=u||d;l=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),l&&(c=this._clrFunction._colorizeGL(c)),
this._function._cbGL(c)):l?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:g.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:g.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(K,g,x,p,r){return K([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(h){h=h||{};this._function=new r(h);this._function.outputPixelType="U8";var b=
h.classBreakInfos;h=h.minValue;null!=h&&b&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(h,b))},bind:function(h){this.inherited(arguments);this.isColormapFunction=!1;var b=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=b&&b.vat;if(a&&"u8"===b.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(b=a.fields.filter(function(u){return"value"===u.name.toLowerCase()})[0])var l=b.name;var k=a.features.sort(function(u,z){return parseFloat(u.attributes[c])-
parseFloat(z.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var n=[],d=this.field,e=this.classBreakInfos;e.forEach(function(u,z){a.features.forEach(function(A){var t=e[z-1]&&e[z-1].classMaxValue||k;A.attributes[d]<=u.classMaxValue&&(A.attributes[d]>t||A.attributes[d]===k)&&(t=u.symbol.color,n.some(function(w){return w[0]===A.attributes[l]})||n.push([A.attributes[l]].concat(t)))})});this._function=new p({colormap:n});this.colormap=n;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(g.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(h){if(this.isColormapFunction)return this._updateColormapParameters(),h=this._clonePixelData(h),h=this._function._colorize(h);this._updateRemapParameters();return this._function._remap(h)},drawGL:function(h){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(h)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(h))},
toJson:function(){var h=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:h}},toCommonRendererJson:function(){var h,b=this.classBreakInfos,a=this.colorBreaks;if(null==b&&a)for(b=[],h=0;h<a.length-1;h++)b.push({classMaxValue:a[h+1].value,symbol:{color:a[h].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[h].value+" - "+a[h+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:b}},
_updateRemapParameters:function(){var h=this.classBreakInfos,b=this.minValue;null!=b&&h&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(b,h))},_getSortedColorBreaks:function(h,b){b=b.map(function(c){return{maxValue:c.classMaxValue,color:c.symbol.color}}).sort(function(c,l){return c.maxValue-l.maxValue});var a=[{value:h,mappedColor:b[0].color}];for(h=0;h<b.length;h++)a.push({value:b[h].maxValue,mappedColor:h===b.length-1?b[h].color:b[h+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(K,g,x,p,r,h,b){return K([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=g.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(c){null==a[c]&&delete a[c]});this._function=new r(a);this._hillshadeFunction=new p(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k){K={requirePE:function(d,e){return!(d.equals(e)||d._canProject(e))},load:function(){var d=new x;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var e=new x;e.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=e.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?d.resolve():this._loadPromise.isRejected()&&d.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(d),this._loadPromise.then(g.hitch(this,function(){this._pendingdfds.forEach(function(u){u.isFulfilled()||u.resolve()})}),g.hitch(this,function(){this._pendingdfds.forEach(function(u){u.isFulfilled()||u.reject()})})));return d.promise},computeError:function(d,e){return[Math.abs((d[0]+d[4]+d[4*e.rows]+d[4*e.rows+4])/4-d[2*e.rows+2]),Math.abs((d[1]+d[5]+d[4*e.rows+1]+d[4*e.rows+5])/4-d[2*e.rows+3])]},getDefaultDatumTransformationForDataset:function(d,e,u){if(!(e&&d.spatialReference&&
this.requirePE(d.spatialReference,e)&&a.isLoaded()))return null;d=new b(d.toJson());e=new l(e.toJson());return u?a.getTransformation(e,d.spatialReference,d):a.getTransformation(d.spatialReference,e,d)},project:function(d,e,u){if(!e||d.spatialReference.equals(e))return d;var z=a.isLoaded()?a:c;"esri.geometry.Extent"===d.declaredClass?d=new b(d.toJson()):"esri.geometry.Point"===d.declaredClass&&(d=new k(d.toJson()));e=new l(e.toJson());(d=z.project(d,e))&&"esri.geometry.Extent"===d.declaredClass?(d=
new b(d.toJson()),u&&(1E-5>Math.abs(d.xmin+180)&&1E-5>Math.abs(d.xmax-180)?(d.xmin=0,d.xmax=360):(0>d.xmin&&(d.xmin+=360,d.xmax+=360),0>d.xmax&&(d.xmax+=360)))):d&&"esri.geometry.Point"===d.declaredClass&&(d=new k(d.toJson()),u&&0>d.x&&(d.x+=360));return d},projectResolution:function(d,e,u){var z=u.xmin+(u.xmax-u.xmin)/2;u=u.ymin+(u.ymax-u.ymin)/2;d=new b(z,u,z+d.x,u+d.y,d.spatialReference);d=this.project(d,e);return new k(d.xmax-d.xmin,d.ymax-d.ymin,e)},getProjectionOffsetGrid:function(d,e,u,z,A,
t,w){null==w&&(w=[32,32]);var q=d.xmin,E=d.ymin,B=d.xmax,C=d.ymax,G=d.spatialReference,D=e.spatialReference,f=a.isLoaded()?a:c,m=A?-A:null,y=w[0]*u.x,v=w[1]*u.y;B={cols:Math.ceil((B-q)/y)+1,rows:Math.ceil((C-E)/v)+1};d=[];for(C=0;C<B.cols;C++){var F=H;var H=[];for(u=0;u<B.rows;u++){var L=new k({x:q+y*C,y:E+v*u,spatialReference:G});L=f.project(L,D,t);if(!L)return null;z&&0>L.x&&(L.x+=360);H.push(L);0<C&&null!=m&&L.x<F[u].x&&(L.x+=A-m,L.x<F[u].x&&(L.x+=A-m));d.push((L.x-e.xmin)/(e.xmax-e.xmin));d.push((L.y-
e.ymin)/(e.ymax-e.ymin))}}e=this.computeError(d,B);z=new Float32Array((B.cols-1)*(B.rows-1)*12);A=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);t=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(C=0;C<B.cols-1;C++)for(u=0;u<B.rows-1;u++){y=C*B.rows*2+2*u;q=d[y];E=d[y+1];H=d[y+2];G=d[y+3];y+=2*B.rows;D=d[y];f=d[y+1];m=d[y+2];v=d[y+3];F=0;L=12*(u*(B.cols-1)+C);for(y=0;3>y;y++)z[L++]=A[F++]*q+A[F++]*H+A[F++]*m;for(y=F=0;3>y;y++)z[L++]=A[F++]*E+A[F++]*G+A[F++]*v;for(y=F=0;3>y;y++)z[L++]=t[F++]*q+t[F++]*D+t[F++]*
m;for(y=F=0;3>y;y++)z[L++]=t[F++]*E+t[F++]*f+t[F++]*v}return{offsets:d,error:e,coefficients:z,spacing:w,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(d){var e=d&&d.wkid;if(null!=e)return d.isWebMercator()&&(e=3857),null==h[e]?180:n[e]}};p("extend-esri")&&g.setObject("layers.rasterLib.raster.rasterProjectionHelper",K,r);var n={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7};return K})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),function(K,g,x,p,r,h){function b(n,d,e,u,z){void 0===u&&(u=null);void 0===z&&(z=!1);if(null===u){var A=h.cacheKey(d,e);void 0!==k[A]?u=k[A]:(u=a(d,e,null),null===u&&(u=new h),k[A]=u)}return c._project(n,d,e instanceof r||!1===z?e:new r(e),u,z)}function a(n,d,e){void 0===e&&(e=null);n=c._getTransformation(n,
d,e);return null!==n?h.fromGE(n):null}Object.defineProperty(g,"__esModule",{value:!0});var c=null;g.isLoaded=function(){return!!c&&p.isLoaded()};g.isSupported=function(){return p.isSupported()};var l=null;g.load=function(){if(l)return l.promise;l=new x;var n=p.load();K(["./geometryEngine"],function(d){c=d;n.then(function(){c._enableProjection(p);l.resolve()},function(e){l.reject(e)})});return l.promise};g.project=function(n,d,e){void 0===e&&(e=null);return n instanceof Array?0===n.length?[]:b(n,n[0].spatialReference,
d,e):b([n],n.spatialReference,d,e)[0]};var k={};g.projectMany=b;g.getTransformation=a;g.getTransformations=function(n,d,e){void 0===e&&(e=null);n=c._getTransformationBySuitability(n,d,e);if(null!==n){d=[];for(e=0;e<n.length;e++)d.push(h.fromGE(n[e]));return d}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(K,g,x,p,r){function h(A){function t(B,C,G){B[C]=G(B[C])}g._pe=A;n.init();d.init();e.init();u.init();
z.init();g.PeGCSExtent=function(B){function C(){return null!==B&&B.apply(this,arguments)||this}x(C,B);C.prototype.destroy=function(){g._pe.destroy(this)};return C}(g._pe.PeGCSExtent);for(var w=0,q=[g._pe.PeDatum,g._pe.PeGeogcs,g._pe.PeGeogtran,g._pe.PeObject,g._pe.PeParameter,g._pe.PePrimem,g._pe.PeProjcs,g._pe.PeSpheroid,g._pe.PeUnit];w<q.length;w++)A=q[w],t(A.prototype,"getName",function(B){return function(){return B.call(this,Array(n.PE_NAME_MAX))}});w=0;for(q=[g._pe.PeGeogtran,g._pe.PeProjcs];w<
q.length;w++)A=q[w],t(A.prototype,"getParameters",function(B){return function(){for(var C=Array(n.PE_PARM_MAX),G=B.call(this),D=0;D<C.length;D++){var f=g._pe.getValue(G,"*");C[D]=f?g._pe.wrapPointer(f,g._pe.PeParameter):null;G+=Int32Array.BYTES_PER_ELEMENT}return C}});t(g._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var C=this.getSize();if(!C)return null;var G=[],D=B.call(this);l(G,C,D);return G}});t(g._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var C=g._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var G=null,D=B.call(this);if(!g._pe.compare(D,g._pe.NULL)){G=[D];var f=this.getSteps();if(1<f){D=g._pe.getPointer(D);for(var m=1;m<f;m++)G.push(g._pe.wrapPointer(D+C*m,g._pe.PeGTlistExtendedGTs))}}return G}});var E=g._pe._pe_getPeHorizonSize();A=function(B){return function(){var C=this._cache;C||(this._cache=C=new Map);if(C.has(B))return C.get(B);var G=null,D=B.call(this);if(!g._pe.compare(D,g._pe.NULL)){G=[D];var f=D.getNump();if(1<f){D=g._pe.getPointer(D);for(var m=1;m<f;m++)G.push(g._pe.wrapPointer(D+
E*m,g._pe.PeHorizon))}}C.set(B,G);return G}};t(g._pe.PeProjcs.prototype,"horizonGcsGenerate",A);t(g._pe.PeProjcs.prototype,"horizonPcsGenerate",A);g._pe.PeObject.prototype.toString=function(B){void 0===B&&(B=n.PE_STR_OPTS_NONE);g._pe.ensureCache.prepare();var C=g._pe.getPointer(this),G=g._pe.ensureInt8(Array(n.PE_BUFFER_MAX));return g._pe.UTF8ToString(g._pe._pe_object_to_string_ext(C,B,G))}}function b(A){if(A){var t=g._pe.getClass(A);t&&(t=g._pe.getCache(t))&&(A=g._pe.getPointer(A))&&delete t[A]}}
function a(A,t){var w=[];t=Array(t);for(var q=0;q<A;q++)w.push(g._pe.ensureInt8(t));return w}function c(A){if(Array.isArray(A[0])){var t=[];A.forEach(function(w){t.push(w[0],w[1])})}else t=A;return t}function l(A,t,w,q){void 0===q&&(q=!1);if(q)for(q=0;q<2*t;q++)A[q]=g._pe.getValue(w+q*Float64Array.BYTES_PER_ELEMENT,"double");else{var E=0===A.length;for(q=0;q<t;q++)E&&(A[q]=Array(2)),A[q][0]=g._pe.getValue(w,"double"),A[q][1]=g._pe.getValue(w+Float64Array.BYTES_PER_ELEMENT,"double"),w+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(g,"__esModule",{value:!0});var k;g._pe=null;g.isLoaded=function(){return!!g._pe};g.isSupported=function(){return!!r("esri-wasm")};g.load=function(){if(k)return k.promise;k=new p;K(["./support/pe-wasm"],function(A){A({locateFile:function(t){return K.toUrl("./support/"+t)},onAbort:function(t){k.reject(Error(t))}}).then(function(t){h(t);k.resolve()})});return k.promise};(function(A){function t(E,B,C){g._pe.ensureCache.prepare();var G=c(C),D=C===G;G=g._pe.ensureFloat64(G);(E=g._pe._pe_geog_to_proj(g._pe.getPointer(E),
B,G))&&l(C,B,G,D);return E}function w(E,B,C){return q(E,B,C,0)}function q(E,B,C,G){g._pe.ensureCache.prepare();var D=c(C),f=C===D;D=g._pe.ensureFloat64(D);(E=g._pe._pe_proj_to_geog_center(g._pe.getPointer(E),B,D,G))&&l(C,B,D,f);return E}A.geogToProj=t;A.projGeog=function(E,B,C,G){switch(G){case n.PE_TRANSFORM_P_TO_G:return w(E,B,C);case n.PE_TRANSFORM_G_TO_P:return t(E,B,C)}return 0};A.projToGeog=w;A.projToGeogCenter=q})(g.PeCSTransformations||(g.PeCSTransformations={}));var n;(function(A){A.init=
function(){A.PE_BUFFER_MAX=g._pe.PeDefs.prototype.PE_BUFFER_MAX;A.PE_NAME_MAX=g._pe.PeDefs.prototype.PE_NAME_MAX;A.PE_MGRS_MAX=g._pe.PeDefs.prototype.PE_MGRS_MAX;A.PE_USNG_MAX=g._pe.PeDefs.prototype.PE_USNG_MAX;A.PE_DD_MAX=g._pe.PeDefs.prototype.PE_DD_MAX;A.PE_DDM_MAX=g._pe.PeDefs.prototype.PE_DDM_MAX;A.PE_DMS_MAX=g._pe.PeDefs.prototype.PE_DMS_MAX;A.PE_UTM_MAX=g._pe.PeDefs.prototype.PE_UTM_MAX;A.PE_PARM_MAX=g._pe.PeDefs.prototype.PE_PARM_MAX;A.PE_TYPE_NONE=g._pe.PeDefs.prototype.PE_TYPE_NONE;A.PE_TYPE_GEOGCS=
g._pe.PeDefs.prototype.PE_TYPE_GEOGCS;A.PE_TYPE_PROJCS=g._pe.PeDefs.prototype.PE_TYPE_PROJCS;A.PE_TYPE_GEOGTRAN=g._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;A.PE_TYPE_COORDSYS=g._pe.PeDefs.prototype.PE_TYPE_COORDSYS;A.PE_TYPE_UNIT=g._pe.PeDefs.prototype.PE_TYPE_UNIT;A.PE_STR_OPTS_NONE=g._pe.PeDefs.prototype.PE_STR_OPTS_NONE;A.PE_STR_AUTH_NONE=g._pe.PeDefs.prototype.PE_STR_AUTH_NONE;A.PE_STR_AUTH_TOP=g._pe.PeDefs.prototype.PE_STR_AUTH_TOP;A.PE_STR_NAME_CANON=g._pe.PeDefs.prototype.PE_STR_NAME_CANON;A.PE_PARM_X0=
g._pe.PeDefs.prototype.PE_PARM_X0;A.PE_PARM_ND=g._pe.PeDefs.prototype.PE_PARM_ND;A.PE_TRANSFORM_1_TO_2=g._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;A.PE_TRANSFORM_2_TO_1=g._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;A.PE_TRANSFORM_P_TO_G=g._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;A.PE_TRANSFORM_G_TO_P=g._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;A.PE_HORIZON_RECT=g._pe.PeDefs.prototype.PE_HORIZON_RECT;A.PE_HORIZON_POLY=g._pe.PeDefs.prototype.PE_HORIZON_POLY;A.PE_HORIZON_LINE=g._pe.PeDefs.prototype.PE_HORIZON_LINE;
A.PE_HORIZON_DELTA=g._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(n=g.PeDefs||(g.PeDefs={}));(function(A){function t(B,C){var G=null,D=q[B];D||(D={},q[B]=D);D.hasOwnProperty(String(C))?G=D[C]:(B=g._pe.PeFactory.prototype.factoryByType(B,C),g._pe.compare(B,g._pe.NULL)||(G=B,D[C]=G));return G=w(G)}function w(B){if(B){var C=B.getType();switch(C){case n.PE_TYPE_GEOGCS:B=g._pe.castObject(B,g._pe.PeGeogcs);break;case n.PE_TYPE_PROJCS:B=g._pe.castObject(B,g._pe.PeProjcs);break;case n.PE_TYPE_GEOGTRAN:B=g._pe.castObject(B,
g._pe.PeGeogtran);break;default:C&n.PE_TYPE_UNIT&&(B=g._pe.castObject(B,g._pe.PeUnit))}}return B}var q={},E={};A.initialize=function(){g._pe.PeFactory.prototype.initialize(null)};A.coordsys=function(B){return t(n.PE_TYPE_COORDSYS,B)};A.factoryByType=t;A.fromString=function(B,C){var G=null,D=E[B];D||(D={},E[B]=D);D.hasOwnProperty(C)?G=D[C]:(B=g._pe.PeFactory.prototype.fromString(B,C),g._pe.compare(B,g._pe.NULL)||(G=B,D[C]=G));return G=w(G)};A.geogcs=function(B){return t(n.PE_TYPE_GEOGCS,B)};A.geogtran=
function(B){return t(n.PE_TYPE_GEOGTRAN,B)};A.getCode=function(B){return g._pe.PeFactory.prototype.getCode(B)};A.projcs=function(B){return t(n.PE_TYPE_PROJCS,B)};A.unit=function(B){return t(n.PE_TYPE_UNIT,B)}})(g.PeFactory||(g.PeFactory={}));g.PeGCSExtent=null;var d;(function(A){var t;A.init=function(){A.PE_GTLIST_OPTS_COMMON=g._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;t=g._pe._pe_getPeGTlistExtendedEntrySize()};A.getGTlist=function(w,q,E,B,C,G){var D=null,f=new g._pe.PeInteger(G);try{var m=
g._pe.PeGTlistExtended.prototype.getGTlist(w,q,E,B,C,f);if(G=f.val)if(D=[m],1<G){var y=g._pe.getPointer(m);for(w=1;w<G;w++)D.push(g._pe.wrapPointer(y+t*w,g._pe.PeGTlistExtendedEntry))}}finally{g._pe.destroy(f)}return D}})(d=g.PeGTlistExtended||(g.PeGTlistExtended={}));(function(A){A.destroy=function(t){if(t&&t.length){for(var w=0;w<t.length;w++){var q=t[w];b(q);q.getEntries().forEach(function(E){b(E);E=E.getGeogtran();b(E);E.getParameters().forEach(b);[E.getGeogcs1(),E.getGeogcs2()].forEach(function(B){b(B);
var C=B.getDatum();b(C);b(C.getSpheroid());b(B.getPrimem());b(B.getUnit())})})}g._pe.PeGTlistExtendedEntry.prototype.Delete(t[0])}}})(g.PeGTlistExtendedEntry||(g.PeGTlistExtendedEntry={}));(function(A){A.geogToGeog=function(t,w,q,E,B){g._pe.ensureCache.prepare();var C=c(q),G=q===C;C=g._pe.ensureFloat64(C);var D=0;E&&(D=g._pe.ensureFloat64(E));(t=g._pe._pe_geog_to_geog(g._pe.getPointer(t),w,C,D,B))&&l(q,w,C,G);return t}})(g.PeGTTransformations||(g.PeGTTransformations={}));(function(A){function t(q,
E,B,C,G,D){g._pe.ensureCache.prepare();switch(q){case "dd":var f=g._pe._pe_geog_to_dd;var m=n.PE_DD_MAX;break;case "ddm":f=g._pe._pe_geog_to_ddm;m=n.PE_DDM_MAX;break;case "dms":f=g._pe._pe_geog_to_dms,m=n.PE_DMS_MAX}q=0;E&&(q=g._pe.getPointer(E));E=c(C);E=g._pe.ensureFloat64(E);m=a(B,m);C=g._pe.ensureInt32(m);if(G=f(q,B,E,G,C))for(f=0;f<B;f++)D[f]=g._pe.UTF8ToString(m[f]);return G}function w(q,E,B,C,G){g._pe.ensureCache.prepare();switch(q){case "dd":var D=g._pe._pe_dd_to_geog;break;case "ddm":D=g._pe._pe_ddm_to_geog;
break;case "dms":D=g._pe._pe_dms_to_geog}q=0;E&&(q=g._pe.getPointer(E));E=C.map(function(f){return g._pe.ensureString(f)});C=g._pe.ensureInt32(E);E=g._pe.ensureFloat64(Array(2*B));(D=D(q,B,C,E))&&l(G,B,E);return D}A.geog_to_dms=function(q,E,B,C,G){return t("dms",q,E,B,C,G)};A.dms_to_geog=function(q,E,B,C){return w("dms",q,E,B,C)};A.geog_to_ddm=function(q,E,B,C,G){return t("ddm",q,E,B,C,G)};A.ddm_to_geog=function(q,E,B,C){return w("ddm",q,E,B,C)};A.geog_to_dd=function(q,E,B,C,G){return t("dd",q,E,
B,C,G)};A.dd_to_geog=function(q,E,B,C){return w("dd",q,E,B,C)}})(g.PeNotationDms||(g.PeNotationDms={}));var e;(function(A){A.init=function(){A.PE_MGRS_STYLE_NEW=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;A.PE_MGRS_STYLE_OLD=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;A.PE_MGRS_STYLE_AUTO=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;A.PE_MGRS_180_ZONE_1_PLUS=g._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;A.PE_MGRS_ADD_SPACES=g._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
A.geog_to_mgrs_extended=function(t,w,q,E,B,C,G){g._pe.ensureCache.prepare();var D=0;t&&(D=g._pe.getPointer(t));t=c(q);q=g._pe.ensureFloat64(t);t=a(w,n.PE_MGRS_MAX);var f=g._pe.ensureInt32(t);if(E=g._pe._pe_geog_to_mgrs_extended(D,w,q,E,B,C,f))for(B=0;B<w;B++)G[B]=g._pe.UTF8ToString(t[B]);return E};A.mgrs_to_geog_extended=function(t,w,q,E,B){g._pe.ensureCache.prepare();var C=0;t&&(C=g._pe.getPointer(t));t=q.map(function(G){return g._pe.ensureString(G)});q=g._pe.ensureInt32(t);t=g._pe.ensureFloat64(Array(2*
w));(E=g._pe._pe_mgrs_to_geog_extended(C,w,q,E,t))&&l(B,w,t);return E}})(e=g.PeNotationMgrs||(g.PeNotationMgrs={}));(function(A){A.geog_to_usng=function(t,w,q,E,B,C,G){g._pe.ensureCache.prepare();var D=0;t&&(D=g._pe.getPointer(t));t=c(q);q=g._pe.ensureFloat64(t);t=a(w,n.PE_MGRS_MAX);var f=g._pe.ensureInt32(t);if(E=g._pe._pe_geog_to_usng(D,w,q,E,B,C,f))for(B=0;B<w;B++)G[B]=g._pe.UTF8ToString(t[B]);return E};A.usng_to_geog=function(t,w,q,E){g._pe.ensureCache.prepare();var B=0;t&&(B=g._pe.getPointer(t));
t=q.map(function(C){return g._pe.ensureString(C)});q=g._pe.ensureInt32(t);t=g._pe.ensureFloat64(Array(2*w));(B=g._pe._pe_usng_to_geog(B,w,q,t))&&l(E,w,t);return B}})(g.PeNotationUsng||(g.PeNotationUsng={}));var u;(function(A){A.init=function(){A.PE_UTM_OPTS_NONE=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;A.PE_UTM_OPTS_ADD_SPACES=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;A.PE_UTM_OPTS_NS=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};A.geog_to_utm=function(t,w,q,E,B){g._pe.ensureCache.prepare();
var C=0;t&&(C=g._pe.getPointer(t));t=c(q);q=g._pe.ensureFloat64(t);t=a(w,n.PE_UTM_MAX);var G=g._pe.ensureInt32(t);if(E=g._pe._pe_geog_to_utm(C,w,q,E,G))for(C=0;C<w;C++)B[C]=g._pe.UTF8ToString(t[C]);return E};A.utm_to_geog=function(t,w,q,E,B){g._pe.ensureCache.prepare();var C=0;t&&(C=g._pe.getPointer(t));t=q.map(function(G){return g._pe.ensureString(G)});q=g._pe.ensureInt32(t);t=g._pe.ensureFloat64(Array(2*w));(E=g._pe._pe_utm_to_geog(C,w,q,E,t))&&l(B,w,t);return E}})(u=g.PeNotationUtm||(g.PeNotationUtm=
{}));var z;(function(A){var t=new Map;A.init=function(){A.PE_PCSINFO_OPTION_NONE=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;A.PE_PCSINFO_OPTION_DOMAIN=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;A.PE_POLE_OUTSIDE_BOUNDARY=g._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;A.PE_POLE_POINT=g._pe.PePCSInfo.prototype.PE_POLE_POINT};A.generate=function(w,q){void 0===q&&(q=A.PE_PCSINFO_OPTION_DOMAIN);var E;if(t.has(w)){var B=t.get(w);B[q]&&(E=B[q])}E||(E=g._pe.PePCSInfo.prototype.generate(w,
q),B||(B=[],t.set(w,B)),B[q]=E);return E}})(z=g.PePCSInfo||(g.PePCSInfo={}));(function(A){A.version_string=function(){return g._pe.PeVersion.prototype.version_string()}})(g.PeVersion||(g.PeVersion={}));g._init=h})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,x){g.__proto__=x}||function(g,x){for(var p in x)x.hasOwnProperty(p)&&(g[p]=x[p])};return function(g,x){function p(){this.constructor=
g}K(g,x);g.prototype=null===x?Object.create(x):(p.prototype=x.prototype,new p)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(K,g,x){return function(){function p(r){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(r&&r.steps){var h=0;for(r=r.steps;h<r.length;h++){var b=r[h];b instanceof x?this.steps.push(b):this.steps.push(new x({wkid:b.wkid,wkt:b.wkt,isInverse:b.isInverse}))}}}p.cacheKey=
function(r,h){return[void 0!==r.wkid&&null!==r.wkid?r.wkid.toString():"-1",void 0!==r.wkt&&null!==r.wkt?r.wkt.toString():"",void 0!==h.wkid&&null!==h.wkid?h.wkid.toString():"-1",void 0!==h.wkt&&null!==h.wkt?h.wkt.toString():""].join()};p.fromGE=function(r){var h=new p,b="",a=0;for(r=r.steps;a<r.length;a++){var c=x.fromGE(r[a]);h.steps.push(c);b+=c.uid.toString()+","}h._cached_projection={};h._gtlistentry=null;h._chain=b;return h};p.prototype.getInverse=function(){var r=new p;r.steps=[];for(var h=
this.steps.length-1;0<=h;h--)r.steps.push(this.steps[h].getInverse());return r};p.prototype.getGTListEntry=function(){for(var r="",h=0,b=this.steps;h<b.length;h++)r+=b[h].uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);return this._gtlistentry};p.prototype.assignCachedGe=function(r,h,b){this._cached_projection[p.cacheKey(r,h)]=b};p.prototype.getCachedGeTransformation=function(r,h){for(var b="",a=0,c=this.steps;a<c.length;a++)b+=c[a].uid.toString()+
",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);r=this._cached_projection[p.cacheKey(r,h)];return void 0===r?null:r};return p}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require","exports"],function(K,g){var x=0;return function(){function p(r){void 0===r&&(r=null);this.uid=x++;r?(this._wkt=void 0!==r.wkt?r.wkt:null,this._wkid=void 0!==r.wkid?r.wkid:-1,this._isInverse=void 0!==r.isInverse?!0===r.isInverse:!1):(this._wkt=null,this._wkid=
-1,this._isInverse=!1)}p.fromGE=function(r){var h=new p;h._wkt=r.wkt;h._wkid=r.wkid;h._isInverse=r.isInverse;return h};Object.defineProperty(p.prototype,"wkt",{get:function(){return this._wkt},set:function(r){this._wkt=r;this.uid=x++},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"wkid",{get:function(){return this._wkid},set:function(r){this._wkid=r;this.uid=x++},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"isInverse",{get:function(){return this._isInverse},
set:function(r){this._isInverse=r;this.uid=x++},enumerable:!0,configurable:!0});p.prototype.getInverse=function(){var r=new p;r._wkt=this.wkt;r._wkid=this._wkid;r._isInverse=!this.isInverse;return r};return p}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C){K=g([C],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(G){},open:function(){var G=new p,D=this.serviceInfo||this._getServiceInfo(null),f=x.hitch(this,function(y){this.serviceInfo=y;this.version=y.currentVersion;this.rasterInfo=this._parseRasterInfo(y);this.loaded=!0;this._getRasterIdentifier();G.resolve(this)}),m=x.hitch(this,function(y){this.loaded=!0;this._getRasterIdentifier();G.reject(y)});l(D,f,m);return G.promise},
read:function(G){var D=this.url+"/tile/"+G.level+"/"+G.row+"/"+G.col,f={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:D+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:f,tileOptions:G})},identify:function(G,D){null==D&&(D=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var f=(G.x-this.tileInfo.origin.x)/
this.tileInfo.lods[D].resolution/this.tileInfo.cols;G=(this.tileInfo.origin.y-G.y)/this.tileInfo.lods[D].resolution/this.tileInfo.rows;var m=Math.floor(f),y=Math.floor(G),v=Math.floor((f-m)*this.tileInfo.cols);v=Math.min(v,this.tileInfo.cols-1);var F=Math.floor((G-y)*this.tileInfo.rows);F=Math.min(F,this.tileInfo.rows-1);var H=new p;this.read({level:D,row:y,col:m}).then(function(L){var N=F*L.width+v;L&&L.pixels&&0<L.pixels.length?(L=L.mask?L.mask[N]?L.pixels.map(function(Q){return Q[N]}):null:L.pixels.map(function(Q){return Q[N]}),
H.resolve(L)):H.reject("no valid data")},function(L){H.reject(L)});return H.promise},setFetchParameters:function(G,D){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var G=this.url,D=new p(A._dfdCanceller);D._pendingDfd=d({url:G,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});D._pendingDfd.then(function(f){D.callback(f)},function(f){D.errback(f)});return D},_parseRasterInfo:function(G){var D=
new B;D.extent=new e(G.fullExtent);D.spatialReference=new z(G.spatialReference);this.tileType=G.cacheType||"Map";switch(this.tileType){case "Map":D.bandCount=3;D.pixelType="U8";this.dataType="Processed";break;case "Elevation":D.bandCount=1;D.pixelType=G.pixelType||"F32";this.dataType="Elevation";break;case "Raster":D.bandCount=null,D.pixelType=null,this.dataType=G.serviceDataType&&G.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var f=G.tileInfo;D.width=Math.floor((G.fullExtent.xmax-
G.fullExtent.xmin)/f.lods[f.lods.length-1].resolution+.5);D.height=Math.floor((G.fullExtent.ymax-G.fullExtent.ymin)/f.lods[f.lods.length-1].resolution+.5);D.cellSize=new u({x:f.lods[f.lods.length-1].resolution,y:f.lods[f.lods.length-1].resolution,spatialReference:G.spatialReference});this.tileInfo=new E(f);this.tileInfo.tileType=this.tileType;return D}});a("extend-esri")&&x.setObject("layers.rasterLib.raster.TileServiceRaster",K,k);return K})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C){K=g([C],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(G){this._cloudBlobStorage=G&&G._cloudBlobStorage},open:function(){var G=new p,D=this.datasetInfo||this._getDatasetInfo(null),f=x.hitch(this,function(y){this.datasetInfo=y;this.rasterInfo=y=this._parseRasterInfo(y);this.tileType="Cache/LERC"===y.format?"Elevation":"Cache/MIXED"===y.format||"Cache/JPEG"===y.format||"Cache/PNG"===
y.format?"Map":"Raster";this.tileInfo=y.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=y.packetSize*y.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();G.resolve(this)}),m=x.hitch(this,function(y){this.loaded=
!0;this._getRasterIdentifier();G.reject(y)});l(D,f,m);return G.promise},read:function(G){var D=new p,f=G.level,m=G.row,y=G.col,v=this._buildCacheFilePath(this.url,f,m,y),F=this._getIndexRecordFromBundle(f,m,y);d({url:v,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(x.hitch(this,function(H,L){if(!D.isCanceled()){console.log("time in ms request "+(new Date-N));var N=new Date;H=new Uint8Array(H);H=this._getTileEndAndContentType(H,F);L={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:v+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+H.position.toString()+"-"+(H.position+H.recordSize).toString()},decodeParams:L,tileOptions:G}).then(function(Q){D.isCanceled()||D.resolve(Q)},function(Q){D.isCanceled()||D.reject(Q)})}}));return D.promise},identify:function(){return null},
setFetchParameters:function(G,D){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return d({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(G){var D=new B;switch(G.pixelType){case 1:var f="U1";break;case 1:f="U2";break;case 2:f="U4";break;case 3:f="U8";break;case 4:f="S8";break;
case 5:f="U16";break;case 6:f="S16";break;case 7:f="U32";break;case 8:f="S32";break;case 9:f="F32";break;default:f="F32"}var m,y=[],v=G.LODInfos;for(m=0;m<v.levels.length;m++)y.push({level:v.levels[m],resolution:v.resolutions[m],scale:96/.0254*v.resolutions[m]});m=new z(G.extent.spatialReference||G.geodataXform.spatialReference);y=new E({rows:G.blockHeight,cols:G.blockWidth,dpi:96,format:G.format,compressionQuality:0,origin:G.origin,spatialReference:m,lods:y});D.pixelType=f;D.bandCount=G.bandCount;
D.spatialReference=m;D.extent=new e({xmin:G.extent.xmin,ymin:G.extent.ymin,xmax:G.extent.xmax,ymax:G.extent.ymax,spatialReference:m});D.cellSize=new u({x:G.pixelSizeX,y:G.pixelSizeY,spatialReference:m});D.width=Math.floor((D.extent.xmax-D.extent.xmin)/D.cellSize.x+.5);D.height=Math.floor((D.extent.ymax-D.extent.ymin)/D.cellSize.y+.5);D.statistics=G.statistics.map(function(F){Object.keys(F).forEach(function(H){isNaN(F[H])&&(F[H]=null)});return F});D.histograms=G.histograms;D.geodataXform=G.geodataXform;
D.packetSize=G.packetSize;D.format=G.format;D.compressionQuality=G.compressionQuality;D.tileInfo=y;return D},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(G,D,f,m){var y=this.rasterInfo.packetSize;m=Math.floor(m/y)*y;f="R"+this._toHexString4(Math.floor(f/y)*y)+"C"+this._toHexString4(m);y="L";y=10<=D?y+D.toString():y+("0"+D.toString());return this._cloudBlobStorage?G+"/_alllayers/"+
y+"/"+f+".bundle":G+"/"+y+"_"+f+"/bundle"},_getIndexRecordFromBundle:function(G,D,f){G=this.rasterInfo.packetSize;D=D%G*G+f%G;if(0>D)throw"Invalid level / row / col";return D*this._RECORD_SIZE+64},_getTileEndAndContentType:function(G,D){G=G.subarray(D,D+8);D=0;var f;for(f=0;5>f;f++)D|=(G[f]&255)<<8*f;var m=D&0xffffffffff;D=0;for(f=5;8>f;f++)D|=(G[f]&255)<<8*(f-5);return{position:m,recordSize:D&0xffffffffff}},_toHexString4:function(G){G=G.toString(16);if(4!=G.length)for(var D=4-G.length;0<D--;)G="0"+
G;return G}});a("extend-esri")&&x.setObject("layers.rasterLib.raster.TileRaster",K,k);return K})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C){K=g([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(G){G&&G.rasterFx&&this._init(G.rasterFx,G.rasterFxArgs)},open:function(){var G=this.getMemberRasters().map(function(f){return f.open()});this.identifiers=this.getMemberRasters().map(function(f){return f._rasterId});var D=new p;(new c(G,null,null,!0)).then(function(f){f.some(function(m){return!m[0]})?D.reject(f):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=f[0][1].tileInfo,D.resolve(this))}.bind(this));return D.promise},getProjectedFullExtent:function(G){var D=new p;this.getMemberRasters()[0].getProjectedFullExtent(G).then(x.hitch(this,function(f){this.projectedFullExtent=f;D.resolve(f)}));return D.promise},setProcessingContext:function(G){var D=G;G.layer&&(G=G.layer,
D={id:G.id,rawRasterInfo:G.raster.rasterInfo,glSetting:G._glSetting,xformSetting:G.tileManager&&G.tileManager.xformSetting,useWebGL:G.useWebGL,resampling:G.tileMode&&G.tileManager&&G.tileManager.xformSetting.requireProjection&&!G._hasTilingEffects&&"Thematic"!==G.raster.dataType?1:0,tileMode:G.tileMode});this.rasterFunction.setProcessingContext(D);this._layerOptions=D},alterDefinition:function(G){if(G=G||this.rasterFunction)1===this.memberRasters.length&&!G._bindComplete&&(this.rasterFunction=C.create(G,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(G,D){var f=this.getMemberRasters();
f&&1===f.length&&f[0].setFetchParameters(G,D)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(G){var D=new p(e._dfdCanceller);if(G.src){var f=this.rasterFunction.read(G);D.resolve(f);return D.promise}var m=this.getMemberRasters().map(function(H){return H.read(G)});m=new c(m);var y,v,F=this.identifiers;D._pendingDfd=m;m.then(x.hitch(this,function(H){if(y=
H.some(function(L){return L[0]}))v={},H.forEach(function(L,N){v[F[N]]=L[0]?L[1]:null});f=v?this.rasterFunction.read({extent:G.extent,src:v}):null;f.srcData=v;D.resolve(f)}));return D},_init:function(G,D){if(this.rasterFunction=C.create(G,D))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(G,D){var f=Object.keys(G),m,y,v;for(m=0;m<f.length;m++)if(v=G[f[m]]){var F=v instanceof Array?v:[v];for(y=0;y<F.length;y++)(v=
F[y])&&("function"===typeof v||"object"===typeof v)&&v.read&&(v.functionArguments?this._getMemberRasters(v.functionArguments,D):v.sourceType&&"Function"!==v.sourceType&&(v._identifier=v._getRasterIdentifier(),D.some(function(H){return H._identifier===v._identifier})||D.push(v)))}return D}});a("extend-esri")&&x.setObject("layers.rasterLib.raster.FunctionRaster",K,k);return K})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(K){return function(g,x,p,r,h){this.list=
g;x=new K(g,x,p,r,h);var b=x.resolve.bind(x),a=x.cancel.bind(x);x.cancel=function(){g&&g.forEach(function(c){c.cancel&&c.cancel()});a.apply(this,arguments)}.bind(x);x.resolve=function(){this.isFulfilled()||b.apply(this,arguments)}.bind(x);return x}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k){var n=function(d,e){var u;for(u=0;u<d.length;u++)if(e(d[u]))return u;return-1};return K(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(d){this.tiles=[];this.xformSetting={};this.mapSpatialReference=d&&d.mapSR;this.layer=d&&d.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(e){return e._rasterId}):[this.layer.raster._rasterId];(d=d&&d.tileInfo)&&this.setTileInfo(d)},setTileInfo:function(d){this.tileInfo=d;this.virtual=d.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=k.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=k.getHalfWorldWidth(d.spatialReference)},updateResolution:function(d,e){if(!(this.mapResolution&&d&&this._resolutionEqual(this.mapResolution.x,d.x)&&this._resolutionEqual(this.mapResolution.y,d.y))){this.resetTiles();var u=this.xformSetting.requireProjection;this.mapResolution=this.resolution=d;u&&(this.resolution=k.projectResolution(d,this.tileInfo.spatialReference,this.layer.projectedFullExtent||e));this._resolution=
this.resolution;d=this.resolution;if(!this.tileInfo.virtual){u=.75*Math.min(d.x,d.y)+.25*Math.max(d.x,d.y);if(u>=this.tileInfo.lods[0].resolution){var z=this.tileInfo.lods[0];this.ooe=!0}else{if(u<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)z=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(d=0;d<this.tileInfo.lods.length-1;d++)if(z=this.tileInfo.lods[d],e=this.tileInfo.lods[d+1],z.resolution>=u&&e.resolution<=u){z.resolution-u>u-e.resolution&&(z=e);break}this.ooe=!1}this.level=
z&&z.level;d=this.resolution=new a({x:z.resolution,y:z.resolution,spatialReference:this.tileInfo.spatialReference})}u=this.layer.raster.rasterInfo.extent;z=this.tileInfo.origin;e=this.tileInfo.cols;var A=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((z.y-u.ymax)/d.y/A),rowEnd:Math.floor((z.y-u.ymin-d.y)/d.y/A),colStart:Math.floor((u.xmin-z.x)/d.x/e),colEnd:Math.floor((u.xmax-z.x-d.x)/d.x/e)};if(u=this.halfWorldWidth){A=Math.ceil(u/d.x/(e/2));var t=this.tileInfo.applyGCS360Transform?360:
u,w=Math.round(e-(t-z.x)/d.x%e);w===e&&(w=0);this.fullBoundary.colRange=A;this.fullBoundary.paddingRight=w;this.fullBoundary.paddingLeft=Math.round((A*e*d.x+z.x-t-(this.tileInfo.applyGCS360Transform?0:z.x+u))/d.x)}this.hasNewData=!0}},getXformGrid:function(){var d=this.mapExtent,e=this.layer._hasTilingEffects?this.extent:this.fullExtent,u=this.layer.getCurrentResolution(),z=JSON.stringify(d.toJson())+JSON.stringify(e.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=k.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,d.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===z||(this._cachedExtentString=z,this._xformGrid=d=k.getProjectionOffsetGrid(d,e,u,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));d=this._xformGrid;this.xformSetting.meshSize=d&&d.size;return d},getWrapTimes:function(d){var e=k.getHalfWorldWidth(d.spatialReference);if(!e)return 0;var u=
2*e;e=this.tileInfo.applyGCS360Transform?0:-e;return Math.floor((d.xmax-e)/u)-Math.floor((d.xmin-e)/u)},normalizeCoordinate:function(d,e){if(!e)return 0;var u=2*e;if(0<d){for(;d>e;)d-=u;return d}for(;d<-e;)d+=u;return d},resetTiles:function(){this.tiles.forEach(g.hitch(this,function(d){d.fetch&&!d.fetch.isCanceled()&&d.fetch.cancel();d.update&&!d.update.isCanceled()&&d.update.cancel()}));this.tiles.length=0},updateExtent:function(d,e){this.mapExtent=this.extent=d;var u=this.xformSetting.requireProjection;
if(u){this.extent=k.project(d,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new b(this.extent.spatialReference.toJson())}else if(d.spatialReference.isWebMercator()||4326===d.spatialReference.wkid){var z=4326===d.spatialReference.wkid?180:this.halfWorldWidth,A=d.xmin;if(A<-z||A>z){for(var t=d.xmax,w=2*z;A<-z;)A+=w,t+=w;for(;A>z;)A-=w,t-=w;this.mapExtent=this.extent=d=new h(A,d.ymin,t,d.ymax,d.spatialReference)}}this.updateResolution(e,
d);z=this.extent;A=this.tileInfo;t=A.cols;w=A.rows;e=this.resolution;var q=z;u=u?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(q=this._getIntersect(z,u));var E=Math.floor((q.xmin-A.origin.x)/e.x/t)-this.prefetchBufferSize,B=Math.floor((q.xmax-A.origin.x)/e.x/t)+this.prefetchBufferSize,C=null,G=this.getWrapTimes(d),D=this.fullBoundary&&this.fullBoundary.colRange;G&&this.halfWorldWidth&&(B===E&&(C=E),B+=G*D);if(d=this.halfWorldWidth&&this.tiles.length&&(G!==this.wrapTimes||
C!==this._circlularColId))this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1;this.wrapTimes=G;this._circlularColId=C;var f=Math.floor((A.origin.y-q.ymax)/e.y/w)-this.prefetchBufferSize;C=Math.floor((A.origin.y-q.ymin)/e.y/w)+this.prefetchBufferSize;this.tileBoundary={rowStart:f,rowEnd:C,colStart:E,colEnd:B};var m,y;((q=(C-f+1)*(B-E+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<G||d)&&this.resetTiles();if(!(q||2<G)){q=this.tiles;d=!1;
for(m=q.length-1;0<=m;m--){var v=q[m].row;var F=q[m].wrapCol;if(v<f||v>C||F<E||F>B)q[m].fetch&&!q[m].fetch.isCanceled()&&q[m].fetch.cancel(),q[m].update&&!q[m].update.isCanceled()&&q[m].update.cancel(),q.splice(m,1),d=!0}for(m=f;m<=C;m++)for(y=E;y<=B;y++){f=new h(A.origin.x+e.x*t*y,A.origin.y-e.y*w*(m+1),A.origin.x+e.x*t*(y+1),A.origin.y-e.y*w*m,z.spatialReference);var H=G&&D?0<=y?y%D:D- -y%D:y;v=n(q,function(L){return L.row===m&&L.col===H&&L.wrapCol===y});F=u.xmax>=f.xmax?t:Math.round((u.xmax-f.xmin)/
e.x);-1===v&&(q.push({row:m,col:H,wrapCol:y,cellsizeX:e.x,cellsizeY:e.y,width:t,height:w,actualWidth:F,extent:f,normalizedExtent:this._wrapExtent(f,H),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),d=!0)}d&&this._sortTiles();e=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=e;this.count=q.length;e=Math.min.apply(null,q.map(function(L){return L.extent.xmin}));
A=Math.max.apply(null,q.map(function(L){return L.extent.xmax}));t=Math.min.apply(null,q.map(function(L){return L.extent.ymin}));w=Math.max.apply(null,q.map(function(L){return L.extent.ymax}));e=this.fullExtent=new h(e,t,A,w,z.spatialReference);if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(d&&(this._tilesChanged=!0),this.xformSetting.offset=[(z.xmin-e.xmin)/(e.xmax-e.xmin),-(e.ymin-z.ymin)/(e.ymax-e.ymin)],this.xformSetting.scale=
[(z.xmax-z.xmin)/(e.xmax-e.xmin),(z.ymax-z.ymin)/(e.ymax-e.ymin)])}},fetchTiles:function(d){(this._tilesChanged||d)&&this._fetchTiles(d)},_fetchTiles:function(d){this._fetchCounter=0;var e=this.extent;this.fetchAllCompleted=d?new x:null;(this._tilesChanged||d&&this.layer._hasTilingEffects)&&this.tiles.forEach(g.hitch(this,function(z){z.updateCompleted=!1}));var u={};!this.layer.roaming&&this.layer._hasTilingEffects&&d?(this.identifiers.forEach(function(z,A){u[z]={extent:this.extent,pixelBlock:new c({width:this.layer._map.width,
height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:u,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(z,A){u[z]={extent:this.fullExtent,pixelBlock:new c({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:u,isEmpty:!0});this.tiles.forEach(g.hitch(this,function(z){if(z.fetch)z.update||(z.update=this.updateTile(z));
else{if(this._isTileOutSide(z,e)){z.updateCompleted=!0;return}this._requestTile(z)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(z):z.src&&d&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&(this._fillPixelData(z),this.layer._hasTilingEffects&&(z.updateCompleted=!0),z.processedPixelBlock=null,z.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;d&&this._updateFetchStatus()},updateTile:function(d,e){var u=new x;if(!d.src&&!d.fetch)return u.resolve(d),
u.promise;p(d.src||d._fetched||d.fetch,g.hitch(this,function(){var z=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),A=this.layer._drawTile,t=this._validateRawPixelBlocks(d);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(A=A&&(this._progressiveGlobal||e));if((e||!e&&t)&&(z||A||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return u.cancel(),
u.promise;this._processTile(d,e).then(g.hitch(this,function(w){u.isCanceled()||this._renderTile(w,e).then(g.hitch(this,function(q){this.hasNewData=!1;u.isCanceled()||u.resolve(q)}))}))}else e||t||(d.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?u.resolve(this.originalPixelData):u.resolve()}));return u.promise},setLayer:function(d){this.layer=d},fillupTiles:function(){this.tiles.forEach(g.hitch(this,function(d){d.update&&d.updateCompleted&&!d.filled&&(d.updateCompleted=!1,this._fillPixelData(d),
d.updateCompleted=!0)}))},_validateRawPixelBlocks:function(d){return d&&d.src&&!this.identifiers.some(function(e){return!(d.src[e].pixelBlock&&0!==d.src[e].pixelBlock.validPixelCount&&d.src[e].pixelBlock.pixels&&0<d.src[e].pixelBlock.pixels.length)})},_wrapExtent:function(d,e){if(d){if(this.tileInfo.applyGCS360Transform){var u=this.normalizeCoordinate(d.xmin,180);0>u&&(u+=360);return new h({xmin:u,ymin:d.ymin,xmax:d.xmax-d.xmin+u,ymax:d.ymax,spatialReference:d.spatialReference})}if(this.halfWorldWidth){u=
null!=e?new h({xmin:this.tileInfo.origin.x+this.tileInfo.cols*e*this.resolution.x,ymin:d.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(e+1)*this.resolution.x,ymax:d.ymax,spatialReference:d.spatialReference}):new h({xmin:d.xmin,ymin:d.ymin,xmax:d.xmax,ymax:d.ymax,spatialReference:d.spatialReference});e=this.normalizeCoordinate(u.xmin,this.halfWorldWidth);var z=e-u.xmin;.01<Math.abs(z)&&(u.xmin=e,u.xmax+=z)}return u||d}},_getIntersect:function(d,e){return new h(Math.max(d.xmin,e.xmin),Math.max(d.ymin,
e.ymin),Math.min(d.xmax,e.xmax),Math.min(d.ymax,e.ymax),d.spatialReference)},_isTileOutSide:function(d,e){var u=!1;if(d.virtual){var z=d.normalizedExtent;if(e=e||(this.xformSetting.requireProjection?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){d=z.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;u=z.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var A=z.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;z=z.ymax+this.prefetchBufferSize*
this.tileInfo.rows*this.resolution.y;u=A<=e.xmin||d>=e.xmax||z<=e.ymin||u>=e.ymax}else u=!1}else u=0>d.level||d.row<this.fullBoundary.rowStart||d.row>this.fullBoundary.rowEnd||d.col<this.fullBoundary.colStart||d.col>this.fullBoundary.colEnd;return u},_resolutionEqual:function(d,e){return d===e||d&&e&&Math.abs(d-e)<Math.abs(e/1E4)?!0:!1},_requestTile:function(d){var e=this.identifiers,u;if(this._isTileOutSide(d)){var z=new x;d.updateCompleted=!0;z.resolve(null);z=z.promise}else z=this.layer.raster.rasterFunction?
new r(this.layer.raster.getMemberRasters().map(function(A){return A.read(d)})):new r([this.layer.raster.read(d)]);d.fetch=z;this._fetchCounter++;p(d.src||d._fetched||z,g.hitch(this,function(A){if(u=A&&A.some(function(w){return w[0]})){var t={};A.forEach(function(w,q){t[e[q]]=w[0]&&w[1]?{extent:w[1].extent,pixelBlock:w[1].pixelBlock,width:w[1].width,height:w[1].height}:null});d.src=t}else d.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}),
g.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}));d.update=this.updateTile(d)},_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(d){return!d._fetched})&&(this.tiles.forEach(g.hitch(this,function(d){this._fillPixelData(d)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(d,e){if(d&&!d.updateCompleted)if(Math.abs(d.cellsizeX-
this.resolution.x)>d.cellsizeX/10)d.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(d))d.updateCompleted=!0;else{var u=d.extent;if(this.layer.roaming||this.layer.useWebGL&&!this.layer._hasTilingEffects){var z=this.fullExtent;var A=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var t=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:A,
height:t,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(g.hitch(this,function(q){this.originalPixelData.src[q].pixelBlock.width=A;this.originalPixelData.src[q].pixelBlock.height=t}))}else z=this.extent,A=this.layer._map.width,t=this.layer._map.height,e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:A,height:t,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(g.hitch(this,function(q){this.originalPixelData.src[q].pixelBlock.width=
A;this.originalPixelData.src[q].pixelBlock.height=t}));if(z.xmax<=u.xmin||z.xmin>=u.xmax||z.ymax<=u.ymin||z.ymin>=u.ymax)return null;var w=this.originalPixelData.isEmpty=!1;this.identifiers.forEach(g.hitch(this,function(q){d.src&&(this._fillPixelBlock(d.src[q],this.originalPixelData.src[q],{extent:z,width:A,height:t,normalizedExtent:d.normalizedExtent},!1),w=!0)}));d.filled=w;this.hasNewData=!0}},_fillPixelBlock:function(d,e,u,z){var A=d.extent,t=u.extent;z=u.width;var w=u.height;if(d.pixelBlock&&
d.pixelBlock.pixels&&d.pixelBlock.pixels[0]){var q=(A.xmax-A.xmin)/d.width,E=Math.max(A.xmin,t.xmin),B=Math.min(A.ymax,t.ymax),C=Math.round((E-A.xmin)/q),G=d.width-Math.round(Math.abs(A.xmax-Math.min(A.xmax,t.xmax))/q),D=Math.round(Math.abs(A.ymax-B)/q),f=d.height-Math.round((Math.max(A.ymin,t.ymin)-A.ymin)/q),m=this.halfWorldWidth;E=Math.round((E-t.xmin)/q);u=u.normalizedExtent;if(!(this.wrapTimes&&m&&A.xmin<-m)){if(this.wrapTimes&&m){if(this.tileInfo.applyGCS360Transform)360<A.xmin&&(E-=this.fullBoundary.paddingLeft);
else if(A.xmin>m){E-=this.fullBoundary.paddingLeft;var y=this.normalizeCoordinate(A.xmin,m);var v=this.normalizeCoordinate(A.xmax,m)}else y=A.xmin,v=A.xmax;this.tileInfo.applyGCS360Transform?u&&360>u.xmin&&360<u.xmax&&(G-=this.fullBoundary.paddingRight):u&&u.xmin<m&&u.xmax>m?G-=this.fullBoundary.paddingRight:y<m&&v>m&&(G-=this.fullBoundary.paddingRight)}y=Math.round(Math.abs(t.ymax-B)/q);v=d.pixelBlock.pixels.length;e=e.pixelBlock;u=d.width;A=e.mask||new Uint8Array(z*w);var F=d.pixelBlock,H=F.mask,
L=0;for(q=0;q<v;q++){B=F.pixels[q];m=e.pixels[q]||new B.constructor(z*w);for(d=D;d<f;d++)for(L=(y+d-D)*z+E,t=C;t<G;t++)m[L+t-C]=B[d*u+t];e.pixels[q]=m}if(H)for(d=D;d<f;d++)for(L=(y+d-D)*z+E,t=C;t<G;t++)A[L+t-C]=H[d*u+t];else for(d=D;d<f;d++)for(L=(y+d-D)*z+E,t=C;t<G;t++)A[L+t-C]=1;e.pixelType=e.pixelType||F.pixelType;e.mask=A;if(!(e.statistics&&0<e.statistics.length))for(e.statistics=[],d=0;d<F.statistics.length;d++)e.statistics[d]={minValue:F.statistics[d].minValue,maxValue:F.statistics[d].maxValue};
else if(F.statistics&&e.statistics)for(d=0;d<e.statistics.length;d++)e.statistics[d].minValue=Math.min(F.statistics[d].minValue,e.statistics[d].minValue),e.statistics[d].maxValue=Math.max(F.statistics[d].maxValue,e.statistics[d].maxValue)}}},_processTile:function(d,e){var u=new x,z=this.layer._hasTilingEffects,A=this.layer.useWebGL,t=z||A,w=this.layer.raster.rasterFunction&&d&&(z||A||!d.processedPixelBlock);if(e)var q=d;else this._fillPixelData(d),q=t?this.originalPixelData:d;this.xformSetting.hasNewTexture=
this.hasNewData;var E;w?(this.identifiers.forEach(function(B){if(0===q.src[B].pixelBlock.pixels.length||0===q.src[B].pixelBlock.pixels[0].length)E=!0}),E?u.resolve({extent:q.extent,processedPixelBlock:q.src[this.identifiers[0]],pixelBlock:q.src[this.identifiers[0]]}):A?(this.processedPixelData=this.layer.raster.rasterFunction.read(q),u.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:q.extent,src:q.src}).then(function(B){z?(this.processedPixelData=
B,u.resolve(this.processedPixelData)):(d.processedPixelBlock=B.pixelBlock,u.resolve(d))}):(e=this.layer.raster.rasterFunction.read(d),d.processedPixelBlock=e.pixelBlock,u.resolve(d))):t?u.resolve(q.src[this.identifiers[0]]):(d.pixelBlock=q.src[this.identifiers[0]]&&q.src[this.identifiers[0]].pixelBlock,u.resolve(d));return u.promise},_renderTile:function(d){var e=new x,u=this.layer._hasTilingEffects,z=this.layer.useWebGL,A=Math.abs((d.extent.xmax-d.extent.xmin)/d.width-this.layer.getCurrentResolution().x)>
this.resolution.x/10;A=this.layer.useWebGL&&(A||this._isTileOutSide(d,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&d&&(d.texture||d.src||d.pixelBlock||d.processedPixelBlock)?(this.layer._rasterRenderer.interpolation=this.layer.interpolation,z&&!A?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(d),e.resolve(d)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:d.extent,
pixelBlock:d.processedPixelBlock||d.pixelBlock}).then(function(t){u?(t.renderedPixelBlock=t.pixelBlock,e.resolve(t)):(d.renderedPixelBlock=t.pixelBlock,e.resolve(d))}.bind(this)):(d.renderedPixelBlock=this.layer._rasterRenderer.draw(d).pixelBlock,e.resolve(d))):(d.renderedPixelBlock=d.processedPixelBlock||d.pixelBlock,e.resolve(d));return e.promise},_sortTiles:function(){this.tiles.sort(function(d,e){return d.row<e.row||d.row==e.row&&d.col<e.col?-1:1})}})})},"esri/layers/WMSLayer":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A){x=x([z],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],
[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(t,w){var q=k.urlToObject(t);q.query&&(q.query.version||q.query.Version||q.query.VERSION)&&
(this.version=q.query.version||q.query.Version||q.query.VERSION);this.url=t=this._stripParameters(t,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));this._url=k.urlToObject(t);this._getCapabilitiesURL=t;this._initLayer=p.hitch(this,this._initLayer);this._parseCapabilities=p.hitch(this,this._parseCapabilities);this._getCapabilitiesError=p.hitch(this,this._getCapabilitiesError);w?(this.customParameters=w.customParameters,
this.customLayerParameters=w.customLayerParameters,this.imageFormat=this._getImageFormat(w.format),this.imageTransparency=!1!==w.transparent,this.visibleLayers=w.visibleLayers?w.visibleLayers:[],this.version=w.version||this.version,w.resourceInfo?this._readResourceInfo(w.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=K.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);
this._createChildLayer()},setVisibleLayers:function(t){this.visibleLayers=(t=this._checkVisibleLayersList(t))?t:[];this.refresh(!0)},setImageFormat:function(t){this.imageFormat=this._getImageFormat(t);this.refresh(!0)},setImageTransparency:function(t){this.imageTransparency=t;this.refresh(!0)},setCustomParameters:function(t,w){this.customParameters=t;this.customLayerParameters=w;this.refresh(!0)},refresh:function(){this._refreshTS=Date.now();this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,
arguments)},getImageUrl:function(t,w,q,E){if(this.visibleLayers&&0!==this.visibleLayers.length){t=this._getImageParams(t,w,q);t=this._mixinCustomLayerParameters(t);w=this.getMapURL;var B;w+=-1===w.indexOf("?")?"?":"";for(B in t)t.hasOwnProperty(B)&&(w+="?"===w.substring(w.length-1,w.length)?"":"\x26",w+=B+"\x3d"+t[B]);w=this.addTimestampToURL(w);E(k.addProxy(w))}else E(this._blankImageURL)},_setMap:function(t,w,q){var E=this.inherited(arguments);t.wrapAround180?this._childLayer&&(this.suspended&&
this._childLayer.suspend(),this._childLayer._setMap(t,E)):this._childLayer=this.extentProcessor=null;return E},_unsetMap:function(t,w){this._childLayer&&this._childLayer._unsetMap(t,this._div);this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new z(null,{extentProcessor:this._createExtentProcessor(1)});
this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=p.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(t){return p.hitch(this,this._extentProcessor,t)},_extentProcessor:function(t,w){var q=w.extent,E=w.width,B=0;if(q){w=q.getWidth()/E;var C=q.bisect();q=C.extents;var G=q[t];G&&(E=C.marginLeft/w,B=0===t?E:E+q[0].getWidth()/w,E=Math.ceil(G.getWidth()/w),B=Math.ceil(B));q=G}return{extent:q,width:E,marginLeft:B}},_getImageParams:function(t,w,q){var E=
t.spatialReference.wkid;-1===r.indexOf(this.spatialReferences,E)&&t.spatialReference.latestWkid&&(E=t.spatialReference.latestWkid);if(r.some(this._WEB_MERCATOR,function(f){return f==E})){var B=r.filter(this.spatialReferences,function(f){return r.some(this._WEB_MERCATOR,function(m){return m==f})},this);0===B.length&&(B=r.filter(this.spatialReferences,function(f){return r.some(this._WORLD_MERCATOR,function(m){return m==f})},this));E=0<B.length?B[0]:this._WEB_MERCATOR[1]}this.spatialReferences=r.filter(this.spatialReferences,
function(f){return f!==E});this.spatialReferences.unshift(E);B=t.xmin;var C=t.xmax,G=t.ymin;t=t.ymax;var D={SERVICE:"WMS",REQUEST:"GetMap"};D.FORMAT=this.imageFormat;D.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";D.STYLES="";D.VERSION=this.version;D.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;D.WIDTH=w;D.HEIGHT=q;this.maxWidth<w&&(D.WIDTH=this.maxWidth);this.maxHeight<q&&(D.HEIGHT=this.maxHeight);w=E?E:NaN;isNaN(w)||("1.3.0"==this.version?D.CRS="EPSG:"+w:D.SRS="EPSG:"+w);"1.3.0"==
this.version&&this._useLatLong(w)?D.BBOX=G+","+B+","+t+","+C:D.BBOX=B+","+G+","+C+","+t;return D},_initLayer:function(t,w){this.spatialReference=new d(this.extent.spatialReference);this.initialExtent=new e(this.extent);this.fullExtent=new e(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);var q=p.hitch(this,function(){this.loaded=!0;this.onLoad(this);var E=this._loadCallback;E&&(delete this._loadCallback,E(this))});h("chrome")?(t=b.defaults.io,w="with-credentials"===
t.useCors?k.canUseXhr(this.getMapURL,!0):-1,(t=-1<w?t.corsEnabledServers[w]:null)&&t.withCredentials?l({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){q()}):q()):q()},_readResourceInfo:function(t){t.extent?t.layerInfos?(this.extent=t.extent,this.allExtents[0]=t.extent,this.layerInfos=t.layerInfos,this.description=t.description?t.description:"",this.copyright=t.copyright?t.copyright:"",this.title=t.title?t.title:"",this.getMapURL=t.getMapURL?t.getMapURL:
this._getCapabilitiesURL,this.getFeatureInfoURL=t.getFeatureInfoURL,this.featureInfoFormat=t.featureInfoFormat,this.version=t.version?t.version:"1.3.0",this.maxWidth=t.maxWidth?t.maxWidth:5E3,this.maxHeight=t.maxHeight?t.maxHeight:5E3,this.spatialReferences=t.spatialReferences?t.spatialReferences:[],this.imageFormat=this._getImageFormat(t.format),this.setScaleRange(t.minScale,t.maxScale),this.customLayerParameters=t.customLayerParameters||this.customLayerParameters,this.customParameters=t.customParameters||
this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},_getCapabilities:function(t){var w=this._url.query?this._url.query:{};w.SERVICE="WMS";w.REQUEST="GetCapabilities";this.version&&(w.VERSION=this.version);w=this._mixinCustomParameters(w);var q=this._url.path+"?",E;for(E in w)w.hasOwnProperty(E)&&(q+=
"?"==q.substring(q.length-1,q.length)?"":"\x26",q+=E+"\x3d"+w[E]);l({url:q,handleAs:t||"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(t,w){if(t){if("text"===w.handleAs){try{var q=(new DOMParser).parseFromString(t,"application/xml")}catch(m){}q&&!q.getElementsByTagName("parsererror").length||this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (XML Parse error.)"))}else q=
t;var E=this;this.version=this._getAttributeValue("WMS_Capabilities","version",q,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",q,"1.3.0"));t=this._getTag("Service",q);this.title=this._getTagValue("Title",t,"");this.title||(this.title=this._getTagValue("Name",t,""));this.copyright=this._getTagValue("AccessConstraints",t,"");this.description=this._getTagValue("Abstract",t,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",t,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",
t,5E3),10);if(t=this._getTag("Layer",q)){var B=this._getLayerInfo(t),C=0,G=null;t=this._getTag("Capability",q);r.forEach(t.childNodes,function(m){"Layer"==m.nodeName&&(0===C?G=m:(1===C&&B.name&&(B.name="",B.subLayers=[],B.subLayers.push(this._getLayerInfo(G))),B.subLayers.push(this._getLayerInfo(m))),C++)},this);if(B&&(this.layerInfos=B.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[B]),this.extent=B.extent,this.extent||(B.extent=new e(this.layerInfos[0].extent.toJson()),
this.extent=B.extent),this.allExtents=B.allExtents,this.allExtents&&this.allExtents.length||(B.allExtents=[],r.forEach(this.layerInfos[0].allExtents,function(m,y){m&&(B.allExtents[y]=new e(m.toJson()))}),this.allExtents=B.allExtents),this.spatialReferences=B.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length)){var D=function(m){var y;for(y=0;y<m.subLayers.length;y++){var v=m.subLayers[y],F=v.spatialReferences;!F.length&&v.subLayers&&0<v.subLayers.length&&(F=D(v));if(F.length)return F}return[]};
for(t=0;t<this.layerInfos.length&&(w=this.layerInfos[t],this.spatialReferences=this.layerInfos[0].spatialReferences,!this.spatialReferences.length&&w.subLayers&&0<w.subLayers.length&&(this.spatialReferences=D(w)),!this.spatialReferences.length);t++);}t=function(m){return(m=g.query("DCPType",E._getTag(m,q)))&&0<m.length&&(m=g.query("HTTP",m[0]))&&0<m.length&&(m=g.query("Get",m[0]))&&0<m.length&&(m=E._getAttributeValue("OnlineResource","xlink:href",m[0],null))?(m.indexOf("\x26")===m.length-1&&(m=m.substring(0,
m.length-1)),E._stripParameters(m,["service","request"])):null};w=function(m){var y=[];0===g.query("Operation",q).length?r.forEach(g.query("Format",E._getTag(m,q)),function(v){y.push(v.text?v.text:v.textContent)}):(r.forEach(g.query("Operation",q),function(v){v.getAttribute("name")===m&&r.forEach(g.query("Format",v),function(F){y.push(F.text?F.text:F.textContent)})}),y.length||r.forEach(g.query("Format",E._getTag(m,q)),function(v){y.push(v.text?v.text:v.textContent)}));return y};this.getMapURL=t("GetMap")||
this._getCapabilitiesURL;this.getMapFormats=w("GetMap");this.getMapFormats.length&&!r.some(this.getMapFormats,function(m){return-1<m.indexOf(this.imageFormat)},this)&&(this.imageFormat=this.getMapFormats[0]);if(this.getFeatureInfoURL=t("GetFeatureInfo"))this.getFeatureInfoFormats=w("GetFeatureInfo"),-1<r.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<r.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain");if(!this.featureInfoFormat){var f=
function(m){if(m&&(m.queryable=!1,m.subLayers))for(var y=0;y<m.subLayers.length;y++)f(m.subLayers[y])};f(B)}this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."))}else"xml"===w.handleAs?this._getCapabilities("text"):this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(t){t&&t.message&&(t.message="GetCapabilities request for "+this._getCapabilitiesURL+
" failed. ("+t.message+")");this._errorHandler(t)},_getLayerInfo:function(t){if(!t)return null;var w=new A;w.name="";w.title="";w.description="";w.allExtents=[];w.spatialReferences=[];w.queryable="1"===t.getAttribute("queryable");w.subLayers=[];var q=this._getTag("LatLonBoundingBox",t);q&&(w.allExtents[0]=this._getExtent(q,4326));var E=this._getTag("EX_GeographicBoundingBox",t);if(E){var B=new e(0,0,0,0,new d({wkid:4326}));B.xmin=parseFloat(this._getTagValue("westBoundLongitude",E,0));B.ymin=parseFloat(this._getTagValue("southBoundLatitude",
E,0));B.xmax=parseFloat(this._getTagValue("eastBoundLongitude",E,0));B.ymax=parseFloat(this._getTagValue("northBoundLatitude",E,0));w.allExtents[0]=B}q||E||(B=new e(-180,-90,180,90,new d({wkid:4326})),w.allExtents[0]=B);w.extent=w.allExtents[0];var C=-1<r.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";r.forEach(t.childNodes,function(G){if("Name"==G.nodeName)w.name=(G.text?G.text:G.textContent)||"";else if("Title"==G.nodeName)w.title=(G.text?G.text:G.textContent)||"";else if("Abstract"==
G.nodeName)w.description=(G.text?G.text:G.textContent)||"";else if("BoundingBox"==G.nodeName){var D=G.getAttribute(C);D&&0===D.indexOf("EPSG:")?(D=parseInt(D.substring(5),10),0===D||isNaN(D)||(G="1.3.0"==this.version?this._getExtent(G,D,this._useLatLong(D)):this._getExtent(G,D),w.allExtents[D]=G,w.extent||(w.extent=G))):D&&0===D.indexOf("CRS:")?(D=parseInt(D.substring(4),10),0===D||isNaN(D)||(this._CRS_TO_EPSG[D]&&(D=this._CRS_TO_EPSG[D]),w.allExtents[D]=this._getExtent(G,D))):(D=parseInt(D,10),0===
D||isNaN(D)||(w.allExtents[D]=this._getExtent(G,D)))}else if(G.nodeName==C)G=(G.text?G.text:G.textContent).split(" "),r.forEach(G,function(f){f=-1<f.indexOf(":")?parseInt(f.split(":")[1],10):parseInt(f,10);0===f||isNaN(f)||(this._CRS_TO_EPSG[f]&&(f=this._CRS_TO_EPSG[f]),-1==r.indexOf(w.spatialReferences,f)&&w.spatialReferences.push(f))},this);else if("Style"!=G.nodeName||w.legendURL)"Layer"===G.nodeName&&w.subLayers.push(this._getLayerInfo(G));else if(G=this._getTag("LegendURL",G))if(G=this._getTag("OnlineResource",
G))w.legendURL=G.getAttribute("xlink:href")},this);w.title=w.title||w.name;return w},_getImageFormat:function(t){switch(t?t.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},
_getExtent:function(t,w,q){if(t){var E=new e;var B=parseFloat(t.getAttribute("minx")),C=parseFloat(t.getAttribute("miny")),G=parseFloat(t.getAttribute("maxx"));t=parseFloat(t.getAttribute("maxy"));q?(E.xmin=isNaN(C)?-1*Number.MAX_VALUE:C,E.ymin=isNaN(B)?-1*Number.MAX_VALUE:B,E.xmax=isNaN(t)?Number.MAX_VALUE:t,E.ymax=isNaN(G)?Number.MAX_VALUE:G):(E.xmin=isNaN(B)?-1*Number.MAX_VALUE:B,E.ymin=isNaN(C)?-1*Number.MAX_VALUE:C,E.xmax=isNaN(G)?Number.MAX_VALUE:G,E.ymax=isNaN(t)?Number.MAX_VALUE:t);E.spatialReference=
new d({wkid:w})}return E},_useLatLong:function(t){var w;for(w=0;w<this._REVERSED_LAT_LONG_RANGES.length;w++){var q=this._REVERSED_LAT_LONG_RANGES[w];if(t>=q[0]&&t<=q[1]){var E=!0;break}}return E},_getTag:function(t,w){return(t=g.query(t,w))&&0<t.length?t[0]:null},_getTagValue:function(t,w,q){return(t=g.query(t,w))&&0<t.length?t[0].text?t[0].text:t[0].textContent:q},_getAttributeValue:function(t,w,q,E){return(t=g.query(t,q))&&0<t.length?t[0].getAttribute(w):E},_checkVisibleLayersList:function(t){if(t&&
0<t.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof t[0]){var w=[];r.forEach(t,function(q){q<this.layerInfos.length&&w.push(this.layerInfos[q].name)},this);t=w}return t},_stripParameters:function(t,w){t=k.urlToObject(t);var q,E=[];for(q in t.query)t.query.hasOwnProperty(q)&&-1===r.indexOf(w,q.toLowerCase())&&E.push(q+"\x3d"+t.query[q]);return t.path+(E.length?"?"+E.join("\x26"):"")},_getPopupGraphic:function(t,w){var q=this.visibleLayers;if(!q||0===q.length)return null;var E=this._popupGraphic;
E||(E=new n({title:this.title||""}),E.setContent(function(f){var m=document.createElement("div");if(f=f&&f.attributes&&f.attributes.QUERY_URL)m.style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;",m.innerHTML='\x3ciframe sandbox src\x3d"'+f+'" width\x3d"250" height\x3d"147" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0" style\x3d"position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+K.toUrl("../dijit/images/loading-throb.gif")+
"') transparent center no-repeat;\" onload\x3d\"(event.target || event.srcElement).style.background \x3d 'none';\"\x3e\x3c/iframe\x3e";return m}),E=this._popupGraphic=new a(null,null,{},E),E._layer=this);var B=function(f){var m=[];if(f&&(f.queryable&&f.showPopup&&f.name&&m.push(f.name),f.subLayers))for(var y=0;y<f.subLayers.length;y++){var v=B(f.subLayers[y]);v.length&&(m=m.concat(v))}return m},C=B({subLayers:this.layerInfos});C=r.filter(C,function(f){return-1<r.indexOf(q,f)});if(C.length){var G=
this.getFeatureInfoURL;t=this._getImageParams(t.extent,t.width,t.height);t=this._mixinCustomLayerParameters(t);t.REQUEST="GetFeatureInfo";t.INFO_FORMAT=this.featureInfoFormat;t.QUERY_LAYERS=C.join();t.FEATURE_COUNT=25;"1.3.0"===this.version?(t.I=Math.round(w.x),t.J=Math.round(w.y)):(t.X=Math.round(w.x),t.Y=Math.round(w.y));G+=-1===G.indexOf("?")?"?":"";for(var D in t)t.hasOwnProperty(D)&&(G+="?"===G.substring(G.length-1,G.length)?"":"\x26",G+=D+"\x3d"+t[D]);E.attributes.QUERY_URL=G;return E}return null},
_mixinCustomParameters:function(t){if(this.customParameters)for(var w in this.customParameters)t[w]=encodeURIComponent(this.customParameters[w]);return t},_mixinCustomLayerParameters:function(t){if(this.customLayerParameters||this.customParameters){var w=p.clone(this.customParameters||{});p.mixin(w,this.customLayerParameters||{});for(var q in w)"styles"===q.toLowerCase()&&delete t.STYLES,t[q]=encodeURIComponent(w[q])}return t}});h("extend-esri")&&p.setObject("layers.WMSLayer",x,c);return x})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(K,g,x,p,r){K=K(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(h){h&&(this.name=h.name,this.title=h.title,this.description=h.description,this.extent=h.extent,this.legendURL=h.legendURL,this.subLayers=h.subLayers?h.subLayers:[],this.allExtents=h.allExtents?h.allExtents:[],
this.spatialReferences=h.spatialReferences?h.spatialReferences:[],this.queryable=!!h.queryable,this.showPopup=!!h.showPopup)},clone:function(){var h={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL};this.extent&&(h.extent=this.extent.getExtent());h.subLayers=[];x.forEach(this.subLayers,function(a){h.subLayers.push(a.clone())});h.allExtents=[];for(b in this.allExtents){var b=parseInt(b,10);isNaN(b)||(h.allExtents[b]=this.allExtents[b].getExtent())}h.spatialReferences=
[];x.forEach(this.spatialReferences,function(a){h.spatialReferences.push(a)});h.queryable=this.queryable;h.showPopup=this.showPopup;return h}});p("extend-esri")&&g.setObject("layers.WMSLayerInfo",K,r);return K})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t){g=g([z],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(w,q){this.version="1.0.0";this.tileUrl=this._url=w;this.serviceMode="RESTful";this._parseCapabilities=x.hitch(this,this._parseCapabilities);this._getCapabilitiesError=x.hitch(this,this._getCapabilitiesError);this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};q||(q={});if(q.serviceMode)if("KVP"===q.serviceMode||"RESTful"===q.serviceMode)this.serviceMode=q.serviceMode;else{console.error("WMTS mode could only be 'KVP' or 'RESTful'");return}this.customParameters=q.customParameters;this.customLayerParameters=q.customLayerParameters;this.layerInfo=new t;q.layerInfo&&(this.layerInfo=q.layerInfo,this._identifier=
q.layerInfo.identifier,this._tileMatrixSetId=q.layerInfo.tileMatrixSet,q.layerInfo.format&&(this.format="image/"+q.layerInfo.format),this._style=q.layerInfo.style,this.title=q.layerInfo.title,this._dimension=q.layerInfo.dimension,this._dimension2=q.layerInfo.dimension2);q.resourceInfo?(this.version=q.resourceInfo.version,q.resourceInfo.getTileUrl&&(this._url=this.tileUrl=q.resourceInfo.getTileUrl),this.copyright=q.resourceInfo.copyright,this.layerInfos=q.resourceInfo.layerInfos,this.customParameters=
q.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=q.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities()},setActiveLayer:function(w){this.setVisibleLayer(w)},setVisibleLayer:function(w){this._setActiveLayer(w);this.refresh(!0)},setCustomParameters:function(w,q){this.customParameters=w;this.customLayerParameters=q;this.refresh(!0)},getTileUrl:function(w,q,E){w=this._levelToLevelValue[w];
w=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[q%this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,w).replace(/\{TileRow\}/gi,q).replace(/\{TileCol\}/gi,E).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,w).replace(/\{row\}/gi,q).replace(/\{col\}/gi,E);w=this._appendCustomLayerParameters(w);w=
this.addTimestampToURL(w);return l.addProxy(w)},getTileUrlTemplate:function(w){var q=w.identifier,E=w.tileMatrixSet,B=w.format,C=w.style,G=w.dimension,D=w.dimension2;q?w=p.filter(this.layers,function(m){return m.identifier===q})[0]:(w=this.layers[0],q=this.layers[0].identifier);if(w){if(!B)B=w.formats[0];else if(!(-1===B.indexOf("image/")&&-1<p.indexOf(w.formats,B))&&(-1===B.indexOf("image/")&&(B="image/"+B),-1===p.indexOf(w.formats,B))){console.error("The layer doesn't support the format of "+B);
this.onError(Error("The layer doesn't support the format of "+B));return}if(!C)C=w.styles[0];else if(-1===p.indexOf(w.styles,C)){console.error("The layer doesn't support the style of "+C);this.onError(Error("The layer doesn't support the style of "+C));return}if(!G&&w.dimensions)G=w.dimensions[0];else if(-1===p.indexOf(w.dimensions,G)){console.error("The layer doesn't support the dimension of "+G);this.onError(Error("The layer doesn't support the dimension of "+G));return}if(!D&&w.dimensions2)D=w.dimensions2[0];
else if(-1===p.indexOf(w.dimensions2,D)){console.error("The layer doesn't support the dimension of "+D);this.onError(Error("The layer doesn't support the dimension of "+D));return}if(E){var f=p.filter(w.tileMatrixSetInfos,function(m){return m.tileMatrixSet===E})[0];if(!f){console.error("The tileMatrixSetId "+E+" is not supported by the layer of "+q);this.onError(Error("The tileMatrixSetId "+E+" is not supported by the layer of "+q));return}}else(f=p.filter(w.tileMatrixSetInfos,function(m){return"GoogleMapsCompatible"===
m.tileMatrixSet})[0])||(f=w.tileMatrixSetInfos[0]),E=f.tileMatrixSet;return this._getTileUrlTemplate(q,E,B,C,G,D)}console.error("couldn't find the layer "+q);this.onError(Error("couldn't find the layer "+q))},_getTileUrlTemplate:function(w,q,E,B,C,G){w||(w=this._identifier);q||(q=this._tileMatrixSetId);E||(E=this.format);B||""===B||(B=this._style);if(this.resourceUrls&&0<this.resourceUrls.length){var D=this.resourceUrls[0].template;D.indexOf(".xxx")===D.length-4&&(D=D.slice(0,D.length-4));D=D.replace(/\{Style\}/gi,
B);D=D.replace(/\{TileMatrixSet\}/gi,q);D=D.replace(/\{TileMatrix\}/gi,"{level}");D=D.replace(/\{TileRow\}/gi,"{row}");D=D.replace(/\{TileCol\}/gi,"{col}");D=D.replace(/\{dimensionValue\}/gi,C);return D=D.replace(/\{dimensionValue2\}/gi,G)}"KVP"===this.serviceMode?D=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+w+"\x26STYLE\x3d"+B+"\x26FORMAT\x3d"+E+"\x26TILEMATRIXSET\x3d"+q+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":"RESTful"===
this.serviceMode&&(C="",this._formatDictionary[E.toLowerCase()]&&(C=this._formatDictionary[E.toLowerCase()]),D=this._url+w+"/"+B+"/"+q+"/{level}/{row}/{col}"+C);return D},_parseResourceInfo:function(){var w=this.layerInfos,q;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(q=0;q<w.length;q++)if(!(this._identifier&&w[q].identifier!==this._identifier||this.title&&w[q].title!==this.title||this._tileMatrixSetId&&w[q].tileMatrixSet!==this._tileMatrixSetId||this.format&&"image/"+
w[q].format!==this.format||this._style&&w[q].style!==this._style)){x.mixin(this,{description:w[q].description,tileInfo:w[q].tileInfo,spatialReference:w[q].tileInfo.spatialReference,fullExtent:w[q].fullExtent,initialExtent:w[q].initialExtent,_identifier:w[q].identifier,_tileMatrixSetId:w[q].tileMatrixSet,format:"image/"+w[q].format,_style:w[q].style});break}for(q=0;q<w.length;q++){var E=w[q].tileInfo;96!==E.dpi&&(p.forEach(E.lods,function(B){B.scale=96*B.scale/E.dpi}),E.dpi=96);p.forEach(E.lods,function(B){B.resolution=
this._getResolution(E.spatialReference.wkid,90.71428571428571*B.scale/96,w[q].tileMatrixSet)},this)}this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];p.forEach(this.tileInfo.lods,function(B){this._levelToLevelValue[B.level]=B.levelValue?B.levelValue:B.level},this)},_getCapabilities:function(){var w;"KVP"===this.serviceMode?w=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+
this.version:"RESTful"===this.serviceMode&&(w=this._url+"/"+this.version+"/WMTSCapabilities.xml");w=this._appendCustomParameters(w);c({url:w,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(w){w=w.replace(/ows:/gi,"");w=h.parse(w);var q=K.query("Contents",w)[0];if(q){var E=K.query("OperationsMetadata",w)[0],B=K.query("[name\x3d'GetTile']",E)[0];E=this._url;B=K.query("Get",B);var C,G=!1;for(C=0;C<B.length;C++){var D=K.query("Constraint",B[C])[0];
if(!D||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,D)){E=B[C].attributes[0].nodeValue;G=!0;break}else if(!D||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",D))var f=B[C].attributes[0].nodeValue;else if(!D||this._getTagWithChildTagValue("AllowedValues","Value","KVP",D))var m=B[C].attributes[0].nodeValue}G||("KVP"===this.serviceMode&&f?(E=f,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&m&&(E=m,this.serviceMode="KVP"));-1===E.indexOf("/1.0.0/")&&
"RESTful"===this.serviceMode&&(E+="/");"KVP"===this.serviceMode&&(E+=-1<E.indexOf("?")?"":"?");this._url=E;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",w)[0];f=K.query("Layer",q);var y,v=[];this.layers=[];p.forEach(f,function(F){y=this._getTagValues("Identifier",F)[0];v.push(y);this.layers.push(this._getWMTSLayerInfo(y,F,q))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else console.error("The WMTS capabilities XML is not valid"),
this.onError(Error("The WMTS capabilities XML is not valid"))},_setActiveLayer:function(w){w||(w={});w.identifier&&(this._identifier=w.identifier);w.tileMatrixSet&&(this._tileMatrixSetId=w.tileMatrixSet);w.format&&(this.format=w.format);w.style&&(this._style=w.style);w.dimension&&(this._dimension=w.dimension);w.dimension2&&(this._dimension2=w.dimension2);if(this.layers)if(this._identifier?w=p.filter(this.layers,function(E){return E.identifier===this._identifier},this)[0]:(w=this.layers[0],this._identifier=
this.layers[0].identifier),w){if(this.format){if(-1===this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===p.indexOf(w.formats,this.format)){console.error("The layer doesn't support the format of "+this.format);this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=w.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=w.styles[0];else if(-1===p.indexOf(w.styles,this._style)){console.error("The layer doesn't support the style of "+
this._style);this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&w.dimensions)this._dimension=w.dimensions[0];else if(-1===p.indexOf(w.dimensions,this._dimension)){console.error("The layer doesn't support the dimension of "+this._dimension);this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&w.dimensions2)this._dimension2=w.dimensions2[0];else if(-1===p.indexOf(w.dimensions2,this._dimension2)){console.error("The layer doesn't support the dimension of "+
this._dimension2);this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}if(this._tileMatrixSetId){var q=p.filter(w.tileMatrixSetInfos,function(E){return E.tileMatrixSet===this._tileMatrixSetId},this)[0];if(!q){console.error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier);this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(q=p.filter(w.tileMatrixSetInfos,
function(E){return"GoogleMapsCompatible"===E.tileMatrixSet})[0])||(q=w.tileMatrixSetInfos[0]),this._tileMatrixSetId=q.tileMatrixSet;this.description=w.description;this.title=w.title;this.spatialReference=q.tileInfo.spatialReference;this.tileInfo=q.tileInfo;this._levelToLevelValue=[];p.forEach(this.tileInfo.lods,function(E){this._levelToLevelValue[E.level]=E.levelValue?E.levelValue:E.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=
u.geographicToWebMercator(w.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=w.gcsExtent:(this.fullExtent=q.fullExtent,this.initialExtent=q.initialExtent);this.resourceUrls=w.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else console.error("couldn't find the layer "+
this._identifier),this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(w,q,E){var B=this._getTagValues("Abstract",q)[0],C=this._getTagValues("Title",q)[0],G=K.query("WGS84BoundingBox",q)[0],D=G?this._getTagValues("LowerCorner",G)[0].split(" "):["-180","-90"],f=G?this._getTagValues("UpperCorner",G)[0].split(" "):["180","90"];G=parseFloat(D[0]);D=parseFloat(D[1]);var m=parseFloat(f[0]);f=parseFloat(f[1]);G=new e(G,D,m,f,new n({wkid:4326}));f=this._getTagValues("Identifier",
K.query("Style",q)[0]);var y=this._getTagValues("Identifier",K.query("Dimension",q)[0]),v=this._getTagValues("Default",K.query("Dimension",q)[0])||this._getTagValues("Value",K.query("Dimension",q)[0]),F=1<K.query("Dimension",q).length?this._getTagValues("Identifier",K.query("Dimension",q)[1]):[],H=1<K.query("Dimension",q).length?this._getTagValues("Default",K.query("Dimension",q)[1])||this._getTagValues("Value",K.query("Dimension",q)[1]):[];D=this._getTagValues("Format",q);E=this._getLayerMatrixInfos(q,
E);w={identifier:w,tileMatrixSetInfos:E,formats:D,styles:f,title:C,description:B,gcsExtent:G,dimensions:v,dimensions2:H};q=K.query("ResourceURL",q);var L=[],N;p.forEach(q,function(Q){N=Q.getAttribute("template");if(y&&v&&y[0]&&v[0])if(-1<N.indexOf("{"+y+"}"))N=N.replace("{"+y+"}","{dimensionValue}");else{var R=N.toLowerCase().indexOf("{"+y[0].toLowerCase()+"}");-1<R&&(N=N.substring(0,R)+"{dimensionValue}"+N.substring(R+y[0].length+2))}F&&H&&F[0]&&H[0]&&(-1<N.indexOf("{"+F+"}")?N=N.replace("{"+F+"}",
"{dimensionValue2}"):(R=N.toLowerCase().indexOf("{"+F[0].toLowerCase()+"}"),-1<R&&(N=N.substring(0,R)+"{dimensionValue2}"+N.substring(R+F[0].length+2))));L.push({template:N,format:Q.getAttribute("format"),resourceType:Q.getAttribute("resourceType")})});L&&0<L.length&&(w.resourceUrls=L);return w},_getLayerMatrixInfos:function(w,q){var E=[],B=this._getTagValues("TileMatrixSet",w);if(B&&0!==B.length)return p.forEach(B,function(C){C=this._getLayerMatrixInfo(C,w,q);E.push(C)},this),E},_getLayerMatrixInfo:function(w,
q,E){var B=[];q=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",w,q);var C=this._getTagValues("TileMatrix",q),G=this._getTagWithChildTagValue("TileMatrixSet","Identifier",w,E),D=this._getTagValues("SupportedCRS",G)[0];var f=parseInt(D.split(":").pop(),10);if(900913==f||3857==f)f=102100;if(-1<D.toLowerCase().indexOf("crs84")||-1<D.toLowerCase().indexOf("crs:84")){f=4326;var m=!0}else if(-1<D.toLowerCase().indexOf("crs83")||-1<D.toLowerCase().indexOf("crs:83"))f=4269,m=!0;else if(-1<
D.toLowerCase().indexOf("crs27")||-1<D.toLowerCase().indexOf("crs:27"))f=4267,m=!0;var y=new n({wkid:f}),v=K.query("TileMatrix",G)[0];E=parseInt(this._getTagValues("TileWidth",v)[0],10);q=parseInt(this._getTagValues("TileHeight",v)[0],10);var F=this._getTagValues("TopLeftCorner",v)[0].split(" ");var H=F[0],L=F[1];1<H.split("E").length&&(F=H.split("E"),H=F[0]*Math.pow(10,F[1]));1<L.split("E").length&&(F=L.split("E"),L=F[0]*Math.pow(10,F[1]));H=parseFloat(H);L=parseFloat(L);var N=m&&4326===f&&90===
H&&-180===L;for(F=0;F<this._flippingAxisForWkids.length;F++)if(D.split(":").pop()>=this._flippingAxisForWkids[F][0]&&D.split(":").pop()<=this._flippingAxisForWkids[F][1]||4326===f&&(!m||N)){4326===f&&90<H&&(H="90");var Q=new d(L,H,y);break}F===this._flippingAxisForWkids.length&&(Q=new d(H,L,y));if(0===C.length)for(C=K.query("TileMatrix",G),F=0;F<C.length;F++)m=this._getLodFromTileMatrix(C[F],f,F,w),B.push(m);else for(F=0;F<C.length;F++)m=this._getTagWithChildTagValue("TileMatrix","Identifier",C[F],
G),m=this._getLodFromTileMatrix(m,f,F,w),B.push(m);f=K.query("BoundingBox",G)[0];if(f){var R=this._getTagValues("LowerCorner",f)[0].split(" ");var W=this._getTagValues("UpperCorner",f)[0].split(" ")}R&&1<R.length&&W&&1<W.length?(v=parseFloat(R[0]),f=parseFloat(R[1]),R=parseFloat(W[0]),W=parseFloat(W[1])):(R=this._getTagValues("MatrixWidth",v)[0],f=this._getTagValues("MatrixHeight",v)[0],v=Q.x,W=Q.y,R=v+R*q*B[0].resolution,f=W-f*E*B[0].resolution);W=R=new e(v,f,R,W,y);Q=new A({dpi:96,spatialReference:y,
format:this.format,rows:E,cols:q,origin:Q,lods:B});return{tileMatrixSet:w,fullExtent:W,initialExtent:R,tileInfo:Q}},_getCapabilitiesError:function(w){console.error("Failed to get capabilities xml");this.onError(w)},_getLodFromTileMatrix:function(w,q,E,B){var C=this._getTagValues("Identifier",w)[0];w=this._getTagValues("ScaleDenominator",w)[0];1<w.split("E").length?(w=w.split("E"),w=w[0]*Math.pow(10,w[1])):w=parseFloat(w);q=this._getResolution(q,w,B);return{level:E,levelValue:C,scale:1.058267716535433*
w,resolution:q}},_getResolution:function(w,q,E){w=a.isDefined(k[w])?k.values[k[w]]:"default028mm"===E?6370997*Math.PI/180:6378137*Math.PI/180;return 7*q/25E3/w},_getTag:function(w,q){return(w=K.query(w,q))&&0<w.length?w[0]:null},_getTagValues:function(w,q){var E=[];w=w.split("\x3e");var B=K.query(w[0],q)[0];if(1<w.length){for(q=1;q<w.length-1;q++)B=K.query(w[q],B)[0];q=K.query(w[w.length-1],B)}else q=K.query(w[0],q);q&&0<q.length&&p.forEach(q,function(C){9>r("ie")?E.push(C.childNodes.length?C.childNodes[0].nodeValue:
""):E.push(C.textContent)});return E},_getAttributeValues:function(w,q,E){w=K.query(w,E);var B=[];w&&0<w.length&&p.forEach(w,function(C){B.push(C.getAttribute(q))});return B},_getTagWithChildTagValue:function(w,q,E,B){B=B.childNodes;var C;for(C=0;C<B.length;C++)if(-1<B[C].nodeName.indexOf(w)){if(9>r("ie")){if(a.isDefined(K.query(q,B[C])[0]))var G=K.query(q,B[C])[0].childNodes[0].nodeValue}else a.isDefined(K.query(q,B[C])[0])&&(G=K.query(q,B[C])[0].textContent);if(G===E||E.split(":")&&G===E.split(":")[1])return B[C]}},
_appendCustomParameters:function(w){var q;if(this.customParameters)for(q in this.customParameters)w+=(-1===w.indexOf("?")?"?":"\x26")+q+"\x3d"+encodeURIComponent(this.customParameters[q]);return w},_appendCustomLayerParameters:function(w){var q;if(this.customLayerParameters||this.customParameters){var E=x.clone(this.customParameters||{});x.mixin(E,this.customLayerParameters||{});for(q in E)w+=(-1===w.indexOf("?")?"?":"\x26")+q+"\x3d"+encodeURIComponent(E[q])}return w},_flippingAxisForWkids:[[3819,
3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,
5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,
3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});r("extend-esri")&&
x.setObject("layers.WMTSLayer",g,b);return g})},"dojox/xml/parser":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(K){K.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(g,x){var p=K.doc;x=x||"text/xml";if(g&&K.trim(g)&&"DOMParser"in K.global){var r=(new DOMParser).parseFromString(g,x);g=r.documentElement;if("parsererror"==g.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==g.namespaceURI){if(p=
g.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0])p=p.firstChild.data;throw Error("Error parsing text "+g.firstChild.data+" \n"+p);}return r}if("ActiveXObject"in K.global){p=function(b){return"MSXML"+b+".DOMDocument"};p=["Microsoft.XMLDOM",p(6),p(4),p(3),p(2)];K.some(p,function(b){try{r=new ActiveXObject(b)}catch(a){return!1}return!0});if(g&&r&&(r.async=!1,r.loadXML(g),g=r.parseError,0!==g.errorCode))throw Error("Line: "+g.line+"\nCol: "+g.linepos+"\nReason: "+
g.reason+"\nError Code: "+g.errorCode+"\nSource: "+g.srcText);if(r)return r}else if(p.implementation&&p.implementation.createDocument){if(g&&K.trim(g)&&p.createElement){x=p.createElement("xml");x.innerHTML=g;var h=p.implementation.createDocument("foo","",null);K.forEach(x.childNodes,function(b){h.importNode(b,!0)});return h}return p.implementation.createDocument("","",null)}return null};dojox.xml.parser.textContent=function(g,x){if(1<arguments.length)return dojox.xml.parser.replaceChildren(g,(g.ownerDocument||
K.doc).createTextNode(x)),x;if(void 0!==g.textContent)return g.textContent;var p="";g&&K.forEach(g.childNodes,function(r){switch(r.nodeType){case 1:case 5:p+=dojox.xml.parser.textContent(r);break;case 3:case 2:case 4:p+=r.nodeValue}});return p};dojox.xml.parser.replaceChildren=function(g,x){var p=[];K.isIE&&K.forEach(g.childNodes,function(r){p.push(r)});dojox.xml.parser.removeChildren(g);K.forEach(p,K.destroy);K.isArray(x)?K.forEach(x,function(r){g.appendChild(r)}):g.appendChild(x)};dojox.xml.parser.removeChildren=
function(g){for(var x=g.childNodes.length;g.hasChildNodes();)g.removeChild(g.firstChild);return x};dojox.xml.parser.innerXML=function(g){return g.innerXML?g.innerXML:g.xml?g.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(g):null};return dojox.xml.parser})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(K,g,x,p){K=K(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,
format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(r){r&&(this.title=r.title,this.tileMatrixSet=r.tileMatrixSet,this.format=r.format,this.style=r.style,this.tileInfo=r.tileInfo,this.fullExtent=r.fullExtent,this.initialExtent=r.initialExtent,this.identifier=r.identifier,this.description=r.description,this.dimension=r.dimension)}});x("extend-esri")&&g.setObject("layers.WMTSLayerInfo",K,p);return K})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e){function u(z,A){var t=[];if(z&&A&&(A.customLayerParameters||A.customParameters)){var w=g.clone(A.customParameters||{});g.mixin(w,A.customLayerParameters||{});z=l.urlToObject(z);for(var q in z.query)w.hasOwnProperty(q)||t.push(q+"\x3d"+z.query[q]);z=z.path+(t.length?"?"+t.join("\x26"):"")}return z}K=K(d,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(z,A){A||(A={});this.urlTemplate=z=u(z,A.wmtsInfo);var t=new n(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new k({wkid:102100})),w=new n(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new k({wkid:102100}));this.initialExtent=A.initialExtent||t;this.fullExtent=A.fullExtent||w;this.tileInfo=A.tileInfo?A.tileInfo:new e({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new k(this.tileInfo.spatialReference.toJson());this.copyright=A.copyright||"";var q=new p(z);t=q.scheme+"://"+q.authority+"/";this.urlPath=z.substring(t.length);this.tileServers=A.tileServers||[];-1===q.authority.indexOf("{subDomain}")&&
this.tileServers.push(t);if(A.subDomains&&0<A.subDomains.length&&1<q.authority.split(".").length){this.subDomains=A.subDomains;var E;x.forEach(A.subDomains,function(G){-1<q.authority.indexOf("${subDomain}")?E=q.scheme+"://"+h.substitute(q.authority,{subDomain:G})+"/":-1<q.authority.indexOf("{subDomain}")&&(E=q.scheme+"://"+q.authority.replace(/\{subDomain\}/gi,G)+"/");this.tileServers.push(E)},this)}this.tileServers=x.map(this.tileServers,function(G){"/"!==G.charAt(G.length-1)&&(G+="/");return G});
this._levelToLevelValue=[];var B=0;x.forEach(this.tileInfo.lods,function(G,D){this._levelToLevelValue[G.level]=G.levelValue||G.level;0===D&&(B=this._levelToLevelValue[G.level])},this);this._wmtsInfo=A.wmtsInfo;var C=g.hitch(this,function(){this.loaded=!0;this.onLoad(this)});r("chrome")?(z=this.getTileUrl(B,0,0),A=b.defaults.io,t="with-credentials"===A.useCors?l.canUseXhr(z,!0):-1,(A=-1<t?A.corsEnabledServers[t]:null)&&A.withCredentials?c({url:z,handleAs:"arraybuffer"}).addBoth(function(){C()}):C()):
C()},getTileUrl:function(z,A,t){z=this._levelToLevelValue[z];var w=this.tileServers[A%this.tileServers.length]+h.substitute(this.urlPath,{level:z,z:z,col:t,x:t,row:A,y:A});w=w.replace(/\{level\}/gi,z).replace(/\{row\}/gi,A).replace(/\{col\}/gi,t).replace(/\{z\}/gi,z).replace(/\{x\}/gi,t).replace(/\{y\}/gi,A);w=this._appendCustomLayerParameters(w);w=this.addTimestampToURL(w);return l.addProxy(w)},_appendCustomLayerParameters:function(z){var A;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var t=g.clone(this._wmtsInfo.customParameters||{});g.mixin(t,this._wmtsInfo.customLayerParameters||{});for(A in t)z+=(-1===z.indexOf("?")?"?":"\x26")+A+"\x3d"+encodeURIComponent(t[A])}return z}});r("extend-esri")&&g.setObject("layers.WebTiledLayer",K,a);return K})},"widgets/AddData/search/Paging":function(){define("dojo/_base/declare dojo/dom-class ./SearchComponent dojo/text!./templates/Paging.html dojo/i18n!../nls/strings ./util".split(" "),function(K,g,x,p,r,h){return K([x],
{i18n:r,templateString:p,hasLess:!1,hasMore:!1,nextStart:-1,numPerPage:null,previousStart:-1,start:1,postCreate:function(){this.inherited(arguments);null===this.numPerPage&&(this.numPerPage=30);this.enableOrDisable()},startup:function(){if(!this._started){this.inherited(arguments);try{var b=this.getConfig().numPerPage,a=Number(b);"number"!==typeof a||isNaN(a)||(a=Math.floor(a),1<=a&&100>=a&&(this.numPerPage=a))}catch(c){console.warn("Error setting numPerPage:"),console.warn(c)}null===this.numPerPage&&
(this.numPerPage=30)}},enableOrDisable:function(){this.hasLess?(g.remove(this.firstButton.parentNode,"disabled"),g.remove(this.previousButton.parentNode,"disabled")):(g.add(this.firstButton.parentNode,"disabled"),g.add(this.previousButton.parentNode,"disabled"));this.hasMore?g.remove(this.nextButton.parentNode,"disabled"):g.add(this.nextButton.parentNode,"disabled")},firstButtonClicked:function(){this.hasLess&&(this.start=1,this.search())},previousButtonClicked:function(){this.hasLess&&(this.start=
this.previousStart,this.search())},nextButtonClicked:function(){this.hasMore&&(this.start=this.nextStart,this.search())},appendQueryParams:function(b){b.start=this.start;b.num=this.numPerPage},processResults:function(b){this.start=1;var a=this.numPerPage,c=b.total,l=b.queryParams.start;1>l&&(l=1);this.hasLess=!1;this.previousStart=-1;1<l&&(this.hasLess=!0,this.previousStart=l-b.queryParams.num,1>this.previousStart&&(this.previousStart=1));this.hasMore=!1;this.nextStart=-1;b.nextQueryParams&&1<b.nextQueryParams.start&&
(this.hasMore=!0,this.nextStart=b.nextQueryParams.start);b="";c>a?(c=1,1<l&&(c=Math.floor(l/a)+1),b=this.i18n.search.paging.pagePattern,b=b.replace("{page}",""+c)):(b=this.i18n.search.paging.pagePattern,b=b.replace("{page}","1"));h.setNodeText(this.pageNode,b);this.enableOrDisable()}})})},"widgets/AddData/search/ResultCount":function(){define("dojo/_base/declare dojo/number ./SearchComponent dojo/text!./templates/ResultCount.html dojo/i18n!../nls/strings ./util".split(" "),function(K,g,x,p,r,h){return K([x],
{i18n:r,templateString:p,typePlural:r.search.resultCount.itemPlural,typeSingular:r.search.resultCount.itemSingular,postCreate:function(){this.inherited(arguments)},processResults:function(b){b=b.total;var a=this.typePlural;1===b&&(a=this.typeSingular);var c=this.i18n.search.resultCount.countPattern;c=c.replace("{count}",g.format(b));c=c.replace("{type}",a);h.setNodeText(this.messageNode,c)}})})},"widgets/AddData/search/AddFromUrlPane":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/keys dojo/Deferred dojo/promise/all dojo/dom-class dojo/window dijit/Viewport dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddFromUrlPane.html dojo/i18n!../nls/strings ./LayerLoader ./util esri/layers/ArcGISDynamicMapServiceLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISTiledMapServiceLayer esri/layers/CSVLayer esri/layers/FeatureLayer esri/layers/GeoRSSLayer esri/layers/ImageParameters esri/layers/KMLLayer esri/layers/RasterXLayer esri/layers/StreamLayer esri/layers/VectorTileLayer esri/layers/WMSLayer esri/layers/WMTSLayer esri/InfoTemplate jimu/dijit/Message dijit/form/Select dijit/form/ValidationTextBox".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B,C,G,D,f,m,y,v,F,H,L){return K([k,n,d],{i18n:u,templateString:e,wabWidget:null,_dfd:null,postCreate:function(){this.inherited(arguments);this._updateExamples("ArcGIS");this.urlTextBox.set("invalidMessage",u.addFromUrl.invalidURL);var N=this;this.own(p(this.urlTextBox,"keyup",function(Q){Q.keyCode===r.ENTER?N.addClicked():a.contains(N.addButton,"disabled")||N._setStatus("")}));this.own(p(this.urlTextBox,"focus",function(){try{N.urlTextBox.select()}catch(Q){}}));
this.own(p(this.typeSelect,"change",function(Q){N._updateExamples(Q)}));this.own(p(this.typeSelect.dropDown,"open",function(){var Q=this.domNode.parentElement;Q&&a.add(Q,"add-data-widget-popup")}));this.own(l.on("resize",N.resize()))},destroy:function(){this.inherited(arguments)},addClicked:function(){var N=this,Q=!1,R=this.addButton;if(!a.contains(R,"disabled")){var W=this.typeSelect.get("value"),Z=g.trim(this.urlTextBox.value);0<Z.length&&Z&&(Q=!0);Q&&(a.add(R,"disabled"),N._setStatus(u.search.item.messages.adding),
Q=new h,this._handleAdd(Q,this.wabWidget.map,W,Z),Q.then(function(X){X?N._setStatus(""):N._setStatus(u.search.item.messages.addFailed);a.remove(R,"disabled")}).otherwise(function(X){"string"===typeof X&&"Unsupported"===X?(N._setStatus(u.search.item.messages.unsupported),a.remove(R,"disabled")):(console.warn("Add layer failed."),console.warn(X),N._setStatus(u.search.item.messages.addFailed),a.remove(R,"disabled"),X&&"string"===typeof X.message&&0<X.message.length&&(N._setStatus(X.message),console.log("")))}))}},
examplesExpanderClicked:function(){a.toggle(this.examplesNode,"show")},preHide:function(){},resize:function(){var N=c.getBox(this.ownerDocument);N&&"undefined"!==typeof N.w&&(600<N.w?a.add(this.urlTextBox,"url-textbox-wide"):a.remove(this.urlTextBox,"url-textbox-wide"))},_handleAdd:function(N,Q,R,W){W=A.checkMixedContent(W);var Z=W.toLowerCase(),X=new z,M=X._generateLayerId(),U=this,T=null;"ArcGIS"===R?0<Z.indexOf("/featureserver")||0<Z.indexOf("/mapserver")||0<Z.indexOf("/imageserver")?X._readRestInfo(W).then(function(V){if(!V||
"string"!==typeof V.type||"Feature Layer"!==V.type&&"Table"!==V.type)if(0<Z.indexOf("/featureserver")){var I=[];x.forEach(V.layers,function(O){O=new B(W+"/"+O.id,{id:X._generateLayerId(),outFields:["*"],infoTemplate:new H});I.push(X._waitForLayer(O))});x.forEach(V.tables,function(O){O=new B(W+"/"+O.id,{id:X._generateLayerId(),outFields:["*"]});I.push(X._waitForLayer(O))});b(I).then(function(O){var S=[];x.forEach(O,function(P){S.push(P)});S.reverse();x.forEach(S,function(P){X._setFeatureLayerInfoTemplate(P);
P.xtnAddData=!0;Q.addLayer(P)});N.resolve(S)}).otherwise(function(O){N.reject(O)})}else if(0<Z.indexOf("/mapserver")){if(V.tileInfo)T=new q(W,{id:M});else{var J={id:M};V&&V.supportedImageFormatTypes&&-1!==V.supportedImageFormatTypes.indexOf("PNG32")&&(J.imageParameters=new G,J.imageParameters.format="png32");T=new t(W,J)}U._waitThenAdd(N,Q,R,X,T)}else 0<Z.indexOf("/imageserver")&&(T=V&&V.tileInfo&&V.singleFusedMapCache?"Raster"===V.cacheType?new f(W,{id:M}):new q(W,{id:M}):new w(W,{id:M}),U._waitThenAdd(N,
Q,R,X,T));else T=new B(W,{id:M,outFields:["*"],infoTemplate:new H}),U._waitThenAdd(N,Q,R,X,T)}).otherwise(function(V){N.reject(V)}):0<Z.indexOf("/vectortileserver")||0<Z.indexOf("/resources/styles/root.json")?y&&y.supported()?X._checkVectorTileUrl(W,{}).then(function(V){T=new y(V,{id:M});U._waitThenAdd(N,Q,R,X,T)}).otherwise(function(V){N.reject(V)}):N.reject("Unsupported"):0<Z.indexOf("/streamserver")?(T=new m(W,{id:M,purgeOptions:{displayCount:1E4},infoTemplate:new H}),this._waitThenAdd(N,Q,R,X,
T)):N.reject("Unsupported"):"WMS"===R?(T=new v(W,{id:M}),this._waitThenAdd(N,Q,R,X,T)):"WMTS"===R?(T=new F(W,{id:M}),this._waitThenAdd(N,Q,R,X,T)):"WFS"===R?A.loadWFSByUrl(N,Q,X,W,M,!0):"KML"===R?(T=new D(W,{id:M}),this._waitThenAdd(N,Q,R,X,T)):"GeoRSS"===R?(T=new C(W,{id:M}),this._waitThenAdd(N,Q,R,X,T)):"CSV"===R&&(T=new E(W,{id:M}),T.setInfoTemplate(X._newInfoTemplate()),this._waitThenAdd(N,Q,R,X,T))},_persist:function(){try{var N=this.typeSelect.get("value"),Q=g.trim(this.urlTextBox.value);this.wabWidget.xtnAddFromUrlPane=
{type:N,url:Q}}catch(R){}},_restore:function(){try{var N=this.wabWidget.xtnAddFromUrlPane;N&&"string"===typeof N.type&&0<N.type.length&&this.typeSelect.set("value",N.type);N&&"string"===typeof N.url&&0<N.url.length&&(this.urlTextBox.value=N.url)}catch(Q){}},_setStatus:function(N){this.wabWidget&&this.wabWidget._setStatus(N)},_showLayers:function(){this.wabWidget&&this.wabWidget.showLayers()},_updateExamples:function(N){x.forEach(this.examplesNode.children,function(Q){var R=Q.getAttribute("data-examples-type");
"string"===typeof R&&0<R.length&&(Q.style.display=R===N?"":"none")})},_waitThenAdd:function(N,Q,R,W,Z){W._waitForLayer(Z).then(function(X){"WMS"===R?W._setWMSVisibleLayers(X):X&&"esri.layers.ArcGISDynamicMapServiceLayer"===X.declaredClass?W._setDynamicLayerInfoTemplates(X):X&&"esri.layers.FeatureLayer"===X.declaredClass?W._setFeatureLayerInfoTemplate(X):X&&"esri.layers.CSVLayer"===X.declaredClass&&W._setFeatureLayerInfoTemplate(X);X.xtnAddData=!0;if("KML"===R){var M=Q.spatialReference,U=X._outSR;
M&&U&&(M.equals(U)||M.isWebMercator()&&4326===U.wkid||U.isWebMercator()&&4326===M.wkid)?Q.addLayer(X):new L({titleLabel:u._widgetLabel,message:u.addFromFile.kmlProjectionMismatch})}else Q.addLayer(X);N.resolve(X)}).otherwise(function(X){N.reject(X)})}})})},"esri/layers/CSVLayer":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../arcgis/csv ./FeatureLayer ../geometry/Extent ../tasks/FeatureSet".split(" "),function(K,g,x,p,r,h,b,a,c){g=g(b,{declaredClass:"esri.layers.CSVLayer",
_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",String:"esriFieldTypeString"},constructor:function(l,k){this.url=l;k=x.mixin({},k);this.columnDelimiter=k.columnDelimiter;this.latitudeFieldName=k.latitudeFieldName;this.longitudeFieldName=k.longitudeFieldName;l=k.layerDefinition;l||(l={fields:k.fields||[],geometryType:"esriGeometryPoint",copyrightText:k.copyright},k.fields&&K.forEach(k.fields,function(n){n.type=this._fieldTypeMap[n.type||"String"];n.alias||(n.alias=
n.name)},this));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,layerDefinition:l,outFields:k.outFields};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,longitudeFieldName:this.longitudeFieldName});this._projectFeatures=x.hitch(this,this._projectFeatures);this._addFeatures=x.hitch(this,this._addFeatures);this._initCSVLayer(k)},refresh:function(){this._fireUpdateStart();
this.applyEdits(null,null,this.graphics);this._loadFeatures()},_isWebGLCompatible:function(){return!1},_setMap:function(l){var k=this.inherited(arguments);this._fireUpdateStart();this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler);this._csvFC=null;return k},_initCSVLayer:function(l){var k=this;h.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(n){!k._buildCsvFcParam.locationInfo||k.latitudeFieldName&&k.longitudeFieldName||(k.latitudeFieldName=k._buildCsvFcParam.locationInfo.latitudeFieldName,
k.longitudeFieldName=k._buildCsvFcParam.locationInfo.longitudeFieldName);k._csvFC=n;var d=n.layerDefinition;d.extent=k._getFCExtent(n);l.outFields||(l.outFields=["*"]);l.timeInfo&&(d.timeInfo=l.timeInfo);k._initFeatureLayer({layerDefinition:d},l)}).otherwise(this._errorHandler)},_loadFeatures:function(){h.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},_projectFeatures:function(l){return h.projectFeatureCollection(l,
this._map.spatialReference)},_addFeatures:function(l){l=new c(l.featureSet);this.applyEdits(l.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(l){if(l&&l.featureSet&&l.featureSet.features){l=l.featureSet.features;var k=l.length;if(1<k){var n=l[0].geometry;var d=new a(n.x,n.y,n.x,n.y);for(--k;0<k;k--)n=l[k].geometry,d.xmin=Math.min(d.xmin,n.x),d.ymin=Math.min(d.ymin,n.y),d.xmax=Math.max(d.xmax,n.x),d.ymax=Math.max(d.ymax,n.y);0>=d.getWidth()&&0>=d.getHeight()&&(d=null)}}return d}});
p("extend-esri")&&x.setObject("layers.CSVLayer",g,r);return g})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore ../kernel ../config ../request ../SpatialReference ../geometry/jsonUtils ../geometry/webMercatorUtils".split(" "),function(K,g,x,p,r,h,b,a,c,l,k,n){function d(B){var C=0,G="";g.forEach([","," ",";","|","\t"],function(D){var f=B.split(D).length;f>C&&(C=f,G=D)});return G}function e(B,C){if(!B||"[object Date]"!==
Object.prototype.toString.call(B)||isNaN(B.getTime()))return!1;B=!0;if(p("chrome")&&/\d+\W*$/.test(C)){if(C.match(/[^0-9a-zA-Z\s]/))return!1;if(C=C.match(/[a-zA-Z]{2,}/)){B=!1;for(var G=0,D=C.length,f=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!B&&G<=D&&!(B=!f.test(C[G]));)G++;B=!B}}return B}function u(B,C,G){var D=B.indexOf("\n");D=K.trim(B.substr(0,D));var f=C.columnDelimiter;
f||(f=d(D));var m=new h({data:B,separator:f});m.fetch({onComplete:function(y,v){v=0;var F={layerDefinition:C.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},H=F.layerDefinition.objectIdField,L=F.layerDefinition.fields;H||g.some(L,function(J){return"esriFieldTypeOID"===J.type?(H=J.name,!0):!1})||(L.push({name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1}),H="__OBJECTID");var N=m._attributes,Q=[],R=[];g.forEach(L,function(J){"esriFieldTypeDate"===J.type?
Q.push(J.name):("esriFieldTypeDouble"===J.type||"esriFieldTypeInteger"===J.type)&&R.push(J.name)});if(C.locationInfo&&"coordinates"===C.locationInfo.locationType){var W=C.locationInfo.latitudeFieldName;var Z=C.locationInfo.longitudeFieldName}else g.forEach(N,function(J){var O=g.indexOf(w,J.toLowerCase());-1!==O&&(W=J);O=g.indexOf(q,J.toLowerCase());-1!==O&&(Z=J)}),W&&Z&&(C.locationInfo={locationType:"coordinates",latitudeFieldName:W,longitudeFieldName:Z});if(W&&Z){-1===g.indexOf(R,W)&&R.push(W);-1===
g.indexOf(R,Z)&&R.push(Z);if(K.isArray(C.outFields)&&-1===g.indexOf(C.outFields,"*"))var X=C.outFields;g.forEach(N,function(J){g.some(L,function(O){return J===O.name})||L.push({name:J,alias:J,type:J===W||J===Z?"esriFieldTypeDouble":"esriFieldTypeString"})});N=0;var M=y.length;for(N;N<M;N++){var U=y[N],T=m.getAttributes(U),V={};g.forEach(T,function(J){if(J&&(J===W||J===Z||!X||-1<g.indexOf(X,J))){var O=J;0===J.length&&g.forEach(L,function(P,Y){P.name==="attribute_"+(Y-1)&&(J="attribute_"+(Y-1))});if(-1<
g.indexOf(Q,J)){O=m.getValue(U,O);var S=new Date(O);V[J]=e(S,O)?S.getTime():null}else-1<g.indexOf(R,J)?(S=r.parse(m.getValue(U,O)),J!==W&&J!==Z||!(isNaN(S)||181<Math.abs(S))||(S=parseFloat(m.getValue(U,O))),isNaN(S)?V[J]=null:V[J]=S):V[J]=m.getValue(U,O)}});V[H]=v;v++;T=V[W];var I=V[Z];null==I||null==T||isNaN(T)||isNaN(I)||(X&&-1===g.indexOf(X,W)&&delete V[W],X&&-1===g.indexOf(X,Z)&&delete V[Z],F.featureSet.features.push({geometry:{x:I,y:T,spatialReference:{wkid:4326}},attributes:V}))}F.layerDefinition.name=
"csv";G&&G(F)}else setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},1),G&&G(null,Error("File does not seem to contain fields with point coordinates."))},onError:function(y){console.error("Error fetching items from CSV store: ",y);G&&G(null,y)}});return!0}function z(B,C,G,D,f,m){0===B.length&&f(null);var y=k.getGeometryType(C),v=[];g.forEach(B,function(F){F=new y(F);F.spatialReference=G;v.push(F)},this);C=[102113,102100,3857];G.wkid&&4326===G.wkid&&
D.wkid&&-1<g.indexOf(C,D.wkid)?(g.forEach(v,function(F){F.xmin?(F.xmin=Math.max(F.xmin,-180),F.xmax=Math.min(F.xmax,180),F.ymin=Math.max(F.ymin,-89.99),F.ymax=Math.min(F.ymax,89.99)):F.rings?g.forEach(F.rings,function(H){g.forEach(H,function(L){L[0]=Math.min(Math.max(L[0],-180),180);L[1]=Math.min(Math.max(L[1],-89.99),89.99)},this)},this):F.paths?g.forEach(F.paths,function(H){g.forEach(H,function(L){L[0]=Math.min(Math.max(L[0],-180),180);L[1]=Math.min(Math.max(L[1],-89.99),89.99)},this)},this):F.x&&
(F.x=Math.min(Math.max(F.x,-180),180),F.y=Math.min(Math.max(F.y,-89.99),89.99))},this),B=[],g.forEach(v,function(F){F=n.geographicToWebMercator(F);102100!==D.wkid&&(F.spatialReference=D);B.push(F.toJson())},this),f(B)):null!==G.wkid&&-1<g.indexOf(C,G.wkid)&&null!==D.wkid&&4326===D.wkid?(B=[],g.forEach(v,function(F){B.push(n.webMercatorToGeographic(F).toJson())},this),f(B)):(C=function(F,H){F&&F.length===B.length?(B=[],g.forEach(F,function(L){L&&(L.rings&&0<L.rings.length&&0<L.rings[0].length&&0<L.rings[0][0].length&&
!isNaN(L.rings[0][0][0])&&!isNaN(L.rings[0][0][1])||L.paths&&0<L.paths.length&&0<L.paths[0].length&&0<L.paths[0][0].length&&!isNaN(L.paths[0][0][0])&&!isNaN(L.paths[0][0][1])||L.xmin&&!isNaN(L.xmin)&&L.ymin&&!isNaN(L.ymin)||L.x&&!isNaN(L.x)&&L.y&&!isNaN(L.y))?B.push(L.toJson()):B.push(null)},this),f(B)):m(F,H)},a.defaults.geometryService?a.defaults.geometryService.project(v,D,K.hitch(this,C),m):f(null))}function A(B,C){var G=[102113,102100,3857];return B&&C&&B.wkid===C.wkid&&B.wkt===C.wkt||B&&C&&
B.wkid&&C.wkid&&-1<g.indexOf(G,B.wkid)&&-1<g.indexOf(G,C.wkid)?!0:!1}function t(B,C,G,D){if(B.featureSet&&0!==B.featureSet.features.length)if(A(G,C))D(B);else{var f=function(F){var H=[];g.forEach(B.featureSet.features,function(L,N){F[N]&&(L.geometry=F[N],H.push(L))},this);D(B)},m=function(F,H){console.error("error projecting featureSet ("+B.layerDefinition.name+"). Final try.");D(B)},y=function(F,H){console.error("error projecting featureSet ("+B.layerDefinition.name+"). Try one more time.");z(v,
B.featureSet.geometryType,C,G,K.hitch(this,f),K.hitch(this,m))};if(B.featureSet.features&&0<B.featureSet.features.length){var v=[];g.forEach(B.featureSet.features,function(F){if(F.geometry.toJson)v.push(F.geometry);else{var H=k.getGeometryType(B.featureSet.geometryType);v.push(new H(F.geometry))}});C.toJson||(C=new l(C));G.toJson||(G=new l(G));z(v,B.featureSet.geometryType,C,G,K.hitch(this,f),K.hitch(this,y))}else D(B)}}var w="lat latitude y ycenter latitude83 latdecdeg point-y lat_dd".split(" "),
q="lon lng long longitude x xcenter longitude83 longdecdeg point-x long_dd".split(" "),E={latFieldStrings:w,longFieldStrings:q,buildCSVFeatureCollection:function(B){var C=new x,G=function(f,m){m?C.errback(m):C.callback(f)},D={url:B.url,handleAs:"text",load:function(f){u(f,B,K.hitch(this,G))},error:function(f){C.errback(f);console.error("error: "+f)}};-1<B.url.indexOf("arcgis.com")&&-1<B.url.indexOf("/content/items")&&-1<B.url.indexOf("/data")&&(D.headers={"Content-Type":""});c(D,{usePost:!1});return C},
projectFeatureCollection:function(B,C,G){var D=new x;G||(G=new l({wkid:4326}));t(B,G,C,K.hitch(this,function(f){D.callback(f)}));return D},generateDefaultPopupInfo:function(B){var C={esriFieldTypeDouble:1,esriFieldTypeSingle:1},G={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},D={esriFieldTypeDate:1},f=null;B=g.map(B.layerDefinition.fields,K.hitch(this,function(m){"NAME"===m.name.toUpperCase()&&(f=m.name);var y="esriFieldTypeOID"!==m.type&&"esriFieldTypeGlobalID"!==m.type&&"esriFieldTypeGeometry"!==
m.type,v=null;if(y){var F=m.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+F+",")||-1<F.indexOf("area")||-1<F.indexOf("length")||-1<F.indexOf("shape")||-1<F.indexOf("perimeter")||-1<F.indexOf("objectid")||F.indexOf("_")===F.length-1||F.indexOf("_i")===F.length-2&&1<F.length)y=!1;m.type in G?v={places:0,digitSeparator:!0}:m.type in C?v={places:2,digitSeparator:!0}:m.type in D&&(v={dateFormat:"shortDateShortTime"})}return K.mixin({},
{fieldName:m.name,label:m.alias,isEditable:!0,tooltip:"",visible:y,format:v,stringFieldOption:"textbox"})}));return{title:f?"{"+f+"}":"",fieldInfos:B,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:d,_isValidDate:e,_processCsvData:u,_projectGeometries:z,_sameSpatialReference:A,_projectFeatureSet:t};p("extend-esri")&&K.setObject("arcgis.csv",E,b);return E})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),
function(K,g,x,p,r,h){g=g("dojox.data.CsvStore",null,{constructor:function(b){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;b.url&&(this.url=b.url);this._csvData=b.data;b.label?this.label=b.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=b.identifier;""===this.identifier?
delete this.identifier:this._idMap={};"separator"in b&&(this.separator=b.separator);"urlPreventCache"in b&&(this.urlPreventCache=b.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(b){if(!this.isItem(b))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(b){b=this.getIdentity(b);this.identifier&&(b=this._idMap[b]);return b},getValue:function(b,a,c){this._assertIsItem(b);var l=
c;if("string"===typeof a)a=this._attributeIndexes[a],null!=a&&(l=this._dataArray[this._getIndex(b)][a]||c);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return l},getValues:function(b,a){return(b=this.getValue(b,a))?[b]:[]},getAttributes:function(b){this._assertIsItem(b);var a=[];b=this._dataArray[this._getIndex(b)];for(var c=0;c<b.length;c++)""!==b[c]&&a.push(this._attributes[c]);return a},hasAttribute:function(b,a){this._assertIsItem(b);
if("string"===typeof a)return a=this._attributeIndexes[a],b=this._dataArray[this._getIndex(b)],"undefined"!==typeof a&&a<b.length&&""!==b[a];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(b,a,c){var l=void 0;"string"===typeof c&&(l=r.patternToRegExp(c,!1));return this._containsValue(b,a,c,l)},_containsValue:function(b,a,c,l){b=this.getValues(b,a);for(a=0;a<b.length;++a){var k=b[a];if("string"===typeof k&&l)return null!==
k.match(l);if(c===k)return!0}return!1},isItem:function(b){if(b&&b[this._storeProp]===this)if(b=b[this._idProp],this.identifier){if(this._dataArray[this._idMap[b]])return!0}else if(0<=b&&b<this._dataArray.length)return!0;return!1},isItemLoaded:function(b){return this.isItem(b)},loadItem:function(b){},getFeatures:function(){return this._features},getLabel:function(b){if(this.label&&this.isItem(b))return this.getValue(b,this.label)},getLabelAttributes:function(b){return this.label?[this.label]:null},
_fetchItems:function(b,a,c){var l=this,k=function(u,z){var A=null;if(u.query){var t;A=[];var w=u.queryOptions?u.queryOptions.ignoreCase:!1,q={};for(t in u.query){var E=u.query[t];"string"===typeof E&&(q[t]=r.patternToRegExp(E,w))}for(w=0;w<z.length;++w){var B=!0,C=z[w];for(t in u.query)E=u.query[t],l._containsValue(C,t,E,q[t])||(B=!1);B&&A.push(C)}}else A=z.slice(0,z.length);a(A,u)};if(this._loadFinished)k(b,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:b,
filter:k});else{this._loadInProgress=!0;var n=x.get({url:l.url,handleAs:"text",preventCache:l.urlPreventCache});n.addCallback(function(u){try{l._processData(u),k(b,l._arrayOfAllItems),l._handleQueuedFetches()}catch(z){c(z,b)}});n.addErrback(function(u){l._loadInProgress=!1;if(c)c(u,b);else throw u;});var d=null;b.abort&&(d=b.abort);b.abort=function(){var u=n;u&&-1===u.fired&&(u.cancel(),u=null);d&&d.call(b)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,k(b,this._arrayOfAllItems)}catch(u){c(u,
b)}else{var e=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(c)c(e,b);else throw e;}},close:function(b){},_getArrayOfArraysFromCsvFileContents:function(b){if(K.isString(b)){var a=RegExp("^\\s+","g"),c=RegExp("\\s+$","g"),l=RegExp('""',"g"),k=[],n=this._splitLines(b);for(b=0;b<n.length;++b){var d=n[b];if(0<d.length){d=d.split(this.separator);for(var e=0;e<d.length;){var u=d[e].replace(a,""),z=u.replace(c,""),A=z.charAt(0),t=z.charAt(z.length-1),
w=z.charAt(z.length-2),q=z.charAt(z.length-3);if(2===z.length&&'""'==z)d[e]="";else if('"'==A&&('"'!=t||'"'==t&&'"'==w&&'"'!=q)){if(e+1===d.length)return;d[e]=u+this.separator+d[e+1];d.splice(e+1,1)}else'"'==A&&'"'==t&&(z=z.slice(1,z.length-1),z=z.replace(l,'"')),d[e]=z,e+=1}k.push(d)}}this._attributes=k.shift();for(b=0;b<this._attributes.length;b++)this._attributeIndexes[this._attributes[b]]=b;this._dataArray=k}},_splitLines:function(b){var a=[],c,l="",k=!1;for(c=0;c<b.length;c++){var n=b.charAt(c);
switch(n){case '"':k=!k;l+=n;break;case "\r":k?l+=n:(a.push(l),l="",c<b.length-1&&"\n"==b.charAt(c+1)&&c++);break;case "\n":k?l+=n:(a.push(l),l="");break;default:l+=n}}""!==l&&a.push(l);return a},_processData:function(b){this._getArrayOfArraysFromCsvFileContents(b);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(b=0;b<this._dataArray.length;b++){var a=b;
this.identifier&&(a=this._dataArray[b][this._attributeIndexes[this.identifier]],this._idMap[a]=b);this._arrayOfAllItems.push(this._createItemFromIdentity(a))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(b){var a={};a[this._storeProp]=this;a[this._idProp]=b;return a},getIdentity:function(b){return this.isItem(b)?b[this._idProp]:null},fetchItemByIdentity:function(b){var a=b.scope?b.scope:p.global;if(this._loadFinished){var c=this._createItemFromIdentity(b.identity);
this.isItem(c)||(c=null);b.onItem&&b.onItem.call(a,c)}else{var l=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:b}):(this._loadInProgress=!0,c=x.get({url:l.url,handleAs:"text"}),c.addCallback(function(k){try{l._processData(k);var n=l._createItemFromIdentity(b.identity);l.isItem(n)||(n=null);b.onItem&&b.onItem.call(a,n);l._handleQueuedFetches()}catch(d){b.onError&&b.onError.call(a,d)}}),c.addErrback(function(k){this._loadInProgress=!1;b.onError&&b.onError.call(a,k)}));else if(this._csvData)try{l._processData(l._csvData),
l._csvData=null,c=l._createItemFromIdentity(b.identity),l.isItem(c)||(c=null),b.onItem&&b.onItem.call(a,c)}catch(k){b.onError&&b.onError.call(a,k)}}},getIdentityAttributes:function(b){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var b=0;b<this._queuedFetches.length;b++){var a=this._queuedFetches[b],c=a.filter,l=a.args;c?c(l,this._arrayOfAllItems):this.fetchItemByIdentity(a.args)}this._queuedFetches=[]}}});K.extend(g,h);return g})},
"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ../urlUtils ./ServiceGeneratedFeatureCollection".split(" "),function(K,g,x,p,r,h,b,a,c){K=K([c],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:a.getProtocolForWebResource()+"//utility.arcgis.com/sharing/rss",constructor:function(l,k){this._url=a.urlToObject(this.url=l);h.defaults.geoRSSService&&(this.serviceUrl=h.defaults.geoRSSService);this._createLayer()},
parse:function(){return this._io=b({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?x.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(l){this.inherited(arguments);this.loaded||(this.loaded=!0,this.onLoad(this))}});p("extend-esri")&&g.setObject("layers.GeoRSSLayer",K,r);return K})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u){K=K([d],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(z,A){this.pointSymbol=A&&A.pointSymbol;this.polylineSymbol=A&&A.polylineSymbol;this.polygonSymbol=A&&A.polygonSymbol;this._outSR=A&&(A.outSpatialReference||A.outSR)||new c({wkid:4326});this._options=x.mixin({},A)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var z=[];this._fLayers&&(z=z.concat(this._fLayers));
return z},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._createLayer()},_createLayer:function(z){var A=this;this._fireUpdateStart();z=this.parse(z);z.addCallback(function(t){A._io=null;A._initLayer(t)});z.addErrback(function(t){A._io=null;t=x.mixin(Error(),t);t.message="Unable to load resource: "+A.url+" "+(t.message||"");A._fireUpdateEnd(t);A.onError(t)})},_initLayer:function(z){this.loaded&&this._removeInternalLayers();
this.name=z.name;this.description=z.description;this.snippet=z.snippet;this.featureInfos=z.featureInfos;this.fullExtent=this.initialExtent=new l(z.lookAtExtent);this.copyright=z.author||z.copyright;var A;(z=x.getObject("featureCollection.layers",!1,z))&&0<z.length&&(this._fLayers=[],p.forEach(z,function(t,w){var q=x.getObject("featureSet.features",!1,t);q&&0<q.length&&(A=x.mixin({outFields:["*"],infoTemplate:t.popupInfo?new u(t.popupInfo):null,editable:!1},this._options),A.id&&(A.id=A.id+"_"+w),A.webgl=
!1,t.layerDefinition.capabilities="Query,Data",t=new e(t,A),t.geometryType&&(this["_"+t.geometryType]=t),this._fLayers.push(t))},this),0===this._fLayers.length&&delete this._fLayers);this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(z=new n(this.pointSymbol),this._esriGeometryPoint.setRenderer(z)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(z=new n(this.polylineSymbol),
this._esriGeometryPolyline.setRenderer(z)));this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(z=new n(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(z)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var z=this._map;this._fireUpdateStart();var A=z.spatialReference,t=this._outSR;if(A.wkid)var w=A._isWebMercator()&&t._isWebMercator()||A.wkid===t.wkid;else if(A.wkt)w=
A.wkt===t.wkt;else{console.log("_setMap - map has invalid spatial reference");return}if(!w)if(A._isWebMercator()&&4326===t.wkid)this._converter=k.geographicToWebMercator;else if(t._isWebMercator()&&4326===A.wkid)this._converter=k.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(A=this._fLayers)&&0<A.length&&p.forEach(A,function(q){if(this._converter){var E=q.graphics,
B,C,G=E?E.length:0;for(B=0;B<G;B++)(C=E[B].geometry)&&E[B].setGeometry(this._converter(C))}z.addLayer(q)},this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var z=this._map;z&&p.forEach(this.getFeatureLayers(),z.removeLayer,z)},setScaleRange:function(z,A){this.inherited(arguments);p.forEach(this.getFeatureLayers(),function(t){t.setScaleRange(z,A)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(z){this.opacity!=
z&&(p.forEach(this.getFeatureLayers(),function(A){A.setOpacity(z)}),this.opacity=this._options.opacity=z,this.onOpacityChange(z))},onVisibilityChange:function(z){this._fireUpdateStart();p.forEach(this.getFeatureLayers(),function(A){A.setVisibility(z)});this._fireUpdateEnd()},_setMap:function(z,A){this.inherited(arguments);this._map=z;var t=this._div=r.create("div",null,A);h.set(t,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return t},_unsetMap:function(z,A){this._io&&
this._io.cancel();g.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var t=this._div;t&&(A.removeChild(t),r.destroy(t));this._div=null;this.inherited(arguments)}});b("extend-esri")&&x.setObject("layers._ServiceGeneratedFeatureCollection",K,a);return K})},"widgets/AddData/search/AddFromFilePane":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/on dojo/Deferred dojo/dom-class dijit/Viewport dojo/sniff dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddFromFilePane.html dojo/i18n!../nls/strings ./LayerLoader ./util dojo/_base/kernel esri/request esri/layers/FeatureLayer esri/layers/KMLLayer esri/geometry/scaleUtils jimu/dijit/Message jimu/dijit/CheckBox".split(" "),
function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w,q,E,B){return K([l,k,n],{i18n:e,templateString:d,wabWidget:null,maxRecordCount:1E3,maxRecordThreshold:1E5,SHAPETYPE_ICONS:[{type:"shapefile",url:"images/filetypes/zip.svg"},{type:"csv",url:"images/filetypes/csv.svg"},{type:"kml",url:"images/filetypes/kml.svg"},{type:"gpx",url:"images/filetypes/gpx.svg"},{type:"geojson",url:"images/filetypes/geojson.svg"}],postCreate:function(){this.inherited(arguments);this.generalizeCheckBox.setLabel(e.addFromFile.generalizeOn);
this.own(a.on("resize",this.resize()))},destroy:function(){this.inherited(arguments)},startup:function(){if(!this._started){this.wabWidget.isPortal&&(this.SHAPETYPE_ICONS=[{type:"shapefile",url:"images/filetypes/zip.svg"},{type:"csv",url:"images/filetypes/csv.svg"},{type:"kml",url:"images/filetypes/kml.svg"},{type:"geojson",url:"images/filetypes/geojson.svg"}]);this.inherited(arguments);var C=this,G=this.dropArea,D=this.wabWidget.config;if(D.addFromFile)try{var f=Number(D.addFromFile.maxRecordCount);
"number"!==typeof f||isNaN(f)||(f=Math.floor(f),1<=f&&f<=this.maxRecordThreshold&&(this.maxRecordCount=f))}catch(y){console.warn("Error setting AddFromFile.maxRecordCount:"),console.warn(y)}if(e.addFromFile.types)try{for(var m in e.addFromFile.types)this._createFileTypeImage(m)}catch(y){console.warn("Error reading support file types:"),console.warn(y)}this.own(r(this.fileNode,"change",function(){if(!C._getBusy()){C._setBusy(!0);var y=C._getFileInfo();y.ok&&C._execute(y);C.fileNode.value=null}}));
this.own(r(this.uploadLabel,"click",function(y){C._getBusy()&&(y.preventDefault(),y.stopPropagation())}));this.own(r(G,"dragenter",function(y){y.preventDefault();C._getBusy()||(b.add(G,"hit"),C._setStatus(""))}));this.own(r(G,"dragleave",function(y){y.preventDefault();b.remove(G,"hit")}));this.own(r(G,"dragover",function(y){y.preventDefault()}));this.own(r(G,"drop",function(y){y.preventDefault();y.stopPropagation();C._getBusy()||(C._setBusy(!0),y=C._getFileInfo(y),y.ok&&C._execute(y))}));f=this.wabWidget.domNode;
this.own(r(f,"dragenter",function(y){y.preventDefault()}));this.own(r(f,"dragleave",function(y){y.preventDefault()}));this.own(r(f,"dragover",function(y){y.preventDefault()}));this.own(r(f,"drop",function(y){y.preventDefault()}));this.own(r(this.hintButton,"click",g.hitch(this,function(y){y.preventDefault();y='\x3cdiv class\x3d"intro"\x3e\x3clabel\x3e'+e.addFromFile.intro+"\x3c/label\x3e\x3cul\x3e\x3cli\x3e"+e.addFromFile.types.Shapefile+"\x3c/li\x3e\x3cli\x3e"+e.addFromFile.types.CSV+"\x3c/li\x3e\x3cli\x3e"+
e.addFromFile.types.KML+"\x3c/li\x3e\x3cli\x3e"+e.addFromFile.types.GPX+"\x3c/li\x3e\x3cli\x3e"+e.addFromFile.types.GeoJSON+'\x3c/li\x3e\x3cli\x3e\x3cspan class\x3d"note"\x3e'+e.addFromFile.maxFeaturesAllowedPattern.replace("{count}",this.maxRecordCount)+"\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e";this.wabWidget.isPortal&&(y='\x3cdiv class\x3d"intro"\x3e\x3clabel\x3e'+e.addFromFile.intro+"\x3c/label\x3e\x3cul\x3e\x3cli\x3e"+e.addFromFile.types.Shapefile+"\x3c/li\x3e\x3cli\x3e"+e.addFromFile.types.CSV+
"\x3c/li\x3e\x3cli\x3e"+e.addFromFile.types.KML+"\x3c/li\x3e\x3cli\x3e"+e.addFromFile.types.GeoJSON+'\x3c/li\x3e\x3cli\x3e\x3cspan class\x3d"note"\x3e'+e.addFromFile.maxFeaturesAllowedPattern.replace("{count}",this.maxRecordCount)+"\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e");new B({message:y})})))}},_addFeatures:function(C,G){var D,f=[],m=C.map,y=0,v=new u;G.layers&&(y=G.layers.length);x.forEach(G.layers,function(F){F=new w(F,{id:v._generateLayerId(),outFields:["*"]});F.xtnAddData=!0;F.graphics&&
(C.numFeatures+=F.graphics.length);0===y?F.name=C.baseFileName:"string"!==typeof F.name||0===F.name.length?F.name=C.baseFileName:0!==F.name.indexOf(C.baseFileName)&&(F.name=e.addFromFile.layerNamePattern.replace("{filename}",C.baseFileName).replace("{name}",F.name));v._setFeatureLayerInfoTemplate(F,null,null);if(F.fullExtent){var H=F.fullExtent.getCenter();H.x&&H.y&&(D=D?D.union(F.fullExtent):F.fullExtent)}f.push(F)});0<f.length&&(m.addLayers(f),D&&m.setExtent(D.expand(1.25),!0))},_analyze:function(C,
G){if("csv"!==C.fileType.toLowerCase())return G=new h,G.resolve(null),G;var D=null;this.wabWidget.batchGeocoderServers&&0<this.wabWidget.batchGeocoderServers.length&&(D=this.wabWidget.batchGeocoderServers[0]);var f={enableGlobalGeocoding:!0,sourceLocale:A.locale};D&&(f.geocodeServiceUrl=D.url,D.isWorldGeocodeServer&&(f.sourceCountry="world",f.sourceCountryHint=""));D=C.sharingUrl+"/content/features/analyze";f={f:"json",filetype:C.fileType.toLowerCase(),analyzeParameters:window.JSON.stringify(f)};
G=t({url:D,content:f,form:G,handleAs:"json"});G.then(function(m){m&&m.publishParameters&&(C.publishParameters=m.publishParameters)});return G},_createFileTypeImage:function(C){var G=window.isRTL;x.some(this.SHAPETYPE_ICONS,g.hitch(this,function(D,f){if(C.toLowerCase()===D.type.toLowerCase()){var m=document.createElement("IMG");m.src=this.wabWidget.folderUrl+D.url;m.alt=C;0===f?m.className+=" "+(G?"last":"first")+"-type-icon":1===f?m.className+=" second-"+(G?"last":"first")+"-type-icon":f===this.SHAPETYPE_ICONS.length-
2?m.className+=" second-"+(G?"first":"last")+"-type-icon":f===this.SHAPETYPE_ICONS.length-1&&(m.className+=" "+(G?"first":"last")+"-type-icon");this.supportedFileTypes.appendChild(m)}}))},_execute:function(C){var G={map:this.wabWidget.map,sharingUrl:this.wabWidget.getSharingUrl(),baseFileName:C.baseFileName,fileName:C.fileName,fileType:C.fileType,generalize:!!this.generalizeCheckBox.getValue(),publishParameters:{},numFeatures:0};this._setBusy(!0);this._setStatus(e.addFromFile.addingPattern.replace("{filename}",
C.fileName));if("kml"===C.fileType.toLowerCase())return this._executeKml(C);var D=C.fileName,f=this,m=new FormData;m.append("file",C.file);f._analyze(G,m).then(function(y){y&&y.publishParameters&&y.publishParameters.locationType&&"unknown"===y.publishParameters.locationType&&new B({titleLabel:e._widgetLabel,message:e.addFromFile.featureLocationsCouldNotBeFound});return f._generateFeatures(G,m)}).then(function(y){f._addFeatures(G,y.featureCollection);f._setBusy(!1);f._setStatus(e.addFromFile.featureCountPattern.replace("{filename}",
D).replace("{count}",G.numFeatures))}).otherwise(function(y){f._setBusy(!1);f._setStatus(e.addFromFile.addFailedPattern.replace("{filename}",D));console.warn("Error generating features.");console.warn(y);y&&"string"===typeof y.message&&0<y.message.length&&new B({titleLabel:e._widgetLabel,message:e.addFromFile.generalIssue+"\x3cbr\x3e\x3cbr\x3e"+y.message})})},_executeKml:function(C){var G=this,D=new FileReader,f=this.wabWidget.map,m=function(y,v){G._setBusy(!1);G._setStatus(e.addFromFile.addFailedPattern.replace("{filename}",
C.fileName));console.warn(y);console.error(v);v&&"string"===typeof v.message&&0<v.message.length&&new B({titleLabel:e._widgetLabel,message:e.addFromFile.generalIssue+"\x3cbr\x3e\x3cbr\x3e"+v.message})};D.onerror=function(y){m("FileReader::onerror",y)};D.onload=function(y){if(D.error)m("FileReader::error",D.error);else{var v=y.target.result,F=new u;y=F._generateLayerId();var H=new q("",{id:y,name:C.fileName,linkInfo:{visibility:!1}});H.visible=!0;delete H.linkInfo;H._parseKml=function(){var L=this;
this._fireUpdateStart();this._io=t({url:this.serviceUrl,content:{kmlString:encodeURIComponent(v),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:p.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(N){L._io=null;L._initLayer(N);F._waitForLayer(H).then(function(Q){var R=0;Q.name=C.fileName;Q.xtnAddData=!0;x.forEach(Q.getLayers(),function(X){X&&X.graphics&&0<X.graphics.length&&(R+=X.graphics.length)});var W=f.spatialReference,Z=Q._outSR;W&&Z&&(W.equals(Z)||W.isWebMercator()&&
4326===Z.wkid||Z.isWebMercator()&&4326===W.wkid)?f.addLayer(Q):new B({titleLabel:e._widgetLabel,message:e.addFromFile.kmlProjectionMismatch});G._setBusy(!1);G._setStatus(e.addFromFile.featureCountPattern.replace("{filename}",C.fileName).replace("{count}",R))}).otherwise(function(Q){m("kml-_waitForLayer.error",Q)})},error:function(N){L._io=null;N=g.mixin(Error(),N);N.message="Unable to load KML: "+(N.message||"");L._fireUpdateEnd(N);L._errorHandler(N);m("Unable to load KML",N)}},{usePost:!0})};H._parseKml()}};
try{D.readAsText(C.file)}catch(y){m("FileReader::readAsText",y)}},_generateFeatures:function(C,G){var D=C.sharingUrl+"/content/features/generate";C.publishParameters=C.publishParameters||{};var f=g.mixin(C.publishParameters,{name:C.baseFileName,targetSR:C.map.spatialReference,maxRecordCount:this.maxRecordCount,enforceInputFileSizeLimit:!0,enforceOutputJsonSizeLimit:!0});if(C.generalize){var m=E.getExtentForScale(C.map,4E4).getWidth()/C.map.width;f.generalize=!0;f.maxAllowableOffset=m;m/=10;for(var y=
0;1>m;)m*=10,y++;f.reducePrecision=!0;f.numberOfDigitsAfterDecimal=y}C={f:"json",filetype:C.fileType.toLowerCase(),publishParameters:window.JSON.stringify(f)};return t({url:D,content:C,form:G,handleAs:"json"})},_getBaseFileName:function(C){c("ie")&&(C=C.split("\\"),C=C[C.length-1]);C=C.split(".");return C=C[0].replace("c:\\fakepath\\","")},_getBusy:function(){return b.contains(this.uploadLabel,"disabled")},_getFileInfo:function(C){var G={ok:!1,file:null,fileName:null,fileType:null};if((C=C?C.dataTransfer.files:
this.fileNode.files)&&1===C.length)if(G.file=C=C[0],G.fileName=C.name,z.endsWith(C.name,".zip"))G.ok=!0,G.fileType="Shapefile";else if(z.endsWith(C.name,".csv"))G.ok=!0,G.fileType="CSV";else if(z.endsWith(C.name,".kml"))G.ok=!0,G.fileType="KML";else if(z.endsWith(C.name,".gpx"))G.ok=!0,G.fileType="GPX";else if(z.endsWith(C.name,".geojson")||z.endsWith(C.name,".geo.json"))G.ok=!0,G.fileType="GeoJSON";G.ok&&(G.ok=x.some(this.SHAPETYPE_ICONS,function(f){return f.type.toLowerCase()===G.fileType.toLowerCase()}));
if(G.ok)G.baseFileName=this._getBaseFileName(G.fileName);else{C=e.addFromFile.invalidType;"string"===typeof G.fileName&&0<G.fileName.length&&(C=e.addFromFile.invalidTypePattern.replace("{filename}",G.fileName));this._setBusy(!1);this._setStatus(C);var D=document.createElement("div");D.appendChild(document.createTextNode(C));new B({titleLabel:e._widgetLabel,message:D})}return G},resize:function(){},_setBusy:function(C){C?(b.add(this.uploadLabel,"disabled"),b.add(this.dropArea,["hit","disabled"])):
(b.remove(this.uploadLabel,"disabled"),b.remove(this.dropArea,["hit","disabled"]))},_setStatus:function(C){this.wabWidget&&this.wabWidget._setStatus(C)}})})},"widgets/AddData/search/LayerListPane":function(){define("dojo/_base/declare dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/LayerListPane.html dojo/i18n!../nls/strings ./util".split(" "),function(K,g,x,p,r,h,b,a,c,l,k){return K([h,b,a],{i18n:l,
templateString:c,wabWidget:null,baseClass:"add-data-widget-layers",postCreate:function(){this.inherited(arguments)},startup:function(){this._started||(this._buildList(),this._initListeners(),this.inherited(arguments))},_addLayer:function(n,d){var e=this,u=this._getLayerTitle(d),z=r.create("div",{"class":"add-data-layerlist--listitem"},n);r.create("A",{"class":"remove-button",href:"#",innerHTML:"\x3cspan class\x3d'esri-icon-trash'\x3e\x3c/span\x3e",title:l.layerList.removeLayer,onclick:function(A){A.preventDefault();
try{e.wabWidget&&e.wabWidget.map&&(e.wabWidget.map.removeLayer(d),r.destroy(z))}catch(t){console.warn("Error removing layer."),console.warn(t)}}},z);n=r.create("label",{"class":"layer-name"},z);k.setNodeText(n,u)},_buildList:function(){var n=this,d=!1,e=[],u=this.wabWidget.map,z=r.create("div",{"class":"add-data-layerlist--list"});g.forEach(u.layerIds,function(A){e.push(A)});g.forEach(u.graphicsLayerIds,function(A){e.push(A)});e.reverse();g.forEach(e,function(A){(A=u.getLayer(A))&&A.xtnAddData&&(d=
!0,n._addLayer(z,A))});return d?z:r.create("div",{"class":"no-data-message",innerHTML:l.layerList.noLayersAdded})},_getLayerTitle:function(n){var d="...";if("string"===typeof n.label&&0<n.label.length)d=n.label;else if("string"===typeof n.title&&0<n.title.length)d=n.title;else if("string"===typeof n.name&&0<n.name.length)d=n.name;else if(n.url){var e=n.url.indexOf("/FeatureServer");-1===e&&(e=n.url.indexOf("/MapServer"));-1===e&&(e=n.url.indexOf("/ImageServer"));-1===e&&(e=n.url.indexOf("/service"));
-1<e&&(n=n.url.substring(0,e),d=n=n.substring(n.lastIndexOf("/")+1,n.length))}return d},_initListeners:function(){var n=this;this.own(x(this._backButton,"click",function(d){d.preventDefault();n.hide()}))},show:function(){var n=this._buildList();this._title.innerHTML=l.layerList.caption;this._layerlist.innerHTML="";n&&n.tagName&&this._layerlist.appendChild(n);this.wabWidget&&this.wabWidget.domNode&&p.add(this.wabWidget.domNode,"layerlist-show");p.add(this.domNode,"show")},hide:function(){this.wabWidget&&
this.wabWidget.domNode&&p.remove(this.wabWidget.domNode,"layerlist-show");p.remove(this.domNode,"show")}})})},"widgets/AddData/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/AddData/search/templates/SearchPane.html":'\x3cdiv class\x3d"search-pane"\x3e\r\n  \x3cdiv class\x3d"search-pane-header" data-dojo-attach-point\x3d"headerNode"\x3e\r\n    \x3cdiv class\x3d"search-bar main-search-bar"\x3e\r\n      \x3cdiv data-dojo-type\x3d"widgets/AddData/search/ScopeOptions"\r\n        data-dojo-attach-point\x3d"scopeOptions"\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\x3cspan class\x3d"search-box-placeholder" data-dojo-attach-point\x3d"searchBoxPlaceholder"\x3e\x3c/span\x3e--\x3e\r\n      \x3cdiv data-dojo-type\x3d"widgets/AddData/search/SearchBox"\r\n        data-dojo-attach-point\x3d"searchBox"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"search-bar-separator"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"search-bar search-bar-secondary" data-dojo-attach-point\x3d"optionsNode"\x3e\r\n      \x3cdiv data-dojo-type\x3d"widgets/AddData/search/BBoxOption"\r\n        data-dojo-attach-point\x3d"bboxOption"\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"filter-wrapper2"\x3e\r\n        \x3cdiv data-dojo-type\x3d"widgets/AddData/search/TypeOptions"\r\n          data-dojo-attach-point\x3d"typeOptions"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-type\x3d"widgets/AddData/search/SortOptions"\r\n          data-dojo-attach-point\x3d"sortOptions"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      --\x3e\r\n      \x3cspan class\x3d"filter-placeholder" data-dojo-attach-point\x3d"filterPlaceholder"\x3e\x3c/span\x3e\r\n      \x3cdiv class\x3d"filter-wrapper" data-dojo-attach-point\x3d"filterWrapper"\x3e\r\n        \x3cdiv data-dojo-type\x3d"widgets/AddData/search/TypeOptions"\r\n          data-dojo-attach-point\x3d"typeOptions"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-type\x3d"widgets/AddData/search/SortOptions"\r\n          data-dojo-attach-point\x3d"sortOptions"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"search-pane-content" data-dojo-attach-point\x3d"contentNode"\x3e\r\n    \x3cdiv data-dojo-type\x3d"widgets/AddData/search/ResultsPane"\r\n      data-dojo-attach-point\x3d"resultsPane"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"search-pane-footer jimu-float-leading" data-dojo-attach-point\x3d"footerNode"\x3e\r\n    \x3cdiv data-dojo-type\x3d"widgets/AddData/search/Paging"\r\n      data-dojo-attach-point\x3d"paging"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"widgets/AddData/search/ResultCount"\r\n      data-dojo-attach-point\x3d"resultCount"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/SearchBox.html":'\x3cdiv class\x3d"search-box2"\x3e\r\n\t\x3cinput type\x3d"text" class\x3d"search-textbox"\r\n\t\tplaceholder\x3d"${i18n.search.searchBox.placeholder}"\r\n\t\tdata-dojo-attach-point\x3d"searchTextBox"\r\n\t\x3e\x3cbutton class\x3d"btn btn-confirm" type\x3d"button"\r\n\t\tdata-dojo-attach-point\x3d"searchButton"\r\n\t\tdata-dojo-attach-event\x3d"onClick: searchButtonClicked"\r\n\t\ttitle\x3d"${i18n.search.searchBox.search}"\r\n\t\t\x3e\x3cspan class\x3d"esri-icon-search"\x3e\x3c/span\x3e\r\n\t\x3c/button\x3e\r\n\x3c!--\r\n\x3cdiv class\x3d"search-box"\x3e\r\n\t\x3cdiv class\x3d"input-group"\x3e\r\n\t\t\x3cinput type\x3d"text" class\x3d"search-textbox"\r\n\t\t\tplaceholder\x3d"${i18n.search.searchBox.placeholder}"\r\n\t\t\tdata-dojo-attach-point\x3d"searchTextBox"\x3e\r\n    \x3cspan class\x3d"search-btn"\x3e\r\n\t\t\t\x3cbutton class\x3d"btn btn-clear hidden" type\x3d"button"\r\n\t\t\t\tdata-dojo-attach-point\x3d"clearButton"\r\n\t\t\t\tdata-dojo-attach-event\x3d"onClick: clearButtonClicked"\x3e\r\n\t\t\t\t\x3cspan class\x3d"esri-icon-close"\x3e\x3c/span\x3e\r\n\t\t\t\x3c/button\x3e\r\n\t\t\t\x3cbutton class\x3d"btn btn-confirm" type\x3d"button"\r\n\t\t\t\tdata-dojo-attach-point\x3d"searchButton"\r\n\t\t\t\tdata-dojo-attach-event\x3d"onClick: searchButtonClicked"\r\n\t\t\t\ttitle\x3d"${i18n.search.searchBox.search}"\r\n\t\t\t\t\x3e\x3cspan class\x3d"esri-icon-search"\x3e\x3c/span\x3e\r\n\t\t\t\x3c/button\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n--\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/BBoxOption.html":'\x3cdiv class\x3d"search-bbox-option"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"bboxSection" class\x3d"switch-toggle-group"\x3e\r\n    \x3clabel class\x3d"checkbox-inline"\x3e\r\n      \x3cinput id\x3d"${id}_bboxId"\r\n\t      data-dojo-type\x3d"dijit/form/CheckBox"\r\n\t      data-dojo-attach-point\x3d"bboxToggle"\r\n\t      data-dojo-attach-event\x3d"onClick: bboxClicked"\r\n\t      data-dojo-props\x3d"class: \'switch-toggle\'"\r\n        title\x3d"${i18n.search.bboxOption.bbox}"/\x3e\r\n      \x3cspan class\x3d"label-text"\x3e${i18n.search.bboxOption.bbox}\x3c/span\x3e\r\n    \x3c/label\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/ScopeOptions.html":'\x3cdiv class\x3d"search-scope-options"\x3e\r\n  \x3ca href\x3d"#" class\x3d"scope-placeholder"\r\n    data-dojo-attach-point\x3d"scopePlaceholder"\r\n    data-dojo-attach-event\x3d"onClick: scopePlaceholderClicked"\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"scopePlaceholderText"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"dropdown-arrow"\x3e\x3c/span\x3e\r\n  \x3c/a\x3e\r\n  \x3cdiv class\x3d"btn-group" data-dojo-attach-point\x3d"btnGroup"\x3e\r\n    \x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" name\x3d"${id}_scope"\r\n      data-dojo-attach-point\x3d"MyContentToggle"\r\n      data-dojo-attach-event\x3d"onClick: optionClicked"\r\n      data-option-name\x3d"MyContent"\x3e\r\n      ${i18n.search.scopeOptions.myContent}\r\n    \x3c/button\x3e\r\n    \x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" name\x3d"${id}_scope"\r\n      data-dojo-attach-point\x3d"MyOrganizationToggle"\r\n      data-dojo-attach-event\x3d"onClick: optionClicked"\r\n      data-option-name\x3d"MyOrganization"\x3e\r\n      ${i18n.search.scopeOptions.myOrganization}\r\n    \x3c/button\x3e\r\n    \x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" name\x3d"${id}_scope"\r\n      data-dojo-attach-point\x3d"CuratedToggle"\r\n      data-dojo-attach-event\x3d"onClick: optionClicked"\r\n      data-option-name\x3d"Curated"\x3e\r\n      ${i18n.search.scopeOptions.curated}\r\n    \x3c/button\x3e\r\n    \x3cbutton type\x3d"button" class\x3d"btn btn-sm btn-default" name\x3d"${id}_scope"\r\n      data-dojo-attach-point\x3d"ArcGISOnlineToggle"\r\n      data-dojo-attach-event\x3d"onClick: optionClicked"\r\n      data-option-name\x3d"ArcGISOnline"\x3e\r\n      ${i18n.search.scopeOptions.ArcGISOnline}\r\n    \x3c/button\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/TypeOptions.html":'\x3cdiv class\x3d"search-data-type-options"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/DropDownButton"\x3e\r\n    \x3cspan\x3e${i18n.search.typeOptions.prompt}\x3c/span\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/TooltipDialog"\r\n         data-dojo-attach-point\x3d"tooltipDialog"\r\n         data-dojo-props\x3d"\'class\':\'add-data-widget-popup\'"\x3e\r\n      \x3clabel for\x3d"${id}_mapServiceId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_mapServiceId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"mapServiceToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;Map Service\x26quot;\'\x3e\x3c/div\x3e\r\n        ${i18n.search.typeOptions.mapService}\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_featureServiceId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_featureServiceId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"featureServiceToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;Feature Service\x26quot;\'\x3e\x3c/div\x3e\r\n        ${i18n.search.typeOptions.featureService}\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_imageServiceId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_imageServiceId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"imageServiceToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;Image Service\x26quot;\'\x3e\x3c/div\x3e\r\n        ${i18n.search.typeOptions.imageService}\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_vectorTileServiceId" class\x3d"search-type-option"\r\n        data-dojo-attach-point\x3d"vectorTileNode"\x3e\r\n        \x3cdiv id\x3d"${id}_vectorTileServiceId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"vectorTileServiceToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;Vector Tile Service\x26quot;\'\x3e\x3c/div\x3e\r\n        ${i18n.search.typeOptions.vectorTileService}\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_kmlId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_kmlId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"kmlToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;KML\x26quot;\'\x3e\x3c/div\x3e\r\n        ${i18n.search.typeOptions.kml}\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_wmsId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_wmsId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"wmsToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;WMS\x26quot;\'\x3e\x3c/div\x3e\r\n        ${i18n.search.typeOptions.wms}\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_wfsId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_wfsId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"wfsToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;WFS\x26quot;\'\x3e\x3c/div\x3e\r\n        WFS\r\n      \x3c/label\x3e\r\n      \x3clabel for\x3d"${id}_wmtsId" class\x3d"search-type-option"\x3e\r\n        \x3cdiv id\x3d"${id}_wmtsId"\r\n          data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n          data-dojo-attach-point\x3d"wmtsToggle"\r\n          data-dojo-attach-event\x3d"onClick: optionClicked"\r\n          data-option-q\x3d\'type:\x26quot;WMTS\x26quot;\'\x3e\x3c/div\x3e\r\n        WMTS\r\n      \x3c/label\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/SortOptions.html":'\x3cdiv class\x3d"search-sort-options"\x3e\r\n  \x3clabel for\x3d"${id}_select" class\x3d"sort-prompt"\x3e${i18n.search.sortOptions.prompt}\x3c/label\x3e \r\n  \x3cselect id\x3d"${id}_select"\r\n    data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"sortSelect"\x3e\r\n    \x3coption value\x3d"" selected\x3d"selected"\x3e${i18n.search.sortOptions.relevance}\x3c/option\x3e\r\n    \x3coption value\x3d"title"\x3e${i18n.search.sortOptions.title}\x3c/option\x3e\r\n    \x3coption value\x3d"owner"\x3e${i18n.search.sortOptions.owner}\x3c/option\x3e\r\n    \x3coption value\x3d"avgrating"\x3e${i18n.search.sortOptions.rating}\x3c/option\x3e\r\n    \x3coption value\x3d"numviews"\x3e${i18n.search.sortOptions.views}\x3c/option\x3e\r\n    \x3coption value\x3d"modified"\x3e${i18n.search.sortOptions.date}\x3c/option\x3e\r\n  \x3c/select\x3e\r\n  \x3ca href\x3d"#" class\x3d"sort-order-icon"\r\n    title\x3d"${i18n.search.sortOptions.switchOrder}"\r\n    data-dojo-attach-point\x3d"sortOrderBtn"\r\n    data-dojo-attach-event\x3d"onclick: sortOrderClicked"\x3e\r\n  \x3c/a\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/ResultsPane.html":'\x3cdiv class\x3d"search-results-pane" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv class\x3d"search-results-pane-no-match empty-data-label" data-dojo-attach-point\x3d"noMatchNode" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"itemsNode" class\x3d"search-results"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/AddData/search/templates/ItemCard.html":'\x3cdiv class\x3d"item-card"\x3e\r\n  \x3cdiv class\x3d"item-card-inner"\x3e\r\n    \x3cdiv class\x3d"thumbnail" data-dojo-attach-point\x3d"thumbnailNode"\x3e\x3c/div\x3e\r\n    \x3ch3 class\x3d"title" data-dojo-attach-point\x3d"titleNode"\x3e\x3c/h3\x3e\r\n    \x3cdiv class\x3d"info" data-dojo-attach-point\x3d"typeByOwnerNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"info" data-dojo-attach-point\x3d"dateNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"action-bar"\x3e\r\n      \x3cspan class\x3d"message" data-dojo-attach-point\x3d"messageNode"\x3e\x3c/span\x3e\r\n      \x3ca href\x3d"javascript:void(0)"\r\n        data-dojo-attach-point\x3d"addButton"\r\n        data-dojo-attach-event\x3d"onClick: addClicked"\r\n        \x3e${i18n.search.item.actions.add}\r\n      \x3c/a\x3e\r\n      \x3ca href\x3d"javascript:void(0)"\r\n        data-dojo-attach-point\x3d"detailsButton"\r\n        data-dojo-attach-event\x3d"onClick: detailsClicked"\r\n        \x3e${i18n.search.item.actions.details}\r\n      \x3c/a\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/Paging.html":'\x3cdiv class\x3d"search-paging"\x3e\r\n\t\x3cul class\x3d"pagination pagination-sm"\x3e\r\n\t\t\x3cli\x3e\r\n\t\t\t\x3ca href\x3d"#" aria-label\x3d"First"\r\n\t\t\t\tdata-dojo-attach-point\x3d"firstButton"\r\n\t\t\t\tdata-dojo-attach-event\x3d"onClick: firstButtonClicked"\r\n\t\t\t\ttitle\x3d"${i18n.search.paging.firstTip}"\x3e\r\n\t\t\t\t\x3cspan aria-hidden\x3d"true" class\x3d"esri-icon-expand"\x3e\x3c/span\x3e\r\n\t\t\t\x3c/a\x3e\r\n\t\t\x3c/li\x3e\r\n\t\t\x3cli\x3e\r\n\t\t\t\x3ca href\x3d"#" aria-label\x3d"Previous"\r\n\t\t\t\tdata-dojo-attach-point\x3d"previousButton"\r\n\t\t\t\tdata-dojo-attach-event\x3d"onClick: previousButtonClicked"\r\n\t\t\t\ttitle\x3d"${i18n.search.paging.previousTip}"\x3e\r\n\t\t\t\t\x3cspan aria-hidden\x3d"true" class\x3d"esri-icon-left"\x3e\x3c/span\x3e\r\n\t\t\t\x3c/a\x3e\r\n\t\t\x3c/li\x3e\r\n\t\t\x3cli class\x3d"current-page"\x3e\r\n\t\t  \x3cspan data-dojo-attach-point\x3d"pageNode"\x3e\x3c/span\x3e\r\n\t\t\x3c/li\x3e\r\n\t\t\x3cli\x3e\r\n\t\t\t\x3ca href\x3d"#" aria-label\x3d"Next"\r\n\t\t\t\tdata-dojo-attach-point\x3d"nextButton"\r\n\t\t\t\tdata-dojo-attach-event\x3d"onClick: nextButtonClicked"\r\n\t\t\t\ttitle\x3d"${i18n.search.paging.nextTip}"\x3e\r\n\t\t\t\t\x3cspan aria-hidden\x3d"true" class\x3d"esri-icon-right"\x3e\x3c/span\x3e\r\n\t\t\t\x3c/a\x3e\r\n\t\t\x3c/li\x3e\r\n\t\x3c/ul\x3e\r\n\x3c/div\x3e',
"url:widgets/AddData/search/templates/ResultCount.html":'\x3cdiv class\x3d"search-result-count"\x3e\r\n  \x3cspan class\x3d"search-count" data-dojo-attach-point\x3d"messageNode"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',"url:widgets/AddData/search/templates/AddFromUrlPane.html":'\x3cdiv class\x3d"secondary-pane add-url-pane"\x3e\r\n  \x3cdiv class\x3d"add-url-pane-container"\x3e\r\n    \x3cdiv class\x3d"add-url-pane-container--inner"\x3e\r\n      \x3clabel for\x3d"${id}_select"\x3e${i18n.addFromUrl.type}\x3c/label\x3e\r\n      \x3cselect id\x3d"${id}_select"\r\n        data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"typeSelect"\x3e\r\n        \x3coption value\x3d"ArcGIS" selected\x3d"selected"\x3e${i18n.addFromUrl.types.ArcGIS}\x3c/option\x3e\r\n        \x3coption value\x3d"WMS"\x3e${i18n.addFromUrl.types.WMS}\x3c/option\x3e\r\n        \x3coption value\x3d"WMTS"\x3e${i18n.addFromUrl.types.WMTS}\x3c/option\x3e\r\n        \x3coption value\x3d"WFS"\x3e${i18n.addFromUrl.types.WFS}\x3c/option\x3e\r\n        \x3coption value\x3d"KML"\x3e${i18n.addFromUrl.types.KML}\x3c/option\x3e\r\n        \x3coption value\x3d"GeoRSS"\x3e${i18n.addFromUrl.types.GeoRSS}\x3c/option\x3e\r\n        \x3coption value\x3d"CSV"\x3e${i18n.addFromUrl.types.CSV}\x3c/option\x3e\r\n      \x3c/select\x3e\r\n      \x3clabel for\x3d"${id}_url"\x3e${i18n.addFromUrl.url}\x3c/label\x3e\r\n      \x3cinput id\x3d"${id}_url" type\x3d"text" class\x3d"url-textbox jimu-input"\r\n          data-dojo-attach-point\x3d"urlTextBox"\r\n          data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n          data-dojo-props\x3d"\r\n            regExp: \'^(http|https):\\/\\/[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?$\'\r\n          "/\x3e\r\n      \x3cdiv class\x3d"action-bar"\x3e\r\n        \x3ca class\x3d"jimu-float-leading" href\x3d"javascript:void(0)"\r\n          data-dojo-attach-point\x3d"examplesExpander"\r\n          data-dojo-attach-event\x3d"onClick: examplesExpanderClicked"\r\n          \x3e${i18n.addFromUrl.samplesHint}\x3c/a\x3e\r\n        \x3ca class\x3d"jimu-btn"\r\n          href\x3d"javascript:void(0)"\r\n          data-dojo-attach-point\x3d"addButton"\r\n          data-dojo-attach-event\x3d"onClick: addClicked"\r\n          \x3e${i18n.search.item.actions.add}\r\n        \x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"examples" data-dojo-attach-point\x3d"examplesNode"\x3e\r\n        \x3cdiv data-examples-type\x3d"ArcGIS"\x3e\r\n          \x3cdiv\x3ehttp://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/World_Cities/FeatureServer/0\x3c/div\x3e\r\n          \x3cdiv\x3ehttp://services.arcgisonline.com/ArcGIS/rest/services/Demographics/USA_Tapestry/MapServer\x3c/div\x3e\r\n          \x3cdiv\x3ehttp://imagery.arcgisonline.com/ArcGIS/rest/services/LandsatGLS/VegetationAnalysis/ImageServer\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-examples-type\x3d"WMS"\x3e\r\n          \x3cdiv\x3ehttp://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi?service\x3dWMS\x26amp;request\x3dGetCapabilities\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-examples-type\x3d"WMTS"\x3e\r\n          \x3cdiv\x3ehttps://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-examples-type\x3d"WFS"\x3e\r\n          \x3cdiv\x3ehttps://dservices.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/services/JapanPrefectures2018/WFSServer\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-examples-type\x3d"KML"\x3e\r\n          \x3cdiv\x3ehttp://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_month_age_animated.kml\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-examples-type\x3d"GeoRSS"\x3e\r\n          \x3cdiv\x3ehttp://www.gdacs.org/xml/rss.xml\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-examples-type\x3d"CSV"\x3e\r\n          \x3cdiv\x3ehttp://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.csv\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/AddFromFilePane.html":'\x3cdiv class\x3d"secondary-pane add-file-pane"\x3e\r\n\r\n  \x3cdiv class\x3d"generalize-options"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox"\r\n      data-dojo-attach-point\x3d"generalizeCheckBox"\r\n      data-dojo-props\x3d"checked:true"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"browse-or-drop"\x3e\r\n    \x3cdiv class\x3d"drop-container" data-dojo-attach-point\x3d"dropContainer"\x3e\r\n      \x3cdiv class\x3d"drop-area" data-dojo-attach-point\x3d"dropArea"\x3e\r\n        \x3cdiv class\x3d"supported-file-types" data-dojo-attach-point\x3d"supportedFileTypes"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"or"\x3e${i18n.addFromFile.dropOrBrowse}\x3c/div\x3e\r\n        \x3cform class\x3d"file-form" enctype\x3d"multipart/form-data" method\x3d"post"\r\n          data-dojo-attach-point\x3d"fileForm"\x3e\r\n          \x3clabel for\x3d"${id}_file" class\x3d"jimu-btn"\r\n            data-dojo-attach-point\x3d"uploadLabel"\x3e${i18n.addFromFile.browse}\x3c/label\x3e\r\n          \x3cinput id\x3d"${id}_file" name\x3d"file" type\x3d"file" style\x3d"display:none"\r\n            data-dojo-attach-point\x3d"fileNode" /\x3e\r\n        \x3c/form\x3e\r\n        \x3ca href\x3d"#" class\x3d"drop-area-hint" data-dojo-attach-point\x3d"hintButton"\x3e\r\n          \x3ci class\x3d"esri-icon-question"\x3e\x3c/i\x3e\r\n        \x3c/a\x3e\r\n        \x3cspan class\x3d"upload-arrow"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/search/templates/LayerListPane.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"add-data-layerlist--mask"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"add-data-layerlist--container" data-dojo-attach-point\x3d"_container"\x3e\r\n    \x3ch2 data-dojo-attach-point\x3d"_title"\x3e\x3c/h2\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_layerlist"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"add-data-layerlist--footer jimu-widget-add-data-footer" data-dojo-attach-point\x3d"_footer"\x3e\r\n    \x3ca href\x3d"#" class\x3d"back-button" data-dojo-attach-point\x3d"_backButton"\x3e\r\n      ${i18n.layerList.back}\x3ci class\x3d"esri-icon-collapse"\x3e\x3c/i\x3e\r\n    \x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AddData/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tabsNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"searchNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"urlNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"fileNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/AddData/css/style.css":'.jimu-widget-add-data .jimu-tab3 {height: 100%;}.jimu-widget-add-data .search-pane,.jimu-widget-add-data .secondary-pane {height: 100%; width: 100%; background-color: #f8f8f8; position: relative;}.jimu-widget-add-data .search-pane \x3e *,.jimu-widget-add-data .secondary-pane \x3e * {width: 100%;}.jimu-widget-add-data .search-pane-content {position: absolute; top: 140px; bottom: 0; overflow: auto; background-color: #efefef;}.jimu-widget-add-data .search-pane .search-bar {padding: 10px 15px; line-height: 20px;}.jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn {min-width: 40px; padding-top: 10px; padding-bottom: 13px; background-color: transparent; border: 0; border-bottom: 2px solid transparent; margin-left: 5px; margin-right: 5px; color: #898989; font-size: 12px; font-weight: bold; font-family: inherit;}.jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn.active,.jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn.active:active,.jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn.active:hover {background-color: transparent !important; color: #000 !important; border-bottom-color: #24b5cc; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none;}.jimu-widget-add-data .search-pane .search-bar.main-search-bar {background-color: #fff; padding-bottom: 0; position: relative; display: flex;}.jimu-widget-add-data .search-pane .search-scope-options {flex: 1; overflow: hidden;}.jimu-widget-add-data .search-pane .search-bar.search-scope-bar .search-sort-options {margin-top: 5px;}.jimu-widget-add-data .search-pane .search-bar-secondary {background-color: #f8f8f8; padding-top: 5px; padding-bottom: 5px; font-size: 11px;}.jimu-widget-add-data .search-pane .search-pane-header {border-bottom: 1px solid #cccccc;}.jimu-widget-add-data .search-pane .search-pane-header:before,.jimu-widget-add-data .search-pane .search-pane-header:after {content: " "; display: table;}.jimu-widget-add-data .search-pane .search-pane-header:after {clear: both;}.jimu-widget-add-data .search-pane .search-bar:before,.jimu-widget-add-data .search-pane .search-bar:after {content: " "; display: table;}.jimu-widget-add-data .search-pane .search-bar:after {clear: both;}.jimu-widget-add-data .search-pane .search-data-type-options {margin-right: 15px;}.jimu-widget-add-data .search-pane .search-curated-option {display: inline-block; margin-left: 30px;}.jimu-widget-add-data .search-pane .search-bar-separator {border-bottom: 1px solid #e7e7e7;}.jimu-widget-add-data .search-pane .search-pane-default .search-bar {text-align: right; margin-bottom: 24px;}.jimu-widget-add-data .search-pane .search-results-pane {padding: 10px 5px;}.jimu-widget-add-data .search-pane .search-results-pane:after {content: ""; display: table; clear: both;}.jimu-widget-add-data .search-pane .item-card {float: left; width: 100%; padding-left: 5px; padding-right: 5px; -webkit-transition: width 0.1s ease; -moz-transition: width 0.1s ease; -o-transition: width 0.1s ease; transition: width 0.1s ease;}.jimu-widget-add-data .search-pane .item-card .item-card-inner {height: 70px; background: #ffffff; border: 1px solid #e0e0e0; border-bottom-color: #cccccc; padding: 5px; margin-bottom: 10px; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;}.jimu-widget-add-data .search-pane .item-card .thumbnail {float: left; margin-right: 10px;}.jimu-widget-add-data .search-pane .item-card .thumbnail img {height: 60px; width: 90px;}.jimu-widget-add-data .search-pane .item-card h3.title {margin: 0 5px; padding: 0; font-size: 12px; font-weight: bold; color: #4c4c4c; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-add-data .search-pane .item-card div.info {color: #898989; font-size: 10px; overflow: hidden; white-space: nowrap; padding-top: 3px;}.jimu-widget-add-data .search-pane .item-card .action-bar,.jimu-widget-add-data .secondary-pane .action-bar {text-align: right;}.jimu-rtl .jimu-widget-add-data .search-pane .item-card .action-bar,.jimu-rtl .jimu-widget-add-data .secondary-pane .action-bar {text-align: left;}.jimu-widget-add-data .secondary-pane {padding: 20px 15px; overflow: auto;}.jimu-widget-add-data .secondary-pane label {color: #898989; display: block; margin-bottom: 10px;}.jimu-widget-add-data .secondary-pane .dijit {margin-bottom: 10px;}.jimu-widget-add-data .secondary-pane div.action-bar {margin-top: 20px;}.jimu-widget-add-data .secondary-pane .jimu-btn {color: #fff; line-height: 20px; text-decoration: none;}.jimu-widget-add-data .secondary-pane .jimu-btn:active {}.jimu-widget-add-data .search-pane .item-card .action-bar a,.jimu-widget-add-data .add-url-pane .action-bar a,.jimu-widget-add-data .add-file-pane .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-right: 5px;}.jimu-widget-add-data .search-pane .item-card .action-bar a.disabled,.jimu-widget-add-data .add-url-pane .action-bar a.disabled,.jimu-widget-add-data .add-file-pane .file-form label.disabled,.jimu-widget-add-data .add-file-pane .drop-area.disabled {opacity: 0.3;}.jimu-widget-add-data .search-pane .item-card .action-bar .message {font-size: 10px; font-style: italic; margin-left: 4px; margin-right: 4px;}.jimu-widget-add-data .add-url-pane .action-bar .jimu-btn,.jimu-widget-add-data .add-file-pane .file-form label {margin-right: 0; min-width: 180px; white-space: normal;}.jimu-widget-add-data .add-url-pane {padding: 0;}.jimu-widget-add-data .add-url-pane-container {background-color: #fff; border-bottom: 1px solid #ccc; padding: 15px 15px 35px;}.jimu-widget-add-data .add-url-pane-container--inner {max-width: 960px; margin: 0 auto;}.jimu-widget-add-data .add-file-pane .intro ul {font-size: 10px; margin: 0; padding: 2px 0 2px 20px;}.jimu-widget-add-data .add-file-pane .intro ul .note {font-style: italic;}.jimu-rtl .jimu-widget-add-data .add-file-pane .intro ul {padding: 2px 20px 2px 0;}.jimu-widget-add-data .add-file-pane .generalize-options .jimu-checkbox .checkbox {margin-top: 0; vertical-align: middle;}.jimu-widget-add-data .add-file-pane .generalize-options .jimu-checkbox .label {font-size: 12px; vertical-align: middle; cursor: pointer;}.jimu-widget-add-data .add-file-pane .browse-or-drop {}.jimu-widget-add-data .add-file-pane .or {display: block; margin: 20px auto; font-size: 11px; color: #898989; width: 90%; max-width: 400px; line-height: 20px; position: relative;}.jimu-widget-add-data .add-file-pane .or:before,.jimu-widget-add-data .add-file-pane .or:after {content: ""; display: block; height: 1px; width: 35%; background: #eee; position: absolute; top: 9px; left: 0;}.jimu-widget-add-data .add-file-pane .or:after {right: 0; left: auto;}.jimu-widget-add-data .add-file-pane .or b {display: inline-block; padding-right: 5px;}.jimu-widget-add-data .add-file-pane .drop-area {width: 100%; background: #fff; margin: 10px auto 0; padding: 25px 50px 35px; border: 1px dashed #ccc; color: #898989; font-size: 12px; text-align: center; line-height: 1.75; text-transform: uppercase; position: relative; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; -webkit-transition: opacity ease-in-out 0.15s; -moz-transition: opacity ease-in-out 0.15s; -o-transition: opacity ease-in-out 0.15s; transition: opacity ease-in-out 0.15s;}.jimu-widget-add-data .add-file-pane .drop-area i {color: #485566; font-style: normal;}.jimu-widget-add-data .add-file-pane .drop-area a.drop-area-hint {position: absolute; top: 0; right: 0; margin: 5px; padding: 10px; font-size: 14px; line-height: 1;}.jimu-widget-add-data .add-file-pane .drop-area.hit {background: #f9f9f9; border-color: #24b5cc;}.jimu-widget-add-data .add-file-pane .drop-area.hit \x3e * {pointer-events: none; display: none;}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types {display: block;}.jimu-widget-add-data .add-file-pane .drop-area.hit .upload-arrow {display: block; width: 48px; height: 48px; background: url(images/arrow_up.png) no-repeat; margin: 0 auto; -moz-animation: updload-arrow-animation 1s infinite; -webkit-animation: updload-arrow-animation 1s infinite; animation: updload-arrow-animation 1s infinite;}.jimu-widget-add-data .add-file-pane .drop-area .supported-file-types {margin: 15px 0 35px; opacity: .5; pointer-events: none; -webkit-transition: opacity ease-in-out 0.15s; -moz-transition: opacity ease-in-out 0.15s; -o-transition: opacity ease-in-out 0.15s; transition: opacity ease-in-out 0.15s;}.jimu-widget-add-data .add-file-pane .drop-area .supported-file-types img {width: 45px; margin-left: -5px; position: relative; -webkit-transition: all ease-in-out 0.2s; -moz-transition: all ease-in-out 0.2s; -o-transition: all ease-in-out 0.2s; transition: all ease-in-out 0.2s;}.jimu-widget-add-data .add-file-pane .drop-area .supported-file-types img.first-type-icon {-moz-transform: rotate(-8deg); -moz-transform-origin: right bottom; -webkit-transform: rotate(-8deg); -webkit-transform-origin: right bottom; -o-transform: rotate(-8deg); -o-transform-origin: right bottom; transform: rotate(-8deg); transform-origin: right bottom; bottom: -1px;}.jimu-widget-add-data .add-file-pane .drop-area .supported-file-types img.second-first-type-icon {-moz-transform: rotate(-3deg); -moz-transform-origin: right bottom; -webkit-transform: rotate(-3deg); -webkit-transform-origin: right bottom; -o-transform: rotate(-3deg); -o-transform-origin: right bottom; transform: rotate(-3deg); transform-origin: right bottom;}.jimu-widget-add-data .add-file-pane .drop-area .supported-file-types img.second-last-type-icon {-moz-transform: rotate(3deg); -moz-transform-origin: left bottom; -webkit-transform: rotate(3deg); -webkit-transform-origin: left bottom; -o-transform: rotate(3deg); -o-transform-origin: left bottom; transform: rotate(3deg); transform-origin: left bottom;}.jimu-widget-add-data .add-file-pane .drop-area .supported-file-types img.last-type-icon {-moz-transform: rotate(8deg); -moz-transform-origin: left bottom; -webkit-transform: rotate(8deg); -webkit-transform-origin: left bottom; -o-transform: rotate(8deg); -o-transform-origin: left bottom; transform: rotate(8deg); transform-origin: left bottom; bottom: -1px;}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types {opacity: 1;}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types img {margin-left: 0px;}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types img.first-type-icon {-moz-transform: rotate(-12deg); -webkit-transform: rotate(-12deg); -o-transform: rotate(-12deg); transform: rotate(-12deg); bottom: -3px;}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types img.second-first-type-icon {-moz-transform: rotate(-5deg); -webkit-transform: rotate(-5deg); -o-transform: rotate(-5deg); transform: rotate(-5deg);}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types img.second-last-type-icon {-moz-transform: rotate(5deg); -webkit-transform: rotate(5deg); -o-transform: rotate(5deg); transform: rotate(5deg);}.jimu-widget-add-data .add-file-pane .drop-area.hit .supported-file-types img.last-type-icon {-moz-transform: rotate(12deg); -webkit-transform: rotate(12deg); -o-transform: rotate(12deg); transform: rotate(12deg); bottom: -3px;}.jimu-widget-add-data .add-file-pane .file-form {display: inline-block;}.jimu-widget-add-data .search-box2 {display: inline-block;}.jimu-widget-add-data .search-box2 {float: right;}.jimu-widget-add-data .search-box2 .search-textbox {vertical-align: middle; height: 30px; width: 200px; padding: 5px 10px; font-size: 12px; line-height: 1.5; background-color: #ffffff; background-image: none; border: 1px solid #cccccc; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -moz-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;}.jimu-widget-add-data .search-box2 .btn {display: inline-block; height: 30px; margin-left: -1px; margin-bottom: 0; font-weight: normal; text-align: center; vertical-align: middle; touch-action: manipulation; cursor: pointer; color: #196fa6; background-color: #ffffff; background-image: none; border: 1px solid #cccccc; padding: 5px 10px; white-space: nowrap; font-size: 12px; line-height: 1.5; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-add-data.width-small .search-box2 .search-textbox {width: 150px;}.jimu-widget-add-data.width-small .add-file-pane .or:before,.jimu-widget-add-data.width-small .add-file-pane .or:after {width: 25%;}.jimu-widget-add-data.width-medium .search-box2 .search-textbox {width: 140px;}.jimu-widget-add-data.width-medium .filter-wrapper .sort-prompt,.jimu-widget-add-data.width-small .filter-wrapper .sort-prompt {display: none;}.jimu-widget-add-data.width-medium .search-pane .search-results-pane {padding: 5px 0;}.jimu-widget-add-data.width-medium .search-pane .item-card .item-card-inner {margin-bottom: 5px;}.jimu-widget-add-data.height-small .add-file-pane {padding-top: 15px; padding-bottom: 15px;}.jimu-widget-add-data.height-small .add-file-pane .drop-area {padding-top: 15px; padding-bottom: 25px;}.jimu-widget-add-data.height-small .add-file-pane .drop-area .supported-file-types {margin-bottom: 20px;}.jimu-widget-add-data .search-bbox-option .checkbox-inline,.jimu-widget-add-data .search-bbox-option .checkbox-inline input,.jimu-widget-add-data .search-pane .filter-placeholder {cursor: pointer;}.jimu-widget-add-data.width-small .search-bbox-option {max-width: 120px; font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.jimu-widget-add-data.width-small .search-bbox-option .switch-toggle-group {overflow: hidden; text-overflow: ellipsis;}.jimu-widget-add-data .search-pane .search-bbox-option .checkbox-inline {padding-left: 38px; margin-right: 25px;}.jimu-widget-add-data .search-pane .search-box .input-group {position: relative; display: table; border-collapse: separate;}.jimu-widget-add-data .search-pane .search-box .input-group \x3e * {display: table-cell; vertical-align: middle;}.jimu-widget-add-data .search-pane .search-box .search-textbox {height: 30px; width: 200px; padding: 5px 10px; font-size: 12px; line-height: 1.5; background-color: #ffffff; background-image: none; border: 1px solid #cccccc; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -moz-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;}.jimu-widget-add-data .search-pane .search-box .btn {display: inline-block; margin-left: -1px; margin-bottom: 0; font-weight: normal; text-align: center; vertical-align: middle; touch-action: manipulation; cursor: pointer; color: #196fa6; background-color: #ffffff; background-image: none; border: 1px solid #cccccc; padding: 5px 10px; white-space: nowrap; font-size: 12px; line-height: 1.5; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-add-data .search-pane .search-box .btn-clear {border-color: transparent; background: transparent; position: absolute; left: -32px;}.jimu-widget-add-data .search-pane .search-box-placeholder,.jimu-widget-add-data .search-pane .filter-placeholder,.jimu-widget-add-data .search-pane .scope-placeholder {display: none;}.jimu-widget-add-data .search-pane .search-sort-options \x3e * {vertical-align: middle;}.jimu-widget-add-data .search-pane .search-sort-options label {font-weight: normal; font-size: 11px; color: #898989;}.jimu-widget-add-data .search-pane .search-sort-options .sort-order-icon {float: right; width: 24px; height: 24px; margin: 3px 0;}.jimu-widget-add-data .search-pane .search-sort-options .dropdown-toggle .sort-order-icon {float: none; padding: 0 5px;}.jimu-widget-add-data .search-pane .sort-order-icon {background-image: url("images/down-arrow.png"); background-position: center center; background-repeat: no-repeat; width: 16px; height: 16px; background-image: url("images/sort-down-arrow.png");}.jimu-widget-add-data .search-pane .sort-order-icon.descending {background-image: url("images/sort-up-arrow.png");}.jimu-widget-add-data .search-pane .scope-options \x3e * {display: inline-block;}.jimu-widget-add-data .search-pane .checkbox-inline,.jimu-widget-add-data .search-pane .radio-inline {position: relative; padding-left: 21px; margin-right: 10px;}.jimu-widget-add-data .search-pane .checkbox-inline .dijitCheckBox,.jimu-widget-add-data .search-pane .radio-inline .dijitCheckBox {}.jimu-widget-add-data .search-pane .search-item-ratings-comments-views {display: block; padding: 5px;}.jimu-widget-add-data .search-pane .search-item-ratings-comments-views [class*\x3d"gd-icon-"] {margin-right: 10px; vertical-align: middle;}.jimu-widget-add-data .search-pane .search-paging .pagination {margin: 0;}.jimu-widget-add-data .search-pane .search-paging,.jimu-widget-add-data .search-pane .search-result-count {display: inline-block; vertical-align: middle; line-height: 1;}.jimu-widget-add-data .search-pane .pagination \x3e li \x3e span,.jimu-widget-add-data .search-pane .pagination \x3e li \x3e span:focus,.jimu-widget-add-data .search-pane .pagination \x3e li \x3e span:hover {color: inherit; border-color: transparent; background-color: transparent;}.jimu-widget-add-data .search-pane .pagination \x3e li.current-page \x3e span {padding-left: 15px; padding-right: 15px;}.jimu-widget-add-data .search-pane .pagination [class*\x3d" esri-icon-"],.jimu-widget-add-data .search-pane .pagination [class^\x3d"esri-icon-"] {position: relative; top: 1px;}.jimu-widget-add-data .search-pane .search-result-count {margin: 0 10px;}.jimu-widget-add-data.width-768 .item-card {width: 50%;}.jimu-widget-add-data.width-1200 .item-card {width: 33.3333333333%;}.jimu-widget-add-data.width-medium .search-pane .search-bar,.jimu-widget-add-data.width-small .search-pane .search-bar {padding-left: 5px; padding-right: 5px;}.jimu-widget-add-data.width-medium .search-pane .search-bar .btn-group \x3e .btn,.jimu-widget-add-data.width-small .search-pane .search-bar .btn-group \x3e .btn {margin-left: 0;}.jimu-rtl .jimu-widget-add-data.width-medium .search-pane .search-bar .btn-group \x3e .btn,.jimu-rtl .jimu-widget-add-data.width-small .search-pane .search-bar .btn-group \x3e .btn {margin-left: auto; margin-right: 0;}.jimu-widget-add-data.width-medium .search-box-placeholder,.jimu-widget-add-data.width-small .search-box-placeholder,.jimu-widget-add-data.filter-placeholder-on .filter-placeholder {display: block; height: 30px; width: 30px; background-image: url("images/search.png"); background-position: center center; background-repeat: no-repeat; background-size: 12px;}.jimu-widget-add-data.width-medium .search-box,.jimu-widget-add-data.width-small .search-box {display: none; padding: 10px; position: absolute; top: 0; left: 0; right: 40px; background: #ffffff;}.jimu-widget-add-data.width-small .search-box {padding-top: 8px; padding-bottom: 8px;}.jimu-widget-add-data.width-medium .search-box .input-group,.jimu-widget-add-data.width-small .search-box .input-group {width: 100%;}.jimu-widget-add-data.width-medium .search-box .search-textbox,.jimu-widget-add-data.width-small .search-box .search-textbox {width: 100%;}.jimu-widget-add-data.width-medium .search-box .search-btn,.jimu-widget-add-data.width-small .search-box .search-btn {width: 1%; position: relative;}.jimu-widget-add-data.width-medium .search-box.show,.jimu-widget-add-data.width-small .search-box.show {display: block;}.jimu-widget-add-data.width-medium .search-box-placeholder,.jimu-widget-add-data.width-small .search-box-placeholder {margin: 0 0 8px;}.jimu-widget-add-data.width-medium .search-box-placeholder.opened,.jimu-widget-add-data.width-small .search-box-placeholder.opened {background-image: url("images/close.png");}.jimu-widget-add-data.width-medium .filter-placeholder,.jimu-widget-add-data.width-small .filter-placeholder {background-image: url("images/menu.png");}.jimu-widget-add-data.width-medium .scope-placeholder,.jimu-widget-add-data.width-small .scope-placeholder {display: block; padding: 5px 10px 15px; color: #196fa6; font-weight: bold;}.jimu-widget-add-data.width-small .scope-placeholder {display: flex;}.jimu-widget-add-data.width-small .scope-placeholder \x3e span:first-child {white-space: nowrap; text-overflow: ellipsis; overflow: hidden; width: calc(100% - 16px); flex: 1;}.jimu-widget-add-data.width-medium .scope-placeholder:focus,.jimu-widget-add-data.width-small .scope-placeholder:focus {text-decoration: none;}.jimu-widget-add-data.width-medium .scope-placeholder \x3e *,.jimu-widget-add-data.width-small .scope-placeholder \x3e * {vertical-align: middle;}.jimu-widget-add-data.width-medium .scope-placeholder .dropdown-arrow,.jimu-widget-add-data.width-small .scope-placeholder .dropdown-arrow {display: inline-block; background-image: url("images/down-arrow.png"); background-position: center center; background-repeat: no-repeat; width: 16px; height: 16px;}.jimu-widget-add-data.width-medium .btn-group,.jimu-widget-add-data.filter-placeholder-on .filter-wrapper,.jimu-widget-add-data.width-small .btn-group {display: none;}.jimu-widget-add-data.width-medium .filter-wrapper.show,.jimu-widget-add-data.width-medium .btn-group.show,.jimu-widget-add-data.width-small .filter-wrapper.show,.jimu-widget-add-data.width-small .btn-group.show {display: block; position: absolute; right: 0; top: 91px; z-index: 10; padding: 5px 10px; background: #ffffff; border: 1px solid #cccccc; -webkit-box-shadow: 0 3px 5px 0 rgba(0, 0, 0, 0.2); -moz-box-shadow: 0 3px 5px 0 rgba(0, 0, 0, 0.2); box-shadow: 0 3px 5px 0 rgba(0, 0, 0, 0.2);}.jimu-rtl .jimu-widget-add-data.width-medium .filter-wrapper.show,.jimu-rtl .jimu-widget-add-data.width-medium .btn-group.show,.jimu-rtl .jimu-widget-add-data.width-small .filter-wrapper.show,.jimu-rtl .jimu-widget-add-data.width-small .btn-group.show {left: 0; right: auto;}.jimu-widget-add-data.width-medium .btn-group.show,.jimu-widget-add-data.width-small .btn-group.show {top: 48px; left: 0; padding: 0; right: auto; min-width: 50%;}.jimu-rtl .jimu-widget-add-data.width-medium .btn-group.show,.jimu-rtl .jimu-widget-add-data.width-small .btn-group.show {left: auto; right: 0;}.jimu-widget-add-data.width-medium .btn-group.show .btn,.jimu-widget-add-data.width-small .btn-group.show .btn {display: block; width: 100%; padding: 10px 15px; border: 0; font-weight: normal;}.jimu-widget-add-data.width-medium .btn-group.show .btn:hover,.jimu-widget-add-data.width-small .btn-group.show .btn:hover {background-color: #f4f4f4;}.jimu-widget-add-data.width-medium .btn-group.show .btn.active,.jimu-widget-add-data.width-medium .btn-group.show .btn.active:hover,.jimu-widget-add-data.width-small .btn-group.show .btn.active,.jimu-widget-add-data.width-small .btn-group.show .btn.active:hover {background-color: #196fa6 !important; color: #fff !important;}.jimu-widget-add-data.width-small .jimu-tab3 .tab-item-td {padding-left: 20px; padding-right: 20px;}.jimu-widget-add-data.width-small .search-pane .search-bar {padding-top: 5px; padding-left: 5px; padding-right: 5px;}.jimu-widget-add-data.width-small .search-pane .search-bar .btn-group \x3e .btn {margin: 0; padding-left: 5px; padding-right: 5px; font-size: 11px;}.jimu-widget-add-data.width-small .search-pane .search-results-pane {padding: 0; overflow: hidden;}.jimu-widget-add-data.width-small .search-pane .item-card {padding-left: 0; padding-right: 0;}.jimu-widget-add-data.width-small .search-pane .item-card .item-card-inner {margin-bottom: 0; border-top: 0; border-left: 0; border-right: 0; border-bottom-color: #e0e0e0;}.add-data-widget-popup .search-type-option {display: flex; align-items: center;}.add-data-widget-popup .search-type-option + .search-type-option {margin-top: 10px;}.add-data-widget-popup .search-type-option .jimu-checkbox {margin-right: 5px;}.jimu-rtl .add-data-widget-popup .search-type-option .jimu-checkbox {margin-right: 0; margin-left: 5px;}.add-data-widget-popup .search-type-option,.add-data-widget-popup .search-type-option input {cursor: pointer;}.jimu-widget-add-data {position: absolute; top: 0; bottom: 0; left: 0; right: 0; padding-top: 5px;}.jimu-widget-add-data .btn.hidden {visibility: hidden;}.jimu-widget-add-data .search-bbox-option,.jimu-widget-add-data .search-box {display: inline-block;}.jimu-widget-add-data .search-box,.jimu-widget-add-data .search-box-placeholder {float: right;}.jimu-widget-add-data .search-scope-options,.jimu-widget-add-data .search-sort-options {display: inline-block;}.jimu-widget-add-data .search-data-type-options {float: left;}.jimu-widget-add-data .filter-wrapper,.jimu-widget-add-data .filter-placeholder {float: right;}.jimu-widget-add-data .search-scope-options button.active {background-color: #cce6ff;}.jimu-widget-add-data .search-results-pane {overflow-y: auto;}.jimu-widget-add-data .search-paging,.jimu-widget-add-data .search-result-count {display: inline-block;}.jimu-widget-add-data .search-paging ul {margin: 0; padding: 0;}.jimu-widget-add-data .search-paging li {display: inline-block;}.jimu-widget-add-data .search-paging li.disabled a,.jimu-widget-add-data .search-paging li.disabled a:hover,.jimu-widget-add-data .search-paging li.disabled a:active,.jimu-widget-add-data .search-paging li.disabled a:focus {cursor: default; opacity: 0.35;}.jimu-widget-add-data .search-item-card .action-bar {margin-left: 20px;}.jimu-widget-add-data .search-item-card .action-bar a {margin-right: 8px;}.jimu-widget-add-data .dijitDropDownButton {margin: 0;}.jimu-widget-add-data .dijitSelect,.jimu-widget-add-data .dijitDropDownButton .dijitButtonNode {background: transparent; border: 0; padding: 7px 5px; color: #196fa6; font-weight: bold; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;}.jimu-widget-add-data .dijitSelect .dijitButtonContents,.jimu-widget-add-data .dijitDropDownButton .dijitButtonNode .dijitButtonContents {border-color: transparent;}.jimu-widget-add-data .dijitSelect .dijitInputField,.jimu-widget-add-data .dijitDropDownButton .dijitButtonNode .dijitInputField {padding: 0 5px;}.jimu-widget-add-data .dijitSelect .dijitArrowButton,.jimu-widget-add-data .dijitDropDownButton .dijitButtonNode .dijitArrowButton {background: transparent; border: 0;}.jimu-widget-add-data .dijitSelect.dijitSelectFocused .dijitArrowButton,.jimu-widget-add-data .dijitDropDownButton .dijitButtonNode.dijitSelectFocused .dijitArrowButton {padding: 0;}.jimu-widget-add-data .dijitSelect .dijitArrowButton .dijitArrowButtonInner,.jimu-widget-add-data .dijitSelectHover .dijitArrowButton .dijitArrowButtonInner,.jimu-widget-add-data .dijitSelectFocused .dijitArrowButton .dijitArrowButtonInner {background-image: url("images/down-arrow.png"); background-position: center center; background-repeat: no-repeat; width: 16px; height: 16px;}.jimu-widget-add-data .dijitDropDownButton .dijitArrowButtonInner {background-image: url("images/down-arrow.png"); background-position: center center; background-repeat: no-repeat; width: 16px; height: 16px;}.jimu-widget-add-data-dialog {background-color: #FFFFFF !important; border-color: #555555 !important; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.35) !important; -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.35) !important; box-shadow: 0 0 5px rgba(0, 0, 0, 0.35) !important;}.jimu-widget-add-data-dialog .dijitDialogPaneContent {border-top: 1px solid #cccccc;}.jimu-widget-add-data-dialog .dijitDialogTitleBar {background: none repeat scroll 0 0 rgba(0, 0, 0, 0); background-color: #FFFFFF; -moz-border-radius: 3px 3px 0 0; -webkit-border-radius: 3px 3px 0 0; border-radius: 3px 3px 0 0;}.jimu-widget-add-data-dialog .dijitDialogTitle {background-color: #FFFFFF; color: #000000; font-size: 16px; font-weight: bold;}.jimu-widget-add-data-dialog div.gap {margin-top: 20px;}.jimu-widget-add-data-dialog div.small-gap {margin-top: 4px;}.jimu-widget-add-data-dialog div.action-bar {margin-top: 10px;}.jimu-widget-add-data-dialog .url-textbox {height: 30px; width: 200px; padding: 5px 10px; font-size: 12px; line-height: 1.5; background-color: #ffffff; background-image: none; border: 1px solid #cccccc; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -moz-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;}.jimu-widget-add-data-dialog .url-textbox-wide {width: 500px;}.jimu-widget-add-data-dialog .examples {font-size: 9px; font-style: italic; margin-top: 4px; margin-left: 4px; opacity: 0.5;}.jimu-widget-add-data .btn-link {color: #196fa6 !important;}.jimu-widget-add-data .switch-toggle-group {padding: 5px;}.jimu-widget-add-data .switch-toggle-group .checkbox-inline {padding-left: 36px; vertical-align: top;}.jimu-widget-add-data .switch-toggle-group .switch-toggle.dijitCheckBox {margin-left: -36px;}.jimu-widget-add-data .switch-toggle.dijitCheckBox {height: 16px; width: 28px; border: 0 none; background: #e04f1d; position: relative; display: inline-block; cursor: pointer; -moz-border-radius: 10px; -webkit-border-radius: 10px; border-radius: 10px;}.jimu-widget-add-data .switch-toggle.dijitCheckBox:before {content: ""; background: #f8f8f8; position: absolute; padding: 0; height: 12px; width: 12px; left: auto; right: 2px; top: 2px; z-index: 1; -webkit-transition: right 0.3s; -moz-transition: right 0.3s; -o-transition: right 0.3s; transition: right 0.3s; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;}.jimu-widget-add-data .switch-toggle.dijitCheckBox input {width: 100%; height: 100%; position: absolute; left: 0; z-index: 2;}.jimu-widget-add-data .switch-toggle.dijitCheckBox.dijitCheckBoxChecked {background: #50ad4e;}.jimu-widget-add-data .switch-toggle.dijitCheckBox.dijitCheckBoxChecked:before {right: 14px;}.jimu-widget-add-data .panel-default \x3e .panel-heading {background-color: transparent; border-color: #e0e0e0;}.jimu-widget-add-data .panel-title {font-size: 16px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-add-data .panel-footer .btn + .btn {margin-left: 10px;}.jimu-widget-add-data .gp-panel {width: 300px;}.jimu-widget-add-data .gp-panel \x3e .panel-heading {background-color: transparent; border-left: 1px solid rgba(0, 0, 0, 0.35); color: #efefef; height: 40px;}.jimu-widget-add-data .gp-panel \x3e .panel-heading .panel-title {font-weight: normal; line-height: 1.5;}.jimu-widget-add-data .gp-panel \x3e .panel-heading [class^\x3d"esri-icon-"],.jimu-widget-add-data .gp-panel \x3e .panel-heading [class*\x3d" esri-icon-"] {display: inline-block; margin-right: 10px; position: relative; top: 1px;}.jimu-widget-add-data .gp-panel \x3e .panel-heading .btn-icon {width: 20px; padding: 0; color: #efefef; float: right; margin-right: 0; font-size: 16px; line-height: 1.25; line-height: 20px; text-align: center;}.jimu-widget-add-data .gp-panel \x3e .panel-body {background-color: #f8f8f8; border-left: 1px solid #cccccc; position: absolute; top: 40px; bottom: 0; width: 100%; overflow: auto; padding: 0;}.jimu-widget-add-data .gp-panel .panel-section {background-color: #ffffff;}.jimu-widget-add-data .panel-section {border-bottom: 1px solid #cccccc;}.jimu-widget-add-data .panel-section .section-header {display: block; font-size: 16px; line-height: 1.25; line-height: 20px; padding: 10px 15px;}.jimu-widget-add-data .panel-section .section-header:after {content: ""; display: block; clear: both;}.jimu-widget-add-data .panel-section .section-header [class^\x3d"esri-icon-"],.jimu-widget-add-data .panel-section .section-header [class*\x3d" esri-icon-"],.jimu-widget-add-data .panel-section .section-header .btn {margin: 0 5px; float: right;}.jimu-widget-add-data .panel-section .section-header .btn {margin: 0; min-width: 80px;}.jimu-widget-add-data .panel-section .btn.section-header {border: 0; text-align: left; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-transition: all 0.25s ease; -moz-transition: all 0.25s ease; -o-transition: all 0.25s ease; transition: all 0.25s ease;}.jimu-widget-add-data .panel-section .btn.section-header:hover {background-color: #e2f1fb; text-decoration: none;}.jimu-widget-add-data .panel-section .btn.section-header:active,.jimu-widget-add-data .panel-section .btn.section-header:focus {background-color: #aadbfa; text-decoration: none;}.jimu-widget-add-data .panel-section .section-body {padding: 10px 15px;}.jimu-widget-add-data a, .add-url-pane a {display: block; color: #196fa6; text-decoration: none; line-height: 20px; padding: 10px 5px;}.jimu-widget-add-data .btn.hidden {visibility: hidden;}.jimu-widget-add-data .search-bbox-option, .search-box {display: inline-block;}.jimu-widget-add-data .search-box,.jimu-widget-add-data .search-box-placeholder {float: right;}.jimu-widget-add-data .search-scope-options,.jimu-widget-add-data .search-sort-options {display: inline-block;}.jimu-widget-add-data .search-data-type-options {float: left;}.jimu-widget-add-data .filter-wrapper,.jimu-widget-add-data .filter-placeholder {float: right;}.jimu-widget-add-data .search-scope-options button.active {background-color: #cce6ff;}.jimu-widget-add-data .search-results-pane {overflow-y: auto;}.jimu-widget-add-data .search-paging,.jimu-widget-add-data .search-result-count {display: inline-block;}.jimu-widget-add-data .search-paging ul {margin: 0; padding: 0;}.jimu-widget-add-data .search-paging li {display: inline-block;}.jimu-rtl .jimu-widget-add-data .search-paging li {-moz-transform: rotate(180deg); -webkit-transform: rotate(180deg); -o-transform: rotate(180deg); transform: rotate(180deg);}.jimu-rtl .jimu-widget-add-data .search-paging li.current-page {-moz-transform: rotate(0); -webkit-transform: rotate(0); -o-transform: rotate(0); transform: rotate(0);}.jimu-widget-add-data .search-item-card .action-bar {margin-left: 20px;}.jimu-widget-add-data .search-item-card .action-bar a {margin-right: 8px;}.jimu-widget-add-data .add-url-pane .url-textbox {width: 100%; font-size: 12px; color: #000000; padding: 0;}.jimu-widget-add-data .add-url-pane .examples {display: none; margin: 15px -15px 0; padding: 15px; font-size: 12px; color: #898989; word-wrap: break-word;}.jimu-widget-add-data .add-url-pane .examples \x3e div \x3e div {margin-bottom: 15px;}.jimu-widget-add-data .add-url-pane .examples.show {display: block;}.jimu-widget-add-data .jimu-tab3 \x3e .jimu-viewstack {position: absolute; top: 39px; left: 0px; right: 0; bottom: 0; padding-bottom: 40px;}.jimu-widget-add-data-footer {height: 40px; overflow: hidden; background-color: #f8f8f8; border-top: 1px solid #ccc; padding: 0 15px; color: #898989; font-size: 11px;}.jimu-widget-add-data-footer [class^\x3d"esri-icon-"],.jimu-widget-add-data-footer [class*\x3d" esri-icon-"] {line-height: 20px;}.jimu-widget-add-data-footer .layerlist-button {text-transform: uppercase;}.jimu-widget-add-data-footer .layerlist-button .esri-icon-layers {margin: 0 5px; vertical-align: middle; display: inline-block;}.jimu-widget-add-data-footer .message {display: block; color: #898989; line-height: 20px; padding: 10px 10px 10px 0; text-overflow: ellipsis; overflow: hidden; word-break: break-all; white-space: nowrap;}.jimu-widget-add-data.layerlist-show {overflow: hidden;}.jimu-widget-add-data.layerlist-show .jimu-tab3 {-webkit-filter: blur(5px); filter: blur(5px);}.jimu-widget-add-data.layerlist-show .add-data-layerlist--container {-moz-animation: slide-from-right .4s; -webkit-animation: slide-from-right .4s; animation: slide-from-right .4s;}.add-data-widget-layers {width: 100%; height: 100%; background: rgba(0, 0, 0, 0.3); position: absolute; top: 0; right: 0; z-index: 1;}.add-data-widget-layers {display: none;}.add-data-widget-layers.show {display: block;}.add-data-widget-layers .add-data-layerlist--container {background: #fff; position: absolute; top: 0; right: 0; width: 320px; height: 100%; -webkit-transition: width 0.4s ease; -moz-transition: width 0.4s ease; -o-transition: width 0.4s ease; transition: width 0.4s ease;}.width-small .add-data-widget-layers .add-data-layerlist--container {width: 100%;}.add-data-widget-layers .add-data-layerlist--container h2 {margin: 0; padding: 7px 15px; border-bottom: 1px solid #ccc; color: #898989; font-size: 14px; font-weight: normal; line-height: 2;}.add-data-layerlist--list {width: 100%; padding: 10px 15px; line-height: 20px; position: absolute; top: 45px; bottom: 40px; overflow: auto;}.add-data-layerlist--listitem {margin-bottom: 5px;}.add-data-layerlist--listitem:after {content: ""; display: table; clear: both;}.add-data-layerlist--listitem .remove-button {float: right; padding: 5px 10px;}.add-data-layerlist--listitem .layer-name {display: block; padding-top: 5px;}.add-data-widget-layers .add-data-layerlist--footer {width: 100%; position: absolute; bottom: 0;}.add-data-widget-layers .back-button {float: right; text-transform: uppercase;}.add-data-widget-layers .back-button i {display: inline-block; margin-left: 5px;}.add-data-widget-layers .no-data-message {color: #898989; padding: 25px; text-align: center;}.add-data-widget-popup {padding: 0;}.add-data-widget-popup .dijitTooltipConnector {display: none;}.add-data-widget-popup .dijitTooltipContainer {padding: 10px; border-color: #ccc; -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25); -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);}.add-data-widget-popup.dijitMenuPopup {-webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25); -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);}.add-data-widget-popup .dijitMenu {border-color: #ccc;}.add-data-widget-popup .dijitMenu .dijitMenuItem td {padding: 10px 15px; border: 0;}.add-data-widget-popup .dijitMenu .dijitMenuItemHover td,.add-data-widget-popup .dijitMenu .dijitMenuItemActive td,.add-data-widget-popup .dijitMenu .dijitMenuItemSelected td {background-color: #f4f4f4; background-image: none;}.add-data-widget-popup .dijitMenu .dijitSelectSelectedOption td,.add-data-widget-popup .dijitMenu .dijitSelectSelectedOption.dijitMenuItemHover td,.add-data-widget-popup .dijitMenu .dijitSelectSelectedOption.dijitMenuItemSelected td {background-color: #196fa6; background-image: none; color: #fff; font-weight: normal;}.LaunchpadTheme .jimu-widget-add-data.jimu-widget {position: absolute;}.LaunchpadTheme .jimu-widget-add-data .search-pane .item-card h3.title {height: auto; width: auto; position: static;}.LaunchpadTheme .jimu-widget-add-data .dijitSelect.dijitSelectFocused .dijitArrowButton,.LaunchpadTheme .jimu-widget-add-data .dijitDropDownButton .dijitButtonNode.dijitSelectFocused .dijitArrowButton {padding: 5px;}.LaunchpadTheme .jimu-widget-add-data .dijitButton .dijitButtonNode,.LaunchpadTheme .jimu-widget-add-data .dijitDropDownButton .dijitButtonNode,.LaunchpadTheme .jimu-widget-add-data .dijitComboButton .dijitButtonNode,.LaunchpadTheme .jimu-widget-add-data .dijitToggleButton .dijitButtonNode {color: #196fa6; font-size: inherit; letter-spacing: 0;}.LaunchpadTheme .jimu-widget-add-data .dijitSelect,.LaunchpadTheme .jimu-widget-add-data .dijitButton .dijitButtonNode,.LaunchpadTheme .jimu-widget-add-data .dijitDropDownButton .dijitButtonNode,.LaunchpadTheme .jimu-widget-add-data .dijitComboButton .dijitButtonNode,.LaunchpadTheme .jimu-widget-add-data .dijitToggleButton .dijitButtonNode {background-color: transparent; border: 0;}.LaunchpadTheme .jimu-widget-add-data .secondary-pane .jimu-btn {background-color: #3b8fc4; border: 0;}.LaunchpadTheme .jimu-widget-add-data .secondary-pane .jimu-btn:hover {background-color: #2c6b93;}.DartTheme .jimu-widget-add-data .search-pane {background-color: transparent;}.DartTheme .jimu-widget-add-data .search-pane .search-bar {background-color: transparent;}.DartTheme .jimu-widget-add-data .search-pane .search-bar-secondary {background: #3a3a3a;}.DartTheme .jimu-widget-add-data .secondary-pane {background-color: transparent;}.DartTheme .jimu-widget-add-data .search-pane-content {background-color: #222;}.DartTheme .jimu-tab3 .tab-item-td.jimu-state-active {background: #4C4C4C;}.DartTheme .jimu-widget-add-data .search-pane .search-bar-separator,.DartTheme .jimu-widget-add-data .search-pane .search-pane-header {border-bottom: 1px solid #262626;}.DartTheme .jimu-widget-add-data .search-box2 .search-textbox {background: #393939; border: 0; -moz-border-radius: 2px; -webkit-border-radius: 2px; border-radius: 2px;}.DartTheme .jimu-widget-add-data.width-small .search-box2 .search-textbox {width: 100px;}.DartTheme .jimu-widget-add-data .search-box2 .btn {background: #393939; border: 0;}.DartTheme .jimu-widget-add-data .search-pane .item-card .item-card-inner {background: #4c4c4c; border-color: #787878;}.DartTheme .jimu-widget-add-data .search-pane .item-card h3.title {height: auto; width: auto; position: static;}.DartTheme .jimu-widget-add-data.width-medium .filter-wrapper.show,.DartTheme .jimu-widget-add-data.width-medium .btn-group.show,.DartTheme .jimu-widget-add-data.width-small .filter-wrapper.show,.DartTheme .jimu-widget-add-data.width-small .btn-group.show {background: #393939; border: 1px solid #7f8183; -webkit-box-shadow: 0 2px 3px rgba(0,0,0,0.15); -moz-box-shadow: 0 2px 3px rgba(0,0,0,0.15); box-shadow: 0 2px 3px rgba(0,0,0,0.15);}.DartTheme .jimu-widget-add-data.width-medium .btn-group.show .btn:hover,.DartTheme .jimu-widget-add-data.width-small .btn-group.show .btn:hover {background-color: #222;}.DartTheme .jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn.active,.DartTheme .jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn.active:active,.DartTheme .jimu-widget-add-data .search-pane .search-bar .btn-group \x3e .btn.active:hover {color: #f8f8f8 !important;}.DartTheme .jimu-widget-add-data .search-pane .search-sort-options label {color: #a7a7a7 !important;}.DartTheme .jimu-widget-add-data .secondary-pane {border-bottom: 0;}.DartTheme .jimu-widget-add-data .search-pane .item-card div.info {color: #ddd !important;}.DartTheme .jimu-widget-add-data .search-pane .item-card .action-bar a,.DartTheme .jimu-widget-add-data .add-url-pane .action-bar a,.DartTheme .jimu-widget-add-data .add-file-pane .file-form label {color: #15a4fa !important;}.DartTheme .jimu-widget-add-data .dijitDropDownButton .dijitButtonNode {padding: 7px;}.DartTheme .jimu-widget-add-data .dijitSelect {background-color: transparent; border: 0;}.DartTheme .jimu-widget-add-data .dijitSelect .dijitArrowButton {background-color: transparent; border: 0;}.DartTheme .jimu-widget-add-data.width-medium .scope-placeholder .dropdown-arrow,.DartTheme .jimu-widget-add-data.width-small .scope-placeholder .dropdown-arrow,.DartTheme .jimu-widget-add-data .dijitDropDownButton .dijitArrowButtonInner,.DartTheme .jimu-widget-add-data .dijitSelect .dijitArrowButton .dijitArrowButtonInner,.DartTheme .jimu-widget-add-data .dijitSelectHover .dijitArrowButton .dijitArrowButtonInner,.DartTheme .jimu-widget-add-data .dijitSelectFocused .dijitArrowButton .dijitArrowButtonInner {background-image: url("images/down-arrow_white.png");}.DartTheme .jimu-widget-add-data.width-medium .search-box-placeholder,.DartTheme .jimu-widget-add-data.width-medium .filter-placeholder,.DartTheme .jimu-widget-add-data.width-small .search-box-placeholder,.DartTheme .jimu-widget-add-data.width-small .filter-placeholder {background-image: url("images/search_white.png");}.DartTheme .jimu-widget-add-data.width-medium .filter-placeholder,.DartTheme .jimu-widget-add-data.width-small .filter-placeholder {background-image: url("images/menu_white.png");}.DartTheme .jimu-widget-add-data.width-medium .search-box-placeholder.opened,.DartTheme .jimu-widget-add-data.width-small .search-box-placeholder.opened {background-image: url("images/close_white.png");}.DartTheme.add-data-widget-popup .dijitTooltipContainer {color: #f8f8f8; background: #4c4c4c; border: 1px solid #7f8183; -webkit-box-shadow: 0 2px 3px rgba(0,0,0,0.15); -moz-box-shadow: 0 2px 3px rgba(0,0,0,0.15); box-shadow: 0 2px 3px rgba(0,0,0,0.15);}.DartTheme .add-data-widget-layers .add-data-layerlist--container {background-color: #4c4c4c;}.DartTheme .add-data-widget-layers .add-data-layerlist--container h2 {border-color: #262626;}.DartTheme .jimu-widget-add-data-footer,.DartTheme .add-data-widget-layers .add-data-layerlist--footer {background-color: transparent; border-top-color: #262626;}.DartTheme .jimu-widget-add-data .add-url-pane-container {background-color: transparent; border-color: transparent;}.DartTheme .jimu-widget-add-data .add-url-pane .action-bar a {padding-top: 0; padding-bottom: 0;}.DartTheme .jimu-widget-add-data .add-url-pane .action-bar .jimu-btn {min-width: 140px;}.DartTheme .jimu-widget-add-data .add-file-pane .drop-area {background: transparent; border-color: #ccc;}.DartTheme .jimu-widget-add-data.height-small .add-file-pane .drop-area {padding-left: 15px; padding-right: 15px;}.jimu-rtl .jimu-widget-add-data .search-pane .item-card {float: right;}.jimu-rtl .jimu-widget-add-data .search-pane .item-card .thumbnail {float: right; margin-left: 10px; margin-right: 0;}.jimu-rtl .jimu-widget-add-data .search-pane .search-bbox-option .checkbox-inline {padding-left: auto; padding-right: 38px; margin-right: auto; margin-left: 25px;}.jimu-rtl .jimu-widget-add-data .search-box2 {float: left;}.jimu-rtl .jimu-widget-add-data .search-box2 .btn {margin-left: auto; margin-right: -1px;}.jimu-rtl .jimu-widget-add-data .search-pane .search-sort-options .sort-order-icon {float: left;}.jimu-rtl .jimu-widget-add-data .search-box, .search-box-placeholder {float: left;}.jimu-rtl .jimu-widget-add-data .search-data-type-options {float: right;}.jimu-rtl .jimu-widget-add-data .filter-wrapper,.jimu-rtl .jimu-widget-add-data .filter-placeholder {float: left;}.jimu-rtl .jimu-widget-add-data .switch-toggle-group .checkbox-inline {padding-left: auto; padding-right: 36px;}.jimu-rtl .jimu-widget-add-data .switch-toggle-group .switch-toggle.dijitCheckBox {margin-left: auto; margin-right: -36px;}.jimu-rtl .jimu-widget-add-data .gp-panel \x3e .panel-heading .btn-icon {float: left;}.jimu-rtl .jimu-widget-add-data .panel-section .section-header [class^\x3d"esri-icon-"],.jimu-rtl .jimu-widget-add-data .panel-section .section-header [class*\x3d" esri-icon-"],.jimu-rtl .jimu-widget-add-data .panel-section .section-header .btn {float: left;}.jimu-rtl .jimu-widget-add-data .search-box,.jimu-rtl .jimu-widget-add-data .search-box-placeholder {float: left;}.jimu-rtl .jimu-widget-add-data .search-data-type-options {float: right;}.jimu-rtl .jimu-widget-add-data .filter-wrapper,.jimu-rtl .jimu-widget-add-data .filter-placeholder {float: left;}.jimu-widget-add-data .add-file-pane .or b {padding-left: 5px; padding-right: 0;}.jimu-rtl .jimu-widget-add-data .add-file-pane .drop-area a.drop-area-hint {left: 0; right: auto;}.jimu-rtl .add-data-widget-layers .add-data-layerlist--container {left: 0; right: auto;}.jimu-rtl .jimu-widget-add-data.layerlist-show .add-data-layerlist--container {-moz-animation: slide-from-left .4s; -webkit-animation: slide-from-left .4s; animation: slide-from-left .4s;}.jimu-rtl .add-data-layerlist--listitem .remove-button {float: left;}.jimu-rtl .add-data-widget-layers .back-button {float: left;}.jimu-rtl .add-data-widget-layers .back-button i {margin-left: 0; margin-right: 5px;}.jimu-rtl .add-data-widget-layers .back-button i.esri-icon-collapse:before {content: "\\e631";}.ar .esri-icon-question {-webkit-transform: rotateY(180deg); transform: rotateY(180deg); display: inline-block;}@-moz-keyframes updload-arrow-animation {0% {-moz-transform: translateY(0px);} 50% {-moz-transform: translateY(-10px);} 100% {-moz-transform: translateY(0px);}}@-webkit-keyframes updload-arrow-animation {0% {-webkit-transform: translateY(0px);} 50% {-webkit-transform: translateY(-10px);} 100% {-webkit-transform: translateY(0px);}}@keyframes updload-arrow-animation {0% {transform: translateY(0px);} 50% {transform: translateY(-10px);} 100% {transform: translateY(0px);}}@-moz-keyframes slide-from-right {0% {-moz-transform: translateX(50%); opacity: 0.5;} 100% {-moz-transform: translateX(0%); opacity: 1;}}@-webkit-keyframes slide-from-right {0% {-webkit-transform: translateX(50%); opacity: 0.5;} 100% {-webkit-transform: translateX(0%); opacity: 1;}}@keyframes slide-from-right {0% {transform: translateX(50%); opacity: 0.5;} 100% {transform: translateX(0%); opacity: 1;}}@-moz-keyframes slide-from-left {0% {-moz-transform: translateX(-50%); opacity: 0.5;} 100% {-moz-transform: translateX(0%); opacity: 1;}}@-webkit-keyframes slide-from-left {0% {-webkit-transform: translateX(-50%); opacity: 0.5;} 100% {-webkit-transform: translateX(0%); opacity: 1;}}@keyframes slide-from-left {0% {transform: translateX(-50%); opacity: 0.5;} 100% {transform: translateX(0%); opacity: 1;}}',
"*now":function(K){K(['dojo/i18n!*preload*widgets/AddData/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/on dojo/aspect dojo/Deferred dojo/dom-class jimu/portalUrlUtils jimu/portalUtils jimu/tokenUtils jimu/BaseWidget jimu/dijit/TabContainer3 dijit/_WidgetsInTemplateMixin ./search/SearchContext ./search/util ./search/SearchPane ./search/AddFromUrlPane ./search/AddFromFilePane ./search/LayerListPane dojo/_base/array".split(" "),function(K,g,x,p,r,h,b,a,c,l,k,n,d,e,u,z,A,t,w){return K([l,n],{name:"AddData",baseClass:"jimu-widget-add-data",batchGeocoderServers:null,
isPortal:!1,_isOpen:!1,_searchOnOpen:!1,tabContainer:null,searchPane:null,addFromUrlPane:null,addFromFilePane:null,postCreate:function(){this.inherited(arguments)},startup:function(){if(!this._started){var q=this,E=arguments;this._getUser().then(function(B){q._checkConfig();q._initTabs();return q._initContext(B)}).then(function(){q.inherited(E);q.tabContainer?q.tabContainer.startup():q.searchPane?q.searchPane.startup():q.addFromUrlPane?q.addFromUrlPane.startup():q.addFromFilePane&&q.addFromFilePane.startup();
q._initFooter(q.tabContainer,{searchWidget:q.searchPane,addFromUrlWidget:q.addFromUrlPane,addFromFileWidget:q.addFromFilePane});q._initListeners();q.resize()}).otherwise(function(B){console.warn("AddData.startup error:",B);q.inherited(E);q.resize()})}},_checkConfig:function(){this.config||(this.config={});var q=function(C,G){var D=C[G];D||(D=C[G]={allow:!0,label:null});"boolean"!==typeof D.allow&&(D.allow=!0);"Curated"!==G||"string"===typeof D.filter&&0!==g.trim(D.filter).length||(D.allow=!1)},E=
this.config;E.scopeOptions||(E.scopeOptions={});var B=E.scopeOptions;q(B,"MyContent");q(B,"MyOrganization");q(B,"Curated");q(B,"ArcGISOnline");q(E,"addFromUrl");q(E,"addFromFile")},getSharingUrl:function(){var q=a.getPortal(this.appConfig.portalUrl);return b.getSharingUrl(q.portalUrl)},_getUser:function(){var q=new r,E=this.appConfig.portalUrl;c.userHaveSignInPortal(E)?a.getPortal(E).getUser().then(function(B){q.resolve(B)}).otherwise(function(B){console.warn("AddData._getUser error:",B);q.resolve(null)}):
q.resolve(null);return q},_initBatchGeocoder:function(q,E){var B=!1,C=/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig,G=/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig,D=q&&q.helperServices&&q.helperServices.geocode||[],f,m,y=[];E&&E.privileges&&(B=-1<w.indexOf(E.privileges,"premium:user:geocode"));w.forEach(D,function(v){f=!!v.url.match(C);m=!!v.url.match(G);(f&&!q.isPortal&&B||m||v.batch)&&y.push({isWorldGeocodeServer:f||m,isWorldGeocodeServerProxy:m,label:v.name,
value:v.url,url:v.url,name:v.name})});this.batchGeocoderServers=y},_initContext:function(q){var E=new r,B=!0,C=e.checkMixedContent("http://www.arcgis.com"),G=this.config.scopeOptions,D=q&&"string"===typeof q.username&&0<q.username.length,f=new d,m=a.getPortal(this.appConfig.portalUrl);this.isPortal=m.isPortal;f.portal=m;m.isPortal&&(f.orgId=m.id);q&&"string"===typeof q.orgId&&0<q.orgId.length&&(f.orgId=q.orgId);D?f.username=q.username:G.MyContent.allow=!1;this.searchPane&&(this.searchPane.searchContext=
f,this.searchPane.portal=m);this._initBatchGeocoder(m,q);if(m.isPortal)try{var y=b.getSharingUrl(m.portalUrl)+"/kml";y=y.replace("/sharing/rest/kml","/sharing/kml");window.esri.config.defaults.kmlService=y;window.esri.config.defaults.geoRSSService=y.replace("/kml","/rss")}catch(L){console.error(L)}var v=this.nls.search.loadError+C,F=G.ArcGISOnline;f.allowArcGISOnline=F.allow;if(m.isPortal&&f.allowArcGISOnline){var H=a.getPortal(C);H?H.helperServices||(B=!1,H.loadSelfInfo().then(function(){H.helperServices?
f.arcgisOnlinePortal=H:(console.warn(v),f.allowArcGISOnline=!1,F.allow=!1);E.resolve()}).otherwise(function(L){f.allowArcGISOnline=!1;F.allow=!1;console.warn(v);console.warn(L);E.resolve()})):(console.warn(v),f.allowArcGISOnline=!1,F.allow=!1)}else!D&&!m.isPortal&&G.MyOrganization.allow&&G.ArcGISOnline.allow&&(G.MyOrganization.allow=!1);B&&E.resolve();return E},_initFooter:function(q,E){if(q){var B=E.searchWidget,C=!1;B&&B.footerNode&&B.footerNode.nodeName&&(C=!0);E=this.footerContainer=document.createElement("DIV");
E.className=this.baseClass+"-footer";C&&E.appendChild(B.footerNode);var G=document.createElement("A");G.className="layerlist-button jimu-float-trailing";G.href="#";G.innerHTML="\x3cspan class\x3d'esri-icon-layers'\x3e\x3c/span\x3e"+this.nls.layerList.caption;this.own(x(G,"click",g.hitch(this,function(f){f.preventDefault();this.showLayers()})));E.appendChild(G);var D=this.messageNode=document.createElement("SPAN");D.className="message";E.appendChild(D);q=q.containerNode||q.domNode||q;q.nodeName&&q.appendChild(E);
this.own(x(this.tabContainer,"tabChanged",g.hitch(this,function(f){this._setStatus("");C&&(B.footerNode.style.display=f===this.nls.tabs.search?"":"none");this.nls.tabs.search===f?(C&&(B.footerNode.style.display=""),D.style.display="none"):(C&&(B.footerNode.style.display="none"),D.style.display="")})))}},_initListeners:function(){var q=this;this.map&&this.own(this.map.on("extent-change",function(){try{q.searchPane&&q.searchPane.bboxOption.bboxToggle.get("checked")&&(q._isOpen?q.searchPane.search():
q._searchOnOpen=!0)}catch(E){console.warn(E)}}))},_initTabs:function(){var q=this.config,E=[],B=!!(window.File&&window.FileReader&&window.FormData),C=!1,G=q.scopeOptions,D=function(m){C||G&&G[m]&&G[m].allow&&(C=!0)};D("MyContent");D("MyOrganization");D("Curated");D("ArcGISOnline");C&&(this.searchPane=new u({wabWidget:this},this.searchNode),E.push({title:this.nls.tabs.search,content:this.searchPane.domNode}));q.addFromUrl&&q.addFromUrl.allow&&(this.addFromUrlPane=new z({wabWidget:this},this.urlNode),
E.push({title:this.nls.tabs.url,content:this.addFromUrlPane.domNode}));B&&q.addFromFile&&q.addFromFile.allow&&(this.addFromFilePane=new A({wabWidget:this},this.fileNode),E.push({title:this.nls.tabs.file,content:this.addFromFilePane.domNode}));var f=this;if(0<E.length){this.tabContainer=new k({average:!0,tabs:E},this.tabsNode);try{1===E.length&&this.tabContainer.controlNode&&this.tabContainer.containerNode&&(this.tabContainer.controlNode.style.display="none",this.tabContainer.containerNode.style.top=
"0px")}catch(m){}this.own(p.after(this.tabContainer,"selectTab",function(m){f.searchPane&&m===f.nls.tabs.search&&f.searchPane.resize()},!0))}else 0===E.length&&this.tabsNode.appendChild(document.createTextNode(this.nls.noOptionsConfigured))},_setStatus:function(q){this.messageNode&&(e.setNodeText(this.messageNode,q),this.messageNode.title=q)},onClose:function(){this._isOpen=!1},onOpen:function(){var q=this.searchPane&&this._searchOnOpen;this._isOpen=!0;this._searchOnOpen=!1;this.resize();q&&this.searchPane.search()},
resize:function(){var q=this.domNode.clientWidth,E=this.domNode.clientHeight;1E3<q?(h.remove(this.domNode,"width-768"),h.add(this.domNode,"width-1200")):768<q?(h.remove(this.domNode,"width-1200"),h.add(this.domNode,"width-768")):h.remove(this.domNode,["width-768","width-1200"]);420>q?(h.remove(this.domNode,"width-medium"),h.add(this.domNode,"width-small")):750>q?(h.remove(this.domNode,"width-small"),h.add(this.domNode,"width-medium")):h.remove(this.domNode,["width-small","width-medium"]);340>q?h.add(this.domNode,
"filter-placeholder-on"):h.remove(this.domNode,"filter-placeholder-on");400>E?h.add(this.domNode,"height-small"):h.remove(this.domNode,"height-small");this.searchPane&&this.searchPane.resize()},showLayers:function(){this.layerListPane||(this.layerListPane=new t({wabWidget:this}),this.layerListPane.placeAt(this.domNode));this.layerListPane.show()}})});