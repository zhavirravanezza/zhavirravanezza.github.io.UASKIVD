// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/CostAnalysis/create-load-project":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./create-load-project.html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-construct ./item-list dijit/form/ValidationTextBox jimu/dijit/formSelect esri/tasks/query esri/graphic esri/tasks/QueryTask esri/graphicsUtils dojo/Deferred esri/layers/FeatureLayer dojo/promise/all jimu/dijit/Message dojo/dom-style dojo/query ./update-project-cost dojo/dom-attr dijit/focus dojo/dom-class dojo/keys jimu/utils dojo/_base/event".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-create-load-project",highlighterColor:"#000",projectLayer:null,paneListData:[],_numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],projectNameOptions:[],projectNameField:null,projectDescField:null,_updateProjectCostWidget:null,projectNameTextBox:null,postCreate:function(){this.inherited(arguments);
this.projectNameField=this.config.projectLayerFields.PROJECTNAME;this.projectDescField=this.config.projectLayerFields.DESCRIPTION;this.paneListData=[];this.projectLayer=this.layerInfosObj.getLayerInfoById(this.config.projectSettings.projectLayer).layerObject;this.projectNameOptions=[{label:this.nls.createLoadProject.selectProject,value:"defaultSelectProjectNameOption"}];this._createProjectUI();this._loadProjectUI()},startup:function(){this.inherited(arguments);this._initializeData();this._fetchWidgetTopNode();
this.paneListData=[{title:this.nls.createLoadProject.createProjectPaneTitle,content:this.createProjectContainer,isOpen:!0,tabindex:"0",createProjectTab:!0,"aria-label":this.nls.createLoadProject.createProjectPaneTitle,role:"button",paneName:"creatProject"},{title:this.nls.createLoadProject.loadProjectPaneTitle,content:this.loadProjectContainer,isOpen:!1,loadProjectTab:!0,tabindex:"0","aria-label":this.nls.createLoadProject.loadProjectPaneTitle,role:"button",paneName:"loadProject"}];this.config.hasOwnProperty("updateCostEquationCheckBoxStatus")&&
this.config.updateCostEquationCheckBoxStatus&&this.paneListData.push({title:this.nls.updateCostEquationPanel.updateProjectCostTabLabel,content:this.updateEquationContainer,isOpen:!1,updateCostEquationWidget:!0,tabindex:"0","aria-label":this.nls.updateCostEquationPanel.updateProjectCostTabLabel,role:"button",paneName:"updateCostEquation"});this._createAndLoadProjectPanes();this._getProjectNamesOptions()},_initializeData:function(){this._updateProjectCostWidget=null},_showMessage:function(N){(new B({message:N})).message=
N},_createProjectUI:function(){var N=w.create("div",{"class":"esriCTCreateProjectWrapper"},this.createProjectContainer);var r=w.create("div",{"class":"esriCTFullwidth esriCTCreateProjectContent"},N);this.projectNameTextBox=new g({required:!0,trim:!0,placeHolder:this.nls.createLoadProject.projectNamePlaceHolder,title:this.nls.createLoadProject.projectNamePlaceHolder,maxLength:this._getFieldInfo(this.projectNameField).fieldLength,autofocus:!0,"class":"esriCTFullwidth esriCTCreateProjectContent esriCTEllipsis"},
r);this.projectNameTextBox.validator=e.hitch(this,function(u){return""===u?!1:this._validateProjectNameLocally(u)?!0:(this.projectNameTextBox.set("state","Error"),this.projectNameTextBox.set("invalidMessage",this.nls.createLoadProject.errorDuplicateProjectName),!1)});var E=this._getFieldInfo(this.projectDescField);r=w.create("div",{"class":"esriCTFullwidth esriCTCreateProjectContent"},N);var q=new g({required:E.nullable,trim:!0,placeHolder:this.nls.createLoadProject.projectDescPlaceHolder,"class":"esriCTFullwidth esriCTCreateProjectContent esriCTEllipsis",
title:this.nls.createLoadProject.projectDescPlaceHolder,maxLength:E.fieldLength},r);N=w.create("div",{"class":"esriCTFullwidth esriCTCreateLoadButtonWrap"},N);N=this._createButton(this.nls.createLoadProject.createLabel,N,"0");this.createLoadProjectButtonArray.push(N);this.own(a(N,"click",e.hitch(this,function(){this._createButtonClicked(q);this.projectNameTextBox.isValid()||z.focus(this.projectNameTextBox);q.isValid()||z.focus(q)})));this.own(a(N,"keydown",e.hitch(this,function(u){if(u.keyCode===
D.ENTER||u.keyCode===D.SPACE)R.stop(u),this._createButtonClicked(q),this.projectNameTextBox.isValid()||z.focus(this.projectNameTextBox),q.isValid()||z.focus(q)})));return this.createProjectContainer},_createButtonClicked:function(N){N.isValid()||(N.set("state","Error"),N.set("message",N.getErrorMessage()));this.projectNameTextBox.isValid()&&N.isValid()&&(this.loadingIndicator.show(),this._validateForDuplicateProjectName(F.sanitizeHTML(this.projectNameTextBox.get("value"))).then(e.hitch(this,function(r){r?
(this.loadingIndicator.hide(),this.projectNameTextBox.set("state","Error"),this._showMessage(this.nls.createLoadProject.errorDuplicateProjectName)):this._addProjectToLayer(F.sanitizeHTML(this.projectNameTextBox.get("value")),F.sanitizeHTML(N.get("value"))).then(e.hitch(this,function(E){this.loadingIndicator.hide();if(E&&E.success&&E.globalId){var q={label:F.sanitizeHTML(this.projectNameTextBox.get("value")),value:E.globalId,descValue:F.sanitizeHTML(N.get("value")),globalIdValue:E.globalId,objectIdValue:E.objectId};
this.projectNameSelect.addOption(q);this.emit("createProject",{name:F.sanitizeHTML(this.projectNameTextBox.get("value")),desc:F.sanitizeHTML(N.get("value")),projectId:E.globalId,objectId:E.objectId,projectIdField:this.projectLayer.globalIdField});this.projectNameTextBox.set("value"," ");N.set("value","")}else this._showMessage(this.nls.createLoadProject.errorInCreatingProject)}),e.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.createLoadProject.errorInCreatingProject)}))}),
e.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.createLoadProject.errorInCreatingProject)})))},_getFieldInfo:function(N){if(this.projectLayer&&this.projectLayer.getField(N)){N=this.projectLayer.getField(N);var r=N.length;var E=!N.nullable}return{fieldLength:r,nullable:E}},_createButton:function(N,r,E){return w.create("div",{"class":"jimu-btn esriCTEllipsis",innerHTML:N,title:N,role:"button",tabindex:E,"aria-label":N},r)},_loadProjectUI:function(){var N=w.create("div",
{"class":"esriCTLoadProjectWrapper"},this.loadProjectContainer);var r=w.create("div",{"class":"esriCTFullwidth esriCTCreateProjectContent"},N);N=w.create("div",{"class":"esriCTFullwidth esriCTCreateLoadButtonWrap"},N);this.projectNameSelect=new l({"aria-label":this.nls.createLoadProject.selectProject,"class":"esriCTFullwidth",options:this.projectNameOptions},w.create("div",{},r));this.projectNameSelect.startup();r=this._createButton(this.nls.createLoadProject.viewInMapLabel,N,"-1");this.own(a(r,"click",
e.hitch(this,function(){this.getProjectAssets("ViewProject")})));this.own(a(r,"keydown",e.hitch(this,function(E){if(E.keyCode===D.ENTER||E.keyCode===D.SPACE)R.stop(E),this.getProjectAssets("ViewProject")})));this.createLoadProjectButtonArray.push(r);r=this._createButton(this.nls.common.deleteText,N,"-1");this.createLoadProjectButtonArray.push(r);this.own(a(r,"click",e.hitch(this,this._deleteBtnClicked)));this.own(a(r,"keydown",e.hitch(this,function(E){if(E.keyCode===D.ENTER||E.keyCode===D.SPACE)R.stop(E),
this._deleteBtnClicked()})));N=this._createButton(this.nls.createLoadProject.loadLabel,N,"-1");this.createLoadProjectButtonArray.push(N);this.own(a(N,"click",e.hitch(this,function(){this.getProjectAssets("LoadProject")})));this.own(a(N,"keydown",e.hitch(this,function(E){if(E.keyCode===D.ENTER||E.keyCode===D.SPACE)R.stop(E),this.getProjectAssets("LoadProject")})));return this.loadProjectContainer},_deleteBtnClicked:function(){var N,r;(r=this.projectNameSelect._getSelectedOptionsAttr())&&r.value?N=
new B({message:this.nls.createLoadProject.deleteProjectConfirmationMsg,type:"question",maxWidth:375,buttons:[{label:this.nls.common.yes,onClick:e.hitch(this,function(){N.close();this.getProjectAssets("DeleteProject")})},{label:this.nls.common.no,onClick:e.hitch(this,function(){N.close()})}]}):this._showMessage(this.nls.createLoadProject.errorProjectNotSelected)},_checkIfProjectExist:function(N){var r=new n;var E=new p(this.projectLayer.url);var q=new A;q.outFields=[this.projectLayer.objectIdField,
this.projectLayer.globalIdField];q.returnGeometry=!1;q.where=this.projectLayer.globalIdField+" \x3d '"+N+"'";E.execute(q,e.hitch(this,function(u){u&&u.features&&0<u.features.length?r.resolve(!0):r.resolve(!1)}),e.hitch(this,function(){r.resolve(!1)}));return r.promise},getProjectAssets:function(N){var r,E,q,u,x;(x=this.projectNameSelect._getSelectedOptionsAttr())&&x.value?(this.loadingIndicator.show(),this._checkIfProjectExist(x.globalIdValue).then(e.hitch(this,function(H){H?(q=this.layerInfosObj.getTableInfoById(this.config.projectSettings.assetTable).layerObject,
u=new m(q.url),E=new p(u.url),r=new A,r.outFields=["*"],r.returnGeometry=!1,r.where=this.config.assetTableFields.PROJECTGUID+" \x3d '"+x.globalIdValue+"'",E.execute(r,e.hitch(this,function(L){this.loadingIndicator.hide();"ViewProject"===N?this._showProjectOnMap(x,L.features):"DeleteProject"===N?this._deleteProject(x,L.features):this._createAssetTemplateInfo(x,L.features)}),e.hitch(this,function(){this._showMessage(this.nls.createLoadProject.errorInLoadingProject);this.loadingIndicator.hide()}))):
(this.projectNameSelect.removeOption(x.globalIdValue),this._showMessage(this.nls.createLoadProject.errorProjectNotFound),this.emit("showCreateLoadPrjPanel"),this.loadingIndicator.hide())}),e.hitch(this,function(){this._showMessage(this.nls.createLoadProject.errorInLoadingProject);this.emit("showCreateLoadPrjPanel");this.loadingIndicator.hide()}))):this._showMessage(this.nls.createLoadProject.errorProjectNotSelected)},_createAssetTemplateInfo:function(N,r){var E=[];this.loadingIndicator.show();d.forEach(r,
e.hitch(this,function(q){(q=q.attributes[this.config.assetTableFields.GEOGRAPHYGUID])&&E.push(q)}));this._getRegionName(E).then(e.hitch(this,function(q){this.loadingIndicator.hide();var u=[];var x={};d.forEach(r,e.hitch(this,function(H){var L={};var Q=H.attributes[this.config.assetTableFields.ASSETGUID];var T=H.attributes[this.config.assetTableFields.GEOGRAPHYGUID];u.push(Q);L.COSTEQUATION=H.attributes[this.config.assetTableFields.COSTEQUATION];L.SCENARIO=H.attributes[this.config.assetTableFields.SCENARIO];
L.TEMPLATENAME=H.attributes[this.config.assetTableFields.TEMPLATENAME];L.GEOGRAPHYGUID=T;L.GEOGRAPHY=T?q[T]:null;L.OBJECTID=H.attributes[this.config.assetTableFields.OBJECTID];x[Q]=L}));this._loadProject(N,u,x)}),e.hitch(this,function(){this.loadingIndicator.hide()}))},_getAssetRequestToLayer:function(N,r){var E=r.layerObject.id;var q=r.layerObject;q.clearSelection();var u=new n;r=new p(q.url);var x=new A;x.outFields=["*"];x.returnGeometry=!0;x.outSpatialReference=this.map.spatialReference;x.where=
q.globalIdField+" in ('"+N.join("','")+"')";r.execute(x,e.hitch(this,function(H){H&&H.features&&0<H.features.length?u.resolve({layerId:E,features:H.features}):u.resolve({layerId:E,features:[]})}),e.hitch(this,function(){u.resolve({layerId:E,features:[]})}));return u.promise},_getProjectAdditionalCost:function(N){var r;var E=new n;if(r=this.config.projectSettings.multiplierAdditionalCostTable){r=this.layerInfosObj.getTableInfoById(r).layerObject.url;var q=new p(r);r=new A;r.outFields=["*"];r.returnGeometry=
!1;r.where=this.config.projectMultiplierFields.PROJECTGUID+" \x3d '"+N+"'";q.execute(r,e.hitch(this,function(u){var x=[];u&&u.features&&(x=u.features);E.resolve(x)}),e.hitch(this,function(){E.resolve([])}))}else E.resolve([]);return E.promise},_getRegionName:function(N){var r=new n;if(this.config.projectSettings.costingGeometryLayer&&this.config.projectSettings.geographyField&&0<N.length){var E=this.layerInfosObj.getLayerInfoById(this.config.projectSettings.costingGeometryLayer).layerObject;var q=
new p(E.url);var u=new A;u.outFields=[this.config.projectSettings.geographyField,E.globalIdField];u.returnDistinctValues=!0;u.returnGeometry=!1;u.where=E.globalIdField+" in ('"+N.join("','")+"')";q.execute(u,e.hitch(this,function(x){var H={};x&&x.features&&d.forEach(x.features,e.hitch(this,function(L){H[L.attributes[E.globalIdField]]=L.attributes[this.config.projectSettings.geographyField]}));r.resolve(H)}),e.hitch(this,function(){r.resolve([])}))}else r.resolve([]);return r.promise},_selectFeaturesOnMap:function(N,
r){var E=this.layerInfosObj.getLayerInfoById(r).layerObject;var q=new n;r=new A;r.where=E.globalIdField+" in ('"+N.join("','")+"')";E.selectFeatures(r,m.SELECTION_NEW,e.hitch(this,function(u){u&&0<u.length?q.resolve(u):q.resolve([])}),e.hitch(this,function(){q.resolve([])}));return q.promise},_showProjectOnMap:function(N,r){var E=[],q=[];d.forEach(r,e.hitch(this,function(u){E.push(u.attributes[this.config.assetTableFields.ASSETGUID])}));0===E.length?this._showMessage(this.nls.createLoadProject.noAssetsToViewOnMap):
(this.loadingIndicator.show(),this._selectFeaturesOnMap([N.globalIdValue],this.config.projectSettings.projectLayer).then(e.hitch(this,function(u){var x=!1;0<u.length&&u[0].geometry&&(x=!0,this.map.setExtent(k.graphicsExtent(u).expand(1.5)));d.forEach(this.config.layerSettings,e.hitch(this,function(H){H.editable&&q.push(this._selectFeaturesOnMap(E,H.id))}));C(q).then(e.hitch(this,function(H){var L=[];this.loadingIndicator.hide();x||(d.forEach(H,e.hitch(this,function(Q){L=L.concat(Q)})),0<L.length?
this.map.setExtent(k.graphicsExtent(L).expand(1.5)):this._showMessage(this.nls.createLoadProject.noAssetsToViewOnMap))}))}),e.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.createLoadProject.errorInLoadingProject)})))},_deleteFromTable:function(N,r,E){if(N=this.layerInfosObj.getTableInfoById(N))N=N.layerObject;r=r+" \x3d '"+E+"'";N?r=this.appUtils.deleteFeatures(N.url,r):(r=new n,r.resolve(!1),r=r.promise);return r},_deleteProject:function(N,r){this.loadingIndicator.show();
this._getRelatedLabelPoint(N.globalIdValue,N,r)},_deleteDetailsRelatedToProject:function(N,r,E){var q=[],u=[];this.emit("deleteProject");this.loadingIndicator.show();d.forEach(E,e.hitch(this,function(x){q.push(x.attributes[this.config.assetTableFields.ASSETGUID])}));0<q.length&&d.forEach(this.config.layerSettings,e.hitch(this,function(x){if(x.editable){x=this.layerInfosObj.getLayerInfoById(x.id).layerObject;var H=x.globalIdField+" in ('"+q.join("','")+"')";u.push(this.appUtils.deleteFeatures(x.url,
H))}}));u.push(this._deleteFromTable(this.config.projectSettings.assetTable,this.config.assetTableFields.PROJECTGUID,N));u.push(this._deleteFromTable(this.config.projectSettings.multiplierAdditionalCostTable,this.config.projectMultiplierFields.PROJECTGUID,N));u.push(this.appUtils.deleteFeatures(this.projectLayer.url,this.projectLayer.globalIdField+" \x3d '"+r.globalIdValue+"'"));C(u).then(e.hitch(this,function(){this.loadingIndicator.hide();this.projectNameSelect.removeOption(N);this._showMessage(this.nls.createLoadProject.projectDeletedMsg);
this.projectLayer.clearSelection();this.projectLayer.refresh();d.forEach(this.config.layerSettings,e.hitch(this,function(x){x.editable&&(x=this.layerInfosObj.getLayerInfoById(x.id).layerObject,x.clearSelection(),x.refresh())}))}))},_loadProject:function(N,r,E){var q=[];this.loadingIndicator.show();if(0<r.length)d.forEach(this.config.layerSettings,e.hitch(this,function(x){var H=this.layerInfosObj.getLayerInfoById(x.id);H&&H.layerObject&&x.editable&&q.push(this._getAssetRequestToLayer(r,H))}));else{var u=
new n;q.push(u.promise);u.resolve(null)}C(q).then(e.hitch(this,function(x){var H={};var L={name:N.label,desc:N.descValue,projectId:N.globalIdValue,objectId:N.objectIdValue};this.selectedProjectFeatureAttr=N.prjAttributes;d.forEach(x,e.hitch(this,function(Q){Q&&(H[Q.layerId]=Q.features)}));this._getProjectAdditionalCost(N.globalIdValue).then(e.hitch(this,function(Q){this.loadingIndicator.hide();this.emit("loadProject",{assetTemplateInfo:E,assetInfo:H,projectInfo:L,additionalCostInfo:Q,projectIdField:this.projectLayer.globalIdField})}),
e.hitch(this,function(){this.loadingIndicator.hide()}))}),e.hitch(this,function(){this.loadingIndicator.hide()}))},_createAndLoadProjectPanes:function(){this.paneListData&&0<this.paneListData.length&&(this._createOrLoadPrj=new t({itemList:this.paneListData,openMultiple:!1,highlighterColor:this.config.selectedThemeColor},w.create("div",{},this.createLoadProjectContainer)),this.own(a(this._createOrLoadPrj,"refreshUpdateCostEquationWidget",e.hitch(this,function(){this._destroyUpdateCostEquationWidget();
this._getProjectNamesOptions()}))),this.own(a(this._createOrLoadPrj,"resetLoadProjectNameDropdown",e.hitch(this,function(){this.projectNameSelect.set("value","defaultSelectProjectNameOption")}))),this.own(a(this._createOrLoadPrj,"OnOpenCreatePanel",e.hitch(this,function(){var N=G(".esriCTCreateProjectContent",this.domNode);N&&N.length&&(this._updateTabindexOfInputDOM(N[0],"0"),this._updateTabindexOfInputDOM(N[1],"0"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[0],"0"),z.focus(N[0].domNode))}))),
this.own(a(this._createOrLoadPrj,"OnCloseCreatePanel",e.hitch(this,function(){var N=G(".esriCTCreateProjectContent",this.domNode);N&&N.length&&(this._updateTabindexOfInputDOM(N[0],"-1"),this._updateTabindexOfInputDOM(N[1],"-1"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[0],"-1"))}))),this.own(a(this._createOrLoadPrj,"OnOpenLoadPanel",e.hitch(this,function(){var N=G(".esriCTCreateProjectContent",this.domNode);N&&N.length&&(this._updateTabindexOfDOM(N[2].children[0],"0"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[1],
"0"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[2],"0"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[3],"0"),this.config.updateCostEquationCheckBoxStatus||this.updateLastFocusNode(this.createLoadProjectButtonArray[3],this.widgetDomNode),z.focus(N[2].children[0]))}))),this.own(a(this._createOrLoadPrj,"OnCloseLoadPanel",e.hitch(this,function(){var N;(N=G(".esriCTCreateProjectContent",this.domNode))&&N.length&&(this._updateTabindexOfDOM(N[2].children[0],"-1"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[1],
"-1"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[2],"-1"),this._updateTabindexOfDOM(this.createLoadProjectButtonArray[3],"-1"),this._getLastTitleContainerNode())}))),this._createOrLoadPrj.startup())},_getLastTitleContainerNode:function(){var N;var r=G(".esriCTItemTitleContainer",this.domNode);(N=r.length)&&this.updateLastFocusNode(r[N-1],this.widgetDomNode)},_getUpdateCostEquationProjectNameDOM:function(N,r){G(".esriCTProjectNameCheckBox",this.domNode).forEach(e.hitch(this,function(E,
q){b.set(E,"tabindex",N);r&&void 0===q&&this.updateLastFocusNode(E,this.widgetDomNode)}))},_updateTabindexOfDOM:function(N,r){b.set(N,"tabindex",r)},_updateTabindexOfInputDOM:function(N,r){G(".dijitInputInner",N).forEach(e.hitch(this,function(E){this._updateTabindexOfDOM(E,r)}))},_getProjectNamesOptions:function(){this.loadingIndicator.show();var N=new p(this.projectLayer.url);var r=new A;r.outFields=["*"];r.returnGeometry=!1;r.where="1\x3d1";N.execute(r,e.hitch(this,function(E){var q=[];E&&E.features&&
(q=E.features);this._populateProjectNameOptions(q);setTimeout(e.hitch(this,function(){this._displayUpdateCostEquationWidget()}),10)}),e.hitch(this,function(){this.loadingIndicator.hide()}))},_populateProjectNameOptions:function(N){this.projectNameOptions=[{label:this.nls.createLoadProject.selectProject,value:""}];d.forEach(N,e.hitch(this,function(r){this.projectNameField&&r.attributes[this.projectNameField]&&""!==e.trim(r.attributes[this.projectNameField])&&this.projectNameOptions.push({label:r.attributes[this.projectNameField],
value:r.attributes[this.projectLayer.globalIdField],descValue:r.attributes[this.projectDescField],globalIdValue:r.attributes[this.projectLayer.globalIdField],objectIdValue:r.attributes[this.projectLayer.objectIdField],prjAttributes:r.attributes})}));this.projectNameSelect.set("options",e.clone(this.projectNameOptions));this.loadingIndicator.hide()},_validateProjectNameLocally:function(N){var r=[];this.projectNameSelect&&0<this.projectNameSelect.options.length&&(r=d.filter(this.projectNameSelect.options,
function(E){return E.label.toLowerCase()===N.toLowerCase()}));return 0<r.length?!1:!0},_validateForDuplicateProjectName:function(N){var r=new n;var E=new p(this.projectLayer.url);var q=new A;q.outFields=[this.projectLayer.objectIdField,this.projectLayer.globalIdField];q.returnGeometry=!1;q.where="LOWER("+this.projectNameField+") \x3d '"+N.toLowerCase()+"'";E.execute(q,e.hitch(this,function(u){u&&u.features&&0<u.features.length?r.resolve(!0):r.resolve(!1)}),e.hitch(this,function(){r.resolve(!1)}));
return r.promise},_addProjectToLayer:function(N,r){var E=new n;var q=new h;q.attributes=0<this.projectLayer.templates.length?this.projectLayer.templates[0].prototype.attributes:this.projectLayer.types[0].templates[0].prototype.attributes;q.attributes[this.projectNameField]=N;q.attributes[this.projectDescField]=r;this.projectLayer.applyEdits([q],null,null,e.hitch(this,function(u){this.selectedProjectFeatureAttr=q.attributes;E.resolve(u[0])}),function(u){E.reject(u)});return E.promise},_fetchWidgetTopNode:function(){if(this.domNode.parentNode)var N=
this.domNode.parentNode;if(N.parentNode)var r=N.parentNode;if(r.parentNode)var E=r.parentNode;E&&(this._widgetTopNode=E)},_instantiateUpdateProjectCostWidget:function(){this._updateProjectCostWidget=new f({nls:this.nls,projectNameOptions:this.projectNameOptions,widgetTopNode:this._widgetTopNode,layerInfosObj:this.layerInfosObj,config:this.config,map:this.map,loadingIndicator:this.loadingIndicator,widgetDomNode:this.widgetDomNode,updateLastFocusNode:this.updateLastFocusNode,setTabindexOfUpdateProjectCost:this._setTabindexOfUpdateProjectCost},
w.create("div",{},this.updateEquationContainer));this.own(a(this._updateProjectCostWidget,"updateProjectCostWidgetLoaded",e.hitch(this,function(){c.contains(this.updateEquationContainer.parentNode,"esriCTItemContentActive")?this._setTabindexOfUpdateProjectCost(!0,this.domNode):this._setTabindexOfUpdateProjectCost(!1,this.domNode)})));this._updateProjectCostWidget.startup()},_setTabindexOfUpdateProjectCost:function(N,r){var E=G(".esriCTProjectNameCheckBox",r);E.forEach(e.hitch(this,function(q){N?(b.set(q,
"tabindex","0"),E.length-1&&this.updateLastFocusNode(q,r)):(b.set(q,"tabindex","-1"),this._setUpdateCostEquationLastFocusNode(r))}))},_setUpdateCostEquationLastFocusNode:function(N){var r=G(".esriCTItemTitleContainer",N);this.updateLastFocusNode(r[2],N)},_resetHeight:function(){var N=y.getComputedStyle(this._widgetTopNode).height;N=parseFloat(N);N-=28;var r=G(".esriCTItemTitleContainer",this._widgetTopNode);d.forEach(r,e.hitch(this,function(E){E=y.getComputedStyle(E).height;E=parseFloat(E);N-=E}));
N-=30;y.set(this.updateEquationContainer,"height",N+"px")},_destroyUpdateCostEquationWidget:function(){this._updateProjectCostWidget&&this._updateProjectCostWidget.destroy();this._updateProjectCostWidget=null},_displayUpdateCostEquationWidget:function(){this.config.hasOwnProperty("updateCostEquationCheckBoxStatus")&&this.config.updateCostEquationCheckBoxStatus&&(this._resetHeight(),this._instantiateUpdateProjectCostWidget())},_deleteExistingLabelPoint:function(N,r,E,q){if(N&&0<N.length){var u=this.map.getLayer(this.config.projectSettings.pointLayerCentroid),
x=new m(u.url,{outFields:["*"]});x.onLoad=e.hitch(this,function(){var H=[];d.forEach(N,e.hitch(this,function(L){var Q={};Q[x.objectIdField]=L;L=new h(null,null,Q,null);H.push(L)}));x.applyEdits(null,null,H,e.hitch(this,function(){this.map.getLayer(this.config.projectSettings.pointLayerCentroid).refresh();this._deleteDetailsRelatedToProject(r,E,q)}),e.hitch(this,function(){this._deleteDetailsRelatedToProject(r,E,q)}))})}else this._deleteDetailsRelatedToProject(r,E,q)},_getRelatedLabelPoint:function(N,
r,E){if(""!==this.config.projectSettings.pointLayerCentroid&&null!==this.config.projectSettings.pointLayerCentroid&&void 0!==this.config.projectSettings.pointLayerCentroid){var q,u=this.map.getLayer(this.config.projectSettings.pointLayerCentroid),x=new m(u.url,{outFields:["*"]});x.onLoad=e.hitch(this,function(){q=this._getFieldName(x,"projectid")+" \x3d '"+N+"'";var H=new A;H.where=q;x.queryIds(H,e.hitch(this,function(L){this._deleteExistingLabelPoint(L,N,r,E)}),e.hitch(this,function(){this._deleteDetailsRelatedToProject(N,
r,E)}))})}else this._deleteDetailsRelatedToProject(N,r,E)},_getFieldName:function(N,r){var E;d.forEach(N.fields,e.hitch(this,function(q){q.name.toLowerCase()===r.toLowerCase()&&(E=q.name)}));return E}})})},"widgets/CostAnalysis/item-list":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./item-list.html dojo/_base/array dojo/_base/lang dojo/dom-attr dojo/dom-class dojo/dom-style dojo/on dojo/query dojo/dom-construct dojo/keys dojo/_base/event".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-item-list",highlighterColor:"#000",currentActivePanel:null,postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this.itemList&&0<this.itemList.length&&setTimeout(d.hitch(this,function(){this._loadItemList();this._handleTabIndexesOfItems()}),0)},_handleTabIndexesOfItems:function(){this.emit("OnOpenCreatePanel");this.emit("OnCloseLoadPanel");this.emit("OnCloseUpdateCostEquationPanel")},
_loadItemList:function(){e.forEach(this.itemList,d.hitch(this,function(k){this.addItem(k)}))},addItem:function(k){k.content=k.content||"";var n=A.create("div",{},null);var m=A.create("div",{"class":"esriCTItemTitleContainer",tabindex:"0","aria-label":k.title,role:"button"},n);w.add(m,"esriCTProjectOveriew");A.create("div",{"class":"esriCTItemHighlighter"},m);var C=A.create("div",{"class":"esriCTItemTitle esriCTEllipsis",innerHTML:k.title,title:k.title,paneName:k.paneName},m);k.hasOwnProperty("updateCostEquationWidget")&&
a.set(C,"updateCostEquationWidget",!0);k.hasOwnProperty("loadProjectTab")&&a.set(C,"loadProjectTab",!0);k.hasOwnProperty("createProjectTab")&&a.set(C,"createProjectTab",!0);C=A.create("div",{"class":"esriCTItemContent"},n);"string"===typeof k.content?a.set(C,"innerHTML",k.content):A.place(k.content,C);this.itemListContainer.appendChild(n);this.own(g(m,"click",d.hitch(this,function(B){this._itemTitleContainerClicked(B)})));this.own(g(m,"keydown",d.hitch(this,function(B){if(B.keyCode===h.ENTER||B.keyCode===
h.SPACE)p.stop(B),this._itemTitleContainerClicked(B)})));k.isOpen&&setTimeout(d.hitch(this,function(){m.click()}),100)},_itemTitleContainerClicked:function(k){this._togglePanel(k.currentTarget.parentElement);k.currentTarget.children.length&&a.get(k.currentTarget.children[1],"loadProjectTab")&&(this.emit("resetLoadProjectNameDropdown"),k.currentTarget.children.length&&w.contains(k.currentTarget.children[1],"esriCTItemTitleActive")?(a.set(k.currentTarget,"aria-expanded","true"),this.emit("OnCloseCreatePanel"),
this.emit("OnOpenLoadPanel")):(a.set(k.currentTarget,"aria-expanded","false"),this.emit("OnCloseLoadPanel")));k.currentTarget.children.length&&a.get(k.currentTarget.children[1],"updateCostEquationWidget")&&(this.emit("refreshUpdateCostEquationWidget"),k.currentTarget.children.length&&w.contains(k.currentTarget.children[1],"esriCTItemTitleActive")?(this.emit("OnCloseCreatePanel"),this.emit("OnCloseLoadPanel"),a.set(k.currentTarget,"aria-expanded","true")):a.set(k.currentTarget,"aria-expanded","false"));
k.currentTarget.children.length&&a.get(k.currentTarget.children[1],"createProjectTab")&&(k.currentTarget.children.length&&w.contains(k.currentTarget.children[1],"esriCTItemTitleActive")?(this.emit("OnOpenCreatePanel"),this.emit("OnCloseLoadPanel"),a.set(k.currentTarget,"aria-expanded","true")):(this.emit("OnCloseCreatePanel"),a.set(k.currentTarget,"aria-expanded","false")))},_togglePanel:function(k,n){var m=0;n||(m=30);n=l(".esriCTItemTitle",k)[0];var C=l(".esriCTItemContent",k)[0];var B=l(".esriCTItemHighlighter",
k)[0];w.toggle(n,"esriCTItemTitleActive");w.toggle(C,"esriCTItemContentActive");w.contains(C,"esriCTItemContentActive")?(C.style.height=C.scrollHeight+m+"px",this.currentActivePanel&&!this.openMultiple&&this._togglePanel(this.currentActivePanel,!0),this.currentActivePanel=k,t.set(B,"backgroundColor",this.highlighterColor)):(C.style.height=0,t.set(B,"backgroundColor","transparent"),a.get(this.currentActivePanel,"index")===a.get(k,"index")&&(this.currentActivePanel=null))}})})},"widgets/CostAnalysis/update-project-cost":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/Evented dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/dom-construct jimu/dijit/CheckBox dojo/dom-class dojo/on dojo/text!./update-project-cost.html dojo/promise/all esri/tasks/QueryTask esri/tasks/query jimu/dijit/Message esri/graphic dojo/dom-attr dojo/keys dojo/_base/event".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C){return O([J,K,I],{templateString:g,_updateCostProjectSelectAllCheckBox:null,_filteredProjectNameOptions:null,constructor:function(B){B&&v.mixin(this,B)},postCreate:function(){this.inherited(arguments);this.own(t(this.updateCostEquationButton,"keydown",v.hitch(this,function(B){if(B.keyCode===m.ENTER||B.keyCode===m.SPACE)C.stop(B),this._updateCostEquation()})))},startup:function(){this.inherited(arguments);this.loadingIndicator.show();this._initializeData();
this._filteredProjectNameOptions=e.filter(this.projectNameOptions,v.hitch(this,function(B){return B.label!==this.nls.createLoadProject.selectProject}));0<this._filteredProjectNameOptions.length?this._displayProjectCostEquationList():this._displayNoFeatureFoundScreen();this.loadingIndicator.hide()},_displayNoFeatureFoundScreen:function(){w.remove(this.noFeatureFoundScreen,"esriCTHidden")},_initializeData:function(){this._filteredProjectNameOptions=this._updateCostProjectSelectAllCheckBox=null},_displayProjectCostEquationList:function(){w.remove(this.projectListChildContainer,
"esriCTHidden");w.remove(this.updateButtonParentContainer,"esriCTHidden");this._updateCostProjectRow(this.nls.updateCostEquationPanel.updateProjectCostSelectProjectTitle,!0);e.forEach(this._filteredProjectNameOptions,v.hitch(this,function(B){this._updateCostProjectRow(B)}));this.emit("updateProjectCostWidgetLoaded")},_updateCostProjectRow:function(B,y){var G=d.create("div",{"class":"esriCTUpdateCostRowMainNode"},this.projectListChildContainer);if(y){w.add(G,"esriCTUpdateCostSelectAll");var f=B}else w.add(G,
"esriCTUpdateCostProjectRow"),f=B.label;G=d.create("div",{"class":"esriCTCheckBoxParentNode"},G);f=new a({"class":"esriCTProjectNameCheckBox",checked:!1,label:f,tabindex:"-1","aria-label":f},G);y?this._updateCostProjectSelectAllCheckBox=f:B.checkbox=f;this.own(t(f,"change",v.hitch(this,function(b){y?this._selectAllUpdateCostCheckBox(b):this._maintainSelectAllState()})))},_selectAllUpdateCostCheckBox:function(B){e.forEach(this._filteredProjectNameOptions,v.hitch(this,function(y){y.checkbox.setValue(B);
B&&(n.set(this.updateCostEquationButton,"tabindex","0"),this.updateLastFocusNode(this.updateCostEquationButton,this.widgetDomNode))}))},_maintainSelectAllState:function(){var B=!0;var y=!1;e.forEach(this._filteredProjectNameOptions,v.hitch(this,function(G){G.checkbox.getValue()||(B=!1);G.checkbox.getValue()&&(y=!0)}));y?(w.remove(this.updateCostEquationButton,"jimu-state-disabled esriCTUpdateEquationBtnDisabled"),n.set(this.updateCostEquationButton,"tabindex","0"),this.updateLastFocusNode(this.updateCostEquationButton,
this.widgetDomNode)):(w.add(this.updateCostEquationButton,"jimu-state-disabled esriCTUpdateEquationBtnDisabled"),n.set(this.updateCostEquationButton,"tabindex","-1"),this.setTabindexOfUpdateProjectCost(!0,this.widgetDomNode));B?(this._updateCostProjectSelectAllCheckBox.check(!0),this.updateLastFocusNode(this.updateCostEquationButton,this.widgetDomNode)):(this._updateCostProjectSelectAllCheckBox.uncheck(!0),y||this.setTabindexOfUpdateProjectCost(!0,this.widgetDomNode))},_updateCostEquation:function(){this.loadingIndicator.show();
var B=this._getProjectGuid(),y=this.layerInfosObj.getTableInfoById(this.config.projectSettings.assetTable).layerObject;this._getAssets(B,y)},_getProjectGuid:function(){var B=[];e.forEach(this._filteredProjectNameOptions,v.hitch(this,function(y){y.checkbox.getValue()&&B.push(y.globalIdValue)}));return B},_getAssets:function(B,y){var G={};G.assetsDeferredList=this._getAssetsDeferred(B,y);l(G).then(v.hitch(this,function(f){var b=[];var z={};e.forEach(f.assetsDeferredList.features,v.hitch(this,function(c){c.hasOwnProperty("attributes")&&
c.attributes.hasOwnProperty(this.config.assetTableFields.ASSETGUID)&&b.push(c.attributes[this.config.assetTableFields.ASSETGUID]);z[c.attributes[this.config.assetTableFields.ASSETGUID]]=c.attributes}));this._getAssetLayers(b,z)}),v.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.updateCostEquationPanel.updateProjectCostError)}))},_getAssetsDeferred:function(B,y){B=this.config.assetTableFields.PROJECTGUID+" IN ('"+B.join("','")+"')";y=new A(y.url);var G=new h;G.outFields=
["*"];G.where=B;G.returnGeometry=!1;G.outSpatialReference=this.map.spatialReference;return y.execute(G).promise},_getAssetLayers:function(B,y){var G={};e.forEach(this.config.layerSettings,v.hitch(this,function(f){var b=this.layerInfosObj.getLayerInfoById(f.id);b&&b.layerObject&&b.layerObject.globalIdField&&(G[f.id]=this._getAssetLayerDeferred(f,B))}));l(G).then(v.hitch(this,function(f){f=this._createProjectAssetRelationship(f);f=this._createAssetProjectRelationship(f,B);this._getAssetsGuidName(y,
f)}),v.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.updateCostEquationPanel.updateProjectCostError)}))},_getAssetsGuidName:function(B,y){var G={},f=this.map.getLayer(this.config.projectSettings.costingGeometryLayer),b;for(b in B)if(B.hasOwnProperty(b)){var z=B[b][this.config.assetTableFields.GEOGRAPHYGUID];""!==z&&null!==z&&void 0!==z&&(G[b]=this._getAssetGuidDeferred(f,z))}l(G).then(v.hitch(this,function(c){c=this._getAssetGuidNameRelation(c);this._compareAssetsInfoWithConfiguration(y,
B,c)}),v.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.updateCostEquationPanel.updateProjectCostError)}))},_getAssetGuidNameRelation:function(B){var y={},G;for(G in B)B.hasOwnProperty(G)&&(y[G]=B[G].features[0].attributes[this.config.projectSettings.geographyField]);return y},_getAssetGuidDeferred:function(B,y){y=B.globalIdField+" \x3d '"+y+"'";B=new A(B.url);var G=new h;G.outFields=[this.config.projectSettings.geographyField];G.where=y;G.returnGeometry=!1;G.outSpatialReference=
this.map.spatialReference;return B.execute(G).promise},_compareAssetsInfoWithConfiguration:function(B,y,G){var f=[],b;for(b in B)if(B.hasOwnProperty(b)){var z=this._getUpdateAssetGraphic(this.config.costingInfoSettings[B[b]],y,b,G);z&&f.push(z)}0<f.length?this._updateAssetCostingInfo(f):(this.loadingIndicator.hide(),this._showMessage(this.nls.updateCostEquationPanel.updateProjectCostSuccess))},_getUpdateAssetGraphic:function(B,y,G,f){var b=null;e.forEach(B,v.hitch(this,function(z){var c=z.scenario,
D=z.featureTemplate,F=z.geography,R=y[G][this.config.assetTableFields.SCENARIO],N=y[G][this.config.assetTableFields.TEMPLATENAME];var r=f.hasOwnProperty(G)?f[G]:y[G][this.config.assetTableFields.GEOGRAPHYGUID];if(""===c||null===c)c=null;if(""===F||null===F)F=null;if(""===R||null===R)R=null;if(""===r||null===r)r=null;D===N&&F===r&&c===R&&(c={},c[this.config.assetTableFields.OBJECTID]=y[G][this.config.assetTableFields.OBJECTID],c[this.config.assetTableFields.COSTEQUATION]=z.costEquation,b=new k(null,
null,c,null))}));return b},_updateAssetCostingInfo:function(B){this.layerInfosObj.getTableInfoById(this.config.projectSettings.assetTable).layerObject.applyEdits(null,B,null,v.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.updateCostEquationPanel.updateProjectCostSuccess)}),v.hitch(this,function(){this.loadingIndicator.hide();this._showMessage(this.nls.updateCostEquationPanel.updateProjectCostError)}))},_createAssetProjectRelationship:function(B,y){var G={};e.forEach(y,
v.hitch(this,function(f){for(var b in B)B.hasOwnProperty(b)&&-1<B[b].indexOf(f)&&(G[f]=b)}));return G},_createProjectAssetRelationship:function(B){var y={},G;for(G in B)if(B.hasOwnProperty(G)){var f=this._getRelatedAssetGuidArr(B[G]);y[G]=f}return y},_getRelatedAssetGuidArr:function(B){var y=[];e.forEach(B.features,v.hitch(this,function(G){G.hasOwnProperty("attributes")&&y.push(G.attributes[B.globalIdFieldName])}));return y},_getAssetLayerDeferred:function(B,y){y=this.layerInfosObj.getLayerInfoById(B.id).layerObject.globalIdField+
" IN ('"+y.join("','")+"')";B=new A(B.url);var G=new h;G.outFields=["*"];G.where=y;G.returnGeometry=!1;G.outSpatialReference=this.map.spatialReference;return B.execute(G).promise},_showMessage:function(B){(new p({message:B})).message=B}})})},"widgets/CostAnalysis/work-bench":function(){define("dojo/_base/declare jimu/BaseWidget jimu/FilterManager dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./work-bench.html dojo/_base/lang dojo/dom-style dojo/dom-attr dojo/_base/array dojo/dom-class dojo/on dojo/query esri/graphic dojo/dom-construct dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/tasks/GeometryService esri/graphicsUtils ./template-picker ./project-overview ./project-summary ./asset-details jimu/CSVUtils esri/tasks/query esri/tasks/QueryTask esri/geometry/geometryEngine esri/SpatialReference esri/geometry/Point dojo/keys dojo/_base/event dijit/focus".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R,N,r,E,q){return O([J,I,v],{templateString:e,baseClass:"jimu-widget-cost-analysis-work-bench",_projectOverview:null,_projectSummary:null,_assetItemSummary:{},_assetGroupSummary:{},_assetTableIds:{},_recentlyOperatedLayerIds:[],_projectAssetTable:null,_additionalCostTable:null,_assetInfoForReset:{},_reportColumns:[],filterManager:null,_pointLayer:null,_originalTemplateAttributes:null,_isLoadingProject:null,_exsitingLabelPointDefExpression:null,
_canExportProject:!0,postCreate:function(){this.inherited(arguments);this._assetItemSummary={};this._assetGroupSummary={};this._assetTableIds={};this._recentlyOperatedLayerIds=[];this._assetInfoForReset={};this.filterManager=K.getInstance();this._exsitingLabelPointDefExpression=this._isLoadingProject=this._originalTemplateAttributes=this._pointLayer=null;this._reportColumns=[];if(!this.config.generalSettings.hasOwnProperty("canExportProject")||this.config.generalSettings.hasOwnProperty("canExportProject")&&
!this.config.generalSettings.canExportProject)a.set(this.downloadCSVBtn,"display","none"),w.set(this.downloadCSVBtn,"tabindex","-1"),this._canExportProject=!1},onWidgetActive:function(){this._templatePicker&&this._templatePicker.bindLayerEvents()},onWidgetDeActive:function(){this._templatePicker&&this._templatePicker._editor&&this._templatePicker._editor.editToolbar&&(this._templatePicker._editor.templatePicker.clearSelection(),this._templatePicker._editor.editToolbar.deactivate(),this._templatePicker.removeLayerEvents())},
onShow:function(u){this.refreshTemplatePicker(u)},onWidgetOpen:function(){this.refreshTemplatePicker();this.config.projectSettings.projectLayer||(this._recentlyOperatedLayerIds=[],this._filterAssets());this._templatePicker&&!this._templatePicker._editor&&(this._disableWebMapPopup(),this._templatePicker.initEditingToolbar())},onWidgetClose:function(){this.config.projectSettings.projectLayer||this._clearAppliedFilters();this._templatePicker&&this._templatePicker._editor&&(this._templatePicker._editor.destroy(),
this._templatePicker._editor=null,this._enableWebMapPopup())},refreshTemplatePicker:function(u){if(this._templatePicker){this._templatePicker.onWindowResize();if(!u){u=this.refreshButton;var x=this.featureModeTextNode;"none"===this.downloadCSVBtn.style.display||g.contains(this.downloadCSVBtn,"esriCTHidden")||(u=this.downloadCSVBtn);g.contains(this.projectNameDiv,"esriCTHidden")||(x=this.projectNameDiv);this.appUtils.setFirstAndLastWBFocusNode(this.widgetDomNode,x,u)}this._handle508AccessibilityForTemplatePicker()}},
startup:function(){this.inherited(arguments);this._storeExistingLabelPointLayerDefExpression();this.config.generalSettings.hasOwnProperty("canExportProject")&&this.config.generalSettings.canExportProject&&this._getReportColumns();this.config.projectSettings.projectLayer?(this.own(l(this.backButton,"click",d.hitch(this,function(){this._backButtonClicked()}))),this.own(l(this.backButton,"keydown",d.hitch(this,function(H){if(H.keyCode===r.ENTER||H.keyCode===r.SPACE)E.stop(H),this._backButtonClicked()})))):
(w.set(this.refreshButton,"innerHTML",this.nls.common.reset),w.set(this.refreshButton,"aria-label",this.nls.common.reset),g.add(this.backButton,"esriCTHidden"));this.own(l(this.refreshButton,"click",d.hitch(this,function(){this._refreshButtonClicked()})));this.own(l(this.refreshButton,"keydown",d.hitch(this,function(H){if(H.keyCode===r.ENTER||H.keyCode===r.SPACE)E.stop(H),this._refreshButtonClicked()})));this.own(l(this.downloadCSVBtn,"click",d.hitch(this,function(){var H=this._createDownLoadData();
this._downLoadCSV(H)})));this.own(l(this.downloadCSVBtn,"keydown",d.hitch(this,function(H){if(H.keyCode===r.ENTER||H.keyCode===r.SPACE)H=this._createDownLoadData(),this._downLoadCSV(H)})));this.onProjectCreateOrLoad(this.projectInfo,this.assetInfo);var u=this.refreshButton,x=this.featureModeTextNode;"none"===this.downloadCSVBtn.style.display||g.contains(this.downloadCSVBtn,"esriCTHidden")||(u=this.downloadCSVBtn);g.contains(this.projectNameDiv,"esriCTHidden")||(x=this.projectNameDiv);this.appUtils.setFirstAndLastWBFocusNode(this.widgetDomNode,
x,u);this._handle508AccessibilityForTemplatePicker()},_backButtonClicked:function(){g.contains(this.backButton,"jimu-state-disabled")||(this._clearAppliedFilters(),this._templatePicker.destroy(),this._templatePicker=null,this._enableWebMapPopup(),this.emit("showProjectPanel"))},_refreshButtonClicked:function(){this._clearAppliedFilters();this._templatePicker&&(this._templatePicker.destroy(),this._templatePicker=null);this.projectInfo.projectId&&this.config.projectSettings.projectLayer?this.emit("reloadProject",
this.projectInfo.projectId):this._resetProject()},_resetProject:function(){var u=[],x;this.loadingIndicator.show();if(this._assetInfoForReset&&0<Object.keys(this._assetInfoForReset).length)for(x in this._assetInfoForReset){var H=this.layerInfosObj.getLayerInfoById(x).layerObject;var L=H.globalIdField+" in ('"+this._assetInfoForReset[x].join("','")+"')";u.push(this.appUtils.deleteFeatures(H.url,L))}n(u).then(d.hitch(this,function(){this.loadingIndicator.hide();this._assetInfoForReset={};this.onProjectCreateOrLoad(this.projectInfo,
this.assetInfo);this.emit("resetProject")}),d.hitch(this,function(){this.loadingIndicator.hide()}))},_clearAppliedFilters:function(){this.config.projectSettings.projectLayer&&this.filterManager.applyWidgetFilter(this.config.projectSettings.projectLayer,this.widgetId,"",!0,!0);this._recentlyOperatedLayerIds=[];t.forEach(this.config.layerSettings,d.hitch(this,function(x){var H=this.layerInfosObj.getLayerInfoById(x.id);x.editable&&H&&H.layerObject&&H.layerObject.clearSelection()}));var u=this.map.getLayer(this.config.projectSettings.pointLayerCentroid);
u&&(u.setDefinitionExpression(this._exsitingLabelPointDefExpression),u.refresh());this._filterAssets(!0)},_loadProjectAssetTable:function(){var u=new k;if(this.config.projectSettings.assetTable&&!this._projectAssetTable){var x=this.layerInfosObj.getTableInfoById(this.config.projectSettings.assetTable).layerObject;this._projectAssetTable=new m(x.url);this.own(l(this._projectAssetTable,"load",function(){u.resolve()}))}else u.resolve();return u.promise},_loadAdditionalCostTable:function(){var u;var x=
new k;(u=this.config.projectSettings.multiplierAdditionalCostTable)&&!this._additionalCostTable?(u=this.layerInfosObj.getTableInfoById(u).layerObject.url,this._additionalCostTable=new m(u),this.own(l(this._additionalCostTable,"load",function(){x.resolve()}))):x.resolve();return x.promise},onProjectCreateOrLoad:function(u,x){var H=[];this.projectInfo=u;this._displayLabelRelatedToSelectProject();H.push(this._loadProjectAssetTable());H.push(this._loadAdditionalCostTable());n(H).then(d.hitch(this,function(){var L,
Q,T;this.projectInfo=u;this._recentlyOperatedLayerIds=[];this._assetTableIds={};this._assetItemSummary={};this._assetGroupSummary={};this._disableWebMapPopup();this.initWorkBenchComponents().then(d.hitch(this,function(){T=this.config.projectSettings.projectLayer;this.projectInfo.projectId&&T&&(Q=this.layerInfosObj.getLayerInfoById(T).layerObject,L=Q.globalIdField+"\x3d '"+this.projectInfo.projectId+"'",this.filterManager.applyWidgetFilter(T,this.widgetId,L,!0,!0));this._projectOverview&&this._projectOverview.showAssetItemSummary(this._assetItemSummary,
!1);this._assetDetails&&this._assetDetails.reset();x?this.loadProject(x):(this._filterAssets(),this._projectSummary.addConfiguredAdditionalCostArray());0===Object.keys(this._assetItemSummary).length?g.add(this.downloadCSVBtn,"esriCTHidden"):g.remove(this.downloadCSVBtn,"esriCTHidden");var M=this.refreshButton,P=this.featureModeTextNode;"none"===this.downloadCSVBtn.style.display||g.contains(this.downloadCSVBtn,"esriCTHidden")||(M=this.downloadCSVBtn);g.contains(this.projectNameDiv,"esriCTHidden")||
(P=this.projectNameDiv);this.appUtils.setFirstAndLastWBFocusNode(this.widgetDomNode,P,M);this._handle508AccessibilityForTemplatePicker()}))}))},loadProject:function(u){var x=[];this._isLoadingProject=!0;this._projectSummary.loadingProject=!0;this._projectSummary.loadAdditionalCost(u.additionalCostInfo);for(var H in u.assetInfo){var L=u.assetInfo[H],Q=this.layerInfosObj.getLayerInfoById(H).layerObject;x=x.concat(L);this._loadAsset(Q,L,u,H)}this._setExtentToProjectAssets(x);this._recentlyOperatedLayerIds=
[];this._onAssetInfoUpdate();this._projectSummary.loadingProject=!1;this._projectSummary.calculateGrossCost(this._projectSummary.totalCost,!1)},_loadAsset:function(u,x,H,L){t.forEach(x,d.hitch(this,function(Q){var T=Q.attributes[u.globalIdField],M=H.assetTemplateInfo[T];Q.templateInfo=M;Q.templateName=M.TEMPLATENAME;this._templatePicker.loadCostingInfo(L,M);this._assetTableIds[T]=M.OBJECTID;this._onFeaturesAdded([Q],u,[M],!1)}))},_setExtentToProjectAssets:function(u){0<u.length&&this.map.setExtent(B.graphicsExtent(u).expand(1.5))},
initWorkBenchComponents:function(){var u=new k;this._initTemplatePicker();this._initProjectSummary();this._initProjectOverview();this._initAssetDetails(u);return u.promise},_initTemplatePicker:function(){var u=p.create("div",{},this.templatePickerContainer);this._templatePicker=new y({config:this.config,nls:this.nls,layerInfosObj:this.layerInfosObj,loadingIndicator:this.loadingIndicator,projectInfo:this.projectInfo,selectedProjectFeatureAttr:this.selectedProjectFeatureAttr?this.selectedProjectFeatureAttr:
null,map:this.map,selectFeaturesNode:this.copyFeaturesNode,selectButton:this.selectButton,sketchButton:this.sketchButton,appUtils:this.appUtils,widgetId:this.widgetId,widgetDomNode:this.widgetDomNode,refreshButton:this.refreshButton,downloadCSVBtn:this.downloadCSVBtn,projectNameDiv:this.projectNameDiv,featureModeTextNode:this.featureModeTextNode},u);l(this._templatePicker,"assetAdded",d.hitch(this,function(x,H,L){0<x.length&&0<L.length&&(this._onFeaturesAdded(x,H,L,!0),this.emit("onAssetAdded",x,
H.id,this._projectA),g.contains(this.downloadCSVBtn,"esriCTHidden")&&g.remove(this.downloadCSVBtn,"esriCTHidden"),this._onAssetInfoUpdate())}));l(this._templatePicker,"assetDeleted",d.hitch(this,function(x,H){var L=this._getGlobalIds(H.globalIdField,x);this._onFeaturesUpdated(x);0===Object.keys(this._assetItemSummary).length&&g.add(this.downloadCSVBtn,"esriCTHidden");this._onAssetInfoUpdate(!0);t.forEach(L,d.hitch(this,function(Q){this._assetTableIds.hasOwnProperty(Q)&&delete this._assetTableIds[Q];
this._assetInfoForReset&&this._assetInfoForReset[H.id]&&(Q=this._assetInfoForReset[H.id].indexOf(Q),-1<Q&&this._assetInfoForReset[H.id].splice(Q,1))}));this._projectAssetTable&&(x=this.config.assetTableFields.ASSETGUID+" in ('"+L.join("','")+"')",this.appUtils.deleteFeatures(this._projectAssetTable.url,x))}));l(this._templatePicker,"assetUpdated",d.hitch(this,function(x){this._onFeaturesUpdated(x,!0);this._onAssetInfoUpdate()}));l(this._templatePicker,"editorLoaded",d.hitch(this,function(){this._handle508AccessibilityForTemplatePicker()}));
this._templatePicker.startup()},_handle508AccessibilityForTemplatePicker:function(){setTimeout(d.hitch(this,function(){var u=A("div[role\x3d'grid']",this.templatePickerContainer);var x=A("[type\x3d'checkbox']",this.templatePickerContainer);var H=A("[dojoattachpoint\x3d'lastFocusNode']",this.templatePickerContainer);u&&u[0]&&w.set(u[0],"tabindex","-1");t.forEach(x,d.hitch(this,function(L){w.set(L,"tabindex","-1")}));H&&H[0]&&w.set(H[0],"tabindex","-1")}),500)},_initProjectSummary:function(){this._projectSummary?
this._projectSummary.reset(this.projectInfo):(this._projectSummary=new f({nls:this.nls,map:this.map,config:this.config,appUtils:this.appUtils,layerInfosObj:this.layerInfosObj,projectInfo:this.projectInfo,additionalCostTable:this._additionalCostTable,widgetDomNode:this.widgetDomNode},p.create("div",{},this.projectSummaryDiv)),this.own(l(this._projectSummary,"grossCostUpdated",d.hitch(this,function(u,x,H){this._projectOverview.grossCostUpdated(x);this._assetDetails.grossCostUpdated(u,x,H);this.emit("onGrossCostUpdated",
u,x,H)}))),this.own(l(this._projectSummary,"onOkButtonClicked",d.hitch(this,function(){this.emit("showAssetDetails")}))),this.own(l(this._projectSummary,"onCancelButtonClicked",d.hitch(this,function(){this.emit("showAssetDetails")}))),this._projectSummary.startup())},_initProjectOverview:function(){this._projectOverview?this._projectOverview.updateProjectInfo(this.projectInfo):(this._projectOverview=new G({config:this.config,appUtils:this.appUtils,nls:this.nls,map:this.map,layerInfosObj:this.layerInfosObj,
geometryService:new C(this.config.helperServices.geometry.url),projectInfo:this.projectInfo,widgetDomNode:this.widgetDomNode,projectNameDiv:this.projectNameDiv,selectButton:this.selectButton,featureModeTextNode:this.featureModeTextNode},p.create("div",{},this.projectOverview)),this.own(l(this._projectOverview,"actionClicked",d.hitch(this,function(u){this.emit("actionClicked",u)}))),this.own(l(this._projectOverview,"titleClicked",d.hitch(this,function(u){this.emit("titleClicked",u)}))),this.own(l(this._projectOverview,
"totalCostCalculated",d.hitch(this,function(u){this._assetDetails.totalCostUpdated(u);this._projectSummary.calculateGrossCost(u,!0)}))),this.own(l(this._projectOverview,"addOrModifyLabelPoint",d.hitch(this,function(u){this._addOrModifyLabelPoint(u.projectGeometry)}))),this._projectOverview.startup())},_initAssetDetails:function(u){this._assetDetails?(this._assetDetails.showAssetDetails({}),u.resolve()):(this._assetDetails=new b({nls:this.nls,map:this.map,config:this.config,appUtils:this.appUtils,
layerInfosObj:this.layerInfosObj,projectInfo:this.projectInfo,widgetDomNode:this.widgetDomNode},p.create("div",{},this.assetDetailsDiv)),this.own(l(this._assetDetails,"showAdditionalCost",d.hitch(this,function(){this._projectSummary&&this._projectSummary.cloneTableData();this.emit("showAdditionalCost")}))),this.own(l(this._assetDetails,"onOkButtonClicked",d.hitch(this,function(){this.emit("showWorkBenchPanel")}))),this.own(l(this._assetDetails,"onCancelButtonClicked",d.hitch(this,function(){this.emit("showWorkBenchPanel")}))),
this.own(l(this._assetDetails,"onLoad",d.hitch(this,function(){u.resolve()}))),this.own(l(this._assetDetails,"groupCostEquationUpdated",d.hitch(this,this._updateGroupCostEquation))),this._assetDetails.startup())},_createDownLoadData:function(){var u=[],x,H,L,Q;for(x in this._assetGroupSummary)for(H in this._assetGroupSummary[x])for(L in this._assetGroupSummary[x][H])for(Q in this._assetGroupSummary[x][H][L])this._assetGroupSummary[x][H][L][Q]&&0<this._assetGroupSummary[x][H][L][Q].length&&u.push(this._getReportAttributes(x,
this._assetGroupSummary[x][H][L][Q]));return{features:u,cols:this._reportColumns}},_getReportColumns:function(){t.forEach(this.config.generalSettings.CSVReportSettings.reportSettings,d.hitch(this,function(u){u.isVisible&&this._reportColumns.push(u.columnLabel||u.columnTitle)}))},_getReportAttributes:function(u,x){var H={};t.forEach(this.config.generalSettings.CSVReportSettings.reportSettings,d.hitch(this,function(L){L.isVisible&&(H[L.columnLabel||L.columnTitle]=this._fetchReportFieldTitleAndData(L,
u,x))}));return H},_getFeatureColumns:function(u){var x=[],H;for(H in u)x.push(H);return x},_fetchReportFieldTitleAndData:function(u,x,H){x=this.layerInfosObj.getLayerOrTableInfoById(x).layerObject;switch(u.fieldToMap){case "layerName":var L=x.name;break;case "TEMPLATENAME":case "GEOGRAPHY":case "SCENARIO":case "COSTEQUATION":L=H[0].templateInfo[u.fieldToMap]||"None";break;case "count":L=H.length;break;case "Length":L=this._getTotalAreaOrLength(x.geometryType,H,"length");break;case "Area":L=this._getTotalAreaOrLength(x.geometryType,
H,"area");break;case "cost":L=this._getTotalCostForRegion(H)}return L},_getTotalAreaOrLength:function(u,x,H){var L=0;"esriGeometryPolyline"===u?"length"===H&&t.forEach(x,d.hitch(this,function(Q){L+=Q.featureDimension})):"esriGeometryPolygon"===u&&"area"===H&&t.forEach(x,d.hitch(this,function(Q){L+=Q.featureDimension}));return 0===L?"NA":this.appUtils.applyRounding(L)},_getTotalCostForRegion:function(u){var x=0;t.forEach(u,d.hitch(this,function(H){x+=H.individualCost}));return this.appUtils.applyRounding(x)},
_onAssetInfoUpdate:function(u){this._projectOverview.showAssetItemSummary(this._assetItemSummary,!0);this._assetDetails.showAssetDetails(this._assetGroupSummary,u);this._filterAssets();this.emit("assetInfoUpdated",this._assetItemSummary)},_addAssetGroupSummary:function(u,x,H){var L=H[0].TEMPLATENAME;this._assetGroupSummary.hasOwnProperty(x.id)?this._assetGroupSummary[x.id].hasOwnProperty(L)||(this._assetGroupSummary[x.id][L]={}):(this._assetGroupSummary[x.id]={},this._assetGroupSummary[x.id][L]={});
t.forEach(u,d.hitch(this,function(Q,T){T=H[T];T.SCENARIO===this.nls.scenarioSelection.noneText&&(T.SCENARIO="null");T.GEOGRAPHY===this.nls.scenarioSelection.noneText&&(T.GEOGRAPHY="null");this._assetGroupSummary[x.id][L].hasOwnProperty(T.GEOGRAPHY)?this._assetGroupSummary[x.id][L][T.GEOGRAPHY].hasOwnProperty(T.SCENARIO)||(this._assetGroupSummary[x.id][L][T.GEOGRAPHY][T.SCENARIO]=[]):(this._assetGroupSummary[x.id][L][T.GEOGRAPHY]={},this._assetGroupSummary[x.id][L][T.GEOGRAPHY][T.SCENARIO]=[]);this._assetGroupSummary[x.id][L][T.GEOGRAPHY][T.SCENARIO].push(Q)}))},
_updateAssetGroupSummary:function(u,x,H){var L=x.templateInfo.TEMPLATENAME;var Q=x.templateInfo.GEOGRAPHY;var T=x.templateInfo.SCENARIO;var M=x.attributes[u.objectIdField];Q===this.nls.scenarioSelection.noneText&&(Q="null");T===this.nls.scenarioSelection.noneText&&(T="null");t.some(this._assetGroupSummary[u.id][L][Q][T],d.hitch(this,function(P,V){if(P.attributes[u.objectIdField]===M)return H?this._assetGroupSummary[u.id][L][Q][T][V].featureDimension=x.featureDimension:this._assetGroupSummary[u.id][L][Q][T].splice(V,
1),!0}))},_onFeaturesAdded:function(u,x,H,L){var Q=[];var T=H[0].TEMPLATENAME;Q=this._getGlobalIds(x.globalIdField,u);this._addAssetGroupSummary(u,x,H);this._assetItemSummary.hasOwnProperty(x.id)?this._assetItemSummary[x.id].templates.hasOwnProperty(T)?(u=this._assetItemSummary[x.id].templates[T].features.concat(u),this._assetItemSummary[x.id].templates[T].units=u.length):this._assetItemSummary[x.id].templates[T]={units:u.length,features:u,cost:null}:(this._assetItemSummary[x.id]={layerName:x.name,
templates:{},geometryType:x.geometryType},this._assetItemSummary[x.id].templates[T]={units:u.length,features:u,cost:null});this._recentlyOperatedLayerIds=[x.id];this._setFeaturesAndUnits(u,x,T);this._assetItemSummary[x.id].templates[T].cost=this._getTotalCost(x,T);L&&this._projectAssetTable?this._addAssetsToProjectAssetTable(H,Q):(this._assetInfoForReset||(this._assetInfoForReset={}),this._assetInfoForReset[x.id]=this._assetInfoForReset[x.id]?this._assetInfoForReset[x.id].concat(Q):d.clone(Q))},_updateFeaturesInfo:function(u){var x;
t.forEach(u,d.hitch(this,function(H){var L=H._layer;for(x in this._assetItemSummary[L.id].templates)this._setUpdatedTemplateFeatures(H,L,x)}));return u},_setUpdatedTemplateFeatures:function(u,x,H){t.some(this._assetItemSummary[x.id].templates[H].features,d.hitch(this,function(L){if(L.attributes[x.objectIdField]===u.attributes[x.objectIdField])return u.featureDimension=L.featureDimension,u.templateName=H,u.templateInfo=L.templateInfo,!0}))},_onFeaturesUpdated:function(u,x){u=this._updateFeaturesInfo(u);
this._recentlyOperatedLayerIds=[];t.forEach(u,d.hitch(this,function(H){var L=H.templateName;var Q=H._layer;this._recentlyOperatedLayerIds.push(Q.id);t.some(this._assetItemSummary[Q.id].templates[L].features,d.hitch(this,function(T,M){if(T.attributes[Q.objectIdField]===H.attributes[Q.objectIdField])return this._assetItemSummary.hasOwnProperty(Q.id)&&this._assetItemSummary[Q.id].templates[L]&&(x?(this._assetItemSummary[Q.id].templates[L].features[M]=H,this._setFeaturesAndUnits(this._assetItemSummary[Q.id].templates[L].features,
Q,L,x)):(T=this._assetItemSummary[Q.id].templates[L].units,T-=H.featureDimension,this._assetItemSummary[Q.id].templates[L].units=this.appUtils.removeNegativeExponents(T)),this._updateAssetGroupSummary(Q,H,x)),x||this._assetItemSummary[Q.id].templates[L].features.splice(M,1),!0}));0===this._assetItemSummary[Q.id].templates[L].features.length?delete this._assetItemSummary[Q.id].templates[L]:this._assetItemSummary[Q.id].templates[L].cost=this._getTotalCost(Q,L);0===Object.keys(this._assetItemSummary[Q.id].templates).length&&
delete this._assetItemSummary[Q.id]}))},_setFeaturesAndUnits:function(u,x,H,L){var Q=0;var T=this.config.generalSettings.measurementUnit;t.forEach(u,d.hitch(this,function(M){if(!M.hasOwnProperty("featureDimension")||L)M.featureDimension="esriGeometryPolygon"===x.geometryType?this.appUtils.getAreaOfGeometry(M.geometry,this.appUtils.units[T].areaUnit):"esriGeometryPolyline"===x.geometryType?this.appUtils.getLengthOfGeometry(M.geometry,this.appUtils.units[T].lengthUnit):1,L||(M.templateName=H);Q+=M.featureDimension}));
this._assetItemSummary[x.id].templates[H].features=u;return this._assetItemSummary[x.id].templates[H].units=Q},_getGroupTotalMeasure:function(u,x){var H=0;var L=x.TEMPLATENAME;var Q=x.GEOGRAPHY;x=x.SCENARIO;try{var T=this._assetGroupSummary[u][L][Q][x];t.forEach(T,d.hitch(this,function(M){H+=M.featureDimension}))}catch(M){H=0}return H},_getGroupTotalCount:function(u,x){var H;var L=0;var Q=x.TEMPLATENAME;var T=x.GEOGRAPHY;x=x.SCENARIO;try{(H=this._assetGroupSummary[u][Q][T][x])&&0<H.length&&(L=H.length)}catch(M){L=
0}return L},_getTotalCost:function(u,x){var H=0;t.forEach(this._assetItemSummary[u.id].templates[x].features,d.hitch(this,function(L){var Q=this._getGroupTotalMeasure(u.id,L.templateInfo);var T=this._getGroupTotalCount(u.id,L.templateInfo);try{var M=L.templateInfo.COSTEQUATION;M=M.replace(/{MEASURE}/ig,L.featureDimension);M=M.replace(/{TOTALMEASURE}/ig,Q);M=M.replace(/{TOTALCOUNT}/ig,T);var P=this.appUtils.evaluate(M)}catch(V){P=0}t.some(this._assetGroupSummary[u.id][x][L.templateInfo.GEOGRAPHY][L.templateInfo.SCENARIO],
d.hitch(this,function(V){if(V.attributes[u.objectIdField]===L.attributes[u.objectIdField])return V.individualCost=P,!0}));L.individualCost=P;H+=P}));return Number(H)},_getGlobalIds:function(u,x){var H=[];t.forEach(x,d.hitch(this,function(L){H.push(L.attributes[u])}));return H},_getExpressionToFilterAssets:function(u){var x,H=[],L;if((L=this.layerInfosObj.getLayerInfoById(u))&&L.layerObject&&this._assetItemSummary[u]){var Q=L.layerObject;for(x in this._assetItemSummary[u].templates)H=H.concat(this._getGlobalIds(Q.globalIdField,
this._assetItemSummary[u].templates[x].features))}return 0<H.length?Q.globalIdField+" in ('"+H.join("','")+"')":"1\x3d2"},_filterAssets:function(u){this._recentlyOperatedLayerIds&&0!==this._recentlyOperatedLayerIds.length||(this._recentlyOperatedLayerIds=[],t.forEach(this.config.layerSettings,d.hitch(this,function(x){x.editable&&this._recentlyOperatedLayerIds.push(x.id)})));t.forEach(this._recentlyOperatedLayerIds,d.hitch(this,function(x){var H="";u||(H=this._getExpressionToFilterAssets(x));this.filterManager.applyWidgetFilter(x,
this.widgetId,H,!0,!0)}))},_addAssetsToProjectAssetTable:function(u,x){var H=[],L=["COSTEQUATION","SCENARIO","TEMPLATENAME","GEOGRAPHYGUID"];this.loadingIndicator.show();t.forEach(x,d.hitch(this,function(Q,T){var M={};t.forEach(this._projectAssetTable.fields,d.hitch(this,function(P){var V="";-1<L.indexOf(P.name.toUpperCase())?(V=u[T][P.name.toUpperCase()],"SCENARIO"!==P.name.toUpperCase()&&"GEOGRAPHYGUID"!==P.name.toUpperCase()||"null"!==V||(V=null),M[P.name]=V):"ASSETGUID"===P.name.toUpperCase()?
M[P.name]=Q:"PROJECTGUID"===P.name.toUpperCase()&&this.projectInfo.projectId&&(M[P.name]=this.projectInfo.projectId)}));H.push(new h(null,null,M))}));this._projectAssetTable.applyEdits(H,null,null,d.hitch(this,function(Q){var T=!1;t.forEach(Q,d.hitch(this,function(M,P){M.success?this._assetTableIds[x[P]]=M.objectId:T=!0}));T&&this.appUtils.showMessage(this.nls.workBench.errorInSavingAssetDetails);this.loadingIndicator.hide()}),d.hitch(this,function(){this.loadingIndicator.hide();this.appUtils.showMessage(this.nls.workBench.errorInSavingAssetDetails)}))},
_updateGroupCostEquation:function(u){var x=[];var H=u.groupInfo;var L=this._assetGroupSummary[H.layerId][H.templateName][H.region][H.scenario];var Q=this.layerInfosObj.getLayerInfoById(H.layerId).layerObject;t.forEach(L,d.hitch(this,function(T){var M={};var P=T.attributes[Q.globalIdField];var V=T.attributes[Q.objectIdField];t.some(this._assetItemSummary[H.layerId].templates[H.templateName].features,d.hitch(this,function(X){if(X.attributes[Q.objectIdField]===V)return X.templateInfo.COSTEQUATION=u.templateInfo.COSTEQUATION,
X.templateInfo.SCENARIO=u.templateInfo.SCENARIO,!0}));T.templateInfo.COSTEQUATION=u.templateInfo.COSTEQUATION;T.templateInfo.SCENARIO=u.templateInfo.SCENARIO;this._projectAssetTable&&this._assetTableIds[P]&&(M[this.config.assetTableFields.COSTEQUATION]=u.templateInfo.COSTEQUATION,M[this.config.assetTableFields.SCENARIO]="null"===u.templateInfo.SCENARIO?null:u.templateInfo.SCENARIO,M[this.config.assetTableFields.OBJECTID]=this._assetTableIds[P],x.push(new h(null,null,M)))}));delete this._assetGroupSummary[H.layerId][H.templateName][H.region][H.scenario];
this._assetGroupSummary[H.layerId][H.templateName][H.region][u.templateInfo.SCENARIO]=L;this._templatePicker.loadCostingInfo(Q.id,L[0].templateInfo);this._assetItemSummary[Q.id].templates[H.templateName].cost=this._getTotalCost(Q,H.templateName);this._projectOverview.showAssetItemSummary(this._assetItemSummary,!1);this._assetDetails.showAssetDetails(this._assetGroupSummary);this._projectAssetTable&&(this.loadingIndicator.show(),this._projectAssetTable.applyEdits(null,x,null,d.hitch(this,function(){this.loadingIndicator.hide()}),
d.hitch(this,function(){this.loadingIndicator.hide()})))},_enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1);this._hideWebMapPopup()},_hideWebMapPopup:function(){this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.map.infoWindow.clearFeatures()},_addOrModifyLabelPoint:function(u){this.loadingIndicator.show();""!==this.config.projectSettings.pointLayerCentroid&&null!==this.config.projectSettings.pointLayerCentroid&&
void 0!==this.config.projectSettings.pointLayerCentroid?this._isLoadingProject?this._displayLabelRelatedToSelectProject():this._checkExistingLabelPoint(u):this.loadingIndicator.hide()},_displayLabelRelatedToSelectProject:function(){if(this._pointLayer=this.map.getLayer(this.config.projectSettings.pointLayerCentroid)){var u=this._pointLayer.getDefinitionExpression(),x=this._getFieldName(this._pointLayer,"projectid")+" \x3d '"+this.projectInfo.projectId+"'";""!==u&&null!==u&&void 0!==u?-1===u.indexOf(x)&&
(u=u+" AND "+x):u=x;this._pointLayer.setDefinitionExpression(u);this._pointLayer.refresh()}this._isLoadingProject=!1;this.loadingIndicator.hide()},_checkExistingLabelPoint:function(u){var x={},H;x.existingLabelPoint=this._getExistingLabelPointDeferred();n(x).then(d.hitch(this,function(L){0<L.existingLabelPoint.features.length?this._createLabelPoint(!1,u,L.existingLabelPoint.features[0]):this._createLabelPoint(!0,u)}),d.hitch(this,function(){this.loadingIndicator.hide();H=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel);
this._handleShowDialogClosed(H)}))},_createLabelPoint:function(u,x,H){var L;if(0<x.rings.length){var Q=new C(this.config.helperServices.geometry.url);x=F.simplify(x);Q.labelPoints([x],d.hitch(this,function(T){this.config.projectSettings.pointLayerCentroid&&(T=T[0],u?this._addLabelPoint(T):this._updateExistingLabelPoint(H,T))}),d.hitch(this,function(){this.loadingIndicator.hide();L=this.appUtils.showMessage(this.nls.createLoadProject.errorFetchingPointLabel);this._handleShowDialogClosed(L)}))}else this._deleteExistingLabelPoint(H)},
_deleteExistingLabelPoint:function(u){var x;if(u){var H={};H[this._pointLayer.objectIdField]=u.attributes[this._pointLayer.objectIdField];var L=new h(null,null,H,null),Q=new m(this._pointLayer.url,{outFields:["*"]});Q.onLoad=d.hitch(this,function(){Q.applyEdits(null,null,[L],d.hitch(this,function(T,M,P){P[0].success||(x=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel),this._handleShowDialogClosed(x));this.map.getLayer(this.config.projectSettings.pointLayerCentroid).refresh();
this.loadingIndicator.hide()}),d.hitch(this,function(){this.loadingIndicator.hide();x=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel);this._handleShowDialogClosed(x)}))})}else this.loadingIndicator.hide()},_getExistingLabelPointDeferred:function(){var u=this._getFieldName(this._pointLayer,"projectid")+" \x3d '"+this.projectInfo.projectId+"'";var x=new D(this._pointLayer.url),H=new c;H.outFields=["*"];H.where=u;H.returnGeometry=!0;H.outSpatialReference=this.map.spatialReference;
return x.execute(H).promise},_getFieldName:function(u,x){var H;t.forEach(u.fields,d.hitch(this,function(L){L.name.toLowerCase()===x.toLowerCase()&&(H=L.name)}));return H},_addLabelPoint:function(u){var x=new N(u.x,u.y,new R({wkid:this.map.spatialReference.wkid}));u=this._pointLayer.hasOwnProperty("templates")&&0<this._pointLayer.templates.length&&this._pointLayer.templates[0].hasOwnProperty("prototype")&&this._pointLayer.templates[0].prototype.hasOwnProperty("attributes")?this._pointLayer.templates[0].prototype.attributes:
this._pointLayer.hasOwnProperty("types")&&0<this._pointLayer.types.length&&this._pointLayer.types[0].hasOwnProperty("templates")&&0<this._pointLayer.types[0].templates.length&&this._pointLayer.types[0].templates[0].hasOwnProperty("prototype")&&this._pointLayer.types[0].templates[0].prototype.hasOwnProperty("attributes")?this._pointLayer.types[0].templates[0].prototype.attributes:null;null===this._originalTemplateAttributes||""===this._originalTemplateAttributes||void 0===this._originalTemplateAttributes?
this._originalTemplateAttributes=d.clone(u):u=d.clone(this._originalTemplateAttributes);var H=this._getFieldName(this._pointLayer,"projectid");u[H]=this.projectInfo.projectId;u=new h(x,null,u,null);(new m(this._pointLayer.url)).applyEdits([u],null,null,d.hitch(this,function(L,Q,T){L[0].success||(L=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel),this._handleShowDialogClosed(L));this.map.getLayer(this.config.projectSettings.pointLayerCentroid).refresh();this.loadingIndicator.hide()}),
d.hitch(this,function(){this.loadingIndicator.hide();var L=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel);this._handleShowDialogClosed(L)}))},_updateExistingLabelPoint:function(u,x){var H={};H[this._pointLayer.objectIdField]=u.attributes[this._pointLayer.objectIdField];u=new N(x.x,x.y,new R({wkid:this.map.spatialReference.wkid}));var L=new h(u,null,H,null),Q=new m(this._pointLayer.url,{outFields:["*"]});Q.onLoad=d.hitch(this,function(){Q.applyEdits(null,[L],null,d.hitch(this,
function(T,M,P){M[0].success||(T=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel),this._handleShowDialogClosed(T));this.map.getLayer(this.config.projectSettings.pointLayerCentroid).refresh();this.loadingIndicator.hide()}),d.hitch(this,function(){this.loadingIndicator.hide();var T=this.appUtils.showMessage(this.nls.createLoadProject.errorAddingPointLabel);this._handleShowDialogClosed(T)}))})},updateProjectFeatureAttributes:function(u){this._templatePicker.selectedProjectFeatureAttr=
u},_storeExistingLabelPointLayerDefExpression:function(){var u=this.map.getLayer(this.config.projectSettings.pointLayerCentroid);u&&(u=u.getDefinitionExpression(),this._exsitingLabelPointDefExpression=d.clone(u))},_handleShowDialogClosed:function(u){(u=u.enabledButtons[0])&&this.own(l(u,"keydown",d.hitch(this,function(x){if(x.keyCode===r.ENTER||x.keyCode===r.SPACE)E.stop(x),g.contains(this.sketchButton,"esriCTSketchDisable")?q.focus(this.selectButton):q.focus(this.sketchButton)})))},_downLoadCSV:function(u){var x=
this._getCSVFileName();z.exportCSV(x,u.features,u.cols)},_getCSVFileName:function(){var u="AssetItemDetails";this.config.generalSettings.CSVReportSettings.reportName?u=this.config.generalSettings.CSVReportSettings.reportName:this.projectInfo&&this.projectInfo.name&&(u="Export-"+this.projectInfo.name);return u}})})},"widgets/CostAnalysis/template-picker":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./template-picker.html dojo/_base/array dojo/_base/lang dojo/on dojo/Deferred dojo/dom-class dojo/dom-construct esri/dijit/editing/Editor esri/tasks/GeometryService dojo/_base/html jimu/dijit/Popup jimu/dijit/Message dojo/keys esri/geometry/geometryEngine ./scenario-selection esri/SpatialReference esri/geometry/Polyline esri/geometry/Polygon esri/tasks/query esri/tasks/QueryTask esri/graphic esri/layers/FeatureLayer esri/toolbars/draw ./copy-features dojo/dom-attr dijit/focus dojo/_base/event jimu/utils".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R,N,r,E){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-template-picker",_projectOverview:null,_templatePicker:null,_editor:null,_scenarioSelectionObj:null,_selectScenarioPopup:null,_isFeatureIntersected:null,_configuredTemplateObj:[],_configuredGeographyCostEquation:{},_onBeforeEditCompleteResult:{},_templateInfoCalculated:!1,_addFeaturesEventInfo:[],_windowResizeTimer:null,selectedTemplateInfo:{},_splitAssetsArr:[],
_currentAssetSplitGeometry:null,_nonEditableLayers:[],_splitAssetInfo:[],_allIntersectedRegions:[],_selectedTemplate:null,_featuresToBeCopied:[],_layerEvents:[],_copyFeaturesObj:null,_layersForEditor:[],postCreate:function(){this.inherited(arguments);this._isFeatureIntersected=this._selectScenarioPopup=this._scenarioSelectionObj=this._editor=this._templatePicker=this._projectOverview=null;this._configuredTemplateObj=[];this._configuredGeographyCostEquation={};this.selectedTemplateInfo={};this._onBeforeEditCompleteResult=
{};this._addFeaturesEventInfo=[];this._splitAssetsArr=[];this._currentAssetSplitGeometry=null;this._nonEditableLayers=[];this._splitAssetInfo=[];this._windowResizeTimer=null;this._allIntersectedRegions=[];this._selectedTemplate=null;this._featuresToBeCopied=[];this._layerEvents=[];this._copyFeaturesObj=null;this._layersForEditor=[]},startup:function(){this.inherited(arguments);this._getLayersForSelection();a(window,"resize",d.hitch(this,this.onWindowResize));this.own(a(this.sketchButton,"click",d.hitch(this,
function(){t.contains(this.sketchButton,"esriCTSketchEnable")||(this._toolBarActive=!0,this._activateSketchButton(),this._deActivateSelectButton());this._toggleToolState()})));this.own(a(this.sketchButton,"keydown",d.hitch(this,function(q){if(q.keyCode===n.ENTER||q.keyCode===n.SPACE)t.contains(this.sketchButton,"esriCTSketchEnable")||(this._toolBarActive=!0,this._activateSketchButton(),this._deActivateSelectButton()),this._toggleToolState()})));this.own(a(this.selectButton,"click",d.hitch(this,function(){t.contains(this.selectButton,
"esriCTSelectEnable")||(this._toolBarActive=!1,this._activateSelectButton(),this._deActivateSketchButton());this._toggleToolState()})));this.own(a(this.selectButton,"keydown",d.hitch(this,function(q){if(q.keyCode===n.ENTER||q.keyCode===n.SPACE)t.contains(this.selectButton,"esriCTSelectEnable")||(this._toolBarActive=!1,this._activateSelectButton(),this._deActivateSketchButton()),this._toggleToolState()})))},destroy:function(){this._deactivateAllTools();this.removeLayerEvents();this._configuredGeographyCostEquation=
{};this._editor&&(this._editor.destroy(),this._editor=null);this._copyFeaturesObj&&(this._copyFeaturesObj.destroy(),this._copyFeaturesObj=null);this.inherited(arguments)},loadCostingInfo:function(q,u){var x=u.GEOGRAPHYGUID;var H=u.TEMPLATENAME;this._configuredGeographyCostEquation.hasOwnProperty(x)?this._configuredGeographyCostEquation[x].hasOwnProperty(q)?this._configuredGeographyCostEquation[x][q].hasOwnProperty(H)?this._configuredGeographyCostEquation[x]&&this._configuredGeographyCostEquation[x][q]&&
this._configuredGeographyCostEquation[x][q][H]&&(this._configuredGeographyCostEquation[x][q][H].COSTEQUATION=u.COSTEQUATION):this._configuredGeographyCostEquation[x][q][H]=u:(this._configuredGeographyCostEquation[x][q]={},this._configuredGeographyCostEquation[x][q][H]=u):(this._configuredGeographyCostEquation[x]={},this._configuredGeographyCostEquation[x][q]={},this._configuredGeographyCostEquation[x][q][H]=u)},onWindowResize:function(){this._windowResizeTimer&&clearTimeout(this._windowResizeTimer);
this._windowResizeTimer=setTimeout(d.hitch(this,this.resize),500)},_getLayersForSelection:function(){var q,u,x=[];this._layersForEditor=null;this._getConfiguredTemplates();e.forEach(this.config.layerSettings,d.hitch(this,function(H){if(H.editable||H.selectable)if(q=this.map.getLayer(H.id)){u=this._getLayerSettingsById(H.id);if(u.selectedField)var L=u.selectedField;(q=this._filterLayerTemplates(q,L))&&x.push({featureLayer:q,disableAttributeUpdate:!H.editable,disableGeometryUpdate:!H.editable,editable:H.editable});
H.editable||this._nonEditableLayers.push(H.id)}}));setTimeout(d.hitch(this,function(){this._layersForEditor=x;this._editor||this.initEditingToolbar()}),500)},_getLayerSettingsById:function(q){var u={};e.some(this.config.layerSettings,d.hitch(this,function(x){if(x.id===q)return u=x,!0}));return u},_filterLayerTemplates:function(q,u){var x,H;for(H in this.config.costingInfoSettings)0<this.config.costingInfoSettings[H].length&&(x=this.layerInfosObj.getLayerInfoById(H))&&x.layerObject&&x.layerObject.url===
q.url&&(0<q.templates.length?q.templates=this._setConfiguredTemplates(q.templates,H,u):q.types=this._setConfiguredTemplates(q.types,H,u));return q},_setConfiguredTemplates:function(q,u,x){var H=[];for(var L=q.length-1;0<=L;L--){var Q=q[L].templates?q[L].templates[0].name:q[L].name;Q=this._configuredTemplateObj[u].indexOf(Q);-1!==Q&&(x&&("templates"in q[L]?q[L].templates[0].prototype.attributes[x]=this.projectInfo.projectId:q[L].prototype.attributes[x]=this.projectInfo.projectId),H.push(q[L]))}return H},
_getConfiguredTemplates:function(){for(var q in this.config.costingInfoSettings)this._getConfiguredTemplateNameArray(q)},_getConfiguredTemplateNameArray:function(q){e.forEach(this.config.costingInfoSettings[q],d.hitch(this,function(u){this._configuredTemplateObj[q]||(this._configuredTemplateObj[q]=[]);this._configuredTemplateObj[q].push(u.featureTemplate)}))},initEditingToolbar:function(){if(null!==this._layersForEditor){var q=this._layersForEditor?this._layersForEditor:[];q={settings:{map:this.map,
geometryService:new A(this.config.helperServices.geometry.url),layerInfos:q,toolbarVisible:!1,showAttributesOnClick:!0,toolbarOptions:{reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},createOptions:{polylineDrawTools:[l.CREATE_TOOL_POLYLINE,l.CREATE_TOOL_FREEHAND_POLYLINE],polygonDrawTools:[l.CREATE_TOOL_POLYGON,l.CREATE_TOOL_RECTANGLE,l.CREATE_TOOL_CIRCLE,l.CREATE_TOOL_FREEHAND_POLYGON]},showTooltip:!1}};this._editor=new l(q,g.create("div",{},this.editorToolbarNode));this.own(a(this._editor,"load",
d.hitch(this,function(){this.emit("editorLoaded")})));this._editor.startup();this.bindLayerEvents();this._editor.templatePicker.showTooltip=!0;q=e.filter(this._editor.templatePicker.featureLayers,d.hitch(this,function(u){return-1===this._nonEditableLayers.indexOf(u.id)}));this._editor.templatePicker.featureLayers=q;this.templatePickerNode&&this._editor.templatePicker.placeAt(this.templatePickerNode);this.own(a(this._editor.templatePicker,"selection-change",d.hitch(this,function(){var u;if(u=this._editor.templatePicker.getSelected())this._selectedTemplate=
u;t.contains(this.selectButton,"esriCTSelectDisable")||this._activateCustomSelectTool()})));this.own(a(this._editor.editToolbar,"deactivate",d.hitch(this,function(){this.emit("editEnd")})));this.own(a(this._editor.editToolbar,"activate",d.hitch(this,function(){this.emit("editStart")})));this.customToolbar||this._createCustomSelectTool();setTimeout(d.hitch(this,this.resize,100))}},_displayCopyAssetsPopup:function(){this._copyFeaturesDialog=new k({message:this.nls.scenarioSelection.copyFeatureMsg,type:"question",
maxWidth:375,buttons:[{label:this.nls.common.yes,onClick:d.hitch(this,function(){this._copyFeaturesDialog.close();this._copyFeaturesObj.cancelBtnClicked();this._selectedTemplate&&this._copyFeature()})},{label:this.nls.common.no,onClick:d.hitch(this,function(){this._copyFeaturesDialog.close()})}]});var q=this._copyFeaturesDialog.enabledButtons;this.own(a(q[0],"keydown",d.hitch(this,function(u){if(u.keyCode===n.ENTER||u.keyCode===n.SPACE)r.stop(u),this._copyFeaturesObj.toggleWorkBenchDOMTabindexes("0"),
E.initFirstFocusNode(this.widgetDomNode,this.featureModeTextNode),E.initLastFocusNode(this.widgetDomNode,this.refreshButton),N.focus(this.featureModeTextNode)})));this.own(a(q[1],"keydown",d.hitch(this,function(u){if(u.keyCode===n.ENTER||u.keyCode===n.SPACE)r.stop(u),this._copyFeaturesObj.toggleWorkBenchDOMTabindexes("-1"),this._copyFeaturesObj._setFirstAndLastFocusNodes()})))},_copyFeature:function(){if(this._selectedTemplate){var q=new z(this._featuresToBeCopied.shift());this._selectedTemplate.featureLayer.applyEdits([q])}},
_onCancelBtnClicked:function(){},_addCustomApplyEdits:function(){this._editor&&this._editor.settings&&this._editor.settings.layers&&e.forEach(this._editor.settings.layers,d.hitch(this,function(q){q.myApplyEdits=q.applyEdits;var u=this;q.applyEdits=function(x,H,L){x&&0!==x.length?u._selectedTemplate&&(u._orgFeature=x[0],u._checkAssetIntersection()):q.myApplyEdits(x,H,L);var Q=new w;setTimeout(function(){Q.resolve(!0)},100);return Q}}))},removeLayerEvents:function(){this._editor&&this._editor.settings&&
this._editor.settings.layers&&e.forEach(this._editor.settings.layers,d.hitch(this,function(q){q.myApplyEdits&&(q.applyEdits=q.myApplyEdits,delete q.myApplyEdits)}));this._layerEvents&&0<this._layerEvents.length&&(e.forEach(this._layerEvents,d.hitch(this,function(q){q[0].remove()})),this._layerEvents=[]);this._copyFeaturesObj&&this._copyFeaturesObj.cancelBtnClicked()},bindLayerEvents:function(){this.removeLayerEvents();this._addCustomApplyEdits();this._editor&&this._editor.settings&&this._editor.settings.layers&&
0<this._editor.settings.layers.length&&e.forEach(this._editor.settings.layers,d.hitch(this,function(q){var u=this.own(a(q,"before-apply-edits",d.hitch(this,this.onBeforeEditComplete)));var x=this.own(a(q,"edits-complete",d.hitch(this,this.onEditCompletes)));this._layerEvents.push(u);this._layerEvents.push(x);-1<this._nonEditableLayers.indexOf(q.id)&&(u=this.own(a(q,"selection-complete",d.hitch(this,function(H){H.features.length&&this._editor&&this._editor.drawingToolbar&&this._editor.drawingToolbar._tools&&
t.add(this._editor.drawingToolbar._tools.DELETE.domNode,"esriCTHidden")}))),q=this.own(a(q,"selection-clear",d.hitch(this,function(){this._editor&&this._editor.drawingToolbar&&this._editor.drawingToolbar._tools&&t.remove(this._editor.drawingToolbar._tools.DELETE.domNode,"esriCTHidden")}))),this._layerEvents.push(u),this._layerEvents.push(q))}))},onBeforeEditComplete:function(q){this._editor.attributeInspector.focused&&(q.deletes&&0===q.deletes.length||q.updates&&0<q.updates.length)||(this.loadingIndicator.show(),
this._onBeforeEditCompleteResult[q.target.id]||(this._onBeforeEditCompleteResult[q.target.id]=[]),this._onBeforeEditCompleteResult[q.target.id].push(q))},onEditCompletes:function(q){this._editor.attributeInspector.focused&&(q.deletes&&0===q.deletes.length||q.updates&&0<q.updates.length)||(q=this._getSucceededFeatures(q,q.target.id),this.loadingIndicator.hide(),q.deletes&&0<q.deletes.length&&this.deleteFeatures(q.deletes,q.target),q.adds&&0<q.adds.length&&this.addFeatures(q.adds,q.target),q.updates&&
0<q.updates.length&&this.editFeatures(q.updates))},_getSucceededFeatures:function(q,u){e.forEach(q.adds,d.hitch(this,function(x,H){x.success||(this._onBeforeEditCompleteResult[u][0].adds.splice(H,1),this._splitAssetInfo.splice(H,1))}));e.forEach(q.updates,d.hitch(this,function(x,H){x.success||(this._onBeforeEditCompleteResult[u][0].updates.splice(H,1),this._splitAssetInfo.splice(H,1))}));e.forEach(q.deletes,d.hitch(this,function(x,H){x.success||(this._onBeforeEditCompleteResult[u][0].deletes.splice(H,
1),this._splitAssetInfo.splice(H,1))}));return this._onBeforeEditCompleteResult[u].shift()},addFeatures:function(q,u){e.forEach(this._splitAssetInfo,d.hitch(this,function(x,H){delete x.ASSETGEOMETRY;q[H].templateInfo=x;q[H].templateName=x.TEMPLATENAME}));this.emit("assetAdded",q,u,this._splitAssetInfo);this._orgFeature=null;0<this._featuresToBeCopied.length&&this._copyFeature()},editFeatures:function(q){this.emit("assetUpdated",q)},deleteFeatures:function(q,u){this.emit("assetDeleted",q,u)},_polygonToPolyline:function(q){var u,
x;var H=[];var L=new y(new B(q.spatialReference));for(x=0;x<q.rings.length;x++){var Q=[];for(u=0;u<q.rings[x].length;u++)Q.push(q.rings[x][u]);L.addPath(Q)}H.push(L);return H},_getSplitFeatureGeometries:function(q,u){var x;var H=[];var L=[];if(0<u.length){"polyline"===q.geometry.type?x=!0:"polygon"===q.geometry.type&&(x=!1);e.forEach(u,d.hitch(this,function(T){H.push(T.geometry)}));u=m.union(H);u=this._polygonToPolyline(u)[0];var Q=q.geometry;u=m.cut(Q,u);1<u.length?(L.push({geometry:u[0],isIntersectedGeometry:!1}),
x?e.forEach(u,d.hitch(this,function(T,M){0<M&&e.forEach(T.paths,d.hitch(this,function(P){var V=new y(new B(q.geometry.spatialReference));V.addPath(P);L.push({geometry:V,isIntersectedGeometry:!0})}))})):e.forEach(u,d.hitch(this,function(T,M){0<M&&e.forEach(T.rings,d.hitch(this,function(P){var V=new G(new B(q.geometry.spatialReference));V.addRing(P);L.push({geometry:V,isIntersectedGeometry:!0})}))}))):L.push({geometry:q.geometry,isIntersectedGeometry:!0})}else L.push({geometry:q.geometry,isIntersectedGeometry:!1});
return L},_checkAssetIntersection:function(){this._intersectedCostingGraphicArr=[];this._allIntersectedRegions=[];this._splitAssetInfo=[];this.selectedTemplateInfo={};this._getIntersectedCostingGraphicArr(this._orgFeature).then(d.hitch(this,function(q){var u;if(u=m.simplify(this._orgFeature.geometry))this._orgFeature.geometry=u,this._allIntersectedRegions=d.clone(q),this._intersectedCostingGraphicArr=q,this.config.projectSettings.costingGeometryLayer?"point"===this._orgFeature.geometry.type?this._splitAssetsArr.push({geometry:this._orgFeature.geometry,
isIntersectedGeometry:0<q.length}):this._splitAssetsArr=this._getSplitFeatureGeometries(this._orgFeature,this._intersectedCostingGraphicArr):this._splitAssetsArr.push({geometry:this._orgFeature.geometry,isIntersectedGeometry:0<q.length}),this._processOverlappingGeometries()}))},_getIntersectedCostingGraphicArr:function(q){var u=new w;if(this.config.projectSettings.costingGeometryLayer){var x=new f;var H=this.map.getLayer(this.config.projectSettings.costingGeometryLayer);var L=new b(H.url);H.getDefinitionExpression()&&
(x.where=H.getDefinitionExpression());q.geometry?(x.outSpatialReference=q.geometry.spatialReference,x.returnGeometry=!0,x.outFields=["*"],x.geometry=q.geometry,L.execute(x,d.hitch(this,function(Q){var T=[];Q&&0<Q.features.length&&(T=Q.features);u.resolve(T)}),d.hitch(this,function(){u.resolve([])}))):setTimeout(d.hitch(this,function(){u.resolve([])}),0)}else u.resolve([]);return u.promise},_processOverlappingGeometries:function(){var q=[],u=[],x=[],H=[];0<this._splitAssetsArr.length&&(e.forEach(this._splitAssetsArr,
d.hitch(this,function(L){L.isIntersectedGeometry?(L=this._splitForOverlappingGeometries(L),0<L.processed.length&&(q=q.concat(L.processed)),0<L.unProcessed.length&&(u=u.concat(L.unProcessed))):q.push(L)})),this._splitAssetsArr=[],this._splitAssetsArr=q);e.forEach(u,d.hitch(this,function(L){L=this._splitForOverlappingGeometries(L,!0);0<L.processed.length&&(x=x.concat(L.processed));0<L.unProcessed.length&&(H=H.concat(L.unProcessed))}));this._splitAssetsArr=this._splitAssetsArr.concat(x);this._deleteDuplicateSplits();
this._displayPopupForAssets()},_deleteDuplicateSplits:function(){var q=[];e.forEach(this._splitAssetsArr,d.hitch(this,function(u,x){if(0>q.indexOf(x))for(x+=1;x<this._splitAssetsArr.length;x++)m.equals(u.geometry,this._splitAssetsArr[x].geometry)&&q.push(x)}));0<q.length&&(q.sort(function(u,x){return u-x}),e.forEach(q,d.hitch(this,function(u,x){this._splitAssetsArr.splice(u-x,1)})))},isLineValid:function(q){return q.paths&&1===q.paths.length&&2===q.paths[0].length&&q.paths[0][0][0]===q.paths[0][1][0]&&
q.paths[0][0][1]===q.paths[0][1][1]?!1:!0},_splitForOverlappingGeometries:function(q,u){var x=[],H=[],L=[],Q=!1;e.forEach(this._allIntersectedRegions,d.hitch(this,function(P){m.intersects(q.geometry,P.geometry)&&L.push(P)}));e.forEach(L,d.hitch(this,function(P){m.contains(P.geometry,q.geometry)&&(Q=!0)}));if(Q)x.push(q);else{var T=q.geometry,M=L.length;e.forEach(L,d.hitch(this,function(P,V){P=this._polygonToPolyline(P.geometry)[0];P=m.cut(T,P);if(1<P.length)for(T=P[0],V=1;V<P.length;V++)1===V&&this.isLineValid(P[V])?
x.push({geometry:P[V],isIntersectedGeometry:!0}):H.push({geometry:P[V],isIntersectedGeometry:!0});else 0<P.length?this.isLineValid(P[0])&&x.push({geometry:P[0],isIntersectedGeometry:!0}):u?this.isLineValid(T)&&x.push({geometry:T,isIntersectedGeometry:!0}):V===M-1&&H.push({geometry:T,isIntersectedGeometry:!0})}))}return{processed:x,unProcessed:H}},_displayPopupForAssets:function(){this.map.getLayer(this.config.projectSettings.costingGeometryLayer);if(0<this._splitAssetsArr.length){var q=this._splitAssetsArr.pop(0);
this._currentAssetSplitGeometry=q.geometry;this._intersectedCostingGraphicArr=[];var u=!1;q.isIntersectedGeometry&&e.forEach(this._allIntersectedRegions,d.hitch(this,function(H){m.contains(H.geometry,q.geometry)&&(this._intersectedCostingGraphicArr.push(H),u=!0)}));if(1<this._intersectedCostingGraphicArr.length){var x=this._intersectedCostingGraphicArr[0];this._intersectedCostingGraphicArr=[];this._intersectedCostingGraphicArr.push(x)}u?(this._isFeatureIntersected=u,this._displayPopupForRegion()):
this._initializeScenarioSelection(this.nls.scenarioSelection.noneText,u,null)}else 0<this._splitAssetInfo.length&&this._createAndAddFeatures(this._splitAssetInfo)},_createAndAddFeatures:function(q){var u=[],x;if(this._selectedTemplate){var H=d.clone(this._selectedTemplate.template.prototype.attributes);if(this._editor.attributeInspector&&this._editor.attributeInspector._currentFeature)for(x in H)e.forEach(this._selectedTemplate.featureLayer.fields,d.hitch(this,function(L){if(L.name===x&&!L.nullable&&
(null===H[x]||void 0===H[x]||""===H[x]))return H[x]=this._editor.attributeInspector._currentFeature.attributes[x],!0}));e.forEach(q,d.hitch(this,function(L,Q){u.push(new z(L.ASSETGEOMETRY,null,d.clone(H)));this.selectedProjectFeatureAttr&&this._updateFeatureAttributes(u[Q])}));this._selectedTemplate.featureLayer.myApplyEdits(u,null,null)}},_updateFeatureAttributes:function(q){var u,x,H,L;e.some(this.config.layerSettings,d.hitch(this,function(M){M.attributeSetting&&M.id===this._selectedTemplate.featureLayer.id&&
(u=M.attributeSetting)}));if(u){var Q=this.map.getLayer(this._selectedTemplate.featureLayer.id);var T=this.map.getLayer(this.config.projectSettings.projectLayer);e.forEach(u,d.hitch(this,function(M){x=Q.getField(M.layerField).length;H=T.getField(M.projectField).length;L=this.selectedProjectFeatureAttr[M.projectField];x<H&&L&&0<L.length&&(L=L.slice(0,x));q.attributes[M.layerField]=L}))}},_displayPopupForRegion:function(){var q=this.map.getLayer(this.config.projectSettings.costingGeometryLayer);if(0<
this._intersectedCostingGraphicArr.length){var u=this._intersectedCostingGraphicArr.pop(0);var x=u.attributes[this.config.projectSettings.geographyField];u=u.attributes[q.globalIdField];this._initializeScenarioSelection(x,this._isFeatureIntersected,u)}else this._displayPopupForAssets()},_destroyScenarioSelection:function(){this._scenarioSelectionObj&&this._scenarioSelectionObj.destroy();this._selectScenarioPopup&&this._selectScenarioPopup.destroy()},_initializeScenarioSelection:function(q,u,x){var H;
var L=this._selectedTemplate.featureLayer.id;var Q=this._selectedTemplate.template.name;this._destroyScenarioSelection();var T=[];var M=[];e.forEach(this.config.costingInfoSettings[L],d.hitch(this,function(P){if(P.geography===q&&P.featureTemplate===Q){if(""===P.scenario||null===P.scenario||void 0===P.scenario)P=d.clone(P),P.scenario=this.nls.scenarioSelection.noneText;T.push(P)}else if(P.featureTemplate===Q&&(""===P.geography||null===P.geography||void 0===P.geography)){if(""===P.scenario||null===
P.scenario||void 0===P.scenario)H=P.costEquation,P=d.clone(P),P.scenario=this.nls.scenarioSelection.noneText,P.geography=this.nls.scenarioSelection.noneText;M.push(P)}}));1===T.length?(this._configuredGeographyCostEquation[x]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q]?(this.selectedTemplateInfo=this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q],
this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry):(this.selectedTemplateInfo={},this.selectedTemplateInfo.TEMPLATENAME=Q,this.selectedTemplateInfo.COSTEQUATION=T[0].costEquation,this.selectedTemplateInfo.GEOGRAPHY=q,this.selectedTemplateInfo.SCENARIO=T[0].scenario,this.selectedTemplateInfo.GEOGRAPHYGUID=x,this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry,this._configuredGeographyCostEquation.hasOwnProperty(this.selectedTemplateInfo.GEOGRAPHYGUID)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID]=
{}),this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID].hasOwnProperty(this._selectedTemplate.featureLayer.id)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id]={}),this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id][this.selectedTemplateInfo.TEMPLATENAME]=this.selectedTemplateInfo),this._splitAssetInfo.push(d.clone(this.selectedTemplateInfo)),
this._displayPopupForRegion()):1!==M.length||0!==T.length||u?1<M.length&&0===T.length&&!u?this._configuredGeographyCostEquation[x]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q]?(this.selectedTemplateInfo=this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q],this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry,this._splitAssetInfo.push(d.clone(this.selectedTemplateInfo)),
this._displayPopupForRegion()):(this._scenarioSelectionObj=new C({regionName:q,scenarioOptions:M,nls:this.nls,templateName:Q,geographyGlobalID:x,costingGeometryLayer:this.config.projectSettings.costingGeometryLayer}),this._displaySelectScenarioPopup(q)):0===T.length?(this._configuredGeographyCostEquation[x]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q]?(this.selectedTemplateInfo=
this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q],this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry):(this.selectedTemplateInfo={},this.selectedTemplateInfo.TEMPLATENAME=Q,this.selectedTemplateInfo.COSTEQUATION=H,this.selectedTemplateInfo.GEOGRAPHY=q,this.selectedTemplateInfo.SCENARIO=this.nls.scenarioSelection.noneText,this.selectedTemplateInfo.GEOGRAPHYGUID=x,this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry,this._configuredGeographyCostEquation.hasOwnProperty(this.selectedTemplateInfo.GEOGRAPHYGUID)||
(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID]={}),this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID].hasOwnProperty(this._selectedTemplate.featureLayer.id)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id]={}),this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id][this.selectedTemplateInfo.TEMPLATENAME]=
this.selectedTemplateInfo),this._splitAssetInfo.push(d.clone(this.selectedTemplateInfo)),this._displayPopupForRegion()):1<T.length&&(this._configuredGeographyCostEquation[x]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q]?(this.selectedTemplateInfo=this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q],this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry,
this._splitAssetInfo.push(d.clone(this.selectedTemplateInfo)),this._displayPopupForRegion()):(this._scenarioSelectionObj=new C({regionName:q,scenarioOptions:T,nls:this.nls,templateName:Q,geographyGlobalID:x,costingGeometryLayer:this.config.projectSettings.costingGeometryLayer}),this._displaySelectScenarioPopup(q))):(this._configuredGeographyCostEquation[x]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id]&&this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q]?
(this.selectedTemplateInfo=this._configuredGeographyCostEquation[x][this._selectedTemplate.featureLayer.id][Q],this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry):(this.selectedTemplateInfo={},this.selectedTemplateInfo.TEMPLATENAME=Q,this.selectedTemplateInfo.COSTEQUATION=M[0].costEquation,this.selectedTemplateInfo.GEOGRAPHY=q,this.selectedTemplateInfo.SCENARIO=this.nls.scenarioSelection.noneText,this.selectedTemplateInfo.GEOGRAPHYGUID=x,this.selectedTemplateInfo.ASSETGEOMETRY=
this._currentAssetSplitGeometry,this._configuredGeographyCostEquation.hasOwnProperty(this.selectedTemplateInfo.GEOGRAPHYGUID)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID]={}),this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID].hasOwnProperty(this._selectedTemplate.featureLayer.id)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id]={}),this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id][this.selectedTemplateInfo.TEMPLATENAME]=
this.selectedTemplateInfo),this._splitAssetInfo.push(d.clone(this.selectedTemplateInfo)),this._displayPopupForRegion())},_displaySelectScenarioPopup:function(){this._selectScenarioPopup=new p({titleLabel:this.nls.scenarioSelection.popupTitle,autoHeight:!0,content:this._scenarioSelectionObj,width:400,buttons:[{label:this.nls.common.ok,key:n.ENTER,onClick:d.hitch(this,"_onScenarioSelectionOk")},{label:this.nls.common.cancel,key:n.ESCAPE,onClick:d.hitch(this,"_onScenarioSelectionCancel")}]});R.set(this._scenarioSelectionObj.scenarioDropDown,
"aria-label",this.nls.scenarioSelection.scenarioLabel);R.set(this._scenarioSelectionObj.regionNameTextBox,"aria-label",this.nls.scenarioSelection.regionLabel);this._scenarioSelectionObj.startup();var q=this._selectScenarioPopup.enabledButtons;this.own(a(q[0],"keydown",d.hitch(this,function(u){if(u.keyCode===n.ENTER||u.keyCode===n.SPACE)r.stop(u),N.focus(this.selectButton)})));this.own(a(q[1],"keydown",d.hitch(this,function(u){if(u.keyCode===n.ENTER||u.keyCode===n.SPACE)r.stop(u),N.focus(this.selectButton)})))},
_onScenarioSelectionOk:function(){this.selectedTemplateInfo={};var q=this._scenarioSelectionObj.scenarioDropDown._getSelectedOptionsAttr();this.selectedTemplateInfo.TEMPLATENAME=q.item.featureTemplate;this.selectedTemplateInfo.COSTEQUATION=q.item.costEquation;this.selectedTemplateInfo.GEOGRAPHY=this._scenarioSelectionObj.regionNameTextBox.getValue();this.selectedTemplateInfo.SCENARIO=q.label;this.selectedTemplateInfo.GEOGRAPHYGUID=q.item.geographyGlobalID;this.selectedTemplateInfo.ASSETGEOMETRY=this._currentAssetSplitGeometry;
this._configuredGeographyCostEquation.hasOwnProperty(this.selectedTemplateInfo.GEOGRAPHYGUID)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID]={});this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID].hasOwnProperty(this._selectedTemplate.featureLayer.id)||(this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id]={});this._configuredGeographyCostEquation[this.selectedTemplateInfo.GEOGRAPHYGUID][this._selectedTemplate.featureLayer.id][this.selectedTemplateInfo.TEMPLATENAME]=
this.selectedTemplateInfo;this._selectScenarioPopup.close();this._splitAssetInfo.push(d.clone(this.selectedTemplateInfo));this._displayPopupForRegion()},_onScenarioSelectionCancel:function(){this._selectScenarioPopup.close()},resize:function(){if(this.domNode){var q=h.getMarginBox(this.domNode);q=q.w;0<q&&this._editor&&this._editor.templatePicker&&this._editor.templatePicker.update(!0)}},_getSelectedFeatures:function(q){var u=[];e.forEach(q,d.hitch(this,function(x){(x=x.getSelectedFeatures())&&0<
x.length&&e.forEach(x,d.hitch(this,function(H){u.push(H)}))}));return u},_createCustomSelectTool:function(){var q;this.customToolbar=new D(this.map,{tooltipOffset:10,drawTime:90});this._toolBarActive=!1;this.own(a(this.customToolbar,"draw-complete",d.hitch(this,function(u){var x=new f;x.geometry=u.geometry;var H=this._getOtherLayersFromMap();this._editor._selectionHelper.selectFeatures(H,x,c.SELECTION_NEW,d.hitch(this,function(){var L=this._getSelectedFeatures(H);0<L.length?(this.customToolbar.deactivate(),
this._toolBarActive=!1,this._copyFeaturesObj||this._createCopyFeaturesInstance(),this._copyFeaturesObj.selectFeaturesToCopy(L)):q=this.appUtils.showMessage(this.nls.copyFeatures.noFeaturesSelectedMessage)}));q&&q.enabledButtons&&this.own(a(q.enabledButtons[0],"keydown",d.hitch(this,function(L){if(L.keyCode===n.ENTER||L.keyCode===n.SPACE)r.stop(L),N.focus(this.selectButton)})))})))},_createCopyFeaturesInstance:function(){this._copyFeaturesObj=new F({nls:this.nls,layerInfosObj:this.layerInfosObj,mainNode:this.selectFeaturesNode,
appUtils:this.appUtils,map:this.map,widgetId:this.widgetId,widgetDomNode:this.widgetDomNode},g.create("div",{},this.selectFeaturesNode));this.own(a(this._copyFeaturesObj,"createSingleFeature",d.hitch(this,function(q){if(q=this._createSingleGeometry(q))this._featuresToBeCopied=[q],this._displayCopyAssetsPopup()})));this.own(a(this._copyFeaturesObj,"createMultipleFeatures",d.hitch(this,function(q){q&&0<q.length&&(this._featuresToBeCopied=q,this._displayCopyAssetsPopup())})));this.own(a(this._copyFeaturesObj,
"cancelBtnClicked",d.hitch(this,function(){var q=this.refreshButton,u=this.featureModeTextNode;this._activateCustomSelectTool();"none"===this.downloadCSVBtn.style.display||t.contains(this.downloadCSVBtn,"esriCTHidden")||(q=this.downloadCSVBtn);t.contains(this.projectNameDiv,"esriCTHidden")||(u=this.projectNameDiv);this.appUtils.setFirstAndLastWBFocusNode(this.widgetDomNode,u,q);N.focus(this.projectNameDiv)})));this._copyFeaturesObj.startup()},_createSingleGeometry:function(q){var u;var x=q[0]._layer.geometryType;
"esriGeometryPolyline"===x?u=this._createSinglePolyline(q):"esriGeometryPolygon"===x&&(u=this._createSinglePolygon(q));return u},_createSinglePolyline:function(q){var u=new y(new B(q[0].geometry.spatialReference));e.forEach(q,d.hitch(this,function(x){x.geometry&&x.geometry.paths&&e.forEach(x.geometry.paths,function(H){u.addPath(H)})}));return u},_createSinglePolygon:function(q){var u=new G(new B(q[0].geometry.spatialReference));e.forEach(q,d.hitch(this,function(x){x.geometry&&x.geometry.rings&&e.forEach(x.geometry.rings,
function(H){u.addRing(H)})}));return u},_toggleToolState:function(){t.contains(this.selectButton,"esriCTSelectDisable")?this._activateTemplatePickerTool():this._toolBarActive?this._activateTemplatePickerTool():this._activateCustomSelectTool()},_activateCustomSelectTool:function(){var q=this._editor.templatePicker.getSelected();this._editor._drawToolbar.deactivate();q?this.customToolbar.activate(D.EXTENT):this.customToolbar.deactivate()},_activateTemplatePickerTool:function(){var q=this._editor.templatePicker.getSelected();
this.customToolbar.deactivate();q&&this._editor._activateDrawToolbar(this._selectedTemplate)},_activateSketchButton:function(){t.add(this.sketchButton,"esriCTSketchEnable");t.remove(this.sketchButton,"esriCTSketchDisable")},_deActivateSketchButton:function(){t.add(this.sketchButton,"esriCTSketchDisable");t.remove(this.sketchButton,"esriCTSketchEnable")},_activateSelectButton:function(){t.add(this.selectButton,"esriCTSelectEnable");t.remove(this.selectButton,"esriCTSelectDisable")},_deActivateSelectButton:function(){t.add(this.selectButton,
"esriCTSelectDisable");t.remove(this.selectButton,"esriCTSelectEnable")},_deactivateAllTools:function(){this.customToolbar.deactivate();this._editor&&this._editor._drawToolbar&&this._editor._drawToolbar.deactivate()},_getOtherLayersFromMap:function(){var q=[];var u=this.layerInfosObj.getLayerInfoArray();e.forEach(u,d.hitch(this,function(x){var H=this.map.getLayer(x.id);if("Feature Layer"===H.type){var L=!1;e.forEach(this._editor._settings.layers,d.hitch(this,function(Q){Q.id===H.id&&(L=!0)}));L&&
-1<this._nonEditableLayers.indexOf(H.id)&&(L=!1);L||this._selectedTemplate.featureLayer.geometryType===H.geometryType&&H.id!==this.config.projectSettings.costingGeometryLayer&&H.id!==this.config.projectSettings.projectLayer&&q.push(H)}}));return q}})})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R,N,r,E,q,u,x,H,L,Q){var T=O([l,A],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:Q,onLoad:function(){},constructor:function(M,P){M=M||{};M.settings||console.error("Editor: please provide 'settings' parameter in the constructor");M.settings.layerInfos||console.error("Editor: please provide 'layerInfos' parameter in the constructor");this._settings=M.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);
this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var M=this._settings.layerInfos;this.featureReductionEnabledLayers=[];K.forEach(M,function(V){V=V.featureLayer;V.isFeatureReductionEnabled()&&(V.disableFeatureReduction(),this.featureReductionEnabledLayers.push(V))},this);if(K.every(M,function(V){return V.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var P=M.length;K.forEach(M,function(V){V=V.featureLayer;
if(V.loaded)P--;else var X=I.connect(V,"onLoad",this,function(S){I.disconnect(X);X=null;P--;P||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(M){this._updateCurrentFeature(J.hitch(this,function(){this._clearSelection(!1);M&&M()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();
this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();this._disableMapClickHandler();K.forEach(this._eConnects,I.disconnect);I.disconnect(this._dtConnect);I.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=
this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();K.forEach(this.featureReductionEnabledLayers,function(M){M.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new f(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new b(this._settings.map,{textSymbolEditorHolder:this.domNode});
this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=J.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=J.mixin({polylineDrawTools:[T.CREATE_TOOL_POLYLINE],polygonDrawTools:[T.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=
this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?!0:!1;this._datePackage=this._settings.datePackage;var M=H.defaults;this._settings.geometryService=this._settings.geometryService||M.geometryService;M.geometryService=M.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};K.forEach(this._settings.layerInfos,
function(M){if(M.featureLayer&&M.featureLayer.loaded){this._settings.layers.push(M.featureLayer);var P=M.featureLayer.id;M.featureLayer.credential&&(this._settings.userIds[P]=M.featureLayer.credential.userId);M.userId&&(this._settings.userIds[P]=M.userId);var V=M.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[P]=V.canCreate&&!V.canUpdate?!0:!1;this._isTextSymbolPointLayer(M.featureLayer)&&(M.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();
this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=!1},_saveFeatureOnClient:function(M){var P=this.templatePicker.getSelected();var V=P.template?P.featureLayer.renderer.getSymbol(P.template.prototype):P.symbolInfo.symbol;this._tempGraphic=new m(M,V,null,null);this._tempGraphic.setAttributes(J.mixin({},P.template.prototype.attributes));V=this._settings.map;V.graphics.add(this._tempGraphic);M=this._findCenterPoint(M);
this._createAttributeInspector();V.infoWindow.setTitle(P.featureLayer?P.featureLayer.name:L.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,P.featureLayer);this._showInfoWindow(M,V.getInfoWindowAnchor(M));if(this._settings.createOnlyLayer[P.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=I.connect(V.infoWindow,"onHide",this,"_infoWindowHide");I.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();
this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=I.connect(this.templatePicker,"onSelectionChange",J.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(M,P,V){this._tempGraphic.attributes[P]="number"===typeof V&&isNaN(V)?null:V},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);I.disconnect(this._infoWindowHideEvent)},_createFeature:function(M,
P){this._editClickPoint=this._findCenterPoint(M);M.rings?this._simplify(M,J.hitch(this,function(V){this._drawingTool!==G.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,adds:[this._createGraphic(V,P)]}],J.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(V,J.hitch(this,function(X){X&&X.length&&this._applyEdits([{layer:this._layer,adds:K.map(X,J.hitch(this,function(S){return this._createGraphic(S,
P)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,adds:[this._createGraphic(M,P)]}],J.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(M,P){this.attributeInspector&&
this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(M,P)},_updateCurrentFeature:function(M){var P=this._isModified();P?this._updateFeature(P,M):M&&M(!1)},_updateFeature:function(M,P,V){var X=M.geometry,S=M.getLayer();S.hasZ&&!S.enableZDefaults||S.hasM&&!S.allowUpdateWithoutMValues||V&&!this._isModified()?(V=new m,V.setAttributes(M.attributes),this._applyEdits([{layer:M.getLayer(),updates:[V]}],
P)):X.rings?this._simplify(X,J.hitch(this,function(U){this._applyEdits([{layer:M.getLayer(),updates:[J.mixin(M,{geometry:U})]}],P)})):this._applyEdits([{layer:M.getLayer(),updates:[M]}],P)},_deleteFeature:function(M,P){if(this._settings.invalidTemplate&&M===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var V=[];M?V.push({layer:M.getLayer(),deletes:[M]}):(V=K.map(K.filter(this._settings.layers,function(X){return 0<X.getSelectedFeatures().length}),
function(X){return{layer:X,deletes:X.getSelectedFeatures()}}))&&V.length||!this._currentGraphic||V.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(V,P)}},_stopEditing:function(M,P,V,X){h.hide(this.progressBar.domNode);this._settings.createOnlyLayer[M.id]||this._undoRedoAdd();if(!0===M._isSelOnly||1===M.mode||6===M.mode){if(P&&P.length){this.templatePicker.clearSelection();var S=new B;S.objectIds=[P[0].objectId];this._settings.createOnlyLayer[M.id]||this._settings.invalidTemplate?
this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([M],S,J.hitch(this,"_onEditFeature"))}}else(S=this._selectionHelper.findMapService(this._settings.map,M))&&S.refresh(),P&&P.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[M.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):c.findFeatures(P,M,J.hitch(this,"_onEditFeature")));X&&X.length&&(this._clearSelection(!0),this._undoRedo&&(S=this._selectionHelper.findMapService(M,
this._settings.map))&&S.refresh());this._undoRedo&&V&&V.length&&((S=this._selectionHelper.findMapService(M,this._settings.map))&&S.refresh(),this.attributeInspector.refresh(),this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var M=this._edits&&this._edits.length?this._edits[0]:null;if(M){var P=M.adds||[],V=M.updates||[],X=M.deletes||
[],S=M.preUpdates||[];M={featureLayer:M.layer};"CUT"===this._activeTool?P.length&&V.length&&S.length&&this.undoManager.add(new N(J.mixin(M,{preUpdatedGraphics:S,addedGraphics:P,postUpdatedGraphics:V}))):"UNION"===this._activeTool?X.length&&V.length&&S.length&&this.undoManager.add(new r(J.mixin(M,{preUpdatedGraphics:S,deletedGraphics:X,postUpdatedGraphics:V}))):P.length?this.undoManager.add(new D(J.mixin(M,{addedGraphics:P}))):X.length?this.undoManager.add(new R(J.mixin(M,{deletedGraphics:X}))):V.length&&
(this._rollbackGraphic||S.length)&&this.undoManager.add(new F(J.mixin(M,{preUpdatedGraphics:S.length?S:[this._rollbackGraphic],postUpdatedGraphics:V})));this._rollbackGraphic=this._edits=null}}},_activateDrawToolbar:function(M){this._layer=M.featureLayer;this._activeType=M.type;this._drawingTool=(this._activeTemplate=M.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,M.featureLayer);I.disconnect(this._dtConnect);var P=this._layer.fields;this._settings.invalidTemplate=
!1;if(this._activeTemplate&&this._activeTemplate.prototype){var V=J.mixin({},this._activeTemplate.prototype.attributes);P=P.filter(function(X){return!1===X.nullable&&!0===X.editable});this._settings.invalidTemplate=P.some(function(X){X=V[X.name];return null===X||void 0===X})}this._dtConnect=this._settings.createOnlyLayer[M.featureLayer.id]||this._settings.invalidTemplate?I.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):I.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");
this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(M,P){var V=M.getLayer(),X=V?V.geometryType:null,S=this._isTextSymbolPoint(M),U=b.MOVE;"esriGeometryPoint"!==X&&!0===this._isNotesFeature(M)?(U=U|b.ROTATE|b.SCALE,this._editVertices=!1):"esriGeometryPoint"!==X&&!0===this._editVertices?(U=U|b.ROTATE|b.SCALE,this._editVertices=!1):S?(U=
U|b.ROTATE|b.SCALE|b.EDIT_TEXT,this._editVertices=!1):(U|=b.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new m(M.toJson());X=V.getEditCapabilities({feature:M,userId:this._settings.userIds[V.id]});var W=K.filter(this._settings.layerInfos,function(Y){return Y.featureLayer.layerId===V.layerId})[0];X.canUpdate&&!W.disableGeometryUpdate&&X.canUpdateGeometry&&(this.editToolbar.activate(U,M),S&&(this.editToolbar._textEditor._addTextBox(M),this.editToolbar._textSymbolEditor&&
this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(M)||(M=P&&P.screenPoint||this._findCenterPoint(M),this._showInfoWindow(M,this._settings.map.getInfoWindowAnchor(M)))},_createGraphic:function(M,P){var V=new m(M,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,P);this._activeTemplate||P?V.attributes=P||J.mixin({},this._activeTemplate.prototype.attributes):(V.attributes=V.attributes||[],K.forEach(this._layer.fields,
function(X){V.attributes[X.name]=null},this));return V},_connectEvents:function(){var M=this._settings.layers;K.forEach(M,function(P){this._connect(P,"onEditsComplete",J.hitch(this,"_stopEditing",P))},this);K.forEach(M,function(P){this._connect(P,"onBeforeApplyEdits",J.hitch(this,function(){h.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",J.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",
J.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",J.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",J.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",J.hitch(this,"_hideAttributeInspector"))},_connect:function(M,P,V){this._eConnects.push(I.connect(M,P,V))},_createWidgets:function(){this._selectionHelper=new q(this._settings);this._createTemplatePicker();this._createAttributeInspector();
this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,h.hide(this.templatePickerDiv);else{var M=K.filter(this._settings.layers,function(P){return P.getEditCapabilities().canCreate});this.templatePicker=new u({"class":"esriTemplatePicker",featureLayers:M,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();
this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=I.connect(this.templatePicker,"onSelectionChange",J.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var M=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new z({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,
datePackage:this._datePackage},t.create("div")),this.attributeInspector.startup(),M.infoWindow.setContent(this.attributeInspector.domNode),M.infoWindow.setTitle(L.widgets.attributeInspector.NLS_title),M.infoWindow.resize(350,375),v.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",J.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",J.hitch(this,function(P){this._updateCurrentFeature(J.hitch(this,function(){this._attributeChanged=
!1;this._onEditFeature(P)}))}));this._usePopup&&M.infoWindow._setPagerCallbacks(this.attributeInspector,J.hitch(this.attributeInspector,"previous"),J.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",J.hitch(this,function(P,V,X){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(P,V,X);else{var S=P.getLayer();(S=K.filter(S.fields,function(U){return U.name===V})[0])&&""===X&&(X=null);this._rollbackGraphic=
new m(J.clone(P.toJson()));this.attributeInspector._rollbackInfo={field:S,graphic:this._rollbackGraphic};this._currentGraphic.attributes[V]="number"===typeof X&&isNaN(X)?null:X;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new E({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,
settings:this._settings,onDelete:J.hitch(this,"_deleteFeature"),onApplyEdits:J.hitch(this,"_applyEdits"),onShowAttributeInspector:J.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new C({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,
"onUndoComplete",J.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",J.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",J.hitch(this,function(M){if(M.metaKey||M.ctrlKey)"z"===M.charOrCode&&this._undo(),"y"===M.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(M){if(M&&M.addedIds){var P;for(P=0;P<this.undoManager.length;P++){var V=this.undoManager.get(P);V&&M.layer===V._featureLayer&&V.updateObjectIds(M.oldIds,M.addedIds)}}M&&
"Update Features"===M.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=I.connect(this._settings.map,"onClick",J.hitch(this,function(M){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(J.hitch(this,function(){this._reset();this._updateSelection(M)})))}))},_disableMapClickHandler:function(){I.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var M=this.templatePicker.getSelected();
M?this._updateCurrentFeature(J.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(M)})):(this._reset(),I.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(M){if("point"===M.geometry.type||"multipoint"===M.geometry.type){var P=M.getLayer(),V=P.renderer;M=M.symbol||P._getSymbol(M);!M&&(V.hasVisualVariables("sizeInfo",!1)||
V.hasVisualVariables("colorInfo",!1)||V.hasVisualVariables("opacityInfo",!1))&&V.addBreak&&V.infos&&1===V.infos.length&&(M=V.infos[0].symbol||V.defaultSymbol);if(M&&"textsymbol"===M.type)return!0}return!1},_isTextSymbolPointLayer:function(M){return"esriGeometryPoint"===M.geometryType&&M.renderer&&M.renderer._symbols&&M.renderer._symbols[0]&&M.renderer._symbols[0].symbol&&"textsymbol"===M.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(M){M=M.getLayer();if(!M)return!1;var P,
V=!1;for(P=0;P<this._settings.layerInfos.length;P++){var X=this._settings.layerInfos[P];if(X.featureLayer==M){V=X.disableAttributeUpdate;break}}return V},_onEditFeature:function(M,P){if(M=(J.isArray(M)?M[0]:M)||null){this._layer=M.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(M)){P=P||this._editClickPoint||this._findCenterPoint(M);if(1<this._currentFeatureCount){var V=this._popupFeatures.indexOf(M);V=g.substitute(L.widgets.popup.NLS_pagingInfo,{index:V+1,total:this._currentFeatureCount})}else V=
this._layer?this._layer.name:L.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(V);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(P,this._settings.map.getInfoWindowAnchor(P));this._editClickPoint=null}M!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=M,M.getDojoShape()&&M.getDojoShape().moveToFront(),P=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||P&&!this._layer.allowUpdateWithoutMValues||
this._activateEditToolbar(M))}},_applyEdits:function(M,P){M=M||[];if(!(0>=M.length)){this._edits=this._oEdits=M;var V=[];K.forEach(M,function(X){X.layer&&V.push(X.layer.applyEdits(X.adds,X.updates,X.deletes))});0<V.length&&(this._deferredsList=(new a(V)).addCallback(J.hitch(this,function(){h.hide(this.progressBar.domNode);P&&P();var X=this._settings.map;X&&X.infoWindow.reposition&&X.infoWindow.isShowing&&X.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&
(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(M,P){n.prototype.isSelfIntersecting(M)?this._settings.geometryService.simplify([M],function(V){var X=V&&V.length?V[0]:X;P&&P(X)}):P&&P(M)},_autoComplete:function(M,P){var V=this._getLayers("esriGeometryPolygon"),X=new B;X.geometry=M;
X.returnGeometry=!0;this._selectFeatures(V,X,J.hitch(this,function(S){!S||0>=S.length?P&&P([M]):this._settings.geometryService.autoComplete(p.getGeometries(S),this._toPolylines([X.geometry]),function(U){P&&P(U)})}))},_getLayers:function(M){return K.filter(this._settings.layers,function(P){return P.geometryType===M})},_selectFeatures:function(M,P,V,X){this._selectionHelper.selectFeatures(M,P,X||y.SELECTION_NEW,V)},_updateSelection:function(M){var P=M.mapPoint,V=M.graphic,X=this._settings.layerInfos,
S;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,P,y.SELECTION_NEW,J.hitch(this,function(U){var W=K.some(U,J.hitch(this,function(Z){return Z==V}));if(V&&!W)if(W=V.getLayer(),this._isValidLayer(W)){var Y=new B;Y.objectIds=[V.attributes[W.objectIdField]];this._selectionHelper.selectFeatures([W],Y,y.SELECTION_ADD,J.hitch(this,function(Z){Z&&Z.length&&(Z=Z.concat(U),S=c.sortFeaturesById(X,Z),this._updatePopupButtons(S),this._onEditFeature(S,P))}))}else U&&U.length?(S=c.sortFeaturesById(X,
U),this._updatePopupButtons(S),this._onEditFeature(S,P)):this._clearSelection();else U&&U.length?(S=c.sortFeaturesById(X,U),this._updatePopupButtons(S),this._onEditFeature(S,P)):this._clearSelection()}));V&&this._isTextSymbolPoint(V)&&this._isValidLayer(V.getLayer())&&this.editToolbar.activate(0|b.MOVE|b.ROTATE|b.SCALE|b.EDIT_TEXT,V)},_updatePopupButtons:function(M){if(this._usePopup&&M){var P=M.length;K.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],
J.hitch(this,function(X){1<P?w.remove(X,"hidden"):w.add(X,"hidden")}));var V=1<P?"block":"none";v.query(".esriAttributeInspector .atiLayerName").style({display:V});this._currentFeatureCount=P;this._popupFeatures=M}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(M){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(M||!1);this._reset()},_findCenterPoint:function(M){M=M.geometry||M;switch(M.type){case "point":var P=M;break;case "polyline":P=
M.getPoint(0,Math.ceil(M.paths[0].length/2));break;case "polygon":P=M.rings.length-1,P=M.getPoint(P,M.rings[P].length-1)}return this._settings.map.toScreen(P)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(M){return K.map(M,function(P){var V=new k(P.spatialReference);K.forEach(P.rings,function(X){V.addPath(X)});return V})},_isNotesFeature:function(M){var P=M.getLayer(),V=P?P.types||null:
null;if(!V)return!1;var X=M.attributes[P.typeIdField],S;K.some(V,function(U){return U.id===X?(S=U.templates,!0):!1});return S?(M=S[0]||null)?this._isShapeTool(M.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(M){var P,V=this._settings.layerInfos;for(P=0;P<V.length;P++){var X=V[P];if(M.id==(X.featureLayer?X.featureLayer.id:X.layerId))return!0}return!1},_isShapeTool:function(M){switch(M){case G.TOOL_ARROW:return f.ARROW;case G.TOOL_LEFT_ARROW:return f.LEFT_ARROW;case G.TOOL_RIGHT_ARROW:return f.RIGHT_ARROW;
case G.TOOL_UP_ARROW:return f.UP_ARROW;case G.TOOL_DOWN_ARROW:return f.DOWN_ARROW;case G.TOOL_CIRCLE:return f.CIRCLE;case G.TOOL_ELLIPSE:return f.ELLIPSE;case G.TOOL_TRIANGLE:return f.TRIANGLE;case G.TOOL_RECTANGLE:return f.RECTANGLE;default:return null}},_toDrawTool:function(M,P){P=P.geometryType;switch(M){case G.TOOL_POINT:return f.POINT;case G.TOOL_ARROW:return f.ARROW;case G.TOOL_LEFT_ARROW:return f.LEFT_ARROW;case G.TOOL_RIGHT_ARROW:return f.RIGHT_ARROW;case G.TOOL_UP_ARROW:return f.UP_ARROW;
case G.TOOL_DOWN_ARROW:return f.DOWN_ARROW;case G.TOOL_CIRCLE:return f.CIRCLE;case G.TOOL_ELLIPSE:return f.ELLIPSE;case G.TOOL_TRIANGLE:return f.TRIANGLE;case G.TOOL_RECTANGLE:return f.RECTANGLE;case G.TOOL_LINE:return f.POLYLINE;case G.TOOL_POLYGON:return f.POLYGON;case G.TOOL_FREEHAND:return"esriGeometryPolyline"===P?f.FREEHAND_POLYLINE:f.FREEHAND_POLYGON;default:return M=f.POINT,"esriGeometryPolyline"===P?(M=f.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===T.CREATE_TOOL_FREEHAND_POLYLINE&&
(M=f.FREEHAND_POLYLINE)):"esriGeometryPolygon"===P&&(M=f.POLYGON,this._settings.createOptions.polygonDrawTools[0]===T.CREATE_TOOL_FREEHAND_POLYGON&&(M=f.FREEHAND_POLYGON)),M}},_isModified:function(){var M=this.editToolbar.getCurrentState();return(M.isModified||this._attributeChanged)&&M.graphic?M.graphic:null},_showInfoWindow:function(M,P){this._customAttributeInspector||this._settings.map.infoWindow.show(M,P)}});J.mixin(T,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});e("extend-esri")&&J.setObject("dijit.editing.Editor",T,x);return T})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y){var G=J(A,{declaredClass:"esri.toolbars.Edit",constructor:function(f,b){this._map=f;this._tool=0;if(this._map.loaded)this._scratchGL=f.graphics;else var z=I.connect(this._map,"onLoad",this,function(){I.disconnect(z);z=null;this._scratchGL=this._map.graphics});f=d("esri-mobile");this._defaultOptions=K.mixin({vertexSymbol:new m(m.STYLE_CIRCLE,f?20:12,new C(C.STYLE_SOLID,new e([0,0,0,.5]),1),new e([128,128,128])),ghostVertexSymbol:new m(m.STYLE_CIRCLE,
f?18:10,new C(C.STYLE_SOLID,new e([0,0,0,.5]),1),new e([255,255,255,.75])),ghostLineSymbol:new C(C.STYLE_DOT,new e([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:f?24:16,boxLineSymbol:new C(C.STYLE_DASH,new e([64,64,64]),1),boxHandleSymbol:new m(m.STYLE_SQUARE,f?16:9,new C(C.STYLE_SOLID,new e([0,0,0,.5]),1),new e([255,255,255,.75])),textAnchorSymbol:new m(m.STYLE_CIRCLE,10,null,new e([255,0,0]))},b||{})},activate:function(f,b,z){this.deactivate();this._graphic=b;this._options=
K.mixin(K.mixin({},this._defaultOptions),z||{});var c=G.MOVE;z=G.EDIT_VERTICES;var D=G.SCALE,F=G.ROTATE,R=G.EDIT_TEXT,N=!1,r=!1,E=!1,q=this._map,u=q.spatialReference,x=b.geometry.spatialReference;this._geo=!(!u||!x||u.equals(x)||!u.isWebMercator()||4326!==x.wkid);this._isTextPoint=this._prepareTextSymbolEditing(b,f);(f&c)===c&&(N=this._enableMove(b));c=(f&D)===D;F=(f&F)===F;if(c||F)E=this._enableBoxEditing(b,c,F);(f&z)===z&&(r=this._enableVertexEditing(b));(f&R)===R&&this._enableTextEditing(b);if(!(N||
r||E))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=f)this._mapPanEndHandle=I.connect(q,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=I.connect(q,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,b);q.snappingManager&&(N||r)&&q.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var f=this._tool,b=this._graphic;if(f){var z=
!!this._modified;this._clear();I.disconnect(this._mapPanEndHandle);I.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(f,b,{isModified:z});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(f,b){},onDeactivate:function(f,b,z){},
onGraphicMoveStart:function(f){},onGraphicFirstMove:function(f){this._modified=!0},onGraphicMove:function(f,b){},onGraphicMoveStop:function(f,b){},onGraphicClick:function(f,b){},onVertexMoveStart:function(f,b){},onVertexFirstMove:function(f,b){this._modified=!0},onVertexMove:function(f,b,z){},onVertexMoveStop:function(f,b,z){},onVertexAdd:function(f,b){this._modified=!0},onVertexClick:function(f,b){},onVertexMouseOver:function(f,b){},onVertexMouseOut:function(f,b){},onVertexDelete:function(f,b){this._modified=
!0},onTextEditStart:function(f,b){},onTextEditEnd:function(f){},onScaleStart:function(f){},onScaleFirstMove:function(f){this._modified=!0},onScale:function(f,b){},onScaleStop:function(f,b){},onRotateStart:function(f){},onRotateFirstMove:function(f){this._modified=!0},onRotate:function(f,b){},onRotateStop:function(f,b){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(f,b){if("point"===f.geometry.type||"multipoint"===f.geometry.type){var z=f.getLayer(),c=z.renderer;z=f.symbol||z._getSymbol(f);!z&&(c.hasVisualVariables("sizeInfo",!1)||c.hasVisualVariables("colorInfo",!1)||c.hasVisualVariables("opacityInfo",!1))&&c.addBreak&&
c.infos&&1===c.infos.length&&(z=c.infos[0].symbol||c.defaultSymbol);if(z&&"textsymbol"===z.type){if((b&G.SCALE)===G.SCALE||(b&G.ROTATE)===G.ROTATE||(b&G.EDIT_TEXT)===G.EDIT_TEXT){f.setSymbol(new B(z.toJson()));var D=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(f),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){D._boxEditor&&D._boxEditor.refresh()})):
O(["../dijit/SymbolEditor"],function(F){if(!D._textSymbolEditor){var R=D._options.textSymbolEditorHolder?a.create("div",null,D._options.textSymbolEditorHolder):a.create("div",null,D._map.root);D._textSymbolEditor=new F({graphic:f},R);F=D._textSymbolEditor.domNode.parentNode.id;w.set(D._textSymbolEditor.domNode,{position:"map_root"===F?"absolute":"relative",left:"map_root"===F?D._map.width/2-100+"px":"5px",top:"20px","z-index":50});D._textSymbolEditor.startup();D._textSymbolEditor.createForm(f);D._textSymbolEditor.show();
D._textSymbolEditor.on("symbol-change",function(){D._boxEditor&&D._boxEditor.refresh()})}})}if((b&G.MOVE)===G.MOVE||(b&G.ROTATE)===G.ROTATE||(b&G.SCALE)===G.SCALE)this._textAnchor=new y(f.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(f){var b=this._map;switch(f.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new p(f,b,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(f){var b=
this._map;switch(f.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=k.create(f,b,this),!0}return!1},_enableBoxEditing:function(f,b,z){var c=this._map,D=f.geometry.type;return"polyline"===D||"polygon"===D||this._isTextPoint?(this._boxEditor=new h(f,c,this,b,z,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(f){return this._isTextPoint?(this._textEditor=new n(f,this._map,this),I.connect(this._textEditor,"onEditStart",K.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var f=this._graphicMover;f&&(f.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var f=this._vertexEditor;f&&(f.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var f=this._boxEditor;f&&(f.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(f,b,z){z&&this._refreshMoveables()},_refreshMoveables:function(f){var b=v.filter([this._graphicMover,this._vertexEditor,this._boxEditor],g.isDefined);v.forEach(b,function(z){z.refresh(f)})},_beginOperation:function(f){v.forEach(this._getAffectedTools(f),function(b){b.suspend()})},_endOperation:function(f){v.forEach(this._getAffectedTools(f),function(b){b.resume()})},_getAffectedTools:function(f){var b=[];switch(f){case "MOVE":b=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return b=v.filter(b,g.isDefined)}});K.mixin(G,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});d("extend-esri")&&K.setObject("toolbars.Edit",G,t);return G})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n){O=O(null,{declaredClass:"esri.toolbars._Box",constructor:function(m,C,B,y,G,f,b){this._graphic=m;this._map=C;this._toolbar=B;this._scale=y;this._rotate=G;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=f;m=B._options;this._markerSymbol=m.boxHandleSymbol;this._lineSymbol=m.boxLineSymbol;this._moveStartHandler=J.hitch(this,this._moveStartHandler);this._firstMoveHandler=J.hitch(this,this._firstMoveHandler);
this._moveStopHandler=J.hitch(this,this._moveStopHandler);this._moveHandler=J.hitch(this,this._moveHandler);this._isTextPoint=b;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){K.forEach(this._getAllGraphics(),function(m){m.hide()})},resume:function(){K.forEach(this._getAllGraphics(),function(m){m.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
K.forEach(this._connects,I.disconnect);var m=this._toolbar._scratchGL;this._anchors&&K.forEach(this._anchors,function(C){m.remove(C.graphic);(C=C.moveable)&&C.destroy()});this._box&&m.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var m=this._map,C=this._toolbar._scratchGL,B=this._getBoxCoords(),y=new A(m.spatialReference),G=J.clone(K.filter(B,function(f,b){return 8!==b&&0===b%2}));G[0]&&G.push([G[0][0],G[0][1]]);y.addPath(G);this._rotate&&
y.addPath([B[1],B[8]]);this._box?this._box.setGeometry(y):(this._box=new n(y,this._lineSymbol),C.add(this._box));this._anchors?K.forEach(this._anchors,function(f,b){this._scale||(b=8);var z=new l(B[b],m.spatialReference);f.graphic.setGeometry(z);z=f.moveable;var c=f.graphic.getDojoShape();c&&(z?c!==z.shape&&(z.destroy(),f.moveable=this._getMoveable(f.graphic,b)):f.moveable=this._getMoveable(f.graphic,b))},this):(this._anchors=[],this._connects=[],K.forEach(B,function(f,b){!this._scale&&8>b||(f=new l(f,
m.spatialReference),f=new n(f,this._markerSymbol),this._isTextPoint&&1===b%2&&f.hide(),C.add(f),this._anchors.push({graphic:f,moveable:this._getMoveable(f,b)}))},this))}else this._cleanUp()},_getBoxCoords:function(m){var C=this._map,B=[],y,G,f;if(this._isTextPoint){var b=this._graphic.getNode().getBoundingClientRect();var z=C.__container.getBoundingClientRect();b=[{x:b.left-z.left,y:b.top-z.top},{x:b.right-z.left,y:b.top-z.top},{x:b.right-z.left,y:b.bottom-z.top},{x:b.left-z.left,y:b.bottom-z.top}]}else b=
this._getTransformedBoundingBox(this._graphic);K.forEach(b,function(c,D,F){y=c;(G=F[D+1])||(G=F[0]);f={x:(y.x+G.x)/2,y:(y.y+G.y)/2};m||(y=C.toMap(y),f=C.toMap(f));B.push([y.x,y.y]);B.push([f.x,f.y])});this._rotate&&(b=J.clone(B[1]),b=m?{x:b[0],y:b[1]}:C.toScreen({x:b[0],y:b[1],spatialReference:C.spatialReference}),b.y-=this._toolbar._options.rotateHandleOffset,m||(b=C.toMap(b)),B.push([b.x,b.y]));return B},_getTransformedBoundingBox:function(m){var C=this._map,B=m.geometry.getExtent(),y=m.geometry.spatialReference;
m=new l(B.xmin,B.ymax,y);B=new l(B.xmax,B.ymin,y);m=C.toScreen(m);B=C.toScreen(B);return[{x:m.x,y:m.y},{x:B.x,y:m.y},{x:B.x,y:B.y},{x:m.x,y:B.y}]},_getAllGraphics:function(){var m=[this._box];this._anchors&&K.forEach(this._anchors,function(C){m.push(C.graphic)});return m=K.filter(m,g.isDefined)},_getMoveable:function(m,C){var B=m.getDojoShape();if(B)return m=new a(B),m._index=C,this._connects.push(I.connect(m,"onMoveStart",this._moveStartHandler)),this._connects.push(I.connect(m,"onFirstMove",this._firstMoveHandler)),
this._connects.push(I.connect(m,"onMoveStop",this._moveStopHandler)),m.onMove=this._moveHandler,(B=B.getEventSource())&&d.set(B,"cursor",this._toolbar._cursors["box"+C]),m},_moveStartHandler:function(m){this._toolbar["on"+(8===m.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(m){this._toolbar._deactivateScrollWheel();var C=m.host._index,B=this._wrapOffset=m.host.shape._wrapOffsets[0]||0,y=this._graphic.getLayer().getNavigationTransform();m=K.map(this._getBoxCoords(!0),
function(f){return{x:f[0]+B,y:f[1]}});var G=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:m[1].x,y:m[3].y};this._centerCoord=w.multiplyPoint(w.invert(y),G);if(8===C)G=w.multiplyPoint(w.invert(y),m[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,G)),this._startLine=[this._centerCoord,G],this._moveLine=J.clone(this._startLine);else if(G=w.multiplyPoint(w.invert(y),m[C]),y=w.multiplyPoint(w.invert(y),m[(C+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,G)),this._firstMoverToAnchor=Math.sqrt((G.x-this._centerCoord.x)*(G.x-this._centerCoord.x)+(G.y-this._centerCoord.y)*(G.y-this._centerCoord.y)),this._startBox=y,this._startBox.width=m[4].x-m[0].x,this._startBox.height=m[4].y-m[0].y,this._moveBox=J.clone(this._startBox),this._xfactor=G.x>y.x?1:-1,this._yfactor=G.y>y.y?1:-1,1===C||5===C)this._xfactor=0;else if(3===C||7===C)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===C?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(m,C){m=m.host._index;var B=this._defaultEventArgs;B.angle=0;B.scaleX=1;B.scaleY=1;if(8===m){var y=this._startLine;var G=this._moveLine;var f=G[1];f.x+=C.dx;f.y+=C.dy;C=this._getAngle(y,G);this._isTextPoint&&(C+=this._graphic.symbol.angle);G=w.rotategAt(C,y[0]);this._graphic.getDojoShape().setTransform(G);B.transform=G;B.angle=C;B.around=y[0]}else{y=this._startBox;G=this._moveBox;G.width+=C.dx*this._xfactor;G.height+=C.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(y=G.x+this._xfactor*G.width,G=G.y+this._yfactor*G.height,y=Math.sqrt((y-this._centerCoord.x)*(y-this._centerCoord.x)+(G-this._centerCoord.y)*(G-this._centerCoord.y)),this._scaleRatio=C=f=y/this._firstMoverToAnchor,y=this._centerCoord):(C=G.width/y.width,f=G.height/y.height,y={x:y.x,y:y.y});if(isNaN(C)||Infinity===C||-Infinity===C)C=1;if(isNaN(f)||Infinity===f||-Infinity===f)f=1;G=w.scaleAt(C,f,y);if(this._isTextPoint){var b=w.rotategAt(this._graphic.symbol.angle,
y);this._graphic.getDojoShape().setTransform([b,G])}else this._graphic.getDojoShape().setTransform(G);B.transform=G;B.scaleX=C;B.scaleY=f;B.around=y}this._toolbar["on"+(8===m?this._rotateEvent:this._scaleEvent)](this._graphic,B)},_moveStopHandler:function(m){this._toolbar._activateScrollWheel();var C=this._graphic,B=this._toolbar,y=B._geo?p.geographicToWebMercator(C.geometry):C.geometry,G=y.spatialReference,f=C.getDojoShape(),b=f.getTransform(),z=C.getLayer().getNavigationTransform();this._isTextPoint?
(C=this._graphic.symbol,8===m.host._index?C.angle+=this._getAngle(this._startLine,this._moveLine):C.font.setSize(Math.round(C.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(C)):(y=y.toJson(),this._updateSegments(y.paths||y.rings,b,z,G),f.setTransform(null),y=k.fromJson(y),C.setGeometry(B._geo?p.webMercatorToGeographic(y,!0):y));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;B._endOperation("BOX");this._defaultEventArgs.transform=
b;B["on"+(8===m.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(m,C,B,y){var G=this._map,f=this._wrapOffset||0;K.forEach(m,function(b){K.forEach(b,function(z){this._updatePoint(z,y,f,w,G,B,C)},this)},this)},_updatePoint:function(m,C,B,y,G,f,b){C=G.toScreen({x:m[0],y:m[1],spatialReference:C},!0);C.x+=B;C=y.multiplyPoint([f,b,y.invert(f)],C);C.x-=B;B=G.toMap(C);m[0]=B.x;m[1]=B.y},_getAngle:function(m,C){return 180*Math.atan2(C[0].y-
C[1].y,C[0].x-C[1].x)/Math.PI-180*Math.atan2(m[0].y-m[1].y,m[0].x-m[1].x)/Math.PI},_deNormalizePoint:function(m,C){var B=this._map._getFrameWidth();if(-1===B)return m;for(m={x:m.x,y:m.y};Math.abs(m.x-C.x)>=B;)m.x=m.x<C.x?m.x+B:m.x-B;var y=Math.abs(m.x-C.x);Math.abs(m.x-C.x+B)<y?m.x+=B:Math.abs(m.x-C.x-B)<y&&(m.x-=B);return m}});e("extend-esri")&&J.setObject("toolbars._Box",O,t);return O})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(O,J,K,I,v,e,d,a,w,t){return J("dojox.gfx.Moveable",null,{constructor:function(g,l){this.shape=g;this.delay=l&&0<l.delay?l.delay:0;this.mover=l&&l.mover?l.mover:w;this.leftButtonOnly=l&&l.leftButtonOnly;this.events=[this.shape.on(e.press,O.hitch(this,"onMouseDown"))]},destroy:function(){K.forEach(this.events,function(g){g.remove()});this.events=this.shape=null},onMouseDown:function(g){this.delay?(this.events.push(this.shape.on(e.move,O.hitch(this,"onMouseMove")),this.shape.on(e.release,O.hitch(this,
"onMouseUp"))),this._lastX=g.clientX,this._lastY=g.clientY):this.leftButtonOnly&&!t.isLeft(g)||new this.mover(this.shape,g,this);I.stop(g)},onMouseMove:function(g){var l=g.clientY;if(Math.abs(g.clientX-this._lastX)>this.delay||Math.abs(l-this._lastY)>this.delay)this.onMouseUp(g),new this.mover(this.shape,g,this);I.stop(g)},onMouseUp:function(g){this.events.pop().remove()},onMoveStart:function(g){v.publish("/gfx/move/start",g);d.add(a.body(),"dojoMove")},onMoveStop:function(g){v.publish("/gfx/move/stop",
g);d.remove(a.body(),"dojoMove")},onFirstMove:function(g){},onMove:function(g,l,A){this.onMoving(g,l,A);this.shape.applyLeftTransform(l);this.onMoved(g,l)},onMoving:function(g,l){},onMoved:function(g,l){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(O,J,K,I,v,e){return K("dojox.gfx.Mover",null,{constructor:function(d,a,w){this.shape=d;this.lastX=a.clientX;this.lastY=a.clientY;d=this.host=w;a=
document;w=I(a,v.move,O.hitch(this,"onFirstMove"));this.events=[I(a,v.move,O.hitch(this,"onMouseMove")),I(a,v.release,O.hitch(this,"destroy")),I(a,"dragstart",O.hitch(e,"stop")),I(a,"selectstart",O.hitch(e,"stop")),w];if(d&&d.onMoveStart)d.onMoveStart(this)},onMouseMove:function(d){var a=d.clientX,w=d.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:w-this.lastY},d);this.lastX=a;this.lastY=w;e.stop(d)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){J.forEach(this.events,
function(a){a.remove()});var d=this.host;if(d&&d.onMoveStop)d.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,A,h){var p=O(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(k,n,m,C){this.graphic=k;this.map=n;this.toolbar=m;this.tempPt=C;this._enableGraphicMover();this._moved=!1},refresh:function(k){var n=this.graphic.getDojoShape();!n||!k&&n._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var k=this.graphic,n=k.getDojoShape();n&&(n._hostGraphic=k,this._moveable=new e(n,{mover:p.Mover}),this._moveStartHandle=
K.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=K.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=K.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=K.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(k=n.getEventSource())&&v.set(k,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var k=this._moveable;if(k){K.disconnect(this._moveStartHandle);K.disconnect(this._firstMoveHandle);
K.disconnect(this._movingHandle);K.disconnect(this._moveStopHandle);var n=k.shape;n&&(n._hostGraphic=null,(n=n.getEventSource())&&v.set(n,"cursor","inherit"));k.destroy()}this._moveable=null},_moveStartHandler:function(){var k=this.graphic,n=this.map;this._startTx=k.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&n.snappingManager&&n.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(k)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(k,n,m){k=k.shape.getTransform();n=this.map;var C;g("esri-pointer")?C=n.navigationManager.pointerEvents._processTouchEvent(m,m):m&&"pointermove"===m.type&&(C=t.prototype._processTouchEvent.call({map:n},m,m));C&&n.snappingManager&&n.snappingManager._onSnappingMouseMoveHandler(C);this.tempPt&&this.tempPt.getDojoShape().setTransform(k);this.toolbar.onGraphicMove(this.graphic,k)},_moveStopHandler:function(k){var n=this.graphic,m=this.toolbar,C=this.map,B=m._geo?l.geographicToWebMercator(n.geometry):
n.geometry,y=B.type,G=n.getDojoShape(),f=G.getTransform();if(I.toJson(f)!==I.toJson(this._startTx)){this._moved=!0;switch(y){case "point":y=[f,a.invert(this._startTx)];if(C.snappingManager)var b=C.snappingManager._snappingPoint;B=b||C.toMap(a.multiplyPoint(y,C.toScreen(B,!0)));C.snappingManager&&C.snappingManager._killOffSnapping();break;case "polyline":B=this._updatePolyGeometry(B,B.paths,f);break;case "polygon":B=this._updatePolyGeometry(B,B.rings,f)}G.setTransform(null);n.setGeometry(m._geo?l.webMercatorToGeographic(B,
!0):B);this.tempPt&&this.tempPt.setGeometry(new h(n.geometry.toJson()))}else this._moved=!1;m._endOperation("MOVE");m.onGraphicMoveStop(n,f);this._moved||(k=k.__e,C=this.map.position,k=new A(k.pageX-C.x,k.pageY-C.y),m.onGraphicClick(n,{screenPoint:k,mapPoint:this.map.toMap(k)}))},_updatePolyGeometry:function(k,n,m){var C=this.map,B=k.getPoint(0,0);C=C.toMap(C.toScreen(B).offset(m.dx,m.dy));m=C.x-B.x;B=C.y-B.y;var y;for(C=0;C<n.length;C++){var G=n[C];for(y=0;y<G.length;y++){var f=k.getPoint(C,y);k.setPoint(C,
y,f.offset(m,B))}}return k}});p.Mover=O(d,{declaredClass:"esri.toolbars._Mover",constructor:function(k,n,m){this.__e=n}});g("extend-esri")&&(J.setObject("toolbars._GraphicMover",p,w),J.setObject("toolbars._Mover",p.Mover,w));return p})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(O,
J,K,I,v,e,d,a,w,t,g,l){var A=O(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(h,p,k){this.graphic=h;this.map=p;this.toolbar=k;h=k._options;this._symbol1=h.vertexSymbol;this._symbol2=h.ghostVertexSymbol;p=h.ghostLineSymbol;this._lineStroke={style:p.style,width:p.width,color:p.color};this._canDel=h.allowDeleteVertices;this._canAdd=h.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(h){h?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=K.connect(w,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=K.connect(w,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var h=this._getGraphicsLayer();this._mouseOverHandle=K.connect(h,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=K.connect(h,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new e({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),h=this._ctxDelete=new d({label:l.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
K.connect(h,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(h),this._ctxMenu.startup())},_removeControllers:function(){K.disconnect(this._firstMoveHandle);K.disconnect(this._moveStopHandle);K.disconnect(this._mouseOverHandle);K.disconnect(this._mouseOutHandle);K.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(h,p,k){var n,m,C=this.graphic,B=[];for(n=0;n<h.length;n++){var y=h[n],G=[];for(m=0;m<y.length;m++)G.push(new w(y[m],p,C,n,m,y.length,this,k));B.push(G)}return B},_remove:function(h){h&&I.forEach(h,function(p){I.forEach(p,function(k){k.destroy()})})},_refresh:function(h){h&&I.forEach(h,function(p){I.forEach(p,function(k){k.refresh()})})},_isNew:function(h){return-1===I.indexOf(this._vertexMovers[h.segIndex],h)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(h){h=this._selectedMover;this._updateRelatedGraphic(h,h.relatedGraphic,h.graphic.geometry,h.segIndex,h.ptIndex,h.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(h);this._deleteVertex(h);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(h){h=h.graphic;var p=this._findMover(h);p&&(this.toolbar.onVertexMouseOver(this.graphic,p._getInfo()),p._placeholder||(this._selectedMover=p,this._canDel&&this._bindCtxNode(h.getDojoShape().getNode())))},_mouseOutHandler:function(h){if(h=
this._findMover(h.graphic))this.toolbar.onVertexMouseOut(this.graphic,h._getInfo())},_bindCtxNode:function(h){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(h);this._bindNode=h},_unbindCtxNode:function(){var h=this._bindNode;h&&this._ctxMenu.unBindDomNode(h)},_findMover:function(h){var p=[];var k=this._mpVertexMovers;I.forEach(this._vertexMovers,function(m){p=p.concat(m)});k&&I.forEach(k,function(m){p=p.concat(m)});
for(k=0;k<p.length;k++){var n=p[k];if(n.graphic===h)return n}},_firstMoveHandler:function(h){!this._isNew(h)&&this._canAdd&&this._hideRelatedMidpoints(h);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(h,p){var k=this._isNew(h);p&&(p.dx||p.dy)?(this._updateRelatedGraphic(h,h.relatedGraphic,h.graphic.geometry,h.segIndex,h.ptIndex,h.segLength,k),this._canAdd&&(k?this._addMidpoints(h):(this._repositionRelatedMidpoints(h),this._showRelatedMidpoints(h))),this.toolbar._endOperation("VERTICES")):
!k&&this._canAdd&&this._showRelatedMidpoints(h)},_showRelatedMidpoints:function(h){var p=this._getAdjacentMidpoints(h.ptIndex,h.segLength),k=this._mpVertexMovers[h.segIndex];for(h=0;h<p.length;h++){var n=k[p[h]];n.graphic.show();n.refresh()}},_hideRelatedMidpoints:function(h){var p=this._getAdjacentMidpoints(h.ptIndex,h.segLength),k=this._mpVertexMovers[h.segIndex];for(h=0;h<p.length;h++)k[p[h]].graphic.hide()},_repositionRelatedMidpoints:function(h){var p,k=this._getAdjacentMidpoints(h.ptIndex,h.segLength),
n=this._mpVertexMovers[h.segIndex];for(p=0;p<k.length;p++){var m=this._getAdjacentVertices(k[p],h.segLength),C=h.relatedGraphic.geometry.getPoint(h.segIndex,m[0]);m=h.relatedGraphic.geometry.getPoint(h.segIndex,m[1]);C=new t({x:(C.x+m.x)/2,y:(C.y+m.y)/2,spatialReference:C.spatialReference.toJson()});n[k[p]].graphic.setGeometry(C)}},_addMidpoints:function(h){var p=h.segIndex,k=h.ptIndex,n=h.segLength,m=k+1,C,B=n+1;this._mpVertexMovers[p].splice(k,1);var y=this._vertexMovers[p];for(C=0;C<m;C++)y[C].segLength+=
1;for(C=m;C<y.length;C++)y[C].ptIndex+=1,y[C].segLength+=1;h.ptIndex=m;h.segLength=y.length+1;y.splice(m,0,h);h.graphic.setSymbol(this._symbol1);y=this._mpVertexMovers[p];for(C=0;C<k;C++)y[C].segLength+=1;for(C=k;C<n-1;C++)y[C].ptIndex+=1,y[C].segLength+=1;m=this._getAdjacentVertices(k,B);p=this._getAdjacentVertices(k+1,B);n=h.relatedGraphic.geometry.getPoint(h.segIndex,m[0]);C=h.relatedGraphic.geometry.getPoint(h.segIndex,m[1]);m=new t({x:(n.x+C.x)/2,y:(n.y+C.y)/2,spatialReference:n.spatialReference.toJson()});
n=h.relatedGraphic.geometry.getPoint(h.segIndex,p[0]);C=h.relatedGraphic.geometry.getPoint(h.segIndex,p[1]);p=new t({x:(n.x+C.x)/2,y:(n.y+C.y)/2,spatialReference:n.spatialReference.toJson()});n=new w(m,this._symbol2,this.graphic,h.segIndex,k,B,this,!0);h=new w(p,this._symbol2,this.graphic,h.segIndex,k+1,B,this,!0);y.splice(k,0,n,h)},_deleteVertex:function(h){var p,k=h.ptIndex,n=this._vertexMovers[h.segIndex];for(p=0;p<k;p++)--n[p].segLength;for(p=k+1;p<n.length;p++){var m=n[p];--m.ptIndex;--m.segLength}n.splice(k,
1);p=h._getInfo();h.destroy();this.toolbar.onVertexDelete(this.graphic,p)}});J.mixin(A,{create:function(h,p,k){switch(h.geometry.type){case "multipoint":return new A.MultipointVertexEditor(h,p,k);case "polyline":return new A.PolylineVertexEditor(h,p,k);case "polygon":return new A.PolygonVertexEditor(h,p,k)}}});A.MultipointVertexEditor=O(A,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=K.connect(w,"onMoveStart",this,this._moveStartHandler);
K.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);K.disconnect(this._moveStartHandle)},_getSegments:function(h){var p=h.points,k=[],n=h.spatialReference;for(h=0;h<p.length;h++){var m=p[h];k.push(new t({x:m[0],y:m[1],spatialReference:n.toJson()}))}return[k]},_getMidpointSegments:function(h){return[]},_getControlPoints:function(h,p,k,n,m){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(h){var p=h.graphic;if(h=this._findMover(h))this.toolbar.onVertexMouseOver(p,
h._getInfo()),this._selectedMover=h,this._canDel&&this._bindCtxNode(h.graphic.getDojoShape().getNode())},_mouseOutHandler:function(h){var p=h.graphic;if(h=this._findMover(h))this.toolbar.onVertexMouseOut(p,h._getInfo())},_findMover:function(h){var p=[].concat(this._vertexMovers[0]),k=h.target;for(h=0;h<p.length;h++){var n=p[h];if(n.graphic.getDojoShape().getNode()===k)return n}},_moveStartHandler:function(h){var p=h.ptIndex,k=h.segLength-1,n=h.relatedGraphic.geometry.points;h=n.splice(p,1);n.push(h[0]);
n=this._vertexMovers[0];for(h=k;h>p;h--)--n[h].ptIndex;h=n.splice(p,1);n.push(h[0]);h[0].ptIndex=k},_moveStopHandler:function(h){this._updateRelatedGraphic(h,h.relatedGraphic,h.graphic.geometry,h.segIndex,h.ptIndex,h.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(h,p,k,n,m,C,B,y){h=p.geometry;y?h.removePoint(m):h.setPoint(m,k);p.setGeometry(h)},_deleteMidpoints:function(h){}});A.PolylineVertexEditor=O(A,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(h){var p,k,n=h.paths,m=[];for(p=0;p<n.length;p++){var C=n[p],B=[];for(k=0;k<C.length;k++)B.push(h.getPoint(p,k));m.push(B)}return m},_getMidpointSegments:function(h){var p,k,n=h.paths,m=[],C=h.spatialReference;for(p=0;p<n.length;p++){var B=n[p],y=[];for(k=0;k<B.length-1;k++){var G=h.getPoint(p,k),f=h.getPoint(p,k+1);G=new t({x:(G.x+f.x)/2,y:(G.y+f.y)/2,spatialReference:C.toJson()});y.push(G)}m.push(y)}return m},_getControlPoints:function(h,p,k,n,m){var C=this.map,B,y;this._isNew(h)?
(h=n,n+=1,0<=h&&(B=C.toScreen(p.getPoint(k,h))),n<=m&&(y=C.toScreen(p.getPoint(k,n)))):(h=n-1,n+=1,0<=h&&(B=C.toScreen(p.getPoint(k,h))),n<m&&(y=C.toScreen(p.getPoint(k,n))));return[B,y]},_getAdjacentMidpoints:function(h,p){var k=[],n=h-1;0<=n&&k.push(n);h<p-1&&k.push(h);return k},_getAdjacentVertices:function(h,p){return[h,h+1]},_deleteMidpoints:function(h){var p=this._mpVertexMovers[h.segIndex],k=p.length-1,n=this._getAdjacentMidpoints(h.ptIndex,h.segLength).sort(),m,C=n[0];for(m=0;m<C;m++)--p[m].segLength;
for(m=C+1;m<p.length;m++){var B=p[m];--B.ptIndex;--B.segLength}if(1===n.length)p.splice(C,1)[0].destroy();else for(B=this._getAdjacentVertices(C,k),m=h.relatedGraphic.geometry.getPoint(h.segIndex,B[0]),B=h.relatedGraphic.geometry.getPoint(h.segIndex,B[1]),m=new t({x:(m.x+B.x)/2,y:(m.y+B.y)/2,spatialReference:m.spatialReference.toJson()}),h=new w(m,this._symbol2,this.graphic,h.segIndex,C,k,this,!0),p=p.splice(C,n.length,h),m=0;m<p.length;m++)p[m].destroy()},_updateRelatedGraphic:function(h,p,k,n,m,
C,B,y){h=p.geometry;B?h.insertPoint(n,m+1,g.fromJson(k.toJson())):y?h.removePoint(n,m):h.setPoint(n,m,g.fromJson(k.toJson()));p.setGeometry(h)}});A.PolygonVertexEditor=O(A,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(h){var p,k,n=h.rings,m=[];for(p=0;p<n.length;p++){var C=n[p],B=[];for(k=0;k<C.length-1;k++)B.push(h.getPoint(p,k));m.push(B)}return m},_getMidpointSegments:function(h){var p,k,n=h.rings,m=[],C=h.spatialReference;for(p=0;p<n.length;p++){var B=n[p],
y=[];for(k=0;k<B.length-1;k++){var G=h.getPoint(p,k),f=h.getPoint(p,k+1);G=new t({x:(G.x+f.x)/2,y:(G.y+f.y)/2,spatialReference:C.toJson()});y.push(G)}m.push(y)}return m},_getControlPoints:function(h,p,k,n,m){var C=this.map;this._isNew(h)?h=n:(h=n-1,h=0>h?(m+h)%m:h);n=(n+1)%m;m=C.toScreen(p.getPoint(k,h));p=C.toScreen(p.getPoint(k,n));return[m,p]},_getAdjacentMidpoints:function(h,p){var k=h-1;return[0>k?(p+k)%p:k,h]},_getAdjacentVertices:function(h,p){return[h,(h+1)%p]},_deleteMidpoints:function(h){var p=
h.ptIndex,k=this._mpVertexMovers[h.segIndex],n=k.length-1,m=this._getAdjacentMidpoints(p,h.segLength).sort();var C=m[0];var B=m[m.length-1];if(0===p){var y=this._getAdjacentVertices(n-1,n);p=h.relatedGraphic.geometry.getPoint(h.segIndex,y[0]);y=h.relatedGraphic.geometry.getPoint(h.segIndex,y[1]);p=new t({x:(p.x+y.x)/2,y:(p.y+y.y)/2,spatialReference:p.spatialReference.toJson()});h=new w(p,this._symbol2,this.graphic,h.segIndex,n-1,n,this,!0);k.splice(B,1,h)[0].destroy();k.splice(C,1)[0].destroy();for(m=
0;m<k.length-1;m++)C=k[m],--C.ptIndex,--C.segLength}else{y=this._getAdjacentVertices(C,n);p=h.relatedGraphic.geometry.getPoint(h.segIndex,y[0]);y=h.relatedGraphic.geometry.getPoint(h.segIndex,y[1]);p=new t({x:(p.x+y.x)/2,y:(p.y+y.y)/2,spatialReference:p.spatialReference.toJson()});h=new w(p,this._symbol2,this.graphic,h.segIndex,C,n,this,!0);B=k.splice(C,m.length,h);for(m=0;m<B.length;m++)B[m].destroy();for(m=0;m<C;m++)--k[m].segLength;for(m=C+1;m<k.length;m++)C=k[m],--C.ptIndex,--C.segLength}},_updateRelatedGraphic:function(h,
p,k,n,m,C,B,y){h=p.geometry;B?h.insertPoint(n,m+1,g.fromJson(k.toJson())):y?(h.removePoint(n,m),0===m&&h.setPoint(n,C-1,g.fromJson(h.getPoint(n,0).toJson()))):(h.setPoint(n,m,g.fromJson(k.toJson())),0===m&&h.setPoint(n,C,g.fromJson(k.toJson())));p.setGeometry(h)}});v("extend-esri")&&(J.setObject("toolbars._GraphicVertexEditor",A,a),J.setObject("toolbars._MultipointVertexEditor",A.MultipointVertexEditor,a),J.setObject("toolbars._PolylineVertexEditor",A.PolylineVertexEditor,a),J.setObject("toolbars._PolygonVertexEditor",
A.PolygonVertexEditor,a));return A})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,A){O=O(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(h,p,k,n,m,C,B,y){this.point=h;this.symbol=p;this.relatedGraphic=k;this.segIndex=n;this.ptIndex=
m;this.segLength=C;this.editor=B;this.map=B.map;this._scratchGL=B.toolbar._scratchGL;this._placeholder=y||!1;this._type=k.geometry.type;this._init();this._enable()},refresh:function(h){if(h||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var h=new g(this.point.toJson());
h=new l(h,this.symbol);switch(this._type){case "multipoint":h._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(h)}this.graphic=h},_enable:function(){var h=this.graphic.getDojoShape();h&&(h._hasMover=!0,this._moveable=this._getMoveable(h),(h=h.getEventSource())&&v.set(h,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var h=this._moveable;if(h){K.disconnect(this._startHandle);
K.disconnect(this._firstHandle);K.disconnect(this._movingHandle);K.disconnect(this._stopHandle);var p=h.shape;p&&(p=p.getEventSource())&&v.set(p,"cursor","inherit");h.destroy();this._moveable=null}},_needRefresh:function(){var h=this.graphic.getDojoShape(),p=!1;if(h)switch(this._type){case "multipoint":var k=this.relatedGraphic.getDojoShape();k&&(k=k.children[this.ptIndex],h!==k&&(this.graphic._shape=k,p=!0));break;case "polyline":case "polygon":p=!h._hasMover}return p},_getMoveable:function(h){h=
new e(h,I("mac")&&I("ff")&&!t("esri-touch")&&{leftButtonOnly:!0});this._startHandle=K.connect(h,"onMoveStart",this,this._moveStartHandler);this._firstHandle=K.connect(h,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=K.connect(h,"onMoving",this,this._movingHandler);this._stopHandle=K.connect(h,"onMoveStop",this,this._moveStopHandler);return h},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(h){var p=this.map;p.snappingManager&&p.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();h.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(h){var p=h.shape,k=this._getControlEdges(),n=this._scratchGL._div,m,C=[],B=h.host.shape._wrapOffsets[0]||
0;for(m=0;m<k.length;m++){var y=k[m];y.x1+=B;y.x2+=B;C.push([n.createLine({x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2}).setStroke(this.editor._lineStroke),y.x1,y.y1,y.x2,y.y2])}p._lines=C;h.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(h,p,k){p=this.map;var n;t("esri-pointer")?n=p.navigationManager.pointerEvents._processTouchEvent(k,k):k&&"pointermove"===k.type&&(n=w.prototype._processTouchEvent.call({map:p},
k,k));n&&p.snappingManager&&p.snappingManager._onSnappingMouseMoveHandler(n);k=h.shape;h=k.getTransform();k=k._lines;for(n=0;n<k.length;n++)p=k[n],p[0].setShape({x1:p[1]+h.dx,y1:p[2]+h.dy,x2:p[3],y2:p[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),h)},_moveStopHandler:function(h){h=h.shape;var p=this.editor.toolbar,k=h.getTransform(),n=this.map,m=this.graphic,C=p._geo?A.geographicToWebMercator(m.geometry):m.geometry;p._activateScrollWheel();var B,y=h._lines;if(y){for(B=
0;B<y.length;B++)y[B][0].removeShape();h._lines=null}B=!1;y=!0;var G=this._getInfo();k&&(k.dx||k.dy)?this._placeholder&&(this._placeholder=!1,B=!0):y=!1;if(n.snappingManager)var f=n.snappingManager._snappingPoint;var b=[k,d.invert(this._startTx)];f=f||n.toMap(d.multiplyPoint(b,n.toScreen(C,!0)));n.snappingManager&&n.snappingManager._killOffSnapping();h.setTransform(null);m.setGeometry(p._geo?A.webMercatorToGeographic(f,!0):f);this.constructor.onMoveStop(this,k);p.onVertexMoveStop(this.relatedGraphic,
G,k);if(!y)p.onVertexClick(this.relatedGraphic,G);if(B)p.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var h=this.map,p=this.relatedGraphic.geometry,k=this.segIndex,n=this.ptIndex,m=this.segLength,C=this._scratchGL.getNavigationTransform(),B=C.dx;C=C.dy;var y=h.toScreen(this.graphic.geometry);h=y.x-B;y=y.y-C;var G=[];p=this.editor._getControlPoints(this,p,k,n,m);p[0]&&G.push({x1:h,y1:y,x2:p[0].x-B,y2:p[0].y-C});p[1]&&G.push({x1:h,y1:y,x2:p[1].x-B,y2:p[1].y-C});return G}});
t("extend-esri")&&J.setObject("toolbars.VertexMover",O,a);J.mixin(O,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return O})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(O,J,K,I,v,e,d,a,w,t){O=O(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(g,l,A){this._graphic=g;this._map=l;
this._toolbar=A;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(g){this._editBox?(K.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=K.connect(g.getLayer(),"onDblClick",this,function(l){this._map.navigationManager.setImmediateClick(!1);l.graphic==g&&(I.stop(l),K.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(g))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(K.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(g,l){if(!this._editBox){if(!g.symbol.text){g.symbol.text="Tempt text";g.setSymbol(g.symbol);var A=""}var h=this._createInputTextStyle(g,this._map);""!==A&&(A=l||g.symbol.text);this._editBox=e.create("input",{type:"text",value:A});
a.set(this._editBox,h);d.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=K.connect(this._editBox,"onkeyup",J.hitch(this,function(k){k.keyCode!=w.ENTER&&k.keyCode!==w.TAB||this._disable()}));this._editBoxBlurHandler=K.connect(this._editBox,"onblur",J.hitch(this,function(k){this._disable()}));g.symbol.text="";g.setSymbol(g.symbol);g.hide();var p=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
J.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(k){a.set(p,{left:this._editBoxLeft+k.delta.x+"px",top:this._editBoxTop+k.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(p,"left"));this._editBoxTop=parseFloat(a.get(p,"top"))});this.onEditStart(g,this._editBox);this._toolbar.onTextEditStart(g,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(K.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(K.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(g,
l){l=g.getDojoShape().getTransformedBoundingBox();var A=g.getLayer();A=A.hasLocalNavigationTransform()?{dx:0,dy:0}:A.getNavigationTransform();var h=g.symbol.font;return{"font-family":h.family,"font-size":h.size+"px","font-style":h.style,"font-variant":h.variant,"font-weight":h.weight,left:l[0].x+A.dx+"px",top:l[0].y+A.dy+"px",width:Math.abs(l[0].x-l[1].x)/Math.cos(g.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var g=this._graphic.symbol;
g.text=this._editBox.value;this._graphic.setSymbol(g)}else this._graphic.getLayer().remove(this._graphic)}});v("extend-esri")&&J.setObject("toolbars.TextEditor",O,t);return O})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ./FeatureTable/dataUtils ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R,N,r,E,q,u,x,H,L,Q,T,M,P,V){var X=O([b,C,B],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:V,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(S,U){J.mixin(this,k.widgets.attributeInspector);S=S||{};S.featureLayer||S.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(S);this._layerInfos=S.layerInfos||[{featureLayer:S.featureLayer,options:S.options||[]}];this._layerInfos=K.filter(this._layerInfos,function(W){return!W.disableAttributeUpdate});this._hideNavButtons=S.hideNavButtons||!1},postCreate:function(){if(K.every(this._layerInfos,
function(U){return U.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var S=this._layerInfos.length;K.forEach(this._layerInfos,function(U){U=U.featureLayer;if(U.loaded)S--;else var W=I.connect(U,"onLoad",this,function(Y){I.disconnect(W);W=null;S--;S||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();K.forEach(this._aiConnects,I.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(S,U){U&&(this._createOnlyFirstTime=!0);
this._updateSelection([S],U);this._updateUI()},onLayerSelectionChange:function(S,U,W){this._createOnlyFirstTime=!1;this._featureIdx=W===p.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(S,U,W,Y){},onLayerError:function(S,U,W,Y){},onLayerEditsError:function(S,
U,W,Y){},onLayerEditsComplete:function(S,U,W,Y){Y=Y||[];if(Y.length){var Z=this._selection,da=S.featureLayer.objectIdField;K.forEach(Y,J.hitch(this,function(ca){K.some(Z,J.hitch(this,function(ba,ea){if(ba.attributes[da]!==ca.objectId)return!1;this._selection.splice(ea,1);return!0}))}))}U=U||[];U.length&&(this._selection=c.findFeatures(U,S.featureLayer),this._featureIdx=0);Y=this._numFeatures=(this._selection=c.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(U.length){if(U=
Y?this._selection[this._featureIdx]:null)Y=U.getLayer().getEditCapabilities(),Y.canCreate&&!Y.canUpdate||this._showFeature(U);this._updateUI()}W=W||[];if(W.length){var aa=this._rollbackInfo;K.forEach(W,function(ca){var ba=c.findFeatures(W,S.featureLayer)[0];if(!ca.success&&ba.attributes[S.featureLayer.objectIdField]===ca.objectId&&aa){var ea=aa.field;ca=aa.graphic.attributes[ea.name];var fa=K.filter(this._currentLInfo.fieldInfos,function(ha){return ha.fieldName===ea.name},this)[0].dijit;ba.attributes[ea.name]=
ca;"esriFieldTypeDate"===ea.type&&(ca=new Date(ca));this._setValue(fa,ca)}},this)}this._rollbackInfo=null},onFieldValueChange:function(S,U){var W=S.field,Y=S.dijit,Z=this._currentFeature,da=this._currentLInfo,aa=W.name;S=this._isFieldRequired(W,S);if(""===Y.displayedValue||"dijit.form.ValidationTextBox"!==Y.declaredClass||Y.isValid())if(""!==Y.displayedValue&&Y.displayedValue!==U&&Y.isValid&&!Y.isValid())this._setValue(Y,Z.attributes[W.name]);else{var ca=!("esriFieldTypeInteger"!==W.type&&"esriFieldTypeSmallInteger"!==
W.type&&"esriFieldTypeSingle"!==W.type&&"esriFieldTypeDouble"!==W.type);if(S&&(null===U||""===U||"undefined"===typeof U||ca&&isNaN(U))){aa=Z.attributes[W.name];if("esriFieldTypeDate"===W.type&&(aa=new Date(aa),Y instanceof Array)){this._setValue(Y[0],aa);this._setValue(Y[1],aa);return}this._setValue(Y,aa)}else{if(ca){if(isNaN(U)||""===U)U=null;ca&&null!==U&&(U=Number(U))}"esriFieldTypeDate"===W.type&&(Y instanceof Array?(U=Y[0].getValue(),Y=Y[1].getValue(),U=U&&Y?new Date(U.getFullYear(),U.getMonth(),
U.getDate(),Y.getHours(),Y.getMinutes(),Y.getSeconds(),Y.getMilliseconds()):U||Y||null):(U=Y.getValue(),W.domain&&(U=Number(U))),U=U&&U.getTime?U.getTime():U&&U.toGregorian?U.toGregorian().getTime():U);if(this._currentFeature.attributes[W.name]!==U){if(aa===da.typeIdField){var ba=this._findFirst(da.types,"id",U);K.forEach(da.fieldInfos,function(ea){(W=ea.field)&&W.name!==da.typeIdField&&(ea=ea.dijit,this._setFieldDomain(ea,ba,W)&&ea&&(this._setValue(ea,Z.attributes[W.name]+""),!1===ea.isValid()&&
this._setValue(ea,null)))},this)}this.onAttributeChange(Z,aa,U)}}}else this._setValue(Y,Z.attributes[W.name])},onDeleteBtn:function(S){this._deleteFeature()},onNextFeature:function(S){this._onNextFeature(1)},onPreviousFeature:function(S){this._onNextFeature(-1)},onFirstFeature:function(S){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(S){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var S=this._layerInfos;this._editorTrackingInfos={};K.forEach(S,
this._initLayerInfo,this)},_initLayerInfo:function(S){var U=S.featureLayer,W;this._userIds={};var Y=U.id;U.credential&&(this._userIds[Y]=U.credential.userId);S.userId&&(this._userIds[Y]=S.userId);this._connect(U,"onSelectionComplete",J.hitch(this,"onLayerSelectionChange",S));this._connect(U,"onSelectionClear",J.hitch(this,"onLayerSelectionClear",S));this._connect(U,"onEditsComplete",J.hitch(this,"onLayerEditsComplete",S));this._connect(U,"error",J.hitch(this,"onLayerError",S));this._connect(U,"onUpdateEnd",
J.hitch(this,"onLayerUpdateEnd",S));S.showAttachments=U.hasAttachments?l.isDefined(S.showAttachments)?S.showAttachments:!0:!1;S.hideFields=S.hideFields||[];S.htmlFields=S.htmlFields||[];S.isEditable=U.isEditable()?l.isDefined(S.isEditable)?S.isEditable:!0:!1;S.typeIdField=U.typeIdField;S.layerId=U.id;S.types=U.types;U.globalIdField&&((W=this._findFirst(S.fieldInfos,"fieldName",U.globalIdField))||S.showGlobalID||S.hideFields.push(U.globalIdField));(Y=this._findFirst(S.fieldInfos,"fieldName",U.objectIdField))||
S.showObjectID||S.hideFields.push(U.objectIdField);var Z=this._getFields(S.featureLayer);if(Z){var da=S.fieldInfos||[];da=K.map(da,function(aa){return J.mixin({},aa)});da.length?S.fieldInfos=K.filter(K.map(da,J.hitch(this,function(aa){var ca=aa.stringFieldOption||(this._isInFields(aa.fieldName,S.htmlFields)?X.STRING_FIELD_OPTION_RICHTEXT:X.STRING_FIELD_OPTION_TEXTBOX);return J.mixin(aa,{field:this._findFirst(Z,"name",aa.fieldName),stringFieldOption:ca})})),"return item.field;"):(Z=K.filter(Z,J.hitch(this,
function(aa){return!this._isInFields(aa.name,S.hideFields)})),S.fieldInfos=K.map(Z,J.hitch(this,function(aa){var ca=this._isInFields(aa.name,S.htmlFields)?X.STRING_FIELD_OPTION_RICHTEXT:X.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:aa.name,field:aa,stringFieldOption:ca}})));S.showGlobalID&&!W&&da.push(this._findFirst(Z,"name",U.globalIdField));S.showObjectID&&!Y&&da.push(this._findFirst(Z,"name",U.objectIdField));W=[];U.editFieldsInfo&&(U.editFieldsInfo.creatorField&&W.push(U.editFieldsInfo.creatorField),
U.editFieldsInfo.creationDateField&&W.push(U.editFieldsInfo.creationDateField),U.editFieldsInfo.editorField&&W.push(U.editFieldsInfo.editorField),U.editFieldsInfo.editDateField&&W.push(U.editFieldsInfo.editDateField));this._editorTrackingInfos[U.id]=W}},_createAttachmentEditor:function(){this._attachmentEditor=null;var S=K.filter(this._layerInfos,function(U){return U.showAttachments});S&&S.length&&(this._attachmentEditor=new z({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(S){var U=this._currentLInfo?this._currentLInfo.featureLayer:null,W=S.featureLayer;if(U&&U.id===W.id&&!U.ownershipBasedAccessControlForFeatures&&(U=W.getEditCapabilities(),!U.canCreate||U.canUpdate))return;this._currentLInfo=S;this._createTable()},_updateSelection:function(S,U){this._selection=S||[];K.forEach(this._layerInfos,this._getSelection,this);this._selection=c.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?
this._selection[this._featureIdx]:null,U)},_getSelection:function(S){S=S.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(S)},_updateUI:function(){var S=this._numFeatures,U=this._currentLInfo;this.layerName.innerHTML=U&&0!==S?U.featureLayer?U.featureLayer.name:"":this.NLS_noFeaturesSelected;a.set(this.attributeTable,"display",S?"":"none");a.set(this.editButtons,"display",S?"":"none");a.set(this.navButtons,"display",!this._hideNavButtons&&1<S?"":"none");this.navMessage.innerHTML=
l.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&a.set(this._attachmentEditor.domNode,"display",U&&U.showAttachments&&S?"":"none");a.set(this.deleteBtn.domNode,"display",U&&!1===U.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(S){this._featureIdx+=S;0>this._featureIdx?this._featureIdx=this._numFeatures-
1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);S=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(S);this._updateUI();this.onNext(S)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(S,U){if(S){this._currentFeature=S;U=U?U:S.getLayer();var W=U.getEditCapabilities({feature:S,userId:this._userIds[U.id]});this._canUpdate=W.canUpdate;this._canDelete=W.canDelete;if(W=this._getLInfoFromFeatureLayer(U)){this._setCurrentLInfo(W);
var Y=S.attributes,Z=this._findFirst(W.types,"id",Y[W.typeIdField]),da=null;K.forEach(W.fieldInfos,function(aa){da=aa.field;var ca=[];aa.dijit&&1<aa.dijit.length?K.forEach(aa.dijit,function(ba){ca.push(ba)}):ca.push(aa.dijit);K.forEach(ca,J.hitch(this,function(ba){if(ba){var ea=this._setFieldDomain(ba,Z,da),fa=Y[da.name];fa=fa&&ea&&ea.codedValues&&ea.codedValues.length?ea.codedValues[fa]?ea.codedValues[fa].name:fa:fa;l.isDefined(fa)||(fa="");"dijit.form.DateTextBox"===ba.declaredClass||"dijit.form.TimeTextBox"===
ba.declaredClass?fa=""===fa?null:new Date(fa):"dijit.form.FilteringSelect"===ba.declaredClass&&(ba._lastValueReported=null,fa=Y[da.name]+"");try{this._setValue(ba,fa),"dijit.form.FilteringSelect"===ba.declaredClass&&!1===ba.isValid()&&this._setValue(ba,null)}catch(ha){ba.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&W.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,U);(S=U.getEditSummary(S))?(this.editorTrackingInfoDiv.innerHTML=S,
A.show(this.editorTrackingInfoDiv)):A.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(S,U,W){if(!S)return null;var Y=W.domain;U&&U.domains&&U.domains[W.name]&&!1===U.domains[W.name]instanceof h&&(Y=U.domains[W.name]);if(!Y)return null;Y.codedValues&&0<Y.codedValues.length?(S.set("store",this._toStore(K.map(Y.codedValues,function(Z){return{id:Z.code+"",name:Z.name}}))),this._setValue(S,Y.codedValues[0].code+"")):(S.constraints={min:l.isDefined(Y.minValue)?Y.minValue:Number.MIN_VALUE,max:l.isDefined(Y.maxValue)?
Y.maxValue:Number.MAX_VALUE},this._setValue(S,S.constraints.min));return Y},_setValue:function(S,U){S.set&&(S._onChangeActive=!1,S.set("value",U,!0),S._onChangeActive=!0)},_getFields:function(S){var U=S._getOutFields();if(!U)return null;S=S.fields;return"*"==U?S:K.filter(K.map(U,J.hitch(this,"_findFirst",S,"name")),l.isDefined)},_isInFields:function(S,U){return S&&(U||U.length)?K.some(U,function(W){return W.toLowerCase()===S.toLowerCase()}):!1},_isFieldNullable:function(S,U){return!(!1===S.nullable||
U.field&&!1===U.field.nullable)},_isFieldRequired:function(S,U){return!1!==S.editable&&!1!==U.isEditable&&!this._isFieldNullable(S,U)},_findFirst:function(S,U,W){return(S=K.filter(S,function(Y){return Y.hasOwnProperty(U)&&Y[U]===W}))&&S.length?S[0]:null},_getLInfoFromFeatureLayer:function(S){return this._findFirst(this._layerInfos,"layerId",S?S.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=w.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var S=w.create("tbody",null,this._attributes),U=this._currentLInfo,W=this._findFirst(U.types,"id",this._currentFeature.attributes[U.typeIdField]);K.forEach(U.fieldInfos,J.hitch(this,"_createField",W,S),this);this._createOnlyFirstTime=!1},_createField:function(S,U,W){var Y=this._currentLInfo,Z=W.field;if(!this._isInFields(Z.name,Y.hideFields)&&!this._isInFields(Z.name,this._editorTrackingInfos[Y.featureLayer.id])){var da=!1,aa;U=w.create("tr",null,U);var ca=W.label||Z.alias||Z.name;
ca=t.sanitizer?t.sanitizer.sanitize(ca):htmlEntities.encode(ca);ca=w.create("td",{innerHTML:ca,"class":this.css.label,"data-fieldname":Z.name},U);this._isFieldRequired(Z,W)&&w.create("span",{"class":this.css.red,innerHTML:" *"},ca);U=w.create("td",null,U);if(W.customField){w.place(W.customField.domNode||W.customField,w.create("div",null,U),"first");var ba=W.customField}else if(!1===Y.isEditable||!1===Z.editable||!1===W.isEditable||"esriFieldTypeOID"===Z.type||"esriFieldTypeGlobalID"===Z.type||!this._canUpdate&&
!this._createOnlyFirstTime)da=!0;Y=Y.typeIdField&&Z.name.toLowerCase()==Y.typeIdField.toLowerCase();ca=!!this._getDomainForField(Z,S);!ba&&Y?ba=this._createTypeField(Z,W,U):!ba&&ca&&(ba=this._createDomainField(Z,W,S,U));if(!ba)switch(Z.type){case "esriFieldTypeString":ba=this._createStringField(Z,W,U);break;case "esriFieldTypeDate":ba=this._createDateField(Z,W,U);W.format&&W.format.time&&(aa=this._createTimeField(Z,W,U));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":ba=this._createIntField(Z,
W,U);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":ba=this._createFltField(Z,W,U);break;default:ba=this._createStringField(Z,W,U)}W.tooltip&&W.tooltip.length&&this._toolTips.push(new L({connectId:[ba.id],label:W.tooltip}));ba.onChange=J.hitch(this,"onFieldValueChange",W);ba.set("disabled",da);aa?(W.dijit=[ba,aa],aa.onChange=J.hitch(this,"onFieldValueChange",W),aa.set("disabled",da)):W.dijit=ba}},_createTypeField:function(S,U,W){W=w.create("div",null,W);var Y=S.domain;return Y&&"range"===
Y.type&&Y.minValue===Y.maxValue?new x({"class":this.css.field,trim:!0,maxLength:S.length,name:S.alias||S.name,required:this._isFieldRequired(S,U)},W):new r({"class":this.css.field,name:S.alias||S.name,required:this._isFieldRequired(S,U),store:this._toStore(K.map(this._currentLInfo.types,function(Z){return{id:Z.id,name:Z.name}})),searchAttr:"name"},W)},_getDomainForField:function(S,U){var W=S.domain;(S=S.name)&&U&&U.domains&&U.domains[S]&&!1===U.domains[S]instanceof h&&(W=U.domains[S]);return W||null},
_createDomainField:function(S,U,W,Y){W=this._getDomainForField(S,W);Y=w.create("div",null,Y);return W.codedValues?new r({"class":this.css.field,name:S.alias||S.name,searchAttr:"name",required:this._isFieldRequired(S,U)},Y):new E({"class":this.css.field},Y)},_createStringField:function(S,U,W){W=w.create("div",null,W);var Y={trim:!0,maxLength:S.length,required:this._isFieldRequired(S,U)};if(U.stringFieldOption===X.STRING_FIELD_OPTION_TEXTAREA)return Y["class"]=this.css.field+" "+this.css.textArea,new u(Y,
W);if(U.stringFieldOption===X.STRING_FIELD_OPTION_RICHTEXT)return Y["class"]=this.css.field+" "+this.css.richText,Y.height="100%",Y.width="100%",Y.plugins=U.richTextPlugins||this._defaultRichTextPlugins,W=new y(Y,W),W.startup(),W;var Z=this;Y.validator=function(da,aa){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return Z._isFieldNullable(S,U)||!(""===da||null===da)};return new x(Y,W)},_createTimeField:function(S,U,W){W=w.create("div",null,W);S={"class":this.css.field,trim:!0,required:this._isFieldRequired(S,
U),constraints:{formatLength:"medium"}};this._datePackage&&(S.datePackage=this._datePackage);return new H(S,W)},_createDateField:function(S,U,W){W=w.create("div",null,W);S={"class":this.css.field,trim:!0,required:this._isFieldRequired(S,U)};this._datePackage&&(S.datePackage=this._datePackage);return new F(S,W)},_createIntField:function(S,U,W){W=w.create("div",null,W);return new N({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===S.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,
invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(S,U)},W)},_createFltField:function(S,U,W){W=w.create("div",null,W);return new N({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(S,U)},W)},_toStore:function(S){return new Q({data:{identifier:"id",label:"name",items:S}})},_connect:function(S,U,W){this._aiConnects.push(I.connect(S,U,W))},_getDatePackage:function(S){return null===
S.datePackage?null:S.datePackage?S.datePackage:"ar"===e.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){K.forEach(this._layerInfos,function(S){K.forEach(S.fieldInfos,function(U){var W=U.dijit;if(W){W._onChangeHandle=null;if(U.customField)return;W instanceof Array?K.forEach(W,J.hitch(this,function(Y){Y.destroyRecursive?Y.destroyRecursive():Y.destroy&&Y.destroy();Y._onChangeHandle=null})):W.destroyRecursive?W.destroyRecursive():W.destroy&&W.destroy()}U.dijit=null},this)},this);K.forEach(this._toolTips,
function(S){S.destroy()});this._toolTips=[];this._attributes&&w.destroy(this._attributes)}});J.mixin(X,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});d("extend-esri")&&J.setObject("dijit.AttributeInspector",X,g);return X})},"esri/dijit/FeatureTable/dataUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/number dojo/string dojo/date/locale dojo/promise/all ../../libs/sanitizer/Sanitizer ../../config ../../graphic ../../numberUtils ../../request ../../ArcadeExpression ../../arcadeProfiles/popupProfile ../../layers/FeatureLayer ../../geometry/Extent ../../tasks/query ../../tasks/StatisticDefinition ../../tasks/QueryTask ../../tasks/RelationshipQuery dojo/i18n dojo/i18n!../../nls/jsapi".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G){return{i18nStrings:G.widgets.FeatureTable,numericFieldTypes:["esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeSmallInteger"],statisticDefinitions:[{type:"count",name:"countField"},{type:"sum",name:"sumField"},{type:"min",name:"minField"},{type:"max",name:"maxField"},{type:"avg",name:"avgField"},{type:"stddev",name:"stddevField"}],_reExprField:/^\s*expression\//i,sanitizer:new a({whiteList:{dd:[],dl:[],dt:[],h1:[],
h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],text:[],textpath:[],tspan:[],use:[]}},!0),getOrderByString:function(f,b){return f+(b?" DESC":" ASC")},getWhereString:function(f,b){return f+"\x3d'"+b+"'"},getRelationshipWhereClause:function(f){var b=f.layer,z=f.originRelationship,
c=f.destinationRelationship,D=z.relationshipTableId||z.relatedTableId;z=z.keyFieldInRelationshipTable||z.keyField;var F=c.keyFieldInRelationshipTable||c.keyField,R=b.layerId==D?F:z;f=this.getWhereString(R,f.keyValue);z=b._url.path;z=z.substring(0,z.lastIndexOf("/")+1);return l({url:z+D+"/query",content:{f:"json",outFields:["*"],returnGeometry:!1,where:f},handleAs:"json",callbackParamName:"callback"}).then(J.hitch(this,function(N){if(N&&N.features&&N.features.length){var r=N.features,E=[],q="",u;O.forEach(r,
function(x,H){if(x.attributes&&x.attributes[F])u=x.attributes[F];else{var L=b.getField(R)?b.getField(R).name:null;if(this.isValueEmpty(L)){L=F.toUpperCase();var Q=F.toLowerCase();u=x.attributes[L]||x.attributes[Q]||null}else u=x.attributes[L]}-1===O.indexOf(E,u)&&(0<E.length&&H<r.length&&(q=q.concat(" OR ")),E.push(u),q=q.concat(this.getWhereString(c.keyField,u)))},this);return q}return null}))},isValueEmpty:function(f){return null===f||" "===f||""===f||"undefined"===typeof f},findFirst:function(f,
b,z){return O.filter(f,function(c){return c.hasOwnProperty(b)&&c[b]===z})[0]||null},compareIntArrays:function(f,b){f.sort();b.sort();var z=O.every(b,function(D){return-1!==O.indexOf(f,D)},this),c=O.every(f,function(D){return-1!==O.indexOf(b,D)},this);return z&&c},findFirstNumberColumn:function(f,b){var z;O.some(f,function(c,D){if(-1!==O.indexOf(this.numericFieldTypes,c.type)&&c.field!==b&&!c.hidden)return z=c,!0},this);return z},getRoundingPrecision:function(f){return 1E3<=f?0:10<=f?2:0<=f?4:6},generateLinkFromString:function(f){var b=
/^\s*(http?:\/\/([^\s]+))\s*$/i,z=/^\s*(https?:\/\/([^\s]+))\s*$/i;if("string"===typeof f){var c;b.test(f)?c=f.indexOf("http:"):z.test(f)&&(c=f.indexOf("https:"));-1<c&&-1===f.indexOf("href\x3d")?(b=f.indexOf(" ",c),-1===b&&(b=f.length),z=f.substring(c,b),f=f.substring(0,c)+"\x3ca href\x3d'"+z+"' target\x3d'_blank'\x3e"+z+"\x3c/a\x3e"+f.substring(b,f.length)):f=this.sanitizer.sanitize(f)}return this.isValueEmpty(f)?"":f},isNumericFieldType:function(f){return-1!==O.indexOf(this.numericFieldTypes,f)},
isIntegerFieldType:function(f){return"esriFieldTypeInteger"===f||"esriFieldTypeSmallInteger"===f},isFloatFieldType:function(f){return"esriFieldTypeDouble"===f||"esriFieldTypeSingle"===f},getDomainValueFromRow:function(f){var b=f.fieldInfo.name,z=f.fieldInfo.domain,c=f.row;if("range"===z.type)return c[b];f=O.filter(z.codedValues,function(D){return D.hasOwnProperty("code")&&D.code==c[b]});return f[0]&&!this.isValueEmpty(f[0].name)?f[0].name:c[b]},getTypeValueFromRow:function(f){var b=f.layerInfo[f.typesProperty],
z=f.typeIdProperty,c=f.fieldInfo,D=f.row;f=b&&b[0];if(f){var F=D[c.name];c=this.isNumericFieldType(c.type);c=(f="string"===typeof f[z])&&c?F.toString():F;F=(F=this.findFirst(b,z,c))?F.name:null}return F},getSubtypeDomainValue:function(f){var b=f.layerInfo,z=f.fieldInfo.name,c=f.row,D;f=(b=this.findFirst(b.types,"id",c[b.typeIdField]))?b.domains:null;if(!b||!f)return c[z];f[z]&&f[z].codedValues&&(D=O.filter(f[z].codedValues,function(F){return F.hasOwnProperty("code")&&F.code==c[z]}));return D&&D[0]&&
!this.isValueEmpty(D[0].name)?D[0].name:c[z]},mergeDictionaries:function(f,b){if(null===f||null===b)return f;for(var z in b){f[z]||(f[z]={});for(var c in b[z])f[z][c]=b[z][c]}return f},isCyclicalRelationship:function(f){return"esriRelCardinalityOneToOne"===f.cardinality||"esriRelCardinalityOneToMany"===f.cardinality&&"esriRelRoleDestination"===f.role},getColumnFromFieldName:function(f){return this.findFirst(f.grid.columns,"field",f.fieldName)},isDateFieldWithStringDataValue:function(f){return"esriFieldTypeDateOnly"===
f||"esriFieldTypeTimeOnly"===f||"esriFieldTypeTimestampOffset"===f},formatNumberForLocale:function(f,b){if(b){var z=y.getLocalization("dojo.cldr","number");if(b.digitSeparator||!z||this.isValueEmpty(f))return isNaN(f)||null===f?null:I.format(f,b);f=isNaN(f)||null===f?null:I.format(f,b);return f.replace(new RegExp("\\"+z.group,"g"),"")}return isNaN(f)||null===f?null:g.format(f,b)},getCombinedDateTime:function(f,b){return new Date(f.getFullYear(),f.getMonth(),f.getDate(),b.getHours(),b.getMinutes(),
b.getSeconds())},formatDateForLocale:function(f){var b=f.dateOptions||{},z=f.timestamp,c=f.fieldInfo,D=!1,F=!1;f={};b=(D=c&&c.dateOptions?c.dateOptions:!1)||b;D=D&&this.isValueEmpty(b.dateEnabled)?!0:!!b.dateEnabled;F=!!b.timeEnabled;this.isValueEmpty(b.datePattern)||(f.datePattern=b.datePattern);this.isValueEmpty(b.timeEnabled)||this.isValueEmpty(b.timePattern)||(f.timePattern=b.timePattern);f.selector=D&&F?"date and time":D&&!F?"date":!D&&F?"time":"date";return e.format(new Date(z),f)},calculateExtentFromFeatures:function(f){var b=
f[0].geometry,z;if(null===b&&1===f.length)return null;for(b=f.length-1;0<=b;b--)null===f[b].geometry&&f.splice(b,1);b=f[0].geometry;var c=b.getExtent();var D=f.length;null===c&&(c=new k(b.x,b.y,b.x,b.y,b.spatialReference));for(z=1;z<D;z++){b=f[z].geometry;var F=b.getExtent();null===F&&(F=new k(b.x,b.y,b.x,b.y,b.spatialReference));c=c.union(F)}return c},initFeatureLayer:function(f,b){f=f._url.path;f=f.substring(0,f.lastIndexOf("/")+1);return new p(f+b,{mode:p.MODE_ONDEMAND,outFields:["*"],visible:!0})},
applyEdits:function(f){var b=[],z=new K;if(!f||0>=f.length)return z.reject(),z;O.forEach(f,function(c){c.layer&&b.push(c.layer.applyEdits(c.adds,c.updates,c.deletes,function(D,F,R){z.resolve({adds:D,updates:F,deletes:R})},function(D){z.reject(D)}))});0<b.length?d(b):z.reject();return z},applyEditsFromRow:function(f){var b=f.layer,z=new t;z.setAttributes(f.row);return this.applyEdits([{layer:b,updates:[z]}],null)},queryLayer:function(f){var b=f.layer;f=f.ids||null;var z=new n;z.where="1\x3d1";z.returnGeometry=
!1;z.objectIds=f;return b.queryFeatures(z)},queryLayerForFeature:function(f){return this.queryLayerForFeatures({layer:f.layer,ids:[f.id]})},queryLayerForFeatures:function(f){var b=f.layer,z=b.advancedQueryCapabilities;z=z&&z.supportsQueryWithCacheHint;f=f.ids;var c=new n;c.objectIds=f;c.outFields=["*"];z&&(c.cacheHint=!0);return b.queryFeatures(c,function(D){return D.features})},queryLayerForCount:function(f){var b=f.layer,z=b.advancedQueryCapabilities;z=z&&z.supportsQueryWithCacheHint;if(b.queryCount){var c=
new n,D=f.layerInfo;f=f.where||"1\x3d1";c.returnGeometry=!1;c.returnCountOnly=!0;c.where=f;z&&(c.cacheHint=!0);return b.queryCount(c).then(function(F){return F}).otherwise(function(){return D.isFeatureCollection?b.graphics.length:2E3}).always(function(F){return F})}return this.queryLayerCustom({layer:b,returnCountOnly:!0,cacheHint:z}).then(function(F){return F&&F.features?F.features.length:0}).otherwise(function(){return b.maxRecordCount||2E3}).always(function(F){return F})},queryLayerCustom:function(f){var b=
new n,z=f.returnCountOnly||!1,c=f.where||"1\x3d1",D=f.returnGeometry||!1,F=f.outFields||["*"],R=f.cacheHint||!1;f=new C(f.layer.url);b.returnGeometry=D;b.outFields=F;b.where=c;b.returnCountOnly=z;R&&(b.cacheHint=!0);return f.execute(b)},queryLayerForIds:function(f){var b=f.layer,z=b.advancedQueryCapabilities;z=z&&z.supportsQueryWithCacheHint;var c=f.idProperty;f=f.where||"1\x3d1";var D=new n;D.returnGeometry=!1;D.outFields=[c];D.where=f;D.returnIdsOnly=!0;z&&(D.cacheHint=!0);return b.queryIds(D)},
queryLayerForAttachments:function(f){return l({url:f.layer._url.path+"/queryAttachments",content:{f:"json",objectIds:f.ids},handleAs:"json",callbackParamName:"callback"})},queryLayerForAttachmentById:function(f){return f.layer.queryAttachmentInfos(f.id||0)},addAttachmentToLayer:function(f){return f.layer.addAttachment(f.featureId,f.formData)},deleteAttachmentFromLayer:function(f){return f.layer.deleteAttachments(f.featureId,[f.attachmentId])},queryLayerForRelatedRecords:function(f){var b=f.layer,
z=f.ids,c=f.outFields||["*"],D=f.relationship;f=f.returnCountOnly||!1;var F=new B;F.outFields=c;F.returnGeometry=!1;F.relationshipId=D.id;F.returnCountOnly=f;F.objectIds=z;return b.queryRelatedFeatures(F)},queryLayerForRelatedRecordCount:function(f){return l({url:f.layer._url.path+"/queryRelatedRecords",content:{f:"json",objectIds:f.objectIds.toString(),outFields:f.outFields,returnGeometry:!1,relationshipId:f.relationship.id,returnCountOnly:!0},handleAs:"json",callbackParamName:"callback"})},getFieldStatistics:function(f){var b=
new K,z=f.layer,c=z.advancedQueryCapabilities;c=c&&c.supportsQueryWithCacheHint;var D=f.idProperty,F=f.where||"1\x3d1",R=f.filterIds,N=f.grid.columns[f.columnId].field;f=z.url;var r=[];var E=O.map(this.statisticDefinitions,function(u){var x=new m;x.onStatisticField=N;x.displayFieldName=N;x.outStatisticFieldName=u.name;x.statisticType=u.type;return x});var q=new n;q.outFields=[N];q.outStatistics=[];q.where=F;q.outStatistics=E;c&&(q.cacheHint=!0);R&&0<R.length&&(r=R);q.where&&0<r.length&&(q.where="("+
q.where+") AND ("+D+" IN ("+r.toString()+"))");z.source&&!this.isValueEmpty(z.source.mapLayerId)&&f.endsWith("/dynamicLayer")&&(f=f.slice(0,-13),f=f+"/"+z.source.mapLayerId);(new C(f)).execute(q).then(function(u){b.resolve(u)}).otherwise(function(){b.reject()});return b},selectFeaturesById:function(f){var b=f.grid,z=b.layer;b=b.layerInfo;var c=f.map,D=f.ids;f=f.id;var F=new n;F.returnGeometry=!!c;F.objectIds=D||[f];b.isFeatureCollection||(F.where="1\x3d1");return z.selectFeatures(F,p.SELECTION_NEW)},
isFeatureEditable:function(f){var b=f.layerInfo;return!!f.layer.getEditCapabilities({userId:b.userIds[b.layerId]||null,feature:{attributes:f.attributes}}).canUpdate},isExpressionField:function(f){return this._reExprField.test(f)},getExpressionInfo:function(f,b){if(this.isExpressionField(b)){var z;b=b.replace(this._reExprField,"");b=b.toLowerCase();O.some(f,function(c){c.name.toLowerCase()===b&&(z=c);return!!z});return z}},compileExpressions:function(f){var b={};O.forEach(f,function(z){var c=z.returnType&&
z.returnType.toLowerCase();b[z.name]=new A({expression:z.expression,returnType:"number"===c?"number":"string",profile:h})});return b},getExpressionValue:function(f,b){var z=f.getLayer(),c=z&&z.getMap();return b?f.evaluateExpression(b,h.getEvalOptions({expression:b,feature:f,layer:z,map:c,spatialReference:c&&c.spatialReference})):null}}})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z){function c(F){return new B({command:F.name})}function D(F){return new B({buttonClass:C,command:F.name})}K=K("dijit.Editor",b,{plugins:null,extraPlugins:null,constructor:function(){g.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",y]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(l("ie")||l("trident")||l("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new I;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);g.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=v.getLocalization("dijit._editor",
"commands",this.lang);l("webkit")&&w.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new k({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));J.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);d.add(this.iframe.parentNode,"dijitEditorIFrameContainer");d.add(this.iframe,"dijitEditorIFrame");e.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){J.forEach(this._plugins,function(F){F&&F.destroy&&F.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(F,R){var N=g.isString(F)?{name:F}:g.isFunction(F)?{ctor:F}:F;if(!N.setEditor){var r={args:N,plugin:null,editor:this};N.name&&(B.registry[N.name]?r.plugin=B.registry[N.name](N):h.publish(z._scopeName+".Editor.getPlugin",r));if(!r.plugin)try{var E=
N.ctor||g.getObject(N.name)||O(N.name);E&&(r.plugin=new E(N))}catch(q){throw Error(this.id+": cannot find plugin ["+N.name+"]");}if(!r.plugin)throw Error(this.id+": cannot find plugin ["+N.name+"]");F=r.plugin}1<arguments.length?this._plugins[R]=F:this._plugins.push(F);F.setEditor(this);g.isFunction(F.setToolbar)&&F.setToolbar(this.toolbar)},resize:function(F){F&&m.prototype.resize.apply(this,arguments)},layout:function(){var F=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+a.getPadBorderExtents(this.iframe.parentNode).h+
a.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=F+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(F){var R,N=this.document.body,r=N.clientWidth,E=N.clientHeight,q=N.clientLeft,u=N.offsetWidth,x=N.offsetHeight,H=N.offsetLeft;/^rtl$/i.test(N.dir||"")?r<u&&F.x>r&&F.x<u&&(R=!0):F.x<q&&F.x>H&&(R=!0);R||E<x&&F.y>E&&F.y<x&&(R=!0);R||(delete this._cursorToStart,delete this._savedSelection,"BODY"==F.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(F){this.customUndo&&this.endEditing(!0);"BODY"!=F.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(F){this._inEditing||(this._inEditing=!0,this._beginEditing(F));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(F){if(!this.customUndo||
"undo"!=F&&"redo"!=F){this.customUndo&&(this.endEditing(),this._beginEditing());var R=this.inherited(arguments);this.customUndo&&this._endEditing();return R}return this[F]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(F){try{var R=this.document.execCommand(F,!1,null);if(l("webkit")&&!R)throw{};}catch(N){R=A.substitute,alert(R(this.commands.systemShortcut,
[this.commands[F],R(this.commands[l("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[F]])])),R=!1}return R},queryCommandEnabled:function(F){return!this.customUndo||"undo"!=F&&"redo"!=F?this.inherited(arguments):"undo"==F?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(F){var R=F.mark,N=F.mark;F=F.isCollapsed;var r;if(N)if(9>l("ie")||9===l("ie")&&l("quirks"))if(g.isArray(N))R=[],J.forEach(N,function(u){R.push(f.getNode(u,this.editNode))},this),this.selection.moveToBookmark({mark:R,
isCollapsed:F});else{if(N.startContainer&&N.endContainer&&(r=f.getSelection(this.window))&&r.removeAllRanges){r.removeAllRanges();F=f.create(this.window);var E=f.getNode(N.startContainer,this.editNode);var q=f.getNode(N.endContainer,this.editNode);E&&q&&(F.setStart(E,N.startOffset),F.setEnd(q,N.endOffset),r.addRange(F))}}else(r=f.getSelection(this.window))&&r.removeAllRanges&&(r.removeAllRanges(),F=f.create(this.window),E=f.getNode(N.startContainer,this.editNode),q=f.getNode(N.endContainer,this.editNode),
E&&q&&(F.setStart(E,N.startOffset),F.setEnd(q,N.endOffset),r.addRange(F)))},_changeToStep:function(F,R){this.setValue(R.text);(F=R.bookmark)&&this._moveToBookmark(F)},undo:function(){var F=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var R=this._steps.pop();R&&0<this._steps.length&&(this.focus(),this._changeToStep(R,this._steps[this._steps.length-1]),this._undoedSteps.push(R),this.onDisplayChanged(),delete this._undoRedoActive,F=!0);delete this._undoRedoActive}return F},
redo:function(){var F=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var R=this._undoedSteps.pop();R&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],R),this._steps.push(R),this.onDisplayChanged(),F=!0);delete this._undoRedoActive}return F},endEditing:function(F){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(F),this._inEditing=!1)},_getBookmark:function(){var F=this.selection.getBookmark(),
R=[];if(F&&F.mark){var N=F.mark;if(9>l("ie")||9===l("ie")&&l("quirks")){var r=f.getSelection(this.window);if(g.isArray(N))J.forEach(F.mark,function(q){R.push(f.getIndex(q,this.editNode).o)},this),F.mark=R;else if(r){var E;r.rangeCount&&(E=r.getRangeAt(0));F.mark=E?E.cloneRange():this.selection.getBookmark()}}try{F.mark&&F.mark.startContainer&&(R=f.getIndex(F.mark.startContainer,this.editNode).o,F.mark={startContainer:R,startOffset:F.mark.startOffset,endContainer:F.mark.endContainer===F.mark.startContainer?
R:f.getIndex(F.mark.endContainer,this.editNode).o,endOffset:F.mark.endOffset})}catch(q){F.mark=null}}return F},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:G.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var F=G.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:F,bookmark:this._getBookmark()})},onKeyDown:function(F){l("ie")||this.iframe||F.keyCode!=t.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var R=
F.keyCode;if(F.ctrlKey&&!F.shiftKey&&!F.altKey){if(90==R||122==R){F.stopPropagation();F.preventDefault();this.undo();return}if(89==R||121==R){F.stopPropagation();F.preventDefault();this.redo();return}}this.inherited(arguments);switch(R){case t.ENTER:case t.BACKSPACE:case t.DELETE:this.beginEditing();break;case 88:case 86:if(F.ctrlKey&&!F.altKey&&!F.metaKey){this.endEditing();88==F.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!F.ctrlKey&&!F.altKey&&
!F.metaKey&&(F.keyCode<t.F1||F.keyCode>t.F15)){this.beginEditing();break}case t.ALT:this.endEditing();break;case t.UP_ARROW:case t.DOWN_ARROW:case t.LEFT_ARROW:case t.RIGHT_ARROW:case t.HOME:case t.END:case t.PAGE_UP:case t.PAGE_DOWN:this.endEditing(!0);case t.CTRL:case t.SHIFT:case t.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(F){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(F){this.customUndo?this.isClosed?this.setValue(F):(this.beginEditing(),F||(F="\x26#160;"),this.setValue(F),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(F){this.setValueDeferred.then(g.hitch(this,function(){!this.disabled&&F||!this._buttonEnabledPlugins&&F?
J.forEach(this._plugins,function(R){R.set("disabled",!0)}):this.disabled&&!F&&J.forEach(this._plugins,function(R){R.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(w.set(this.document.body,"color",w.get(this.iframe,"color")),w.set(this.document.body,"background-color",w.get(this.iframe,"background-color")))}catch(F){}}});g.mixin(B.registry,{undo:c,redo:c,cut:c,copy:c,paste:c,insertOrderedList:c,insertUnorderedList:c,
indent:c,outdent:c,justifyCenter:c,justifyFull:c,justifyLeft:c,justifyRight:c,"delete":c,selectAll:c,removeFormat:c,unlink:c,insertHorizontalRule:c,bold:D,italic:D,underline:D,strikethrough:D,subscript:D,superscript:D,"|":function(){return new B({setEditor:function(F){this.editor=F;this.button=new n({ownerDocument:F.ownerDocument})}})}});return K})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(O,J,K,I,v,e,d,a){K("dijit-legacy-requires")&&v(0,function(){O(["dijit/ToolbarSeparator"])});return J("dijit.Toolbar",[e,a,d],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(O,J,K,I){return O("dijit.ToolbarSeparator",[K,I],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);J.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(O,J,K,I,v){J=J("dijit._editor._Plugin",I,{constructor:function(e){this.params=
e||{};K.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:v,disabled:!1,getLabel:function(e){return this.editor.commands[e]},_initButton:function(){if(this.command.length){var e=this.getLabel(this.command),d=this.editor,a=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(e=K.mixin({label:e,ownerDocument:d.ownerDocument,dir:d.dir,
lang:d.lang,showLabel:!1,iconClass:a,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete e.name,this.button=new this.buttonClass(e))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(e,d,a){this.own(O.connect(e,d,this,a))},updateState:function(){var e=this.editor,d=this.command;if(e&&e.isLoaded&&d.length){var a=this.get("disabled");if(this.button)try{var w=
e._implCommand(d);var t=!a&&(this[w]?this[w](d):e.queryCommandEnabled(d));this.enabled!==t&&(this.enabled=t,this.button.set("disabled",!t));if(t&&"boolean"==typeof this.button.checked){var g=e.queryCommandState(d);this.checked!==g&&(this.checked=g,this.button.set("checked",e.queryCommandState(d)))}}catch(l){console.log(l)}}},setEditor:function(e){this.editor=e;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",K.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",K.hitch(this,"updateState")))},setToolbar:function(e){this.button&&e.addChild(this.button)},set:function(e,d){if("object"===typeof e){for(var a in e)this.set(a,e[a]);return this}a=this._getAttrNames(e);if(this[a.s])var w=this[a.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(e,d);return w||this},get:function(e){var d=this._getAttrNames(e);
return this[d.g]?this[d.g]():this[e]},_setDisabledAttr:function(e){this._set("disabled",e);this.updateState()},_getAttrNames:function(e){var d=this._attrPairNames;if(d[e])return d[e];var a=e.charAt(0).toUpperCase()+e.substr(1);return d[e]={s:"_set"+a+"Attr",g:"_get"+a+"Attr"}},_set:function(e,d){this[e]=d}});J.registry={};return J})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g){return O("dijit._editor.plugins.EnterKeyHandling",w,{blockNodeForEnter:"BR",constructor:function(l){l&&("blockNodeForEnter"in l&&(l.blockNodeForEnter=l.blockNodeForEnter.toUpperCase()),I.mixin(this,l))},setEditor:function(l){if(this.editor!==l)if(this.editor=l,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,l.onLoadDeferred.then(I.hitch(this,function(h){this.own(v(l.document,"keydown",I.hitch(this,function(p){if(p.keyCode==K.ENTER){var k=I.mixin({},p);k.shiftKey=
!0;this.handleEnterKey(k)||(p.stopPropagation(),p.preventDefault())}})));9<=e("ie")&&10>=e("ie")&&this.own(v(l.document,"paste",I.hitch(this,function(p){setTimeout(I.hitch(this,function(){var k=this.editor.document.selection.createRange();k.move("character",-1);k.select();k.move("character",1);k.select()}),0)})));return h}));else if(this.blockNodeForEnter){var A=I.hitch(this,"handleEnterKey");l.addKeyHandler(13,0,0,A);l.addKeyHandler(13,0,1,A);this.own(this.editor.on("KeyPressed",I.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var l=this.editor.selection.getAncestorElement("LI");if(l){e("mozilla")&&"LI"==l.parentNode.parentNode.nodeName&&(l=l.parentNode.parentNode);var A=l.firstChild;!A||1!=A.nodeType||"UL"!=A.nodeName&&"OL"!=A.nodeName||(l.insertBefore(A.ownerDocument.createTextNode("\u00a0"),A),A=g.create(this.editor.window),A.setStart(l.firstChild,0),l=g.getSelection(this.editor.window,!0),l.removeAllRanges(),l.addRange(A))}else t.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(l=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(l.innerHTML=this.bogusHtmlContent,9>=e("ie")&&(l=this.editor.document.selection.createRange(),l.move("character",-1),l.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(l){var A,h=this.editor.document,p;if(l.shiftKey){l=this.editor.selection.getParentElement();if(A=g.getAncestor(l,this.blockNodes)){if("LI"==A.tagName)return!0;l=g.getSelection(this.editor.window);var k=l.getRangeAt(0);k.collapsed||(k.deleteContents(),l=g.getSelection(this.editor.window),k=l.getRangeAt(0));if(g.atBeginningOfContainer(A,k.startContainer,k.startOffset)){var n=h.createElement("br");k=g.create(this.editor.window);A.insertBefore(n,
A.firstChild);k.setStartAfter(n);l.removeAllRanges();l.addRange(k)}else if(g.atEndOfContainer(A,k.startContainer,k.startOffset))k=g.create(this.editor.window),n=h.createElement("br"),A.appendChild(n),A.appendChild(h.createTextNode("\u00a0")),k.setStart(A.lastChild,0),l.removeAllRanges(),l.addRange(k);else{if((p=k.startContainer)&&3==p.nodeType){var m=p.nodeValue;var C=h.createTextNode(m.substring(0,k.startOffset));var B=h.createTextNode(m.substring(k.startOffset));A=h.createElement("br");""==B.nodeValue&&
e("webkit")&&(B=h.createTextNode("\u00a0"));J.place(C,p,"after");J.place(A,C,"after");J.place(B,A,"after");J.destroy(p);k=g.create(this.editor.window);k.setStart(B,0);l.removeAllRanges();l.addRange(k);return!1}return!0}}else l=g.getSelection(this.editor.window),l.rangeCount?(k=l.getRangeAt(0))&&k.startContainer&&(k.collapsed||(k.deleteContents(),l=g.getSelection(this.editor.window),k=l.getRangeAt(0)),(p=k.startContainer)&&3==p.nodeType?(A=k.startOffset,p.length<A&&(B=this._adjustNodeAndOffset(p,A),
p=B.node,A=B.offset),m=p.nodeValue,C=h.createTextNode(m.substring(0,A)),B=h.createTextNode(m.substring(A)),A=h.createElement("br"),B.length||(B=h.createTextNode("\u00a0")),C.length?J.place(C,p,"after"):C=p,J.place(A,C,"after"),J.place(B,A,"after"),J.destroy(p)):(0<=k.startOffset&&(n=p.childNodes[k.startOffset]),A=h.createElement("br"),B=h.createTextNode("\u00a0"),n?(J.place(A,n,"before"),J.place(B,A,"after")):(p.appendChild(A),p.appendChild(B))),k=g.create(this.editor.window),k.setStart(B,0),k.setEnd(B,
B.length),l.removeAllRanges(),l.addRange(k),this.editor.selection.collapse(!0)):t.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var y=!0;l=g.getSelection(this.editor.window);k=l.getRangeAt(0);k.collapsed||(k.deleteContents(),l=g.getSelection(this.editor.window),k=l.getRangeAt(0));n=g.getBlockAncestor(k.endContainer,null,this.editor.editNode);var G=n.blockNode;if(this._checkListLater=G&&("LI"==G.nodeName||"LI"==G.parentNode.nodeName))return e("mozilla")&&(this._pressedEnterInBlock=
G),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(G.innerHTML)&&(G.innerHTML="",e("webkit")&&(k=g.create(this.editor.window),k.setStart(G,0),l.removeAllRanges(),l.addRange(k)),this._checkListLater=!1),!0;if(!n.blockNode||n.blockNode===this.editor.editNode){try{t.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(f){}n={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(n.blockNode){if(n.blockNode!=this.editor.editNode&&!(n.blockNode.textContent||n.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(n.blockNode),!1}else n.blockNode=this.editor.editNode;l=g.getSelection(this.editor.window);k=l.getRangeAt(0)}G=h.createElement(this.blockNodeForEnter);G.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(n.blockNode);B=k.endOffset;y=k.endContainer;y.length<B&&(B=this._adjustNodeAndOffset(y,B),y=
B.node,B=B.offset);if(g.atEndOfContainer(n.blockNode,y,B))n.blockNode===n.blockContainer?n.blockNode.appendChild(G):J.place(G,n.blockNode,"after"),y=!1,k=g.create(this.editor.window),k.setStart(G,0),l.removeAllRanges(),l.addRange(k),this.editor.height&&a.scrollIntoView(G);else if(g.atBeginningOfContainer(n.blockNode,k.startContainer,k.startOffset))J.place(G,n.blockNode,n.blockNode===n.blockContainer?"first":"before"),G.nextSibling&&this.editor.height&&(k=g.create(this.editor.window),k.setStart(G.nextSibling,
0),l.removeAllRanges(),l.addRange(k),a.scrollIntoView(G.nextSibling)),y=!1;else{n.blockNode===n.blockContainer?n.blockNode.appendChild(G):J.place(G,n.blockNode,"after");y=!1;n.blockNode.style&&G.style&&n.blockNode.style.cssText&&(G.style.cssText=n.blockNode.style.cssText);if((p=k.startContainer)&&3==p.nodeType){B=k.endOffset;p.length<B&&(B=this._adjustNodeAndOffset(p,B),p=B.node,B=B.offset);m=p.nodeValue;C=h.createTextNode(m.substring(0,B));B=h.createTextNode(m.substring(B,m.length));J.place(C,p,
"before");J.place(B,p,"after");J.destroy(p);for(k=C.parentNode;k!==n.blockNode;){m=h.createElement(k.tagName);k.style&&m.style&&k.style.cssText&&(m.style.cssText=k.style.cssText);"FONT"===k.tagName&&(k.color&&(m.color=k.color),k.face&&(m.face=k.face),k.size&&(m.size=k.size));for(;B;)p=B.nextSibling,m.appendChild(B),B=p;J.place(m,k,"after");C=k;B=m;k=k.parentNode}if(1==B.nodeType||3==B.nodeType&&B.nodeValue)G.innerHTML="";for(C=B;B;)p=B.nextSibling,G.appendChild(B),B=p}k=g.create(this.editor.window);
h=C;if("BR"!==this.blockNodeForEnter){for(;h;)A=h,h=p=h.firstChild;A&&A.parentNode?(G=A.parentNode,k.setStart(G,0),l.removeAllRanges(),l.addRange(k),this.editor.height&&a.scrollIntoView(G),e("mozilla")&&(this._pressedEnterInBlock=n.blockNode)):y=!0}else k.setStart(G,0),l.removeAllRanges(),l.addRange(k),this.editor.height&&a.scrollIntoView(G),e("mozilla")&&(this._pressedEnterInBlock=n.blockNode)}return y},_adjustNodeAndOffset:function(l,A){for(;l.length<A&&l.nextSibling&&3==l.nextSibling.nodeType;)A-=
l.length,l=l.nextSibling;return{node:l,offset:A}},removeTrailingBr:function(l){if(l=/P|DIV|LI/i.test(l.tagName)?l:this.editor.selection.getParentOfType(l,["P","DIV","LI"]))l.lastChild&&(1<l.childNodes.length&&3==l.lastChild.nodeType&&/^[\s\xAD]*$/.test(l.lastChild.nodeValue)||"BR"==l.lastChild.tagName)&&J.destroy(l.lastChild),l.childNodes.length||(l.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R){var N=K("dijit._editor.RichText",[f,b],{constructor:function(r){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};r&&A.isString(r.value)&&(this.value=r.value);this.onLoadDeferred=new I},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[A.trim,A.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);n("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));n("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(n("ie")||n("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[A.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[A.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);C.publish(R._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var r=A.hitch(this,function(u,x){return function(){return!this.execCommand(u,x)}}),E={b:r("bold"),i:r("italic"),u:r("underline"),a:r("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:r("formatblock",
"h1"),2:r("formatblock","h2"),3:r("formatblock","h3"),4:r("formatblock","h4"),"\\":r("insertunorderedlist")};n("ie")||(E.Z=r("redo"));for(var q in E)this.addKeyHandler(q,!0,!1,E[q])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(N._editorCommandsLocalized)this._local2NativeFormatNames=N._local2NativeFormatNames,this._native2LocalFormatNames=N._native2LocalFormatNames;else{N._editorCommandsLocalized=!0;N._local2NativeFormatNames={};
N._native2LocalFormatNames={};this._local2NativeFormatNames=N._local2NativeFormatNames;this._native2LocalFormatNames=N._native2LocalFormatNames;for(var r="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),E="",q,u=0;q=r[u++];)E="l"!==q.charAt(1)?E+("\x3c"+q+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+q+"\x3e\x3cbr/\x3e"):E+("\x3c"+q+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+q+"\x3e\x3cbr/\x3e");var x=a.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:E});this.ownerDocumentBody.appendChild(x);
r=A.hitch(this,function(){for(var H=x.firstChild;H;)try{this.selection.selectElement(H.firstChild);var L=H.tagName.toLowerCase();this._local2NativeFormatNames[L]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[L]]=L;H=H.nextSibling.nextSibling}catch(Q){}a.destroy(x)});this.defer(r)}},open:function(r){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new I;this.isClosed||this.close();C.publish(R._scopeName+"._editor.RichText::open",
this);1===arguments.length&&r.nodeName&&(this.domNode=r);var E=this.domNode;if(A.isString(this.value)){var q=this.value;E.innerHTML=""}else if(E.nodeName&&"textarea"==E.nodeName.toLowerCase()){var u=this.textarea=E;this.name=u.name;q=u.value;E=this.domNode=this.ownerDocument.createElement("div");E.setAttribute("widgetId",this.id);u.removeAttribute("widgetId");E.cssText=u.cssText;E.className+=" "+u.className;a.place(E,u,"before");var x=A.hitch(this,function(){t.set(u,{display:"block",position:"absolute",
top:"-1000px"});if(n("ie")){var T=u.style;this.__overflow=T.overflow;T.overflow="hidden"}});n("ie")?this.defer(x,10):x();if(u.form){var H=u.value;this.reset=function(){this.getValue()!==H&&this.replaceValue(H)};h(u.form,"submit",A.hitch(this,function(){e.set(u,"disabled",this.disabled);u.value=this.getValue()}))}}else q=D.getChildrenHtml(E),E.innerHTML="";this.value=q;E.nodeName&&"LI"===E.nodeName&&(E.innerHTML=" \x3cbr\x3e");this.header=E.ownerDocument.createElement("div");E.appendChild(this.header);
this.editingArea=E.ownerDocument.createElement("div");E.appendChild(this.editingArea);this.footer=E.ownerDocument.createElement("div");E.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!J.useXDomain||J.allowXdRichTextSave)){if((q=v.byId(R._scopeName+"._editor.RichText.value"))&&""!==q.value){x=q.value.split(this._SEPARATOR);for(var L=0,Q;Q=x[L++];)if(Q=Q.split(this._NAME_CONTENT_SEP),Q[0]===this.name){this.value=Q[1];x=x.splice(L,1);q.value=x.join(this._SEPARATOR);
break}}N._globalSaveHandler||(N._globalSaveHandler={},B.addOnUnload(function(){for(var T in N._globalSaveHandler){var M=N._globalSaveHandler[T];A.isFunction(M)&&M()}}));N._globalSaveHandler[this.id]=A.hitch(this,"_saveContent")}this.isClosed=!1;q=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");q.id=this.id+"_iframe";q.style.border="none";q.style.width="100%";this._layoutMode?q.style.height="100%":7<=n("ie")?(this.height&&(q.style.height=this.height),this.minHeight&&(q.style.minHeight=
this.minHeight)):q.style.height=this.height?this.height:this.minHeight;q.frameBorder=0;q._loadFunc=A.hitch(this,function(T){this.window=T;this.document=T.document;this.selection=new z.SelectionManager(T);n("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});x=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");x=11>n("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+x+"');document.close()":"javascript: '"+
x+"'";this.editingArea.appendChild(q);q.src=x;"LI"===E.nodeName&&(E.lastChild.style.marginTop="-1.2em");d.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var r=t.getComputedStyle(this.domNode);if(this["aria-label"])var E=this["aria-label"];else{var q=p('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||v.byId(this["aria-labelledby"],this.ownerDocument);q&&(E=q.textContent||q.innerHTML||"")}q="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(E?" aria-label\x3d'"+m.escape(E)+"'":"")+"\x3e\x3c/div\x3e";var u=[r.fontWeight,r.fontSize,r.fontFamily].join(" "),x=r.lineHeight;x=0<=x.indexOf("px")?parseFloat(x)/parseFloat(r.fontSize):0<=x.indexOf("em")?parseFloat(x):"normal";var H="",L=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(Q){Q=Q.replace(/^;/ig,"")+";";var T=Q.split(":")[0];if(T){T=A.trim(T);T=T.toLowerCase();var M,P="";for(M=0;M<T.length;M++){var V=T.charAt(M);switch(V){case "-":M++,V=T.charAt(M).toUpperCase();default:P+=
V}}t.set(L.domNode,P,"")}H+=Q+";"});this.iframe.setAttribute("title",E);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||g.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",E?"\x3ctitle\x3e"+m.escape(E)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",u,";\n",this.height||n("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",x,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",n("ie")||n("trident")||n("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",E?" aria-label\x3d'"+m.escape(E)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+H+"'\x3e",q,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var r=[];this.styleSheets&&(r=this.styleSheets.split(";"),this.styleSheets=
"");r=r.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var E="",q=0,u,x=G.get(this.ownerDocument);u=r[q++];)u=(new y(x.location,u)).toString(),this.editingAreaStyleSheets.push(u),E+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+u+'"/\x3e';return E},addStyleSheet:function(r){var E=r.toString(),q=G.get(this.ownerDocument);if("."===E.charAt(0)||"/"!==E.charAt(0)&&!r.host)E=(new y(q.location,E)).toString();-1<O.indexOf(this.editingAreaStyleSheets,E)||(this.editingAreaStyleSheets.push(E),
this.onLoadDeferred.then(A.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(E);else{var u=this.document.getElementsByTagName("head")[0],x=this.document.createElement("link");x.rel="stylesheet";x.type="text/css";x.href=E;u.appendChild(x)}})))},removeStyleSheet:function(r){var E=r.toString(),q=G.get(this.ownerDocument);if("."===E.charAt(0)||"/"!==E.charAt(0)&&!r.host)E=(new y(q.location,E)).toString();r=O.indexOf(this.editingAreaStyleSheets,E);-1!==r&&(delete this.editingAreaStyleSheets[r],
p('link[href\x3d"'+E+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(r){r=!!r;this._set("disabled",r);if(this.isLoaded){var E=n("ie")&&(this.isLoaded||!this.focusOnLoad);E&&(this.editNode.unselectable="on");this.editNode.contentEditable=!r;this.editNode.tabIndex=r?"-1":this.tabIndex;E&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(n("mozilla")&&!r&&this._mozSettingProps){r=this._mozSettingProps;for(var q in r)if(r.hasOwnProperty(q))try{this.document.execCommand(q,
!1,r[q])}catch(u){}}this._disabledOK=!0}},onLoad:function(r){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=F.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var E=this;this.beforeIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){E.editNode.focus()};this.focusNode=
this.editNode;var q=this.events.concat(this.captureEvents),u=this.iframe?this.document:this.editNode;this.own.apply(this,O.map(q,function(x){var H=x.toLowerCase().replace(/^on/,"");return h(u,H,A.hitch(this,x))},this));this.own(h(u,"mouseup",A.hitch(this,"onClick")));n("ie")&&(this.own(h(this.document,"mousedown",A.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);n("webkit")&&(this._webkitListener=this.own(h(this.document,"mouseup",A.hitch(this,"onDisplayChanged")))[0],this.own(h(this.document,
"mousedown",A.hitch(this,function(x){x=x.target;!x||x!==this.document.body&&x!==this.document||this.defer("placeCursorAtEnd")}))));if(n("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(x){}this.isLoaded=!0;this.set("disabled",this.disabled);q=A.hitch(this,function(){this.setValue(r);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&k(A.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(q):q()},onKeyDown:function(r){if(r.keyCode===l.SHIFT||r.keyCode===l.ALT||r.keyCode===l.META||r.keyCode===l.CTRL)return!0;r.keyCode===l.TAB&&this.isTabIndent&&(r.stopPropagation(),r.preventDefault(),this.queryCommandEnabled(r.shiftKey?"outdent":"indent")&&this.execCommand(r.shiftKey?"outdent":"indent"));if(r.keyCode==l.TAB&&!this.isTabIndent&&!r.ctrlKey&&!r.altKey)return r.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>n("ie")&&r.keyCode===l.BACKSPACE&&"Control"===this.document.selection.type&&(r.stopPropagation(),r.preventDefault(),this.execCommand("delete"));n("ff")&&(r.keyCode===l.PAGE_UP||r.keyCode===l.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&r.preventDefault();var E=this._keyHandlers[r.keyCode],q=arguments;E&&!r.altKey&&O.some(E,function(u){if(!(u.shift^r.shiftKey||u.ctrl^(r.ctrlKey||r.metaKey)))return u.handler.apply(this,q)||r.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(r){g.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",r)},_setValueAttr:function(r){this.setValue(r)},_setDisableSpellCheckAttr:function(r){this.document?e.set(this.document.body,"spellcheck",!r):this.onLoadDeferred.then(A.hitch(this,function(){e.set(this.document.body,"spellcheck",!r)}));this._set("disableSpellCheck",r)},addKeyHandler:function(r,E,q,u){"string"==
typeof r&&(r=r.toUpperCase().charCodeAt(0));A.isArray(this._keyHandlers[r])||(this._keyHandlers[r]=[]);this._keyHandlers[r].push({shift:q||!1,ctrl:E||!1,handler:u})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(r){this.onDisplayChanged(r)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(r){(n("ie")||n("trident"))&&this.defer(function(){F.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var E=this.getValue(!0);if(E!==this.value)this.onChange(E);
this._set("value",E)},_onFocus:function(r){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!n("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>n("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(r,E){r=r.toLowerCase();"formatblock"===r?n("safari")&&void 0===E&&(r="heading"):"hilitecolor"!==r||n("mozilla")||(r="backcolor");return r},_implCommand:function(r){return"_"+this._normalizeCommand(r)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(r){var E=this._qcaCache[r];return void 0!==E?E:this._qcaCache[r]=this._queryCommandAvailable(r)},_queryCommandAvailable:function(r){switch(r.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return n("ie")||n("trident")||n("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!n("webkit");default:return!1}},execCommand:function(r,E){this.focused&&this.focus();r=this._normalizeCommand(r,E);if(void 0!==E){if("heading"===r)throw Error("unimplemented");"formatblock"===
r&&(n("ie")||n("trident"))&&(E="\x3c"+E+"\x3e")}var q="_"+r+"Impl";if(this[q])var u=this[q](E);else if((E=1<arguments.length?E:null)||"createlink"!==r)u=this.document.execCommand(r,!1,E);this.onDisplayChanged();return u},queryCommandEnabled:function(r){if(this.disabled||!this._disabledOK)return!1;r=this._normalizeCommand(r);var E=this._implCommand(r);return this[E]?this[E](r):this._browserQueryCommandEnabled(r)},queryCommandState:function(r){if(this.disabled||!this._disabledOK)return!1;r=this._normalizeCommand(r);
try{return this.document.queryCommandState(r)}catch(E){return!1}},queryCommandValue:function(r){if(this.disabled||!this._disabledOK)return!1;r=this._normalizeCommand(r);if(n("ie")&&"formatblock"===r)r=this._native2LocalFormatNames[this.document.queryCommandValue(r)];else if(n("mozilla")&&"hilitecolor"===r){try{var E=this.document.queryCommandValue("styleWithCSS")}catch(q){E=!1}this.document.execCommand("styleWithCSS",!1,!0);r=this.document.queryCommandValue(r);this.document.execCommand("styleWithCSS",
!1,E)}else r=this.document.queryCommandValue(r);return r},_sCall:function(r,E){return this.selection[r].apply(this.selection,E)},placeCursorAtStart:function(){this.focus();var r=!1;if(n("mozilla"))for(var E=this.editNode.firstChild;E;){if(3===E.nodeType){if(0<E.nodeValue.replace(/^\s+|\s+$/g,"").length){r=!0;this.selection.selectElement(E);break}}else if(1===E.nodeType){r=!0;var q=E.tagName?E.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(q)?this.selection.selectElement(E):
this.selection.selectElementChildren(E);break}E=E.nextSibling}else r=!0,this.selection.selectElementChildren(this.editNode);r&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var r=!1;if(n("mozilla"))for(var E=this.editNode.lastChild;E;){if(3===E.nodeType){if(0<E.nodeValue.replace(/^\s+|\s+$/g,"").length){r=!0;this.selection.selectElement(E);break}}else if(1===E.nodeType){r=!0;this.selection.selectElement(E.lastChild||E);break}E=E.previousSibling}else r=!0,this.selection.selectElementChildren(this.editNode);
r&&this.selection.collapse(!1)},getValue:function(r){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,r):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(r){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){r=this._preFilterContent(r);var E=this.isClosed?this.domNode:this.editNode;E.innerHTML=r;this._preDomFilterContent(E)}else this.textarea.value=r;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(A.hitch(this,function(){this.setValue(r)}))},replaceValue:function(r){this.isClosed?this.setValue(r):this.window&&this.window.getSelection&&!n("mozilla")?this.setValue(r):this.window&&this.window.getSelection?(r=this._preFilterContent(r),this.execCommand("selectall"),this.execCommand("inserthtml",r),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(r);this._set("value",this.getValue(!0))},_preFilterContent:function(r){var E=
r;O.forEach(this.contentPreFilters,function(q){q&&(E=q(E))});return E},_preDomFilterContent:function(r){r=r||this.editNode;O.forEach(this.contentDomPreFilters,function(E){E&&A.isFunction(E)&&E(r)},this)},_postFilterContent:function(r,E){if(A.isString(r))var q=r;else r=r||this.editNode,this.contentDomPostFilters.length&&(E&&(r=A.clone(r)),O.forEach(this.contentDomPostFilters,function(u){r=u(r)})),q=D.getChildrenHtml(r);A.trim(q.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(q="");O.forEach(this.contentPostFilters,
function(u){q=u(q)});return q},_saveContent:function(){var r=v.byId(R._scopeName+"._editor.RichText.value");r&&(r.value&&(r.value+=this._SEPARATOR),r.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(r,E){r=r.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");E||(r=r.replace(/'/gm,"\x26#39;"));return r},getNodeHtml:function(r){g.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return D.getNodeHtml(r)},getNodeChildrenHtml:function(r){g.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return D.getChildrenHtml(r)},close:function(r){if(!this.isClosed){arguments.length||(r=!0);r&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);n("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var E=this.textarea.style;E.position="";E.left=E.top="";n("ie")&&(E.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;a.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;d.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);N._globalSaveHandler&&delete N._globalSaveHandler[this.id]},_removeMozBogus:function(r){return r.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(r){r=r.replace(/\sclass="webkit-block-placeholder"/gi,"");r=r.replace(/\sclass="apple-style-span"/gi,
"");return r=r.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(r){return r.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(r){return r.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(r){if(!r)return!1;
var E=9>n("ie")?this.document.selection.createRange():this.document;try{return E.queryCommandEnabled(r)}catch(q){return!1}},_createlinkEnabledImpl:function(){var r=!0;return r=n("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var r=!0;return r=n("mozilla")||n("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var r=
!0;return r=n("mozilla")||n("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var r=!0;n("webkit")?((r=this.window.getSelection())&&(r=r.toString()),r=!!r):r=this._browserQueryCommandEnabled("cut");return r},_copyEnabledImpl:function(){var r=!0;n("webkit")?((r=this.window.getSelection())&&(r=r.toString()),r=!!r):r=this._browserQueryCommandEnabled("copy");return r},_pasteEnabledImpl:function(){var r=!0;return n("webkit")?!0:r=this._browserQueryCommandEnabled("paste")},
_inserthorizontalruleImpl:function(r){return n("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,r)},_unlinkImpl:function(r){return this.queryCommandEnabled("unlink")&&(n("mozilla")||n("webkit"))?(r=this.selection.getAncestorElement("a"),this.selection.selectElement(r),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",!1,r)},_hilitecolorImpl:function(r){if(!this._handleTextColorOrProperties("hilitecolor",r))if(n("mozilla")){this.document.execCommand("styleWithCSS",
!1,!0);console.log("Executing color command.");var E=this.document.execCommand("hilitecolor",!1,r);this.document.execCommand("styleWithCSS",!1,!1)}else E=this.document.execCommand("hilitecolor",!1,r);return E},_backcolorImpl:function(r){n("ie")&&(r=r?r:null);var E=this._handleTextColorOrProperties("backcolor",r);E||(E=this.document.execCommand("backcolor",!1,r));return E},_forecolorImpl:function(r){n("ie")&&(r=r?r:null);var E=!1;(E=this._handleTextColorOrProperties("forecolor",r))||(E=this.document.execCommand("forecolor",
!1,r));return E},_inserthtmlImpl:function(r){r=this._preFilterContent(r);var E=!0;if(9>n("ie")){var q=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var u=q.item(0);q.length;)q.remove(q.item(0));u.outerHTML=r}else q.pasteHTML(r);q.select()}else if(8>n("trident")){var x=c.getSelection(this.window);if(x&&x.rangeCount&&x.getRangeAt){q=x.getRangeAt(0);q.deleteContents();var H=a.create("div");H.innerHTML=r;for(u=this.document.createDocumentFragment();r=
H.firstChild;)var L=u.appendChild(r);q.insertNode(u);L&&(q=q.cloneRange(),q.setStartAfter(L),q.collapse(!1),x.removeAllRanges(),x.addRange(q))}}else n("mozilla")&&!r.length?this.selection.remove():E=this.document.execCommand("inserthtml",!1,r);return E},_boldImpl:function(r){var E=!1;if(n("ie")||n("trident"))this._adaptIESelection(),E=this._adaptIEFormatAreaAndExec("bold");E||(E=this.document.execCommand("bold",!1,r));return E},_italicImpl:function(r){var E=!1;if(n("ie")||n("trident"))this._adaptIESelection(),
E=this._adaptIEFormatAreaAndExec("italic");E||(E=this.document.execCommand("italic",!1,r));return E},_underlineImpl:function(r){var E=!1;if(n("ie")||n("trident"))this._adaptIESelection(),E=this._adaptIEFormatAreaAndExec("underline");E||(E=this.document.execCommand("underline",!1,r));return E},_strikethroughImpl:function(r){var E=!1;if(n("ie")||n("trident"))this._adaptIESelection(),E=this._adaptIEFormatAreaAndExec("strikethrough");E||(E=this.document.execCommand("strikethrough",!1,r));return E},_superscriptImpl:function(r){var E=
!1;if(n("ie")||n("trident"))this._adaptIESelection(),E=this._adaptIEFormatAreaAndExec("superscript");E||(E=this.document.execCommand("superscript",!1,r));return E},_subscriptImpl:function(r){var E=!1;if(n("ie")||n("trident"))this._adaptIESelection(),E=this._adaptIEFormatAreaAndExec("subscript");E||(E=this.document.execCommand("subscript",!1,r));return E},_fontnameImpl:function(r){if(n("ie")||n("trident"))var E=this._handleTextColorOrProperties("fontname",r);E||(E=this.document.execCommand("fontname",
!1,r));return E},_fontsizeImpl:function(r){if(n("ie")||n("trident"))var E=this._handleTextColorOrProperties("fontsize",r);E||(E=this.document.execCommand("fontsize",!1,r));return E},_insertorderedlistImpl:function(r){var E=!1;if(n("ie")||n("trident")||n("edge"))E=this._adaptIEList("insertorderedlist",r);E||(E=this.document.execCommand("insertorderedlist",!1,r));return E},_insertunorderedlistImpl:function(r){var E=!1;if(n("ie")||n("trident")||n("edge"))E=this._adaptIEList("insertunorderedlist",r);
E||(E=this.document.execCommand("insertunorderedlist",!1,r));return E},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(r){var E=0;if(r&&r.childNodes){var q;for(q=0;q<r.childNodes.length;q++){var u=w.position(r.childNodes[q]);E+=u.h}}return E},_isNodeEmpty:function(r,E){return 1===r.nodeType?0<r.childNodes.length?this._isNodeEmpty(r.childNodes[0],E):!0:3===r.nodeType?
""===r.nodeValue.substring(E):!1},_removeStartingRangeFromRange:function(r,E){if(r.nextSibling)E.setStart(r.nextSibling,0);else{for(r=r.parentNode;r&&null==r.nextSibling;)r=r.parentNode;r&&E.setStart(r.nextSibling,0)}return E},_adaptIESelection:function(){var r=c.getSelection(this.window);if(r&&r.rangeCount&&!r.isCollapsed){for(var E=r.getRangeAt(0),q=E.startContainer,u=E.startOffset;3===q.nodeType&&u>=q.length&&q.nextSibling;)u-=q.length,q=q.nextSibling;for(var x=null;this._isNodeEmpty(q,u)&&q!==
x;)x=q,E=this._removeStartingRangeFromRange(q,E),q=E.startContainer,u=0;r.removeAllRanges();r.addRange(E)}},_adaptIEFormatAreaAndExec:function(r){var E=c.getSelection(this.window),q=this.document,u;if(r&&E&&E.isCollapsed){if(this.queryCommandValue(r)){r=this._tagNamesForCommand(r);var x=E.getRangeAt(0);var H=x.startContainer;if(3===H.nodeType){var L=x.endOffset;H.length<L&&(L=this._adjustNodeAndOffset(Q,L),H=L.node,L=L.offset)}for(;H&&H!==this.editNode;){var Q=H.tagName?H.tagName.toLowerCase():"";
if(-1<O.indexOf(r,Q)){var T=H;break}H=H.parentNode}if(T&&(Q=x.startContainer,r=q.createElement(T.tagName),a.place(r,T,"after"),Q&&3===Q.nodeType)){L=x.endOffset;Q.length<L&&(L=this._adjustNodeAndOffset(Q,L),Q=L.node,L=L.offset);H=Q.nodeValue;x=q.createTextNode(H.substring(0,L));var M=H.substring(L,H.length);M&&(u=q.createTextNode(M));a.place(x,Q,"before");if(u){var P=q.createElement("span");P.className="ieFormatBreakerSpan";a.place(P,Q,"after");a.place(u,P,"after");u=P}a.destroy(Q);L=x.parentNode;
for(Q=[];L!==T;){H=L.tagName;x={tagName:H};Q.push(x);H=q.createElement(H);L.style&&H.style&&L.style.cssText&&(H.style.cssText=L.style.cssText,x.cssText=L.style.cssText);"FONT"===L.tagName&&(L.color&&(H.color=L.color,x.color=L.color),L.face&&(H.face=L.face,x.face=L.face),L.size&&(H.size=L.size,x.size=L.size));L.className&&(H.className=L.className,x.className=L.className);if(u)for(;u;)x=u.nextSibling,H.appendChild(u),u=x;H.tagName==L.tagName?(P=q.createElement("span"),P.className="ieFormatBreakerSpan",
a.place(P,L,"after"),a.place(H,P,"after")):a.place(H,L,"after");x=L;u=H;L=L.parentNode}if(u){if(1===u.nodeType||3===u.nodeType&&u.nodeValue)r.innerHTML="";for(;u;)x=u.nextSibling,r.appendChild(u),u=x}if(Q.length){x=Q.pop();u=q.createElement(x.tagName);x.cssText&&u.style&&(u.style.cssText=x.cssText);x.className&&(u.className=x.className);"FONT"===x.tagName&&(x.color&&(u.color=x.color),x.face&&(u.face=x.face),x.size&&(u.size=x.size));for(a.place(u,r,"before");Q.length;)x=Q.pop(),T=q.createElement(x.tagName),
x.cssText&&T.style&&(T.style.cssText=x.cssText),x.className&&(T.className=x.className),"FONT"===x.tagName&&(x.color&&(T.color=x.color),x.face&&(T.face=x.face),x.size&&(T.size=x.size)),u.appendChild(T),u=T;T=q.createTextNode(".");P.appendChild(T);u.appendChild(T)}else P=q.createElement("span"),P.className="ieFormatBreakerSpan",T=q.createTextNode("."),P.appendChild(T),a.place(P,r,"before");u=c.create(this.window);u.setStart(T,0);u.setEnd(T,T.length);E.removeAllRanges();E.addRange(u);this.selection.collapse(!1);
T.parentNode.innerHTML="";r.firstChild||a.destroy(r);return!0}return!1}x=E.getRangeAt(0);if((Q=x.startContainer)&&3===Q.nodeType)return L=x.startOffset,Q.length<L&&(L=this._adjustNodeAndOffset(Q,L),Q=L.node,L=L.offset),H=Q.nodeValue,x=q.createTextNode(H.substring(0,L)),M=H.substring(L),""!==M&&(u=q.createTextNode(H.substring(L))),P=q.createElement("span"),T=q.createTextNode("."),P.appendChild(T),x.length?a.place(x,Q,"after"):x=Q,a.place(P,x,"after"),u&&a.place(u,P,"after"),a.destroy(Q),u=c.create(this.window),
u.setStart(T,0),u.setEnd(T,T.length),E.removeAllRanges(),E.addRange(u),q.execCommand(r),a.place(P.firstChild,P,"before"),a.destroy(P),u.setStart(T,0),u.setEnd(T,T.length),E.removeAllRanges(),E.addRange(u),this.selection.collapse(!1),T.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(r){var E=c.getSelection(this.window);if(E.isCollapsed&&E.rangeCount&&!this.queryCommandValue(r)){var q=E.getRangeAt(0),u=q.startContainer;if(u&&3==u.nodeType&&!q.startOffset)return q="ul","insertorderedlist"===
r&&(q="ol"),r=this.document.createElement(q),q=a.create("li",null,r),a.place(r,u,"before"),q.appendChild(u),a.create("br",null,r,"after"),r=c.create(this.window),r.setStart(u,0),r.setEnd(u,u.length),E.removeAllRanges(),E.addRange(r),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(r,E){var q=c.getSelection(this.window),u=this.document,x,H;E=E||null;if(r&&q&&q.isCollapsed&&q.rangeCount){var L=q.getRangeAt(0);if((x=L.startContainer)&&3===x.nodeType){var Q=L.startOffset;
x.length<Q&&(L=this._adjustNodeAndOffset(x,Q),x=L.node,Q=L.offset);var T=x.nodeValue;L=u.createTextNode(T.substring(0,Q));""!==T.substring(Q)&&(H=u.createTextNode(T.substring(Q)));T=u.createElement("span");Q=u.createTextNode(".");T.appendChild(Q);u=u.createElement("span");T.appendChild(u);L.length?a.place(L,x,"after"):L=x;a.place(T,L,"after");H&&a.place(H,T,"after");a.destroy(x);x=c.create(this.window);x.setStart(Q,0);x.setEnd(Q,Q.length);q.removeAllRanges();q.addRange(x);if(n("webkit")){q="color";
if("hilitecolor"===r||"backcolor"===r)q="backgroundColor";t.set(T,q,E);this.selection.remove();a.destroy(u);T.innerHTML="\x26#160;";this.selection.selectElement(T);this.focus()}else this.execCommand(r,E),a.place(T.firstChild,T,"before"),a.destroy(T),x.setStart(Q,0),x.setEnd(Q,Q.length),q.removeAllRanges(),q.addRange(x),this.selection.collapse(!1),Q.parentNode.removeChild(Q);return!0}}return!1},_adjustNodeAndOffset:function(r,E){for(;r.length<E&&r.nextSibling&&3===r.nextSibling.nodeType;)E-=r.length,
r=r.nextSibling;return{node:r,offset:E}},_tagNamesForCommand:function(r){return"bold"===r?["b","strong"]:"italic"===r?["i","em"]:"strikethrough"===r?["s","strike"]:"superscript"===r?["sup"]:"subscript"===r?["sub"]:"underline"===r?["u"]:[]},_stripBreakerNodes:function(r){if(this.isLoaded)return p(".ieFormatBreakerSpan",r).forEach(function(E){for(;E.firstChild;)a.place(E.firstChild,E,"before");a.destroy(E)}),r},_stripTrailingEmptyNodes:function(r){function E(q){return/^(p|div|br)$/i.test(q.nodeName)&&
0==q.children.length&&/^[\s\xA0]*$/.test(q.textContent||q.innerText||"")||3===q.nodeType&&/^[\s\xA0]*$/.test(q.nodeValue)}for(;r.lastChild&&E(r.lastChild);)a.destroy(r.lastChild);return r},_setTextDirAttr:function(r){this._set("textDir",r);this.onLoadDeferred.then(A.hitch(this,function(){this.editNode.dir=r}))}});return N})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(O,J,K){var I={getIndex:function(d,a){for(var w=[],t=[],g=d,l,A;d!=
a;){var h=0;for(l=d.parentNode;A=l.childNodes[h++];)if(A===d){--h;break}w.unshift(h);t.unshift(h-l.childNodes.length);d=l}if(0<w.length&&3==g.nodeType){for(A=g.previousSibling;A&&3==A.nodeType;)w[w.length-1]--,A=A.previousSibling;for(A=g.nextSibling;A&&3==A.nodeType;)t[t.length-1]++,A=A.nextSibling}return{o:w,r:t}},getNode:function(d,a){if(!K.isArray(d)||0==d.length)return a;var w=a;O.every(d,function(t){if(0<=t&&t<w.childNodes.length)w=w.childNodes[t];else return w=null,!1;return!0});return w},getCommonAncestor:function(d,
a,w){w=w||d.ownerDocument.body;var t=function(A){for(var h=[];A;)if(h.unshift(A),A!==w)A=A.parentNode;else break;return h};d=t(d);a=t(a);t=Math.min(d.length,a.length);for(var g=d[0],l=1;l<t;l++)if(d[l]===a[l])g=d[l];else break;return g},getAncestor:function(d,a,w){for(w=w||d.ownerDocument.body;d&&d!==w;){var t=d.nodeName.toUpperCase();if(a.test(t))return d;d=d.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(d,a,w){w=w||d.ownerDocument.body;
a=a||I.BlockTagNames;for(var t=null,g;d&&d!==w;){var l=d.nodeName.toUpperCase();!t&&a.test(l)&&(t=d);!g&&/^(?:BODY|TD|TH|CAPTION)$/.test(l)&&(g=d);d=d.parentNode}return{blockNode:t,blockContainer:g||d.ownerDocument.body}},atBeginningOfContainer:function(d,a,w){var t=!1,g=0==w;g||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(0,w))&&(g=!0);if(g)for(t=!0;a&&a!==d;){if(a.previousSibling){t=!1;break}a=a.parentNode}return t},atEndOfContainer:function(d,a,w){var t=!1,g=w==(a.length||a.childNodes.length);
g||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(w))&&(g=!0);if(g)for(t=!0;a&&a!==d;){if(a.nextSibling){t=!1;break}a=a.parentNode}return t},adjacentNoneTextNode:function(d,a){var w=d;d=0-d.length||0;for(a=a?"nextSibling":"previousSibling";w&&3==w.nodeType;)d+=w.length,w=w[a];return[w,d]},create:function(d){d=d||window;return d.getSelection?d.document.createRange():new e},getSelection:function(d,a){if(d.getSelection)return d.getSelection();d=new v.selection(d);a||d._getCurrentSelection();return d}};
if(!window.getSelection)var v=I.ie={cachedSelection:{},selection:function(d){this._ranges=[];this.addRange=function(a,w){this._ranges.push(a);w||a._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(a){return this._ranges[a]};this._getCurrentSelection=function(){this.removeAllRanges();var a=d.document.selection.createRange();a="CONTROL"==d.document.selection.type.toUpperCase()?new e(v.decomposeControlRange(a)):
new e(v.decomposeTextRange(a));this.addRange(a,!0),this.isCollapsed=a.collapsed}},decomposeControlRange:function(d){var a=d.item(0),w=d.item(d.length-1);d=a.parentNode;var t=w.parentNode;a=I.getIndex(a,d).o[0];w=I.getIndex(w,t).o[0]+1;return[d,a,t,w]},getEndPoint:function(d,a){var w=d.duplicate();w.collapse(!a);var t="EndTo"+(a?"End":"Start"),g=w.parentElement(),l;if(0<g.childNodes.length)O.every(g.childNodes,function(p,k){if(3!=p.nodeType)if(w.moveToElementText(p),0<w.compareEndPoints(t,d))if(l&&
3==l.nodeType){A=l;var n=!0}else return A=g,h=k,!1;else{if(k==g.childNodes.length-1)return A=g,h=g.childNodes.length,!1}else k==g.childNodes.length-1&&(A=p,n=!0);if(n&&A)return A=(p=I.adjacentNoneTextNode(A)[0])?p.nextSibling:g.firstChild,k=I.adjacentNoneTextNode(A),p=k[0],k=k[1],p?(w.moveToElementText(p),w.collapse(!1)):w.moveToElementText(g),w.setEndPoint(t,d),h=w.text.length-k,!1;l=p;return!0});else{var A=g;var h=0}a||1!=A.nodeType||h!=A.childNodes.length||(a=A.nextSibling)&&3==a.nodeType&&(A=
a,h=0);return[A,h]},setEndPoint:function(d,a,w){d=d.duplicate();var t;if(3!=a.nodeType)if(0<w){if(t=a.childNodes[w-1])if(3==t.nodeType)a=t,w=t.length;else if(t.nextSibling&&3==t.nextSibling.nodeType)a=t.nextSibling,w=0;else{d.moveToElementText(t.nextSibling?t:a);var g=t.parentNode;t=g.insertBefore(t.ownerDocument.createTextNode(" "),t.nextSibling);d.collapse(!1);g.removeChild(t)}}else d.moveToElementText(a),d.collapse(!0);3==a.nodeType&&(t=I.adjacentNoneTextNode(a),g=t[0],t=t[1],g?(d.moveToElementText(g),
d.collapse(!1),"inherit"!=g.contentEditable&&t++):(d.moveToElementText(a.parentNode),d.collapse(!0),d.move("character",1),d.move("character",-1)),w+=t,0<w&&d.move("character",w)!=w&&console.error("Error when moving!"));return d},decomposeTextRange:function(d){var a=v.getEndPoint(d),w=a[0],t=a[1],g=a[0];a=a[1];d.htmlText.length&&(d.htmlText==d.text?a=t+d.text.length:(a=v.getEndPoint(d,!0),g=a[0],a=a[1]));return[w,t,g,a]},setRange:function(d,a,w,t,g,l){a=v.setEndPoint(d,a,w);d.setEndPoint("StartToStart",
a);if(!l)var A=v.setEndPoint(d,t,g);d.setEndPoint("EndToEnd",A||a);return d}},e=I.W3CRange=J(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?I.getCommonAncestor(this.startContainer,
this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(d,a){a=parseInt(a);if(this.startContainer!==d||this.startOffset!=a)delete this._cachedBookmark,this.startContainer=d,this.startOffset=a,this.endContainer?this._updateInternal():this.setEnd(d,a)},setEnd:function(d,a){a=parseInt(a);if(this.endContainer!==d||this.endOffset!=a)delete this._cachedBookmark,this.endContainer=d,this.endOffset=a,this.startContainer?
this._updateInternal():this.setStart(d,a)},setStartAfter:function(d,a){this._setPoint("setStart",d,a,1)},setStartBefore:function(d,a){this._setPoint("setStart",d,a,0)},setEndAfter:function(d,a){this._setPoint("setEnd",d,a,1)},setEndBefore:function(d,a){this._setPoint("setEnd",d,a,0)},_setPoint:function(d,a,w,t){w=I.getIndex(a,a.parentNode).o;this[d](a.parentNode,w.pop()+t)},_getIERange:function(){var d=(this._body||this.endContainer.ownerDocument.body).createTextRange();v.setRange(d,this.startContainer,
this.startOffset,this.endContainer,this.endOffset,this.collapsed);return d},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var d=this.startContainer,a=this._getIERange();3!==d.nodeType||this.startOffset||this.setStartBefore(d);a.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var d=new e([this.startContainer,this.startOffset,
this.endContainer,this.endOffset]);d._body=this._body;return d},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});K.setObject("dijit.range",I);return I})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(O,J,K){var I={};J.setObject("dijit._editor.html",I);var v=I.escapeXml=function(e,d){e=e.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,
"\x26gt;").replace(/"/gm,"\x26quot;");d||(e=e.replace(/'/gm,"\x26#39;"));return e};I.getNodeHtml=function(e){var d=[];I.getNodeHtmlHelper(e,d);return d.join("")};I.getNodeHtmlHelper=function(e,d){switch(e.nodeType){case 1:var a=e.nodeName.toLowerCase();if(!a||"/"==a.charAt(0))return"";d.push("\x3c",a);var w=[],t={},g;if(K("dom-attributes-explicit")||K("dom-attributes-specified-flag"))for(var l=0;g=e.attributes[l++];){var A=g.name;"_dj"===A.substr(0,3)||K("dom-attributes-specified-flag")&&!g.specified||
A in t||(g=g.value,("src"==A||"href"==A)&&e.getAttribute("_djrealurl")&&(g=e.getAttribute("_djrealurl")),8===K("ie")&&"style"===A&&(g=g.replace("HEIGHT:","height:").replace("WIDTH:","width:")),w.push([A,g]),t[A]=g)}else{var h=(/^input$|^img$/i.test(e.nodeName)?e:e.cloneNode(!1)).outerHTML;t=h.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);h=h.substr(0,h.indexOf("\x3e"));O.forEach(t,function(p){if(p){var k=p.indexOf("\x3d");if(0<k&&(p=p.substring(0,k),"_dj"!=p.substr(0,3)))if("src"!=p&&"href"!=p||!e.getAttribute("_djrealurl")){switch(p){case "style":var n=
e.style.cssText.toLowerCase();break;case "class":n=e.className;break;case "width":if("img"===a){(k=/width=(\S+)/i.exec(h))&&(n=k[1]);break}case "height":if("img"===a){(k=/height=(\S+)/i.exec(h))&&(n=k[1]);break}default:n=e.getAttribute(p)}null!=n&&w.push([p,n.toString()])}else w.push([p,e.getAttribute("_djrealurl")])}},this)}w.sort(function(p,k){return p[0]<k[0]?-1:p[0]==k[0]?0:1});for(t=0;g=w[t++];)d.push(" ",g[0],'\x3d"',"string"===typeof g[1]?v(g[1],!0):g[1],'"');switch(a){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":d.push(" /\x3e");
break;case "script":d.push("\x3e",e.innerHTML,"\x3c/",a,"\x3e");break;default:d.push("\x3e"),e.hasChildNodes()&&I.getChildrenHtmlHelper(e,d),d.push("\x3c/",a,"\x3e")}break;case 4:case 3:d.push(v(e.nodeValue,!0));break;case 8:d.push("\x3c!--",v(e.nodeValue,!0),"--\x3e");break;default:d.push("\x3c!-- Element not recognized - Type: ",e.nodeType," Name: ",e.nodeName,"--\x3e")}};I.getChildrenHtml=function(e){var d=[];I.getChildrenHtmlHelper(e,d);return d.join("")};I.getChildrenHtmlHelper=function(e,d){if(e)for(var a=
e.childNodes||e,w=!K("ie")||a!==e,t,g=0;t=a[g++];)w&&t.parentNode!=e||I.getNodeHtmlHelper(t,d)};return I})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,A){var h=K("dijit._editor.plugins.LinkDialog",g,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:l,useDefaultCommand:!1,
urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=e.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(k){O("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),e.hitch(this,function(n,m,C){var B=this;this.tag="insertImage"==this.command?"img":"a";n=e.delegate(n.getLocalization("dijit","common",this.lang),n.getLocalization("dijit._editor",
"LinkDialog",this.lang));var y=this.dropDown=this.button.dropDown=new m({title:n[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:e.hitch(this,"setValue"),onOpen:function(){B._onOpenDialog();m.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(e.hitch(B,"_onCloseDialog"),0)}});n.urlRegExp=this.urlRegExp;n.id=C.getUniqueId(this.editor.id);this._uniqueId=n.id;this._setContent(y.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
t.substitute(this.linkDialogTemplate,n));y.startup();this._urlInput=C.byId(this._uniqueId+"_urlInput");this._textInput=C.byId(this._uniqueId+"_textInput");this._setButton=C.byId(this._uniqueId+"_setButton");this.own(C.byId(this._uniqueId+"_cancelButton").on("click",e.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",e.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",e.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=e.hitch(this,function(){var G=this._urlInput.get("value");return this._urlRegExp.test(G)||this._emailRegExp.test(G)});this.own(d(y.domNode,"keydown",e.hitch(this,e.hitch(this,function(G){!G||G.keyCode!=v.ENTER||G.shiftKey||G.metaKey||G.ctrlKey||G.altKey||this._setButton.get("disabled")||(y.onExecute(),y.execute(y.get("value")))}))));k()}))},_checkAndFixInput:function(){var k=this,n=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var m=n,C=!1,B=!1;m&&1<m.length&&(m=e.trim(m),0!==m.indexOf("mailto:")&&(0<m.indexOf("/")?-1===m.indexOf("://")&&"/"!==m.charAt(0)&&m.indexOf("./")&&0!==m.indexOf("../")&&k._hostRxp.test(m)&&(C=!0):k._userAtRxp.test(m)&&(B=!0)));C&&k._urlInput.set("value","http://"+m);B&&k._urlInput.set("value","mailto:"+m);k._setButton.set("disabled",!k._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(e.hitch(this,
function(){this.own(d(this.editor.editNode,"mouseup",e.hitch(this,"_onMouseUp")));this.own(d(this.editor.editNode,"dblclick",e.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(k){this.dropDown.set({parserScope:"dojo",content:k})},_checkValues:function(k){k&&k.urlInput&&(k.urlInput=k.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&k&&k.textInput&&("function"===typeof this.linkFilter?k.textInput=this.linkFilter(k.textInput):
J.forEach(this.linkFilter,function(n){k.textInput=k.textInput.replace(n[0],n[1])}));return k},_createlinkEnabledImpl:function(){return!0},setValue:function(k){this._onCloseDialog();if(9>a("ie")){var n=A.getSelection(this.editor.window).getRangeAt(0).endContainer;3===n.nodeType&&(n=n.parentNode);n&&n.nodeName&&n.nodeName.toLowerCase()!==this.tag&&(n=this.editor.selection.getSelectedElement(this.tag));n&&n.nodeName&&n.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(n),
this.editor.execCommand("unlink"))}k=this._checkValues(k);this.editor.execCommand("inserthtml",t.substitute(this.htmlTemplate,k));w("a",this.editor.document).forEach(function(m){m.innerHTML||I.has(m,"name")||m.parentNode.removeChild(m)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(k){if(k&&k.tagName.toLowerCase()===this.tag){var n=k.getAttribute("_djrealurl")||k.getAttribute("href");var m=k.getAttribute("target")||"_self";var C=k.textContent||
k.innerText;this.editor.selection.selectElement(k,!0)}else C=this.editor.selection.getSelectedText();return{urlInput:n||"",textInput:C||"",targetSelect:m||""}},_onOpenDialog:function(){if(a("ie")){var k=A.getSelection(this.editor.window);if(k.rangeCount){var n=k.getRangeAt(0);var m=n.endContainer;3===m.nodeType&&(m=m.parentNode);m&&m.nodeName&&m.nodeName.toLowerCase()!==this.tag&&(m=this.editor.selection.getSelectedElement(this.tag));if(!m||m.nodeName&&m.nodeName.toLowerCase()!==this.tag)(k=this.editor.selection.getAncestorElement(this.tag))&&
k.nodeName&&k.nodeName.toLowerCase()==this.tag?(m=k,this.editor.selection.selectElement(m)):n.startContainer===n.endContainer&&(k=n.startContainer.firstChild)&&k.nodeName&&k.nodeName.toLowerCase()==this.tag&&(m=k,this.editor.selection.selectElement(m))}}else m=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(m))},_onDblClick:function(k){if(k&&k.target&&(k=k.target,(k.tagName?k.tagName.toLowerCase():
"")===this.tag&&I.get(k,"href"))){var n=this.editor;this.editor.selection.selectElement(k);n.onDisplayChanged();n._updateTimer&&(n._updateTimer.remove(),delete n._updateTimer);n.onNormalizedDisplayChanged();var m=this.button;setTimeout(function(){m.set("disabled",!1);m.loadAndOpenDropDown().then(function(){m.dropDown.focus&&m.dropDown.focus()})},10)}},_onMouseUp:function(){if(a("ff")){var k=this.editor.selection.getAncestorElement(this.tag);if(k){var n=A.getSelection(this.editor.window).getRangeAt(0);
if(n.collapsed&&k.childNodes.length){var m=n.cloneRange();m.selectNodeContents(k.childNodes[k.childNodes.length-1]);m.setStart(k.childNodes[0],0);1!==n.compareBoundaryPoints(m.START_TO_START,m)?n.setStartBefore(k):-1!==n.compareBoundaryPoints(m.END_TO_START,m)&&n.setStartAfter(k)}}}}}),p=K("dijit._editor.plugins.ImgLinkDialog",[h],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(k){if(k&&k.tagName.toLowerCase()===this.tag){var n=k.getAttribute("_djrealurl")||k.getAttribute("src");var m=k.getAttribute("alt");this.editor.selection.selectElement(k,!0)}else m=this.editor.selection.getSelectedText();return{urlInput:n||"",textInput:m||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(e.hitch(this,function(){this.own(d(this.editor.editNode,"mousedown",e.hitch(this,"_selectTag")))}))},_selectTag:function(k){k&&k.target&&(k=k.target,(k.tagName?k.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(k))},_checkValues:function(k){k&&k.urlInput&&(k.urlInput=k.urlInput.replace(/"/g,"\x26quot;"));k&&k.textInput&&(k.textInput=k.textInput.replace(/"/g,"\x26quot;"));return k},_onDblClick:function(k){if(k&&k.target&&(k=k.target,(k.tagName?
k.tagName.toLowerCase():"")===this.tag&&I.get(k,"src"))){var n=this.editor;this.editor.selection.selectElement(k);n.onDisplayChanged();n._updateTimer&&(n._updateTimer.remove(),delete n._updateTimer);n.onNormalizedDisplayChanged();var m=this.button;setTimeout(function(){m.set("disabled",!1);m.loadAndOpenDropDown().then(function(){m.dropDown.focus&&m.dropDown.focus()})},10)}}});g.registry.createLink=function(k){var n={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in k?k.allowUnsafeHtml:!1};
"linkFilter"in k&&(n.linkFilter=k.linkFilter);return new h(n)};g.registry.insertImage=function(){return new p({command:"insertImage"})};h.ImgLinkDialog=p;return h})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(O,J,K,I,v,e){var d=K("dijit._editor.plugins.TextColor",v,{buttonClass:e,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var a=this;this.button.loadDropDown=function(w){function t(g){a.button.dropDown=new g({dir:a.editor.dir,ownerDocument:a.editor.ownerDocument,value:a.value,onChange:function(l){a.editor.execCommand(a.command,l)},onExecute:function(){a.editor.execCommand(a.command,this.get("value"))}});w()}"string"==typeof a.colorPicker?O([a.colorPicker],t):t(a.colorPicker)}},updateState:function(){var a=this.editor,w=this.command;if(a&&a.isLoaded&&w.length){if(this.button){var t=this.get("disabled");
this.button.set("disabled",t);if(t)return;try{var g=a.queryCommandValue(w)||""}catch(l){g=""}}""==g&&(g="#000000");"transparent"==g&&(g="#ffffff");"string"==typeof g?-1<g.indexOf("rgb")&&(g=J.fromRgb(g).toHex()):(g=((g&255)<<16|g&65280|(g&16711680)>>>16).toString(16),g="#000000".slice(0,7-g.length)+g);this.value=g;(a=this.button.dropDown)&&a.get&&g!==a.get("value")&&a.set("value",g,!1)}}});v.registry.foreColor=function(a){return new d(a)};v.registry.hiliteColor=function(a){return new d(a)};return d})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n){O=O([t,g],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:k,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(m,C){J.mixin(this,n.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=K.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=K.connect(this._uploadField,"onfocus",J.hitch(this,function(m){p.hide(this._attachmentError)}))},destroy:function(){I.forEach(this._aeConnects,K.disconnect);K.disconnect(this._uploadField_connect);K.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(m,C){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";I.forEach(this.domNode.children,function(B,y){p.show(B)});p.hide(this._attachmentError);m&&(this._featureLayer=m.getLayer()||C)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:m}).canUpdate,this._oid=m.attributes[this._featureLayer.objectIdField],this._getAttachments(m)):C&&C.getEditCapabilities()||(p.hide(this._uploadForm),I.forEach(this.domNode.children,function(B,y){p.hide(B)})))},_getAttachments:function(m){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,J.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){p.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(p.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,J.hitch(this,"_onAddAttachmentComplete"),J.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(m,C){this._tempUpload&&(p.show(this._attachmentProgress),C.addAttachment(m,this._tempUpload,J.hitch(this,"_onAddAttachmentComplete"),J.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(m,
C){p.show(this._attachmentProgress);this._featureLayer.deleteAttachments(m,[C],J.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(m){var C=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(C=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(C=this._listHtml+this._endHtml);var B=this._attachmentList;m=I.map(m,J.hitch(this,function(y){return h.substitute({href:y.url,name:y.name,oid:y.objectId,attid:y.id},C)}));B.innerHTML=m.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(m){p.hide(this._attachmentProgress.domNode);var C=this._attachmentList,B=this._uploadField,y=B.value,G=y.lastIndexOf("\\");
-1<G&&(y=y.substring(G+1,y.length));y=y.replace(/ /g,"_");G=a.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var f=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(f=this._listHtml+this._endHtml);m=h.substitute({href:this._featureLayer._url.path+"/"+m.objectId+"/attachments/"+m.attachmentId+(G?"?"+G:""),name:y,oid:m.objectId,attid:m.attachmentId},
f);C.innerHTML=C.innerHTML==this.NLS_none?m:C.innerHTML+m;this._updateConnects();B.value=""},_onAddAttachmentError:function(m){p.hide(this._attachmentProgress.domNode);if(m){var C=this.NLS_error,B=this._attachmentError;h.isDefined(m.code)&&400===m.code&&(C=this.NLS_fileNotSupported);w.set(B,"innerHTML",C);p.show(B)}},_onDeleteAttachmentComplete:function(m){p.hide(this._attachmentProgress.domNode);var C=this._attachmentList;I.every(m,function(B){return B.success})&&(v.query("#node_"+m[0].objectId+
"_"+m[0].attachmentId).orphan(),C.children&&C.children.length||(C.innerHTML=this.NLS_none))},_updateConnects:function(){I.forEach(this._aeConnects,K.disconnect);v.query(".deleteAttachment").forEach(function(m){this._aeConnects.push(K.connect(m,"onclick",J.hitch(this,"_deleteAttachment",this._oid,m.id)))},this)}});e("extend-esri")&&J.setObject("dijit.editing.AttachmentEditor",O,A);return O})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(O,J,K,I,v,e,d,a){return J("dijit.ProgressBar",[e,d],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:a,_indeterminateHighContrastImagePath:O.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(w){var t="rtl"==w.toLowerCase();K.toggle(this.domNode,"dijitProgressBarRtl",t);K.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&t);this.inherited(arguments)},update:function(w){I.mixin(this,w||{});w=this.internalProgress;var t=this.domNode,g=1;this.indeterminate?t.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(g=Math.min(parseFloat(this.progress)/100,1),this.progress=g*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),g=this.maximum?this.progress/this.maximum:0),t.setAttribute("aria-valuenow",this.progress));t.setAttribute("aria-labelledby",this.labelNode.id);t.setAttribute("aria-valuemin",0);t.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(g);K.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);K.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());w.style.width=100*g+"%";this.onChange()},_setValueAttr:function(w){this._set("value",
w);Infinity==w?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:w})},_setLabelAttr:function(w){this._set("label",w);this.update()},_setIndeterminateAttr:function(w){this._set("indeterminate",w);this.update()},report:function(w){return this.label?this.label:this.indeterminate?"\x26#160;":v.format(w,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(O,J,K,I){var v={};v={findFeatures:function(e,d,a){var w=d.objectIdField;d=J.filter(d.graphics,function(t){return J.some(e,function(g){return t.attributes[w]===g.objectId})});if(a)a(d);else return d},getSelection:function(e){var d=[];J.forEach(e,function(a){a=a.getSelectedFeatures();J.forEach(a,function(w){d.push(w)})});return d},sortFeaturesById:function(e,d){var a=J.map(e,function(w){return w.featureLayer});d.sort(function(w,t){var g=w.getLayer(),l=t.getLayer();if(!g)return-1;if(!l)return 1;
var A=J.indexOf(a,g);l=J.indexOf(a,l);A-=l;A||(g=g.objectIdField,A=w.attributes[g]-t.attributes[g]);return A});return d}};K("extend-esri")&&O.setObject("dijit.editing.Util.LayerHelper",v,I);return v})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(O,J,K,I){var v=J.getObject("date.islamic",!0,O);v.getDaysInMonth=function(e){return e.getDaysInIslamicMonth(e.getMonth(),e.getFullYear())};v.compare=function(e,d,a){e instanceof I&&(e=e.toGregorian());
d instanceof I&&(d=d.toGregorian());return K.compare.apply(null,arguments)};v.add=function(e,d,a){var w=new I(e);switch(d){case "day":w.setDate(e.getDate()+a);break;case "weekday":var t=e.getDay();if(5>t+a&&0<t+a)w.setDate(e.getDate()+a);else{var g=d=0;5==t?(t=4,g=0<a?-1:1):6==t&&(t=4,g=0<a?-2:2);t=0<a?5-t-1:-t;var l=a-t,A=parseInt(l/5);0!=l%5&&(d=0<a?2:-2);d=d+7*A+l%5+t;w.setDate(e.getDate()+d+g)}break;case "year":w.setFullYear(e.getFullYear()+a);break;case "week":a*=7;w.setDate(e.getDate()+a);break;
case "month":e=e.getMonth();w.setMonth(e+a);break;case "hour":w.setHours(e.getHours()+a);break;case "minute":w._addMinutes(a);break;case "second":w._addSeconds(a);break;case "millisecond":w._addMilliseconds(a)}return w};v.difference=function(e,d,a){d=d||new I;a=a||"day";var w=d.getFullYear()-e.getFullYear(),t=1;switch(a){case "weekday":w=Math.round(v.difference(e,d,"day"));t=parseInt(v.difference(e,d,"week"));if(0==w%7)w=5*t;else{a=0;var g=e.getDay(),l=d.getDay();t=parseInt(w/7);d=w%7;e=new I(e);
e.setDate(e.getDate()+7*t);e=e.getDay();if(0<w)switch(!0){case 5==g:a=-1;break;case 6==g:a=0;break;case 5==l:a=-1;break;case 6==l:a=-2;break;case 5<e+d:a=-2}else if(0>w)switch(!0){case 5==g:a=0;break;case 6==g:a=1;break;case 5==l:a=2;break;case 6==l:a=1;break;case 0>e+d:a=2}w=w+a-2*t}t=w;break;case "year":t=w;break;case "month":a=d.toGregorian()>e.toGregorian()?d:e;g=d.toGregorian()>e.toGregorian()?e:d;t=a.getMonth();l=g.getMonth();if(0==w)t=a.getMonth()-g.getMonth();else for(t=12-l+t,w=g.getFullYear()+
1,a=a.getFullYear(),w;w<a;w++)t+=12;d.toGregorian()<e.toGregorian()&&(t=-t);break;case "week":t=parseInt(v.difference(e,d,"day")/7);break;case "day":t/=24;case "hour":t/=60;case "minute":t/=60;case "second":t/=1E3;case "millisecond":t*=d.toGregorian().getTime()-e.toGregorian().getTime()}return Math.round(t)};return v})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(O,J,K){var I=J("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var v=arguments.length;v?1==v?(v=arguments[0],"number"==typeof v&&(v=new Date(v)),v instanceof Date?this.fromGregorian(v):""==v?this._date=new Date(""):(this._year=v._year,this._month=v._month,this._date=v._date,this._hours=v._hours,this._minutes=v._minutes,this._seconds=v._seconds,this._milliseconds=v._milliseconds)):3<=v&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(v){v=parseInt(v);if(!(0<v&&v<=this.getDaysInIslamicMonth(this._month,this._year))){var e;if(0<v)for(e=this.getDaysInIslamicMonth(this._month,this._year);v>e;v-=e,e=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(e=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=v;e=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),v+=e}this._date=v;return this},setFullYear:function(v){this._year=+v},setMonth:function(v){this._year+=Math.floor(v/12);this._month=0<v?Math.floor(v%12):Math.floor((v%12+12)%12)},setHours:function(){var v=arguments.length,e=0;1<=v&&(e=parseInt(arguments[0]));2<=v&&(this._minutes=parseInt(arguments[1]));3<=v&&(this._seconds=parseInt(arguments[2]));4==v&&(this._milliseconds=parseInt(arguments[3]));for(;24<=e;)this._date++,v=this.getDaysInIslamicMonth(this._month,
this._year),this._date>v&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=v),e-=24;this._hours=e},_addMinutes:function(v){v+=this._minutes;this.setMinutes(v);this.setHours(this._hours+parseInt(v/60));return this},_addSeconds:function(v){v+=this._seconds;this.setSeconds(v);this._addMinutes(parseInt(v/60));return this},_addMilliseconds:function(v){v+=this._milliseconds;this.setMilliseconds(v);this._addSeconds(parseInt(v/1E3));return this},setMinutes:function(v){this._minutes=
v%60;return this},setSeconds:function(v){this._seconds=v%60;return this},setMilliseconds:function(v){this._milliseconds=v%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var v=new Date;v.setHours(this._hours);v.setMinutes(this._minutes);v.setSeconds(this._seconds);v.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+v.toTimeString()},toGregorian:function(){var v=this._year;v=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(v-1)+Math.floor((3+11*v)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var e=v-this._GREGORIAN_EPOCH,d=Math.floor(e/146097),a=this._mod(e,146097);e=Math.floor(a/36524);var w=this._mod(a,36524);a=Math.floor(w/1461);w=this._mod(w,1461);w=Math.floor(w/365);d=400*d+100*e+4*a+w;4!=e&&4!=w&&d++;e=v-(this._GREGORIAN_EPOCH+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400));a=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor(739/12+(K.isLeapYear(new Date(d,
3,1))?-1:-2)+1);a=v<a?0:K.isLeapYear(new Date(d,3,1))?1:2;e=Math.floor((12*(e+a)+373)/367);a=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor((367*e-362)/12+(2>=e?0:K.isLeapYear(new Date(d,e-1,1))?-1:-2)+1);return new Date(d,e-1,v-a+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(v){v=new Date(v);var e=v.getFullYear(),d=v.getMonth(),a=v.getDate();e=this._GREGORIAN_EPOCH-1+365*(e-1)+Math.floor((e-1)/4)+
-Math.floor((e-1)/100)+Math.floor((e-1)/400)+Math.floor((367*(d+1)-362)/12+(2>=d+1?0:K.isLeapYear(v)?-1:-2)+a);e=Math.floor(e)+.5;e-=this._ISLAMIC_EPOCH;d=Math.floor((30*e+10646)/10631);a=Math.ceil((e-29-this._yearStart(d))/29.5);a=Math.min(a,11);this._date=Math.ceil(e-this._monthStart(d,a))+1;this._month=a;this._year=d;this._hours=v.getHours();this._minutes=v.getMinutes();this._seconds=v.getSeconds();this._milliseconds=v.getMilliseconds();this._day=v.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(v){return 354*(v-1)+Math.floor((3+11*v)/30)},_monthStart:function(v,e){return Math.ceil(29.5*e)+354*(v-1)+Math.floor((3+11*v)/30)},_civilLeapYear:function(v){return 11>(14+11*v)%30},getDaysInIslamicMonth:function(v,e){var d=0;d=29+(v+1)%2;11==v&&this._civilLeapYear(e)&&d++;return d},_mod:function(v,e){return v-e*Math.floor(v/e)}});I.getDaysInIslamicMonth=function(v){return(new I).getDaysInIslamicMonth(v.getMonth(),v.getFullYear())};return I})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(O,J,K,I,v,e,d,a,w){function t(p,k,n,m,C){return C.replace(/([a-z])\1*/ig,function(B){var y=B.charAt(0);B=B.length;var G=["abbr","wide","narrow"];switch(y){case "G":var f=k.eraAbbr[0];break;case "y":f=String(p.getFullYear());break;case "M":f=p.getMonth();if(3>B){f+=1;var b=!0}else y=["months-format",G[B-3]].join("-"),f=k[y][f];break;case "d":f=p.getDate(!0);b=!0;break;case "E":f=p.getDay();3>B?(f+=1,b=!0):(y=["days-format",G[B-3]].join("-"),f=k[y][f]);break;case "a":f=12>p.getHours()?"am":
"pm";f=k["dayPeriods-format-wide-"+f];break;case "h":case "H":case "K":case "k":b=p.getHours();switch(y){case "h":f=b%12||12;break;case "H":f=b;break;case "K":f=b%12;break;case "k":f=b||24}b=!0;break;case "m":f=p.getMinutes();b=!0;break;case "s":f=p.getSeconds();b=!0;break;case "S":f=Math.round(p.getMilliseconds()*Math.pow(10,B-3));b=!0;break;case "z":if(f=I.getTimezoneName(p.toGregorian()))break;B=4;case "Z":f=p.toGregorian().getTimezoneOffset();f=[0>=f?"+":"-",d.pad(Math.floor(Math.abs(f)/60),2),
d.pad(Math.abs(f)%60,2)];4==B&&(f.splice(0,0,"GMT"),f.splice(3,0,":"));f=f.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+C);}b&&(f=d.pad(f,B));return f})}function g(p,k,n,m){var C=function(G){return G};k=k||C;n=n||C;m=m||C;var B=p.match(/(''|[^'])+/g),y="'"==p.charAt(0);K.forEach(B,function(G,f){G?(B[f]=(y?n:k)(G),y=!y):B[f]=""});return m(B.join(""))}function l(p,k,n,m){m=e.escapeString(m);v.normalizeLocale(n.locale);return m.replace(/([a-z])\1*/ig,
function(C){var B=C.charAt(0);var y=C.length,G="";n.strict?1<y&&(G="0{"+(y-1)+"}"):G="0?";switch(B){case "y":B="\\d+";break;case "M":B=2<y?"\\S+ ?\\S+":G+"[1-9]|1[0-2]";break;case "d":B="[12]\\d|"+G+"[1-9]|3[01]";break;case "E":B="\\S+";break;case "h":B=G+"[1-9]|1[0-2]";break;case "k":B=G+"\\d|1[01]";break;case "H":B=G+"\\d|1\\d|2[0-3]";break;case "K":B=G+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":B=G+"\\d|[0-5]\\d";break;case "S":B="\\d{"+y+"}";break;case "a":y=n.am||k["dayPeriods-format-wide-am"];
G=n.pm||k["dayPeriods-format-wide-pm"];n.strict?B=y+"|"+G:(B=y+"|"+G,y!=y.toLowerCase()&&(B+="|"+y.toLowerCase()),G!=G.toLowerCase()&&(B+="|"+G.toLowerCase()));break;default:B=".*"}p&&p.push(C);return"("+B+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var A=J.getObject("date.islamic.locale",!0,O);A.format=function(p,k){k=k||{};var n=v.normalizeLocale(k.locale),m=k.formatLength||"short",C=A._getIslamicBundle(n),B=[];n=J.hitch(this,t,p,C,n,k.fullYear);if("year"==k.selector)return p.getFullYear();"time"!=k.selector&&
(p=k.datePattern||C["dateFormat-"+m])&&B.push(g(p,n));"date"!=k.selector&&(k=k.timePattern||C["timeFormat-"+m])&&B.push(g(k,n));return B.join(" ")};A.regexp=function(p){return A._parseInfo(p).regexp};A._parseInfo=function(p){p=p||{};var k=v.normalizeLocale(p.locale);k=A._getIslamicBundle(k);var n=p.formatLength||"short",m=p.datePattern||k["dateFormat-"+n];n=p.timePattern||k["timeFormat-"+n];var C=[];return{regexp:g("date"==p.selector?m:"time"==p.selector?n:"undefined"==typeof n?m:m+" "+n,J.hitch(this,
l,C,k,p)),tokens:C,bundle:k}};A.parse=function(p,k){p=p.replace(/[\u200E\u200F\u202A\u202E]/g,"");k||(k={});var n=A._parseInfo(k),m=n.tokens,C=n.bundle;n=n.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");p=(new RegExp("^"+n+"$")).exec(p);v.normalizeLocale(k.locale);if(!p)return null;var B=[1389,0,1,0,0,0,0],y="",G=["abbr","wide","narrow"];K.every(p,function(f,b){if(!b)return!0;b=m[b-1];var z=b.length;switch(b.charAt(0)){case "y":B[0]=Number(f);break;case "M":if(2<z){if(b=C["months-format-"+G[z-3]].concat(),
k.strict||(f=f.replace(".","").toLowerCase(),b=K.map(b,function(D){return D?D.replace(".","").toLowerCase():D})),f=K.indexOf(b,f),-1==f)return!1}else f--;B[1]=Number(f);break;case "D":B[1]=0;case "d":B[2]=Number(f);break;case "a":b=k.am||C["dayPeriods-format-wide-am"];z=k.pm||C["dayPeriods-format-wide-pm"];if(!k.strict){var c=/\./g;f=f.replace(c,"").toLowerCase();b=b.replace(c,"").toLowerCase();z=z.replace(c,"").toLowerCase()}if(k.strict&&f!=b&&f!=z)return!1;y=f==z?"p":f==b?"a":"";break;case "K":24==
f&&(f=0);case "h":case "H":case "k":B[3]=Number(f);break;case "m":B[4]=Number(f);break;case "s":B[5]=Number(f);break;case "S":B[6]=Number(f)}return!0});p=+B[3];"p"===y&&12>p?B[3]=p+12:"a"===y&&12==p&&(B[3]=0);return new a(B[0],B[1],B[2],B[3],B[4],B[5],B[6])};var h=[];A.addCustomFormats=function(p,k){h.push({pkg:p,name:k})};A._getIslamicBundle=function(p){var k={};K.forEach(h,function(n){n=v.getLocalization(n.pkg,n.name,p);k=J.mixin(k,n)},this);return k};A.addCustomFormats("dojo.cldr","islamic");A.getNames=
function(p,k,n,m,C){m=A._getIslamicBundle(m);p=[p,n,k];if("standAlone"==n){n=p.join("-");var B=m[n];1==B[0]&&(B=void 0)}p[1]="format";return(B||m[p.join("-")]).concat()};A.weekDays=A.getNames("days","wide","format");A.months=A.getNames("months","wide","format");return A})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(O,J,K,I,v,e){J=J(e,{declaredClass:"esri.dijit.editing.Add",type:"edit",
label:"Add Features",constructor:function(d){d=d||{};d.featureLayer?(this._featureLayer=d.featureLayer,d.addedGraphics?this._addedGraphics=d.addedGraphics:console.error("In constructor of 'esri.dijit.editing.Add', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Add', featureLayer is not provided")},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._addedGraphics,d,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(K.hitch(this,
function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d=O.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(K.hitch(this,function(a,w,t){a=O.map(a,function(g){return g.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,operation:this}}))}});I("extend-esri")&&K.setObject("dijit.editing.Add",J,v);return J})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(O,J,K,I,v){J=J(v,{declaredClass:"esri.EditOperationBase",updateIds:function(e,d,a,w){O.forEach(d,function(t,g){var l=t[e.objectIdField];O.forEach(a,function(A,h){l===A&&(t[e.objectIdField]=w[h])})})}});K("extend-esri")&&(I.EditOperationBase=J);return J})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(O,J,K,I,v,e,d){O=J(d,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var w;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(w=0;w<a.preUpdatedGraphics.length;w++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[w].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[w].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],w=0;w<a.postUpdatedGraphics.length;w++)a.postUpdatedGraphics[w].geometry?this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[w].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[w].geometry),this._postUpdatedGraphicsAttributes.push(K.clone(a.postUpdatedGraphics[w].attributes));else console.error("In constructor of 'esri.dijit.editing.Update', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Update', preUpdatedGraphics not provided");
else console.error("In constructor of 'esri.dijit.editing.Update', featureLayer not provided")},updateObjectIds:function(a,w){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,w);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,w)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(e.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),
this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(K.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(e.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),
this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(K.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});I("extend-esri")&&K.setObject("dijit.editing.Update",O,v);return O})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(O,J,K,I,v,e){J=J(e,{declaredClass:"esri.dijit.editing.Delete",
type:"edit",label:"Delete Features",constructor:function(d){d=d||{};d.featureLayer?(this._featureLayer=d.featureLayer,d.deletedGraphics?this._deletedGraphics=d.deletedGraphics:console.error("In constructor of 'esri.dijit.editing.Delete', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Delete', featureLayer is not provided")},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._deletedGraphics,d,a)},performUndo:function(){var d=O.map(this._deletedGraphics,
function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(K.hitch(this,function(a,w,t){a=O.map(a,function(g){return g.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(K.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});I("extend-esri")&&K.setObject("dijit.editing.Delete",
J,v);return J})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(O,J,K,I,v,e,d){J=J(d,{declaredClass:"esri.dijit.editing.Cut",type:"edit",label:"Cut Features",constructor:function(a){var w;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.addedGraphics)if(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];
this._preUpdatedGraphicsAttributes=[];for(w=0;w<a.preUpdatedGraphics.length;w++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[w].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[w].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],w=0;w<a.postUpdatedGraphics.length;w++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[w].geometry.toJson()),
this._postUpdatedGraphicsAttributes.push(K.clone(a.postUpdatedGraphics[w].attributes));else console.error("In constructor of 'esri.dijit.editing.Cut', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Cut', preUpdatedGraphics not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', addedGraphics for cut not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', featureLayer not provided")},updateObjectIds:function(a,
w){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,w);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,w);this.updateIds(this._featureLayer,this._addedGraphics,a,w)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(e.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,
this._postUpdatedGraphics,this._addedGraphics).then(K.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(e.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);var w=O.map(this._addedGraphics,function(t){return t.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,
this._postUpdatedGraphics,null).then(K.hitch(this,function(t,g,l){t=O.map(t,function(A){return A.objectId});return{oldIds:w,addedIds:t,layer:this._featureLayer,operation:this}}))}});I("extend-esri")&&K.setObject("dijit.editing.Cut",J,v);return J})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(O,J,K,I,v,e,d){J=J(d,{declaredClass:"esri.dijit.editing.Union",type:"edit",
label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var w;for(w=0;w<a.preUpdatedGraphics.length;w++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[w].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[w].attributes);for(w=0;w<a.postUpdatedGraphics.length;w++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[w].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(K.clone(a.postUpdatedGraphics[w].attributes))},updateObjectIds:function(a,w){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,w);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,w);this.updateIds(this._featureLayer,
this._deletedGraphics,a,w)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(e.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var w=O.map(this._deletedGraphics,function(t){return t.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(K.hitch(this,function(t,
g,l){t=O.map(t,function(A){return A.objectId});return{oldIds:w,addedIds:t,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(e.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(K.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});I("extend-esri")&&K.setObject("dijit.editing.Union",J,v);return J})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n){O=O([a,
e],{declaredClass:"esri.dijit.editing.toolbars.Drawing",onShowAttributeInspector:function(){},_activateTool:function(m,C){this._settings.editor._activeTool=m;"EDITING"!==m&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==m&&this._settings.editor._hideAttributeInspector();"CLEAR"!==m&&this.inherited(arguments)},_initializeToolbar:function(){K.forEach(this._settings.layers,function(m){this._tbConnects.push(I.connect(m,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(m,
C){this._tools.EDITING._activateTool(m,C.geometryType);this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=d.getSelection(this._settings.layers);var m=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=m);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",
0>=m);this._tools.ATTRIBUTES&&this._tools.ATTRIBUTES.set("disabled",0>=m);this._tools.UNION&&this._tools.UNION.set("disabled",2>m)},_toolFinished:function(m){if("ATTRIBUTES"===m&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===m||"CUT"===m||"RESHAPING"===m||"EDITING"===m)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===m)this.onDelete();this._settings.editor._activeTool=null;
this._updateUI()},_createTools:function(){this._tools.SELECT=new p({settings:this._settings,onClick:J.hitch(this,"_activateTool","SELECT",!0),onFinished:J.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new w(J.mixin(k.selectClear,{settings:this._settings,onClick:J.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new w(J.mixin(h.attributes,{settings:this._settings,onClick:J.hitch(this,
"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);this._createSeparator();this._tools.EDITING=new A({settings:this._settings,onClick:J.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:J.hitch(this,"onApplyEdits"),onFinished:J.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new w(J.mixin(h.del,{settings:this._settings,onClick:J.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&
((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new t({settings:this._settings,onFinished:J.hitch(this,"_toolFinished","CUT"),onClick:J.hitch(this,"_activateTool","CUT",!0),onApplyEdits:J.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new g({settings:this._settings,
onFinished:J.hitch(this,"_toolFinished","UNION"),onApplyEdits:J.hitch(this,"onApplyEdits")}),this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new l({settings:this._settings,onClick:J.hitch(this,"_activateTool","RESHAPING",!0),onFinished:J.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:J.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new w(J.mixin(h.undo,
{settings:this._settings,disabled:!0,onClick:J.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new w(J.mixin(h.redo,{settings:this._settings,disabled:!0,onClick:J.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});v("extend-esri")&&J.setObject("dijit.editing.toolbars.Drawing",
O,n);return O})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),function(O,J,K,I,v,e,d,a,w){O=O([e],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(t,g){t&&t.settings&&(this._tools=[],this._tbConnects=
[],this._initialize(t.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var t,g=this._tools;for(t in g)g.hasOwnProperty(t)&&w.isDefined(this._tools[t])&&this._tools[t].destroy();K.forEach(this._tbConnects,I.disconnect);this.inherited(arguments)},activate:function(t){this._enabled=!0},deactivate:function(){var t;this._enabled=!1;this._geometryType=this._layer=null;var g=this._tools;for(t in g)g.hasOwnProperty(t)&&(this._tools[t].deactivate(),this._tools[t].setChecked(!1))},
isEnabled:function(){return this._enabled},setActiveSymbol:function(t){this._activeSymbol=t},_getSymbol:function(){},_createTools:function(){},_initialize:function(t){this._settings=t;this._toolbar=t.drawToolbar;this._editToolbar=t.editToolbar;this._initializeToolbar()},_activateTool:function(t,g){this._activeTool&&this._activeTool.deactivate();!0===g&&this._activeTool==this._tools[t]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[t],this._activeTool.setChecked(!0),
this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new d)}});v("extend-esri")&&J.setObject("dijit.editing.toolbars.ToolbarBase",O,a);return O})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),function(O,J,K,I,v,e){O=O([I,v],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},
destroy:function(){I.prototype.destroy.apply(this,arguments);v.prototype.destroy.apply(this,arguments)}});K("extend-esri")&&J.setObject("dijit.editing.tools.ButtonToolBase",O,e);return O})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],function(O,J,K,I,v){O=O(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(e,d){e=e||{};J.mixin(this,e);this.label=
this._label?v.widgets.editor.tools[this._label]:"";this._settings=e.settings;this._toolbar=e.settings.drawToolbar;this._editToolbar=e.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},activate:function(e){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=e,this._toolbar&&
this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(e){this._enabled=e;this._updateUI()},setChecked:function(e){this._checked=e},enable:function(e){this._updateUI()},isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;
this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});K("extend-esri")&&J.setObject("dijit.editing.tools.ToolBase",O,I);return O})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,
A,h){O=O([A],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:g.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(I.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);K.forEach(this._cutConnects,I.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(p){var k=this._cutLayers=
K.filter(this._settings.layers,function(m){return"esriGeometryPolygon"===m.geometryType||"esriGeometryPolyline"===m.geometryType&&m.visible&&m._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(K.map(k,J.hitch(this,function(m){return I.connect(m,"onEditsComplete",J.hitch(this,function(C,B,y){if(this._settings.undoRedoManager){var G=this._settings.undoRedoManager;K.forEach(this._edits,J.hitch(this,function(f){G.add(new l({featureLayer:f.layer,addedGraphics:f.adds,preUpdatedGraphics:f.preUpdates,
postUpdatedGraphics:f.updates}))}),this)}this.onFinished()}))})));var n=new w;n.geometry=p;K.forEach(k,function(m,C){this._settings.editor._selectionHelper.selectFeatures([m],n,t.SELECTION_NEW,J.hitch(this,"_cutFeatures",m,n))},this)},_cutFeatures:function(p,k,n){if(n&&n.length){this._edits=[];var m=[];m.push(this._settings.geometryService.cut(d.getGeometries(n),k.geometry,J.hitch(this,"_cutHandler",p,n)));(new e(m)).addCallback(J.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(p,
k,n){var m=[],C=[],B=K.map(k,function(f){return new a(J.clone(f.toJson()))}),y,G;K.forEach(n.cutIndexes,function(f,b){y!=f?(y=f,1<K.filter(n.cutIndexes,function(z){return z===f}).length&&C.push(k[f].setGeometry(n.geometries[b]))):(G=new a(n.geometries[b],null,J.mixin({},k[f].attributes),null),G.attributes[k[0].getLayer().objectIdField]=null,m.push(G))},this);this._edits.push({layer:p,adds:m,updates:C,preUpdates:B})}});v("extend-esri")&&J.setObject("dijit.editing.tools.Cut",O,h);return O})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(O,J,K,I,v,e){O=O([I,v],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){I.prototype.destroy.apply(this,arguments);v.prototype.destroy.apply(this,arguments)},setChecked:function(d){I.prototype.setChecked.apply(this,arguments)}});K("extend-esri")&&J.setObject("dijit.editing.tools.ToggleToolBase",O,e);return O})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(O,J,K,I,v,e,d,a,w,t){O=O([w],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:d.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(g){this._settings.editor._activeTool="UNION";g=K.filter(this._settings.layers,function(h){return"esriGeometryPolygon"===h.geometryType&&h.visible&&h._isMapAtVisibleScale()});var l=[],A=0;K.forEach(g,function(h,p){var k=h.getSelectedFeatures();2<=
k.length&&(A++,this._settings.geometryService.union(v.getGeometries(k),J.hitch(this,function(n){var m=k.shift(),C=[],B=[];C.push(new e(m.toJson()));B.push(m.setGeometry(n));l.push({layer:h,updates:B,deletes:k,preUpdates:C});A--;if(0>=A)this.onApplyEdits(l,J.hitch(this,function(){if(this._settings.undoRedoManager){var y=this._settings.undoRedoManager;K.forEach(this._edits,J.hitch(this,function(G){y.add(new a({featureLayer:G.layer,deletedGraphics:G.deletes,preUpdatedGraphics:G.preUpdates,postUpdatedGraphics:G.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});I("extend-esri")&&J.setObject("dijit.editing.tools.Union",O,t);return O})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(O,J,K,I,v,e,d,a,w,t,g){O=O([t],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:w.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){I.disconnect(this._rConnect);this._rConnect=I.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);I.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(l){var A=this._settings.layers,h=new a;h.geometry=l;l=this._reshapeLayers=K.filter(A,
function(p){return"esriGeometryPolygon"===p.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(l,h,d.SELECTION_NEW,J.hitch(this,"_reshape",h))},_reshape:function(l,A){if(1===A.length){var h=[],p=[],k=[],n=A[0],m=n.getLayer();this._settings.geometryService.reshape(n.geometry,l.geometry,J.hitch(this,function(C){"polyline"===C.type&&C.paths&&0===C.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===C.type&&C.rings&&
0===C.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(k.push(new e(n.toJson())),p.push(n.setGeometry(C)),h.push({layer:m,updates:p,preUpdates:k}),this.onApplyEdits(h,J.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});v("extend-esri")&&J.setObject("dijit.editing.tools.Reshape",O,g);return O})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(O,J,K,I,v,e,d,a,w,t){O=O([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(g,l){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=v.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(g,l){var A;this.enable(l);for(A in this._tools)this._tools.hasOwnProperty(A)&&(this.dropDown.removeChild(this._tools[A]),
!0===this._tools[A]._enabled&&this.dropDown.addChild(this._tools[A]));if(this._geometryType!==l||!1===this._activeTool._enabled)this._activeTool=this._tools[g.toUpperCase()];this._geometryType=l;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(g){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var g=this._settings.layers,l=this._settings.editor,A=!1,h=!1,p=!1,k=this._toolTypes=[],n;K.forEach(g,function(m){n=m.geometryType;
A=A||"esriGeometryPoint"===n;h=h||"esriGeometryPolyline"===n;p=p||"esriGeometryPolygon"===n;k=k.concat(K.map(this._getTemplatesFromLayer(m),J.hitch(this,function(C){return l._toDrawTool(C.drawingTool,m)})))},this);g=this._settings.createOptions;A&&this._toolTypes.push("point");h&&(this._toolTypes=this._toolTypes.concat(g.polylineDrawTools));p&&(this._toolTypes=this._toolTypes.concat(g.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(k))},_toUnique:function(g){var l={};return K.filter(g,
function(A){return l[A]?!1:l[A]=!0})},_getTemplatesFromLayer:function(g){var l=g.templates||[];K.forEach(g.types,function(A){l=l.concat(A.templates)});return K.filter(l,t.isDefined)},_createTools:function(){K.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(g){var l=J.mixin(d[g],{settings:this._settings,onClick:J.hitch(this,"onItemClicked",d[g].id)});this._tools[g.toUpperCase()]=new e(l)}});I("extend-esri")&&J.setObject("dijit.editing.tools.Editing",O,
w);return O})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(O,J,K,I,v){O=O([I],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(e){this._enabled=e===this._geomType;this.inherited(arguments)}});K("extend-esri")&&J.setObject("dijit.editing.tools.Edit",O,v);return O})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),
function(O,J,K,I,v,e){O=O([I,v],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",destroy:function(){I.prototype.destroy.apply(this,arguments);v.prototype.destroy.apply(this,arguments)}});K("extend-esri")&&J.setObject("dijit.editing.tools.MenuItemBase",O,e);return O})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(O,J,K,I){K={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",
_drawType:K.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:K.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:K.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},
polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:K.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:K.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",
_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:K.POLYGON,_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:K.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:K.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",
_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",_drawType:K.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:K.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:K.LEFT_ARROW,_geomType:"esriGeometryPolygon",
_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:K.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:K.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",
_drawType:K.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:K.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",
_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};J("extend-esri")&&O.setObject("dijit.editing.tools.EditingTools",K,I);return K})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(O,J,K,I,v,e,d,a,w,t){O=O([d,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var g,l=this._tools;for(g in l)l.hasOwnProperty(g)&&t.isDefined(l[g])&&l[g].destroy();this.inherited(arguments)},_createTools:function(){var g,l=new e;this.dropDown=l;for(g in this._tools)this._tools.hasOwnProperty(g)&&l.addChild(this._tools[g]);
this._activeTool=l.getChildren()[0];this._updateUI()},activate:function(g){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(g){for(var l in this._tools)this._tools.hasOwnProperty(l)&&this._tools[l].enable(g);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(g){this._checked=g;this._updateUI()},_onDrawEnd:function(g){},
onLayerChange:function(g,l,A){this._activeTool=null;this._activeType=l;this._activeTemplate=A;this._activeLayer=g},onItemClicked:function(g,l){this._activeTool&&this._activeTool.deactivate();this._activeTool=v.byId(g);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(g){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
I.set(this.focusNode,{outline:"none"});I.set(this.titleNode,{padding:"0px",border:"none"});this._checked?I.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):I.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});K("extend-esri")&&J.setObject("dijit.editing.tools.DropDownToolBase",O,w);return O})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A){O=O([l],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=I.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);I.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(h){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var p=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(p,h,this._selectMethod,J.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new d(d.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new v([0,0,0]),1),new v([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new v([0,200,255]),2);this._polygonSelectionSymbol=new w(w.STYLE_SOLID,new a(a.STYLE_SOLID,
new v([0,0,0]),1),new v([0,200,255,.5]))},_initializeLayers:function(){K.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(h){var p=null;switch(h.geometryType){case "esriGeometryPoint":p=this._pointSelectionSymbol;break;case "esriGeometryPolyline":p=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":p=this._polygonSelectionSymbol}h.setSelectionSymbol(h._selectionSymbol||p)},_createTools:function(){K.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(h){var p=J.mixin(g[h],{settings:this._settings,onClick:J.hitch(this,"onItemClicked",g[h].id)});this._tools[h.toUpperCase()]=new t(p)}});e("extend-esri")&&J.setObject("dijit.editing.tools.Selection",O,A);return O})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(O,J,K,I,v){K={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:I.EXTENT,_selectMethod:K.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:I.EXTENT,_selectMethod:K.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:I.EXTENT,_selectMethod:K.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};J("extend-esri")&&O.setObject("dijit.editing.tools.SelectionTools",K,v);return K})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l){O=O(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(A){this._settings=A||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var A in this._sConnects)this._sConnects.hasOwnProperty(A)&&K.disconnect(this._sConnects[A])},selectFeatures:function(A,h,p,k){p===t.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(A));var n=[];I.forEach(A,function(m){if(!0===m.visible&&!0===m._isMapAtVisibleScale()){var C=p;m._isSelOnly&&C===t.SELECTION_NEW&&(C=t.SELECTION_ADD);n.push(m.selectFeatures(h,C))}});(new e(n)).addCallback(J.hitch(this,function(m){var C=[];I.forEach(m,function(B,y){I.forEach(B[1],function(G){(G=A[y]._mode._getFeature(G.attributes[A[y].objectIdField])||null)&&C.push(G)},this)},this);this._mapServiceCount?((m=p===t.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(A))):
this._createLayerDefs(this._getLayerInfosFromFeatures(C)),this._updateLayerDefs(this._mapServiceInfos,!1,!(C&&C.length||m),J.hitch(this,k,C))):k(C)}))},selectFeaturesByGeometry:function(A,h,p,k){var n=h;-1!==h.declaredClass.indexOf("Extent")&&h.xmax===h.xmin&&h.ymax===h.ymin&&(n=new a(h.xmax,h.ymax,h.spatialReference));n=-1!==n.declaredClass.indexOf("Point")?this._extentFromPoint(n):n;h=new g;h.geometry=n;this.selectFeatures(A,h,p,k)},clearSelection:function(A){I.forEach(this._nonSelOnlyLayers,function(p){p.clearSelection&&
p.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var h=this._getLayerInfosFromSelection(this._settings.layers);I.some(h,function(p){return p.oids&&p.oids.length})&&(this._createLayerDefs(h),this._updateLayerDefs(this._mapServiceInfos,!0,A||!1))}},findMapService:function(A){var h=this._map,p=h.layerIds;A=A&&A._url&&A._url.path?A._url.path.toLowerCase():"";var k;for(k in p)if(p.hasOwnProperty(k)){var n=h.getLayer(p[k]);var m=n._url?n._url.path?n._url.path.toLowerCase().replace("mapserver",
"featureserver"):n._url.toLowerCase().replace("mapserver","featureserver"):"";if(A.substr(0,m.length)===m&&"esri.layers.ArcGISDynamicMapServiceLayer"===n.declaredClass)return n}},getSelection:function(A){var h=[];I.forEach(A,function(p){p._isSelOnly&&h.push(this._createLayerInfo(p))},this);I.forEach(h,function(p){var k=this._createMapServiceInfo(this.findMapService(p.layer));k&&(k.layerInfos[p.layer.layerId]=p)},this)},_initMapServiceInfos:function(A){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];I.forEach(A,function(h){var p=this.findMapService(h);p?(this._mapServiceCount++,this._createMapServiceInfo(p),p&&p.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(h)},this)},_createMapServiceInfo:function(A){if(!A)return null;var h=this._mapServiceInfos,p=h[A.id];p||(p=h[A.id]={mapService:A,layerInfos:[],layerDefs:J.mixin([],A.layerDefinitions||[]),origLayerDefs:J.mixin([],A.layerDefinitions||[])});return p},_resetMapServiceInfo:function(A){I.forEach(A.layerInfos,this._resetLayerInfo);
A.layerDefs=J.mixin([],A.origLayerDefs||[])},_resetMapServiceInfos:function(){var A=this._mapServiceInfos,h;for(h in A)A.hasOwnProperty(h)&&this._resetMapServiceInfo(A[h])},_createLayerInfo:function(A,h){var p=A.objectIdField;h=h?[]:A.getSelectedFeatures();return{layer:A,selectedFeatures:h||[],oids:I.map(h,function(k){return k.attributes[p]})}},_resetLayerInfo:function(A){A&&(A.selectedFeatures=[],A.oids=[])},_updateLayerDefs:function(A,h,p,k){for(var n in A)if(A.hasOwnProperty(n)){var m=A[n],C=m.mapService,
B=m.layerDefs=h?J.mixin([],m.origLayerDefs||[]):m.layerDefs;B?(p?k&&k():this._sConnects[C.id]=K.connect(C,"onUpdateEnd",J.hitch(this,"_onMapServiceUpdate",m,h,k)),C.setLayerDefinitions(B,p||!1)):k&&k()}},_onMapServiceUpdate:function(A,h,p){K.disconnect(this._sConnects[A.mapService.id]);I.forEach(A.layerInfos,function(k){if(h)k&&k.layer.clearSelection();else{var n=new g;n.objectIds=k?k.oids:[];n.objectIds.length&&k.layer.selectFeatures(n,t.SELECTION_SUBTRACT)}},this);h&&this._resetMapServiceInfo(A);
p&&p()},_createLayerDefs:function(A){I.forEach(A,function(h){var p=h.layer,k=this._createMapServiceInfo(this.findMapService(h.layer));if(k){k=k.layerDefs;var n=p.layerId,m='("'+p.objectIdField+'" NOT IN (',C=h.oids;C&&C.length&&(I.forEach(h.oids,function(B,y){C=!0;y&&(m+=",");m+="'"+B+"'"}),m+="))",k[n]=k.length&&k[n]&&k[n].length?k[n]+(" AND"+m):m)}},this)},_getLayerInfosFromFeatures:function(A){var h=[];I.forEach(A,function(k){var n=k.getLayer();n&&n._isSelOnly&&(h[n.id]||(h[n.id]=this._createLayerInfo(n,
!0)),h[n.id].selectedFeatures.push(k),h[n.id].oids.push(k.attributes[n.objectIdField]))},this);A=[];for(var p in h)h.hasOwnProperty(p)&&A.push(h[p]);return A},_getLayerInfosFromSelection:function(A){var h=[];I.forEach(A,function(p){p._isSelOnly&&h.push(this._createLayerInfo(p,!1))},this);return h},_extentFromPoint:function(A){var h=this._tolerance,p=this._map,k=p.toScreen(A);A=new w(k.x-h,k.y+h);h=new w(k.x+h,k.y-h);A=p.toMap(A);h=p.toMap(h);return new d(A.x,A.y,h.x,h.y,p.spatialReference)}});v("extend-esri")&&
J.setObject("dijit.editing.SelectionHelper",O,l);return O})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R,N,r){var E=O([R,p,k],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:r,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(q,u){q=q||{};q.items||q.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=d.version.minor;this._itemWidgets={};q.featureLayers&&q.featureLayers.length&&(this._flChanged=1);this._nls=N.widgets.templatePicker;this.emptyMessage=q.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var q=
A.getContentBox(this.domNode);q.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!q.h||1>=q.h)this.domNode.style.height=this._initialAutoHeight+"px";q=A.getContentBox(this.domNode);this._columns=Math.floor(q.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();K.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>a("ie")&&(this._repaintItems=J.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var q=this._selectedCell,u=this._selectedInfo;q&&this._rowClicked({cellNode:q,rowIndex:u.selRow,cellIndex:u.selCol})},update:function(q){q=
"auto"===this.rows&&"auto"===this.columns&&q?!0:!1;var u=this.grid;if(q){var x=this.domNode;var H=d.query("#"+x.id+".templatePicker div.item")[0];x=A.getContentBox(x);H=(H=H&&H.parentNode)?I.coords(H).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((x.w-u.views.views[0].getScrollbarWidth())/H))||1}H=this._rows;this._preprocess();var L=this._rows;this._setGridLayout();this._setGridData();L!==H&&u.set("autoHeight",this._rows,!1);q?(u._resize({w:x.w,h:x.h}),u.viewsHeaderNode.style.display=
"none"):u.update();this._toggleTooltip();var Q=this,T=this.getSelected();T&&u.store.fetch({onComplete:function(M){var P=(M=Q._locate(T,Q._selectedInfo,M))&&u.views.views[0].getCellNode(M[0],M[1]);P&&Q._rowClicked({cellNode:P,rowIndex:M[0],cellIndex:M[1]},!0)}});9>a("ie")&&setTimeout(this._repaintItems,this._ieTimer);q=this.featureLayers;x=this.items;q&&q.length||x&&x.length||!u||!this.emptyMessage||u.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(q){var u=this.useLegend;this._started&&u===q||(q?this._flChanged=1:this._clearLegendInfo());this.useLegend=q},_setFeatureLayersAttr:function(q){var u=this.featureLayers;this._started&&u===q||(this._flChanged=1);this.featureLayers=q},_adjustRowsCols:function(q){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var u=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(u=q.length,v.forEach(q,function(x){u+=Math.ceil(x.length/this.columns)},this)):(v.forEach(q,function(x){u+=x.length},this),u=Math.ceil(u/this.columns)):u=Math.ceil(q.length/this.columns),this._rows=u):"auto"===this.columns&&(this.featureLayers?this.grouping?u=3:(v.forEach(q,function(x){u+=x.length},this),u=Math.ceil(u/this.rows)):u=Math.ceil(q.length/this.rows),this._columns=u)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),v.every(this.featureLayers,function(x){return x.loaded})){this.featureLayers=v.filter(this.featureLayers,function(x){return!(x.hasZ&&!x.enableZDefaults)});var q=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(q)}else{var u=this.featureLayers.length;v.forEach(this.featureLayers,function(x){if(x.loaded)u--;else var H=K.connect(x,"onLoad",this,function(){K.disconnect(H);H=null;u--;u||this.update()})},this)}else q=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(q)},_processSelectionLayers:function(){var q,u,x,H,L,Q,T,M={};v.forEach(this.featureLayers,function(P,V){P.mode===B.MODE_SELECTION&&P._map&&P.url&&P._params.drawMode&&!P.source&&(u=J.trim(P._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),x=M[u]=M[u]||{},H=x.featureLayers=x.featureLayers||{},Q=x.indices=x.indices||[],H[V]=P,Q.push(V),q=P._map)});q&&v.forEach(q.layerIds,function(P){(P=q.getLayer(P))&&P.url&&(P.getImageUrl||P.getTileUrl)&&P.loaded&&10.1<=P.version&&(u=J.trim(P._url.path).replace(/(\/MapServer).*/ig,"$1"),L=u.replace(/^https?:\/\//ig,"").toLowerCase(),M[L]&&!M[L].mapServiceUrl&&(x=M[L],x.mapServiceUrl=u,x.mapServiceLayer=P,this._legendIndices=this._legendIndices.concat(x.indices),
T=this._fetchLegend({pickerInstance:this,info:x},L),T.then?(this._loadingIndices=this._loadingIndices.concat(x.indices),this._loadingLegends.push(T)):this._processLegendResponse(T,x)))},this)},_fetchLegend:function(q,u){var x=E.prototype,H=x.legendCache[u];H?H.then&&H._contexts.push(q):(H=x.legendCache[u]=F({url:q.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),H._contexts=[q],H.addBoth(function(L){if(!H.canceled){x.legendCache[u]=L;var Q=H._contexts;H._contexts=null;
v.forEach(Q,function(T){var M=T.pickerInstance;T=T.info;if(!M._destroyed){v.forEach(T.indices,function(V){P=v.indexOf(M._loadingIndices,V);-1<P&&M._loadingIndices.splice(P,1)});var P=v.indexOf(M._loadingLegends,H);-1<P&&M._loadingLegends.splice(P,1);M._processLegendResponse(L,T)}})}}));return H},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
v.forEach(this._loadingLegends,function(q){var u=-1;v.some(q._contexts,function(x,H){x.pickerInstance===this&&(u=H);return-1<u},this);-1<u&&q._contexts.splice(u,1)},this)},_processLegendResponse:function(q,u){if(!q||q instanceof Error){var x;v.forEach(u.indices,function(L){x=v.indexOf(this._legendIndices,L);-1<x&&this._legendIndices.splice(x,1)},this)}else v.forEach(u.indices,function(L){var Q=u.featureLayers[L].layerId,T,M=u.mapServiceUrl+"/"+Q+"/images/",P=u.mapServiceLayer._getToken(),V,X;if(!this._legendSymbols[L]){var S=
null;v.some(q.layers,function(W){W.layerId==Q&&(S=W);return!!S});if(S){var U=this._legendSymbols[L]={};v.forEach(S.legend,function(W){if((V=W.values)&&V.length)for(T=0;T<V.length;T++)U[V[T]]=W;else U.defaultSymbol=W;(X=W.url)&&!W._fixed&&(W._fixed=1,-1===X.search(/https?:/)&&(W.url=M+X),P&&-1!==W.url.search(/https?:/)&&(W.url+=(-1<W.url.indexOf("?")?"\x26":"?")+"token\x3d"+P))})}}},this);var H=this;H._started&&!H._legendTimer&&(H._legendTimer=setTimeout(function(){clearTimeout(H._legendTimer);H._legendTimer=
null;H._destroyed||H.update()},0))},_applyGridPatches:function(){var q=this.grid,u=q.adaptWidth,x,H,L;q.adaptWidth=function(){x=this.views.views;for(H=0;L=x[H];H++)h.set(L.headerNode,"display","block");u.apply(this,arguments);for(H=0;L=x[H];H++)h.set(L.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var Q=K.connect(q,"_onFetchComplete",this,function(){K.disconnect(Q);this.grid.set("autoHeight",this._rows)});K.connect(q,"_onDelete",this,this._destroyItems);
K.connect(q,"_clearData",this,this._destroyItems);K.connect(q,"destroy",this,this._destroyItems);(q=q.focus)&&q.findAndFocusGridCell&&(q.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var q=function(Q){return function(T,M){return this._cellGet(Q,T,M)}},u=J.hitch(this,this._cellFormatter),x=[],H=this._columns,L;for(L=0;L<H;L++)x.push({field:"cell"+L,get:J.hitch(this,q(L)),formatter:u});q={cells:[x]};this.grouping&&(H={field:"groupName",colSpan:H,get:J.hitch(this,this._cellGetGroup),
formatter:J.hitch(this,this._cellGroupFormatter)},q.cells.push([H]));H=this.grid;u=m.prototype.rowsPerPage;H.set("rowsPerPage",this._rows>u?this._rows:u);H.set("structure",q)},_setGridData:function(){var q=[];if(this.grouping){this._groupRowIndices=[];var u,x,H=this._columns;v.forEach(this._flItems,function(Q,T){q.push({});T=0===T?0:u+x+1;this._groupRowIndices.push(T);u=T;x=Math.ceil(Q.length/H);q=q.concat(this._getStoreItems(Q))},this)}else this.featureLayers?(v.forEach(this._flItems,function(Q){q=
q.concat(Q)}),q=this._getStoreItems(q)):q=this._getStoreItems(this._itItems);var L=new n({data:{items:q}});this.grid.setStore(L)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=l.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var q=this.grid;this._mouseOverConnect=K.connect(q,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=K.connect(q,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&
(K.disconnect(this._mouseOverConnect),K.disconnect(this._mouseOutConnect),l.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(q,u){var x=q.cellNode,H=q.rowIndex;q=q.cellIndex;var L=this._getCellInfo(x,H,q);if(L){var Q=this.grid.store;if(!Q.getValue(L,"loadingCell")&&(this._selectedCell&&g.remove(this._selectedCell,"selectedItem"),x!==this._selectedCell?(g.add(x,"selectedItem"),this._selectedCell=x,this._selectedItem={featureLayer:Q.getValue(L,"layer"),type:Q.getValue(L,"type"),template:Q.getValue(L,
"template"),symbolInfo:Q.getValue(L,"symbolInfo"),item:this._getItem(L)},this._selectedInfo={selRow:H,selCol:q,index1:Q.getValue(L,"index1"),index2:Q.getValue(L,"index2"),index:Q.getValue(L,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!u))this.onSelectionChange()}},_locate:function(q,u,x){var H=this.grid.store,L=Array(this._columns),Q,T=u.index1,M=u.index2,P=u.index,V=q.item;v.some(x,function(X,S){return v.some(L,function(U,W){return(U=H.getValue(X,"cell"+W))&&(V?P===H.getValue(U,
"index"):T===H.getValue(U,"index1")&&M===H.getValue(U,"index2"))?(Q=[S,W],!0):!1})});return Q},_getCellInfo:function(q,u,x){if(q)return q=this.grid,u=q.getItem(u),q.store.getValue(u,"cell"+x)},_getItem:function(q){var u=this.items;if(u)return u[this.grid.store.getValue(q,"index")]},_cellMouseOver:function(q){var u=this.tooltip,x=q.cellNode,H=this._getCellInfo(x,q.rowIndex,q.cellIndex);if(u&&H){var L=this.grid.store;q=L.getValue(H,"template");var Q=L.getValue(H,"type"),T=L.getValue(H,"symbolInfo");
L=L.getValue(H,"layer");q=(H=this._getItem(H))&&H.label+(H.description?": "+H.description:"")||q&&q.name+(q.description?": "+q.description:"")||Q&&Q.name||T&&T.label+(T.description?": "+T.description:"")||(L&&L.name+": ")+"Default";u.style.display="none";u.innerHTML=q;x=I.coords(x.firstChild);h.set(u,{left:x.x+"px",top:x.y+x.h+5+"px"});u.style.display=""}},_cellMouseOut:function(){var q=this.tooltip;q&&(q.style.display="none")},_destroyItems:function(){var q=this._itemWidgets,u;for(u in q)q[u]&&(q[u].destroy(),
delete q[u])},_repaintItems:function(){var q=this._itemWidgets,u;for(u in q){var x=q[u];x&&x._repaint(x._surface)}},_getStoreItems:function(q){var u=this._uniqueId;q=v.map(q,function(X){return J.mixin({surfaceId:"tpick-surface-"+u.id++},X)});for(var x=q.length,H=0,L={},Q=0,T,M=[],P=!0,V=this._columns;H<x;)P=!0,T="cell"+Q,L[T]=q[H],H++,Q++,0===Q%V&&(P=!1,M.push(L),L={},Q=0);P&&x&&M.push(L);return M},_getItemsFromLayers:function(q){var u=[];v.forEach(q,function(x,H){u.push(this._getItemsFromLayer(x,
H))},this);return u},_getItemsFromLayer:function(q,u){var x=[];if(this.useLegend&&-1<v.indexOf(this._loadingIndices,u))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:q,type:null,template:null,index1:u,index2:0,loadingCell:1}];var H=[];H=H.concat(q.templates);v.forEach(q.types,function(M){var P=M.templates;v.forEach(P,function(V){V._type_=M});H=H.concat(P)});H=v.filter(H,D.isDefined);var L=q.renderer;if(L){var Q=L.declaredClass.replace("esri.renderer.","");if(0<H.length)v.forEach(H,
function(M){var P=M.prototype;if(P){var V;if(V=this._isUnclassedRenderer(L)?L.infos[0].symbol:L.valueExpression?this._createSimpleSymbol(q):L.getSymbol(P)||this._createSimpleSymbol(q)){var X=null,S;if(!(9>t("ie"))&&M.thumbnail&&M.thumbnail.imageData)X=new G(M.thumbnail);else if(this.useLegend&&-1<v.indexOf(this._legendIndices,u)){if(S=this._legendSymbols&&this._legendSymbols[u])switch(Q){case "SimpleRenderer":X=S.defaultSymbol;break;case "UniqueValueRenderer":v.some(L.infos,function(U){U.symbol===
V&&(X=S[U.value]);return!!X});break;case "ClassBreaksRenderer":v.some(L.infos,function(U){U.symbol===V&&(X=S[U.maxValue]);return!!X})}X&&(P=e.fromJson(e.toJson(G.defaultProps)),P.url=X.url,P.imageData=X.imageData,P.contentType=X.contentType,P.width=X.width,P.height=X.height,D.isDefined(P.width)&&D.isDefined(P.height)||(P.width=15,P.height=15),X=new G(P))}x.push({label:this._trimLabel(M.name),symbol:X||V,legendOverride:!!X,layer:q,type:M._type_,template:M,index1:u,index2:x.length})}else switch(Q){case "HeatmapRenderer":x.push({label:this._trimLabel(M.name),
symbol:new y,legendOverride:!!X,layer:q,type:M._type_,template:M,index1:u,index2:x.length})}}delete M._type_},this);else{var T=[];"TemporalRenderer"===Q&&(L=L.observationRenderer)&&(Q=L.declaredClass.replace("esri.renderer.",""));switch(Q){case "SimpleRenderer":T=[{symbol:L.symbol,label:L.label,description:L.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":T=L.infos}x=v.map(T,function(M,P){return{label:this._trimLabel(M.label),description:M.description,symbolInfo:J.mixin({constructor:function(){}},
M),symbol:M.symbol,layer:q,index1:u,index2:P}},this)}}return x},_isUnclassedRenderer:function(q){return!!((q.hasVisualVariables("sizeInfo",!1)||q.hasVisualVariables("colorInfo",!1)||q.hasVisualVariables("opacityInfo",!1))&&q.addBreak&&q.infos&&1===q.infos.length)},_createSimpleSymbol:function(q){switch(q.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var u=new y;break;case "esriGeometryPolyline":u=new b;break;case "esriGeometryPolygon":u=new f;break;default:q.hasXYFootprint&&
q.hasXYFootprint()&&(u=new f)}return u},_getItemsFromItems:function(q){return v.map(q,function(u,x){u=J.mixin({index:x},u);u.label=this._trimLabel(u.label);return u},this)},_trimLabel:function(q){var u=this.maxLabelLength;u&&q&&q.length>u&&(q=q.substr(0,u)+"...");return q||""},_cellGet:function(q,u,x){return x?this.grid.store.getValue(x,"cell"+q):""},_cellFormatter:function(q){if(q){var u=this._itemWidgets,x=this.grid.store,H=x.getValue(q,"surfaceId"),L=u[H];L||(L=u[H]=new z({id:H,label:x.getValue(q,
"label"),symbol:x.getValue(q,"symbol"),legendOverride:x.getValue(q,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:x.getValue(q,"template")}));return L||""}return""},_cellGetGroup:function(q,u){if(!this._groupRowIndices)return"";q=v.indexOf(this._groupRowIndices,q);return u&&-1!==q?(u=this.featureLayers[q])&&(this.groupLabelFunction?this.groupLabelFunction(u):u.name)||"":""},_cellGroupFormatter:function(q){return q?"\x3cdiv class\x3d'groupLabel'\x3e"+q+"\x3c/div\x3e":
""}});a("extend-esri")&&J.setObject("dijit.editing.TemplatePicker",E,c);return E})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(O,J,K,I,v,e,d,a,w){var t=e("dojox.grid.DataGrid",d,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,
_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new a(this)},get:function(g,l){if(l&&"_item"==this.field&&
!this.fields)return l;if(l&&this.fields){var A=[],h=this.grid.store;J.forEach(this.fields,function(p){A=A.concat(h.getValues(l,p))});return A}return l||"string"!==typeof g?l?this.field?"_item"==this.field?l:this.grid.store.getValue(l,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var g=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,g=!0);this.updating||(this.beginUpdate(),g=!0);if(g){var l=
this;this._endUpdateDelay=setTimeout(function(){delete l._endUpdateDelay;l.endUpdate()},this.updateDelay)}}},_onSet:function(g,l,A,h){this._checkUpdateStatus();g=this.getItemIndex(g);-1<g&&this.updateRow(g)},_createItem:function(g,l){l=this._hasIdentity?this.store.getIdentity(g):I.toJson(this.query)+":idx:"+l+":sort:"+I.toJson(this.getSortProps());return this._by_idty[l]={idty:l,item:g}},_addItem:function(g,l,A){this._by_idx[l]=this._createItem(g,l);A||this.updateRow(l)},_onNew:function(g,l){this._checkUpdateStatus();
l=this.get("rowCount");this._addingItem=!0;this.updateRowCount(l+1);this._addingItem=!1;this._addItem(g,l);this.showMessage()},_onDelete:function(g){this._checkUpdateStatus();g=this._getItemIndex(g,!0);if(0<=g){this._pages=[];this._eop=this._bop=-1;var l=this._by_idx[g];this._by_idx.splice(g,1);delete this._by_idty[l.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(g)&&(this.selection.deselect(g),this.selection.selected.splice(g,
1))},_onRevert:function(){this._refresh()},setStore:function(g,l,A){this._requestsPending(0)||(this._setQuery(l,A),this._setStore(g),this._refresh(!0))},setQuery:function(g,l){this._requestsPending(0)||(this._setQuery(g,l),this._refresh(!0))},setItems:function(g){this.items=g;this._setStore(this.store);this._refresh(!0)},_setQuery:function(g,l){this.query=g;this.queryOptions=l||this.queryOptions},_setStore:function(g){this.store&&this._store_connects&&J.forEach(this._store_connects,this.disconnect,
this);if(this.store=g){g=this.store.getFeatures();var l=[];this._canEdit=!!g["dojo.data.api.Write"]&&!!g["dojo.data.api.Identity"];this._hasIdentity=!!g["dojo.data.api.Identity"];g["dojo.data.api.Notification"]&&!this.items&&(l.push(this.connect(this.store,"onSet","_onSet")),l.push(this.connect(this.store,"onNew","_onNew")),l.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&l.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=l}},_onFetchBegin:function(g,
l){this.scroller&&(this.rowCount!=g&&(l.isRender?(this.scroller.init(g,this.keepRows,this.rowsPerPage),this.rowCount=g,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(g)),g?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(g,l){this.scroller&&(g&&0<g.length&&(J.forEach(g,function(A,h){this._addItem(A,l.start+h,!0)},
this),this.updateRows(l.start,g.length),l.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),v("ie")&&w.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[l.start]=!1)},_onFetchError:function(g,l){console.log(g);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[l.start]=
!1;this.onFetchError(g,l)},onFetchError:function(g,l){},_fetch:function(g,l){g=g||0;if(this.store&&!this._pending_requests[g]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[g]=!0;try{if(this.items){var A=this.items,h=this.store;this.rowsPerPage=A.length;var p={start:g,count:this.rowsPerPage,isRender:l};this._onFetchBegin(A.length,p);var k=0;J.forEach(A,function(m){h.isItemLoaded(m)||k++});if(0===k)this._onFetchComplete(A,p);else{var n=
function(m){k--;0===k&&this._onFetchComplete(A,p)};J.forEach(A,function(m){h.isItemLoaded(m)||h.loadItem({item:m,onItem:n,scope:this})},this)}}else this.store.fetch({start:g,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:l,onBegin:K.hitch(this,"_onFetchBegin"),onComplete:K.hitch(this,"_onFetchComplete"),onError:K.hitch(this,"_onFetchError")})}catch(m){this._onFetchError(m,{start:g,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(g){var l=this._by_idx[g];return!l||l&&!l.item?(this._preparePage(g),null):l.item},getItemIndex:function(g){return this._getItemIndex(g,!1)},_getItemIndex:function(g,l){if(!l&&!this.store.isItem(g))return-1;l=this._hasIdentity?this.store.getIdentity(g):null;for(var A=0,h=this._by_idx.length;A<h;A++){var p=this._by_idx[A];if(p&&(l&&p.idty==l||p.item===g))return A}return-1},filter:function(g,
l){this.query=g;l&&this._clearData();this._fetch()},_getItemAttr:function(g,l){return(g=this.getItem(g))?this.store.getValue(g,l):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(g){return this._pending_requests[g]},_rowToPage:function(g){return this.rowsPerPage?Math.floor(g/this.rowsPerPage):g},_pageToRow:function(g){return this.rowsPerPage?this.rowsPerPage*
g:g},_preparePage:function(g){(g<this._bop||g>=this._eop)&&!this._addingItem&&(g=this._rowToPage(g),this._needPage(g),this._bop=g*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(g){this._pages[g]||(this._pages[g]=!0,this._requestPage(g))},_requestPage:function(g){g=this._pageToRow(g);0<Math.min(this.rowsPerPage,this.get("rowCount")-g)&&(this._requests++,this._requestsPending(g)||setTimeout(K.hitch(this,"_fetch",g,!1),1))},getCellName:function(g){return g.field},
_refresh:function(g){this._clearData();this._fetch(0,g)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var g=this.getCell(this.getSortIndex());if(g){var l=g.sortDesc,A=!(0<this.sortInfo);return[{attribute:g.field,descending:"undefined"==typeof l?A:A?!l:l}]}return this.sortFields?this.sortFields:null},styleRowState:function(g){if(this.store&&this.store.getState){for(var l=this.store.getState(g.index),
A="",h=0,p=["inflight","error","inserting"],k;k=p[h];h++)if(l[k]){A=" dojoxGridRow-"+k;break}g.customClasses+=A}},onStyleRow:function(g){this.styleRowState(g);this.inherited(arguments)},canEdit:function(g,l){return this._canEdit},_copyAttr:function(g,l){g=this.getItem(g);return this.store.getValue(g,l)},doStartEdit:function(g,l){this._cache[l]||(this._cache[l]=this._copyAttr(l,g.field));this.onStartEdit(g,l)},doApplyCellEdit:function(g,l,A){this.store.fetchItemByIdentity({identity:this._by_idx[l].idty,
onItem:K.hitch(this,function(h){var p=this.store.getValue(h,A);"number"==typeof p?g=isNaN(g)?g:parseFloat(g):"boolean"==typeof p?g="true"==g?!0:"false"==g?!1:g:p instanceof Date&&(p=new Date(g),g=isNaN(p.getTime())?g:p);this.store.setValue(h,A,g);this.onApplyCellEdit(g,l,A)})})},doCancelEdit:function(g){this._cache[g]&&(this.updateRow(g),delete this._cache[g]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(g,l){this.onApplyEdit(g)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var g=K.hitch(this,function(l){l.length&&(J.forEach(l,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:g}):g(this.selection.getSelected())}}});t.cell_markupFactory=function(g,l,A){var h=K.trim(w.attr(l,"field")||"");h&&(A.field=h);A.field=A.field||A.name;if(h=K.trim(w.attr(l,"fields")||""))A.fields=h.split(",");g&&g(l,A)};t.markupFactory=function(g,l,A,h){return d.markupFactory(g,l,A,K.partial(t.cell_markupFactory,
h))};return t})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(O,J,
K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z){O.isCopyKey||(O.isCopyKey=O.dnd.getCopyKeyState);K=K("dojox.grid._Grid",[p,k,I],{templateString:m,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:e,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");f.initOnFontResize();this.connect(f,"onFontResize","textSizeChanged");h.funnelEvents(this.domNode,this,"doKeyEvent",h.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");b.addClass(this.domNode,this.classTag);this.isLeftToRight()||b.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&b.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var c=O.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=C.substitute(this.loadingMessage,c);this.errorMessage=C.substitute(this.errorMessage,c);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&b.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(B.forEach(this._placeholders,function(c){c.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(c,D){"string"==typeof c&&(c=c&&"false"!=c?"true"==c?!0:window.parseInt(c,10):!1);"number"==typeof c&&(isNaN(c)&&(c=!1),0>c?c=!0:0===c&&(c=!1));this.autoHeight=c;this._autoHeight="boolean"==typeof c?c:"number"==typeof c?c>=this.get("rowCount"):!1;this._started&&!D&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new w(this);this.focus=new t(this);this.edit=new g(this)},createSelection:function(){this.selection=new l(this)},createScroller:function(){this.scroller=new v;this.scroller.grid=this;this.scroller.renderRow=y.hitch(this,"renderRow");this.scroller.removeRow=
y.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(c){},createViews:function(){this.views=new a(this);this.views.createView=y.hitch(this,"createView")},createView:function(c,D){c=new (y.getObject(c))({grid:this,index:D});this.viewsNode.appendChild(c.domNode);this.viewsHeaderNode.appendChild(c.headerNode);this.views.addView(c);b.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return c},buildViews:function(){for(var c=0,D;D=this.layout.structure[c];c++)this.createView(D.type||J._scopeName+".grid._View",c).setStructure(D);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(c){c&&y.isString(c)&&(O.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),c=y.getObject(c));this.structure=c;if(!c)if(this.layout.structure)c=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;c!==this.layout.structure&&this.layout.setStructure(c);this._structureChanged()},setStructure:function(c){O.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(c)},getColumnTogglingItems:function(){var c=[];var D=B.map(this.layout.cells,function(F){F.menuItems||(F.menuItems=[]);var R=this,N=new n({label:F.name,checked:!F.hidden,_gridCell:F,onChange:function(r){if(R.layout.setColumnVisibility(this._gridCell.index,
r)){var E=this._gridCell.menuItems;1<E.length&&B.forEach(E,function(q){q!==this&&q.setAttribute("checked",r)},this);r=B.filter(R.layout.cells,function(q){1<q.menuItems.length?B.forEach(q.menuItems,"item.set('disabled', false);"):q.menuItems[0].set("disabled",!1);return!q.hidden});1==r.length&&B.forEach(r[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var r=B.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(r,1);delete this._gridCell;n.prototype.destroy.apply(this,
arguments)}});F.menuItems.push(N);F.hidden||c.push(N);return N},this);1==c.length&&c[0].set("disabled",!0);return D},_setHeaderMenuAttr:function(c){this._placeholders&&this._placeholders.length&&(B.forEach(this._placeholders,function(D){D.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=c)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(c){O.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(c)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&B.forEach(this._placeholders,function(c){c._replaced&&c.unReplace(!0);c.replace(this.getColumnTogglingItems())},this)},_fetch:function(c){this.setScrollTop(0)},getItem:function(c){return null},showMessage:function(c){c?(this.messagesNode.innerHTML=c,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(c,D){this._pendingChangeSize=c;this._pendingResultSize=D;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||b._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var c=this.viewsHeaderNode.style,D="none"==c.display?
0:this.views.measureHeader();c.height=D+"px";this.views.normalizeHeaderNodeHeight();return D},_resize:function(c,D){c=c||this._pendingChangeSize;D=D||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var F=this.domNode.parentNode;if(F&&1==F.nodeType&&this.hasLayout()&&"hidden"!=F.style.visibility&&"none"!=F.style.display){var R=this._getPadBorder(),N=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var r=
N=this._getHeaderHeight();r+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=r+"px"}else this.domNode.clientHeight<=R.h&&(F==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");D&&(c=D);!this._autoHeight&&c?(b.marginBox(this.domNode,c),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(r=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
b._getContentBox(F).h,this.domNode.style.height=Math.max(0,r)+"px");c=B.some(this.views.views,function(E){return E.flexCells});this._autoHeight||0!==(r||b._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",c||void 0!==N||(N=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";c&&(N=void 0);this.adaptWidth();this.adaptHeight(N);this.postresize()}}},adaptWidth:function(){var c=!this.initialWidth&&this.autoWidth,D=c?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;D=this.views.arrange(1,D);this.views.onEach("adaptWidth");c&&(this.domNode.style.width=D+"px")},adaptHeight:function(c){c=void 0===c?this._getHeaderHeight():c;var D=this._autoHeight?-1:Math.max(this.domNode.clientHeight-c,0)||0;this.views.onEach("setSize",[0,D]);this.views.onEach("adaptHeight");if(!this._autoHeight){var F=0,R=0,N=B.filter(this.views.views,function(r){(r=r.hasHScrollbar())?F++:R++;return!r});0<F&&0<R&&B.forEach(N,function(r){r.adaptHeight(!0)})}!0===this.autoHeight||
-1!=D||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=D:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-c,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();b.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var c=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=c}},renderRow:function(c,D){this.views.renderRow(c,
D,this._skipRowRenormalize)},rowRemoved:function(c){this.views.rowRemoved(c)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var c=this.invalidated,D;if(c.all)this.update();else if(void 0!=c.rowCount)this.updateRowCount(c.rowCount);else for(D in c)this.updateRow(Number(D));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(c){c=Number(c);this.updating?this.invalidated[c]=!0:(this.views.updateRow(c),this.scroller.rowHeightChanged(c))},updateRows:function(c,D){c=Number(c);D=Number(D);var F;if(this.updating)for(F=0;F<D;F++)this.invalidated[F+c]=!0;else{for(F=0;F<D;F++)this.views.updateRow(F+c,this._skipRowRenormalize);this.scroller.rowHeightChanged(c)}},updateRowCount:function(c){this.updating?
this.invalidated.rowCount=c:(this.rowCount=c,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(c),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(c){this.views.updateRowStyles(c)},getRowNode:function(c){if(!this.focus.focusView||this.focus.focusView instanceof A)for(var D=0,F;F=this.views.views[D];D++){if(!(F instanceof A))return F.rowNodes[c]}else return this.focus.focusView.rowNodes[c];return null},
rowHeightChanged:function(c){this.views.renormalizeRow(c);this.scroller.rowHeightChanged(c)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:G("ie")?100:50,scrollTo:function(c){if(this.fastScroll){var D=Math.abs(this.lastScrollTop-c);this.lastScrollTop=c;if(D>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=c;this.views.setScrollTop(c);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var F=this;this._pendingScroll=window.setTimeout(function(){delete F._pendingScroll;
F.finishScrollJob()},200)}else this.setScrollTop(c)}else this.setScrollTop(c)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(c){this.scroller.scroll(this.views.setScrollTop(c))},scrollToRow:function(c){this.setScrollTop(this.scroller.findScrollTop(c)+1)},styleRowNode:function(c,D){D&&this.rows.styleRowNode(c,D)},_mouseOut:function(c){this.rows.setOverRow(-2)},getCell:function(c){return this.layout.cells[c]},setCellWidth:function(c,D){this.getCell(c).unitWidth=
D},getCellName:function(c){return"Cell "+c.index},canSort:function(c){},sort:function(){},getSortAsc:function(c){c=void 0==c?this.sortInfo:c;return 0<c},getSortIndex:function(c){c=void 0==c?this.sortInfo:c;return Math.abs(c)-1},setSortIndex:function(c,D){var F=c+1;void 0!=D?F*=D?1:-1:this.getSortIndex()==c&&(F=-this.sortInfo);this.setSortInfo(F)},setSortInfo:function(c){this.canSort(c)&&(this.sortInfo=c,this.sort(),this.update())},doKeyEvent:function(c){c.dispatch="do"+c.type;this.onKeyEvent(c)},
_dispatch:function(c,D){return c in this?this[c](D):!1},dispatchKeyEvent:function(c){this._dispatch(c.dispatch,c)},dispatchContentEvent:function(c){this.edit.dispatchEvent(c)||c.sourceView.dispatchContentEvent(c)||this._dispatch(c.dispatch,c)},dispatchHeaderEvent:function(c){c.sourceView.dispatchHeaderEvent(c)||this._dispatch("doheader"+c.type,c)},dokeydown:function(c){this.onKeyDown(c)},doclick:function(c){if(c.cellNode)this.onCellClick(c);else this.onRowClick(c)},dodblclick:function(c){if(c.cellNode)this.onCellDblClick(c);
else this.onRowDblClick(c)},docontextmenu:function(c){if(c.cellNode)this.onCellContextMenu(c);else this.onRowContextMenu(c)},doheaderclick:function(c){if(c.cellNode)this.onHeaderCellClick(c);else this.onHeaderClick(c)},doheaderdblclick:function(c){if(c.cellNode)this.onHeaderCellDblClick(c);else this.onHeaderDblClick(c)},doheadercontextmenu:function(c){if(c.cellNode)this.onHeaderCellContextMenu(c);else this.onHeaderContextMenu(c)},doStartEdit:function(c,D){this.onStartEdit(c,D)},doApplyCellEdit:function(c,
D,F){this.onApplyCellEdit(c,D,F)},doCancelEdit:function(c){this.onCancelEdit(c)},doApplyEdit:function(c){this.onApplyEdit(c)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});K.markupFactory=function(c,D,F,R){var N=function(r){r=b.attr(r,"width")||"auto";"auto"!=r&&"em"!=r.slice(-2)&&"%"!=r.slice(-1)&&
(r=parseInt(r,10)+"px");return r};c.structure||"table"!=D.nodeName.toLowerCase()||(c.structure=z("\x3e colgroup",D).map(function(r){var E=b.attr(r,"span");E={noscroll:"true"==b.attr(r,"noscroll")?!0:!1,__span:E?parseInt(E,10):1,cells:[]};b.hasAttr(r,"width")&&(E.width=N(r));return E}),c.structure.length||c.structure.push({__span:Infinity,cells:[]}),z("thead \x3e tr",D).forEach(function(r,E){var q=0,u=0,x,H=null;z("\x3e th",r).map(function(L){H?q>=x+H.__span&&(u++,x+=H.__span,H=c.structure[u]):(x=
0,H=c.structure[0]);var Q={name:y.trim(b.attr(L,"name")||L.innerHTML),colSpan:parseInt(b.attr(L,"colspan")||1,10),type:y.trim(b.attr(L,"cellType")||""),id:y.trim(b.attr(L,"id")||"")};q+=Q.colSpan;var T=b.attr(L,"rowspan");T&&(Q.rowSpan=T);b.hasAttr(L,"width")&&(Q.width=N(L));b.hasAttr(L,"relWidth")&&(Q.relWidth=window.parseInt(b.attr(L,"relWidth"),10));b.hasAttr(L,"hidden")&&(Q.hidden="true"==b.attr(L,"hidden")||!0===b.attr(L,"hidden"));R&&R(L,Q);Q.type=Q.type?y.getObject(Q.type):J.grid.cells.Cell;
Q.type&&Q.type.markupFactory&&Q.type.markupFactory(L,Q);H.cells[E]||(H.cells[E]=[]);H.cells[E].push(Q)})}));return new F(c,D)};return K})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(O,J,K,I,v){return K("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(e){this.dispatchKeyEvent(e)},onContentEvent:function(e){this.dispatchContentEvent(e)},onHeaderEvent:function(e){this.dispatchHeaderEvent(e)},
onStyleRow:function(e){e.customClasses+=(e.odd?" dojoxGridRowOdd":"")+(e.selected?" dojoxGridRowSelected":"")+(e.over?" dojoxGridRowOver":"");this.focus.styleRow(e);this.edit.styleRow(e)},onKeyDown:function(e){if(!e.altKey&&!e.metaKey)switch(e.keyCode){case O.ESCAPE:this.edit.cancel();break;case O.ENTER:if(!this.edit.isEditing()){var d=this.focus.getHeaderIndex();if(0<=d){this.setSortIndex(d);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(e),e.shiftKey);I.stop(e)}e.shiftKey||
(d=this.edit.isEditing(),this.edit.apply(),d||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(e),this.onRowClick(e),I.stop(e));break;case O.SPACE:this.edit.isEditing()||(d=this.focus.getHeaderIndex(),0<=d?this.setSortIndex(d):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(e),e.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),I.stop(e)));
break;case O.TAB:this.focus[e.shiftKey?"previousKey":"nextKey"](e);break;case O.LEFT_ARROW:case O.RIGHT_ARROW:if(!this.edit.isEditing()){var a=e.keyCode;I.stop(e);d=this.focus.getHeaderIndex();0<=d&&e.shiftKey&&e.ctrlKey?this.focus.colSizeAdjust(e,d,5*(a==O.LEFT_ARROW?-1:1)):(e=a==O.LEFT_ARROW?1:-1,this.isLeftToRight()&&(e*=-1),this.focus.move(0,e))}break;case O.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(I.stop(e),this.focus.move(-1,0));break;case O.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(I.stop(e),this.focus.move(1,0));break;case O.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(I.stop(e),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case O.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(I.stop(e),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(e){-1==e.rowIndex?this.onHeaderCellMouseOver(e):this.onCellMouseOver(e)},onMouseOut:function(e){-1==e.rowIndex?this.onHeaderCellMouseOut(e):this.onCellMouseOut(e)},onMouseDown:function(e){-1==
e.rowIndex?this.onHeaderCellMouseDown(e):this.onCellMouseDown(e)},onMouseOverRow:function(e){this.rows.isOver(e.rowIndex)||(this.rows.setOverRow(e.rowIndex),-1==e.rowIndex?this.onHeaderMouseOver(e):this.onRowMouseOver(e))},onMouseOutRow:function(e){if(this.rows.isOver(-1))this.onHeaderMouseOut(e);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(e))},onMouseDownRow:function(e){if(-1!=e.rowIndex)this.onRowMouseDown(e)},onCellMouseOver:function(e){e.cellNode&&J.add(e.cellNode,
this.cellOverClass)},onCellMouseOut:function(e){e.cellNode&&J.remove(e.cellNode,this.cellOverClass)},onCellMouseDown:function(e){},onCellClick:function(e){this._click[0]=this._click[1];this._click[1]=e;this.edit.isEditCell(e.rowIndex,e.cellIndex)||this.focus.setFocusCell(e.cell,e.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(e)},onCellDblClick:function(e){var d=1<this._click.length&&v("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:e;this.focus.setFocusCell(d.cell,d.rowIndex);this.edit.setEditCell(d.cell,d.rowIndex);this.onRowDblClick(e)},onCellContextMenu:function(e){this.onRowContextMenu(e)},onCellFocus:function(e,d){this.edit.cellFocus(e,d)},onRowClick:function(e){this.edit.rowClick(e);this.selection.clickSelectEvent(e)},onRowDblClick:function(e){},onRowMouseOver:function(e){},onRowMouseOut:function(e){},onRowMouseDown:function(e){},onRowContextMenu:function(e){I.stop(e)},onHeaderMouseOver:function(e){},onHeaderMouseOut:function(e){},
onHeaderCellMouseOver:function(e){e.cellNode&&J.add(e.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(e){e.cellNode&&J.remove(e.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(e){},onHeaderClick:function(e){},onHeaderCellClick:function(e){this.setSortIndex(e.cell.index);this.onHeaderClick(e)},onHeaderDblClick:function(e){},onHeaderCellDblClick:function(e){this.onHeaderDblClick(e)},onHeaderCellContextMenu:function(e){this.onHeaderContextMenu(e)},onHeaderContextMenu:function(e){this.headerMenu||
I.stop(e)},onStartEdit:function(e,d){},onApplyCellEdit:function(e,d,a){},onCancelEdit:function(e){},onApplyEdit:function(e){},onCanSelect:function(e){return!0},onCanDeselect:function(e){return!0},onSelected:function(e){this.updateRowStyles(e)},onDeselected:function(e){this.updateRowStyles(e)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(O,J,K,I,v){var e=function(a){a&&dojo.forEach(O.toArray(),
function(w){w.domNode&&v.isDescendant(w.domNode,a,!0)&&w.destroy()})},d=function(a,w){for(var t=[],g=0,l;l=a.childNodes[g];){g++;var A=v.byId(l);(A&&A.tagName?A.tagName.toLowerCase():"")==w&&t.push(l)}return t};return J("dojox.grid._Scroller",null,{constructor:function(a){this.setContentNodes(a);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(a,w,t){switch(arguments.length){case 3:this.rowsPerPage=t;case 2:this.keepRows=w;case 1:this.rowCount=a}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=K.hitch(this,
"onscroll"))},_getPageCount:function(a,w){return a?Math.ceil(a/w)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(a){this.keepPages=(this.keepRows=a)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(a){this.colCount=(this.contentNodes=a)?this.contentNodes.length:0;this.pageNodes=[];for(a=0;a<this.colCount;a++)this.pageNodes[a]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(a){this.invalidateNodes();this.rowCount=a;a=this.pageCount;0===a&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<a)for(--a;a>=this.pageCount;a--)this.height-=this.getPageHeight(a),delete this.pageHeights[a];
else this.pageCount>a&&(this.height+=this.defaultPageHeight*(this.pageCount-a-1)+this.calcLastPageHeight());this.resize()},pageExists:function(a){return!!this.getDefaultPageNode(a)},measurePage:function(a){return this.grid.rowHeight?((a+1)*this.rowsPerPage>this.rowCount?this.rowCount-a*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(a=this.getDefaultPageNode(a))&&a.innerHTML?a.offsetHeight:void 0},positionPage:function(a,w){for(var t=0;t<this.colCount;t++)this.pageNodes[t][a].style.top=w+
"px"},repositionPages:function(a){for(var w=this.getDefaultNodes(),t=0,g=0;g<this.stack.length;g++)t=Math.max(this.stack[g],t);var l=(g=w[a])?this.getPageNodePosition(g)+this.getPageHeight(a):0;for(a+=1;a<=t;a++){if(g=w[a]){if(this.getPageNodePosition(g)==l)break;this.positionPage(a,l)}l+=this.getPageHeight(a)}},installPage:function(a){for(var w=0;w<this.colCount;w++)this.contentNodes[w].appendChild(this.pageNodes[w][a])},preparePage:function(a,w){w=w?this.popPage():null;for(var t=0;t<this.colCount;t++){var g=
this.pageNodes[t],l=null===w?this.createPageNode():this.invalidatePageNode(w,g);l.pageIndex=a;g[a]=l}},renderPage:function(a){var w=[],t;for(t=0;t<this.colCount;t++)w[t]=this.pageNodes[t][a];t=0;for(a*=this.rowsPerPage;t<this.rowsPerPage&&a<this.rowCount;t++,a++)this.renderRow(a,w)},removePage:function(a){var w=0;for(a*=this.rowsPerPage;w<this.rowsPerPage;w++,a++)this.removeRow(a)},destroyPage:function(a){for(var w=0;w<this.colCount;w++){var t=this.invalidatePageNode(a,this.pageNodes[w]);t&&v.destroy(t)}},
pacify:function(a){},pacifying:!1,pacifyTicks:200,setPacifying:function(a){this.pacifying!=a&&(this.pacifying=a,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var a=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return a},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var a=0;a<this.colCount;a++)I.setStyleHeightPx(this.contentNodes[a],
Math.max(1,this.height));a=!this._invalidating;if(!a){var w=this.grid.get("autoHeight");"number"==typeof w&&w<=Math.min(this.rowsPerPage,this.rowCount)&&(a=!0)}a&&this.needPage(this.page,this.pageTop);a=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;w=this.getPageHeight(this.page);this.averageRowHeight=0<w&&0<a?w/a:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var a=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=a},updateContentHeight:function(a){this.height+=a;this.resize()},updatePageHeight:function(a,w,t){if(this.pageExists(a)){var g=this.getPageHeight(a),l=this.measurePage(a);void 0===l&&(l=g);this.pageHeights[a]=l;if(g!=l){this.updateContentHeight(l-g);var A=this.grid.get("autoHeight");"number"==typeof A&&A>this.rowCount||!0===A&&!w?t?(w=this.grid.viewsNode.style,w.height=parseInt(w.height)+l-g+"px",this.repositionPages(a)):this.grid.sizeChange():this.repositionPages(a)}return l}return 0},
rowHeightChanged:function(a,w){this.updatePageHeight(Math.floor(a/this.rowsPerPage),!1,w)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var a=document.createElement("div");v.attr(a,"role","presentation");a.style.position="absolute";a.style[this.grid.isLeftToRight()?"left":"right"]="0";return a},getPageHeight:function(a){a=this.pageHeights[a];return void 0!==a?a:this.defaultPageHeight},pushPage:function(a){return this.stack.push(a)},
popPage:function(){return this.stack.shift()},findPage:function(a){for(var w=0,t=0,g=0;w<this.pageCount&&!(g=this.getPageHeight(w),t+g>=a);w++,t+=g);this.page=w;this.pageTop=t},buildPage:function(a,w,t){this.preparePage(a,w);this.positionPage(a,t);this.installPage(a);this.renderPage(a);this.pushPage(a)},needPage:function(a,w){var t=this.getPageHeight(a);this.pageExists(a)?this.positionPage(a,w):(this.buildPage(a,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,w),t=this.updatePageHeight(a,
!0));return t},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(a){this.grid.scrollTop=a;if(this.colCount){this.startPacify();this.findPage(a);for(var w=this.height,t=this.getScrollBottom(a),g=this.page,l=this.pageTop;g<this.pageCount&&(0>t||l<t);g++)l+=this.needPage(g,l);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,a);this.lastVisibleRow=this.getLastVisibleRow(g-1,l,t);w!=this.height&&this.repositionPages(g-1);this.endPacify()}},getScrollBottom:function(a){return 0<=
this.windowHeight?a+this.windowHeight:-1},processNodeEvent:function(a,w){for(var t=a.target;t&&t!=w&&t.parentNode&&t.parentNode.parentNode!=w;)t=t.parentNode;if(!t||!t.parentNode||t.parentNode.parentNode!=w)return!1;a.topRowIndex=t.parentNode.pageIndex*this.rowsPerPage;w=a.topRowIndex;a:{var g=0;for(var l,A=t.parentNode;l=A.childNodes[g++];)if(l==t){--g;break a}g=-1}a.rowIndex=w+g;a.rowTarget=t;return!0},processEvent:function(a){return this.processNodeEvent(a,this.contentNode)},renderRow:function(a,
w){},removeRow:function(a){},getDefaultPageNode:function(a){return this.getDefaultNodes()[a]},positionPageNode:function(a,w){},getPageNodePosition:function(a){return a.offsetTop},invalidatePageNode:function(a,w){var t=w[a];t&&(delete w[a],this.removePage(a,t),e(t),t.innerHTML="");return t},getPageRow:function(a){return a*this.rowsPerPage},getLastPageRow:function(a){return Math.min(this.rowCount,this.getPageRow(a+1))-1},getFirstVisibleRow:function(a,w,t){if(!this.pageExists(a))return 0;var g=this.getPageRow(a),
l=this.getDefaultNodes();a=d(l[a],"div");l=0;for(var A=a.length;l<A&&w<t;l++,g++)w+=a[l].offsetHeight;return g?g-1:g},getLastVisibleRow:function(a,w,t){if(!this.pageExists(a))return 0;var g=this.getDefaultNodes(),l=this.getLastPageRow(a);a=d(g[a],"div");for(g=a.length-1;0<=g&&w>t;g--,l--)w-=a[g].offsetHeight;return l+1},findTopRow:function(a){var w=this.getDefaultNodes();w=d(w[this.page],"div");for(var t=0,g=w.length,l=this.pageTop,A;t<g;t++)if(A=w[t].offsetHeight,l+=A,l>=a)return this.offset=A-(l-
a),t+this.page*this.rowsPerPage;return-1},findScrollTop:function(a){var w=Math.floor(a/this.rowsPerPage),t=0,g;for(g=0;g<w;g++)t+=this.getPageHeight(g);this.pageTop=t;this.page=w;this.needPage(w,this.pageTop);g=this.getDefaultNodes();var l=d(g[w],"div");w=a-this.rowsPerPage*w;g=0;for(a=l.length;g<a&&g<w;g++)t+=l[g].offsetHeight;return t},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(O,J,K,I){var v=J.getObject("grid.util",!0,O);
v.na="...";v.rowIndexTag="gridRowIndex";v.gridViewTag="gridView";v.fire=function(e,d,a){function w(p,k){if(null==p)return null;var n=k?"Width":"Height";return p["scroll"+n]>p["client"+n]?p:w(p.parentNode,k)}var t;if(I("webkit")&&"focus"==d){var g=e.domNode?e.domNode:e;if(t=w(g,!1))var l=t.scrollTop;if(g=w(g,!0))var A=g.scrollLeft}var h=e&&d&&e[d];e=h&&(a?h.apply(e,a):e[d]());I("webkit")&&"focus"==d&&(t&&(t.scrollTop=l),g&&(g.scrollLeft=A));return e};v.setStyleHeightPx=function(e,d){if(0<=d){var a=
e.style;d+="px";e&&a.height!=d&&(a.height=d)}};v.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");v.keyEvents=["keyup","keydown","keypress"];v.funnelEvents=function(e,d,a,w){w=w?w:v.mouseEvents.concat(v.keyEvents);for(var t=0,g=w.length;t<g;t++)d.connect(e,"on"+w[t],a)};v.removeNode=function(e){(e=K.byId(e))&&e.parentNode&&e.parentNode.removeChild(e);return e};v.arrayCompare=function(e,d){for(var a=0,w=e.length;a<w;a++)if(e[a]!=d[a])return!1;return e.length==
d.length};v.arrayInsert=function(e,d,a){e.length<=d?e[d]=a:e.splice(d,0,a)};v.arrayRemove=function(e,d){e.splice(d,1)};v.arraySwap=function(e,d,a){var w=e[d];e[d]=e[a];e[a]=w};return v})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(O,J,K,I,v,e){return K("dojox.grid._Layout",null,{constructor:function(d){this.grid=d},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(d,
a,w,t,g){var l=this.structure[d].cells[0],A=this.structure[a].cells[0],h=null,p=h=0;d=0;for(var k;k=l[d];d++)if(k.index==w){h=d;break}h=l.splice(h,1)[0];h.view=this.grid.views.views[a];d=0;for(k=null;k=A[d];d++)if(k.index==t){p=d;break}g||(p+=1);A.splice(p,0,h);if(w=this.grid.getCell(this.grid.getSortIndex()))w._currentlySorted=this.grid.getSortAsc();this.cells=[];for(d=w=0;a=this.structure[d];d++)for(t=0;g=a.cells[t];t++)for(l=0;k=g[l];l++)k.index=w,this.cells.push(k),"_currentlySorted"in k&&(A=
w+1,A*=k._currentlySorted?1:-1,this.grid.sortInfo=A,delete k._currentlySorted),w++;I.forEach(this.cells,function(n){var m=n.markup[2].split(" ");parseInt(m[1].substring(5))!=n.index&&(m[1]='idx\x3d"'+n.index+'"',n.markup[2]=m.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(d,a){d=this.cells[d];if(d.hidden==a){d.hidden=!a;a=d.view;var w=a.viewWidth;w&&"auto"!=w&&(a._togglingColumn=e.getMarginBox(d.getHeaderNode()).w||0);a.update();return!0}return!1},addCellDef:function(d,a,w){var t=
this,g=function(l){var A=0;1<l.colSpan?A=0:(A=l.width||t._defaultCellProps.width||t.defaultWidth,isNaN(A)||(A+="em"));return A};d={grid:this.grid,subrow:d,layoutIndex:a,index:this.cells.length};if(w&&w instanceof J.grid.cells._Base)return a=v.clone(w),d.unitWidth=g(a._props),a=v.mixin(a,this._defaultCellProps,w._props,d);a=w.type||w.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||J.grid.cells.Cell;v.isString(a)&&(a=v.getObject(a));d.unitWidth=g(w);return new a(v.mixin({},this._defaultCellProps,
w,d))},addRowDef:function(d,a){for(var w=[],t=0,g=0,l=!0,A=0,h;h=a[A];A++)h=this.addCellDef(d,A,h),w.push(h),this.cells.push(h),l&&h.relWidth?t+=h.relWidth:h.width&&(h=h.width,"string"==typeof h&&"%"==h.slice(-1)?g+=window.parseInt(h,10):"auto"==h&&(l=!1));t&&l&&I.forEach(w,function(p){p.relWidth&&(p.width=p.unitWidth=p.relWidth/t*(100-g)+"%")});return w},addRowsDef:function(d){var a=[];if(v.isArray(d))if(v.isArrayLike(d[0]))for(var w=0,t;d&&(t=d[w]);w++)a.push(this.addRowDef(w,t));else a.push(this.addRowDef(0,
d));return a},addViewDef:function(d){this._defaultCellProps=d.defaultCell||{};d.width&&"auto"==d.width&&delete d.width;return v.mixin({},d,{cells:this.addRowsDef(d.rows||d.cells)})},setStructure:function(d){this.fieldIndex=0;this.cells=[];var a=this.structure=[];if(this.grid.rowSelector){var w={type:J._scopeName+".grid._RowSelector"};if(v.isString(this.grid.rowSelector)){var t=this.grid.rowSelector;"false"==t?w=null:"true"!=t&&(w.width=t)}else this.grid.rowSelector||(w=null);w&&a.push(this.addViewDef(w))}var g=
function(p){return"name"in p||"field"in p||"get"in p};w=function(p){return v.isArray(p)&&(v.isArray(p[0])||g(p[0]))?!0:!1};t=function(p){return null!==p&&v.isObject(p)&&("cells"in p||"rows"in p||"type"in p&&!g(p))};if(v.isArrayLike(d)){for(var l=!1,A=0,h;h=d[A];A++)if(t(h)){l=!0;break}if(l)for(A=0;h=d[A];A++)w(h)?a.push(this.addViewDef({cells:h})):t(h)&&a.push(this.addViewDef(h));else a.push(this.addViewDef({cells:d}))}else t(d)&&a.push(this.addViewDef(d));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(O){return O.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l){var A=J("dojox.grid._DeferredTextWidget",g,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(K.hitch(this,
function(m){this.domNode&&(this.domNode.innerHTML=m)}))}}),h=function(){setTimeout(K.hitch.apply(O,arguments),0)},p=J("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(m){this._props=m||{};K.mixin(this,m);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(m,C){var B=this.grid.formatterScope||this,y=this.formatter;
y&&B&&"string"==typeof y&&(y=this.formatter=B[y]);m=m!=this.defaultValue&&y?y.apply(B,C):m;if("undefined"==typeof m)return this.defaultValue;m&&m.addBoth&&(m=new A({deferred:m},t.create("span",{innerHTML:this.defaultValue})));return m&&m.declaredClass&&m.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+m.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":m},format:function(m,C){var B=this.grid.edit.info;(C=this.get?this.get(m,C):this.value||this.defaultValue)&&C.replace&&
this.grid.escapeHTMLInData&&(C=C.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||B.rowIndex==m&&B.cell==this)?this.formatEditing(B.value?B.value:C,m):this._defaultFormat(C,[C,m,this])},formatEditing:function(m,C){},getNode:function(m){return this.view.getCellNode(m,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(m){return(this.getNode(m)||0).firstChild||0},canResize:function(){var m=
this.unitWidth;return m&&"auto"!==m},isFlex:function(){var m=this.unitWidth;return m&&K.isString(m)&&("auto"==m||"%"==m.slice(-1))},applyEdit:function(m,C){this.getNode(C)&&this.grid.edit.applyCellEdit(m,this,C)},cancelEdit:function(m){this.grid.doCancelEdit(m)},_onEditBlur:function(m){this.grid.edit.isEditCell(m,this.index)&&this.grid.edit.apply()},registerOnBlur:function(m,C){this.commitOnBlur&&v.connect(m,"onblur",function(B){setTimeout(K.hitch(this,"_onEditBlur",C),250)})},needFormatNode:function(m,
C){this._formatPending=!0;h(this,"_formatNode",m,C)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(m,C){this._formatPending&&(this._formatPending=!1,d("ie")||a.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(C),m,C))},formatNode:function(m,C,B){d("ie")?h(this,"focus",B,m):this.focus(B,m)},dispatchEvent:function(m,C){if(m in this)return this[m](C)},getValue:function(m){return this.getEditNode(m)[this._valueProp]},setValue:function(m,C){(m=this.getEditNode(m))&&
(m[this._valueProp]=C)},focus:function(m,C){m=C||this.getEditNode(m);try{l.fire(m,"focus"),l.fire(m,"select")}catch(B){}},save:function(m){this.value=this.value||this.getValue(m)},restore:function(m){this.setValue(m,this.value)},_finish:function(m){a.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(m){this.applyEdit(this.getValue(m),m);this._finish(m)},cancel:function(m){this.cancelEdit(m);this._finish(m)}});p.markupFactory=function(m,C){var B=K.trim(w.get(m,"formatter")||
"");B&&(C.formatter=K.getObject(B)||B);if(B=K.trim(w.get(m,"get")||""))C.get=K.getObject(B);B=function(y,G,f){var b=K.trim(w.get(m,y)||"");b&&(G[f||y]="false"!=b.toLowerCase())};B("sortDesc",C);B("editable",C);B("alwaysEditing",C);B("noresize",C);B("draggable",C);if(B=K.trim(w.get(m,"loadingText")||w.get(m,"defaultValue")||""))C.defaultValue=B;B=function(y,G,f){var b=K.trim(w.get(m,y)||"")||void 0;b&&(G[f||y]=b)};B("styles",C);B("headerStyles",C);B("cellStyles",C);B("classes",C);B("headerClasses",
C);B("cellClasses",C)};var k=p.Cell=J("dojox.grid.cells.Cell",p,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(m,C){this.needFormatNode(m,C);m&&m.replace&&(m=m.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+m+'"\x3e'},formatNode:function(m,C,B){this.inherited(arguments);this.registerOnBlur(m,B)},doKey:function(m){this.keyFilter&&-1==String.fromCharCode(m.charCode).search(this.keyFilter)&&I.stop(m)},_finish:function(m){this.inherited(arguments);
var C=this.getEditNode(m);try{l.fire(C,"blur")}catch(B){}}});k.markupFactory=function(m,C){p.markupFactory(m,C);if(m=K.trim(w.get(m,"keyFilter")||""))C.keyFilter=new RegExp(m)};(p.RowIndex=J("dojox.grid.cells.RowIndex",k,{name:"Row",postscript:function(){this.editable=!1},get:function(m){return m+1}})).markupFactory=function(m,C){k.markupFactory(m,C)};(p.Select=J("dojox.grid.cells.Select",k,{options:null,values:null,returnIndex:-1,constructor:function(m){this.values=this.values||this.options},formatEditing:function(m,
C){this.needFormatNode(m,C);C=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var B=0,y,G;void 0!==(y=this.options[B])&&void 0!==(G=this.values[B]);B++)G=G.replace?G.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):G,y=y.replace?y.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):y,C.push("\x3coption",m==G?" selected":"",' value\x3d"'+G+'"',"\x3e",y,"\x3c/option\x3e");C.push("\x3c/select\x3e");return C.join("")},_defaultFormat:function(m,C){var B=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var y=e.indexOf(this.values,B);0<=y&&(B=this.options[y])}return B},getValue:function(m){var C=this.getEditNode(m);if(C)return m=C.selectedIndex,C=C.options[m],-1<this.returnIndex?m:C.value||C.innerHTML}})).markupFactory=function(m,C){k.markupFactory(m,C);var B=K.trim(w.get(m,"options")||"");if(B){var y=B.split(",");y[0]!=B&&(C.options=y)}if(m=K.trim(w.get(m,"values")||""))B=m.split(","),B[0]!=m&&(C.values=B)};var n=p.AlwaysEdit=J("dojox.grid.cells.AlwaysEdit",k,{alwaysEditing:!0,_formatNode:function(m,
C){this.formatNode(this.getEditNode(C),m,C)},applyStaticValue:function(m){var C=this.grid.edit;C.applyCellEdit(this.getValue(m),this,m);C.start(this,m,!0)}});n.markupFactory=function(m,C){k.markupFactory(m,C)};(p.Bool=J("dojox.grid.cells.Bool",n,{_valueProp:"checked",formatEditing:function(m,C){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(m?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(m){"INPUT"==m.target.tagName&&this.applyStaticValue(m.rowIndex)}})).markupFactory=
function(m,C){n.markupFactory(m,C)};return p})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(O,J){return O("dojox.grid._RowSelector",J,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(K,I){I.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(K,I){var v=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(K)&&v.push("dojoxGridRowbarOver");this.grid.selection.isSelected(K)&&v.push("dojoxGridRowbarSelected");I.className=v.join(" ")},domouseover:function(K){this.grid.onMouseOverRow(K)},domouseout:function(K){if(!this.isIntraRowEvent(K))this.grid.onMouseOutRow(K)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B){g=I("dojox.grid._View",[A,h],{defaultWidth:"18em",viewWidth:"",templateString:g,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:m._HeaderBuilder,_contentBuilderClass:m._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");k.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
k.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){n.destroy(this.headerNode);delete this.headerNode;for(var f in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[f]),n.destroy(this.rowNodes[f]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){a("ie")||a("webkit")||a("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(f){f=this.structure=f;f.width&&!isNaN(f.width)?this.viewWidth=f.width+"em":this.viewWidth=f.width||(f.noscroll?"auto":this.viewWidth);this._onBeforeRow=f.onBeforeRow||function(){};this._onAfterRow=f.onAfterRow||function(){};if(this.noscroll=f.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==f.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(f){f&&v.forEach(w("[widgetId]",f).map(J.byNode),function(b){b._destroyOnRemove?(b.destroy(),delete b):b.domNode&&b.domNode.parentNode&&b.domNode.parentNode.removeChild(b.domNode)})},onBeforeRow:function(f,b){this._onBeforeRow(f,b);0<=f&&this._cleanupRowWidgets(this.getRowNode(f))},onAfterRow:function(f,b,z){this._onAfterRow(f,b,z);var c=this.grid;v.forEach(w(".dojoxGridStubNode",z),function(D){if(D&&D.parentNode){var F=D.getAttribute("linkWidget"),
R=window.parseInt(n.attr(D,"cellIdx"),10);c.getCell(R);(F=J.byId(F))?(D.parentNode.replaceChild(F.domNode,D),F._started||F.startup(),O.destroy(D)):D.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var f=0,b;b=this.structure.cells[f];f++)for(var z=0,c;c=b[z];z++)c.view=this,this.flexCells=this.flexCells||c.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var f=this.hasVScrollbar(),b=n.style(this.scrollboxNode,
"overflow");this.noscroll||!b||"hidden"==b?f=!1:"scroll"==b&&(f=!0);return f?p.getScrollbar().w:0},getColumnsWidth:function(){var f=this.headerContentNode;return f&&f.firstChild?f.firstChild.offsetWidth||n.style(f.firstChild,"width"):0},setColumnsWidth:function(f){this.headerContentNode.firstChild.style.width=f+"px";this.viewWidth&&(this.viewWidth=f+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
n._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var f=this.grid.layout.cells,b=e.hitch(this,function(c,D){!this.grid.isLeftToRight()&&(D=!D);D=D?-1:1;c=this.header.getCellNodeIndex(c)+D;for(var F=f[c];F&&F.getHeaderNode()&&"none"==F.getHeaderNode().style.display;)c+=D,F=f[c];return F?F.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&n.destroy(this.bottomMarker);this.bottomMarker=n.byId("dojoxGrid_bottomMarker");this.topMarker&&n.destroy(this.topMarker);this.topMarker=n.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=n.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},t.body()),this._hide(this.bottomMarker),this.topMarker=n.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
t.body()),this._hide(this.topMarker));this.arrowDim=n.contentBox(this.bottomMarker);var z=n.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new l(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:e.hitch(this,function(c){this.header.decorateEvent(c);if((this.header.overRightResizeArea(c)||this.header.overLeftResizeArea(c))&&this.header.canResize(c)&&!this.header.moveable)this.header.beginColumnResize(c);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);c.button===(9>a("ie")?1:0)&&l.prototype.onMouseDown.call(this.source,c)}}),onMouseOver:e.hitch(this,function(c){var D=this.source;D._getChildByEvent(c)&&l.prototype.onMouseOver.apply(D,arguments)}),_markTargetAnchor:e.hitch(this,function(c){var D=this.source;if(D.current!=D.targetAnchor||D.before!=c){D.targetAnchor&&b(D.targetAnchor,D.before)&&D._removeItemClass(b(D.targetAnchor,D.before),D.before?"After":"Before");l.prototype._markTargetAnchor.call(D,
c);var F=c?D.targetAnchor:b(D.targetAnchor,D.before);c=0;F||(F=D.targetAnchor,c=n.contentBox(F).w+this.arrowDim.w/2+2);F=n.position(F,!0);c=Math.floor(F.x-this.arrowDim.w/2+c);n.style(this.bottomMarker,"visibility","visible");n.style(this.topMarker,"visibility","visible");n.style(this.bottomMarker,{left:c+"px",top:z+F.y+"px"});n.style(this.topMarker,{left:c+"px",top:F.y-this.arrowDim.h+"px"});D.targetAnchor&&b(D.targetAnchor,D.before)&&D._addItemClass(b(D.targetAnchor,D.before),D.before?"After":"Before")}}),
_unmarkTargetAnchor:e.hitch(this,function(){var c=this.source;c.targetAnchor&&(c.targetAnchor&&b(c.targetAnchor,c.before)&&c._removeItemClass(b(c.targetAnchor,c.before),c.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),l.prototype._unmarkTargetAnchor.call(c))}),destroy:e.hitch(this,function(){d.disconnect(this._source_conn);d.unsubscribe(this._source_sub);l.prototype.destroy.call(this.source);this.bottomMarker&&(n.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(n.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:e.hitch(this,function(){l.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=d.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=d.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(f){n.style(f,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(f,b,z){B.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,b=this.grid.views.views,f=b[f.viewIndex],b=b[this.index],b!=f&&(f.convertColPctToFixed(),b.convertColPctToFixed()))},_onDndDrop:function(f,b,z){if(B.manager().target!==this.source)B.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);z=n.marginBox(b[0]).w;if(f.viewIndex!==this.index){var c=this.grid.views.views,D=c[f.viewIndex];c=c[this.index];
D.viewWidth&&"auto"!=D.viewWidth&&D.setColumnsWidth(D.getColumnsWidth()-z);c.viewWidth&&"auto"!=c.viewWidth&&c.setColumnsWidth(c.getColumnsWidth())}z=this.source._targetNode;D=this.source._beforeTarget;!this.grid.isLeftToRight()&&(D=!D);c=this.grid.layout;var F=this.index;delete this.source._targetNode;delete this.source._beforeTarget;var R=c.moveColumn;f=f.viewIndex;b=(b=b[0])?n.attr(b,"idx"):null;R.call(c,f,F,b,z?n.attr(z,"idx"):null,D)}},renderHeader:function(){this.headerContentNode.innerHTML=
this.header.generateHtml(this._getHeaderContent);this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);k.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(f){var b=f.name||f.grid.getCellName(f);/^\s+$/.test(b)&&(b="\x26nbsp;");var z=['\x3cdiv class\x3d"dojoxGridSortNode'];f.index!=f.grid.getSortIndex()?z.push('"\x3e'):z=z.concat([" ",0<f.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",
'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',0<f.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);z=z.concat([b,"\x3c/div\x3e\x3c/div\x3e"]);return z.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(f){var b=this._hasHScroll||!1;if(void 0==this._hasHScroll||f)this.noscroll?this._hasHScroll=!1:(f=n.style(this.scrollboxNode,
"overflow"),this._hasHScroll="hidden"==f?!1:"scroll"==f?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);b!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(f){var b=this._hasVScroll||!1;if(void 0==this._hasVScroll||f)this.noscroll?this._hasVScroll=!1:(f=n.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==f?!1:"scroll"==f?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);b!==this._hasVScroll&&
this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var f=!1;this.grid.initialWidth="";var b=w("th",this.headerContentNode),z=v.map(b,function(c,D){var F=c.style.width;n.attr(c,"vIdx",D);if(F&&"%"==F.slice(-1))f=!0;else if(F&&"px"==F.slice(-2))return window.parseInt(F,10);return n.contentBox(c).w});return f?(v.forEach(this.grid.layout.cells,function(c,D){if(c.view==this&&(c=c.view.getHeaderCellNode(c.index))&&n.hasAttr(c,"vIdx")){var F=window.parseInt(n.attr(c,"vIdx"));this.setColWidth(D,
z[F]);n.removeAttr(c,"vIdx")}},this),!0):!1},adaptHeight:function(f){if(!this.grid._autoHeight){var b=this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!f&&(f=this.noscroll))a:{for(var z=0;z<this.grid.views.views.length;++z)if(f=this.grid.views.views[z],f!==this&&f.hasHScrollbar()){f=!0;break a}f=!1}f&&(b-=p.getScrollbar().h);k.setStyleHeightPx(this.scrollboxNode,b)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=
this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var f=this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(f=Math.min(f,this.getColumnsWidth())+"px",this._removingColumn=!1):f=Math.max(f,this.getColumnsWidth())+"px";this.contentNode.style.width=f;this.hasHScrollbar(!0)},setSize:function(f,b){var z=this.domNode.style,c=this.headerNode.style;f&&(z.width=f,c.width=f);z.height=0<=b?b+"px":""},renderRow:function(f){var b=this.createRowNode(f);
this.buildRow(f,b);return b},createRowNode:function(f){var b=document.createElement("div");b.className=this.classTag+"Row";this instanceof K.grid._RowSelector?n.attr(b,"role","presentation"):(n.attr(b,"role","row"),"none"!=this.grid.selectionMode&&b.setAttribute("aria-selected","false"));b[k.gridViewTag]=this.id;b[k.rowIndexTag]=f;return this.rowNodes[f]=b},buildRow:function(f,b){this.buildRowContent(f,b);this.styleRow(f,b)},buildRowContent:function(f,b){b.innerHTML=this.content.generateHtml(f,f);
this.flexCells&&this.contentWidth&&(b.firstChild.style.width=this.contentWidth);k.fire(this,"onAfterRow",[f,this.structure.cells,b])},rowRemoved:function(f){0<=f&&this._cleanupRowWidgets(this.getRowNode(f));this.grid.edit.save(this,f);delete this.rowNodes[f]},getRowNode:function(f){return this.rowNodes[f]},getCellNode:function(f,b){if(f=this.getRowNode(f))return this.content.getCellNode(f,b)},getHeaderCellNode:function(f){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,
f)},styleRow:function(f,b){var z=void 0==b.style.cssText?b.getAttribute("style"):b.style.cssText;b._style=z;this.styleRowNode(f,b)},styleRowNode:function(f,b){b&&this.doStyleRowNode(f,b)},doStyleRowNode:function(f,b){this.grid.styleRowNode(f,b)},updateRow:function(f){var b=this.getRowNode(f);b&&(b.style.height="",this.buildRow(f,b));return b},updateRowStyles:function(f){this.styleRowNode(f,this.getRowNode(f))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(f){if(13<=a("ff")||a("chrome"))this._nativeScroll=
!0;f=this.grid.isLeftToRight();if(2>this.firstScroll){if(!f&&1==this.firstScroll||f&&0===this.firstScroll){var b=n.marginBox(this.headerNodeContainer);a("ie")?this.headerNodeContainer.style.width=b.w+this.getScrollbarWidth()+"px":a("mozilla")&&(this.headerNodeContainer.style.width=b.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=f?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=
this.scrollboxNode.scrollLeft;f=this.scrollboxNode.scrollTop;f!==this.lastTop&&this.grid.scrollTo(f);this._nativeScroll=!1},setScrollTop:function(f){this.lastTop=f;this._nativeScroll||(this.scrollboxNode.scrollTop=f);return this.scrollboxNode.scrollTop},doContentEvent:function(f){if(this.content.decorateEvent(f))this.grid.onContentEvent(f)},doHeaderEvent:function(f){if(this.header.decorateEvent(f))this.grid.onHeaderEvent(f)},dispatchContentEvent:function(f){return this.content.dispatchEvent(f)},dispatchHeaderEvent:function(f){return this.header.dispatchEvent(f)},
setColWidth:function(f,b){this.grid.setCellWidth(f,b+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var f=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=f;this.headerNode.scrollLeft=f}}});var y=I("dojox.grid._GridAvatar",C,{construct:function(){var f=t.doc,b=f.createElement("table");b.cellPadding=b.cellSpacing="0";b.className="dojoxGridDndAvatar";b.style.position="absolute";b.style.zIndex=1999;b.style.margin="0px";var z=f.createElement("tbody"),c=f.createElement("tr"),
D=f.createElement("td"),F=f.createElement("td");c.className="dojoxGridDndAvatarItem";F.className="dojoxGridDndAvatarItemImage";F.style.width="16px";var R=this.manager.source;if(R.creator)R=R._normalizedCreator(R.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(R=this.manager.nodes[0].cloneNode(!0),"tr"==R.tagName.toLowerCase()){var N=f.createElement("table");var r=f.createElement("tbody");r.appendChild(R);N.appendChild(r);R=N}else"th"==R.tagName.toLowerCase()&&(N=f.createElement("table"),
r=f.createElement("tbody"),f=f.createElement("tr"),N.cellPadding=N.cellSpacing="0",f.appendChild(R),r.appendChild(f),N.appendChild(r),R=N);R.id="";D.appendChild(R);c.appendChild(F);c.appendChild(D);n.style(c,"opacity",.9);z.appendChild(c);b.appendChild(z);this.node=b;b=B.manager();this.oldOffsetY=b.OFFSET_Y;b.OFFSET_Y=1},destroy:function(){B.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),G=B.manager().makeAvatar;B.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
n.hasClass(t.body(),"dijit_a11y")?G.call(B.manager()):new y(this)};return g})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(O,J,K,I,v,e,d){var a=J.getObject("dojox.html.metrics",!0),w=J.getObject("dojox");a.getFontMeasurements=function(){var p={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(K("ie")){var k=
e.doc.documentElement.style.fontSize||"";k||(e.doc.documentElement.style.fontSize="100%")}var n=e.doc.createElement("div"),m=n.style;m.position="absolute";m.left="-100px";m.top="0";m.width="30px";m.height="1000em";m.borderWidth="0";m.margin="0";m.padding="0";m.outline="0";m.lineHeight="1";m.overflow="hidden";e.body().appendChild(n);for(var C in p)m.fontSize=C,p[C]=16*Math.round(12*n.offsetHeight/16)/12/1E3;K("ie")&&(e.doc.documentElement.style.fontSize=k);e.body().removeChild(n);n=null;return p};
var t=null;a.getCachedFontMeasurements=function(p){if(p||!t)t=a.getFontMeasurements();return t};var g=null,l={};a.getTextBox=function(p,k,n){if(g)var m=g;else{m=g=e.doc.createElement("div");m.style.whiteSpace="nowrap";var C=e.doc.createElement("div");C.appendChild(m);var B=C.style;B.overflow="scroll";B.position="absolute";B.left="0px";B.top="-10000px";B.width="1px";B.height="1px";B.visibility="hidden";B.borderWidth="0";B.margin="0";B.padding="0";B.outline="0";e.body().appendChild(C)}m.className="";
B=m.style;B.borderWidth="0";B.margin="0";B.padding="0";B.outline="0";if(1<arguments.length&&k)for(var y in k)y in l||(B[y]=k[y]);2<arguments.length&&n&&(m.className=n);m.innerHTML=p;B=d.position(m);B.w=m.parentNode.scrollWidth;return B};var A=16,h=16;a.getScrollbar=function(){return{w:A,h:h}};a._fontResizeNode=null;a.initOnFontResize=function(p){var k=a._fontResizeNode=e.doc.createElement("iframe");p=k.style;p.position="absolute";p.width="5em";p.height="10em";p.top="-10000px";p.display="none";K("ie")?
k.onreadystatechange=function(){"complete"==k.contentWindow.document.readyState&&(k.onresize=k.contentWindow.parent[w._scopeName].html.metrics._fontresize)}:k.onload=function(){k.contentWindow.onresize=k.contentWindow.parent[w._scopeName].html.metrics._fontresize};k.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");e.body().appendChild(k);a.initOnFontResize=
function(){}};a.onFontResize=function(){};a._fontresize=function(){a.onFontResize()};v.addOnUnload(function(){var p=a._fontResizeNode;p&&(K("ie")&&p.onresize?p.onresize=null:p.contentWindow&&p.contentWindow.onresize&&(p.contentWindow.onresize=null),a._fontResizeNode=null)});I(function(){try{var p=e.doc.createElement("div");p.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";e.body().appendChild(p);A=p.offsetWidth-p.clientWidth;h=p.offsetHeight-
p.clientHeight;e.body().removeChild(p);delete p}catch(k){}"fontSizeWatch"in O.config&&O.config.fontSizeWatch&&a.initOnFontResize()});return a})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l){var A=O.grid,h=function(y,G){return y&&((y.rows||0)[G]||y.childNodes[G])},p=function(y){for(;y&&
"TABLE"!=y.tagName;y=y.parentNode);return y},k=function(y){var G=y.toUpperCase();return function(f){return f.tagName!=G}},n=t.rowIndexTag,m=t.gridViewTag,C=A._Builder=K.extend(function(y){y&&(this.view=y,this.grid=y.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var y=[this._table];this.view.viewWidth&&y.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));y.push("\x3e");
return y},generateCellMarkup:function(y,G,f,b){var z=[];if(b){var c=y.index!=y.grid.getSortIndex()?"":0<y.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';y.id||(y.id=this.grid.id+"Hdr"+y.index);c=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',c,' id\x3d"',y.id,'"']}else c=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&!y.editable?'aria-readonly\x3d"true"':""];y.colSpan&&c.push(' colspan\x3d"',y.colSpan,'"');y.rowSpan&&c.push(' rowspan\x3d"',
y.rowSpan,'"');c.push(' class\x3d"dojoxGridCell ');y.classes&&c.push(y.classes," ");f&&c.push(f," ");z.push(c.join(""));z.push("");c=['" idx\x3d"',y.index,'" style\x3d"'];G&&";"!=G[G.length-1]&&(G+=";");c.push(y.styles,G||"",y.hidden?"display:none;":"");y.unitWidth&&c.push("width:",y.unitWidth,";");z.push(c.join(""));z.push("");c=['"'];y.attrs&&c.push(" ",y.attrs);c.push("\x3e");z.push(c.join(""));z.push("");z.push(b?"\x3c/th\x3e":"\x3c/td\x3e");return z},isCellNode:function(y){return!(!y||y==I.doc||
!g.attr(y,"idx"))},getCellNodeIndex:function(y){return y?Number(g.attr(y,"idx")):-1},getCellNode:function(y,G){for(var f=0,b;(b=h(y.firstChild,f))&&b.cells;f++)for(var z=0,c;c=b.cells[z];z++)if(this.getCellNodeIndex(c)==G)return c;return null},findCellTarget:function(y,G){for(;y&&(!this.isCellNode(y)||y.offsetParent&&m in y.offsetParent.parentNode&&y.offsetParent.parentNode[m]!=this.view.id)&&y!=G;)y=y.parentNode;return y!=G?y:null},baseDecorateEvent:function(y){y.dispatch="do"+y.type;y.grid=this.grid;
y.sourceView=this.view;y.cellNode=this.findCellTarget(y.target,y.rowNode);y.cellIndex=this.getCellNodeIndex(y.cellNode);y.cell=0<=y.cellIndex?this.grid.getCell(y.cellIndex):null},findTarget:function(y,G){for(;y&&y!=this.domNode&&(!(G in y)||m in y&&y[m]!=this.view.id);)y=y.parentNode;return y!=this.domNode?y:null},findRowTarget:function(y){return this.findTarget(y,n)},isIntraNodeEvent:function(y){try{return y.cellNode&&y.relatedTarget&&g.isDescendant(y.relatedTarget,y.cellNode)}catch(G){return!1}},
isIntraRowEvent:function(y){try{var G=y.relatedTarget&&this.findRowTarget(y.relatedTarget);return!G&&-1==y.rowIndex||G&&y.rowIndex==G.gridRowIndex}catch(f){return!1}},dispatchEvent:function(y){return y.dispatch in this?this[y.dispatch](y):!1},domouseover:function(y){y.cellNode&&y.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=y.cellNode,this.grid.onMouseOver(y));this.grid.onMouseOverRow(y)},domouseout:function(y){if(y.cellNode&&y.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(y,
this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(y),!this.isIntraRowEvent(y)))this.grid.onMouseOutRow(y)},domousedown:function(y){if(y.cellNode)this.grid.onMouseDown(y);this.grid.onMouseDownRow(y)},_getTextDirStyle:function(y,G,f){return""}});O=A._ContentBuilder=K.extend(function(y){C.call(this,y)},C.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var y=this.grid.get,G=this.view.structure.cells,f=0,b;b=G[f];f++)for(var z=0,c;c=b[z];z++)c.get=c.get||
void 0==c.value&&y,c.markup=this.generateCellMarkup(c,c.cellStyles,c.cellClasses,!1),!this.grid.editable&&c.editable&&(this.grid.editable=!0)},generateHtml:function(y,G){y=this.getTableArray();var f=this.view.structure.cells,b=this.grid.getItem(G);t.fire(this.view,"onBeforeRow",[G,f]);for(var z=0,c;c=f[z];z++)if(!c.hidden&&!c.header){y.push(c.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var D=0,F,R,N;F=c[D];D++){R=F.markup;var r=F.customClasses=[];N=F.customStyles=[];R[5]=
F.format(G,b);R[1]=r.join(" ");R[3]=N.join(";");(r=F.textDir||this.grid.textDir)&&(R[3]+=this._getTextDirStyle(r,F,G));y.push.apply(y,R)}y.push("\x3c/tr\x3e")}y.push("\x3c/table\x3e");return y.join("")},decorateEvent:function(y){y.rowNode=this.findRowTarget(y.target);if(!y.rowNode)return!1;y.rowIndex=y.rowNode[n];this.baseDecorateEvent(y);y.cell=this.grid.getCell(y.cellIndex);return!0}});var B=A._HeaderBuilder=K.extend(function(y){this.moveable=null;C.call(this,y)},C.prototype,{_skipBogusClicks:!1,
overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new A._TableMap(this.view.structure.cells)},generateHtml:function(y,G){var f,b=this.getTableArray(),z=this.view.structure.cells;t.fire(this.view,"onBeforeRow",[-1,z]);for(var c=0,D;D=z[c];c++)if(!D.hidden){b.push(D.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var F=0,R,N;R=D[F];F++)R.customClasses=[],R.customStyles=[],this.view.simpleStructure&&(R.draggable&&
(R.headerClasses?-1==R.headerClasses.indexOf("dojoDndItem")&&(R.headerClasses+=" dojoDndItem"):R.headerClasses="dojoDndItem"),R.attrs?-1==R.attrs.indexOf("dndType\x3d'gridColumn_")&&(R.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):R.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),N=this.generateCellMarkup(R,R.headerStyles,R.headerClasses,!0),N[5]=void 0!=G?G:y(R),N[3]=R.customStyles.join(";"),(f=R.textDir||this.grid.textDir)&&(N[3]+=this._getTextDirStyle(f,R,G)),N[1]=R.customClasses.join(" "),
b.push(N.join(""));b.push("\x3c/tr\x3e")}b.push("\x3c/table\x3e");return b.join("")},getCellX:function(y){var G=k("th");for(var f=y.target;f&&G(f);f=f.parentNode);(G=f)?(G=l.position(G),y=y.clientX-G.x):y=y.layerX;return y},decorateEvent:function(y){this.baseDecorateEvent(y);y.rowIndex=-1;y.cellX=this.getCellX(y);return!0},prepareResize:function(y,G){do{var f=y.cellIndex;y.cellNode=f?y.cellNode.parentNode.cells[f+G]:null;y.cellIndex=y.cellNode?this.getCellNodeIndex(y.cellNode):-1}while(y.cellNode&&
"none"==y.cellNode.style.display);return!!y.cellNode},canResize:function(y){if(!y.cellNode||1<y.cellNode.colSpan)return!1;y=this.grid.getCell(y.cellIndex);return!y.noresize&&y.canResize()},overLeftResizeArea:function(y){if(g.hasClass(I.body(),"dojoDndMove"))return!1;if(e("ie")){var G=y.target;if(g.hasClass(G,"dojoxGridArrowButtonNode")||g.hasClass(G,"dojoxGridArrowButtonChar")||g.hasClass(G,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?0<y.cellIndex&&0<y.cellX&&y.cellX<this.overResizeWidth&&
this.prepareResize(y,-1):y.cellNode&&0<y.cellX&&y.cellX<this.overResizeWidth},overRightResizeArea:function(y){if(g.hasClass(I.body(),"dojoDndMove"))return!1;if(e("ie")){var G=y.target;if(g.hasClass(G,"dojoxGridArrowButtonNode")||g.hasClass(G,"dojoxGridArrowButtonChar")||g.hasClass(G,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?y.cellNode&&y.cellX>=y.cellNode.offsetWidth-this.overResizeWidth:0<y.cellIndex&&y.cellX>=y.cellNode.offsetWidth-this.overResizeWidth&&this.prepareResize(y,
-1)},domousemove:function(y){if(!this.moveable){var G=this.overRightResizeArea(y)?"dojoxGridColResize":this.overLeftResizeArea(y)?"dojoxGridColResize":"";G&&!this.canResize(y)&&(G="dojoxGridColNoResize");g.toggleClass(y.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==G);g.toggleClass(y.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==G);G&&v.stop(y)}},domousedown:function(y){this.moveable||((this.overRightResizeArea(y)||this.overLeftResizeArea(y))&&this.canResize(y)?
this.beginColumnResize(y):(this.grid.onMouseDown(y),this.grid.onMouseOverRow(y)))},doclick:function(y){return this._skipBogusClicks?(v.stop(y),!0):!1},colResizeSetup:function(y,G){var f=g.contentBox(y.sourceView.headerNode);if(G){this.lineDiv=document.createElement("div");G=g.position(y.sourceView.headerNode,!0);var b=g.contentBox(y.sourceView.domNode),z=y.pageX;!this.grid.isLeftToRight()&&8>e("ie")&&(z-=w.getScrollbar().w);g.style(this.lineDiv,{top:G.y+"px",left:z+"px",height:b.h+f.h+"px"});g.addClass(this.lineDiv,
"dojoxGridResizeColLine");this.lineDiv._origLeft=z;I.body().appendChild(this.lineDiv)}G=[];b=this.tableMap.findOverlappingNodes(y.cellNode);z=0;for(var c;c=b[z];z++)G.push({node:c,index:this.getCellNodeIndex(c),width:c.offsetWidth});b=y.sourceView;c=this.grid.isLeftToRight()?1:-1;var D=y.grid.views.views;z=[];for(var F=b.idx+c,R;R=D[F];F+=c)z.push({node:R.headerNode,left:window.parseInt(R.headerNode.style.left)});c=b.headerContentNode.firstChild;return{scrollLeft:y.sourceView.headerNode.scrollLeft,
view:b,node:y.cellNode,index:y.cellIndex,w:g.contentBox(y.cellNode).w,vw:f.w,table:c,tw:g.contentBox(c).w,spanners:G,followers:z}},beginColumnResize:function(y){this.moverDiv=document.createElement("div");g.style(this.moverDiv,{position:"absolute",left:0});I.body().appendChild(this.moverDiv);g.addClass(this.grid.domNode,"dojoxGridColumnResizing");var G=this.moveable=new a(this.moverDiv),f=this.colResizeSetup(y,!0);G.onMove=K.hitch(this,"doResizeColumn",f);d.connect(G,"onMoveStop",K.hitch(this,function(){this.endResizeColumn(f);
f.node.releaseCapture&&f.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;g.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));y.cellNode.setCapture&&y.cellNode.setCapture();G.onMouseDown(y)},doResizeColumn:function(y,G,f){var b=f.l;b={deltaX:b,w:y.w+(this.grid.isLeftToRight()?b:-b),vw:y.vw+b,tw:y.tw+b};this.dragRecord={inDrag:y,mover:G,leftTop:f};b.w>=this.minColWidth&&(G?g.style(this.lineDiv,"left",this.lineDiv._origLeft+b.deltaX+"px"):this.doResizeNow(y,
b))},endResizeColumn:function(y){if(this.dragRecord){var G=this.dragRecord.leftTop;G=this.grid.isLeftToRight()?G.l:-G.l;G+=Math.max(y.w+G,this.minColWidth)-(y.w+G);e("webkit")&&y.spanners.length&&(G+=g._getPadBorderExtents(y.spanners[0].node).w);this.doResizeNow(y,{deltaX:G,w:y.w+G,vw:y.vw+G,tw:y.tw+G});delete this.dragRecord}g.destroy(this.lineDiv);g.destroy(this.moverDiv);g.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=!0;y.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(y.index)},
doResizeNow:function(y,G){y.view.convertColPctToFixed();if(y.view.flexCells&&!y.view.testFlexCells()){var f=p(y.node);f&&(f.style.width="")}var b;for(f=0;b=y.spanners[f];f++){var z=b.width+G.deltaX;0<z&&(b.node.style.width=z+"px",y.view.setColWidth(b.index,z))}if(this.grid.isLeftToRight()||!e("ie"))for(f=0;b=y.followers[f];f++)z=b.left+G.deltaX,b.node.style.left=z+"px";y.node.style.width=G.w+"px";y.view.setColWidth(y.index,G.w);y.view.headerNode.style.width=G.vw+"px";y.view.setColumnsWidth(G.tw);
this.grid.isLeftToRight()||(y.view.headerNode.scrollLeft=y.scrollLeft+G.deltaX)}});A._TableMap=K.extend(function(y){this.mapRows(y)},{map:null,mapRows:function(y){if(y.length){this.map=[];for(var G,f=0;G=y[f];f++)this.map[f]=[];for(f=0;G=y[f];f++)for(var b=0,z=0,c,D;c=G[b];b++){for(;this.map[f][z];)z++;this.map[f][z]={c:b,r:f};D=c.rowSpan||1;c=c.colSpan||1;for(var F=0;F<D;F++)for(var R=0;R<c;R++)this.map[f+F][z+R]=this.map[f][z];z+=c}}},dumpMap:function(){for(var y=0,G;G=this.map[y];y++)for(var f=
0;G[f];f++);},getMapCoords:function(y,G){for(var f=0,b;b=this.map[f];f++)for(var z=0,c;c=b[z];z++)if(c.c==G&&c.r==y)return{j:f,i:z};return{j:-1,i:-1}},getNode:function(y,G,f){return(y=y&&y.rows[G])&&y.cells[f]},_findOverlappingNodes:function(y,G,f){var b=[];G=this.getMapCoords(G,f);f=0;for(var z;z=this.map[f];f++)f!=G.j&&(z=(z=z[G.i])?this.getNode(y,z.r,z.c):null)&&b.push(z);return b},findOverlappingNodes:function(y){var G=this._findOverlappingNodes,f=p(y);var b=y.parentNode;b=0<=b.rowIndex?b.rowIndex:
J.indexOf(b.parentNode.childNodes,b);return G.call(this,f,b,0<=y.cellIndex?y.cellIndex:J.indexOf(y.parentNode.cells,y))}});return{_Builder:C,_HeaderBuilder:B,_ContentBuilder:O}})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(O,J,K){return O("dojox.grid._ViewManager",null,{constructor:function(I){this.grid=I},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(I){I.idx=
this.views.length;this.views.push(I)},destroyViews:function(){for(var I=0,v;v=this.views[I];I++)v.destroy();this.views=[]},getContentNodes:function(){for(var I=[],v=0,e;e=this.views[v];v++)I.push(e.contentNode);return I},forEach:function(I){for(var v=0,e;e=this.views[v];v++)I(e,v)},onEach:function(I,v){v=v||[];for(var e=0,d;d=this.views[e];e++)I in d&&d[I].apply(d,v)},normalizeHeaderNodeHeight:function(){for(var I=[],v=0,e;e=this.views[v];v++)e.headerContentNode.firstChild&&I.push(e.headerContentNode);
this.normalizeRowNodeHeights(I)},normalizeRowNodeHeights:function(I){var v=0,e=[];if(this.grid.rowHeight)v=this.grid.rowHeight;else{if(1>=I.length)return;for(var d=0,a;a=I[d];d++)K.contains(a,"dojoxGridNonNormalizedCell")||(e[d]=a.firstChild.offsetHeight,v=Math.max(v,e[d]));v=0<=v?v:0;(J("mozilla")||8<J("ie"))&&v&&v++}for(d=0;a=I[d];d++)e[d]!=v&&(a.firstChild.style.height=v+"px")},resetHeaderNodeHeight:function(){for(var I=0,v;v=this.views[I];I++)if(v=v.headerContentNode.firstChild)v.style.height=
""},renormalizeRow:function(I){for(var v=[],e=0,d,a;(d=this.views[e])&&(a=d.getRowNode(I));e++)a.firstChild.style.height="",v.push(a);this.normalizeRowNodeHeights(v)},getViewWidth:function(I){return this.views[I].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();this.forEach(function(v){v.headerContentNode.style.height=""});var I=0;this.forEach(function(v){I=Math.max(v.headerNode.offsetHeight,I)});return I},measureContent:function(){var I=0;this.forEach(function(v){I=
Math.max(v.domNode.offsetHeight,I)});return I},findClient:function(I){I=this.grid.elasticView||-1;if(0>I)for(var v=1,e;e=this.views[v];v++)if(e.viewWidth){for(v=1;e=this.views[v];v++)if(!e.viewWidth){I=v;break}break}0>I&&(I=Math.floor(this.views.length/2));return I},arrange:function(I,v){var e,d,a=this.views.length,w=this,t=0>=v?a:this.findClient(),g=function(h,p){var k=h.domNode.style,n=h.headerNode.style;w.grid.isLeftToRight()?(k.left=p+"px",n.left=p+"px"):(k.right=p+"px",4>J("ff")?n.right=p+h.getScrollbarWidth()+
"px":n.right=p+"px",J("webkit")||"auto"==n.width||(n.width=parseInt(n.width,10)-h.getScrollbarWidth()+"px"));k.top="0px";n.top=0};for(e=0;(d=this.views[e])&&e<t;e++){var l=this.getViewWidth(e);d.setSize(l,0);g(d,I);l=d.headerContentNode&&d.headerContentNode.firstChild?d.getColumnsWidth()+d.getScrollbarWidth():d.domNode.offsetWidth;I+=l}e++;for(var A=a-1;(d=this.views[A])&&e<=A;A--)l=this.getViewWidth(A),d.setSize(l,0),l=d.domNode.offsetWidth,v-=l,g(d,v);t<a&&(d=this.views[t],l=Math.max(1,v-I),d.setSize(l+
"px",0),g(d,I));return I},renderRow:function(I,v,e){for(var d=[],a=0,w,t;(w=this.views[a])&&(t=v[a]);a++)w=w.renderRow(I),t.appendChild(w),d.push(w);e||this.normalizeRowNodeHeights(d)},rowRemoved:function(I){this.onEach("rowRemoved",[I])},updateRow:function(I,v){for(var e=0,d;d=this.views[e];e++)d.updateRow(I);v||this.renormalizeRow(I)},updateRowStyles:function(I){this.onEach("updateRowStyles",[I])},setScrollTop:function(I){for(var v=I,e=0,d;d=this.views[e];e++)v=d.setScrollTop(I),J("ie")&&d.headerNode&&
d.scrollboxNode&&(d.headerNode.scrollLeft=d.scrollboxNode.scrollLeft);return v},getFirstScrollingView:function(){for(var I=0,v;v=this.views[I];I++)if(v.hasHScrollbar()||v.hasVScrollbar())return v;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(O,J,K){return O("dojox.grid._RowManager",null,{constructor:function(I){this.grid=I},linesToEms:2,overRow:-2,prepareStylingRow:function(I,v){return{index:I,node:v,odd:!!(I&1),selected:!!this.grid.selection.isSelected(I),
over:this.isOver(I),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(I,v){I=this.prepareStylingRow(I,v);this.grid.onStyleRow(I);this.applyStyles(I)},applyStyles:function(I){I.node.className=I.customClasses;var v=I.node.style.height,e=I.node,d=I.customStyles+";"+(I.node._style||"");void 0==e.style.cssText?e.setAttribute("style",d):e.style.cssText=d;I.node.style.height=v},updateStyles:function(I){this.grid.updateRowStyles(I)},setOverRow:function(I){var v=this.overRow;this.overRow=
I;v!=this.overRow&&(J.isString(v)||0<=v)&&this.updateStyles(v);this.updateStyles(this.overRow)},isOver:function(I){return this.overRow==I&&!K.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),function(O,J,K,I,v,e,d,a,w){return K("dojox.grid._FocusManager",null,{constructor:function(t){this.grid=
t;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(I.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(I.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(I.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(I.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));this._connects.push(I.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(I.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(I.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(I.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(I.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){O.forEach(this._connects,I.disconnect);O.forEach(this._headerConnects,I.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,
_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(t,g){return this.cell==t&&this.rowIndex==g},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===
this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?O.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(t){var g=this.cell&&this.cell.getNode(this.rowIndex);if(g&&(w.toggleClass(g,this.focusClass,t),t)){t=this.scrollIntoView();try{if(e("webkit")||!this.grid.edit.isEditing())a.fire(g,"focus"),t&&(this.cell.view.scrollboxNode.scrollLeft=
t)}catch(l){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var t=this.cell&&this.cell.getNode(this.rowIndex);if(t)try{this.grid.edit.isEditing()||(w.toggleClass(t,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),a.fire(t,"focus"))}catch(g){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){O.forEach(this._headerConnects,I.disconnect);this._headerConnects=[];for(var t=this._findHeaderCells(),g=0;g<t.length;g++)this._headerConnects.push(I.connect(t[g],
"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(I.connect(t[g],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var t=d("th",this.grid.viewsHeaderNode),g=[],l=0;l<t.length;l++){var A=t[l],h=w.hasAttr(A,"tabIndex"),p=w.attr(A,"tabIndex");h&&0>p&&g.push(A)}return g},_setActiveColHeader:function(t,g,l){this.grid.domNode.setAttribute("aria-activedescendant",t.id);null!=l&&0<=l&&l!=g&&w.toggleClass(this._findHeaderCells()[l],this.focusClass,!1);w.toggleClass(t,this.focusClass,
!0);this._colHeadNode=t;this._colHeadFocusIdx=g;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var t=this.cell?this._scrollInfo(this.cell):null;if(!t||!t.s)return null;var g=this.grid.scroller.findScrollTop(this.rowIndex);t.n&&t.sr&&(t.n.offsetLeft+t.n.offsetWidth>t.sr.l+t.sr.w?t.s.scrollLeft=t.n.offsetLeft+t.n.offsetWidth-t.sr.w:t.n.offsetLeft<t.sr.l&&(t.s.scrollLeft=t.n.offsetLeft));t.r&&t.sr&&(g+t.r.offsetHeight>t.sr.t+t.sr.h?this.grid.setScrollTop(g+t.r.offsetHeight-t.sr.h):
g<t.sr.t&&this.grid.setScrollTop(g));return t.s.scrollLeft},_scrollInfo:function(t,g){if(t){var l=t.view.scrollboxNode,A={w:l.clientWidth,l:l.scrollLeft,t:l.scrollTop,h:l.clientHeight},h=t.view.getRowNode(this.rowIndex);return{c:t,s:l,sr:A,n:g?g:t.getNode(this.rowIndex),r:h}}return null},_scrollHeader:function(t){var g=null;if(this._colHeadNode){var l=this.grid.getCell(t);if(!l)return;g=this._scrollInfo(l,l.getNode(0))}g&&g.s&&g.sr&&g.n&&(g.n.offsetLeft+g.n.offsetWidth>g.sr.l+g.sr.w?g.s.scrollLeft=
g.n.offsetLeft+g.n.offsetWidth-g.sr.w:g.n.offsetLeft<g.sr.l?g.s.scrollLeft=g.n.offsetLeft:7>=e("ie")&&l&&l.view.headerNode&&(l.view.headerNode.scrollLeft=g.s.scrollLeft))},_isHeaderHidden:function(){var t=this.focusView;if(!t)for(var g=0,l;l=this.grid.views.views[g];g++)if(l.headerNode){t=l;break}return t&&"none"==w.getComputedStyle(t.headerNode).display},colSizeAdjust:function(t,g,l){var A=this._findHeaderCells(),h=this.focusView;if(!h||!h.header.tableMap.map)for(var p=0,k;k=this.grid.views.views[p];p++)if(k.header.tableMap.map){h=
k;break}p=A[g];!h||g==A.length-1&&0===g||(h.content.baseDecorateEvent(t),t.cellNode=p,t.cellIndex=h.content.getCellNodeIndex(t.cellNode),t.cell=0<=t.cellIndex?this.grid.getCell(t.cellIndex):null,h.header.canResize(t)&&(g={l:l},t=h.header.colResizeSetup(t,!1),h.header.doResizeColumn(t,null,g),h.update()))},styleRow:function(t){},setFocusIndex:function(t,g){this.setFocusCell(this.grid.getCell(g),t)},setFocusCell:function(t,g){t&&!this.isFocusCell(t,g)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),
this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=t,this.rowIndex=g,this._focusifyCellNode(!0));if(e("opera"))setTimeout(J.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var t=this.rowIndex,g=this.cell.index+1,l=this.grid.layout.cellCount-1,A=this.grid.rowCount-1;g>l&&(g=0,t++);t>A&&(g=l,t=A);if(this.grid.edit.isEditing()&&(l=this.grid.getCell(g),!this.isLastFocusCell()&&
(!l.editable||this.grid.canEdit&&!this.grid.canEdit(l,t)))){this.cell=l;this.rowIndex=t;this.next();return}this.setFocusIndex(t,g)}},previous:function(){if(this.cell){var t=this.rowIndex||0,g=(this.cell.index||0)-1;0>g&&(g=this.grid.layout.cellCount-1,t--);0>t&&(g=t=0);if(this.grid.edit.isEditing()){var l=this.grid.getCell(g);if(!this.isFirstFocusCell()&&!l.editable){this.cell=l;this.rowIndex=t;this.previous();return}}this.setFocusIndex(t,g)}},move:function(t,g){var l=0>g?-1:1;if(this.isNavHeader()){t=
this._findHeaderCells();var A=currentIdx=O.indexOf(t,this._colHeadNode);for(currentIdx+=g;0<=currentIdx&&currentIdx<t.length&&"none"==t[currentIdx].style.display;)currentIdx+=l;0<=currentIdx&&currentIdx<t.length&&this._setActiveColHeader(t[currentIdx],currentIdx,A)}else if(this.cell){var h=this.grid.scroller;A=this.rowIndex;var p=this.grid.rowCount-1,k=Math.min(p,Math.max(0,A+t));t&&(0<t?k>h.getLastPageRow(h.page)&&this.grid.setScrollTop(this.grid.scrollTop+h.findScrollTop(k)-h.findScrollTop(A)):
0>t&&k<=h.getPageRow(h.page)&&this.grid.setScrollTop(this.grid.scrollTop-h.findScrollTop(A)-h.findScrollTop(k)));h=this.grid.layout.cellCount-1;for(var n=this.cell.index,m=Math.min(h,Math.max(0,n+g)),C=this.grid.getCell(m);0<=m&&m<h&&C&&!0===C.hidden;)m+=l,C=this.grid.getCell(m);C&&!0!==C.hidden||(m=n);l=C.getNode(k);!l&&t?0<=k+t&&k+t<=p&&this.move(0<t?++t:--t,g):l&&"none"!==w.style(l,"display")||!g?(this.setFocusIndex(k,m),t&&this.grid.updateRow(A)):0<=m+g&&m+g<=h&&this.move(t,0<g?++g:--g)}},previousKey:function(t){this.grid.edit.isEditing()?
(v.stop(t),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(w.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),v.stop(t))},nextKey:function(t){t.target===this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),v.stop(t)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),
this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(v.stop(t),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(t){this.tabbingOut=!0;t.focus()},focusGridView:function(){a.fire(this.focusView,"focus")},focusGrid:function(t){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var t=!0,g=0===this.grid.rowCount;this.isNoFocusCell()&&!g?(g=0,this.grid.getCell(g).hidden&&(g=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,
g)):this.cell&&!g?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):t=!1;this._colHeadNode=this._colHeadFocusIdx=null;return t},focusHeader:function(){var t=this._findHeaderCells(),g=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=t[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&
this._colHeadFocusIdx<t.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=t[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,g),this._scrollHeader(this._colHeadFocusIdx),
this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){w.removeClass(this._colHeadNode,this.focusClass);w.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var t=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(t);this._contextMenuBindNode=t}},doFocus:function(t){t&&t.target!=t.currentTarget?v.stop(t):this._clickFocus||(this.tabbingOut||this.focusHeader(),
this.tabbingOut=!1,v.stop(t))},doBlur:function(t){v.stop(t)},doContextMenu:function(t){this.headerMenu||v.stop(t)},doLastNodeFocus:function(t){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;v.stop(t)},doLastNodeBlur:function(t){v.stop(t)},doColHeaderFocus:function(t){this._setActiveColHeader(t.target,w.attr(t.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());
v.stop(t)},doColHeaderBlur:function(t){w.toggleClass(t.target,this.focusClass,!1)},_mouseDown:function(t){this._clickFocus=dojo.some(this.grid.views.views,function(g){return g.scrollboxNode===t.target})},_mouseUp:function(t){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),function(O,J,K,I,v,e){return K("dojox.grid._EditManager",null,{constructor:function(d){this.grid=d;
this.connections=v("ie")?[I.connect(document.body,"onfocus",O.hitch(this,"_boomerangFocus"))]:[];this.connections.push(I.connect(this.grid,"onBlur",this,"apply"));this.connections.push(I.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){J.forEach(this.connections,I.disconnect)},cellFocus:function(d,a){this.grid.singleClickEdit||this.isEditRow(a)?this.setEditCell(d,a):this.apply();(this.isEditing()||d&&d.editable&&d.alwaysEditing)&&this._focusEditor(d,a)},rowClick:function(d){this.isEditing()&&
!this.isEditRow(d.rowIndex)&&this.apply()},styleRow:function(d){d.index==this.info.rowIndex&&(d.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(d){var a=d.cell;return(a=a&&a.editable?a:0)&&a.dispatchEvent(d.dispatch,d)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(d,a){return this.info.rowIndex===d&&this.info.cell.index==a},isEditRow:function(d){return this.info.rowIndex===d},setEditCell:function(d,a){!this.isEditCell(a,d.index)&&this.grid.canEdit&&this.grid.canEdit(d,
a)&&this.start(d,a,this.isEditRow(a)||d.editable)},_focusEditor:function(d,a){e.fire(d,"focus",[a])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){v("ie")&&(this._catchBoomerang=(new Date).getTime()+
this._boomerangWindow)},start:function(d,a,w){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(a)&&(this.applyRowEdit(),this.grid.updateRow(a)),w?(this.info={cell:d,rowIndex:a},this.grid.doStartEdit(d,a),this.grid.updateRow(a)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(d,a),this._doCatchBoomerang())},_editorDo:function(d){var a=this.info.cell;if(a&&a.editable)a[d](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},
editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(d,a,w){this.grid.canEdit(a,w)&&this.grid.doApplyCellEdit(d,w,a.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),
this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(d,a){var w=this.info.cell;!this.isEditRow(d)||a&&w.view!=a||!w.editable||w.save(w,this.info.rowIndex)},restore:function(d,a){var w=this.info.cell;this.isEditRow(a)&&w.view==d&&w.editable&&w.restore(this.info.rowIndex)},_isValidInput:function(){var d=(this.info.cell||{}).widget;if(!d||!d.isValid)return!0;d.focused=!0;return d.isValid(!0)},_onPreRender:function(){this.isEditing()&&
(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(O,J,K,I){return O("dojox.grid.Selection",null,{constructor:function(v){this.grid=v;this.selected=[];this.setMode(v.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(v){this.selected.length&&this.deselectAll();this.mode="extended"!=v&&"multiple"!=v&&"single"!=v&&"none"!=
v?"extended":v},onCanSelect:function(v){return this.grid.onCanSelect(v)},onCanDeselect:function(v){return this.grid.onCanDeselect(v)},onSelected:function(v){},onDeselected:function(v){},onChanging:function(){},onChanged:function(){},isSelected:function(v){return"none"==this.mode?!1:this.selected[v]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var v=0,e=this.selected.length;v<e;v++)if(this.selected[v])return v;return-1},getNextSelected:function(v){if("none"==
this.mode)return-1;v+=1;for(var e=this.selected.length;v<e;v++)if(this.selected[v])return v;return-1},getSelected:function(){for(var v=[],e=0,d=this.selected.length;e<d;e++)this.selected[e]&&v.push(e);return v},getSelectedCount:function(){for(var v=0,e=0;e<this.selected.length;e++)this.selected[e]&&v++;return v},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},select:function(v){"none"!=this.mode&&
("multiple"!=this.mode?(this.deselectAll(v),this.addToSelection(v)):this.toggleSelect(v))},addToSelection:function(v){if("none"!=this.mode)if(K.isArray(v))J.forEach(v,this.addToSelection,this);else if(v=Number(v),this.selected[v])this.selectedIndex=v;else if(!1!==this.onCanSelect(v)){this.selectedIndex=v;var e=this.grid.getRowNode(v);e&&I.set(e,"aria-selected","true");this._beginUpdate();this.selected[v]=!0;this.onSelected(v);this._endUpdate()}},deselect:function(v){if("none"!=this.mode)if(K.isArray(v))J.forEach(v,
this.deselect,this);else if(v=Number(v),this.selectedIndex==v&&(this.selectedIndex=-1),this.selected[v]&&!1!==this.onCanDeselect(v)){var e=this.grid.getRowNode(v);e&&I.set(e,"aria-selected","false");this._beginUpdate();delete this.selected[v];this.onDeselected(v);this._endUpdate()}},setSelected:function(v,e){this[e?"addToSelection":"deselect"](v)},toggleSelect:function(v){K.isArray(v)?J.forEach(v,this.toggleSelect,this):this.setSelected(v,!this.selected[v])},_range:function(v,e,d){var a=0<=v?v:e;
v=e;a>v&&(v=a,a=e);for(e=a;e<=v;e++)d(e)},selectRange:function(v,e){this._range(v,e,K.hitch(this,"addToSelection"))},deselectRange:function(v,e){this._range(v,e,K.hitch(this,"deselect"))},insert:function(v){this.selected.splice(v,0,!1);this.selectedIndex>=v&&this.selectedIndex++},remove:function(v){this.selected.splice(v,1);this.selectedIndex>=v&&this.selectedIndex--},deselectAll:function(v){for(var e in this.selected)e!=v&&!0===this.selected[e]&&this.deselect(e)},clickSelect:function(v,e,d){if("none"!=
this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(v);else{if(!d||0>this.rangeStartIndex)this.rangeStartIndex=v;e||this.deselectAll(v);d?this.selectRange(this.rangeStartIndex,v):e?this.toggleSelect(v):this.addToSelection(v)}this._endUpdate()}},clickSelectEvent:function(v){this.clickSelect(v.rowIndex,dojo.isCopyKey(v),v.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver",
"./Selection"],function(O,J,K){return O("dojox.grid.DataSelection",K,{constructor:function(I){I.keepSelection&&(this.preserver=new J(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var I=K.prototype.getFirstSelected.call(this);return-1==I?null:this.grid.getItem(I)},getNextSelected:function(I){I=this.grid.getItemIndex(I);I=K.prototype.getNextSelected.call(this,I);return-1==I?null:this.grid.getItem(I)},getSelected:function(){for(var I=[],v=0,e=this.selected.length;v<
e;v++)this.selected[v]&&I.push(this.grid.getItem(v));return I},addToSelection:function(I){if("none"!=this.mode){var v=null;v="number"==typeof I||"string"==typeof I?I:this.grid.getItemIndex(I);K.prototype.addToSelection.call(this,v)}},deselect:function(I){if("none"!=this.mode){var v=null;v="number"==typeof I||"string"==typeof I?I:this.grid.getItemIndex(I);K.prototype.deselect.call(this,v)}},deselectAll:function(I){var v=null;I||"number"==typeof I?(v="number"==typeof I||"string"==typeof I?I:this.grid.getItemIndex(I),
K.prototype.deselectAll.call(this,v)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(O,J,K,I){return O("dojox.grid._SelectionPreserver",null,{constructor:function(v){this.selection=v;var e=this.grid=v.grid;this.reset();this._connects=[J.connect(e,"_setStore",this,"reset"),J.connect(e,"_addItem",this,"_reSelectById"),J.connect(v,"onSelected",K.hitch(this,"_selectById",!0)),
J.connect(v,"onDeselected",K.hitch(this,"_selectById",!1)),J.connect(v,"deselectAll",this,"reset")]},destroy:function(){this.reset();I.forEach(this._connects,J.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(v,e){v&&this.grid._hasIdentity&&(this.selection.selected[e]=this._selectedById[this.grid.store.getIdentity(v)])},_selectById:function(v,e){if("none"!=this.selection.mode&&this.grid._hasIdentity){var d=e,a=this.grid;if("number"==typeof e||"string"==
typeof e)d=(e=a._by_idx[e])&&e.item;d&&(this._selectedById[a.store.getIdentity(d)]=!!v);return d}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(O,J,K,I,v,e,d,a,w,t,g){O=O([d,a],{declaredClass:"esri.dijit.editing.TemplatePickerItem",templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",
startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(l,A,h,p,k){if(A&&"textsymbol"!==A.type){l=w.createSurface(l,h,p);if(9>I("ie")){var n=l.getEventSource();e.set(n,"position","relative");e.set(n.parentNode,"position","relative")}A=!this.legendOverride&&this._getDrawingToolShape(A,k)||t.getShapeDescriptors(A);try{var m=l.createShape(A.defaultShape).setFill(A.fill).setStroke(A.stroke)}catch(y){l.clear();
l.destroy();return}var C=m.getBoundingBox();A=C.width;k=C.height;n=-(C.x+A/2);C=-(C.y+k/2);var B=l.getDimensions();n={dx:n+B.width/2,dy:C+B.height/2};if(A>h||k>p)C=A/h>k/p,h=((C?h:p)-5)/(C?A:k),J.mixin(n,{xx:h,yy:h});m.applyTransform(n);return l}},_getDrawingToolShape:function(l,A){switch(A?A.drawingTool||null:null){case "esriFeatureEditToolArrow":A={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":A={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};
break;case "esriFeatureEditToolRightArrow":A={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":A={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};break;case "esriFeatureEditToolDownArrow":A={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":A={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":A=
{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":A={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":A={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":A="simplelinesymbol"===l.type||"cartographiclinesymbol"===l.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:
{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:A,fill:l.getFill(),stroke:l.getStroke()}},_repaint:function(l){l?(l.getStroke&&l.setStroke&&l.setStroke(l.getStroke()),l.getFill&&l.setFill&&l.setFill(l.getFill()),l.children&&J.isArray(l.children)&&K.forEach(l.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
I("extend-esri")&&J.setObject("dijit.editing.TemplatePickerItem",O,g);return O})},"widgets/CostAnalysis/scenario-selection":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./scenario-selection.html dojo/_base/array dojo/_base/lang dojo/store/Memory dojo/dom-class".split(" "),function(O,J,K,I,v,e,d,a,w){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-scenario-selection",postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._init()},_init:function(){this.regionNameTextBox.set("value",this.regionName);this._setScenarioOptions()},_setScenarioOptions:function(){var t=[];e.forEach(this.scenarioOptions,d.hitch(this,function(l){t.push({name:l.scenario,value:l.scenario,featureTemplate:this.templateName,geographyGlobalID:this.geographyGlobalID,costEquation:l.costEquation})}));var g=new a({idProperty:"value",data:t});this.scenarioDropDown.set("labelAttr","name");this.scenarioDropDown.set("store",
g);this.scenarioDropDown.set("value",this.nls.scenarioSelection.noneText);this.costingGeometryLayer?w.remove(this.regionDetailsParentContainer,"esriCTHidden"):w.add(this.regionDetailsParentContainer,"esriCTHidden")}})})},"widgets/CostAnalysis/copy-features":function(){define("dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on jimu/dijit/CheckBox dojo/dom-class dojo/dom-attr ./highlightSymbolUtils esri/layers/GraphicsLayer dojo/text!./copy-features.html jimu/utils dijit/focus dojo/keys dojo/query dojo/_base/event esri/tasks/query esri/tasks/QueryTask dojo/Deferred dojo/promise/all".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f){return K([O,I,J],{templateString:h,layerLabel:null,featuresList:null,checkBoxNodes:{},layerCheckBoxNodes:{},featuresByLayerId:{},featureTitlesByLayerId:{},_highlightGraphicsLayer:null,startup:function(){this.inherited(arguments);this._highlightGraphicsLayer=this._createNewGraphicsLayer("highlightGraphicsLayer");this.toggleWorkBenchDOMTabindexes("-1")},postCreate:function(){this.checkBoxNodes={};this.layerCheckBoxNodes={};this.featuresByLayerId=
{};this.featureTitlesByLayerId={};this._highlightGraphicsLayer=null;this.own(a(this.cancelBtn,"click",v.hitch(this,function(){this.cancelBtnClicked();this.toggleWorkBenchDOMTabindexes("0");this.emit("cancelBtnClicked")})));this.own(a(this.cancelBtn,"keydown",v.hitch(this,function(b){if(b.keyCode===n.ENTER||b.keyCode===n.SPACE)C.stop(b),this.cancelBtnClicked(),this.toggleWorkBenchDOMTabindexes("0"),this.emit("cancelBtnClicked")})));this.own(a(this.createMultipleFeaturesBtn,"click",v.hitch(this,this._createMultipleFeaturesBtnClicked)));
this.own(a(this.createMultipleFeaturesBtn,"keydown",v.hitch(this,function(b){if(b.keyCode===n.ENTER||b.keyCode===n.SPACE)C.stop(b),this._createMultipleFeaturesBtnClicked()})));this.own(a(this.createSingleFeatureBtn,"click",v.hitch(this,this._createSingleFeatureBtnClicked)));this.own(a(this.createSingleFeatureBtn,"keydown",v.hitch(this,function(b){if(b.keyCode===n.ENTER||b.keyCode===n.SPACE)C.stop(b),this._createSingleFeatureBtnClicked()})))},toggleWorkBenchDOMTabindexes:function(b){m(".esriCTWorkBenchDOM",
this.widgetDomNode).forEach(v.hitch(this,function(z){g.set(z,"tabindex",b)}))},selectFeaturesToCopy:function(b){if(b&&0<b.length){this.checkBoxNodes={};this.layerCheckBoxNodes={};this.featuresByLayerId={};this.featureTitlesByLayerId={};this._showHideSingleFeatureButton(b[0]._layer.geometryType);t.remove(this.mainNode,"esriCTHidden");var z=new G;this._processSelectedFeatures(b,z).then(v.hitch(this,function(){d.empty(this.layerListTable);for(var c in this.featureTitlesByLayerId){var D=this.layerInfosObj.getLayerInfoById(c);
D=D.title?D.title:D.name;var F=d.create("div",{},this.layerListTable);this.layerCheckBoxNodes[c]=this._createListNode(D,F,!1,c);this.checkBoxNodes[c]||(this.checkBoxNodes[c]=[]);0<this.featureTitlesByLayerId[c].length&&this._createFeatureEntries(c,F)}this._highlightFeatures()}))}this._setFirstAndLastFocusNodes()},_processSelectedFeatures:function(b,z){var c={},D,F;this.featuresByLayerId={};this.featureTitlesByLayerId={};e.forEach(b,v.hitch(this,function(R){this.featuresByLayerId[R._layer.id]||(this.featuresByLayerId[R._layer.id]=
[],this.featureTitlesByLayerId[R._layer.id]=[]);this.featuresByLayerId[R._layer.id].push(R);this.featureTitlesByLayerId[R._layer.id].push(R.getTitle())}));for(F in this.featuresByLayerId)F&&(b=this._getObjectIdFieldOfLayer(F),b=this._getSelectedFeatureObjectIds(this.featuresByLayerId[F],b),c[F]=this._getSelectedFeatureGeometry(F,b));f(c).then(v.hitch(this,function(R){for(D in R)D&&this._updateGeometryForSelectedFeature(D,R)}),v.hitch(this,function(){this.appUtils.showMessage(this.nls.copyFeatures.copyFeatureUpdateGeometryError)}));
return z.resolve(null)},_getObjectIdFieldOfLayer:function(b){return this.layerInfosObj.getLayerInfoById(b).layerObject.objectIdField},_updateGeometryForSelectedFeature:function(b,z){var c=this._getObjectIdFieldOfLayer(b);e.forEach(this.featuresByLayerId[b],v.hitch(this,function(D){e.forEach(z[b].features,v.hitch(this,function(F){F.attributes[c]===D.attributes[c]&&(D.geometry=F.geometry)}))}))},_getSelectedFeatureObjectIds:function(b,z){var c=[];e.forEach(b,v.hitch(this,function(D){c.push(D.attributes[z])}));
return c},_getSelectedFeatureGeometry:function(b,z){var c=this.layerInfosObj.getLayerInfoById(b);b=new y(c.getUrl());var D=new B;D.outFields=[c.layerObject.objectIdField];D.objectIds=z;D.returnGeometry=!0;D.outSpatialReference=this.map.spatialReference;return b.execute(D).promise},_createFeatureEntries:function(b,z){e.forEach(this.featureTitlesByLayerId[b],v.hitch(this,function(c){c=this._createListNode(c,z,!0,b);this.checkBoxNodes[b].push(c)}))},_createListNode:function(b,z,c,D){z=d.create("div",
{"class":"jimu-widget-row esriCTCopyFeaturesNode"},z);var F=d.create("div",{"class":"jimu-float-leading checkBoxNode"},z);b=new w({label:b,checked:!0},F);c?(t.add(z,"esriCTCopyFeaturesChildNode"),g.set(b.domNode,"parentLayerId",D),a(b.domNode,"click",v.hitch(this,this._childNodeStateChanged)),a(b.domNode,"keydown",v.hitch(this,function(R){R.keyCode!==n.ENTER&&R.keyCode!==n.SPACE||this._childNodeStateChanged(R)}))):(g.set(b.domNode,"layerId",D),a(b.domNode,"click",v.hitch(this,this._parentNodeStateChanged)),
a(b.domNode,"keydown",v.hitch(this,function(R){R.keyCode!==n.ENTER&&R.keyCode!==n.SPACE||this._parentNodeStateChanged(R)})));return b},_parentNodeStateChanged:function(b){b=g.get(b.currentTarget,"layerId");var z=this.checkBoxNodes[b],c=this.layerCheckBoxNodes[b].getValue();e.forEach(z,v.hitch(this,function(D){c?D.setValue(!0):D.setValue(!1)}));this._highlightFeatures()},_childNodeStateChanged:function(b){var z=g.get(b.currentTarget,"parentLayerId");b=this.layerCheckBoxNodes[z];z=this.checkBoxNodes[z];
var c=!0;this._highlightFeatures();e.some(z,v.hitch(this,function(D){if(!D.getValue())return c=!1,!0}));b.setValue(c)},cancelBtnClicked:function(){t.add(this.mainNode,"esriCTHidden");this._highlightGraphicsLayer.clear()},_createMultipleFeaturesBtnClicked:function(){var b=[],z;(z=this._getSelectedFeaturesForCopy())&&0<z.length&&(e.forEach(z,v.hitch(this,function(c){c&&c.geometry&&b.push(c.geometry)})),this.emit("createMultipleFeatures",b))},_createSingleFeatureBtnClicked:function(){var b;(b=this._getSelectedFeaturesForCopy())&&
0<b.length&&this.emit("createSingleFeature",b)},_validateSelectedFeature:function(b){(!b||0>=b.length)&&this.appUtils.showMessage(this.nls.copyFeatures.selectFeatureToCopyMessage)},_getSelectedFeaturesForCopy:function(){var b,z=[];for(b in this.featuresByLayerId){var c=this._getSelectedFeaturesByLayerId(b);0<c.length&&(z=z.concat(c))}this._validateSelectedFeature(z);return z},_getSelectedFeaturesByLayerId:function(b){var z=[];e.forEach(this.checkBoxNodes[b],v.hitch(this,function(c,D){c.getValue()&&
z.push(this.featuresByLayerId[b][D])}));return z},_showHideSingleFeatureButton:function(b){"esriGeometryPoint"===b?(t.add(this.createSingleFeatureBtn,"esriCTHidden"),g.set(this.createSingleFeatureBtn,"tabindex","-1")):(t.remove(this.createSingleFeatureBtn,"esriCTHidden"),g.set(this.createSingleFeatureBtn,"tabindex","0"))},_createNewGraphicsLayer:function(b){var z={};if(b+=this.widgetId)this.map._layers[b]&&this.map.removeLayer(this.map._layers[b]),z={id:b};b=new A(z);this.map.addLayer(b);return b},
_highlightFeatures:function(){this._highlightGraphicsLayer.clear();for(var b in this.featureTitlesByLayerId)this._highlightSingleLayerFeatures(b)},_highlightSingleLayerFeatures:function(b){var z=this.map.getLayer(b);b=this._getSelectedFeaturesByLayerId(b);e.forEach(b,v.hitch(this,function(c){c=l.getHighLightSymbol(c,z);this._highlightGraphicsLayer.add(c)}))},_setFirstAndLastFocusNodes:function(){var b=m(".jimu-checkbox",this.domNode);b.length&&(k.focus(b[0]),p.initFirstFocusNode(this.widgetDomNode,
b[0]));p.initLastFocusNode(this.widgetDomNode,this.cancelBtn)}})})},"widgets/CostAnalysis/highlightSymbolUtils":function(){define("dojo/_base/lang dojo/_base/array esri/geometry/Point esri/geometry/Polygon esri/geometry/Polyline esri/graphic esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color".split(" "),function(O,J,K,I,v,e,d,a,w,t){var g={getHighLightSymbol:function(l,A){switch(l.geometry.type){case "point":return g._getPointSymbol(l,A);case "polyline":return g._getPolyLineSymbol(l,
A);case "polygon":return g._getPolygonSymbol(l,A)}},_getSizeInfo:function(l){var A=null;l.renderer.visualVariables&&J.forEach(l.renderer.visualVariables,O.hitch(this,function(h){"sizeInfo"===h.type&&(A=h)}));return A},_getPointSymbol:function(l,A){var h,p;var k=!1;var n=new d(d.STYLE_SQUARE,null,new a(a.STYLE_SOLID,new t([0,255,255,1]),3));n.setColor(null);n.size=30;if(A&&A.renderer)if(A.renderer.symbol)k=!0,n=g._updatePointSymbolProperties(n,A.renderer.symbol);else if(A.renderer.infos&&0<A.renderer.infos.length){for(p=
0;p<A.renderer.infos.length;p++){A.typeIdField?h=l.attributes[A.typeIdField]:A.renderer.attributeField&&(h=l.attributes[A.renderer.attributeField]);var m=A.renderer.infos[p].value;void 0!==h&&null!==h&&""!==h&&void 0!==m&&null!==m&&""!==m&&h.toString()===m.toString()&&(k=!0,n=g._updatePointSymbolProperties(n,A.renderer.infos[p].symbol))}!k&&A.renderer.defaultSymbol&&(k=!0,n=g._updatePointSymbolProperties(n,A.renderer.defaultSymbol))}A&&A.graphics&&0<A.graphics.length&&A._getSymbol(l)&&((h=l.getShape())&&
h.shape?h.shape.hasOwnProperty("r")?(k=!0,n.size=2*h.shape.r+10):h.shape.hasOwnProperty("width")&&(k=!0,A.renderer&&A.renderer.infos&&0<A.renderer.infos.length&&(n=g._updatePointSymbolProperties(n,A.renderer.infos[0].symbol)),n.size=h.shape.width+10):A.renderer.visualVariables&&(k=A._getRenderer(l),h=g._getSizeInfo(A))&&(A=k.getSize(l,{sizeInfo:h,shape:A._getSymbol(l),resolution:A&&A.getResolutionInMeters&&A.getResolutionInMeters()}),null!==A&&(n.size=A+10)));A=new K(l.geometry.x,l.geometry.y,l.geometry.spatialReference);
return new e(A,n,l.attributes)},_updatePointSymbolProperties:function(l,A){if(A.hasOwnProperty("height")&&A.hasOwnProperty("width")){var h=A.height;var p=A.width;h=(h>p?h:p)+10;l.size=h}A.hasOwnProperty("size")&&(!h||h<A.size)&&(l.size=A.size+10);A.hasOwnProperty("xoffset")&&(l.xoffset=A.xoffset);A.hasOwnProperty("yoffset")&&(l.yoffset=A.yoffset);return l},_getPolyLineSymbol:function(l,A){var h,p;var k=5;if(A&&A.renderer)if(A.renderer.symbol&&A.renderer.symbol.hasOwnProperty("width"))k=A.renderer.symbol.width;
else if(A.renderer.infos&&0<A.renderer.infos.length)for(p=0;p<A.renderer.infos.length;p++){A.typeIdField?h=l.attributes[A.typeIdField]:A.renderer.attributeField&&(h=l.attributes[A.renderer.attributeField]);var n=A.renderer.infos[p].value;void 0!==h&&null!==h&&""!==h&&void 0!==n&&null!==n&&""!==n&&h.toString()===n.toString()&&A.renderer.infos[p].symbol.hasOwnProperty("width")&&(k=A.renderer.infos[p].symbol.width)}else A.renderer.defaultSymbol&&A.renderer.defaultSymbol.hasOwnProperty("width")&&(k=A.renderer.defaultSymbol.width);
A=new a(a.STYLE_SOLID,new t([0,255,255,1]),k);var m=new v(l.geometry.spatialReference);l.geometry.paths&&0<l.geometry.paths.length&&J.forEach(l.geometry.paths,function(C){m.addPath(C)});return new e(m,A,l.attributes)},_getPolygonSymbol:function(l){var A=new w(w.STYLE_SOLID,new a(a.STYLE_SOLID,new t([0,255,255,1]),4),new t([0,0,0,0]));var h=new I(l.geometry.spatialReference);l.geometry.rings&&(h.rings=O.clone(l.geometry.rings));return new e(h,A,l.attributes)}};return g})},"widgets/CostAnalysis/project-overview":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./project-overview.html dojo/_base/lang dojo/_base/array dojo/dom-attr dojo/dom-class dojo/string dojo/on dojo/Deferred esri/graphic esri/geometry/Point esri/tasks/BufferParameters esri/geometry/geometryEngine esri/tasks/GeometryService esri/geometry/Polygon dojo/dom-construct jimu/dijit/LoadingIndicator ./advance-item-list jimu/utils dijit/focus".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-project-overview",postCreate:function(){this.inherited(arguments);this.listData=[{title:this.nls.projectOverview.assetItemsTitle,content:this.assetSummaryInfo,icon:"",actionIcon:"",isOpen:!0},{title:this.nls.projectOverview.assetStatisticsTitle,content:"",icon:"",actionIcon:"",actionIconTitle:"",isOpen:!1}];this.config.projectSettings.projectLayer&&(this.projectLayer=this.layerInfosObj.getLayerInfoById(this.config.projectSettings.projectLayer).layerObject,
this.updateProjectInfo(this.projectInfo),this.listData.push({title:this.nls.projectOverview.projectSummaryTitle,content:this.projectSummaryInfo,icon:"",actionIcon:"",actionIconTitle:this.nls.projectAttribute.projectAttributeText,isOpen:!1}));this._initLoadingIndicator()},updateProjectInfo:function(b){this.projectInfo=b;this.config.projectSettings.projectLayer&&(b=t.substitute(this.nls.projectOverview.projectName,{name:this.projectInfo.name}),a.set(this.projectNameDiv,"innerHTML",b),a.set(this.projectNameDiv,
"title",b),a.set(this.projectNameDiv,"aria-label",b),w.contains(this.projectNameDiv,"esriCTHidden")&&(w.remove(this.projectNameDiv,"esriCTHidden"),setTimeout(e.hitch(this,function(){G.initFirstFocusNode(this.widgetDomNode,this.projectNameDiv);f.focus(this.projectNameDiv)}),0)))},_initLoadingIndicator:function(){this._loadingIndicator=new B({hidden:!0});this._loadingIndicator.placeAt(this.domNode.parentNode.parentNode.parentNode);this._loadingIndicator.startup()},startup:function(){this.inherited(arguments);
this.projectInfo&&""===this.projectInfo.name&&(a.set(this.projectNameDiv,"title",""),a.set(this.projectNameDiv,"tabindex","-1"),w.contains(this.projectNameDiv,"esriCTHidden")||(w.add(this.projectNameDiv,"esriCTHidden"),setTimeout(e.hitch(this,function(){G.initFirstFocusNode(this.widgetDomNode,this.featureModeTextNode);f.focus(this.featureModeTextNode)}),0)));this._initProjectOverview()},_initProjectOverview:function(){var b=new y({itemList:this.listData,showArrow:!0,togglePanels:!1,openMultiple:!0,
widgetDomNode:this.widgetDomNode,fromProjectOverview:!0,nls:this.nls},C.create("div",{},this.projectOverviewNode));this.own(g(b,"onActionButtonClicked",e.hitch(this,function(c){this.emit("actionClicked",c)})));this.own(g(b,"onTitleClicked",e.hitch(this,function(c){this.emit("titleClicked",c)})));b.startup();b=this.totalCostLabel.innerHTML.replace("*",this.nls.projectOverview.roundingLabel);var z=this.grossCostLabel.innerHTML.replace("*",this.nls.projectOverview.roundingLabel);a.set(this.totalCostLabel,
"aria-label",b.replace("*",""));a.set(this.grossCostLabel,"aria-label",z.replace("*",""))},showAssetItemSummary:function(b,z){var c=0;C.empty(this.assetSummaryDiv);if(0<Object.keys(b).length){var D,F;var R=C.create("div",{},this.assetSummaryDiv);R=C.create("table",{style:{width:"100%"},"class":"esriCTTable"},R);R=C.create("tbody",{},R);for(D in b){var N=C.create("tr",{},R);C.create("td",{innerHTML:b[D].layerName,"class":"esriCTSummaryLayerTitle",colspan:3},N);for(F in b[D].templates){var r=b[D].templates[F];
var E=r.units;N=C.create("tr",{tabindex:"0"},R);if("esriGeometryPoint"!==b[D].geometryType){E=this.appUtils.applyRounding(E);var q=this.appUtils.getUnitsAbbreviation(b[D].geometryType,this.config.generalSettings.measurementUnit)}else q=this.nls.workBench.units;C.create("td",{innerHTML:F},N);C.create("td",{innerHTML:E+" "+q},N);C.create("td",{"class":"esriCTAssetItemsCost",innerHTML:this.config.generalSettings.currency+" "+this.appUtils.applyRounding(r.cost)},N);E=b[D].layerName+" "+F+" "+E+" "+q+
" "+this.config.generalSettings.currency+" "+this.appUtils.applyRounding(r.cost);a.set(N,"aria-label",E);c+=r.cost}}}else C.create("div",{style:"padding: 10px 0; text-align : center; font-weight : bold",innerHTML:this.nls.workBench.noAssetAddedMsg,tabindex:"0","aria-label":this.nls.workBench.noAssetAddedMsg,role:"presentation"},this.assetSummaryDiv);this._updateProjectCost(c);z&&this._getProjectBoundary(b)},grossCostUpdated:function(b){var z=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,
b);z=this.config.generalSettings.currency+" "+z;a.set(this.grossCost,"innerHTML",z);a.set(this.grossCost,"aria-label",z);this._saveProjectAttributes(this._projectTotalCost,b)},_updateProjectCost:function(b){this._projectTotalCost=b;b=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,this._projectTotalCost);b=this.config.generalSettings.currency+" "+b;a.set(this.totalCost,"innerHTML",b);this.emit("totalCostCalculated",this._projectTotalCost)},_getProjectBoundary:function(b){0===
Object.keys(b).length?this._saveProjectGeometry(new m):(this._loadingIndicator.show(),"outline"===this.config.generalSettings.projectAreaType?(b=this._convertFeatureStoredToPoints(b),this.geometryService.convexHull(b,e.hitch(this,function(z){this._loadingIndicator.hide();this._onConvexHullComplete(z)}),e.hitch(this,function(){this._loadingIndicator.show()}))):this._createBufferOnAssets(b).then(e.hitch(this,function(z){this._loadingIndicator.hide();z&&this._saveProjectGeometry(z)})))},_convertFeatureStoredToPoints:function(b){var z=
[],c;for(c in b)if(b.hasOwnProperty(c)){var D=b[c].templates;for(v in D)D=b[c].templates[v].features,z=z.concat(this._getFeatureGeometry(D))}return z},_getFeatureGeometry:function(b){var z=[];d.forEach(b,function(c){var D=c.geometry.type,F=c.geometry;"point"===D?z.push(F):d.forEach("polyline"===D?F.paths:F.rings,function(R){d.forEach(R,function(N){N=new h(N[0],N[1],F.spatialReference);z.push(N)})})});return z},_onConvexHullComplete:function(b){"polygon"!==b.type&&(b=new m);this._saveProjectGeometry(b)},
_createBufferOnAssets:function(b){var z=[],c;var D=new l;for(R in b)if(b.hasOwnProperty(R)){var F=b[R].templates;for(c in F)F=b[R].templates[c].features,z=z.concat(this._getBufferGeometry(F))}var R=this.appUtils.units[this.config.generalSettings.measurementUnit].bufferUnit;b=new p;b.distances=[this.config.generalSettings.bufferDistance];b.outSpatialReference=this.map.spatialReference;b.unit=n[R];b.geometries=z;this.map.spatialReference.isWebMercator()||4326===this.map.spatialReference.wkid?(z=k.geodesicBuffer(b.geometries,
b.distances,b.unit,!0),D.resolve(z[0])):this.geometryService.buffer(b,e.hitch(this,function(N){D.resolve(N)}),e.hitch(this,function(){D.resolve(null)}));return D.promise},_getBufferGeometry:function(b){var z=[];d.forEach(b,e.hitch(this,function(c){c=c.geometry;"polygon"===c.type&&(c=k.simplify(c));z.push(c)}));return z},_saveProjectGeometry:function(b){if(this.projectLayer){this._loadingIndicator.show();var z=new A;z.attributes={};z.attributes[this.projectLayer.objectIdField]=this.projectInfo.objectId;
z.geometry=b;this.projectLayer.applyEdits(null,[z],null,e.hitch(this,function(){this.projectLayer.refresh();this.emit("addOrModifyLabelPoint",{projectGeometry:b});this._loadingIndicator.hide()}),e.hitch(this,function(){this.appUtils.showMessage(this.nls.projectOverview.unableToSaveProjectBoundary);this._loadingIndicator.hide()}))}},_saveProjectAttributes:function(b,z){if(this.projectLayer){this._loadingIndicator.show();var c=new A;c.attributes={};c.attributes[this.projectLayer.objectIdField]=this.projectInfo.objectId;
d.forEach(this.projectLayer.fields,e.hitch(this,function(D){"totalassetcost"===D.name.toLowerCase()?c.attributes[D.name]=b:"grossprojectcost"===D.name.toLowerCase()&&(c.attributes[D.name]=z)}));this.projectLayer.applyEdits(null,[c],null,e.hitch(this,function(){this.projectLayer.refresh();this._loadingIndicator.hide()}),e.hitch(this,function(){this.appUtils.showMessage(this.nls.projectOverview.unableToSaveProjectCost);this._loadingIndicator.hide()}))}}})})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),
function(O,J,K,I,v,e,d,a){O=O(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var w={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},t=this.distances,g=this.outSpatialReference,l=this.bufferSpatialReference,A=K.map(this.geometries,function(k){k="extent"===k.type?d.fromExtent(k):k;return k.toJson()},this),h=this.geometries;if(h&&0<h.length){var p=
"extent"===h[0].type?"esriGeometryPolygon":a.getJsonType(h[0]);w.geometries=I.toJson({geometryType:p,geometries:A});w.inSR=h[0].spatialReference.wkid?h[0].spatialReference.wkid:I.toJson(h[0].spatialReference.toJson())}t&&(w.distances=t.join(","));g&&(w.outSR=g.wkid?g.wkid:I.toJson(g.toJson()));l&&(w.bufferSR=l.wkid?l.wkid:I.toJson(l.toJson()));return w}});v("extend-esri")&&J.setObject("tasks.BufferParameters",O,e);return O})},"widgets/CostAnalysis/advance-item-list":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./advance-item-list.html dojo/_base/array dojo/_base/lang dojo/dom-attr dojo/dom-class dojo/dom-style dojo/on dojo/query dojo/dom-construct dojo/keys dojo/_base/event".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-advance-item-list",activeIndex:0,currentActivePanel:null,highlighterColor:"#000",setAutoHeight:!1,postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this.itemList&&0<this.itemList.length&&setTimeout(d.hitch(this,function(){this._loadItemList()}),0)},_loadItemList:function(){e.forEach(this.itemList,d.hitch(this,function(k,n){this.addItem(k,n)}));
this.emit("onLoad")},addItem:function(k,n){k.content=k.content||"";var m=A.create("div",{"class":"esriCTItem"},null);a.set(m,"index",n);this._createItemTitle(k,m);k.content&&this._createItemContent(k,m);this.itemListContainer.appendChild(m);k.isOpen&&this._togglePanel(m,!0);k.isHidden&&this.hide(n)},_createImageLogo:function(k,n,m){n=A.create("div",{"class":"esriCTItemListImageLogo"},n);"icon"===m?w.add(n,k.icon):"actionIcon"===m?(a.set(n,"tabindex","0"),w.add(n,"esriCTWorkBenchDOM"),a.set(n,"role",
"button"),a.set(n,"aria-label",k.actionIconTitle),w.add(n,k.actionIcon)):(w.add(n,"esriCTArrow"),this.togglePanels&&w.add(n,"esriCTArrowDown"));return n},_createItemTitle:function(k,n){var m=A.create("div",{"class":"esriCTItemTitleContainer",tabindex:"0","aria-label":k.title,role:"button"},n);k.title===this.nls.projectOverview.projectSummaryTitle&&w.add(m,"esriCTProjectSummary");k.title===this.nls.projectOverview.assetItemsTitle?w.add(m,"esriCTAssetItems"):a.set(m,"aria-expanded","false");this.fromProjectOverview&&
(w.add(m,"esriCTProjectOverview"),w.add(m,"esriCTWorkBenchDOM"));var C=A.create("div",{"class":"esriCTItemHighlighter"},m);this.highlighter||w.add(C,"esriCTHidden");k.icon&&this._createImageLogo(k,m,"icon");C=A.create("div",{"class":"esriCTItemTitle esriCTFloatLeft esriCTEllipsis",innerHTML:k.title,title:k.title},m);if(k.actionIcon){var B=this._createImageLogo(k,m,"actionIcon");k.actionIconTitle&&a.set(B,"title",k.actionIconTitle);this.own(g(B,"click",d.hitch(this,function(y){p.stop(y);this.emit("onActionButtonClicked",
a.get(n,"index"))})));this.own(g(B,"keydown",d.hitch(this,function(y){if(y.keyCode===h.ENTER||y.keyCode===h.SPACE)p.stop(y),this.emit("onActionButtonClicked",a.get(n,"index"))})))}this.showArrow&&this._createImageLogo(k,m,"arrow");this._setItemTitleWidth(k,C);this.own(g(m,"click",d.hitch(this,function(){this.togglePanels&&this._togglePanel(n,!1);this.emit("onTitleClicked",a.get(n,"index"))})));this.own(g(m,"keydown",d.hitch(this,function(y){if(y.keyCode===h.ENTER||y.keyCode===h.SPACE)p.stop(y),this.togglePanels&&
this._togglePanel(n,!1),this.emit("onTitleClicked",a.get(n,"index"))})))},_setItemTitleWidth:function(k,n){var m=0;k.icon&&(m+=32);k.actionIcon&&(m+=32);this.showArrow&&(m+=32);this.highlighter&&(m+=10);t.set(n,"width","calc(100% - "+m+"px)")},_createItemContent:function(k,n){n=A.create("div",{"class":"esriCTItemContent"},n);this.setAutoHeight||w.add(n,"esriCTItemAnimation");"string"===typeof k.content?a.set(n,"innerHTML",k.content):A.place(k.content,n)},_togglePanel:function(k,n){var m=0;n||(m=30);
n=l(".esriCTItemTitle",k)[0];var C=l(".esriCTItemContent",k)[0];var B=l(".esriCTArrow",k)[0];var y=l(".esriCTItemHighlighter",k)[0];var G=l(".esriCTToggleIcon",k);var f=l(".esriCTEditEquationIcon",k);var b=l(".esriCTSelectableRow",k);var z=l(".esriCTGroupSummaryTotalRow",k);n&&C&&(w.contains(C,"esriCTItemContentActive")?(C.style.height=0,this.currentActivePanel&&a.get(this.currentActivePanel,"index")===a.get(k,"index")&&(this.currentActivePanel=null),t.set(y,"backgroundColor","transparent"),this.showArrow&&
this.togglePanels&&(w.replace(B,"esriCTArrowDown","esriCTArrowUp"),a.set(n.parentNode,"aria-expanded","false"),this._setTabIndexToNodes(G,"-1"),this._setTabIndexToNodes(f,"-1"),this._setTabIndexToNodes(b,"-1"),this._setTabIndexToNodes(z,"-1"))):(C.style.height=this.togglePanels&&!this.setAutoHeight?C.scrollHeight+m+"px":"auto",this.currentActivePanel&&!this.openMultiple&&this._togglePanel(this.currentActivePanel,!0),this.currentActivePanel=k,t.set(y,"backgroundColor",this.highlighterColor),this.showArrow&&
this.togglePanels&&(w.replace(B,"esriCTArrowUp","esriCTArrowDown"),a.set(n.parentNode,"aria-expanded","true"),this._setTabIndexToNodes(G,"0"),this._setTabIndexToNodes(f,"0"),this._setTabIndexToNodes(b,"0"),this._setTabIndexToNodes(z,"0"))),w.toggle(C,"esriCTItemContentActive"))},onTitleClicked:function(){},onAnalysisButtonClicked:function(){},show:function(k){k=l(".esriCTItem[index \x3d "+k+"]",this.itemListContainer);1===k.length&&(t.set(k[0],"display",""),k.isHidden=!1)},hide:function(k){k=l(".esriCTItem[index \x3d "+
k+"]",this.itemListContainer);1===k.length&&(t.set(k[0],"display","none"),k.isHidden=!0)},_setTabIndexToNodes:function(k,n){k&&0<k.length&&e.forEach(k,d.hitch(this,function(m){a.set(m,"tabindex",n)}))}})})},"widgets/CostAnalysis/project-summary":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./project-summary.html dojo/_base/lang dojo/dom-attr dojo/on jimu/dijit/SimpleTable jimu/dijit/LoadingIndicator dojo/query dojo/dom-class dijit/form/ValidationTextBox dojo/dom-construct jimu/dijit/formSelect dijit/registry dojo/_base/array dojo/store/Memory dojo/_base/html dijit/focus esri/graphic dojo/keys dojo/_base/event jimu/utils dijit/focus".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-project-summary",_costFieldStore:null,totalCost:0,projectInfo:null,previouslyAddedEscalations:[],loadingProject:!1,postCreate:function(){this.inherited(arguments);this.totalCost=0;this.previouslyAddedEscalations=[];this._handleClickEvents();this._initLoadingIndicator()},_initLoadingIndicator:function(){this._loadingIndicator=new t({hidden:!0});this._loadingIndicator.placeAt(this.domNode.parentNode.parentNode.parentNode);
this._loadingIndicator.startup()},_handleClickEvents:function(){this.own(a(this.btnAddNode,"click",e.hitch(this,function(){l.contains(this.btnAddNode,"esriCTAddStatisticsIconDisable")||(this._addCostEscalationBtnClicked(),this._handleActionButtonVisibility())})));this.own(a(this.btnAddNode,"keydown",e.hitch(this,function(c){if(c.keyCode===G.ENTER||c.keyCode===G.SPACE)f.stop(c),l.contains(this.btnAddNode,"esriCTAddStatisticsIconDisable")||(this._addCostEscalationBtnClicked(),this._handleActionButtonVisibility())})));
this.own(a(this.btnCrossNode,"click",e.hitch(this,function(){l.contains(this.btnCrossNode,"esriCTDeleteStatisticsIconDisable")||this._deleteLayerRow()})));this.own(a(this.btnCrossNode,"keydown",e.hitch(this,function(c){if(c.keyCode===G.ENTER||c.keyCode===G.SPACE)f.stop(c),l.contains(this.btnCrossNode,"esriCTDeleteStatisticsIconDisable")||this._deleteLayerRow()})));this.own(a(this.btnUpNode,"click",e.hitch(this,this._upArrowClicked)));this.own(a(this.btnUpNode,"keydown",e.hitch(this,function(c){if(c.keyCode===
G.ENTER||c.keyCode===G.SPACE)f.stop(c),this._upArrowClicked()})));this.own(a(this.btnDownNode,"click",e.hitch(this,this._downArrowClicked)));this.own(a(this.btnDownNode,"keydown",e.hitch(this,function(c){if(c.keyCode===G.ENTER||c.keyCode===G.SPACE)f.stop(c),this._downArrowClicked()})));this.own(a(this.okButton,"click",e.hitch(this,function(){this._okButtonClicked()})));this.own(a(this.okButton,"keydown",e.hitch(this,function(c){if(c.keyCode===G.ENTER||c.keyCode===G.SPACE)f.stop(c),this._okButtonClicked()})));
this.own(a(this.cancelButton,"click",e.hitch(this,function(){this._cancelButtonClicked()})));this.own(a(this.cancelButton,"keydown",e.hitch(this,function(c){if(c.keyCode===G.ENTER||c.keyCode===G.SPACE)f.stop(c),this._cancelButtonClicked()})))},_okButtonClicked:function(){var c=!0;var D=this._costEscalationTable.getRows();n.forEach(D,e.hitch(this,function(F){F.costLabelTextBox.isValid()||(c=!1,B.focus(F.costLabelTextBox));F.costValueLabelTextBox.isValid()||(c=!1,B.focus(F.costValueLabelTextBox))}));
c?(this.calculateGrossCost(this.totalCost,!0),this.emit("onOkButtonClicked")):this.appUtils.showMessage(this.nls.costEscalation.invalidEntry)},_cancelButtonClicked:function(){this.emit("onCancelButtonClicked");this._loadingIndicator.show();this._costEscalationTable.clear();n.forEach(this.tableData,e.hitch(this,function(c){this._addCostEscalationLayerRow(c)}));this._updateGrossCost();this._loadingIndicator.hide()},_upArrowClicked:function(){if(!l.contains(this.btnUpNode,"esriCTStatisticsUpIconDisable")){var c;
var D=this._costEscalationTable.getRows();var F=this._costEscalationTable.getData();n.forEach(F,e.hitch(this,function(R,N){R.editable&&(c=D[N])}));this._costEscalationTable.onBeforeRowUp(c)&&(F=n.indexOf(D,c),0<F&&(F=D[F-1]))&&(C.place(c,F,"before"),this._costEscalationTable.updateUI(),this._costEscalationTable.emit("row-up",c),this._updateGrossCost())}},_downArrowClicked:function(){if(!l.contains(this.btnDownNode,"esriCTStatisticsDownIconDisable")){var c;var D=this._costEscalationTable.getRows();
var F=this._costEscalationTable.getData();n.forEach(F,e.hitch(this,function(R,N){R.editable&&(c=D[N])}));this._costEscalationTable.onBeforeRowDown(c)&&(F=n.indexOf(D,c),F<D.length-1&&(F=D[F+1]))&&(C.place(c,F,"after"),this._costEscalationTable.updateUI(),this._costEscalationTable.emit("row-down",c),this._updateGrossCost())}},startup:function(){this.inherited(arguments);this._init()},reset:function(c){this.projectInfo=c;this._costEscalationTable.clear();this.totalCost=0;this.previouslyAddedEscalations=
[];this.tableData=[]},_init:function(){this._createCostEscalationFieldTable();this._createCostTypeFieldStore()},cloneTableData:function(){this.tableData=[];var c=[],D={};this._costEscalationTable&&this._costEscalationTable.getRows().length&&(n.forEach(this._costEscalationTable.getRows(),e.hitch(this,function(F){D={};F.costLabelTextBox&&(D.label=F.costLabelTextBox.getValue());F.costTypeLabelDropdown&&(D.type=F.costTypeLabelDropdown.getValue());F.costValueLabelTextBox&&(D.costValue=F.costValueLabelTextBox.getValue());
c.push(D)})),this.tableData=e.clone(c));this._handleActionButtonVisibility()},loadAdditionalCost:function(c){var D={};0<c.length?(c.sort(e.hitch(this,this._sortFeatureArray)),n.forEach(c,e.hitch(this,function(F){D={};D.label=F.attributes[this.config.projectMultiplierFields.DESCRIPTION];D.type=F.attributes[this.config.projectMultiplierFields.TYPE];D.costValue=F.attributes[this.config.projectMultiplierFields.VALUE];if("+"===D.type||"*"===D.type||"_"===D.type||"%"===D.type)this.additionalCostTable&&
this.loadingProject&&this._storeAsPreviouslyAdded(F.attributes[this.additionalCostTable.objectIdField]),this._addCostEscalationLayerRow(D)}))):n.forEach(this.config.projectCostSettings,e.hitch(this,function(F){D={};D.label=F.label;D.type=F.type;D.costValue=F.value;"+"!==D.type&&"*"!==D.type&&"_"!==D.type&&"%"!==D.type||this._addCostEscalationLayerRow(D)}))},_sortFeatureArray:function(c,D){var F=this.config.projectMultiplierFields.COSTINDEX;return c.attributes[F]-D.attributes[F]},_createCostEscalationFieldTable:function(){this._costEscalationTable=
new w({fields:[{name:"editable",title:this.nls.common.label,type:"checkbox",editable:!1,width:"40%"},{name:"field",title:this.nls.common.type,type:"empty",editable:!1,width:"30%"},{name:"field",title:this.nls.costEscalation.valueHeader,type:"empty",editable:!0,width:"40%"}],selectable:!1,autoHeight:!0});this._costEscalationTable.placeAt(this.costEscalationTableNode);this._costEscalationTable.startup()},_handleCheckBoxClick:function(c){var D=g(".simple-table-title .jimu-checkbox",this.domNode)[0];
c=g(".jimu-checkbox",c)[0];a(k.byNode(D),"change",e.hitch(this,function(){this._handleActionButtonVisibility()}));a(k.byNode(c),"change",e.hitch(this,function(){this._handleActionButtonVisibility()}))},_handleActionButtonVisibility:function(){var c=!0,D=0;var F=this._costEscalationTable.getRows();var R=g(".simple-table-title .jimu-checkbox",this.domNode)[0];R=k.byNode(R);n.forEach(F,e.hitch(this,function(N){""===e.trim(N.costLabelTextBox.value)&&(c=!1);if(isNaN(N.costValueLabelTextBox.value)||""===
e.trim(N.costValueLabelTextBox.value+"")||"0"===N.costValueLabelTextBox.value||0===N.costValueLabelTextBox.value)c=!1;N=g(".jimu-checkbox",N)[0];k.byNode(N).checked&&D++}));0===D?(l.replace(this.btnCrossNode,"esriCTDeleteStatisticsIconDisable","esriCTDeleteStatisticsIcon"),d.set(this.btnCrossNode,"tabindex","-1")):(l.replace(this.btnCrossNode,"esriCTDeleteStatisticsIcon","esriCTDeleteStatisticsIconDisable"),d.set(this.btnCrossNode,"tabindex","0"));c||0===F.length?(l.replace(this.btnAddNode,"esriCTAddStatisticsIcon",
"esriCTAddStatisticsIconDisable"),d.set(this.btnAddNode,"tabindex","0")):(l.replace(this.btnAddNode,"esriCTAddStatisticsIconDisable","esriCTAddStatisticsIcon"),d.set(this.btnAddNode,"tabindex","-1"));c&&1===D&&1<F.length?(l.replace(this.btnUpNode,"esriCTStatisticsUpIcon","esriCTStatisticsUpIconDisable"),l.replace(this.btnDownNode,"esriCTStatisticsDownIcon","esriCTStatisticsDownIconDisable"),d.set(this.btnUpNode,"tabindex","0"),d.set(this.btnDownNode,"tabindex","0")):(l.replace(this.btnUpNode,"esriCTStatisticsUpIconDisable",
"esriCTStatisticsUpIcon"),l.replace(this.btnDownNode,"esriCTStatisticsDownIconDisable","esriCTStatisticsDownIcon"),d.set(this.btnUpNode,"tabindex","-1"),d.set(this.btnDownNode,"tabindex","-1"));0===F.length?(R.set("status",!1),l.add(R.domNode,"jimu-state-disabled"),d.set(R.domNode,"tabindex","-1"),z.focus(this.btnAddNode),b.initFirstFocusNode(this.widgetDomNode,this.btnAddNode)):(R.set("status",!0),l.remove(R.domNode,"jimu-state-disabled"),d.set(R.domNode,"tabindex","0"),b.initFirstFocusNode(this.widgetDomNode,
R.domNode))},_addCostEscalationBtnClicked:function(){this._addCostEscalationLayerRow();if(this.widgetDomNode){var c=this._costEscalationTable.getRows();if(0<=c.length){var D=c[c.length-1];c=g(".jimu-checkbox",D)[0];z.focus(c);this.textBoxKeyDownEvent&&this.textBoxKeyDownEvent[0].remove();this.textBoxKeyDownEvent=this.own(a(D.costValueLabelTextBox,"keydown",e.hitch(this,function(F){setTimeout(e.hitch(this,function(){F.keyCode===G.TAB&&F.shiftKey||D.costValueLabelTextBox.isValid()&&F.keyCode===G.TAB&&
(l.contains(this.btnAddNode,"esriCTAddStatisticsIconDisable")||z.focus(this.btnAddNode))}),100)})))}}},_addCostEscalationLayerRow:function(c){var D=this._costEscalationTable.addRow({});var F=g(".simple-table-cell",D.tr);this._handleCheckBoxClick(D.tr);F&&(D=D.tr,this._addCostLabelTextBox(F[0],D,c),this._addCostTypeLabelDropdown(F[1],D,c),this._addCostValueLabelTextBox(F[2],D,c))},_addCostLabelTextBox:function(c,D,F){c=h.create("div",{"class":"esriCTTextBoxContainer"},c);D.costLabelTextBox=new A({"class":"esriCTCostLabelTextbox esriCTAddLayerTableNode",
"aria-label":this.nls.common.label},c);D.costLabelTextBox.startup();F&&F.label&&D.costLabelTextBox.set("value",F.label);D.costLabelTextBox.validator=e.hitch(this,this._validateCostEscalationLabelFields);this.own(a(D.costLabelTextBox,"change",e.hitch(this,function(){this._handleActionButtonVisibility()})))},_validateCostEscalationLabelFields:function(c){return""===e.trim(c)?!1:!0},_addCostTypeLabelDropdown:function(c,D,F){c=h.create("div",{"class":"esriCTCostTypeDropDownContainer esriCTAddLayerTableNode"},
c);D.costTypeLabelDropdown=new p({name:"layerSelect",store:this._costFieldStore,labelAttr:"name","class":"esriCTCostTypeDropdown","aria-label":this.nls.common.type},c);F&&F.type&&(F=D.costTypeLabelDropdown.store.get(F.type),D.costTypeLabelDropdown.setValue(F.value));this.own(a(D.costTypeLabelDropdown,"change",e.hitch(this,this._updateGrossCost)));D.costTypeLabelDropdown.startup()},_addCostValueLabelTextBox:function(c,D,F){c=h.create("div",{"class":"esriCTTextBoxContainer esriCTAddLayerTableNode"},
c);D.costValueLabelTextBox=new A({"class":"esriCTCostLabelTextbox",trim:!0,"aria-label":this.nls.costEscalation.valueHeader},c);D.costValueLabelTextBox.startup();F&&F.costValue&&D.costValueLabelTextBox.set("value",F.costValue);D.costValueLabelTextBox.validator=e.hitch(this,this._validateCostEscalationValueFields);this.own(a(D.costValueLabelTextBox,"change",e.hitch(this,function(){this._updateGrossCost();this._handleActionButtonVisibility()})))},_validateCostEscalationValueFields:function(c){c=Number(c);
return""===c||isNaN(c)||"0"===c||0===c?!1:!0},_getCostEscalationArray:function(){var c=this._costEscalationTable.getRows();var D=[];n.forEach(c,e.hitch(this,function(F){D.push({label:F.costLabelTextBox.getValue(),type:F.costTypeLabelDropdown.getValue(),value:F.costValueLabelTextBox.getValue()})}));return D},addConfiguredAdditionalCostArray:function(){var c=[];var D=[];var F=[];var R=this.totalCost;n.forEach(this.config.projectCostSettings,e.hitch(this,function(N){c.push({label:N.label,type:N.type,
value:N.value})}));n.forEach(c,e.hitch(this,function(N,r){var E={};var q=parseFloat(N.value);this.projectInfo&&this.projectInfo.projectId&&this.config.projectMultiplierFields&&(E[this.config.projectMultiplierFields.DESCRIPTION]=N.label,E[this.config.projectMultiplierFields.TYPE]=N.type,E[this.config.projectMultiplierFields.VALUE]=q,E[this.config.projectMultiplierFields.COSTINDEX]=r+1,E[this.config.projectMultiplierFields.PROJECTGUID]=this.projectInfo.projectId,D.push(new y(null,null,E)));R=this._calculateGrossAdditionalCost(N.type,
q,R);F.push({label:N.label,type:N.type,value:q})}));this.loadAdditionalCost(D);setTimeout(e.hitch(this,function(){this.calculateGrossCost(this.totalCost,!0)}),500)},_deleteLayerRow:function(){var c=this._costEscalationTable.getRows(),D=this._costEscalationTable.getData();n.forEach(D,e.hitch(this,function(F,R){F.editable&&(this._costEscalationTable.deleteRow(c[R]),this._updateGrossCost())}));0===this._costEscalationTable.getRows().length&&(D=g("th .checkbox",this.costEscalationTableNode)[0],l.contains(D,
"checked")&&l.remove(D,"checked"));this._handleActionButtonVisibility()},_createCostTypeFieldStore:function(){var c=[];c.push({name:"+",value:"+"});c.push({name:"*",value:"*"});c.push({name:"-",value:"_"});c.push({name:"%",value:"%"});this._costFieldStore=new m({idProperty:"value",data:c})},_calculateGrossAdditionalCost:function(c,D,F){switch(c){case "+":F+=D;break;case "_":F-=D;break;case "*":F*=D;break;case "%":F+=F*D/100}return F},_updateGrossCost:function(){if(!this.loadingProject){var c=this._getCostEscalationArray();
var D=this.totalCost,F=[],R=[];n.forEach(c,e.hitch(this,function(r,E){var q=parseFloat(r.value),u={};q&&(this.projectInfo&&this.projectInfo.projectId&&this.config.projectMultiplierFields&&(u[this.config.projectMultiplierFields.DESCRIPTION]=r.label,u[this.config.projectMultiplierFields.TYPE]=r.type,u[this.config.projectMultiplierFields.VALUE]=q,u[this.config.projectMultiplierFields.COSTINDEX]=E+1,u[this.config.projectMultiplierFields.PROJECTGUID]=this.projectInfo.projectId,F.push(new y(null,null,u))),
D=this._calculateGrossAdditionalCost(r.type,q,D),R.push({label:r.label,type:r.type,value:q}))}));c=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,this.totalCost);c=this.config.generalSettings.currency+" "+c;d.set(this.totalCostDiv,"innerHTML",c);c=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,D);c=this.config.generalSettings.currency+" "+c;d.set(this.grossCostDiv,"innerHTML",c);c=this.totalCostLabel.innerHTML.replace("*",this.nls.projectOverview.roundingLabel);
var N=this.grossCostLabel.innerHTML.replace("*",this.nls.projectOverview.roundingLabel);d.set(this.totalCostLabel,"aria-label",c.replace("*",""));d.set(this.grossCostLabel,"aria-label",N.replace("*",""));return{grossCost:D,features:F,additionalCostInfo:R}}},calculateGrossCost:function(c,D){this.totalCost=c;this.loadingProject||(c=this._updateGrossCost(),this.emit("grossCostUpdated",this.totalCost,c.grossCost,c.additionalCostInfo),D&&this._updateCostEscalationTable(c.features))},_updateCostEscalationTable:function(c){this.additionalCostTable&&
(0<c.length||0<this.previouslyAddedEscalations.length)&&(this._loadingIndicator.show(),this.additionalCostTable.applyEdits(c,null,this.previouslyAddedEscalations,e.hitch(this,function(D){var F=!1;this.previouslyAddedEscalations=[];D&&0<D.length&&(n.forEach(D,e.hitch(this,function(R){R.success?this._storeAsPreviouslyAdded(R.objectId):F=!0})),F&&this.appUtils.showMessage(this.nls.costEscalation.errorInSavingCostEscalation));this._loadingIndicator.hide()}),e.hitch(this,function(){this._loadingIndicator.hide();
this.appUtils.showMessage(this.nls.costEscalation.errorInSavingCostEscalation)})))},_storeAsPreviouslyAdded:function(c){var D={};D[this.additionalCostTable.objectIdField]=c;c=new y(null,null,D);this.previouslyAddedEscalations.push(c)},setFirstAndLastNode:function(){if(this._costEscalationTable.getRows().length){var c=g(".simple-table-title .jimu-checkbox",this.domNode)[0];c=k.byNode(c);b.initFirstFocusNode(this.widgetDomNode,c.domNode);B.focus(c.domNode)}else z.focus(this.btnAddNode),b.initFirstFocusNode(this.widgetDomNode,
this.btnAddNode);b.initLastFocusNode(this.widgetDomNode,this.cancelButton);this._addAriaLabelToTdChkBoxes()},_addAriaLabelToTdChkBoxes:function(){var c=g("td .checkbox",this.costEscalationTableNode);c&&0<c.length&&n.forEach(c,e.hitch(this,function(D){d.set(D,"aria-label",this.nls.common.label)}))}})})},"widgets/CostAnalysis/asset-details":function(){define("dojo/_base/declare dojo/_base/html jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./asset-details.html dojo/_base/lang dojo/dom-construct dojo/_base/array dojo/dom-class dojo/dom-attr dojo/string dojo/on dojo/query dijit/TooltipDialog dijit/popup esri/graphicsUtils ./advance-item-list ./cost-equation-editor dojo/keys dojo/_base/event dijit/focus jimu/utils".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f){return O([K,I,v],{templateString:e,baseClass:"jimu-widget-cost-analysis-asset-details",_layerDetailsNode:{},_layerIndexes:[],_openGroups:{},postCreate:function(){this.inherited(arguments);this._layerDetailsNode={};this._openGroups={};this.listData=[];this._layerIndexes=[];w.forEach(this.config.layerSettings,d.hitch(this,function(b){if(b.editable&&this.map.getLayer(b.id)){this._openGroups[b.id]=[];this._layerDetailsNode[b.id]=a.create("div");
var z={title:this.map.getLayer(b.id).name,content:this._layerDetailsNode[b.id],icon:"",actionIcon:"",isOpen:!1,isHidden:!0};this.listData.push(z);this._layerIndexes.push(b.id)}}))},startup:function(){this.inherited(arguments);this._initItemList();this._initCostEquationEditor();this.own(A(document.body,"click",d.hitch(this,function(b){this.isPartOfPopup(b.target||b.srcElement)||this._closePopupDialog()})));this.own(A(this.okButton,"click",d.hitch(this,function(){this.emit("onOkButtonClicked")})));
this.own(A(this.okButton,"keydown",d.hitch(this,function(b){if(b.keyCode===B.ENTER||b.keyCode===B.SPACE)y.stop(b),this.emit("onOkButtonClicked")})));this.own(A(this.additionalCostBtn,"click",d.hitch(this,function(){this.emit("showAdditionalCost")})));this.own(A(this.additionalCostBtn,"keydown",d.hitch(this,function(b){if(b.keyCode===B.ENTER||b.keyCode===B.SPACE)y.stop(b),this.emit("showAdditionalCost")})))},reset:function(){for(var b in this._openGroups)this._openGroups[b]=[]},_initItemList:function(){this.itemList=
new m({itemList:this.listData,showArrow:!0,togglePanels:!0,openMultiple:!0,setAutoHeight:!0,highlighter:!0,highlighterColor:this.config.selectedThemeColor,widgetDomNode:this.widgetDomNode,nls:this.nls},a.create("div",{},this.listNode));this.own(A(this.itemList,"onActionButtonClicked",d.hitch(this,function(z){this.emit("actionClicked",z)})));this.own(A(this.itemList,"onTitleClicked",d.hitch(this,function(z){this.emit("titleClicked",z)})));this.own(A(this.itemList,"onLoad",d.hitch(this,function(){this.emit("onLoad")})));
this.itemList.startup();var b=this._createTooltipDialogContent();this.assetDetailsDialog=new p({"class":this.baseClass,content:b,style:"width : 180px"})},_createTooltipDialogContent:function(){var b=a.create("div",{},null);var z=a.create("div",{style:"height : 20px; margin: 0px"},b);z=a.create("div",{"class":"esriCTDialogIcon esriCTClose",title:this.nls.workBench.closeDialog,tabindex:"0",role:"button","aria-label":this.nls.workBench.closeDialog},z);this.own(A(z,"click",d.hitch(this,this._closePopupDialog)));
this.own(A(z,"keydown",d.hitch(this,function(D){if(D.keyCode===B.ENTER||D.keyCode===B.SPACE||D.keyCode===B.ESCAPE)y.stop(D),this._closePopupDialog()})));z=a.create("div",{"class":"esriCTRowContainer",title:this.nls.workBench.zoomToAsset,tabindex:"0",role:"button","aria-label":this.nls.workBench.zoomToAsset},b);var c=a.create("div",{"class":"esriCTRowContainer",title:this.nls.workBench.deleteAsset,tabindex:"0",role:"button","aria-label":this.nls.workBench.deleteAsset},b);a.create("div",{"class":"esriCTDialogIcon esriCTZoom"},
z);a.create("div",{"class":"esriCTTooltipDialogLabel esriCTEllipsis",innerHTML:this.nls.workBench.zoomToAsset},z);this.own(A(z,"click",d.hitch(this,function(D){y.stop(D);this._zoomToAsset();this._support508ToPopupDialog();G.focus(D.currentTarget)})));this.own(A(z,"keydown",d.hitch(this,function(D){if(D.keyCode===B.ENTER||D.keyCode===B.SPACE)y.stop(D),this._zoomToAsset(),this._support508ToPopupDialog(),G.focus(D.currentTarget);D.keyCode===B.ESCAPE&&(y.stop(D),this._closePopupDialog())})));a.create("div",
{"class":"esriCTDialogIcon esriCTDelete"},c);a.create("div",{"class":"esriCTTooltipDialogLabel",innerHTML:this.nls.workBench.deleteAsset},c);this.own(A(c,"click",d.hitch(this,this._deleteAsset)));this.own(A(c,"keydown",d.hitch(this,function(D){if(D.keyCode===B.ENTER||D.keyCode===B.SPACE)y.stop(D),this._deleteAsset();D.keyCode===B.ESCAPE&&(y.stop(D),this._closePopupDialog())})));return b},_zoomToAsset:function(){if(this.selectedRowInfo){var b=this.assetDetails[this.selectedRowInfo.layerId][this.selectedRowInfo.templateName][this.selectedRowInfo.region][this.selectedRowInfo.scenario];
var z=this.layerInfosObj.getLayerInfoById(this.selectedRowInfo.layerId).layerObject.objectIdField;b&&w.some(b,d.hitch(this,function(c){if(c.attributes[z].toString()===this.selectedRowInfo.objectId)return this.map.setExtent(n.graphicsExtent([c]).expand(1.5)),!0}))}},_deleteAsset:function(){if(this.selectedRowInfo){var b;var z=this.map.getLayer(this.selectedRowInfo.layerId);(b=this.assetDetails[this.selectedRowInfo.layerId][this.selectedRowInfo.templateName][this.selectedRowInfo.region][this.selectedRowInfo.scenario])&&
w.some(b,d.hitch(this,function(c){if(c.attributes[z.objectIdField].toString()===this.selectedRowInfo.objectId)return c._layer=z,z.applyEdits(null,null,[c]),!0}));this._closePopupDialog()}},_rowClick:function(b){b.stopPropagation();b.preventDefault();h(".esriCTRowSelected",this.assetDetailsNode).removeClass("esriCTRowSelected");t.add(b.currentTarget,"esriCTRowSelected");this.selectedRowInfo={};this.selectedRowInfo.templateName=g.get(b.currentTarget,"templateName");this.selectedRowInfo.region=g.get(b.currentTarget,
"region");this.selectedRowInfo.scenario=g.get(b.currentTarget,"scenario");this.selectedRowInfo.layerId=g.get(b.currentTarget,"layerId");this.selectedRowInfo.objectId=g.get(b.currentTarget,"objectId");this._openPopupDialog(this.assetDetailsDialog,b)},_createExpandCollapseButton:function(b,z,c,D){b=a.create("div",{"class":"esriCTToggleIcon",tabindex:"-1",role:"button","aria-label":D,"aria-expanded":"false"},b);-1===this._openGroups[c].indexOf(z)?t.add(b,"esriCTExpandIcon"):t.add(b,"esriCTCollapseIcon");
g.set(b,"groupId",z);g.set(b,"layerId",c);this.own(A(b,"click",d.hitch(this,function(F){this.expandCollapseBtnClicked(F)})));this.own(A(b,"keydown",d.hitch(this,function(F){if(F.keyCode===B.ENTER||F.keyCode===B.SPACE)y.stop(F),this.expandCollapseBtnClicked(F)})));return b},expandCollapseBtnClicked:function(b){var z=g.get(b.currentTarget,"groupId");var c=g.get(b.currentTarget,"layerId");var D=h("[tableGroupId \x3d "+z.replace(/"/g,'\\"')+"]",this.assetDetailsNode)[0];t.contains(b.currentTarget,"esriCTCollapseIcon")?
(t.replace(b.currentTarget,"esriCTExpandIcon","esriCTCollapseIcon"),t.add(D,"esriCTHidden"),this._openGroups[c].splice(this._openGroups[c].indexOf(z),1),this._TabIndexToAssetDetailsTableRows(b,"-1"),g.set(b.currentTarget,"aria-expanded","false")):(t.replace(b.currentTarget,"esriCTCollapseIcon","esriCTExpandIcon"),t.remove(D,"esriCTHidden"),this._openGroups[c].push(z),this._TabIndexToAssetDetailsTableRows(b,"0"),g.set(b.currentTarget,"aria-expanded","true"))},_createEditEquationButton:function(b,z,
c){b=a.create("div",{"class":"esriCTEditEquationIcon",tabindex:"-1",role:"button","aria-label":c+this.nls.common.edit+this.nls.workBench.costEquationTitle},b);g.set(b,"templateName",z.templateName);g.set(b,"region",z.regionName);g.set(b,"scenario",z.scenario);g.set(b,"layerId",z.layerId);g.set(b,"equation",z.equation);this.own(A(b,"click",d.hitch(this,function(D){this._editEquationBtnClicked(D)})));this.own(A(b,"keydown",d.hitch(this,function(D){if(D.keyCode===B.ENTER||D.keyCode===B.SPACE)y.stop(D),
this._editEquationBtnClicked(D)})));return b},_editEquationBtnClicked:function(b){var z={};this.currentEditEquationBtn=b.currentTarget;t.add(b.currentTarget,"esriCTEditEquationBtnClicked");z.templateName=g.get(b.currentTarget,"templateName");z.region=g.get(b.currentTarget,"region");z.scenario=g.get(b.currentTarget,"scenario");z.layerId=g.get(b.currentTarget,"layerId");z.equation=g.get(b.currentTarget,"equation");t.add(this.assetDetailsParent,"esriCTHidden");t.remove(this.costEquationEditorParent,
"esriCTHidden");this._costEquationEditor&&this._costEquationEditor.setGroupInfo(z)},_createAssetDetailsTable:function(b,z,c,D){var F=0,R=0;var N=this.layerInfosObj.getLayerInfoById(D.layerId).layerObject.objectIdField;var r=a.create("table",{style:{width:"100%"},"class":"esriCTTable"},b);-1===this._openGroups[D.layerId].indexOf(z)&&t.add(r,"esriCTHidden");g.set(r,"tableGroupId",z);var E=a.create("tbody",{},r);if("point"!==c[0].geometry.type){var q=this.appUtils.getUnitsAbbreviation(c[0].geometry.type,
this.config.generalSettings.measurementUnit);z="polygon"===c[0].geometry.type?this.nls.statisticsType.areaLabel:this.nls.statisticsType.lengthLabel}else q=this.nls.workBench.units,z=this.nls.statisticsType.countLabel;var u=a.create("tr",{},E);a.create("td",{innerHTML:this.nls.workBench.objectIdColTitle},u);a.create("td",{innerHTML:z},u);a.create("td",{innerHTML:this.nls.workBench.costColTitle},u);w.forEach(c,d.hitch(this,function(x){var H=a.create("tr",{"class":"esriCTSelectableRow",tabindex:"-1",
role:"button"},E);var L=x.featureDimension;g.set(H,"templateName",D.templateName);g.set(H,"region",D.regionName);g.set(H,"scenario",D.scenario);g.set(H,"layerId",D.layerId);g.set(H,"objectId",x.attributes[N]);this.own(A(H,"click",d.hitch(this,this._rowClick)));this.own(A(H,"keydown",d.hitch(this,function(Q){if(Q.keyCode===B.ENTER||Q.keyCode===B.SPACE)y.stop(Q),this._rowClick(Q)})));"point"!==c[0].geometry.type&&(L=this.appUtils.applyRounding(L));a.create("td",{innerHTML:x.attributes[N]},H);a.create("td",
{innerHTML:L+" "+q},H);L=this.config.generalSettings.currency+" "+this.appUtils.applyRounding(x.individualCost);a.create("td",{innerHTML:L,"class":"esriCTAssetItemDetailsCostingValue"},H);F+=x.individualCost;R+=x.featureDimension}));"point"!==c[0].geometry.type&&(R=this.appUtils.applyRounding(R));this._addAriaLableToRows(r);b=a.create("table",{style:{width:"100%"},"class":"esriCTTable"},b);b=a.create("tr",{"class":"esriCTGroupSummaryTotalRow",tabindex:"-1","aria-label":"Total "+z+" "+R+" "+q+" Total "+
this.nls.workBench.costColTitle+" "+F},a.create("tbody",{},b));a.create("td",{"class":"esriCTGroupSummaryTotalTitle",innerHTML:"Total:"},b);a.create("td",{innerHTML:R+" "+q},b);F=this.config.generalSettings.currency+" "+this.appUtils.applyRounding(F);a.create("td",{innerHTML:F,"class":"esriCTGroupSummaryTotalCost"},b)},showAssetDetails:function(b,z){var c=!1;this.assetDetails=b;for(var D in this._layerDetailsNode){var F=this._layerIndexes.indexOf(D);a.empty(this._layerDetailsNode[D]);this.itemList.hide(F);
if(b.hasOwnProperty(D))for(var R in b[D])for(var N in b[D][R])for(var r in b[D][R][N]){var E=N;var q=r;var u=R+" ";var x=b[D][R][N][r];if(0<x.length){c={templateName:R,regionName:N,scenario:r,layerId:D,equation:x[0].templateInfo.COSTEQUATION};"null"===E?E=this.nls.scenarioSelection.noneText:u+=l.substitute(this.nls.assetDetails.inGeography,{geography:E});"null"===q?q=this.nls.scenarioSelection.noneText:u+=l.substitute(this.nls.assetDetails.withScenario,{scenario:q});q=D+" - "+R+" - "+E+" - "+q;q=
d.trim(q);var H=a.create("div",{"class":"esriCTGroupSummary"},this._layerDetailsNode[D]);var L=a.create("div",{"class":"esriCTGroupTitleParent"},H);E=l.substitute(this.nls.statisticsType.expandCollapseAriaLabel,{displayTitle:u,featureCount:x.length});this._createExpandCollapseButton(L,q,D,E);a.create("div",{"class":"esriCTGroupTitle",innerHTML:u+"("+x.length+")"},L);this._createEditEquationButton(L,c,u);this._createAssetDetailsTable(H,q,x,c);this.itemList.show(F);c=!0}}}c?(t.add(this.noAssetDetails,
"esriCTHidden"),g.set(this.noAssetDetails,"tabindex","-1"),this.emit("onAssetDeleted",!1)):(t.remove(this.noAssetDetails,"esriCTHidden"),g.set(this.noAssetDetails,"tabindex","0"),this.emit("onAssetDeleted",!0));setTimeout(d.hitch(this,function(){z&&this.setFirstAndLastNode()}),500)},_openPopupDialog:function(b,z){"keydown"===z.type?k.open({popup:b,around:z.currentTarget}):k.open({popup:b,x:z.pageX,y:z.pageY});this._support508ToPopupDialog()},_closePopupDialog:function(){var b=h(".esriCTRowSelected",
this.assetDetailsNode);k.close(this.assetDetailsDialog);b&&0<b.length&&(G.focus(b[0]),b.removeClass("esriCTRowSelected"))},_initCostEquationEditor:function(){this._costEquationEditor||(this._costEquationEditor=new C({nls:this.nls,map:this.map,config:this.config,appUtils:this.appUtils,widgetDomNode:this.widgetDomNode},a.create("div",{},this.costEquationEditorParent)),this.own(A(this._costEquationEditor,"onOkButtonClicked",d.hitch(this,function(b){this.emit("groupCostEquationUpdated",b);t.add(this.costEquationEditorParent,
"esriCTHidden");t.remove(this.assetDetailsParent,"esriCTHidden");this.setFirstAndLastNode();this._focusCurrentEquationEditorBtn()}))),this.own(A(this._costEquationEditor,"onCancelButtonClicked",d.hitch(this,function(){t.add(this.costEquationEditorParent,"esriCTHidden");t.remove(this.assetDetailsParent,"esriCTHidden");this.setFirstAndLastNode();this._focusCurrentEquationEditorBtn()}))),this._costEquationEditor.startup())},isPartOfPopup:function(b){var z=this.assetDetailsDialog.domNode;return b===z||
J.isDescendant(b,z)},grossCostUpdated:function(b,z,c){z=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,z);z=this.config.generalSettings.currency+" "+z;g.set(this.grossCost,"innerHTML",z);this._updateAdditionalCostTable(b,c);b=this.grossCostLabel.innerHTML.replace("*",this.nls.projectOverview.roundingLabel);g.set(this.grossCostLabel,"aria-label",b.replace("*",""))},totalCostUpdated:function(b){b=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,
b);b=this.config.generalSettings.currency+" "+b;g.set(this.totalCost,"innerHTML",b);b=this.totalCostLabel.innerHTML.replace("*",this.nls.projectOverview.roundingLabel);g.set(this.totalCostLabel,"aria-label",b.replace("*",""))},_updateAdditionalCostTable:function(b,z){a.empty(this.additionalCostTable);if(this.config.projectCostSettings&&0<this.config.projectCostSettings.length||0<z.length){var c=a.create("th");g.set(c,"role","heading");c.appendChild(a.create("td",{innerHTML:this.nls.assetDetails.additionalCostLabel}));
c.appendChild(a.create("td",{innerHTML:this.nls.assetDetails.additionalCostValue}));c.appendChild(a.create("td",{innerHTML:this.nls.assetDetails.additionalCostNetValue}));this.additionalCostTable.appendChild(c);for(c=0;c<z.length;c++){var D=a.create("tr",{tabindex:"0"});var F=z[c];var R=parseFloat(F.value);switch(F.type){case "+":var N=b+=R;break;case "_":N=b-=R;break;case "*":N=b*=R;break;case "%":N=b+=b*R/100}N=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,N);N=this.config.generalSettings.currency+
" "+N;D.appendChild(a.create("td",{innerHTML:F.label}));D.appendChild(a.create("td",{innerHTML:F.value}));D.appendChild(a.create("td",{innerHTML:N,"class":"esriCTAssetItemDetailsNetValue"}));g.set(D,"aria-label",this.nls.assetDetails.additionalCostLabel+" "+F.label+" "+this.nls.assetDetails.additionalCostValue+" "+F.value+" "+this.nls.assetDetails.additionalCostNetValue+" "+N);this.additionalCostTable.appendChild(D)}}},_focusCurrentEquationEditorBtn:function(){var b=h(".esriCTEditEquationBtnClicked",
this.domNode);b&&0<b.length&&(G.focus(b[0]),t.remove(this.currentEditEquationBtn,"esriCTEditEquationBtnClicked"))},setFirstAndLastNode:function(b){var z,c,D,F,R,N,r;var E=0;t.contains(this.noAssetDetails,"esriCTHidden")?(z=h(".esriCTItem",this.assetDetailsNode))&&0<z.length&&z.forEach(d.hitch(this,function(q){"none"!==q.style.display&&(E||(E=1,f.initFirstFocusNode(this.widgetDomNode,q.children[0]),G.focus(q.children[0])),c=h(".esriCTItemTitle",q)[0],D=h(".esriCTItemContent",q)[0],F=h(".esriCTToggleIcon",
q),R=h(".esriCTEditEquationIcon",q),N=h(".esriCTSelectableRow",q),r=h(".esriCTGroupSummaryTotalRow",q),c&&D&&(t.contains(D,"esriCTItemContentActive")?(this.itemList._setTabIndexToNodes(F,"0"),this.itemList._setTabIndexToNodes(R,"0"),this.itemList._setTabIndexToNodes(N,"0"),this.itemList._setTabIndexToNodes(r,"0")):(this.itemList._setTabIndexToNodes(F,"-1"),this.itemList._setTabIndexToNodes(R,"-1"),this.itemList._setTabIndexToNodes(N,"-1"),this.itemList._setTabIndexToNodes(r,"-1"))))})):(G.focus(this.noAssetDetails),
f.initFirstFocusNode(this.widgetDomNode,this.noAssetDetails));f.initLastFocusNode(this.widgetDomNode,this.okButton);b&&!t.contains(this.costEquationEditorParent,"esriCTHidden")&&this._costEquationEditor._add508SupportCostEquationEditor()},_support508ToPopupDialog:function(){var b=h(".esriCTDialogIcon",this.assetDetailsDialog.domNode);b&&0<b.length&&(f.initFirstFocusNode(b[0]),G.focus(b[0]),f.initLastFocusNode(b[2]))},_TabIndexToAssetDetailsTableRows:function(b,z){var c=h(".esriCTSelectableRow",b.currentTarget.parentNode.parentNode);
b=h(".esriCTGroupSummaryTotalRow",b.currentTarget.parentNode.parentNode);c&&0<c.length&&w.forEach(c,d.hitch(this,function(D){g.set(D,"tabindex",z)}));b&&0<b.length&&w.forEach(b,d.hitch(this,function(D){g.set(D,"tabindex",z)}))},_addAriaLableToRows:function(b){for(var z=b.rows[0].cells[1].innerHTML,c=1;c<b.rows.length;c++){for(var D=this.nls.workBench.objectIdColTitle,F=0;F<b.rows[c].cells.length;F++)0===F&&(D=D+" "+b.rows[c].cells[F].innerHTML),1===F&&(D=D+" "+z+" "+b.rows[c].cells[F].innerHTML),
2===F&&(D=D+" "+this.nls.workBench.costColTitle+" "+b.rows[c].cells[F].innerHTML);g.set(b.rows[c],"aria-label",D)}}})})},"widgets/CostAnalysis/cost-equation-editor":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./cost-equation-editor.html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-attr dojo/dom-class jimu/utils dojo/keys dojo/_base/event dijit/focus dijit/form/Textarea dijit/form/TextBox jimu/dijit/formSelect".split(" "),function(O,
J,K,I,v,e,d,a,w,t,g,l,A,h){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-equation-editor",_groupInfo:null,postCreate:function(){this.inherited(arguments);w.set(this.costEquationHint,"innerHTML",this.nls.workBench.costingInfoHintText);var p=g.stripHTML(this.nls.workBench.costingInfoHintText);w.set(this.costEquationHint,"aria-label",p)},startup:function(){this.inherited(arguments);this.own(a(this.okButton,"click",e.hitch(this,this._onOkButtonClicked)));this.own(a(this.okButton,
"keydown",e.hitch(this,function(p){if(p.keyCode===l.ENTER||p.keyCode===l.SPACE)A.stop(p),this._onOkButtonClicked()})));this.own(a(this.cancelButton,"click",e.hitch(this,function(){this.emit("onCancelButtonClicked")})));this.own(a(this.cancelButton,"keydown",e.hitch(this,function(p){if(p.keyCode===l.ENTER||p.keyCode===l.SPACE)A.stop(p),this.emit("onCancelButtonClicked")})));this.own(a(this.newCostEquationValue,"change",e.hitch(this,this._onEquationChange)));this.own(a(this.scenarioValue,"change",e.hitch(this,
this._onScenarioChange)))},_onOkButtonClicked:function(){var p={};t.contains(this.newCostEquationParent,"esriCTInvalidEquation")?this.appUtils.showMessage(this.nls.workBench.errorInvalidCostEquation):(p=this.scenarioValue._getSelectedOptionsAttr(),this._groupInfo.scenario!==p.scenario||this._groupInfo.equation.toLowerCase()!==this.newCostEquationValue.get("value").toLowerCase()?(p={templateInfo:{COSTEQUATION:this.newCostEquationValue.get("value"),SCENARIO:p.scenario},groupInfo:this._groupInfo},this.emit("onOkButtonClicked",
p)):this.emit("onCancelButtonClicked"))},_onEquationChange:function(){var p=!1;var k=g.sanitizeHTML(this.newCostEquationValue.get("value"));(p=this.appUtils.validateEquation(k))?(this.newCostEquationValue.set("value",k),t.remove(this.newCostEquationParent,"esriCTInvalidEquation")):t.add(this.newCostEquationParent,"esriCTInvalidEquation")},_onScenarioChange:function(){var p=this.scenarioValue._getSelectedOptionsAttr();this.newCostEquationValue.set("value",this._groupInfo.scenario===p.scenario?this._groupInfo.equation:
p.costEquation);this.defaultCostEquationValue.set("value",p.defaultEquation)},setGroupInfo:function(p){var k=p.region;var n=p.scenario;"null"===k&&(k=this.nls.scenarioSelection.noneText);this._groupInfo=p;this.geographyValue.set("value",k);p=this._getConfiguredCostEquations(p.layerId,p.templateName,p.region,n);this.scenarioValue.set("options",[]);this.scenarioValue.addOption(p);this._add508SupportCostEquationEditor()},_getConfiguredCostEquations:function(p,k,n,m){var C;var B=[];var y=[];this.config.costingInfoSettings.hasOwnProperty(p)&&
(B=this.config.costingInfoSettings[p]);"null"===n&&(n="");d.forEach(B,e.hitch(this,function(G){if(G.geography===n&&G.featureTemplate===k){var f;var b=f=G.scenario;f||(f=this.nls.scenarioSelection.noneText,b="null");f={label:f,value:G.costEquation,costEquation:G.costEquation,defaultEquation:G.costEquation,scenario:b,selected:!1};m===b&&(f.selected=!0,this.newCostEquationValue.set("value",this._groupInfo.equation),this.defaultCostEquationValue.set("value",G.costEquation));y.push(f)}""===G.geography&&
""===G.scenario&&G.featureTemplate===k&&(C=G.costEquation)}));0===y.length&&(y.push({label:this.nls.scenarioSelection.noneText,value:this._groupInfo.equation,costEquation:this._groupInfo.equation,defaultEquation:C,scenario:"null",selected:!0}),this.newCostEquationValue.set("value",this._groupInfo.equation),this.defaultCostEquationValue.set("value",C));return y},_add508SupportCostEquationEditor:function(){g.initFirstFocusNode(this.widgetDomNode,this.geographyValue.textbox);h.focus(this.geographyValue.textbox);
g.initLastFocusNode(this.widgetDomNode,this.cancelButton)}})})},"dijit/form/Textarea":function(){define(["dojo/_base/declare","dojo/dom-style","./_ExpandingTextAreaMixin","./SimpleTextarea"],function(O,J,K,I){return O("dijit.form.Textarea",[I,K],{baseClass:"dijitTextBox dijitTextArea dijitExpandingTextArea",cols:"",buildRendering:function(){this.inherited(arguments);J.set(this.textbox,{overflowY:"hidden",overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",
MozBoxSizing:"border-box"})}})})},"dijit/form/_ExpandingTextAreaMixin":function(){define("dojo/_base/declare dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/_base/window ../Viewport".split(" "),function(O,J,K,I,v,e,d){K.add("textarea-needs-help-shrinking",function(){var a=e.body(),w=J.create("textarea",{rows:"5",cols:"20",value:" ",style:{zoom:1,fontSize:"12px",height:"96px",overflow:"hidden",visibility:"hidden",position:"absolute",border:"5px solid white",margin:"0",padding:"0",boxSizing:"border-box",
MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"}},a,"last"),t=w.scrollHeight>=w.clientHeight;a.removeChild(w);return t});return O("dijit.form._ExpandingTextAreaMixin",null,{_setValueAttr:function(){this.inherited(arguments);this.resize()},postCreate:function(){this.inherited(arguments);var a=this.textbox;a.style.overflowY="hidden";this.own(v(a,"focus, resize",I.hitch(this,"_resizeLater")))},startup:function(){this.inherited(arguments);this.own(d.on("resize",I.hitch(this,
"_resizeLater")));this._resizeLater()},_onInput:function(a){this.inherited(arguments);this.resize()},_estimateHeight:function(){var a=this.textbox;a.rows=(a.value.match(/\n/g)||[]).length+1},_resizeLater:function(){this.defer("resize")},resize:function(){function a(){var k=!1;""===w.value&&(w.value=" ",k=!0);var n=w.scrollHeight;k&&(w.value="");return n}var w=this.textbox;"hidden"==w.style.overflowY&&(w.scrollTop=0);if(!this.busyResizing){this.busyResizing=!0;if(a()||w.offsetHeight){var t=a()+Math.max(w.offsetHeight-
w.clientHeight,0),g=t+"px";g!=w.style.height&&(w.style.height=g,w.rows=1);if(K("textarea-needs-help-shrinking")){var l=a(),A=w.style.minHeight,h=4,p=w.scrollTop;w.style.minHeight=g;for(w.style.height="auto";0<t;){w.style.minHeight=Math.max(t-h,4)+"px";g=a();l-=g;t-=l;if(l<h)break;l=g;h<<=1}w.style.height=t+"px";w.style.minHeight=A;w.scrollTop=p}w.style.overflowY=a()>w.clientHeight?"auto":"hidden";"hidden"==w.style.overflowY&&(w.scrollTop=0)}else this._estimateHeight();this.busyResizing=!1}}})})},
"widgets/CostAnalysis/add-new-statistics":function(){define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./add-new-statistics.html dojo/_base/lang dojo/on dojo/dom-construct ./setting/StatisticsSettings dojo/_base/array dojo/query dojo/keys dojo/_base/event".split(" "),function(O,J,K,I,v,e,d,a,w,t,g,l,A,h){return O([J,I,v],{templateString:e,baseClass:"jimu-widget-cost-analysis-add-new-statistics",_projectOverview:null,_lastConfiguredStatistics:null,
addNewStatisticsObj:null,postCreate:function(){this.inherited(arguments);this.addNewStatisticsObj=this._lastConfiguredStatistics=this._projectOverview=null},startup:function(){this.inherited(arguments);this._lastConfiguredStatistics=d.clone(this.config);this._lastConfiguredStatistics.statisticsSettings=[];this._initAddNewStatistics();this.own(a(this.okButtonNode,"click",d.hitch(this,function(){this._lastConfiguredStatistics.statisticsSettings=this.addNewStatisticsObj.getConfig();this.emit("updateStatisticsDetail",
this._getUpdatedStatistics());this.emit("showAssetStatisticsPanel")})));this.own(a(this.okButtonNode,"keydown",d.hitch(this,function(p){if(p.keyCode===A.ENTER||p.keyCode===A.SPACE)h.stop(p),this._lastConfiguredStatistics.statisticsSettings=this.addNewStatisticsObj.getConfig(),this.emit("updateStatisticsDetail",this._getUpdatedStatistics()),this.emit("showAssetStatisticsPanel")})));this.own(a(this.cancelButtonNode,"click",d.hitch(this,function(){this.emit("showAssetStatisticsPanel")})));this.own(a(this.cancelButtonNode,
"keydown",d.hitch(this,function(p){if(p.keyCode===A.ENTER||p.keyCode===A.SPACE)h.stop(p),this.emit("showAssetStatisticsPanel")})))},reset:function(){this._lastConfiguredStatistics=d.clone(this.config);this._lastConfiguredStatistics.statisticsSettings=[];this._initAddNewStatistics();this.emit("updateStatisticsDetail",[])},_initAddNewStatistics:function(){this.addNewStatisticsObj&&this.addNewStatisticsObj.destroy();this.addNewStatisticsObj=new t({nls:this.nls,map:this.map,config:this._lastConfiguredStatistics,
layerInfosObj:this.layerInfosObj,showActionButtonsInColumn:!1,showActionButtonsInRow:!0,widgetDomNode:this.widgetDomNode},w.create("div",{},this.addNewStatisticsNode));this.addNewStatisticsObj.startup();this.addNewStatisticsObj.resetAddNewStatisticsDropdown()},_getUpdatedStatistics:function(){var p;var k=[];var n=l(".simple-table-row",this.assetsListNode);g.forEach(n,d.hitch(this,function(m){m.layerNameDropDown&&m.statisticsTypeDropdown&&m.layerFieldDropdown&&m.statisticsLabelTextBox&&(p={},p.id=
m.layerNameDropDown.get("value"),p.type=m.statisticsTypeDropdown.get("value"),p.field=m.layerFieldDropdown.get("value"),p.label=K.sanitizeHTML(m.statisticsLabelTextBox.get("value")),k.push(p))}));return k}})})},"widgets/CostAnalysis/setting/StatisticsSettings":function(){define("dojo/_base/declare jimu/BaseWidget jimu/dijit/SimpleTable dojo/on dojo/_base/array dojo/query dojo/dom-construct jimu/dijit/formSelect dijit/form/ValidationTextBox dijit/_WidgetsInTemplateMixin dojo/text!./StatisticsSettings.html dojo/_base/lang dojo/store/Memory dojo/dom-class dijit/registry dojo/_base/html dojo/dom-style ./ProjectCost dojo/keys dojo/dom-attr dijit/focus jimu/utils dojo/_base/event".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f){return O([J,t],{templateString:g,baseClass:"jimu-widget-cost-analysis-statistics-settings",_layerNameStore:null,_commonStatisticsStoreOption:null,_polygonStatisticsStoreOption:null,_polylineStatisticsStoreOption:null,_pointLayerStatisticsStore:null,_polygonLayerStatisticsStore:null,_polylineLayerStatisticsStore:null,_layerFieldStore:{},_shapeFields:"shape_length shape_area shape__length shape__area shape.len shape.area".split(" "),_editableConfiguredLayers:[],
constructor:function(b){l.mixin(this,b)},postMixInProperties:function(){this.nls.common={};l.mixin(this.nls.common,window.jimuNls.common)},postCreate:function(){this._polylineLayerStatisticsStore=this._polygonLayerStatisticsStore=this._pointLayerStatisticsStore=this._polylineStatisticsStoreOption=this._polygonStatisticsStoreOption=this._commonStatisticsStoreOption=this._layerNameStore=null;this._layerFieldStore={};this._editableConfiguredLayers=[];this.inherited(arguments);this._init();this._handleClickEvent();
this.showActionButtonsInColumn&&this._createProjectCostTable()},_createProjectCostTable:function(){this.additionalProjectCostObj=new m({nls:this.nls,map:this.map,config:this.config},d.create("div",{},this.additionalProjectCostWrapper));this.additionalProjectCostObj.startup()},_handleClickEvent:function(){this._addButtonClick();this._crossButtonClick();this._upButtonClick();this._downButtonClick()},_init:function(){for(var b in this.config.layerSettings)this.config.layerSettings[b].editable&&this._editableConfiguredLayers.push(this.config.layerSettings[b].id);
this._createStatisticsStoreOptions();this._createStatisticsTable();this._layerNameStore||this._createLayerNameStore();this._attachNodeEvents();this._setConfig();this._displayAddStatisticsButtonOrLabel();this._handleActionButtonVisibility();0===this._editableConfiguredLayers.length&&(h.remove(this.noEditableLayersAvailable,"esriCTHidden"),h.add(this.btnAddStatisticsNodeWrapper,"esriCTHidden"),h.add(this.statisticsLayerTableNode,"esriCTHidden"),h.add(this.additionalProjectCostWrapper,"esriCTHidden"))},
_displayAddStatisticsButtonOrLabel:function(){this.showActionButtonsInColumn?h.remove(this.btnAddStatisticsNodeWrapper,"esriCTHidden"):h.add(this.btnAddStatisticsNodeWrapper,"esriCTHidden")},_setConfig:function(){this.config&&this.config.statisticsSettings&&0<this.config.statisticsSettings.length&&v.forEach(this.config.statisticsSettings,l.hitch(this,function(b){this._addLayerRow(b)}))},getConfig:function(){var b=this._statisticsLayerTable.getRows();var z=[];v.forEach(b,l.hitch(this,function(c){z.push({id:c.layerNameDropDown.getValue(),
type:c.statisticsTypeDropdown.getValue(),field:c.layerFieldDropdown.getValue(),label:c.statisticsLabelTextBox.getValue()})}));this.additionalProjectCostObj&&this.additionalProjectCostObj.getConfig();return z},_createStatisticsStoreOptions:function(){this._commonStatisticsStoreOption=[{name:this.nls.statisticsType.averageLabel,value:"avg"},{name:this.nls.statisticsType.countLabel,value:"count"},{name:this.nls.statisticsType.maxLabel,value:"max"},{name:this.nls.statisticsType.minLabel,value:"min"},
{name:this.nls.statisticsType.summationLabel,value:"sum"}];this._polygonStatisticsStoreOption=[{name:this.nls.statisticsType.areaLabel,value:"area"}];this._polylineStatisticsStoreOption=[{name:this.nls.statisticsType.lengthLabel,value:"length"}]},_attachNodeEvents:function(){0===this._layerNameStore.data.length?(h.remove(this.noEditableLayersAvailable,"esriCTHidden"),h.add(this.btnAddStatisticsNodeWrapper,"esriCTHidden"),h.add(this.statisticsLayerTableNode,"esriCTHidden")):(h.add(this.noEditableLayersAvailable,
"esriCTHidden"),h.remove(this.btnAddStatisticsNodeWrapper,"esriCTHidden"),h.remove(this.statisticsLayerTableNode,"esriCTHidden"));this.own(I(this.btnAddStatisticsNode,"click",l.hitch(this,function(){this._layerNameStore.data.length&&(this._addStatisticsBtnClicked(),this.resetAddNewStatisticsDropdown())})));this.own(I(this.btnAddStatisticsNode,"keydown",l.hitch(this,function(b){if(b.keyCode===C.ENTER||b.keyCode===C.SPACE)f.stop(b),this._layerNameStore.data.length&&(this._addStatisticsBtnClicked(),
this.resetAddNewStatisticsDropdown())})))},_createStatisticsTable:function(){this._statisticsLayerTable=new K({fields:[{name:"editable",title:this.nls.statisticsSettings.selectDeselectAllTitle,type:"checkbox",editable:!1,width:this.showActionButtonsInRow?"16px":"0%",hidden:!this.showActionButtonsInRow},{name:"field",title:this.nls.common.layer,type:"empty",editable:!1,width:"30%"},{name:"field",title:this.nls.common.type,type:"empty",editable:!0,width:this.showActionButtonsInRow?"19%":"18%"},{name:"field",
title:this.nls.statisticsSettings.fieldNameTitle,type:"empty",editable:!1,width:"22%"},{name:"field",title:this.nls.statisticsSettings.statisticsTitle,type:"empty",editable:!1,width:this.showActionButtonsInRow?"55px":"20%"},{name:"actions",title:this.nls.common.actions,width:"10%",type:"actions",actions:["up","down","delete"],hidden:!this.showActionButtonsInColumn}],selectable:!1});this._statisticsLayerTable.placeAt(this.statisticsLayerTableNode);this._statisticsLayerTable.startup();var b=e(".esriCTAddLayerTableNode th .label")[0];
var z=e(".esriCTAddLayerTableNode th .jimu-checkbox")[0];e(".esriCTAddLayerTableNode tr .jimu-checkbox");z&&h.add(z,"esriCTStatisticsHeaderCheckBox");b&&h.add(b,"esriCTHidden")},_addButtonClick:function(){!0===this.showActionButtonsInRow?(h.remove(this.btnAddNode,"esriCTHidden"),this.own(I(this.btnAddNode,"click",l.hitch(this,function(){this._addStatisticsButtonClickEvent()}))),this.own(I(this.btnAddNode,"keydown",l.hitch(this,function(b){if(b.keyCode===C.ENTER||b.keyCode===C.SPACE)f.stop(b),this._addStatisticsButtonClickEvent()})))):
h.add(this.btnAddNode,"esriCTHidden")},_addStatisticsButtonClickEvent:function(){if(this._layerNameStore.data.length&&(this._addStatisticsBtnClicked(),this._handleActionButtonVisibility(),this.resetAddNewStatisticsDropdown(),this.widgetDomNode)){var b=this._statisticsLayerTable.getRows();0<=b.length&&(b=e(".jimu-checkbox",b[b.length-1])[0],y.focus(b))}},_crossButtonClick:function(){h.remove(this.btnCrossNode,"esriCTHidden");this.own(I(this.btnCrossNode,"click",l.hitch(this,this._deleteLayerRow)));
this.own(I(this.btnCrossNode,"keydown",l.hitch(this,function(b){if(b.keyCode===C.ENTER||b.keyCode===C.SPACE)f.stop(b),this._deleteLayerRow()})))},_upButtonClick:function(){h.remove(this.btnUpNode,"esriCTHidden");this.own(I(this.btnUpNode,"click",l.hitch(this,function(){this._upButtonClickEvent()})));this.own(I(this.btnUpNode,"keydown",l.hitch(this,function(b){if(b.keyCode===C.ENTER||b.keyCode===C.SPACE)f.stop(b),this._upButtonClickEvent()})))},_upButtonClickEvent:function(){var b;if(!h.contains(this.btnUpNode,
"esriCTStatisticsUpIconDisable")){var z=this._statisticsLayerTable.getRows();var c=this._statisticsLayerTable.getData();v.forEach(c,l.hitch(this,function(D,F){D.editable&&(b=z[F])}));this._statisticsLayerTable.onBeforeRowUp(b)&&(c=v.indexOf(z,b),0<c&&(c=z[c-1]))&&(k.place(b,c,"before"),this._statisticsLayerTable.updateUI(),this._statisticsLayerTable.emit("row-up",b))}},_downButtonClick:function(){h.remove(this.btnDownNode,"esriCTHidden");this.own(I(this.btnDownNode,"click",l.hitch(this,function(){this._downButtonClickEvent()})));
this.own(I(this.btnDownNode,"keydown",l.hitch(this,function(b){if(b.keyCode===C.ENTER||b.keyCode===C.SPACE)f.stop(b),this._downButtonClickEvent()})))},_downButtonClickEvent:function(){var b;if(!h.contains(this.btnDownNode,"esriCTStatisticsDownIconDisable")){var z=this._statisticsLayerTable.getRows();var c=this._statisticsLayerTable.getData();v.forEach(c,l.hitch(this,function(D,F){D.editable&&(b=z[F])}));this._statisticsLayerTable.onBeforeRowDown(b)&&(c=v.indexOf(z,b),c<z.length-1&&(c=z[c+1]))&&(k.place(b,
c,"after"),this._statisticsLayerTable.updateUI(),this._statisticsLayerTable.emit("row-down",b))}},_deleteLayerRow:function(){var b=this._statisticsLayerTable.getRows(),z=this._statisticsLayerTable.getData();v.forEach(z,l.hitch(this,function(c,D){c.editable&&this._statisticsLayerTable.deleteRow(b[D])}));0===this._statisticsLayerTable.getRows().length&&(z=e("th .checkbox")[0],h.contains(z,"checked")&&h.remove(z,"checked"));this._handleActionButtonVisibility()},_checkEditCapabilities:function(b){var z;
return(z=b&&b.capabilities?b.capabilities:null)&&-1!==z.indexOf("Delete")&&-1!==z.indexOf("Create")&&-1!==z.indexOf("Update")&&b.globalIdField?!0:!1},_addStatisticsBtnClicked:function(){this._addLayerRow();var b=e(".simple-table-title .jimu-checkbox",this.domNode)[0];I(p.byNode(b),"change",l.hitch(this,function(){setTimeout(l.hitch(this,function(){this._handleActionButtonVisibility()}),0)}))},_handleActionButtonVisibility:function(){var b,z=0;var c=this._statisticsLayerTable.getRows();var D=e(".simple-table-title .jimu-checkbox",
this.domNode)[0];D=p.byNode(D);v.some(this._statisticsLayerTable.getRows(),l.hitch(this,function(F){b=e(".jimu-checkbox",F)[0];p.byNode(b).checked&&z++}));0===z?(h.replace(this.btnCrossNode,"esriCTDeleteStatisticsIconDisable","esriCTDeleteStatisticsIcon"),B.set(this.btnCrossNode,"tabindex","-1")):(h.replace(this.btnCrossNode,"esriCTDeleteStatisticsIcon","esriCTDeleteStatisticsIconDisable"),B.set(this.btnCrossNode,"tabindex","0"));c&&1===z?(h.replace(this.btnUpNode,"esriCTStatisticsUpIcon","esriCTStatisticsUpIconDisable"),
h.replace(this.btnDownNode,"esriCTStatisticsDownIcon","esriCTStatisticsDownIconDisable"),B.set(this.btnUpNode,"tabindex","0"),B.set(this.btnDownNode,"tabindex","0")):(h.replace(this.btnUpNode,"esriCTStatisticsUpIconDisable","esriCTStatisticsUpIcon"),h.replace(this.btnDownNode,"esriCTStatisticsDownIconDisable","esriCTStatisticsDownIcon"),B.set(this.btnUpNode,"tabindex","-1"),B.set(this.btnDownNode,"tabindex","-1"));0===c.length?(D.set("status",!1),h.add(D.domNode,"jimu-state-disabled"),B.set(D.domNode,
"tabindex","-1"),this.widgetDomNode&&(y.focus(this.btnAddNode),G.initFirstFocusNode(this.widgetDomNode,this.btnAddNode))):(D.set("status",!0),h.remove(D.domNode,"jimu-state-disabled"),B.set(D.domNode,"tabindex","0"),this.widgetDomNode&&G.initFirstFocusNode(this.widgetDomNode,D.domNode))},_addLayerRow:function(b){var z=this._statisticsLayerTable.addRow({});var c=e(".simple-table-cell",z.tr);var D=e(".simple-table-cell .jimu-checkbox",z.tr)[0];B.set(D,"aria-label",this.nls.statisticsSettings.layerCheckbox);
c&&(D&&I(p.byNode(D),"change",l.hitch(this,function(){this._handleActionButtonVisibility()})),z=z.tr,this._addLayerNameDropdown(c[1],z,b),this._addStatisticsDropdown(c[2],z,b),this._addLayerFieldDropdown(c[3],z,b),this._addStatisticsLabelTextBox(c[4],z,b))},_onLayerNameChange:function(b,z,c){if(this._layerNameStore.data.length){var D=this._layerNameStore.data[this._layerNameStore.index[b]].geometryType;D=this._getStatisticsTypeStore(D);z.statisticsTypeDropdown.setStore(D);c&&c.type&&z.statisticsTypeDropdown.set("value",
c.type);c=z.statisticsTypeDropdown.getValue();b=this._layerNameStore.data[this._layerNameStore.index[b]].value;this._layerFieldStore[b]||this._createFieldStore(b);z.layerFieldDropdown.setStore(this._layerFieldStore[b]);z.layerFieldDropdown.reset();this._onStatisticsTypeChange(c,z)}},_onStatisticsTypeChange:function(b,z,c){"count"===b||"length"===b||"area"===b?h.add(z.layerFieldDropdown.domNode,"esriCTHidden"):(h.remove(z.layerFieldDropdown.domNode,"esriCTHidden"),c&&c.field&&z.layerFieldDropdown.set("value",
c.field));this._resetStatisticsTypeWidth(z)},_addLayerNameDropdown:function(b,z,c){b=d.create("div",{"class":"esriCTDropDownContainer"},b);z.layerNameDropDown=new a({name:"layerSelect",store:this._layerNameStore,labelAttr:"name","class":"esriCTLayerNameDropdown"},b);c&&c.id&&z.layerNameDropDown.set("value",c.id);this.own(I(z.layerNameDropDown,"click",l.hitch(this,function(){this._resetLayerNameWidth(z)})));this.own(I(z.layerNameDropDown,"keydown",l.hitch(this,function(D){if(D.keyCode===C.ENTER||D.keyCode===
C.SPACE)f.stop(D),this._resetLayerNameWidth(z)})));this.own(I(z.layerNameDropDown,"change",l.hitch(this,function(D){B.set(z.layerNameDropDown,"aria-label",this.nls.common.layer+" "+z.layerNameDropDown._getSelectedOptionsAttr().label);this._resetLayerNameWidth(z);this._onLayerNameChange(D,z,c)})));z.layerNameDropDown.startup();B.set(z.layerNameDropDown,"aria-label",this.nls.common.layer+" "+z.layerNameDropDown._getSelectedOptionsAttr().label)},_createLayerNameStore:function(){var b=[];var z=[];b=[this.config.projectSettings.costingGeometryLayer||
"",this.config.projectSettings.projectLayer||"",this.config.projectSettings.pointLayerCentroid||""];if(this.config.layerSettings.length&&this._editableConfiguredLayers.length){var c=this.config.layerSettings;v.forEach(c,l.hitch(this,function(D){b.push(D.id);var F=this._getFeatureLayerGeometryType(D.id);D.editable&&F&&z.push({name:D.title,value:D.id,geometryType:F})}))}this._layerNameStore=new A({idProperty:"value",data:z});z.length&&this._updateLayerNameOptions()},_updateLayerNameOptions:function(){var b;
var z=e(".esriCTLayerNameDropdown",this.domNode);v.forEach(z,l.hitch(this,function(c){b=p.byNode(c).get("value");p.byNode(c).set("store",this._layerNameStore);p.byNode(c).set("value",b)}));0===this._editableConfiguredLayers.length?(h.remove(this.noEditableLayersAvailable,"esriCTHidden"),h.add(this.btnAddStatisticsNodeWrapper,"esriCTHidden"),h.add(this.statisticsLayerTableNode,"esriCTHidden"),h.add(this.additionalProjectCostWrapper,"esriCTHidden")):(h.add(this.noEditableLayersAvailable,"esriCTHidden"),
h.remove(this.btnAddStatisticsNodeWrapper,"esriCTHidden"),h.remove(this.statisticsLayerTableNode,"esriCTHidden"),h.remove(this.additionalProjectCostWrapper,"esriCTHidden"))},_getFeatureLayerGeometryType:function(b){var z=v.filter(this.map.webMapResponse.itemInfo.itemData.operationalLayers,l.hitch(this,function(c){return b===c.id}));return z.length&&z[0].layerObject?z[0].layerObject.geometryType:null},_createStatisticsTypeStore:function(){this._pointLayerStatisticsStore||this._polygonLayerStatisticsStore||
this._polylineLayerStatisticsStore||(this._createPointGeometryStatisticsStore(),this._createPolygonGeometryStatisticsStore(),this._createPolylineGeometryStatisticsStore())},_getStatisticsTypeStore:function(b){switch(b){case "esriGeometryPolygon":return this._polygonLayerStatisticsStore;case "esriGeometryPolyline":return this._polylineLayerStatisticsStore;case "esriGeometryPoint":return this._pointLayerStatisticsStore}},_addStatisticsDropdown:function(b,z,c){b=d.create("div",{"class":"esriCTDropDownContainer"},
b);this._createStatisticsTypeStore();var D=z.layerNameDropDown._getSelectedOptionsAttr().item.geometryType;D=this._getStatisticsTypeStore(D);z.statisticsTypeDropdown=new a({name:"statisticsTypeSelect",store:D,labelAttr:"name","class":"esriCTStatisticsTypeDropdown"},b);this.own(I(z.statisticsTypeDropdown,"click",l.hitch(this,function(){this._resetStatisticsTypeWidth(z)})));this.own(I(z.statisticsTypeDropdown,"keydown",l.hitch(this,function(F){if(F.keyCode===C.ENTER||F.keyCode===C.SPACE)f.stop(F),this._resetStatisticsTypeWidth(z)})));
this.own(I(z.statisticsTypeDropdown,"change",l.hitch(this,function(F){this._resetStatisticsTypeWidth(z);this._onStatisticsTypeChange(F,z,c);B.set(z.statisticsTypeDropdown,"aria-label","type "+z.statisticsTypeDropdown._getSelectedOptionsAttr().label)})));B.set(z.statisticsTypeDropdown,"aria-label","Type "+z.statisticsTypeDropdown._getSelectedOptionsAttr().label);z.statisticsTypeDropdown.startup()},_createPointGeometryStatisticsStore:function(){this._pointLayerStatisticsStore=new A({idProperty:"value",
data:this._commonStatisticsStoreOption})},_createPolygonGeometryStatisticsStore:function(){this._polygonLayerStatisticsStore=new A({idProperty:"value",data:this._commonStatisticsStoreOption.concat(this._polygonStatisticsStoreOption)})},_createPolylineGeometryStatisticsStore:function(){this._polylineLayerStatisticsStore=new A({idProperty:"value",data:this._commonStatisticsStoreOption.concat(this._polylineStatisticsStoreOption)})},_createFieldStore:function(b){var z=[];var c=["esriFieldTypeDouble",
"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSmallFloat"];this._layerFieldStore[b]||(v.forEach(this.map._layers[b].fields,l.hitch(this,function(D){-1<c.indexOf(D.type)&&-1===this._shapeFields.indexOf(D.name.toLowerCase())&&z.push({name:D.alias||D.name,value:D.name})})),0===z.length&&z.push({name:"\x26nbsp",value:null}),this._layerFieldStore[b]=new A({idProperty:"value",data:z}))},_addLayerFieldDropdown:function(b,z){b=d.create("div",{"class":"esriCTDropDownContainer"},b);var c=
z.layerNameDropDown._getSelectedOptionsAttr().value;this._createFieldStore(c);z.layerFieldDropdown=new a({name:"layerFieldDropdown",store:this._layerFieldStore[c],labelAttr:"name","class":"esriCTStatisticsFieldDropdown"},b);this.own(I(z.layerFieldDropdown,"click",l.hitch(this,function(){this._resetLayerFieldWidth(z)})));this.own(I(z.layerFieldDropdown,"keydown",l.hitch(this,function(D){if(D.keyCode===C.ENTER||D.keyCode===C.SPACE)f.stop(D),this._resetLayerFieldWidth(z)})));this.own(I(z.layerFieldDropdown,
"change",l.hitch(this,function(){this._resetLayerFieldWidth(z);B.set(z.layerFieldDropdown,"aria-label",this.nls.statisticsSettings.fieldNameTitle+" "+z.layerFieldDropdown.value)})));z.layerFieldDropdown.startup();b=z.statisticsTypeDropdown.getValue();this._onStatisticsTypeChange(b,z);B.set(z.layerFieldDropdown,"aria-label",this.nls.statisticsSettings.fieldNameTitle+" "+z.layerFieldDropdown.value)},_addStatisticsLabelTextBox:function(b,z,c){b=d.create("div",{"class":"esriCTTextBoxContainer"},b);z.statisticsLabelTextBox=
new w({"class":"esriCTLayerLabelTextBox"},b);c&&c.label&&z.statisticsLabelTextBox.set("value",c.label);z.statisticsLabelTextBox.startup();B.set(z.statisticsLabelTextBox,"aria-label",this.nls.statisticsSettings.statisticsTitle+" "+z.statisticsLabelTextBox.get("value"))},_updateStatisticsTable:function(b){var z,c;b.layerId&&(b.editable?z=b.layerId:c=b.layerId);c&&(b=this._statisticsLayerTable.getRows(),v.forEach(b,l.hitch(this,function(D){D.layerNameDropDown&&D.layerNameDropDown.get("value")===c&&this._statisticsLayerTable.deleteRow(D)})),
this._layerNameStore.remove(c),b=this._editableConfiguredLayers.indexOf(c),-1!==b&&this._editableConfiguredLayers.splice(b,1));z&&""!==z&&(b=this.layerInfosObj.getLayerInfoById(z))&&b.layerObject&&(b=b.layerObject,this._layerNameStore.put({name:b.name,value:z,geometryType:b.geometryType}),this._editableConfiguredLayers.push(z));this._updateLayerNameOptions()},resetAddNewStatisticsDropdown:function(){var b,z,c,D,F;if(b=e(".simple-table-field.field",this._statisticsLayerTable.domNode))b[0]&&(z=n.getComputedStyle(b[0])),
b[1]&&(c=n.getComputedStyle(b[1])),b[2]&&(D=n.getComputedStyle(b[2]));b=e(".esriCTLayerNameDropdown",this._statisticsLayerTable.domNode);v.forEach(b,l.hitch(this,function(R){(R=e(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel",R))&&R[0]&&(F=this.showActionButtonsInColumn?59:30,R[0].style.width=parseInt(z.width,10)-F+"px")}));b=e(".esriCTStatisticsTypeDropdown",this._statisticsLayerTable.domNode);v.forEach(b,l.hitch(this,function(R){(R=e(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel",
R))&&R[0]&&(F=this.showActionButtonsInColumn?59:30,R[0].style.width=parseInt(c.width,10)-F+"px")}));b=e(".esriCTStatisticsFieldDropdown",this._statisticsLayerTable.domNode);v.forEach(b,l.hitch(this,function(R){(R=e(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel",R))&&R[0]&&(F=this.showActionButtonsInColumn?59:30,R[0].style.width=parseInt(D.width,10)-F+"px")}))},_resetLayerNameWidth:function(b){var z,c;(z=e(".simple-table-field.field",this._statisticsLayerTable.domNode))&&z[0]&&
(c=n.getComputedStyle(z[0]));b=e(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel",b.layerNameDropDown.domNode);z=this.showActionButtonsInColumn?59:30;b&&b[0]&&(b[0].style.width=parseInt(c.width,10)-z+"px")},_resetStatisticsTypeWidth:function(b){var z,c;(c=e(".simple-table-field.field",this._statisticsLayerTable.domNode))&&c[1]&&(z=n.getComputedStyle(c[1]));b=e(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel",b.statisticsTypeDropdown.domNode);c=this.showActionButtonsInColumn?
59:30;b&&b[0]&&(b[0].style.width=parseInt(z.width,10)-c+"px")},_resetLayerFieldWidth:function(b){var z,c;(z=e(".simple-table-field.field",this._statisticsLayerTable.domNode))&&z[2]&&(c=n.getComputedStyle(z[2]));b=e(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel",b.layerFieldDropdown.domNode);z=this.showActionButtonsInColumn?59:30;b&&b[0]&&(b[0].style.width=parseInt(c.width,10)-z+"px")}})})},"widgets/CostAnalysis/setting/ProjectCost":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./ProjectCost.html dojo/_base/lang dojo/on jimu/dijit/SimpleTable dojo/query dijit/form/ValidationTextBox dojo/dom-construct dijit/form/Select dojo/_base/array dojo/store/Memory".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-project-cost-settings",_costFieldStore:null,postCreate:function(){this.inherited(arguments);this._handleClickEvents()},_setConfig:function(){this.config&&this.config.projectCostSettings&&0<this.config.projectCostSettings.length&&A.forEach(this.config.projectCostSettings,e.hitch(this,function(p){this._addProjectCostLayerRow(p)}))},startup:function(){this.inherited(arguments);this._createProjectCostFieldTable();
this._createProjectCostTypeFieldStore();this._setConfig()},getConfig:function(){var p=this._projectCostTable.getRows();var k=[];A.some(p,e.hitch(this,function(n){k.push({label:n.projectCostLabelTextBox.getValue(),type:n.projectCostTypeDropdown.getValue(),value:n.projectCostValueTextBox.getValue()})}));return k},validateProjectCostData:function(){var p=this._projectCostTable.getRows();for(var k in p){var n=p[k];if(!n.projectCostLabelTextBox.isValid())return this._setErrorMessage(n.projectCostLabelTextBox,
this.nls.projectCostSettings.invalidProjectCostMessage),{isValid:!1};if(!n.projectCostValueTextBox.isValid())return this._setErrorMessage(n.projectCostValueTextBox,this.nls.projectCostSettings.invalidProjectCostMessage),{isValid:!1}}return{isValid:!0}},_setErrorMessage:function(p,k){p.set("state","Error");p.set("invalidMessage",k);p.focus();p.isValid()},_handleClickEvents:function(){this.own(d(this.btnAddProjectCostNode,"click",e.hitch(this,function(){this._addProjectCostBtnClicked()})));this.own(d(this.btnCrossNode,
"click",e.hitch(this,function(){this._deleteLayerRow()})))},_createProjectCostFieldTable:function(){this._projectCostTable=new a({fields:[{name:"editable",title:this.nls.common.label,type:"empty",editable:!1,width:"35%"},{name:"field",title:this.nls.common.type,type:"empty",editable:!1,width:"20%"},{name:"field",title:this.nls.projectCostSettings.additionalCostValueColumnHeader,type:"empty",editable:!0,width:"35%"},{name:"actions",title:this.nls.common.actions,width:"10%",type:"actions",actions:["up",
"down","delete"]}],selectable:!1,autoHeight:!0});this._projectCostTable.placeAt(this.projectCostTableNode);this._projectCostTable.startup()},_addProjectCostBtnClicked:function(){this._addProjectCostLayerRow()},_addProjectCostLayerRow:function(p){var k;var n=this._projectCostTable.addRow({});if(k=w(".simple-table-cell",n.tr))n=n.tr,this._addProjectCostLabelTextBox(k[0],n,p),this._addProjectCostTypeDropdown(k[1],n,p),this._addProjectCostValueTextBox(k[2],n,p)},_addProjectCostLabelTextBox:function(p,
k,n){p=g.create("div",{"class":"esriCTTextBoxContainer"},p);k.projectCostLabelTextBox=new t({"class":"esriCTProjectCostLabelTextbox esriCTAddProjectCostTableNode",invalidMessage:"Invalid Entry for project cost"},p);k.projectCostLabelTextBox.startup();n&&n.label&&k.projectCostLabelTextBox.set("value",n.label);k.projectCostLabelTextBox.validator=e.hitch(this,this._validateProjectCostLabelFields)},_validateProjectCostLabelFields:function(p){return""===e.trim(p)?!1:!0},_addProjectCostTypeDropdown:function(p,
k,n){p=g.create("div",{"class":"esriCTProjectCostTypeDropDownContainer esriCTAddProjectCostTableNode"},p);k.projectCostTypeDropdown=new l({name:"layerSelect",store:this._projectCostFieldStore,labelAttr:"name","class":"esriCTProjectCostTypeDropdown"},p);n&&n.type&&k.projectCostTypeDropdown.set("value",n.type);k.projectCostTypeDropdown.startup()},_addProjectCostValueTextBox:function(p,k,n){p=g.create("div",{"class":"esriCTProjectCostTextBoxContainer esriCTAddProjectCostTableNode"},p);k.projectCostValueTextBox=
new t({"class":"esriCTProjectCostLabelTextbox",trim:!0,invalidMessage:"Invalid Entry for project cost"},p);k.projectCostValueTextBox.startup();n&&n.value&&k.projectCostValueTextBox.set("value",n.value);k.projectCostValueTextBox.validator=e.hitch(this,this._validateProjectCostValueFields)},_validateProjectCostValueFields:function(p){p=Number(p);return""===p||isNaN(p)||"0"===p||0===p?!1:!0},_deleteLayerRow:function(){var p=this._projectCostTable.getRows(),k=this._projectCostTable.getData();A.forEach(k,
e.hitch(this,function(n,m){n.editable&&this._projectCostTable.deleteRow(p[m])}))},_createProjectCostTypeFieldStore:function(){var p=[];p.push({name:"+",value:"+"});p.push({name:"*",value:"*"});p.push({name:"-",value:"_"});p.push({name:"%",value:"%"});this._projectCostFieldStore=new h({idProperty:"value",data:p})}})})},"widgets/CostAnalysis/project-attribute":function(){define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented dijit/layout/ContentPane dijit/_WidgetsInTemplateMixin dojo/text!./project-attribute.html dojo/_base/lang dojo/_base/array dojo/dom-style dojo/on dojo/dom-construct dojo/dom-class esri/dijit/AttributeInspector esri/layers/FeatureLayer esri/tasks/query dojo/query dijit/registry dijit/focus dojo/keys dojo/_base/event dojo/dom-attr".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G){return O([J,I,e],{templateString:d,baseClass:"jimu-widget-cost-analysis-project-attribute",projectInfo:null,_projectLayerInfo:null,_updatedFeature:null,_attributeInspector:null,postCreate:function(){this.inherited(arguments);this.onProjectLoad(this.projectInfo)},startup:function(){this.inherited(arguments);this.own(g(this.okButton,"click",a.hitch(this,function(){this._onOkButtonClicked()})));this.own(g(this.okButton,"keydown",a.hitch(this,function(f){if(f.keyCode===
B.ENTER||f.keyCode===B.SPACE)y.stop(f),this._onOkButtonClicked()})));this.own(g(this.cancelButton,"click",a.hitch(this,function(){this.emit("onCancelButtonClicked")})));this.own(g(this.cancelButton,"keydown",a.hitch(this,function(f){if(f.keyCode===B.ENTER||f.keyCode===B.SPACE)y.stop(f),this.emit("onCancelButtonClicked")})))},_onOkButtonClicked:function(){this._updatedFeature&&this._updatedFeature.getLayer().applyEdits(null,[this._updatedFeature],null,a.hitch(this,function(f,b,z){b[0].success&&this.emit("onProjectInfoUpdate",
this._updatedFeature)}));this.emit("onOkButtonClicked")},onProjectLoad:function(f){this.projectInfo=f;f=this.config.projectSettings.projectLayer;this.projectInfo.projectId&&f&&(this._projectLayerInfo=this.layerInfosObj.getLayerInfoById(f),this._loadAttributeInspector())},editProjectAttributes:function(){var f="";if(this._projectLayerInfo){this.loadingIndicator.show();var b=Date.now();this._updatedFeature=null;var z=new k;(f=this._projectLayerInfo.layerObject.getDefinitionExpression())&&this._projectLayerInfo.layerObject.setDefinitionExpression("");
z.where=this._projectLayerInfo.layerObject.globalIdField+" \x3d '"+this.projectInfo.projectId+"' AND "+b+" \x3d "+b;this._projectLayerInfo.layerObject.selectFeatures(z,p.SELECTION_NEW,a.hitch(this,function(c){this._updatedFeature=c[0];this._attributeInspector&&(this._attributeInspector.refresh(),t.set(this._attributeInspector.attributeTable,"display",""),this._attributeInspector.attributeTable&&this._attributeInspector.attributeTable.childNodes&&0<this._attributeInspector.attributeTable.childNodes.length&&
G.set(this._attributeInspector.attributeTable.childNodes[0],"cellspacing","1"));this.loadingIndicator.hide();f&&this._projectLayerInfo.layerObject.setDefinitionExpression(f);this._add508SupportToATI()}))}},mergeFirstToLast:function(){for(var f={},b=arguments.length-1,z;0<=b;b--)for(z in arguments[b])arguments[b].hasOwnProperty(z)&&(f[z]=arguments[b][z]);return f},_getFieldInfosFromLayer:function(f){var b=[];f&&f.layerObject&&w.forEach(f.layerObject.fields,function(z){var c=K.getDefaultPortalFieldInfo(z);
c=this.mergeFirstToLast(c,z);c.format&&c.format.dateFormat&&c.format.dateFormat.toLowerCase()&&0<=c.format.dateFormat.toLowerCase().indexOf("time")&&(c.format.time=!0);c.visible=!0;b.push(c)},this);return b},_createFieldInfos:function(){var f=this._projectLayerInfo.controlPopupInfo&&this._projectLayerInfo.controlPopupInfo.enablePopup&&this._projectLayerInfo.controlPopupInfo.infoTemplate?a.clone(this._projectLayerInfo.controlPopupInfo.infoTemplate.info.fieldInfos):this._getFieldInfosFromLayer(this._projectLayerInfo);
var b=[];w.forEach(f,a.hitch(this,function(z){if(z.visible){if("projectname"===z.fieldName.toLowerCase()||"totalassetcost"===z.fieldName.toLowerCase()||"grossprojectcost"===z.fieldName.toLowerCase())z.isEditable=!1;b.push(z)}}));return b},_loadAttributeInspector:function(){if(this._projectLayerInfo){var f=this._createFieldInfos();l.empty(this.projectAttributeNode);var b=new v({style:{padding:"0"}},l.create("div",{},this.projectAttributeNode));this._attributeInspector=new h({layerInfos:[{featureLayer:this._projectLayerInfo.layerObject,
showAttachments:!1,isEditable:!0,fieldInfos:f}]},l.create("div"));this._attributeInspector.on("attribute-change",a.hitch(this,function(z){this._updatedFeature.attributes[z.fieldName]=z.fieldValue}));A.add(this._attributeInspector.layerName,"esriCTHidden");A.add(this._attributeInspector.editButtons,"esriCTHidden");b.setContent(this._attributeInspector.domNode)}},_add508SupportToATI:function(){var f;if(this._attributeInspector&&this._attributeInspector.domNode){var b=m.findWidgets(this._attributeInspector.domNode);
w.forEach(b,a.hitch(this,function(z){z.focusNode&&!f&&(f=z.focusNode,K.initFirstFocusNode(this.widgetDomNode,z.focusNode),C.focus(z.focusNode));z.hasOwnProperty("focusNode")&&z.focusNode.disabled&&(G.set(z.focusNode,"disabled",!1),G.set(z.focusNode,"tabindex",0),G.set(z.focusNode,"readOnly",!0),G.set(z.focusNode,"aria-disabled","true"))}));(b=n("td.atiLabel",this._attributeInspector.domNode))&&w.forEach(b,a.hitch(this,function(z){var c=this._getAttrInspectorRowInfo(z);c&&(c[0].set("aria-label",c[1]),
1<z.parentNode.childNodes[1].childNodes.length&&(z=z.parentNode.childNodes[1].childNodes[1],z=m.getEnclosingWidget(z),z.set("aria-label",c[1])))}))}K.initLastFocusNode(this.widgetDomNode,this.cancelButton)},_getAttrInspectorRowInfo:function(f){try{if(f&&f.parentNode){var b=f.parentNode.childNodes[1].childNodes[0];return[m.getEnclosingWidget(b),f.childNodes[0].data,b]}return null}catch(z){return console.log(z),null}}})})},"widgets/CostAnalysis/asset-statistics":function(){define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./asset-statistics.html dojo/_base/lang dojo/on dojo/_base/array dojo/dom-construct dijit/form/TextBox dojo/keys jimu/utils dijit/focus".split(" "),
function(O,J,K,I,v,e,d,a,w,t,g,l,A){return O([J,K,I],{templateString:v,baseClass:"jimu-widget-cost-analysis-asset-statistics",_layerNamesObj:{},_statTypeNames:{},postCreate:function(){this.inherited(arguments);this._layerNamesObj={};this._statTypeNames={count:this.nls.statisticsType.countLabel,area:this.nls.statisticsType.areaLabel,length:this.nls.statisticsType.lengthLabel,avg:this.nls.statisticsType.averageLabel,sum:this.nls.statisticsType.summationLabel,max:this.nls.statisticsType.maxLabel,min:this.nls.statisticsType.minLabel}},
startup:function(){this.inherited(arguments);this._getLayerNames();this._initAssetStatistics();this.own(d(this.okButton,"click",e.hitch(this,function(){this.emit("onOkButtonClicked")})));this.own(d(this.okButton,"keydown",e.hitch(this,function(h){h.keyCode!==g.ENTER&&h.keyCode!==g.SPACE||this.emit("onOkButtonClicked")})))},_initAssetStatistics:function(){this.displayStatisticsDetail(this.config.statisticsSettings)},displayStatisticsDetail:function(h){w.empty(this.assetsListNode);0===h.length?(h=w.create("div",
{innerHTML:this.nls.detailStatistics.noDetailStatisticAvailable,"class":"esriCTNoDetailStatisticMessage",tabindex:"0",role:"presentation","aria-label":this.nls.detailStatistics.noDetailStatisticAvailable},this.assetsListNode),A.focus(h)):a.forEach(h,e.hitch(this,function(p){this._addStatisticEntry(p)}))},_addStatisticEntry:function(h){var p="";var k="";(k=this.layerInfosObj.getLayerInfoById(h.id))&&k.layerObject&&(p=this.appUtils.getUnitsAbbreviation(k.layerObject.geometryType,this.config.generalSettings.measurementUnit));
var n=this._getFeatureValue(h);"count"!==h.type&&(n=this.appUtils.applyRounding(n));if("length"===h.type||"area"===h.type)n+=" "+p;k=h.label?h.label:this._layerNamesObj[h.id]+" ("+this._statTypeNames[h.type]+")";"NaN"===n&&(n=0);this._createStatisticsDetailUI(k,n)},_createStatisticsDetailUI:function(h,p){var k=w.create("div",{"class":"esriCTStatisticWrapper"},this.assetsListNode);w.create("div",{"class":"esriCTStatisticLabel esriCTEllipsis",title:h,innerHTML:h},k);k=w.create("div",{},k);new t({value:p,
"aria-label":h,"class":"esriCTFullwidth esriCTEllipsis esriCTAssetDetailTextBox",tabindex:"0",readonly:!0,role:"presentation"},k)},_getLayerNames:function(){a.forEach(this.map.itemInfo.itemData.operationalLayers,e.hitch(this,function(h){this._layerNamesObj[h.id]=h.title}))},_getFeatureValue:function(h){if(0<Object.keys(this.assetItemSummary).length&&this.assetItemSummary[h.id]){var p=this.assetItemSummary[h.id].templates;var k=h.field;h=h.type;return this._calculateFeatureValue(p,k,h)}return"0"},
_calculateFeatureValue:function(h,p,k){switch(k){case "count":return this._calculateCountOfFeatures(h);case "area":return this._calculateAreaLengthOfFeatures(h);case "length":return this._calculateAreaLengthOfFeatures(h);case "avg":return this._calculateAvgSumOfFeatures(h,p,k);case "sum":return this._calculateAvgSumOfFeatures(h,p,k);case "max":return this._calculateMinMaxOfFeatures(h,p,k);case "min":return this._calculateMinMaxOfFeatures(h,p,k);case "default":return""}},_calculateCountOfFeatures:function(h){var p=
0;for(v in h)p+=h[v].features.length;return p},_calculateAreaLengthOfFeatures:function(h){var p=0;for(v in h)p+=this._getFeatureDimension(h[v]);return p},_getFeatureDimension:function(h){var p=0;a.forEach(h.features,function(k){p+=k.featureDimension});return p},_calculateAvgSumOfFeatures:function(h,p,k){var n=0,m=0;if(""===p)return"";for(v in h)m+=this._getSumAndCountOfFields(h[v].features,p).count,n+=this._getSumAndCountOfFields(h[v].features,p).total;return"avg"===k?n/m:n},_getSumAndCountOfFields:function(h,
p){var k=0,n=0;a.forEach(h,function(m){m.attributes[p]&&(k+=m.attributes[p],n++)});return{total:k,count:n}},_calculateMinMaxOfFeatures:function(h,p,k){if(""===p)return"";var n=[];var m=[];for(v in h)n=this._getFeatureAttributesArray(h[v].features,p,m);return"max"===k?Math.max.apply(null,n):Math.min.apply(null,n)},_getFeatureAttributesArray:function(h,p,k){a.forEach(h,function(n){n.attributes[p]?k.push(n.attributes[p]):k.push("")});return k},setFirstAndLastNode:function(){l.initFirstFocusNode(this.widgetDomNode,
this.addNewStatisticsIcon);A.focus(this.addNewStatisticsIcon);l.initLastFocusNode(this.widgetDomNode,this.okButton)}})})},"widgets/CostAnalysis/utils":function(){define("esri/request esri/geometry/geometryEngine dojo/Deferred dojo/_base/lang jimu/dijit/Message dojo/_base/array jimu/utils dijit/focus".split(" "),function(O,J,K,I,v,e,d,a){var w={};w.units={feet:{lengthUnit:"feet",areaUnit:"square-feet",bufferUnit:"UNIT_FOOT",lengthAbbr:window.jimuNls.units.feetAbbr,areaAbbr:window.jimuNls.units.squareFeetAbbr},
meters:{lengthUnit:"meters",areaUnit:"square-meters",bufferUnit:"UNIT_METER",lengthAbbr:window.jimuNls.units.metersAbbr,areaAbbr:window.jimuNls.units.squareMetersAbbr},miles:{lengthUnit:"miles",areaUnit:"square-miles",bufferUnit:"UNIT_STATUTE_MILE",lengthAbbr:window.jimuNls.units.milesAbbr,areaAbbr:window.jimuNls.units.squareMilesAbbr},yards:{lengthUnit:"yards",areaUnit:"square-yards",bufferUnit:"UNIT_SURVEY_YARD",lengthAbbr:window.jimuNls.units.yardsAbbr,areaAbbr:window.jimuNls.units.squareYardsAbbr},
kilometers:{lengthUnit:"kilometers",areaUnit:"square-kilometers",bufferUnit:"UNIT_KILOMETER",lengthAbbr:window.jimuNls.units.kilometersAbbr,areaAbbr:window.jimuNls.units.squareKilometerAbbr}};w.switchToTab=function(t,g){t.selectTab(g)};w.removeNegativeExponents=function(t){return 1<t.toString().toLowerCase().split("e-").length?0:t};w.applyRounding=function(t,g){if(isNaN(g)||null===g)g=2;var l=Math.pow(10,g);t=Math.round(t*l)/l;t=t.toFixed(g);return d.localizeNumber(t)};w.getLengthOfGeometry=function(t,
g){var l;var A=0;(l=J.simplify(t))&&(A=t.spatialReference.isWebMercator()||4326===t.spatialReference.wkid?J.geodesicLength(l,g):J.planarLength(l,g));return A};w.getAreaOfGeometry=function(t,g){var l=J.simplify(t);var A=0;l&&(A=t.spatialReference.isWebMercator()||4326===t.spatialReference.wkid?J.geodesicArea(l,g):J.planarArea(l,g));return A};w.deleteFeatures=function(t,g){var l=new K;O({url:t+"/deleteFeatures",content:{where:g,f:"json"}},{usePost:!0}).then(I.hitch(this,function(A){l.resolve(A)}),function(){l.reject(!1)});
return l.promise};w.getUnitsAbbreviation=function(t,g){var l="";if("esriGeometryPolygon"===t||"polygon"===t)l=w.units[g].areaAbbr;else if("esriGeometryPolyline"===t||"polyline"===t)l=w.units[g].lengthAbbr;return l};w.roundProjectCostValue=function(t,g){var l=0;g=parseFloat(g);switch(t){case "nearestWholeNumber":l=g.toFixed();break;case "nearestTen":l=eval(g.toFixed())/10;l=10*eval(l.toFixed());break;case "nearestHundred":l=eval(g.toFixed())/100;l=100*eval(l.toFixed());break;case "nearestThousand":l=
eval(g.toFixed())/1E3;l=1E3*eval(l.toFixed());break;case "nearestTenThousands":l=eval(g.toFixed())/1E4;l=1E4*eval(l.toFixed());break;default:l=g.toFixed(2)}return d.localizeNumber(l)};w.getPrjAssetTableFields=function(t){var g={};e.forEach(t.fields,I.hitch(this,function(l){"assetguid"===l.name.toLowerCase()?g.ASSETGUID=l.name:"costequation"===l.name.toLowerCase()?g.COSTEQUATION=l.name:"scenario"===l.name.toLowerCase()?g.SCENARIO=l.name:"templatename"===l.name.toLowerCase()?g.TEMPLATENAME=l.name:"geographyguid"===
l.name.toLowerCase()?g.GEOGRAPHYGUID=l.name:"projectguid"===l.name.toLowerCase()&&(g.PROJECTGUID=l.name)}));g.OBJECTID=t.objectIdField;return g};w.getPrjLayerFields=function(t){var g={};e.forEach(t.fields,I.hitch(this,function(l){"projectname"===l.name.toLowerCase()?g.PROJECTNAME=l.name:"description"===l.name.toLowerCase()?g.DESCRIPTION=l.name:"totalassetcost"===l.name.toLowerCase()?g.TOTALASSETCOST=l.name:"grossprojectcost"===l.name.toLowerCase()?g.GROSSPROJECTCOST=l.name:"globalid"===l.name.toLowerCase()&&
(g.GLOBALID=l.name)}));return g};w.getPrjMultiplierFields=function(t){var g={};e.forEach(t.fields,I.hitch(this,function(l){"description"===l.name.toLowerCase()?g.DESCRIPTION=l.name:"type"===l.name.toLowerCase()?g.TYPE=l.name:"value"===l.name.toLowerCase()?g.VALUE=l.name:"costindex"===l.name.toLowerCase()?g.COSTINDEX=l.name:"projectguid"===l.name.toLowerCase()&&(g.PROJECTGUID=l.name)}));g.OBJECTID=t.objectIdField;return g};w.showMessage=function(t){var g=new v({message:t});g.message=t;return g};w.evaluate=
function(t){return(new Function("return "+t))()};w.validateEquation=function(t){if(""===t||-1<t.indexOf("\x26")||-1<t.indexOf("|")||-1<t.indexOf(","))return!1;t=t.replace(/{measure}/ig,1);t=t.replace(/{totalmeasure}/ig,1);t=t.replace(/{totalcount}/ig,1);if(-1!==t.indexOf("{")||-1!==t.indexOf("}"))return!1;try{var g=w.evaluate(t);return isFinite(g)?!0:!1}catch(l){return!1}};w.setFirstAndLastWBFocusNode=function(t,g,l){d.initFirstFocusNode(t,g);a.focus(g);d.initLastFocusNode(t,l)};return w})},"widgets/CostAnalysis/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/CostAnalysis/Widget.html":'\x3cdiv style\x3d "height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"widgetErrorNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"createOrLoadProject"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFullHeightWidth esriCTHidden" data-dojo-attach-point\x3d"addNewStatisticsNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFullHeightWidth esriCTHidden" data-dojo-attach-point\x3d"workBenchPanel"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFullHeightWidth esriCTHidden" data-dojo-attach-point\x3d"projectAttribute"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFullHeightWidth esriCTHidden" data-dojo-attach-point\x3d"assetDetails"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFullHeightWidth esriCTHidden" data-dojo-attach-point\x3d"assetStatistics"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTFullHeightWidth esriCTHidden" data-dojo-attach-point\x3d"projectSummary"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTHidden esriCTCopyFeaturesMainContainer" data-dojo-attach-point\x3d"copyFeatures"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/create-load-project.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTCreateProjectContainer" data-dojo-attach-point\x3d"createLoadProjectContainer"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"createProjectContainer"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"loadProjectContainer"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"updateEquationContainer" class\x3d"esriCTUpdateEquationMainContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/CostAnalysis/item-list.html":'\x3cdiv\x3e\r\n  \x3cdiv class \x3d "esriCTItemListContainer" data-dojo-attach-point\x3d"itemListContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/update-project-cost.html":'\x3cdiv class\x3d"esriCTProjectListMainContainer"\x3e\r\n  \x3c!-- // list --\x3e\r\n  \x3cdiv class\x3d"esriCTProjectListChildContainer esriCTHidden" data-dojo-attach-point\x3d"projectListChildContainer"\x3e\x3c/div\x3e\r\n  \x3c!-- // button --\x3e\r\n  \x3cdiv class\x3d"esriCTUpdateButtonContainer esriCTHidden" data-dojo-attach-point\x3d"updateButtonParentContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-btn jimu-state-disabled esriCTUpdateEquationBtnDisabled" data-dojo-attach-point\x3d"updateCostEquationButton"\r\n      data-dojo-attach-event\x3d"onclick:_updateCostEquation" role\x3d"button" aria-label\x3d"${nls.updateCostEquationPanel.updateButtonTextForm}"\x3e${nls.updateCostEquationPanel.updateButtonTextForm}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"noFeatureFoundScreen" class\x3d"esriCTNoFeatureFoundScreen esriCTHidden"\x3e${nls.updateCostEquationPanel.updateProjectNoProject}\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/work-bench.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTBoldFont esriCTProjectName" data-dojo-attach-point\x3d"projectNameDiv" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTSelectFeatureToCopyParentContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTSelectFeatureLabel" data-dojo-attach-point\x3d"featureModeTextNode" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.workBench.featureModeText}"\x3e${nls.workBench.featureModeText}:\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTSelectFeatureToCopyContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTSelectDisable esriCTFeatureModeIcons esriCTWorkBenchDOM" data-dojo-attach-point\x3d"selectButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.workBench.selectToolTitle}" title\x3d"${nls.workBench.selectToolTitle}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTSketchEnable esriCTFeatureModeIcons esriCTWorkBenchDOM" data-dojo-attach-point\x3d"sketchButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.workBench.sketchToolTitle}" title\x3d"${nls.workBench.sketchToolTitle}"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTTemplatePickerLabel "tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.workBench.templatePickerTitle}"\x3e${nls.workBench.templatePickerTitle}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTAddEditFeatureContainer" data-dojo-attach-point\x3d"templatePickerContainer"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"projectOverview"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis esriCTWorkBenchDOM" data-dojo-attach-point\x3d"backButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.back}"\x3e${nls.common.back}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis esriCTWorkBenchDOM" data-dojo-attach-point\x3d"refreshButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.workBench.refresh}"\x3e${nls.workBench.refresh}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis esriCTWorkBenchDOM" data-dojo-attach-point\x3d"downloadCSVBtn" tabindex\x3d"0" role\x3d"button"\r\n        aria-label\x3d"${nls.workBench.downloadCSVBtnTitle}"\x3e${nls.workBench.downloadCSVBtnTitle}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/template-picker.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTAssetTemplatePicker" data-dojo-attach-point\x3d"templatePickerNode"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTEditorToolBar" data-dojo-attach-point\x3d"editorToolbarNode"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/scenario-selection.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTRegionDetailsParentDiv" data-dojo-attach-point\x3d"regionDetailsParentContainer"\x3e\r\n    \x3cdiv class\x3d"esriCTRegionLabel"\x3e${nls.scenarioSelection.regionLabel}\x3c/div\x3e\r\n    \x3cinput class\x3d"esriCTRegionTextBox" readonly aria-label\x3d"${nls.scenarioSelection.regionLabel}" data-dojo-attach-point\x3d"regionNameTextBox" data-dojo-type\x3d"dijit/form/TextBox"\r\n    /\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTScenarioDetailsParentDiv" data-dojo-attach-point\x3d"scenarioDetailsParentDiv"\x3e\r\n    \x3cdiv class\x3d"esriCTScenarioLabel"\x3e${nls.scenarioSelection.scenarioLabel}\x3c/div\x3e\r\n    \x3cselect class\x3d"esriCTScenarioDropdown" data-dojo-attach-point\x3d"scenarioDropDown" aria-label\x3d"${nls.scenarioSelection.scenarioLabel}" data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\x3c/select\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/copy-features.html":'\x3cdiv class\x3d"esriCTSelectFeaturesContainer"\x3e\r\n  \x3cdiv style\x3d"height: 100%; width: 100%;"\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListTitle"\x3e${nls.copyFeatures.title}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListContent" data-dojo-attach-point\x3d"layerListTable"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesBtnContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"createMultipleFeaturesBtn" title\x3d"${nls.copyFeatures.createFeatures}" tabindex\x3d"0" aria-label\x3d"${nls.copyFeatures.createFeatures}" role\x3d"button"\x3e${nls.copyFeatures.createFeatures}\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"createSingleFeatureBtn" title\x3d"${nls.copyFeatures.createSingleFeature}" tabindex\x3d"0" aria-label\x3d"${nls.copyFeatures.createSingleFeature}" role\x3d"button"\x3e${nls.copyFeatures.createSingleFeature}\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"cancelBtn" title\x3d"${nls.common.cancel}" tabindex\x3d"0" aria-label\x3d"${nls.common.cancel}" role\x3d"button"\x3e${nls.common.cancel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/project-overview.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTProjectOverview" data-dojo-attach-point\x3d"projectOverviewNode"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"assetSummaryInfo"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"assetSummaryDiv"\x3e\x3c/div\x3e\r\n    \x3ctable class\x3d"esriCTTable esriCTBoldFont esriCTTotalCostTable" style\x3d"width: 100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr tabindex\x3d"0" \x3e\r\n          \x3ctd aria-label\x3d"${nls.projectOverview.totalCostLabel}" class\x3d"esriCTAssetItemsTotalCostLabel" data-dojo-attach-point\x3d"totalCostLabel"\x3e${nls.projectOverview.totalCostLabel}\x3c/td\x3e\r\n          \x3ctd class\x3d"esriCTAssetItemsTotalCost" data-dojo-attach-point\x3d"totalCost"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr tabindex\x3d"0" \x3e\r\n          \x3ctd aria-label\x3d"${nls.projectOverview.grossCostLabel}" class\x3d"esriCTAssetItemsGrossCostLabel" data-dojo-attach-point\x3d"grossCostLabel"\x3e${nls.projectOverview.grossCostLabel}\x3c/td\x3e\r\n          \x3ctd class\x3d"esriCTAssetItemsGrossCost" data-dojo-attach-point\x3d"grossCost"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd style\x3d"font-weight: normal; font-style: italic;" colspan\x3d"2" data-dojo-attach-point\x3d"roundingLabel"\x3e${nls.projectOverview.roundingLabel}\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"projectSummaryInfo"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/advance-item-list.html":'\x3cdiv\x3e\r\n  \x3cdiv class \x3d "esriCTItemListContainer" data-dojo-attach-point\x3d"itemListContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/CostAnalysis/project-summary.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTCostEscalationTitle"\x3e\r\n      ${nls.costEscalation.costEscalationLabel}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCostEscalatioParent" data-dojo-attach-point\x3d"costEscalationTableNode"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3c!--Add/delete/reorder buttons--\x3e\r\n      \x3cdiv style\x3d"height: 30px;" class\x3d"esriCTStatisticsButtonParentDiv"\x3e\r\n        \x3cdiv class\x3d"esriCTAddStatisticsIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnAddNode" title\x3d"${nls.costEscalation.addCostEscalationText}" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.costEscalation.addCostEscalationText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTDeleteStatisticsIconDisable esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnCrossNode" title\x3d"${nls.costEscalation.deleteCostEscalationText}" tabindex\x3d"-1" role\x3d"button" aria-label\x3d"${nls.costEscalation.deleteCostEscalationText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsUpIconDisable esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnUpNode" title\x3d"${nls.costEscalation.moveCostEscalationUpText}" tabindex\x3d"-1" role\x3d"button" aria-label\x3d"${nls.costEscalation.moveCostEscalationUpText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsDownIconDisable esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnDownNode" title\x3d"${nls.costEscalation.moveCostEscalationDownText}" tabindex\x3d"-1" role\x3d"button" aria-label\x3d"${nls.costEscalation.moveCostEscalationDownText}"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--Project Total and Gross Cost table--\x3e\r\n      \x3cdiv class\x3d"esriCTBoldFont" data-dojo-attach-point\x3d"totalProjectCost"\x3e\r\n        \x3ctable class\x3d"esriCTProjectCostTable" style\x3d"width: 100%;"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr tabindex\x3d"0"\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalCostLabel" data-dojo-attach-point\x3d"totalCostLabel"\x3e${nls.projectOverview.totalCostLabel}\x3c/td\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalCost" data-dojo-attach-point\x3d"totalCostDiv"\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr tabindex\x3d"0"\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalGrossLabel" data-dojo-attach-point\x3d"grossCostLabel"\x3e${nls.projectOverview.grossCostLabel}\x3c/td\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalGross" data-dojo-attach-point\x3d"grossCostDiv"\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd style\x3d"font-weight: normal; font-style: italic;" colspan\x3d"2" data-dojo-attach-point\x3d"roundingLabel"\x3e${nls.projectOverview.roundingLabel}\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.ok}"\x3e${nls.common.ok}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.cancel}"\x3e${nls.common.cancel}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/asset-details.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv style\x3d"height: 100%; width: 100%" data-dojo-attach-point\x3d"assetDetailsParent"\x3e\r\n    \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n      \x3cdiv class\x3d"esriCTAssetDetailsTitle"\x3e\r\n        ${nls.workBench.assetDetailsTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTNoAssetMessage" tabindex\x3d"0" role\x3d"presentation" aria-label\x3d"${nls.workBench.noAssetAddedMsg}" data-dojo-attach-point\x3d"noAssetDetails"\x3e\r\n        ${nls.workBench.noAssetAddedMsg}\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"assetDetailsNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listNode"\x3e\x3c/div\x3e\r\n        \x3cdiv\x3e\r\n          \x3cdiv style\x3d"width: 100%; float: left;"\x3e\r\n            \x3cdiv class\x3d"esriCTTotalCostTitle" title\x3d"${nls.assetDetails.totalCostTitle}"\x3e${nls.assetDetails.totalCostTitle}\x3c/div\x3e\r\n            \x3cdiv style\x3d"height: 30px;" class\x3d"esriCTEditEquationIcon" data-dojo-attach-point\x3d"additionalCostBtn" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.assetDetails.totalCostTitle}"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"totalProjectCost"\x3e\r\n            \x3ctable class\x3d"esriCTTable" style\x3d"width: 100%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr tabindex\x3d"0"\x3e\r\n                  \x3ctd class\x3d"esriCTBoldFont esriCTAssetDetailsTotalCostLabel" data-dojo-attach-point\x3d"totalCostLabel"\x3e${nls.projectOverview.totalCostLabel}\x3c/td\x3e\r\n                  \x3ctd class\x3d"esriCTBoldFont esriCTAssetDetailsTotalCost" data-dojo-attach-point\x3d"totalCost"\x3e\x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n            \x3ctable class\x3d"esriCTTable" style\x3d"width: 100%;"\x3e\r\n              \x3ctbody data-dojo-attach-point\x3d"additionalCostTable"\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n            \x3ctable class\x3d"esriCTTable" style\x3d"width: 100%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr tabindex\x3d"0"\x3e\r\n                  \x3ctd class\x3d"esriCTBoldFont esriCTAssetDetailsGrossCostLabel" data-dojo-attach-point\x3d"grossCostLabel"\x3e${nls.projectOverview.grossCostLabel}\x3c/td\x3e\r\n                  \x3ctd class\x3d"esriCTBoldFont esriCTAssetDetailsGrossCost" data-dojo-attach-point\x3d"grossCost"\x3e\x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd style\x3d"font-weight: normal; font-style: italic;" colspan\x3d"2" data-dojo-attach-point\x3d"roundingLabel"\x3e${nls.projectOverview.roundingLabel}\x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n      \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.back}"\x3e${nls.common.back}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv style\x3d"height: 100%; width: 100%" class\x3d"esriCTHidden" data-dojo-attach-point\x3d"costEquationEditorParent"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/cost-equation-editor.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTCostEquationTitle"\x3e\r\n      ${nls.workBench.costEquationTitle}\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"costEquationEditorNode"\x3e\r\n      \x3cdiv\x3e\r\n        \x3cdiv\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationLabel esriCTFullWidth esriCTEllipsis"  title\x3d"${nls.workBench.geographyTitle}"\x3e\r\n            ${nls.workBench.geographyTitle}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationInput esriCTFullWidth"\x3e\r\n            \x3cdiv aria-label\x3d"${nls.workBench.geographyTitle}" class\x3d"esriCTFullWidth" readonly  data-dojo-type\x3d"dijit/form/TextBox" data-dojo-attach-point\x3d"geographyValue"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationLabel esriCTFullWidth esriCTEllipsis"  title\x3d"${nls.workBench.scenarioTitle}"\x3e\r\n            ${nls.workBench.scenarioTitle}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationInput esriCTFullWidth"\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth" data-dojo-type\x3d"jimu/dijit/formSelect" data-dojo-attach-point\x3d"scenarioValue" aria-label\x3d"${nls.workBench.scenarioTitle}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationLabel esriCTFullWidth esriCTEllipsis" title\x3d"${nls.workBench.newCostEquationTitle}"\x3e\r\n            ${nls.workBench.newCostEquationTitle}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationInput esriCTFullWidth" data-dojo-attach-point\x3d"newCostEquationParent"\x3e\r\n            \x3cdiv class\x3d\x3d"esriCTFullWidth" style\x3d"min-height:70px;" spellcheck\x3d"false" data-dojo-type\x3d"dijit/form/Textarea" data-dojo-attach-point\x3d"newCostEquationValue" required\x3d"true"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n           \x3cdiv class\x3d"esriCTEditCostEquationLabel esriCTFullWidth esriCTEllipsis"  title\x3d"${nls.workBench.defaultCostEquationTitle}"\x3e\r\n            ${nls.workBench.defaultCostEquationTitle}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTEditCostEquationInput esriCTFullWidth"\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth" style\x3d"min-height:70px;" spellcheck\x3d"false" readonly data-dojo-type\x3d"dijit/form/Textarea" data-dojo-attach-point\x3d"defaultCostEquationValue"\r\n            aria-label\x3d"${nls.workBench.defaultCostEquationTitle}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n          \x3cdiv style\x3d"outline-offset: -2px;" tabindex\x3d"0" role\x3d"presentation" class\x3d"esriCTHint" data-dojo-attach-point\x3d"costEquationHint"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.ok}"\x3e${nls.common.ok}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.cancel}"\x3e${nls.common.cancel}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/add-new-statistics.html":'\x3cdiv style\x3d"height: 100%; width: 100%;"\x3e\r\n    \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n        \x3c!--Add new statistics label--\x3e\r\n        \x3cdiv class\x3d"esriCTAddNewStatisticsLabel" data-dojo-attach-point\x3d"addNewStatisticsText"\x3e${nls.statisticsSettings.addNewStatisticsText}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"addNewStatisticsNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n        \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButtonNode" tabindex\x3d"0"\r\n            role\x3d"button" aria-label\x3d"${nls.common.ok}"\x3e${nls.common.ok}\x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"cancelButtonNode" tabindex\x3d"0"\r\n            role\x3d"button" aria-label\x3d"${nls.common.cancel}"\x3e${nls.common.cancel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/setting/StatisticsSettings.html":'\x3cdiv class\x3d"esriCTTabNode"\x3e\r\n    \x3cdiv class\x3d"esriCTTabContainer row"\x3e\r\n        \x3cdiv\x3e\r\n            \x3c!--Add New Statistics button--\x3e\r\n            \x3cdiv class\x3d"esriCTStatisticsContainer" data-dojo-attach-point\x3d"btnAddStatisticsNodeWrapper"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"btnAddStatisticsNode" class\x3d"esriCTBtnStatisticsAddSection"\x3e\r\n                    \x3cspan class\x3d"esriCTBtnAddStatisticsIcon"\x3e\x3c/span\x3e\r\n                    \x3cspan class\x3d"esriCTBtnStatisticsAddLabel"\x3e ${nls.statisticsSettings.addStatisticsLabel}\x3c/span\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTAddLayerTableNode" data-dojo-attach-point\x3d"statisticsLayerTableNode"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTHidden esriCTNoEditableLayersAvailable" data-dojo-attach-point\x3d"noEditableLayersAvailable"\x3e\r\n                ${nls.costingInfo.noEditableLayersAvailable}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"additionalProjectCostWrapper"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--Add/delete/reorder buttons--\x3e\r\n    \x3cdiv class\x3d"esriCTStatisticsButtonParentDiv"\x3e\r\n        \x3cdiv class\x3d"esriCTAddStatisticsIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnAddNode"\r\n            title\x3d"${nls.statisticsSettings.addNewStatisticsText}" tabindex\x3d"0" role\x3d"button"\r\n            aria-label\x3d"${nls.statisticsSettings.addNewStatisticsText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTDeleteStatisticsIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnCrossNode"\r\n            title\x3d"${nls.statisticsSettings.deleteStatisticsText}" tabindex\x3d"-1" role\x3d"button"\r\n            aria-label\x3d"${nls.statisticsSettings.deleteStatisticsText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsUpIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnUpNode"\r\n            title\x3d"${nls.statisticsSettings.moveStatisticsUpText}" tabindex\x3d"-1" role\x3d"button"\r\n            aria-label\x3d"${nls.statisticsSettings.moveStatisticsUpText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsDownIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnDownNode"\r\n            title\x3d"${nls.statisticsSettings.moveStatisticsDownText}" tabindex\x3d"-1" role\x3d"button"\r\n            aria-label\x3d"${nls.statisticsSettings.moveStatisticsDownText}"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/setting/ProjectCost.html":'\x3cdiv\x3e\r\n    \x3c!--Add Addtional Project cost button--\x3e\r\n    \x3cdiv class\x3d"esriCTProjectCostContainer" data-dojo-attach-point\x3d"btnAddProjectCostNodeWrapper"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"btnAddProjectCostNode" class\x3d"esriCTBtnProjectCostAddSection"\x3e\r\n            \x3cspan class\x3d"esriCTBtnAddProjectCostIcon"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"esriCTBtnProjectCostAddLabel"\x3e ${nls.projectCostSettings.addProjectCostLabel} \x3c/span\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTProjectCostTableWrapper" data-dojo-attach-point\x3d"projectCostTableWrapper"\x3e\r\n        \x3cdiv class\x3d"esriCTProjectCostTableNode" data-dojo-attach-point\x3d"projectCostTableNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--Add/delete/reorder buttons--\x3e\r\n    \x3cdiv class\x3d"esriCTStatisticsButtonParentDiv"\x3e\r\n        \x3cdiv class\x3d"esriCTAddStatisticsIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnAddNode"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTDeleteStatisticsIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnCrossNode"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsUpIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnUpNode"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsDownIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnDownNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/project-attribute.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTProjectAttributeTitle"\x3e\r\n      ${nls.projectAttribute.projectAttributeTitle}\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"projectAttributeNode"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.ok}"\x3e${nls.common.ok}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.cancel}"\x3e${nls.common.cancel}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/asset-statistics.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection" data-dojo-attach-point\x3d"assetStatisticsNode"\x3e\r\n    \x3cdiv class\x3d"esriCTFloatLeft esriCTFullwidth"\x3e\r\n      \x3cdiv class\x3d"esriCTDetailStatisticsTitle"\x3e\r\n        ${nls.detailStatistics.detailStatisticsLabel}\r\n      \x3c/div\x3e\r\n      \x3c!--Add New Statistics button--\x3e\r\n      \x3cdiv class\x3d"esriCTStatisticsButtonContainer"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"addNewStatisticsIcon" class\x3d"esriCTBtnStatisticsAddSection" tabindex\x3d"0"\r\n          role\x3d"button" aria-label\x3d"${nls.statisticsSettings.addNewStatisticsText}"\r\n          title\x3d"${nls.statisticsSettings.addNewStatisticsText}"\x3e\r\n          \x3cspan class\x3d"esriCTBtnAddStatisticsIcon"\x3e\x3c/span\x3e\r\n          \x3cspan class\x3d"esriCTBtnStatisticsAddLabel"\x3e${nls.detailStatistics.addStatisticsButtonLabel}\x3c/span\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTDetailStatisticsContent esriCTFloatLeft esriCTFullwidth" data-dojo-attach-point\x3d"assetsListNode"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton" tabindex\x3d"0" role\x3d"button"\r\n      aria-label\x3d"${nls.common.back}"\x3e${nls.common.back}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/CostAnalysis/css/style.css":'.esriCTOverridePanelStyle {height: calc(100% - 20px) !important;}.jimu-widget-cost-analysis-widget .esriCTHidden,.jimu-widget-cost-analysis-statistics-settings .esriCTHidden,.jimu-widget-cost-analysis-scenario-selection .esriCTHidden,.jimu-widget-cost-analysis-create-load-project .esriCTHidden{display: none;}.jimu-widget-cost-analysis-widget .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-cost-analysis-widget .esriCTFloatLeft,.esriRtl .jimu-widget-cost-analysis-asset-statistics .esriCTStatisticsButtonContainer {float: left;}.jimu-widget-cost-analysis-widget .esriCTFullHeightWidth {height: 100%; width: 100%;}.jimu-widget-cost-analysis-widget .esriCTFullwidth {width: 100%;}.esriCTPageFooter {text-align: center; margin-top: 15px;}.jimu-widget-cost-analysis-widget .jimu-btn {max-width: 150px;}.esriCTPageFooter .jimu-btn {margin: 5px;}.esriCTContentSection {height: calc(100% - 50px); overflow-y: auto; overflow-x: hidden;}.jimu-widget-cost-analysis-widget .esriCTStatisticsButtons {height: 24px; width: 24px; background-size: 20px; background-position: center; float: left; background-repeat: no-repeat; margin: 0px 5px 0px 0px;}.esriRtl .jimu-widget-cost-analysis-widget .esriCTStatisticsButtons {float: right; margin: 0px 0px 0px 5px;}.jimu-widget-cost-analysis-widget .esriCTAddStatisticsIcon {background-image: url(../images/add.png); border: 1px solid gray; cursor: pointer;}.jimu-widget-cost-analysis-widget .esriCTAddStatisticsIconDisable {background-image: url(../images/add-disabled.png); border: 1px solid gray; cursor: default;}.jimu-widget-cost-analysis-widget .esriCTDeleteStatisticsIcon {background-image: url(../images/delete.png); border: 1px solid gray; cursor: pointer;}.jimu-widget-cost-analysis-widget .esriCTDeleteStatisticsIconDisable {background-image: url(../images/delete-disabled.png); border: 1px solid gray; cursor: default;}.jimu-widget-cost-analysis-widget .esriCTStatisticsUpIcon {background-image: url(../images/up.png); border: 1px solid gray; cursor: pointer;}.jimu-widget-cost-analysis-widget .esriCTStatisticsUpIconDisable {background-image: url(../images/up-disabled.png); border: 1px solid gray; cursor: default;}.jimu-widget-cost-analysis-widget .esriCTStatisticsDownIcon {background-image: url(../images/down.png); border: 1px solid gray; cursor: pointer;}.jimu-widget-cost-analysis-widget .esriCTStatisticsDownIconDisable {background-image: url(../images/down-disabled.png); border: 1px solid gray; cursor: default;}.esriRtl .jimu-widget-cost-analysis-widget .esriCTStatisticsButtonParentDiv {float: right;}.esriRtl .jimu-widget-cost-analysis-widget .esriCTAdd {float: right; margin: 5px 0px 5px 2px;}.jimu-widget-cost-analysis-project-summary .esriCTCostEscalationTitle {font-weight: bold; padding-bottom: 10px;}.jimu-widget-cost-analysis-project-summary .esriCTCostEscalatioParent {margin-bottom: 10px;}.jimu-widget-cost-analysis-item-list .esriCTItemListContainer {border: 1px solid #d9d9d9;}.jimu-widget-cost-analysis-item-list .esriCTItemTitleContainer {background-color: #f5f5f5; color: #444; cursor: pointer; border-bottom: 1px solid #d9d9d9;}.jimu-widget-cost-analysis-item-list .esriCTItemHighlighter, .jimu-widget-cost-analysis-advance-item-list .esriCTItemHighlighter {height: 45px; width: 5px; float: left;}.jimu-widget-cost-analysis-item-list .esriCTItemTitle {padding: 15px; text-align: left; border: none; outline: none;}.jimu-widget-cost-analysis-item-list .esriCTItemTitleContainer .esriCTItemTitleActive, .jimu-widget-cost-analysis-item-list .esriCTItemTitleContainer:hover {background-color: #ddd; font-weight: bold;}.jimu-widget-cost-analysis-item-list .esriCTItemContent {padding: 0 15px; overflow: hidden; height: 0; opacity: 0; transition: all .3s ease .15s;}.jimu-widget-cost-analysis-item-list .esriCTItemContentActive {padding: 15px; opacity: 1; border-bottom: 1px solid #d9d9d9;}.esriRtl .jimu-widget-cost-analysis-item-list .esriCTItemTitle {text-align: right;}.esriRtl .jimu-widget-cost-analysis-item-list .esriCTItemHighlighter, .esriRtl .jimu-widget-cost-analysis-advance-item-list .esriCTItemHighlighter {float: right;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemListContainer {float: left; width: 100%; border: 1px solid #d9d9d9;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemTitleContainer {background-color: #f5f5f5; color: #444; cursor: pointer; border-bottom: 1px solid #d9d9d9; width: 100%; display: inline-block;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemTitleContainer:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemTitle {padding: 15px 5px 15px 5px; text-align: left; border: none; outline: none;}.esriRtl .jimu-widget-cost-analysis-advance-item-list .esriCTItemTitle {float: right; text-align: right;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemContent {padding: 0 15px; overflow: hidden; height: 0;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemAnimation {transition: all .3s ease .15s; opacity: 0; height: 0;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemContentActive {padding: 5px; opacity: 1; border-bottom: 1px solid #d9d9d9;}.jimu-widget-cost-analysis-advance-item-list .esriCTItemListImageLogo,.jimu-widget-cost-analysis-asset-statistics .esriCTItemListImageLogo {height: 24px; width: 24px; margin-top: 10px; float: left; background-position: center center; background-repeat: no-repeat; background-size: 24px; margin-left: 5px;}.esriRtl .jimu-widget-cost-analysis-advance-item-list .esriCTItemListImageLogo,.esriRtl .jimu-widget-cost-analysis-asset-statistics .esriCTItemListImageLogo {float: right; margin-left: auto; margin-right: 5px;}.jimu-widget-cost-analysis-advance-item-list .esriCTBorder {border: 1px solid grey;}.jimu-widget-cost-analysis-advance-item-list .esriCTArrow {background-image: url("../images/arrow-right.png");}.esriRtl .jimu-widget-cost-analysis-advance-item-list .esriCTArrow {-moz-transform: rotate(180deg); -o-transform: rotate(180deg); -webkit-transform: rotate(180deg); transform: rotate(180deg);}.jimu-widget-cost-analysis-advance-item-list .esriCTArrowDown {-moz-transform: rotate(90deg) !important; -o-transform: rotate(90deg) !important; -webkit-transform: rotate(90deg) !important; transform: rotate(90deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear; background-size: 16px;}.jimu-widget-cost-analysis-advance-item-list .esriCTArrowUp {-moz-transform: rotate(-90deg) !important; -o-transform: rotate(-90deg) !important; -webkit-transform: rotate(-90deg) !important; transform: rotate(-90deg) !important; -moz-transition: -webkit-transform 00.2s linear; -o-transition: -webkit-transform 00.2s linear; -webkit-transition: -webkit-transform 00.2s linear; transition: transform 00.2s linear; background-size: 16px;}.jimu-widget-cost-analysis-advance-item-list .esriCTAssetActionSettingIcon {background-image: url("../images/setting.png"); border: 1px solid grey;}.jimu-widget-cost-analysis-create-load-project .esriCTCreateProjectWrapper, .jimu-widget-cost-analysis-create-load-project .esriCTLoadProjectWrapper {height: 100%;}.jimu-widget-cost-analysis-create-load-project .esriCTCreateProjectContent {margin-bottom: 10px;}.jimu-widget-cost-analysis-create-load-project .esriCTCreateProjectContent .dijitSelect:focus {border: 1px solid #24B5CC !important; outline-offset: -2px !important;}.jimu-widget-cost-analysis-create-load-project .esriCTCreateLoadButtonWrap {text-align: center; margin-top: 5px;}.jimu-widget-cost-analysis-create-load-project .esriCTLoadProjectWrapper .jimu-btn {max-width: 33%; margin: 5px;}.jimu-widget-cost-analysis-statistics-settings .esriCTBtnStatisticsAddSection,.jimu-widget-cost-analysis-asset-statistics .esriCTBtnStatisticsAddSection {display: inline-block; overflow: hidden; height: 20px; cursor: pointer; font-size: 13px; color: #538ec8; margin-right: 2px;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsHeaderCheckBox:focus,.jimu-widget-cost-analysis-asset-statistics .esriCTNoDetailStatisticMessage:focus,.jimu-widget-cost-analysis-asset-details .esriCTNoAssetMessage:focus {border: 1px solid #24B5CC !important; outline-offset: -2px !important;}.jimu-widget-cost-analysis-statistics-settings .esriCTNoEditableLayersAvailable {color: red; font-style: italic; margin: 0 10px;}.jimu-widget-cost-analysis-statistics-settings .esriCTBtnAddStatisticsIcon {height: 100%; width: 14px; background-repeat: no-repeat; background-position: center center; background-image: url(images/add.png); display: inline-block; vertical-align: top;}.jimu-widget-cost-analysis-statistics-settings .esriCTBtnStatisticsAddLabel,.jimu-widget-cost-analysis-asset-statistics .esriCTBtnStatisticsAddLabel {line-height: 20px;}.jimu-widget-cost-analysis-statistics-settings .esriCTTabContainer {width: 100%; float: left; margin-bottom: 10px; border: 1px solid #D2DAE2;}.jimu-widget-cost-analysis-statistics-settings .esriCTLayerLabelTextBox {width: 100%; height: 29px; float: left;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsContainer {float: left; width: 40%;}.jimu-widget-cost-analysis-statistics-settings .esriCTDropDownContainer {width: 75%; float: right;}.jimu-widget-cost-analysis-statistics-settings .esriCTLayerNameDropdown .dijitSelectLabel, .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsTypeDropdown .dijitSelectLabel, .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsFieldDropdown .dijitSelectLabel {text-align: left; overflow: hidden;}.claro .jimu-widget-cost-analysis-statistics-settings .esriCTAddLayerTableNode .dijitSelect {height: 28px; min-width: 100%; float: left;}.jimu-widget-cost-analysis-add-new-statistics .esriCTAddNewStatisticsLabel {padding: 0px 0px 10px 0px;}.jimu-widget-cost-analysis-statistics-settings .esriCTCursorPointer {cursor: pointer;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsContainer {float: right;}.esriRtl .claro .jimu-widget-cost-analysis-statistics-settings .esriCTAddLayerTableNode .dijitSelect {height: 28px; min-width: 100%;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTLayerNameDropdown .dijitSelectLabel {text-align: right;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsTypeDropdown .dijitSelectLabel {text-align: right;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsFieldDropdown .dijitSelectLabel {text-align: right;}.jimu-widget-cost-analysis-statistics-settings .jimu-simple-table .simple-table-title {color: #7989a0;}.jimu-widget-cost-analysis-statistics-settings .jimu-simple-table .head-section {background-color: #D2DAE2; border-bottom: 1px solid #D2DAE2;}.jimu-widget-cost-analysis-statistics-settings .jimu-simple-table .simple-table-field, .jimu-simple-table .simple-table-cell {padding: 0px 0px 0px 1px !important;}.jimu-widget-cost-analysis-statistics-settings .jimu-simple-table {font-size: 11px; font-weight: bold;}.jimu-widget-cost-analysis-statistics-settings .jimu-simple-table .simple-table-row:hover {background-color: transparent !important;}.jimu-widget-cost-analysis-statistics-settings .dijitReset.dijitInputField.dijitButtonText {padding: 0px 1px 0px 1px; width: 100%; text-align: left;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .dijitReset.dijitInputField.dijitButtonText {text-align: right;}.jimu-widget-cost-analysis-statistics-settings .dijitReset.dijitInputField.dijitInputContainer {padding: 0px 1px 0px 1px;}.claro .jimu-widget-cost-analysis-add-new-statistics .dijitTextBox .dijitInputInner {color: #7989a0; font-size: 11px;}.jimu-widget-cost-analysis-project-summary .jimu-simple-table .simple-table-title {color: #7989a0;}.jimu-widget-cost-analysis-project-summary .jimu-simple-table .head-section {background-color: #D2DAE2; border-bottom: 1px solid #D2DAE2;}.jimu-widget-cost-analysis-project-summary .body-section {overflow: hidden;}.jimu-widget-cost-analysis-project-summary .jimu-simple-table .simple-table-field, .jimu-simple-table .simple-table-cell {padding: 0px 0px 0px 1px;}.jimu-widget-cost-analysis-project-summary .jimu-simple-table .simple-table-field, .jimu-simple-table .simple-table-cell {padding: 0px 0px 0px 1px;}.claro .jimu-widget-cost-analysis-project-summary .esriCTCostEscalatioParent .dijitSelect {height: 26px; margin-top: -4px;}.claro .jimu-widget-cost-analysis-project-summary .esriCTCostEscalatioParent .dijitTextBox {height: 26px; margin-top: -4px;}.jimu-widget-cost-analysis-statistics-settings .esriCTAddStatisticsIcon {background-image: url(../images/add.png); border: 1px solid gray;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsButtons {height: 24px; width: 24px; background-size: 24px; float: left; background-repeat: no-repeat; margin: 0px 5px 0px 0px;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsButtons {float: right; margin: 0px 0px 0px 5px;}.jimu-widget-cost-analysis-statistics-settings .esriCTDeleteStatisticsIcon {background-image: url(../images/delete.png); border: 1px solid gray;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsUpIcon {background-image: url(../images/up.png); border: 1px solid gray;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsDownIcon {background-image: url(../images/down.png); border: 1px solid gray;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsUpIconDisable {background-image: url(../images/up-disabled.png); border: 1px solid gray;}.jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsDownIconDisable {background-image: url(../images/down-disabled.png); border: 1px solid gray;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTStatisticsButtonParentDiv {float: right;}.esriRtl .jimu-widget-cost-analysis-statistics-settings .esriCTAdd {float: right; margin: 5px 0px 5px 2px;}.jimu-widget-cost-analysis-work-bench .esriCTAddEditFeatureContainer {border: 1px solid #d9d9d9; margin-bottom: 20px;}.jimu-widget-cost-analysis-work-bench .esriCTEditorToolBar {max-height: 30px;}.jimu-widget-cost-analysis-work-bench .esriCTSelectFeatureToCopyParentContainer {clear: both; padding: 10px 0; width: 100%; overflow: auto; border: 1px solid #d9d9d9; border-collapse: collapse;}.jimu-widget-cost-analysis-work-bench .esriCTTemplatePickerLabel{font-weight: bold; border: 1px solid #d9d9d9; border-top: none; border-bottom: none; padding: 5px 2px 5px;}.jimu-widget-cost-analysis-work-bench .esriCTSelectFeatureLabel {float: left; line-height: 24px; width: 70%; text-align: left; padding: 2px; font-weight: bold;}.esriRtl .jimu-widget-cost-analysis-work-bench .esriCTSelectFeatureLabel {float: right;}.jimu-widget-cost-analysis-work-bench .esriCTSelectFeatureToCopyContainer {float: right;}.esriRtl .jimu-widget-cost-analysis-work-bench .esriCTSelectFeatureToCopyContainer {float: left;}.jimu-widget-cost-analysis-work-bench .esriCTFeatureModeIcons {float: left; background-position: center center; height: 24px; width: 24px; background-size: 24px; background-repeat: no-repeat; cursor: pointer; margin-right: 10px;}.jimu-widget-cost-analysis-work-bench .esriCTFeatureModeIcons:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.esriRtl .jimu-widget-cost-analysis-work-bench .esriCTFeatureModeIcons {float: right; margin-left: 10px; margin-right: 0px;}.jimu-widget-cost-analysis-work-bench .esriCTSelectEnable {background-image: url("../images/select-enable.png");}.jimu-widget-cost-analysis-work-bench .esriCTSelectDisable {background-image: url("../images/select-disable.png");}.jimu-widget-cost-analysis-work-bench .esriCTSketchDisable {background-image: url("../images/sketch-disable.png");}.jimu-widget-cost-analysis-work-bench .esriCTSketchEnable {background-image: url("../images/sketch-enable.png");}.jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker {border: none; padding: 1px;}.jimu-widget-cost-analysis-work-bench .esriCTEditorToolBar .esriEditor .progressBar {display: none !important;}.jimu-widget-cost-analysis-work-bench .esriCTProjectOverview {overflow: hidden;}.jimu-widget-cost-analysis-project-overview .esriCTSummaryLayerTitle {padding: 5px; font-weight: bold;}.jimu-widget-cost-analysis-project-overview .esriCTTotalCostTable {margin-top: 5px;}.jimu-widget-cost-analysis-work-bench .esriCTProjectName {font-size: 16px; width: 100%; font-size: 16px; border: 1px solid #d9d9d9; padding: 5px 2px; word-break: break-word;}.jimu-widget-cost-analysis-work-bench .esriCTProjectName:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-cost-analysis-asset-details .esriCTBoldFont, .jimu-widget-cost-analysis-work-bench .esriCTBoldFont, .jimu-widget-cost-analysis-project-summary .esriCTBoldFont {font-weight: bold;}.jimu-widget-cost-analysis-project-overview .esriCTTable, .jimu-widget-cost-analysis-project-summary .esriCTProjectCostTable, .jimu-widget-cost-analysis-asset-details .esriCTTable {padding: 0; border-collapse: collapse; border-spacing: 0; width: 100%; page-break-inside: avoid; table-layout: fixed;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTTable, .esriRtl .jimu-widget-cost-analysis-project-overview .esriCTTable, .esriRtl .jimu-widget-cost-analysis-project-summary .esriCTProjectCostTable {direction: rtl;}.jimu-widget-cost-analysis-asset-details .esriCTTable td, .jimu-widget-cost-analysis-project-overview .esriCTTable td, .jimu-widget-cost-analysis-project-summary .esriCTProjectCostTable td {border: 1px solid #d9d9d9; word-wrap: break-word; padding: 4px;}.jimu-widget-cost-analysis-asset-details .esriCTTable .esriCTSelectableRow:hover td, .jimu-widget-cost-analysis-asset-details .esriCTRowSelected {background-color: #eeeeee; cursor: pointer;}.jimu-widget-cost-analysis-asset-details .esriCTTable th {display: table-row; vertical-align: inherit; border-color: inherit;}.jimu-widget-cost-analysis-project-summary .esriCTProjectCostTable {width: 100%; margin-top: 10px;}.claro .jimu-widget-cost-analysis-project-summary .dijitSelect {height: 28px;}.jimu-widget-cost-analysis-project-summary .esriCTCostLabelTextbox {width: 75%; height: 28px; margin-left: 5px;}.jimu-widget-cost-analysis-project-summary .esriCTCostTypeDropDownContainer {width: 35%; float: right;}.jimu-widget-cost-analysis-project-summary .esriCTCostTypeDropdown .dijitSelectLabel {text-align: left; overflow: hidden; width: 30px;}.claro .jimu-widget-cost-analysis-project-summary .esriCTAddLayerTableNode .dijitSelect {height: 28px; min-width: 100%; float: left;}.jimu-simple-table .simple-table-field, .esriCTCostEscalatioParent .jimu-simple-table .simple-table-cell {padding-left: 2px;}.jimu-widget-cost-analysis-asset-details .esriCTTotalCostTitle {font-weight: bold; width: calc(100% - 25px); float: left; line-height: 30px;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTTotalCostTitle {float: right;}.jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsTitle {font-weight: bold; padding-bottom: 10px; width : calc(100% - 50px); float: left;}.jimu-widget-cost-analysis-asset-details .esriCTGroupTitle {font-weight: bold; padding-top: 1px; width: calc(100% - 40px); float: left;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTGroupTitle,.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsTitle {float: right;}.jimu-widget-cost-analysis-asset-details .esriCTToggleIcon {height: 15px; width: 15px; background-size: 15px; background-position: center; float: left; background-repeat: no-repeat; margin: 0 5px 0 0; cursor: pointer;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTToggleIcon {float: right; margin: 0 0 0 5px;}.jimu-widget-cost-analysis-asset-details .esriCTExpandIcon {background-image: url(../images/expand.png);}.jimu-widget-cost-analysis-asset-details .esriCTCollapseIcon {background-image: url(../images/collapse.png);}.jimu-widget-cost-analysis-asset-details .esriCTEditEquationIcon {height: 16px; width: 16px; background-size: 16px; background-position: center; float: left; background-repeat: no-repeat; background-image: url(../images/edit-equation.png); cursor: pointer;}.jimu-widget-cost-analysis-asset-details .esriCTGroupTitleParent {padding: 10px 0 5px 0; float: left; width: 100%;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTGroupTitleParent {float: right;}.jimu-widget-cost-analysis-asset-details .esriCTGroupSummaryTotalTitle {font-weight: bold; text-align: right;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTGroupSummaryTotalTitle {text-align: left;}.jimu-widget-cost-analysis-asset-details .esriCTDialogIcon {height: 20px; width: 20px; background-size: 20px; background-position: center; float: left; background-repeat: no-repeat;}.jimu-widget-cost-analysis-asset-details .esriCTZoom {background-image: url(../images/zoom-in.png); margin-right: 10px;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTZoom, .esriRtl .jimu-widget-cost-analysis-asset-details .esriCTDelete {float: right; margin: 0;}.jimu-widget-cost-analysis-asset-details .esriCTDelete {background-image: url(../images/delete-asset.png); margin-right: 10px;}.jimu-widget-cost-analysis-asset-details .esriCTClose {background-image: url(../images/delete.png); float: right; cursor: pointer;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTClose {float: left;}.jimu-widget-cost-analysis-asset-details .esriCTRowContainer {height: 20px; cursor: pointer; margin-bottom: 10px;}.jimu-widget-cost-analysis-asset-details .esriCTRowContainer:hover {background-color: #eeeeee;}.jimu-widget-cost-analysis-asset-details .esriCTTooltipDialogLabel {text-overflow: ellipsis; overflow: hidden; white-space: nowrap; width: calc(100% - 30px); line-height: 20px;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTTooltipDialogLabel {text-align: left;}.esriRtl .jimu-widget-cost-analysis-advance-item-list .esriCTItemListContainer {float: none;}.jimu-widget-cost-analysis-project-overview .esriCTAssetItemsCost {text-align: right;}.esriRtl .jimu-widget-cost-analysis-project-overview .esriCTAssetItemsCost {text-align: left;}.jimu-widget-cost-analysis-project-overview .esriCTAssetItemsTotalCostLabel, .jimu-widget-cost-analysis-project-overview .esriCTAssetItemsGrossCostLabel {width: 66.66%;}.jimu-widget-cost-analysis-project-overview .esriCTAssetItemsTotalCost, .jimu-widget-cost-analysis-project-overview .esriCTAssetItemsGrossCost {text-align: right; width: 33.34%;}.esriRtl .jimu-widget-cost-analysis-project-overview .esriCTAssetItemsTotalCost, .esriRtl .jimu-widget-cost-analysis-project-overview .esriCTAssetItemsGrossCost {text-align: left;}.jimu-widget-cost-analysis-asset-details .esriCTGroupSummaryTotalCost {text-align: right;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTGroupSummaryTotalCost {text-align: left;}.jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsTotalCostLabel, .jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsGrossCostLabel {width: 66%;}.jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsTotalCost, .jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsGrossCost {text-align: right; width: 34%;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsTotalCost, .esriRtl .jimu-widget-cost-analysis-asset-details .esriCTAssetDetailsGrossCost {text-align: left;}.jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalCost {text-align: right;}.esriRtl .jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalCost {text-align: left;}.jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalCostLabel, .jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalGrossLabel {width: 66%;}.jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalCost, .jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalGross {text-align: right; width: 34%;}.esriRtl .jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalCost, .esriRtl .jimu-widget-cost-analysis-project-summary .esriCTProjectSummaryTotalGross {text-align: left;}.jimu-widget-cost-analysis-asset-details .esriCTAssetItemDetailsNetValue {text-align: right;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTAssetItemDetailsNetValue {text-align: left;}.jimu-widget-cost-analysis-asset-details .esriCTAssetItemDetailsCostingValue {text-align: right;}.esriRtl .jimu-widget-cost-analysis-asset-details .esriCTAssetItemDetailsCostingValue {text-align: left;}.jimu-widget-cost-analysis-asset-details .esriCTNoAssetMessage {padding: 10px 0; text-align: center; font-weight: bold; width: 100%; float: left;}.jimu-widget-cost-analysis-equation-editor .esriCTCostEquationTitle {font-weight: bold; padding-bottom: 10px;}.jimu-widget-cost-analysis-equation-editor .esriCTEditCostEquationLabel {padding: 5px 0;}.jimu-widget-cost-analysis-equation-editor .esriCTEditCostEquationInput {margin-bottom: 5px;}.jimu-widget-cost-analysis-equation-editor .esriCTFullWidth {width: 99%;}.jimu-widget-cost-analysis-equation-editor .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-cost-analysis-equation-editor .esriCTHint {margin: 5px 5px 10px 0px; float: right; font-size: 12px; color: #a0acbf; font-style: oblique;}.jimu-widget-cost-analysis-equation-editor .esriCTInvalidEquation {border: 1px solid red;}.jimu-widget-cost-analysis-project-attribute .esriCTProjectAttributeTitle {font-weight: bold; padding-bottom: 10px;}.jimu-widget-cost-analysis-asset-statistics .esriCTAssetActionIcon {background-image: url("../images/rightImg.png"); background-color: #eeeeee; float: right; margin-bottom: 5px !important; cursor: pointer;}.esriRtl .jimu-widget-cost-analysis-asset-statistics .esriCTAssetActionIcon {float: left;}.jimu-widget-cost-analysis-asset-statistics .esriCTStatisticLabel {padding-bottom: 5px;}.jimu-widget-cost-analysis-asset-statistics .esriCTStatisticWrapper {margin-bottom: 10px;}.jimu-widget-cost-analysis-asset-statistics .esriCTDetailStatisticsTitle {font-weight: bold; padding-top: 15px; font-weight: bold; width: 80%; float: left;}.esriRtl .jimu-widget-cost-analysis-asset-statistics .esriCTDetailStatisticsTitle {float: right;}.jimu-widget-cost-analysis-asset-statistics .esriCTNoDetailStatisticMessage {padding: 10px 0; text-align: center; font-weight: bold; float: left; width: 100%;}.dart-panel .jimu-widget-cost-analysis-item-list .esriCTItemTitleContainer .esriCTItemTitleActive, .dart-panel .jimu-widget-cost-analysis-item-list .esriCTItemTitleContainer:hover, .dart-panel .jimu-widget-cost-analysis-advance-item-list .esriCTItemTitleContainer .esriCTItemTitleActive, .dart-panel .jimu-widget-cost-analysis-advance-item-list .esriCTItemTitleContainer:hover {background-color: #808080;}.dart-panel .jimu-widget-cost-analysis-item-list .esriCTItemListContainer, .dart-panel .jimu-widget-cost-analysis-advance-item-list .esriCTItemListContainer {border: 1px solid #808080;}.dart-panel .jimu-widget-cost-analysis-item-list .esriCTItemTitleContainer, .dart-panel .jimu-widget-cost-analysis-advance-item-list .esriCTItemTitleContainer {background-color: #646464; border-bottom: 1px solid #808080;}.dart-panel .jimu-widget-cost-analysis-asset-details .esriCTTable .esriCTSelectableRow:hover td, .dart-panel .jimu-widget-cost-analysis-asset-details .esriCTRowSelected {background-color: #808080;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .dojoxGrid {background-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .dojoxGridScrollbox {background-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .dojoxGridRow, .dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .dojoxGridRow dojoxGridRowOdd {background-color: #4C4C4C; border-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .grid .dojoxGridRowOver {background-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .grid .dojoxGridCell, .dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .grid .dojoxGridCell:hover {border: 1px solid #4C4C4C; background-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .grid .dojoxGridCellFocus {border: 1px solid #4C4C4C !important; background-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .grid .item:hover {background-color: #808080;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .esriMapTooltip {color: #000 !important;}.dart-panel .jimu-widget-cost-analysis-work-bench .esriCTAssetTemplatePicker .templatePicker .dojoxGridMasterMessages {background-color: #4C4C4C;}.dart-panel .jimu-widget-cost-analysis-widget .esriCTAddStatisticsIcon {background-image: url(../images/add-disabled.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTAddStatisticsIconDisable {background-image: url(../images/add.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTDeleteStatisticsIcon {background-image: url(../images/delete-disabled.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTDeleteStatisticsIconDisable {background-image: url(../images/delete.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTStatisticsUpIcon {background-image: url(../images/up-disabled.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTStatisticsUpIconDisable {background-image: url(../images/up.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTStatisticsDownIcon {background-image: url(../images/down-disabled.png);}.dart-panel .jimu-widget-cost-analysis-widget .esriCTStatisticsDownIconDisable {background-image: url(../images/down.png);}.dart-panel .jimu-widget-cost-analysis-statistics-settings .jimu-simple-table .head-section, .dart-panel .jimu-widget-cost-analysis-project-summary .jimu-simple-table .head-section {background-color: #808080;}.dart-panel .esriCTCopyFeaturesMainContainer {background-color: #4c4c4c !important;}.claro .dart-panel .jimu-widget-cost-analysis-equation-editor .dijitTextBoxDisabled .dijitInputContainer, .claro .dart-panel .jimu-widget-cost-analysis-project-attribute .dijitTextBoxDisabled .dijitInputContainer, .claro .dart-panel .jimu-widget-cost-analysis-asset-statistics .dijitTextBoxDisabled .dijitInputContainer, .claro .dart-panel .jimu-widget-cost-analysis-equation-editor .dijitTextBoxDisabled, .claro .dart-panel .jimu-widget-cost-analysis-project-attribute .dijitTextBoxDisabled, .claro .dart-panel .jimu-widget-cost-analysis-asset-statistics .dijitTextBoxDisabled {background-color: #888888;}.claro .dart-panel .jimu-widget-cost-template-picker .dijitToolbar {background: transparent !important; background-image: none !important; background-color: #c1c1c1 !important; border: none !important;}.jimu-launchpad-panel .jimu-widget-cost-analysis-add-new-statistics .jimu-simple-table .simple-table-cell {padding-left: 0px; padding-right: 0px;}.jimu-launchpad-panel .jimu-widget-cost-analysis-project-summary .jimu-checkbox,.jimu-launchpad-panel .jimu-widget-cost-analysis-statistics-settings .jimu-checkbox {display: inline-flex;}.claro .jimu-launchpad-panel .jimu-widget-cost-analysis-equation-editor .dijitTextBoxDisabled .dijitInputContainer, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-project-attribute .dijitTextBoxDisabled .dijitInputContainer, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-asset-statistics .dijitTextBoxDisabled .dijitInputContainer, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-equation-editor .dijitDisabled input, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-project-attribute .dijitDisabled input, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-asset-statistics .dijitDisabled input, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-equation-editor textarea.dijitTextAreaDisabled, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-project-attribute textarea.dijitTextAreaDisabled, .claro .jimu-launchpad-panel .jimu-widget-cost-analysis-asset-statistics textarea.dijitTextAreaDisabled {color: #000; background-color: #888888;}.claro .jimu-launchpad-panel .jimu-widget-cost-analysis-project-attribute .dijitComboBox .dijitButtonNode {height: 30px !important;}.esriCTRegionDetailsParentDiv {overflow: hidden; padding-bottom: 20px;}.esriCTScenarioDetailsParentDiv {overflow: hidden;}.esriCTRegionLabel {float: left; width: 29%; line-height: 30px;}.esriCTScenarioLabel {float: left; width: 29%; line-height: 30px;}.esriCTRegionTextBox {width: 70%; float: right;}.esriCTScenarioDropdown {float: right; width: 70%;}.claro .jimu-widget-cost-analysis-scenario-selection .esriCTRegionDetailsParentDiv .dijitTextBox {background-color: #C0C0C0 !important;}.claro .jimu-widget-cost-analysis-scenario-selection .esriCTRegionDetailsParentDiv .dijitTextBoxFocused .dijitTextBoxReadOnlyFocused .dijitReadOnlyFocused {background-color: #C0C0C0 !important;}.esriCTCopyFeaturesMainContainer {border: 1px solid #d9d9d9; position: absolute; top: 0; background-color: #fff; height: calc(100% + 10px); width: 100%;}.jimu-widget-cost-analysis-widget .esriCTSelectFeaturesContainer {padding: 5px; height: calc(100% - 10px); width: 100%;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesListTitle {margin-bottom: 10px; text-align: center; font-weight: bold;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesListContent {height: calc(100% - 110px); width: 100%; overflow: auto;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesNode {margin-bottom: 8px;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesNode:after {content: ""; display: table; clear: both;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesChildNode {margin-left: 16px;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesBtn {margin-top: 10px; margin-right: 5px; margin-left: 5px;}.jimu-widget-cost-analysis-widget .esriCTCopyFeaturesBtnContainer {text-align: center;}.jimu-widget-cost-analysis-widget .checkBoxNode.jimu-checkbox:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateEquationMainContainer {width: 100%;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateEquationMainContainer .jimu-checkbox .label{width: calc(100% - 32px);}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateEquationMainContainer .jimu-checkbox{width: 100%;}.jimu-widget-cost-analysis-create-load-project .esriCTProjectListMainContainer {height: 100%; width: 100%;}.jimu-widget-cost-analysis-create-load-project .esriCTProjectListChildContainer {height: calc(100% - 45px); overflow: auto; padding-bottom: 10px;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateButtonContainer {width: 100%; text-align: center;}.jimu-widget-cost-analysis-create-load-project .esriCTNoFeatureFoundScreen {text-align: center;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateCostRowMainNode {width: 100%; clear: both; padding-top: 10px; padding-bottom: 10px; overflow: hidden;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateCostSelectAll {padding-left: 0px; padding-right: 0px;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateCostProjectRow {padding-left: 16px;}.esriRtl .jimu-widget-cost-analysis-create-load-project .esriCTUpdateCostProjectRow {padding-left: 0px; padding-right: 16px;}.jimu-widget-cost-analysis-create-load-project .esriCTUpdateEquationBtnDisabled {pointer-events: none;}.jimu-widget-cost-analysis-project-summary .jimu-simple-table .head-section .simple-table-thead th.simple-table-field .jimu-checkbox {width: 99%; margin-right: 1px;}.jimu-widget-cost-analysis-asset-statistics .esriCTStatisticsButtonContainer {float: right; width: 20%; padding-top: 10px; margin-bottom: 5px!important;}.jimu-widget-cost-analysis-asset-statistics .esriCTBtnAddStatisticsIcon {height: 100%; width: 14px; background-repeat: no-repeat; background-position: center center; background-image: url("../images/addStatistics.png"); display: inline-block; vertical-align: top;}.esriRtl .jimu-widget-cost-analysis-asset-statistics .esriCTBtnStatisticsAddSection {margin-left: 2px;}',
"*now":function(O){O(['dojo/i18n!*preload*widgets/CostAnalysis/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./Widget.html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/promise/all dojo/Deferred dojo/string dijit/focus dojo/query dojo/dom-style jimu/portalUtils jimu/dijit/LoadingIndicator jimu/LayerInfos/LayerInfos jimu/utils esri/request esri/graphic esri/layers/FeatureLayer ./create-load-project ./work-bench ./add-new-statistics ./project-attribute ./asset-statistics ./utils dojo/keys".split(" "),function(O,
J,K,I,v,e,d,a,w,t,g,l,A,h,p,k,n,m,C,B,y,G,f,b,z,c,D,F,R,N){return O([J,K],{templateString:I,baseClass:"jimu-widget-cost-analysis-widget",_createOrLoadPrj:null,_panels:{},_currentPanel:null,_currentPanelName:null,_layerInfosObj:null,_loadingIndicator:null,_assetDetailStatisticsData:null,_updatedStatisticsData:[],_assetStatistics:null,_createLoadProjectButtonArray:[],_previousOpenedPanel:null,postMixInProperties:function(){this._layerInfosObj=null;this.nls.common={};this.nls.units={};v.mixin(this.nls.common,
window.jimuNls.common);v.mixin(this.nls.units,window.jimuNls.units);var r=A.substitute(this.nls.projectOverview.roundingLabel,{selectedRoundingOption:this.nls.projectOverview.roundCostValues[this.config.generalSettings.roundCostType]});this.nls.projectOverview.roundingLabel=r},postCreate:function(){this.inherited(arguments);this._setTheme();this._getSelectedThemeColor();this._getLayerInfos()},onDeActive:function(){if(this._workBench)this._workBench.onWidgetDeActive()},onActive:function(){if(this._workBench)this._workBench.onWidgetActive()},
onNormalize:function(){this._workBench&&this._workBench.refreshTemplatePicker()},resize:function(){this._workBench&&this._workBench.refreshTemplatePicker();this._addNewStatisticsObj&&this._addNewStatisticsObj.addNewStatisticsObj&&this._addNewStatisticsObj.addNewStatisticsObj.resetAddNewStatisticsDropdown();setTimeout(v.hitch(this,function(){window.appInfo.isRunInMobile&&this._createOrLoadPrj&&this._createOrLoadPrj._resetHeight()}),10);this._openLastVisitedPanel()},onMaximize:function(){this._workBench&&
this._workBench.refreshTemplatePicker()},onOpen:function(){if(this._workBench&&"createLoadPrjPanel"!==this._currentPanelName)this._workBench.onWidgetOpen();this._projectAttribute&&"projectAttribute"===this._currentPanelName&&this._projectAttribute.editProjectAttributes();setTimeout(v.hitch(this,function(){this._openLastVisitedPanel(!0)}),100)},onClose:function(){if(this._workBench)this._workBench.onWidgetClose()},_updateConfigData:function(r){e.forEach(this.config.layerSettings,v.hitch(this,function(E){E.selectedField&&
(E.hasOwnProperty("attributeSetting")||(E.attributeSetting=[]),E.attributeSetting.push({layerField:E.selectedField,projectField:r}),delete E.selectedField)}))},startup:function(){this.inherited(arguments);this._assetStatistics=null;"TabTheme"===this.appConfig.theme.name&&w.add(this.domNode.parentElement,"esriCTOverridePanelStyle");var r=[];if(this.config.projectSettings.projectLayer){var E=this._layerInfosObj.getLayerInfoById(this.config.projectSettings.projectLayer);if(E&&E.layerObject)this.config.projectLayerFields=
R.getPrjLayerFields(E.layerObject);else{R.showMessage(this.nls.projectLayerNotFound);t.set(this.widgetErrorNode,"innerHTML",this.nls.projectLayerNotFound);w.remove(this.widgetErrorNode,"esriCTHidden");return}}r.push(this._getProjectAssetTable());r.push(this._getProjectMulTable());r.push(this._getGeometryServiceURL());r.push(this._getCostingGeometryLayerFields());g(r).then(v.hitch(this,function(q){-1===q.indexOf(!1)?this._initComponents():(t.set(this.widgetErrorNode,"innerHTML",this.nls.unableToFetchInfoErrMessage),
w.remove(this.widgetErrorNode,"esriCTHidden"))}))},_getProjectAssetTable:function(){var r=new l;if(this.config.projectSettings.assetTable){var E;(E=this._layerInfosObj.getTableInfoById(this.config.projectSettings.assetTable))&&E.layerObject?(E=new f(E.layerObject.url),d(E,"load",v.hitch(this,function(q){this.config.assetTableFields=R.getPrjAssetTableFields(q.layer);r.resolve(!0)})),d(E,"error",v.hitch(this,function(){r.resolve(!1)}))):(R.showMessage(this.nls.projectAssetTableNotFound),r.resolve(!1))}else r.resolve(!0);
return r.promise},_getProjectMulTable:function(){var r=new l;if(this.config.projectSettings.multiplierAdditionalCostTable){var E;(E=this._layerInfosObj.getTableInfoById(this.config.projectSettings.multiplierAdditionalCostTable))&&E.layerObject?(E=new f(E.layerObject.url),d(E,"load",v.hitch(this,function(q){this.config.projectMultiplierFields=R.getPrjMultiplierFields(q.layer);r.resolve(!0)})),d(E,"error",v.hitch(this,function(){r.resolve(!1)}))):(R.showMessage(this.nls.projectMultiplierTableNotFound),
r.resolve(!1))}else r.resolve(!0);return r.promise},_getGeometryServiceURL:function(){var r=new l;this.appConfig.portalUrl&&""!==v.trim(this.appConfig.portalUrl)?n.getPortalSelfInfo(this.appConfig.portalUrl).then(v.hitch(this,function(E){this.config.helperServices=E&&E.helperServices;this.config.helperServices&&this.config.helperServices.geometry?r.resolve(!0):r.resolve(!1)}),v.hitch(this,function(){r.resolve(!1)})):r.resolve(!1);return r.promise},_getCostingGeometryLayerFields:function(){var r,E=
new l;this.config.projectSettings.costingGeometryLayer&&this.config.projectSettings.geographyField?((r=this.map.getLayer(this.config.projectSettings.costingGeometryLayer))&&!r.globalIdField&&r.fields&&e.forEach(r.fields,v.hitch(this,function(q){"esriFieldTypeGlobalID"===q.type&&(r.globalIdField=q.name)})),r&&r.globalIdField?E.resolve(!0):(r?R.showMessage(this.nls.invalidCostingGeometryLayer):R.showMessage(this.nls.costingGeometryLayerNotFound),E.resolve(!1))):E.resolve(!0);return E.promise},_initComponents:function(){var r=
{name:"",desc:"",projectId:""};this._initLoadingIndicator();this.config.projectSettings.projectLayer?this._initCreateLoadPrj():this._initWorkBenchPanel(r);this._initAddNewStatistics();this._initAssetDetails();this._initAssetStatistics();this._initProjectSummary();setTimeout(v.hitch(this,function(){this._setFirstAndLastFocusNode()}),500)},_initCreateLoadPrj:function(){this._createOrLoadPrj=new b({nls:this.nls,map:this.map,config:this.config,layerInfosObj:this._layerInfosObj,loadingIndicator:this._loadingIndicator,
appUtils:R,updateLastFocusNode:this._updateLastFocusNode,widgetDomNode:this.domNode,createLoadProjectButtonArray:this._createLoadProjectButtonArray},a.create("div",{},this.createOrLoadProject));this.own(d(this._createOrLoadPrj,"createProject",v.hitch(this,function(r){this._updateConfigData(r.projectIdField);this._initWorkBenchPanel(r);this._assetStatistics||this._initAssetStatistics()})));this.own(d(this._createOrLoadPrj,"loadProject",v.hitch(this,function(r){this._updateConfigData(r.projectIdField);
this._initWorkBenchPanel(r.projectInfo,r)})));this.own(d(this._createOrLoadPrj,"deleteProject",v.hitch(this,function(){this._destroyAssetStatisticsWidget()})));this.own(d(this._createOrLoadPrj,"showCreateLoadPrjPanel",v.hitch(this,function(){this._showPanel("createLoadPrjPanel")})));this._createOrLoadPrj.startup();this._addPanel("createLoadPrjPanel",this.createOrLoadProject);this._showPanel("createLoadPrjPanel")},_initWorkBenchPanel:function(r,E){if(this._workBench)this._workBench.onProjectCreateOrLoad(r,
E),this._showPanel("workBench");else{var q=this._createOrLoadPrj&&this._createOrLoadPrj.selectedProjectFeatureAttr?this._createOrLoadPrj.selectedProjectFeatureAttr:null;this._addPanel("workBench",this.workBenchPanel);this._showPanel("workBench");this._workBench=new z({nls:this.nls,map:this.map,config:this.config,loadingIndicator:this._loadingIndicator,layerInfosObj:this._layerInfosObj,projectInfo:r,selectedProjectFeatureAttr:q,appUtils:R,projectSummaryDiv:this.projectSummary,assetDetailsDiv:this.assetDetails,
assetInfo:E,copyFeaturesNode:this.copyFeatures,widgetId:this.id,widgetDomNode:this.domNode},a.create("div",{},this.workBenchPanel));this.own(d(this._workBench,"reloadProject",v.hitch(this,function(u){this._createOrLoadPrj&&(this._createOrLoadPrj.projectNameSelect.set("value",u),this._createOrLoadPrj.getProjectAssets("LoadProject"))})));this.own(d(this._workBench,"resetProject",v.hitch(this,function(){this._addNewStatisticsObj&&this._addNewStatisticsObj.reset();this._setFirstAndLastFocusNode()})));
this.own(d(this._workBench,"showWorkBenchPanel",v.hitch(this,function(){this._showPanel("workBench");var u=p(".esriCTAssetItems",this.domNode);u&&0<u.length&&h.focus(u[0])})));this.own(d(this._workBench,"showProjectPanel",v.hitch(this,function(){this._addNewStatisticsObj&&this._addNewStatisticsObj.reset();this._showPanel("createLoadPrjPanel")})));this.own(d(this._workBench,"titleClicked",v.hitch(this,function(u){this._previousOpenedPanel="workBench";"0"===u&&this._showPanel("assetDetails");"1"===
u&&this._showPanel("assetStatistics");"2"===u&&this._projectAttribute&&(this._projectAttribute.editProjectAttributes(),this._showPanel("projectAttribute"))})));this.own(d(this._workBench,"showAdditionalCost",v.hitch(this,function(){this._showPanel("projectSummary")})));this.own(d(this._workBench,"showAssetDetails",v.hitch(this,function(){setTimeout(v.hitch(this,function(){this._showPanel("assetDetails");h.focus(this._workBench._assetDetails.additionalCostBtn)}),100)})));this._workBench.startup()}this._initProjectAttribute(r);
this.own(d(this._workBench,"assetInfoUpdated",v.hitch(this,function(u){this._assetStatistics&&(this._assetStatistics.assetItemSummary=u,u=[],u=this.config.statisticsSettings.concat(this._updatedStatisticsData),this._assetStatistics.displayStatisticsDetail(u),setTimeout(v.hitch(this,function(){var x=this._workBench.refreshButton,H=this._workBench.featureModeTextNode;this._workBench.downloadCSVBtn&&"none"!==this._workBench.downloadCSVBtn.style.display&&!w.contains(this._workBench.downloadCSVBtn,"esriCTHidden")&&
this._workBench._canExportProject&&(x=this._workBench.downloadCSVBtn);w.contains(this._workBench.projectNameDiv,"esriCTHidden")||(H=this._workBench.projectNameDiv);R.setFirstAndLastWBFocusNode(this.domNode,H,x);this._workBench&&this._workBench._handle508AccessibilityForTemplatePicker()}),0))})));this.own(d(this._workBench,"onGrossCostUpdated",v.hitch(this,function(u,x){this._loadingIndicator.show();this._getAttributeSettingsInfo(null,{totalCost:u,grossCost:x})})));setTimeout(v.hitch(this,function(){this._setFirstAndLastFocusNode()}),
500)},_initAddNewStatistics:function(){this._addNewStatisticsObj=new c({nls:this.nls,map:this.map,config:this.config,layerInfosObj:this._layerInfosObj,widgetDomNode:this.domNode},a.create("div",{},this.addNewStatisticsNode));this._addNewStatisticsObj.startup();this._addPanel("statisticsPanel",this.addNewStatisticsNode);this.own(d(this._addNewStatisticsObj,"showAssetStatisticsPanel",v.hitch(this,function(){this._previousOpenedPanel="statisticsPanel";this._showPanel("assetStatistics")})));this.own(d(this._addNewStatisticsObj,
"updateStatisticsDetail",v.hitch(this,function(r){var E=[];this._updatedStatisticsData=r;this._assetStatistics&&(E=this.config.statisticsSettings.concat(r),this._assetStatistics.displayStatisticsDetail(E))})))},_initProjectAttribute:function(r){if(r&&r.projectId)if(this._projectAttribute)this._projectAttribute.onProjectLoad(r);else this._projectAttribute=new D({nls:this.nls,map:this.map,config:this.config,layerInfosObj:this._layerInfosObj,projectInfo:r,loadingIndicator:this._loadingIndicator,widgetDomNode:this.domNode},
a.create("div",{},this.projectAttribute)),this.own(d(this._projectAttribute,"onOkButtonClicked",v.hitch(this,function(){this._previousOpenedPanel="projectAttribute";this._showPanel("workBench")}))),this.own(d(this._projectAttribute,"onCancelButtonClicked",v.hitch(this,function(){this._previousOpenedPanel="projectAttribute";this._showPanel("workBench")}))),this.own(d(this._projectAttribute,"onProjectInfoUpdate",v.hitch(this,function(E){this._createOrLoadPrj.selectedProjectFeatureAttr=E.attributes;
this._workBench.updateProjectFeatureAttributes(E.attributes);this._loadingIndicator.show();this._getAttributeSettingsInfo(E.attributes);E=p(".esriCTProjectOverview",this.domNode);h.focus(E[3])}))),this._projectAttribute.startup(),this._addPanel("projectAttribute",this.projectAttribute)},_getAttributeSettingsInfo:function(r,E){var q=[];var u=[],x;for(x in this._workBench._assetItemSummary){var H=this._fetchLayerSettings(x);if((q=H.layerAttrSetting)&&0<q.length){q=[];for(var L in this._workBench._assetItemSummary[x].templates)this._workBench._assetItemSummary[x].templates[L].features&&
(q=this._fetchLayerTemplateFeatures(x,L,H,q,r,E));this._updateFeatureInfoOnLayer(q,x,u)}}g(u).then(v.hitch(this,function(){this._loadingIndicator.hide();var Q=this._workBench.refreshButton,T=this._workBench.featureModeTextNode;"none"===this._workBench.downloadCSVBtn.style.display||w.contains(this._workBench.downloadCSVBtn,"esriCTHidden")||(Q=this._workBench.downloadCSVBtn);w.contains(this._workBench.projectNameDiv,"esriCTHidden")||(T=this._workBench.projectNameDiv);R.setFirstAndLastWBFocusNode(this.domNode,
T,Q);this._workBench&&this._workBench._handle508AccessibilityForTemplatePicker()}))},_fetchLayerSettings:function(r){var E,q;e.some(this.config.layerSettings,v.hitch(this,function(u){u.id===r&&(E=u.attributeSetting,q=u.selectedField)}));return{layerAttrSetting:E,projectField:q}},_fetchLayerTemplateFeatures:function(r,E,q,u,x,H){e.forEach(this._workBench._assetItemSummary[r].templates[E].features,v.hitch(this,function(L){u.push(this._updateFeatureAttributes(r,q.layerAttrSetting,L,x,H))}));return u},
_updateFeatureAttributes:function(r,E,q,u,x){var H,L,Q;var T=new G;T.attributes={};T.attributes=q.attributes;var M=this.map.getLayer(r);var P=this._layerInfosObj.getLayerInfoById(this.config.projectSettings.projectLayer).layerObject;e.forEach(E,v.hitch(this,function(V){u?(H=M.getField(V.layerField).length,L=P.getField(V.projectField).length,Q=u[V.projectField],H<L&&Q&&0<Q.length&&(Q=Q.slice(0,H)),q.attributes[V.layerField]=Q,T.attributes[V.layerField]=Q):("totalassetcost"===V.projectField.toLowerCase()&&
(T.attributes[V.layerField]=x.totalCost),"grossprojectcost"===V.projectField.toLowerCase()&&(T.attributes[V.layerField]=x.grossCost))}));return T},_updateFeatureInfoOnLayer:function(r,E,q){E=this._layerInfosObj.getLayerInfoById(E).layerObject;q&&q.push(E.applyEdits(null,r,null))},_initAssetDetails:function(){this._addPanel("assetDetails",this.assetDetails)},_initAssetStatistics:function(){this._assetStatistics=new F({nls:this.nls,map:this.map,config:this.config,layerInfosObj:this._layerInfosObj,appUtils:R,
widgetDomNode:this.domNode,assetItemSummary:this._workBench?this._workBench._assetItemSummary:{}},a.create("div",{},this.assetStatistics));this.own(d(this._assetStatistics,"onOkButtonClicked",v.hitch(this,function(){this._previousOpenedPanel="assetStatistics";this._showPanel("workBench")})));this.own(d(this._assetStatistics,"onCancelButtonClicked",v.hitch(this,function(){this._showPanel("workBench")})));this.own(d(this._assetStatistics.addNewStatisticsIcon,"click",v.hitch(this,function(){this._addNewStatisticsObj._initAddNewStatistics();
this._showPanel("statisticsPanel")})));this.own(d(this._assetStatistics.addNewStatisticsIcon,"keydown",v.hitch(this,function(r){if(r.keyCode===N.ENTER||r.keyCode===N.SPACE)this._addNewStatisticsObj._initAddNewStatistics(),this._showPanel("statisticsPanel")})));this._assetStatistics.startup();this._addPanel("assetStatistics",this.assetStatistics)},_initProjectSummary:function(){this._addPanel("projectSummary",this.projectSummary)},_getLayerInfos:function(){C.getInstance(this.map,this.map.webMapResponse.itemInfo).then(v.hitch(this,
function(r){this._layerInfosObj=r}))},_initLoadingIndicator:function(){this._loadingIndicator=new m({hidden:!0});this._loadingIndicator.placeAt(this.domNode.parentNode);this._loadingIndicator.startup()},_showPanel:function(r,E){this._currentPanel&&w.add(this._currentPanel,"esriCTHidden");this._currentPanelName=r;this._currentPanel=this._panels[r];w.remove(this._currentPanel,"esriCTHidden");"workBench"===r&&this._workBench&&(this._workBench.onShow(E),this._workBench._handle508AccessibilityForTemplatePicker());
this._openLastVisitedPanel()},_openLastVisitedPanel:function(r){var E;if("createLoadPrjPanel"===this._currentPanelName&&(E=p(".esriCTItemTitleActive",this.domNode)[0]))switch(E=t.get(E,"paneName"),E){case "creatProject":this._setFirstAndLastFocusNode();break;case "loadProject":this._setFirstAndLastFocusNode();E=p(".esriCTProjectOveriew",this.domNode);E=E.length;2===E&&this._updateLastFocusNode(this._createLoadProjectButtonArray[3],this.domNode);h.focus(this._createOrLoadPrj.projectNameSelect);break;
case "updateCostEquation":this._setFirstAndLastFocusNode();E=p(".esriCTProjectNameCheckBox",this.domNode);h.focus(E[0]);var q=this._createOrLoadPrj._updateProjectCostWidget.updateCostEquationButton;w.contains(q,"esriCTUpdateEquationBtnDisabled")?(q=E.length,this._updateLastFocusNode(E[q-1],this.domNode)):this._updateLastFocusNode(q,this.domNode)}"workBench"===this._currentPanelName&&(this._setFirstAndLastFocusNode(),E=p(".esriCTProjectOverview",this.domNode),"assetStatistics"===this._previousOpenedPanel&&
h.focus(E[2]),"projectAttribute"===this._previousOpenedPanel&&h.focus(E[3]),"assetDetails"===this._previousOpenedPanel&&(this._workBench._assetDetails.setFirstAndLastNode(r),h.focus(E[1])),this._workBench&&this._workBench._handle508AccessibilityForTemplatePicker());"assetStatistics"===this._currentPanelName&&this._assetStatistics.setFirstAndLastNode();"statisticsPanel"===this._currentPanelName&&(E=p(".esriCTAddLayerTableNode th",this.domNode)[0].children[0],w.contains(E,"jimu-state-disabled")?(h.focus(this._addNewStatisticsObj.addNewStatisticsObj.btnAddNode),
B.initFirstFocusNode(this.domNode,this._addNewStatisticsObj.addNewStatisticsObj.btnAddNode)):(B.initFirstFocusNode(this.domNode,E),h.focus(p(".esriCTAddLayerTableNode th",this.domNode)[0].children[0])),B.initLastFocusNode(this.domNode,this._addNewStatisticsObj.cancelButtonNode));"assetDetails"===this._currentPanelName&&this._workBench._assetDetails.setFirstAndLastNode(r);"projectSummary"===this._currentPanelName&&this._workBench._projectSummary.setFirstAndLastNode()},_addPanel:function(r,E){this._panels[r]=
E},_hidePanel:function(){w.add(this._currentPanel,"esriCTHidden")},_getSelectedThemeColor:function(){this.config.selectedThemeColor="#000000";var r=this.appConfig.theme.name;var E=this.appConfig&&this.appConfig.theme&&this.appConfig.theme.styles?this.appConfig.theme.styles[0]:"default";this.appConfig&&this.appConfig.theme&&this.appConfig.theme.customStyles&&this.appConfig.theme.customStyles.mainBackgroundColor?this.config.selectedThemeColor=this.appConfig.theme.customStyles.mainBackgroundColor:y({url:"./themes/"+
r+"/manifest.json",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(v.hitch(this,function(q){var u;if(q&&q.styles&&0<q.styles.length)for(u=0;u<q.styles.length;u++){var x=q.styles[u];if(x.name===E){this.config.selectedThemeColor=x.styleColor;break}}}))},_setTheme:function(){var r;if("DashboardTheme"===this.appConfig.theme.name)B.loadStyleLink(this.baseClass+"dashboardOverrideCSS",this.folderUrl+"/css/dashboardTheme.css",null),w.add(this.copyFeatures,"jimu-main-background");else if(r=
document.getElementById(this.baseClass+"dashboardOverrideCSS"))r.disabled=!0},_destroyAssetStatisticsWidget:function(){this._assetStatistics&&this._assetStatistics.destroy();this._assetStatistics=null},_setFirstAndLastFocusNode:function(){if("createLoadPrjPanel"===this._currentPanelName){var r=p(".esriCTProjectOveriew",this.domNode),E=r.length;h.focus(this._createOrLoadPrj.projectNameTextBox.textbox);E&&(B.initFirstFocusNode(this.domNode,r[0]),this._updateLastFocusNode(r[E-1],this.domNode))}"workBench"===
this._currentPanelName&&this._workBench&&(r=this._workBench.featureModeTextNode,w.contains(this._workBench.projectNameDiv,"esriCTHidden")||(r=this._workBench.projectNameDiv),B.initFirstFocusNode(this.domNode,r),h.focus(r),w.contains(this._workBench.downloadCSVBtn,"esriCTHidden")||"none"===k.get(this._workBench.downloadCSVBtn,"display")?this._updateLastFocusNode(this._workBench.refreshButton,this.domNode):this._updateLastFocusNode(this._workBench.downloadCSVBtn,this.domNode),this._workBench._handle508AccessibilityForTemplatePicker())},
_updateLastFocusNode:function(r,E){B.initLastFocusNode(E,r)}})});