// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/dijit/Report":function(){define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented ./PageUtils dojo/text!./templates/ReportTemplate.html dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom dojo/string dojo/on esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/PrintTask dijit/focus dojo/query dojo/dom-attr".split(" "),function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G){return P([J,V],{baseClass:"jimu-report",
_printService:null,_printWindow:null,_sizeInPixels:{},_windowOpenedTimer:null,_shownUnableToPrintMapMsg:!1,printTaskUrl:null,reportLogo:"",reportLayout:{},maxNoOfCols:3,styleSheets:[],styleText:"",constructor:function(){this.inherited(arguments);this._sizeInPixels={};this.printTaskUrl=null;this.reportLayout={};this.styleSheets=[]},postMixInProperties:function(){this.nls=r.mixin(window.jimuNls.common,window.jimuNls.report)},postCreate:function(){var D={pageSize:L.PageSizes.A4,orientation:L.Orientation.Portrait};
this.inherited(arguments);this.setReportLayout(this.reportLayout,D);this.reportLayout.dpi=96;this.printTaskUrl&&this._createPrintTask()},setReportLayout:function(D,k){k||(k=this.reportLayout);this._validateParameters(D)?this.reportLayout=r.mixin(k,D):this.reportLayout=k},setMapLayout:function(D){var k=this.reportLayout.pageSize.MapLayout?this.reportLayout.pageSize.MapLayout:"MAP_ONLY";if("MAP_ONLY"===k)D.exportOptions={dpi:this.reportLayout.dpi},this.reportLayout.orientation.Type===L.Orientation.Landscape.Type&&
this.reportLayout.pageSize!==L.PageSizes.Custom?(D.exportOptions.width=this._sizeInPixels.Height,D.exportOptions.height=this._sizeInPixels.Width):(D.exportOptions.width=this._sizeInPixels.Width,D.exportOptions.height=this._sizeInPixels.Height);else if(k&&L.PageSizes[k])k+=" "+this.reportLayout.orientation.Type;else{var n=[];Object.keys(L.PageSizes).forEach(function(f){n.push(L.PageSizes[f].MapLayout)});-1<n.indexOf(k)&&(k+=" "+this.reportLayout.orientation.Type)}D.layout=k;return D},_validateParameters:function(){return this.reportLayout.pageSize!==
L.PageSizes.Custom||this.reportLayout.size?!0:!1},_createPrintTask:function(){this._printService=new g(this.printTaskUrl,{async:!1})},_createPrintMapParameters:function(D){var k=new d;if(D.printTemplate)if(k=D.printTemplate,k.format){var n=k.format.toLowerCase();"png32"!==n&&"png8"!==n&&"jpg"!==n&&"gif"!==n&&(k.format="jpg")}else k.format="jpg";else k=this.setMapLayout(k),k.layoutOptions={customTextElements:[{Date:""}]},k.preserveScale=!0,k.showAttribution=!0,k.format="jpg";n=new e;n.map=D.map;k.hasOwnProperty("layoutOptions")||
(k.layoutOptions={});k.layoutOptions.titleText=" ";n.template=k;return n},print:function(D,k){if(this._printService){this._shownUnableToPrintMapMsg=!1;var n=screen.width/2;var f=screen.height/1.5;n=11===Q.has("ie")?"toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno,scrollbars\x3dyes, resizable\x3dyes, width\x3d"+n+", height\x3d"+f+", top\x3d"+(screen.height/2-f/2)+", left\x3d"+(screen.width/2-n/2):null;f=Q.detectUserAgent();(f.browser.hasOwnProperty("firefox")&&f.browser.firefox||
f.os.hasOwnProperty("ipad")&&f.os.ipad||f.os.hasOwnProperty("iphone")&&f.os.iphone)&&this._printWindow&&this._printWindow.close();this._printWindow=window.open("","_blank",n,!1);this._windowOpenedTimer&&clearInterval(this._windowOpenedTimer);this._windowOpenedTimer=setInterval(r.hitch(this,function(){this._printWindow.closed&&(clearInterval(this._windowOpenedTimer),this.emit("report-window-closed"))}),500);this._printWindow.focus();setTimeout(r.hitch(this,function(){w.withDoc(this._printWindow.document,
r.hitch(this,function(){this._printWindow.document.open("text/html","replace");this._printWindow.document.write(z);window.isRTL&&K.add(b.byId("reportBody"),"jimu-rtl");(this.styleSheets&&0<this.styleSheets.length||this.styleText&&""!==this.styleText)&&this._addExternalStyleSheets();this._setPageSize();this._setButtonLabels();this._setReportSizeMessage();this._setReportLogo();this._setReportTitle(D);this._setReportData(k);this._setFootNotes();this._setAccessibility();this._printWindow.document.close()}))}),
500)}else this.emit("reportError")},_addExternalStyleSheets:function(){var D=b.byId("reportHead");D&&(u.forEach(this.styleSheets,r.hitch(this,function(k){x.create("link",{rel:"stylesheet",type:"text/css",href:k},D)})),this.styleText&&x.create("style",{type:"text/css",innerHTML:this.styleText},D))},_setPageSize:function(){var D=b.byId("reportMain");if(this.reportLayout){var k=this.reportLayout.pageSize;this.reportLayout.pageSize===L.PageSizes.Custom&&this.reportLayout.size&&(k=this.reportLayout.size);
k=L.getPageSizeInPixels(k,this.reportLayout.dpi)}var n=this.reportLayout.orientation.Type===L.Orientation.Landscape.Type&&this.reportLayout.pageSize!==L.PageSizes.Custom?k.Height:k.Width;this._sizeInPixels=k;c.set(D,{width:n+"px"})},_setReportData:function(D){var k=b.byId("reportData"),n=b.byId("showErrorButton");n.innerHTML=this.nls.unableToPrintMapMsg;k&&u.forEach(D,r.hitch(this,function(f){var y=x.create("div",{},k);f.addPageBreak&&K.add(y,"esriCTPageBreak");"table"===f.type?this._formatAndRenderTables(y,
f):"html"===f.type?this._renderHTMLData(y,f):"map"===f.type?(f.title&&this._addSectionTitle(f.title,y),K.add(y,"esriCTReportMap esriCTReportMapWait"),f.extent&&f.data.map.setExtent(f.extent),this._executePrintTask(f,y,n)):"note"===f.type&&this._createReportNote(y,f)}))},_setFootNotes:function(){var D;if((D=b.byId("footNotes"))&&this.footNotes){var k=Q.sanitizeHTML(this.footNotes?this.footNotes:"");D.innerHTML=Q.fieldFormatter.getFormattedUrl(k)}},_setReportLogo:function(){var D;if((D=b.byId("reportLogo"))&&
this.reportLogo){K.remove(D,"esriCTHidden");D.src=this.reportLogo;G.set(D,"alt",this.nls.image);var k=b.byId("reportHeader");var n=b.byId("reportMain");var f=b.byId("printTitleDiv");window.isRTL&&x.place(f,k,"first");n&&f&&(D.complete&&c.set(f,{width:n.clientWidth-D.clientWidth-51+"px"}),this.own(m(D,"load",r.hitch(this,function(){setTimeout(r.hitch(this,function(){c.set(f,{width:n.clientWidth-D.clientWidth-51+"px"})}),300)}))))}},_setReportTitle:function(D){var k=b.byId("reportTitle");k&&D&&(k.value=
D);G.set(k,"aria-label",this.nls.title)},_createReportNote:function(D,k){var n="";k.title&&(n=k.title);n=this._addSectionTitle(n,D);K.add(n,"esriCTNotesTitle");var f=x.create("textarea",{"class":"esriCTReportNotes",placeholder:this.nls.notesHint,rows:5,tabindex:"0",role:"textbox","aria-label":this.nls.notesHint},D);var y=x.create("p",{"class":"esriCTReportNotesParagraph"},D);K.add(D,"esriCTNotesContainer");k.defaultText&&(f.value=k.defaultText);this.own(m(f,"keydown, change",function(){f.style.height=
"auto";y.innerHTML=Q.sanitizeHTML(f.value?f.value:"");f.style.height=f.scrollHeight+"px"}))},_setReportSizeMessage:function(){if(this.reportLayout.pageSize===L.PageSizes.Custom&&this.reportLayout.size){var D=this.reportLayout.size;var k=this.reportLayout.pageSize}else D=this.reportLayout.pageSize,k=this.reportLayout.pageSize.SizeName?this.reportLayout.pageSize.SizeName:this.reportLayout.SizeName;D=this.reportLayout.orientation.Type===L.Orientation.Landscape.Type&&this.reportLayout.pageSize!==L.PageSizes.Custom?
" ("+D.Height+"'' X "+D.Width+"'') ":" ("+D.Width+"'' X "+D.Height+"'') ";b.byId("reportBarMsg").innerHTML=q.substitute(this.nls.reportDimensionsMsg,{paperSize:k+D+this.reportLayout.orientation.Text})},_setButtonLabels:function(){var D=b.byId("printButton");D.innerHTML=this.nls.printButtonLabel;D.title=this.nls.printButtonLabel;D=b.byId("closeButton");D.innerHTML=this.nls.close;D.title=this.nls.close},_executePrintTask:function(D,k,n){D=this._createPrintMapParameters(D);this._printService.execute(D,
r.hitch(this,function(f){k&&(K.remove(k,"esriCTReportMapWait"),f=x.create("img",{src:f.url,"class":"esriCTReportMapImg","aria-label":this.nls.mapArea},k),this.reportLayout.orientation.Type===L.Orientation.Landscape.Type&&K.add(f,"esriCTReportLandscapeMapImg"));this.emit("report-export-task-completed")}),r.hitch(this,function(){K.replace(k,"esriCTReportMapFail","esriCTPageBreak esriCTReportMapWait");this._shownUnableToPrintMapMsg||(this._shownUnableToPrintMapMsg=!0,n.click());this.emit("report-export-task-failed")}))},
_renderHTMLData:function(D,k){D=x.create("div",{"class":"esriCTHTMLData"},D);k.title&&this._addSectionTitle(k.title,D);x.create("div",{innerHTML:k.data},D)},_addSectionTitle:function(D,k){D=Q.sanitizeHTML(D?D:"");return x.create("div",{innerHTML:D,"class":D?"esriCTSectionTitle":""},k)},_formatAndRenderTables:function(D,k){var n=k.data,f,y=this.maxNoOfCols;n.maxNoOfCols&&(y=n.maxNoOfCols);n.cols.length>y&&2>=n.cols.length-y&&(y=n.cols.length);var I=0;for(f=n.cols.length;I<f;I+=y){var C={cols:[],rows:[]},
N=I+y,R=!1;C.title=0===I?k.title:"";var a=n.cols.length-N;2>=a&&0<a&&(N+=a,R=!0);a=n.cols.slice(I,N);var v=[];for(var H=0;H<n.rows.length;H++)v.push(n.rows[H].slice(I,N));C.cols=a;C.rows=v;this._renderTable(x.create("div",{},D),C,k.data.showRowIndex);if(R)break}},_renderTable:function(D,k,n){this._addSectionTitle(k.title,D);D=x.create("table",{cellpadding:5,style:{width:"100%"},"class":"esriCTTable"},D);var f=x.create("tbody",{},D);var y=x.create("tr",{},f);n&&x.create("th",{innerHTML:"#",style:{width:"20px"}},
y);u.forEach(k.cols,r.hitch(this,function(I){x.create("th",{innerHTML:I},y)}));u.forEach(k.rows,r.hitch(this,function(I,C){var N=x.create("tr",{},f);n&&x.create("td",{innerHTML:C+1,style:{"word-wrap":"normal"}},N);u.forEach(I,r.hitch(this,function(R){R=Q.fieldFormatter.getFormattedUrl(R);x.create("td",{innerHTML:R},N)}))}))},_setAccessibility:function(){this._setFirstFocusNode();this._setLastFocusNode();this._focusFirstNodeOfReport()},_setFirstFocusNode:function(){var D=b.byId("reportTitle");""!==
D&&null!==D&&void 0!==D&&Q.initFirstFocusNode(this._printWindow.document,D)},_setLastFocusNode:function(){var D=F(".esriCTReportNotes",this._printWindow.document);""!==D&&null!==D&&void 0!==D&&0<D.length?Q.initLastFocusNode(this._printWindow.document,D[0]):(D=F(".esriCTLocaleDateInputTitle",this._printWindow.document),""!==D&&null!==D&&void 0!==D&&0<D.length?Q.initLastFocusNode(this._printWindow.document,D[0]):(D=F(".esriCTAOIInputArea",this._printWindow.document),""!==D&&null!==D&&void 0!==D&&0<
D.length&&Q.initLastFocusNode(this._printWindow.document,D[0])))},_focusFirstNodeOfReport:function(){var D=b.byId("reportTitle");""!==D&&null!==D&&void 0!==D&&(E.curNode&&E.curNode.blur(),E.focus(D))}})})},"jimu/dijit/PageUtils":function(){define([],function(){var P={};P.Orientation={Landscape:{Type:"Landscape",Text:window.jimuNls.report.landscape},Portrait:{Type:"Portrait",Text:window.jimuNls.report.portrait}};P.PageSizes={A0:{Height:46.8,Width:33.1,SizeName:window.jimuNls.report.a0,MapLayout:"MAP_ONLY"},
A1:{Height:33.1,Width:23.4,SizeName:window.jimuNls.report.a1,MapLayout:"MAP_ONLY"},A2:{Height:23.4,Width:16.5,SizeName:window.jimuNls.report.a2,MapLayout:"MAP_ONLY"},A3:{Height:16.5,Width:11.7,SizeName:window.jimuNls.report.a3,MapLayout:"A3"},A4:{Height:11.7,Width:8.3,SizeName:window.jimuNls.report.a4,MapLayout:"A4"},A5:{Height:8.3,Width:5.8,SizeName:window.jimuNls.report.a5,MapLayout:"MAP_ONLY"},Letter_ANSI_A:{Height:11,Width:8.5,SizeName:window.jimuNls.report.letter+" "+window.jimuNls.report.ansi_a,
MapLayout:"Letter ANSI A"},Tabloid_ANSI_B:{Height:17,Width:11,SizeName:window.jimuNls.report.tabloid+" "+window.jimuNls.report.ansi_b,MapLayout:"Tabloid ANSI B"},ANSI_C:{Height:22,Width:17,SizeName:window.jimuNls.report.ansi_c,MapLayout:"MAP_ONLY"},ANSI_D:{Height:34,Width:22,SizeName:window.jimuNls.report.ansi_d,MapLayout:"MAP_ONLY"},ANSI_E:{Height:44,Width:34,SizeName:window.jimuNls.report.ansi_e,MapLayout:"MAP_ONLY"},Legal:{Height:14,Width:8.5,SizeName:window.jimuNls.report.legal,MapLayout:"MAP_ONLY"},
Custom:window.jimuNls.common.custom};P.getPageSizeInPixels=function(J,Q){return{Height:J.Height*Q,Width:J.Width*Q}};return P})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});Q("extend-esri")&&J.setObject("tasks.PrintParameters",P,V);return P})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});Q("extend-esri")&&J.setObject("tasks.PrintTemplate",P,V);return P})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k,n){P=P(E,{declaredClass:"esri.tasks.PrintTask",constructor:function(f,y){this.url=f;this.printGp=new d(this.url);this._handler=J.hitch(this,this._handler);y&&y.async&&(this.async=!0);this._colorEvaluator=n("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(f,y,I){if(!this._loadGpServerMetadata)return this._execute(f,y,I);var C=new L(x._dfdCanceller),N=this._url.path,R=N.lastIndexOf("/GPServer/");
0<R&&(N=N.slice(0,R+9));C._pendingDfd=c({url:N,callbackParamName:"callback",content:J.mixin({},this._url.query,{f:"json"})}).then(J.hitch(this,function(a){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===a.executionType;this._cimVersion=a.cimVersion;this._is11xService=!!this._cimVersion;C._pendingDfd=this._execute(f);return C._pendingDfd})).then(J.hitch(this,function(a){this._successHandler([a],null,y,C)})).otherwise(function(a){I&&I(a);C.errback(a)});return C},_handler:function(f,
y,I,C,N){try{if(this.async)"esriJobSucceeded"===f.jobStatus?this.printGp.getResultData(f.jobId,"Output_File",J.hitch(this,function(a){R=a.value;this._successHandler([R],"onComplete",I,N)})):this._errorHandler(Error(f.jobStatus),C,N);else{var R=f[0].value;this._successHandler([R],"onComplete",I,N)}}catch(a){this._errorHandler(a,C,N)}},_execute:function(f,y,I){var C=this._handler,N=this._errorHandler,R=f.template||new g;R.hasOwnProperty("showLabels")||(R.showLabels=!0);var a=R.exportOptions,v;a&&(v=
{outputSize:[a.width,a.height],dpi:a.dpi});a=R.layoutOptions;var H=[];if(a){this.legendAll=!1;a.legendLayers?Q.forEach(a.legendLayers,function(S){var T={};T.id=S.layerId;S.subLayerIds&&(T.subLayerIds=S.subLayerIds);H.push(T)}):this.legendAll=!0;if("Miles"===a.scalebarUnit||"Kilometers"===a.scalebarUnit){var l="esriKilometers";var h="esriMiles"}else if("Meters"===a.scalebarUnit||"Feet"===a.scalebarUnit)l="esriMeters",h="esriFeet";var A={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};
A={titleText:a.titleText,authorText:a.authorText,copyrightText:a.copyrightText,customTextElements:a.customTextElements,scaleBarOptions:{metricUnit:l,metricLabel:A[l],nonMetricUnit:h,nonMetricLabel:A[h]},legendOptions:{operationalLayers:H}}}l=this._getPrintDefinition(f.map,R);f.outSpatialReference&&(l.mapOptions.spatialReference=f.outSpatialReference.toJson());f.template&&u.isDefined(f.template.showAttribution)&&(l.mapOptions.showAttribution=f.template.showAttribution);J.mixin(l,{exportOptions:v,layoutOptions:A});
this.allLayerslegend&&J.mixin(l.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(l.operationalLayers){v=l.operationalLayers;var O=function(S){return u.fixJson(J.mixin(S,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},X=RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),W=/[\u0600-\u06FF]/,ba=function(S){var T=S.text,Y=(S=S.font)&&S.family&&S.family.toLowerCase();T&&S&&("arial"===Y||"arial unicode ms"===Y)&&
(S.family=X.test(T)?"Arial Unicode MS":"Arial","normal"!==S.style&&W.test(T)&&(S.family="Arial Unicode MS"))};for(A=0;A<v.length;A++)if(v[A].featureCollection&&v[A].featureCollection.layers)for(h=0;h<v[A].featureCollection.layers.length;h++){var ea=v[A].featureCollection.layers[h];if(ea.layerDefinition&&ea.layerDefinition.drawingInfo&&ea.layerDefinition.drawingInfo.renderer&&ea.layerDefinition.drawingInfo.renderer.symbol){var fa=ea.layerDefinition.drawingInfo.renderer;"esriCLS"===fa.symbol.type?fa.symbol=
O(fa.symbol):"esriTS"===fa.symbol.type?ba(fa.symbol):fa.symbol.outline&&"esriCLS"===fa.symbol.outline.type&&(fa.symbol.outline=O(fa.symbol.outline))}if(ea.featureSet&&ea.featureSet.features)for(a=0;a<ea.featureSet.features.length;a++)fa=ea.featureSet.features[a],fa.symbol&&("esriCLS"===fa.symbol.type?fa.symbol=O(fa.symbol):"esriTS"===fa.symbol.type?ba(fa.symbol):fa.symbol.outline&&"esriCLS"===fa.symbol.outline.type&&(fa.symbol.outline=O(fa.symbol.outline)))}}R={Web_Map_as_JSON:V.toJson(u.fixJson(l)),
Format:R.format,Layout_Template:R.layout};f.extraParameters&&(R=J.mixin(R,f.extraParameters));var ha=new L(x._dfdCanceller);f=function(S,T){C(S,T,y,I,ha)};l=function(S){N(S,I,ha)};ha._pendingDfd=this.async?this.printGp.submitJob(R,f,null,l):this.printGp.execute(R,f,l);return ha},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",
features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(f){if(!(8>=z("ie")||!f.path&&"image/svg+xml"!==f.contentType)){var y=k.createSurface(G.create("div"),1024,1024);var I="image/svg+xml"===f.contentType?y.createObject(k.Image,{src:"data:image/svg+xml;base64,"+f.imageData,width:D.pt2px(f.width),height:D.pt2px(f.height),x:0,y:0}):y.createObject(k.Path,f.path).setFill(f.color).setStroke(f.outline);"pendingRender"in y&&y._render(!0);var C=
y.rawNode.getContext("2d"),N=Math.ceil(I.getBoundingBox().width),R=Math.ceil(I.getBoundingBox().height);I=C.getImageData(I.getBoundingBox().x,I.getBoundingBox().y,N,R);C.canvas.width=N;C.canvas.height=R;C.putImageData(I,0,0);C=C.canvas.toDataURL("image/png");f={type:"esriPMS",imageData:C.substr(22,C.length),angle:f.angle,contentType:"image/png",height:f.size?f.size:D.px2pt(R),width:f.size?N/R*f.size:D.px2pt(N),xoffset:f.xoffset,yoffset:f.yoffset};y.destroy();return f}},_convertSvgRenderer:function(f){"simple"===
f.type&&f.symbol&&(f.symbol.path||"image/svg+xml"===f.symbol.contentType)?f.symbol=this._convertSvgSymbol(f.symbol):"uniqueValue"===f.type?(f.defaultSymbol&&(f.defaultSymbol.path||"image/svg+xml"===f.defaultSymbol.contentType)&&(f.defaultSymbol=this._convertSvgSymbol(f.defaultSymbol)),f.uniqueValueInfos&&Q.forEach(f.uniqueValueInfos,function(y){if(y.symbol.path||"image/svg+xml"===y.symbol.contentType)y.symbol=this._convertSvgSymbol(y.symbol)},this)):"classBreaks"===f.type&&(f.defaultSymbol&&(f.defaultSymbol.path||
"image/svg+xml"===f.defaultSymbol.contentType)&&(f.defaultSymbol=this._convertSvgSymbol(f.defaultSymbol)),f.classBreakInfos&&Q.forEach(f.classBreakInfos,function(y){if(y.symbol.path||"image/svg+xml"===y.symbol.contentType)y.symbol=this._convertSvgSymbol(y.symbol)},this))},_createFeatureCollection:function(f,y,I,C){var N=this._createPolygonLayer(),R=this._createPolylineLayer(),a=this._createPointLayer(),v=this._createMultipointLayer(),H=this._createPointLayer();H.layerDefinition.name="textLayer";delete H.layerDefinition.drawingInfo;
if("esri.layers.FeatureLayer"===f.declaredClass||"esri.layers.StreamLayer"===f.declaredClass)N.layerDefinition.name=R.layerDefinition.name=a.layerDefinition.name=v.layerDefinition.name=J.getObject("arcgisProps.title",!1,f)||f.name||f.id;var l=f.renderer&&"esri.renderer.SimpleRenderer"===f.renderer.declaredClass;if(!f.renderer||f.renderer.valueExpression||J.isFunction(f.renderer.attributeField))delete N.layerDefinition.drawingInfo,delete R.layerDefinition.drawingInfo,delete a.layerDefinition.drawingInfo,
delete v.layerDefinition.drawingInfo;else{var h=f.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===h.type){h={latestObservationRenderer:h.latestObservationRenderer,trackLinesRenderer:h.trackRenderer,observationAger:h.observationAger,renderer:h.observationRenderer};var A={};f._trackIdField&&(A.trackIdField=f._trackIdField);f._startTimeField&&(A.startTimeField=f._startTimeField);f._endTimeField&&(A.endTimeField=f._endTimeField);N.layerDefinition.drawingInfo=h;N.layerDefinition.timeInfo=
A;R.layerDefinition.drawingInfo=h;R.layerDefinition.timeInfo=A;a.layerDefinition.drawingInfo=h;a.layerDefinition.timeInfo=A;v.layerDefinition.drawingInfo=h;v.layerDefinition.timeInfo=A}else N.layerDefinition.drawingInfo.renderer=h,R.layerDefinition.drawingInfo.renderer=h,a.layerDefinition.drawingInfo.renderer=h,v.layerDefinition.drawingInfo.renderer=h}h=f.fields;h||!f.renderer||f.renderer.valueExpression||J.isFunction(f.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===f.renderer.declaredClass?
(h=[{name:f.renderer.attributeField,type:"esriFieldTypeDouble"}],f.renderer.normalizationField&&h.push({name:f.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===f.renderer.declaredClass&&(h=[{name:f.renderer.attributeField,type:"esriFieldTypeString"}],f.renderer.attributeField2&&h.push({name:f.renderer.attributeField2,type:"esriFieldTypeString"}),f.renderer.attributeField3&&h.push({name:f.renderer.attributeField3,type:"esriFieldTypeString"})));h&&(N.layerDefinition.fields=
h,R.layerDefinition.fields=h,a.layerDefinition.fields=h,v.layerDefinition.fields=h);h=f.graphics;f.isFeatureReductionActive&&f.isFeatureReductionActive()&&(h=f.getSingleGraphics());A=h.length;var O;for(O=0;O<A;O++){var X=h[O];if(!1!==X.visible&&X.geometry){var W=X.toJson();W.symbol&&W.symbol.outline&&W.symbol.outline.color&&W.symbol.outline.color[3]&&!this._is11xService&&(W.symbol.outline.color[3]=255);if(f.renderer&&!W.symbol&&(J.isFunction(f.renderer.attributeField)||f.renderer.valueExpression||
this._isFeatureCollectionRequired(f.renderer,f)||"esri.renderer.DotDensityRenderer"===f.renderer.declaredClass||I)){I=I||f.renderer;var ba=null;try{ba=I.getSymbol(X)}catch(ea){}if(!ba)continue;W.symbol=ba.toJson();this._isFeatureCollectionRequired(I,f)&&this._applyVisualVariables(W.symbol,{renderer:I,graphic:X,symbol:ba,mapResolution:y&&y.getResolutionInMeters(),mapScale:y&&y.getScale()})}W.symbol&&(W.symbol.path||"image/svg+xml"===W.symbol.contentType?W.symbol=this._convertSvgSymbol(W.symbol):W.symbol.text&&
delete W.attributes);switch(X.geometry.type){case "polygon":N.featureSet.features.push(W);break;case "polyline":R.featureSet.features.push(W);break;case "point":W.symbol&&W.symbol.text?H.featureSet.features.push(W):a.featureSet.features.push(W);break;case "multipoint":v.featureSet.features.push(W);break;case "extent":W.geometry=q.fromExtent(X.geometry).toJson(),N.featureSet.features.push(W)}}}y=[];0<N.featureSet.features.length&&y.push(N);0<R.featureSet.features.length&&y.push(R);0<v.featureSet.features.length&&
y.push(v);0<a.featureSet.features.length&&y.push(a);0<H.featureSet.features.length&&y.push(H);if(!y.length)return null;Q.forEach(y,function(ea){var fa=Q.every(ea.featureSet.features,function(ha){return ha.symbol});if(l||fa)C&&C.forceFeatureAttributes||Q.forEach(ea.featureSet.features,function(ha){delete ha.attributes}),C.forceFeatureAttributes||delete ea.layerDefinition.fields;fa&&delete ea.layerDefinition.drawingInfo});Q.forEach(y,function(ea){ea.layerDefinition.drawingInfo&&ea.layerDefinition.drawingInfo.renderer&&
this._convertSvgRenderer(ea.layerDefinition.drawingInfo.renderer)},this);return{id:f.id,opacity:f.opacity,minScale:f.minScale||0,maxScale:f.maxScale||0,featureCollection:{layers:y}}},_getPrintDefinition:function(f,y){var I={operationalLayers:this._createOperationalLayers(f,y)},C=this._vtlExtent||f.extent,N=f.spatialReference;this._vtlExtent=null;f.spatialReference._isWrappable()&&(C=C._normalize(!0),N=C.spatialReference);C={mapOptions:{showAttribution:f.showAttribution,extent:C.toJson(),spatialReference:N.toJson()}};
y.preserveScale&&J.mixin(C.mapOptions,{scale:y.outScale||f.getScale()});f.timeExtent&&J.mixin(C.mapOptions,{time:[f.timeExtent.startTime.getTime(),f.timeExtent.endTime.getTime()]});f={};J.mixin(f,C,I);return f},_createOperationalLayers:function(f,y){var I,C=[],N=0;y.preserveScale&&(N=y.outScale||f.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var R=Q.map(f.layerIds,f.getLayer,f);f._mapImageLyr&&R.push(f._mapImageLyr);for(I=0;I<R.length;I++){var a=R[I];if(a.loaded&&a.visible&&
(!N||a.isVisibleAtScale(N))){var v=a.declaredClass;var H={id:a.id,title:J.getObject("arcgisProps.title",!1,a)||a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0};H=J.mixin(H,this._getUrlAndToken(a));a.getNode()&&F.get(a.getNode(),"data-reference")&&(H._isRefLayer=!0);switch(v){case "esri.layers.ArcGISDynamicMapServiceLayer":var l=[];v=!!a._params.layers;if(a._params.dynamicLayers)v=y.outScale?a._getDynLayerObjs(y.outScale):V.fromJson(a._params.dynamicLayers),Q.forEach(v,function(W){l.push({id:W.id,
name:W.name,layerDefinition:W});delete W.id;delete W.name;delete W.maxScale;delete W.minScale}),0===l.length&&(H.visibleLayers=[-1]);else if(a.supportsDynamicLayers){if(v||a.layerDefinitions||a.layerTimeOptions){var h=a.createDynamicLayerInfosFromLayerInfos(),A=null;v&&(A=a.visibleLayers);A=w._getVisibleLayers(h,A);var O=w._getLayersForScale(y.outScale||f.getScale(),h);Q.forEach(h,function(W){if(!W.subLayerIds){var ba=W.id;-1<Q.indexOf(A,ba)&&-1<Q.indexOf(O,ba)&&(W={source:W.source.toJson()},a.layerDefinitions&&
a.layerDefinitions[ba]&&(W.definitionExpression=a.layerDefinitions[ba]),a.layerTimeOptions&&a.layerTimeOptions[ba]&&(W.layerTimeOptions=a.layerTimeOptions[ba].toJson()),l.push({id:ba,layerDefinition:W}))}});0===l.length&&(H.visibleLayers=[-1])}}else Q.forEach(a.layerInfos,function(W){var ba={id:W.id,layerDefinition:{}};a.layerDefinitions&&a.layerDefinitions[W.id]&&(ba.layerDefinition.definitionExpression=a.layerDefinitions[W.id]);a.layerTimeOptions&&a.layerTimeOptions[W.id]&&(ba.layerDefinition.layerTimeOptions=
a.layerTimeOptions[W.id].toJson());(ba.layerDefinition.definitionExpression||ba.layerDefinition.layerTimeOptions)&&l.push(ba)}),v&&(H.visibleLayers=a.visibleLayers.length?a.visibleLayers:[-1]);l.length&&(H.layers=l);C.push(H);this.allLayerslegend&&this.allLayerslegend.push({id:a.id,subLayerIds:a.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":H=J.mixin(H,{url:a.url,bandIds:a.bandIds,compressionQuality:a.compressionQuality,format:a.format,interpolation:a.interpolation});a.mosaicRule&&
J.mixin(H,{mosaicRule:a.mosaicRule.toJson()});if(a.renderingRule||a.renderer)this._is11xService?(a.renderingRule&&(H.renderingRule=a.renderingRule.toJson()),a.renderer&&(H.layerDefinition=H.layerDefinition||{},H.layerDefinition.drawingInfo=H.layerDefinition.drawingInfo||{},H.layerDefinition.drawingInfo.renderer=a.renderer.toJson())):(v=a.getExportImageRenderingRule())&&J.mixin(H,{renderingRule:v.toJson()});C.push(H);this.allLayerslegend&&this.allLayerslegend.push({id:a.id});break;case "esri.layers.RasterXLayer":this._is11xService&&
(H=J.mixin(H,{url:a.url,bandIds:a.bandIds,interpolation:a.interpolation}),a.renderer&&(H.layerDefinition=H.layerDefinition||{},H.layerDefinition.drawingInfo=H.layerDefinition.drawingInfo||{},H.layerDefinition.drawingInfo.renderer=a.renderer.toJson()),C.push(H),this.allLayerslegend&&this.allLayerslegend.push({id:a.id}));break;case "esri.layers.WMSLayer":H=J.mixin(H,{url:a.url,title:a.title,type:"wms",version:a.version,transparentBackground:a.imageTransparency,visibleLayers:a.visibleLayers});C.push(H);
this.allLayerslegend&&this.allLayerslegend.push({id:a.id,subLayerIds:a.visibleLayers});break;case "esri.virtualearth.VETiledLayer":v=a.mapStyle;"roadOnDemand"===v?v="Road":"aerialWithLabelsOnDemand"===v&&(v="Hybrid");H=J.mixin(H,{visibility:a.visible,type:"BingMaps"+v,culture:a.culture,key:a.bingMapsKey});C.push(H);break;case "esri.layers.OpenStreetMapLayer":H=J.mixin(H,{credits:a.copyright,type:"OpenStreetMap",url:b.getAbsoluteUrl(a.tileServers[0])});C.push(H);break;case "esri.layers.WMTSLayer":H=
J.mixin(H,{url:a.url,type:"wmts",layer:a._identifier,style:a._style,format:a.format,tileMatrixSet:a._tileMatrixSetId});C.push(H);break;case "esri.layers.MapImageLayer":v=a.getImages();Q.forEach(v,function(W,ba){W.visible&&W.href&&(H={id:a.id+"_image"+ba,type:"image",title:a.id,minScale:a.minScale||0,maxScale:a.maxScale||0,opacity:a.opacity*W.opacity,extent:W.extent.toJson()},"data:image/png;base64,"===W.href.substr(0,22)?H.imageData=W.href.substr(22):H.url=W.href,C.push(H))});break;case "esri.layers.VectorTileLayer":delete H.url;
delete H.token;if(this._is11xService&&a.currentStyleInfo.serviceUrl&&a.currentStyleInfo.styleUrl&&(v=r.id&&r.id.findCredential(a.currentStyleInfo.styleUrl),h=r.id&&r.id.findCredential(a.currentStyleInfo.serviceUrl),!v&&!h||"2.1.0"!==this._cimVersion)){H.type="VectorTileLayer";H.styleUrl=a.currentStyleInfo.styleUrl;v&&(H.token=v.token);h&&h.token!==H.token&&(H.additionalTokens=[{url:a.currentStyleInfo.serviceUrl,token:h.token}]);C.push(H);break}H.type="image";v=this._vtlExtent||f.extent.offset(0,0);
var X=y.exportOptions&&y.exportOptions.dpi||96;h={format:"png",pixelRatio:X/96};"MAP_ONLY"!==y.layout||!y.preserveScale||y.outScale&&y.outScale!==f.getScale()||96!==X||!y.exportOptions||y.exportOptions.width%2===f.width%2&&y.exportOptions.height%2===f.height%2||(h.area={x:0,y:0,width:f.width,height:f.height},y.exportOptions.width%2!==f.width%2&&--h.area.width,y.exportOptions.height%2!==f.height%2&&--h.area.height,this._vtlExtent||(X=f.toMap({x:h.area.width,y:h.area.height}),v.update(v.xmin,X.y,X.x,
v.ymax,v.spatialReference),this._vtlExtent=v));H.extent=v._normalize(!0).toJson();v=a.takeScreenshot(h);v.isResolved()?v.then(function(W){"data:image/png;base64,"===W.dataURL.substr(0,22)&&(H.imageData=W.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");H.imageData&&C.push(H);break;case "esri.layers.WebTiledLayer":v=a.url.replace(/\$\{/g,"{");H=J.mixin(H,{type:"WebTiledLayer",urlTemplate:v,credits:a.copyright});a.subDomains&&0<a.subDomains.length&&
(H.subDomains=a.subDomains);a._wmtsInfo&&(H.wmtsInfo=a._wmtsInfo);delete H.url;C.push(H);break;default:if(a.getTileUrl||a.getImageUrl)H=J.mixin(H,{url:a.url}),C.push(H)}}}R=Q.map(f.graphicsLayerIds,f.getLayer,f);for(I=0;I<R.length;I++)a=R[I],a.isFeatureReductionActive&&a.isFeatureReductionActive()&&(a.getSingleGraphics().length?R.splice(++I,0,a.getFeatureReductionLayer()):R[I]=a.getFeatureReductionLayer());for(I=0;I<R.length;I++)if(a=R[I],a.loaded&&a.visible&&(!N||a.isVisibleAtScale(N)))switch(v=
a.declaredClass,v){case "esri.layers.CSVLayer":if(this._is11xService){H={id:a.id,url:a.url,title:a.title,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:a.latitudeFieldName,longitudeFieldName:a.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:a.renderer&&a.renderer.toJson()}}};C.push(H);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===v&&!y.showLabels||
a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass)continue;v=null;a.url&&a.renderer&&("esri.renderer.ScaleDependentRenderer"===a.renderer.declaredClass?"scale"===a.renderer.rangeType?v=a.renderer.getRendererInfoByScale(f.getScale())&&a.renderer.getRendererInfoByScale(f.getScale()).renderer:"zoom"===a.renderer.rangeType&&(v=a.renderer.getRendererInfoByZoom(f.getZoom())&&a.renderer.getRendererInfoByZoom(f.getZoom()).renderer):v=a.renderer);h=v&&"esri.layers.CSVLayer"!==a.declaredClass&&
!this._isFeatureCollectionRequired(v,a)&&!v.valueExpression;X=a.isFeatureReductionActive&&a.isFeatureReductionActive();if(v&&!X&&"esri.renderer.DotDensityRenderer"!==v.declaredClass&&"esri.layers.StreamLayer"!==a.declaredClass&&(this._is11xService||h)&&("esri.renderer.SimpleRenderer"===v.declaredClass||"esri.renderer.TemporalRenderer"===v.declaredClass||null==v.attributeField||J.isString(v.attributeField)&&a._getField(v.attributeField,!0)))if(H={id:a.id,title:J.getObject("arcgisProps.title",!1,a)||
a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,layerDefinition:{drawingInfo:{renderer:v.toJson({useLegacyRotationProperties:!this._is11xService})}}},H=J.mixin(H,this._getUrlAndToken(a)),"esri.renderer.TemporalRenderer"===v.declaredClass&&(h=H.layerDefinition.drawingInfo,h.latestObservationRenderer=h.renderer.latestObservationRenderer,h.trackLinesRenderer=h.renderer.trackRenderer,h.observationAger=h.renderer.observationAger,h.renderer=h.renderer.observationRenderer,a._trackIdField&&
(H.layerDefinition.timeInfo={trackIdField:a._trackIdField})),this._convertSvgRenderer(H.layerDefinition.drawingInfo.renderer),this._is11xService||1>a.opacity||"esri.renderer.TemporalRenderer"===v.declaredClass||this._updateLayerOpacity(H))if(a._params.source&&(v=a._params.source.toJson(),J.mixin(H.layerDefinition,{source:v})),a.getDefinitionExpression()&&J.mixin(H.layerDefinition,{definitionExpression:a.getDefinitionExpression()}),2!==a.mode)0<a.getSelectedFeatures().length&&(v=Q.map(a.getSelectedFeatures(),
function(W){return W.attributes[a.objectIdField]}),0<v.length&&a.getSelectionSymbol()&&J.mixin(H,{selectionObjectIds:v,selectionSymbol:a.getSelectionSymbol().toJson()}));else{v=Q.map(a.getSelectedFeatures(),function(W){return W.attributes[a.objectIdField]});if(0===v.length||!a._params.drawMode)break;J.mixin(H.layerDefinition,{objectIds:v});v=null;a.getSelectionSymbol()&&(v=new m(a.getSelectionSymbol()));J.mixin(H.layerDefinition.drawingInfo,{renderer:v&&v.toJson()})}else H=this._createFeatureCollection(a,
f,null,y);else H=v&&(v.valueExpression||this._isFeatureCollectionRequired(v,a)||"esri.renderer.DotDensityRenderer"===v.declaredClass)?this._createFeatureCollection(a,f,v,y):this._createFeatureCollection(a,f,null,y);if(!H)continue;C.push(H);this.allLayerslegend&&this.allLayerslegend.push({id:a.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":H=this._createFeatureCollection(a,f,null,y);if(!H)continue;C.push(H);this.allLayerslegend&&this.allLayerslegend.push({id:a.id});
break;case "esri.layers.ArcGISImageServiceVectorLayer":H={id:a.id,title:J.getObject("arcgisProps.title",!1,a)||a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,visibility:a.visible,symbolTileSize:a.symbolTileSize,layerDefinition:{drawingInfo:{renderer:a.renderer.toJson({useLegacyRotationProperties:!this._is11xService})}}},H=J.mixin(H,this._getUrlAndToken(a)),a.mosaicRule&&J.mixin(H,{mosaicRule:a.mosaicRule.toJson()}),C.push(H),this.allLayerslegend&&this.allLayerslegend.push({id:a.id})}N&&
Q.forEach(C,function(W){W.minScale=0;W.maxScale=0});f.graphics&&0<f.graphics.graphics.length&&(H=this._createFeatureCollection(f.graphics,f,null,y))&&C.push(H);f._labels&&y.showLabels&&(H=this._createFeatureCollection(f._labels,f,null,y))&&C.push(H);Q.forEach(C,function(W,ba,ea){W._isRefLayer&&(delete W._isRefLayer,ea.splice(ba,1),ea.push(W))});return C},_getUrlAndToken:function(f){return{token:f._getToken(),url:f._url?f._url.path:null}},_updateLayerOpacity:function(f){var y=this._colorEvaluator(f);
y=Q.filter(y,function(R){return J.isArray(R)&&4===R.length});var I=!0;if(y.length){var C=y[0][3],N;for(N=1;N<y.length;N++)if(C!==y[N][3]){I=!1;break}if(I)for(f.opacity=C/255,N=0;N<y.length;N++)y[N][3]=255}return I},_isFeatureCollectionRequired:function(f,y){if(y&&y.isFeatureReductionActive&&y.isFeatureReductionActive())return!0;var I=!1;if(y=this._getVariable(f,"rotationInfo",!1))I=(I=y.field)&&J.isFunction(I)||y.valueExpression;return f.hasVisualVariables("sizeInfo")||f.hasVisualVariables("colorInfo")||
f.hasVisualVariables("opacityInfo")||I},_getVariable:function(f,y,I){if(f)var C=(f=f.getVisualVariablesForType(y,I))&&f[0];return C},_applyVisualVariables:function(f,y){var I=y.renderer,C=y.graphic,N=y.symbol,R=y.mapResolution,a=y.mapScale,v=N.type;if("textsymbol"!==v&&"shieldlabelsymbol"!==v){var H=this._getVariable(I,"sizeInfo",!1),l=this._getVariable(I,"colorInfo",!1),h=this._getVariable(I,"opacityInfo",!1);y=this._getVariable(I,"rotationInfo",!1);N instanceof e&&(H=this._getVariable(I,"sizeInfo",
"outline")||H);R=H?I.getSize(C,{sizeInfo:H,shape:"simplemarkersymbol"===v?N.style:null,resolution:R,scale:a}):C.size;null!=R&&("simplemarkersymbol"===v?f.size=D.px2pt(R):"picturemarkersymbol"===v?(a=N.width/N.height*R,f.width=D.px2pt(a),f.height=D.px2pt(R),0!==N.xoffset&&(f.xoffset=D.px2pt(N.xoffset/N.width*a)),0!==N.yoffset&&(f.yoffset=D.px2pt(N.yoffset/N.height*R))):"simplelinesymbol"===v?f.width=D.px2pt(R):f.outline&&(f.outline.width=D.px2pt(R)));l&&(!(N=I.getColor(C,{colorInfo:l}))||"simplemarkersymbol"!==
v&&"simplelinesymbol"!==v&&"simplefillsymbol"!==v||(f.color=K.toJsonColor(N)));h&&(N=I.getOpacity(C,{opacityInfo:h}),null!=N&&f.color&&(f.color[3]=Math.round(255*N)));y&&(I=I.getRotationAngle(C,{rotationInfo:y}))&&(f.angle=-I)}}});z("extend-esri")&&J.setObject("tasks.PrintTask",P,r);return P})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k){P=P(c,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(n){this._jobUpdateHandler=J.hitch(this,this._jobUpdateHandler);this._getJobStatus=J.hitch(this,this._getJobStatus);this._getResultDataHandler=
J.hitch(this,this._getResultDataHandler);this._getResultImageHandler=J.hitch(this,this._getResultImageHandler);this._executeHandler=J.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(n){this.updateDelay=n},setProcessSpatialReference:function(n){this.processSpatialReference=n},setOutputSpatialReference:function(n){this._setOutSR(n)},setOutSpatialReference:function(n){this._setOutSR(n)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(n){this.outSpatialReference=this.outputSpatialReference=n},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(n,f,y){for(var I in n){var C=n[I];J.isArray(C)?n[I]=L.toJson(Q.map(C,function(N){return this._gpEncode({item:N},!0).item},this)):C instanceof Date&&(n[I]=C.getTime())}return this._encode(n,f,y)},_decode:function(n){var f=n.dataType,
y=new F(n);if(-1!==Q.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],f))return y;if("GPLinearUnit"===f)y.value=new e(y.value);else if("GPFeatureRecordSetLayer"===f||"GPRecordSet"===f)y.value=new b(y.value);else if("GPDataFile"===f)y.value=new d(y.value);else if("GPDate"===f)n=y.value,J.isString(n)?y.value=new E({date:n}):y.value=new Date(n);else if("GPRasterData"===f||"GPRasterDataLayer"===f)n=n.value.mapImage,y.value=n?new k(n):new g(y.value);else if(-1!==f.indexOf("GPMultiValue:")){var I=f.split(":")[1];
n=y.value;y.value=Q.map(n,function(C){return this._decode({paramName:"_name",dataType:I,value:C}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+y.dataType),y=null;return y},submitJob:function(n,f,y,I,C){var N=this._getOutSR(),R=C.assembly;n=this._gpEncode(J.mixin({},this._url.query,{f:"json","env:outSR":N?N.wkid||L.toJson(N.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||L.toJson(this.processSpatialReference.toJson()):
null},n),null,R&&R[0]);var a=this._jobUpdateHandler,v=this._errorHandler;return w({url:this._url.path+"/submitJob",content:n,callbackParamName:"callback",load:function(H,l){a(H,l,!1,f,y,C.dfd)},error:function(H){v(H,I,C.dfd)}})},_jobUpdateHandler:function(n,f,y,I,C,N){var R=n.jobId;f=new q(n);this._successHandler([f],"onStatusUpdate",C,y&&N);if(!y)switch(clearTimeout(this._updateTimers[R]),this._updateTimers[R]=null,N&&N.progress(f),n.jobStatus){case q.STATUS_SUBMITTED:case q.STATUS_EXECUTING:case q.STATUS_WAITING:case q.STATUS_NEW:var a=
this._getJobStatus;this._updateTimers[R]=setTimeout(function(){a(R,y,I,C,N)},this.updateDelay);break;default:this._successHandler([f],"onJobComplete",I,N)}},_getJobStatus:function(n,f,y,I,C){var N=this._jobUpdateHandler;w({url:this._url.path+"/jobs/"+n,content:J.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(R,a){N(R,a,f,y,I,C)},error:this._errorHandler})},_getResultDataHandler:function(n,f,y,I,C){try{var N=this._decode(n);this._successHandler([N],"onGetResultDataComplete",
y,C)}catch(R){this._errorHandler(R,I,C)}},getResultData:function(n,f,y,I){var C=this._getResultDataHandler,N=this._errorHandler,R=new V(x._dfdCanceller);R._pendingDfd=w({url:this._url.path+"/jobs/"+n+"/results/"+f,content:J.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,v){C(a,v,y,I,R)},error:function(a){N(a,I,R)}});return R},checkJobStatus:function(n,f,y){var I=this._jobUpdateHandler,C=this._errorHandler,N=new V(x._dfdCanceller);N._pendingDfd=
w({url:this._url.path+"/jobs/"+n,content:J.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(R,a){I(R,a,!0,null,f,N)},error:function(R){C(R,y,N)}});return N},cancelJob:function(n,f,y){var I=this._errorHandler,C=new V(x._dfdCanceller);C._pendingDfd=w({url:this._url.path+"/jobs/"+n+"/cancel",content:J.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:J.hitch(this,function(N,R){this._successHandler([N],"onJobCancel",f,C)}),error:function(N){I(N,y,C)}});
return C},execute:function(n,f,y,I){var C=this._getOutSR(),N=I.assembly;n=this._gpEncode(J.mixin({},this._url.query,{f:"json","env:outSR":C?C.wkid||L.toJson(C.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||L.toJson(this.processSpatialReference.toJson()):null},n),null,N&&N[0]);var R=this._executeHandler,a=this._errorHandler;return w({url:this._url.path+"/execute",content:n,callbackParamName:"callback",load:function(v,H){R(v,H,f,y,I.dfd)},error:function(v){a(v,
y,I.dfd)}})},_executeHandler:function(n,f,y,I,C){try{var N=n.results,R,a=n.messages;var v=0;for(R=N.length;v<R;v++)N[v]=this._decode(N[v]);v=0;for(R=a.length;v<R;v++)a[v]=new m(a[v]);this._successHandler([N,a],"onExecuteComplete",y,C)}catch(H){this._errorHandler(H,I,C)}},_getResultImageHandler:function(n,f,y,I,C){try{var N=this._decode(n);this._successHandler([N],"onGetResultImageComplete",y,C)}catch(R){this._errorHandler(R,I,C)}},getResultImage:function(n,f,y,I,C){var N=this._getResultImageHandler,
R=this._errorHandler;y=this._gpEncode(J.mixin({},this._url.query,{f:"json"},y.toJson()));var a=new V(x._dfdCanceller);a._pendingDfd=w({url:this._url.path+"/jobs/"+n+"/results/"+f,content:y,callbackParamName:"callback",load:function(v,H){N(v,H,I,C,a)},error:function(v){R(v,C,a)}});return a},cancelJobStatusUpdates:function(n){clearTimeout(this._updateTimers[n]);this._updateTimers[n]=null},getResultImageLayer:function(n,f,y,I){if(null==f){var C=this._url.path.indexOf("/GPServer/");n=this._url.path.substring(0,
C)+"/MapServer/jobs/"+n}else n=this._url.path+"/jobs/"+n+"/results/"+f;this._url.query&&(n+="?"+r.objectToQuery(this._url.query));f=null==f?new D(n,{imageParameters:y}):new G(n,{imageParameters:y},!0);this.onGetResultImageLayerComplete(f);I&&I(f);return f},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});K._createWrappers(P);
z("extend-esri")&&J.setObject("tasks.Geoprocessor",P,u);return P})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(P,J,Q,V,L){P=P(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(z){this.messages=[];J.mixin(this,z);z=this.messages;var r,u=z.length;for(r=0;r<u;r++)z[r]=new L(z[r])},jobId:"",jobStatus:""});J.mixin(P,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});Q("extend-esri")&&J.setObject("tasks.JobInfo",P,V);return P})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(L){J.mixin(this,
L)}});J.mixin(P,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});Q("extend-esri")&&J.setObject("tasks.GPMessage",P,V);return P})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(L){L&&J.mixin(this,L)},distance:0,units:null,toJson:function(){var L={};this.distance&&(L.distance=this.distance);this.units&&(L.units=this.units);return L}});Q("extend-esri")&&J.setObject("tasks.LinearUnit",P,V);return P})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(L){L&&J.mixin(this,L)},url:null,itemID:null,toJson:function(){var L={};this.url&&(L.url=this.url);this.itemID&&(L.itemID=this.itemID);return L}});Q("extend-esri")&&J.setObject("tasks.DataFile",P,V);return P})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.RasterData",constructor:function(L){L&&J.mixin(this,L)},url:null,format:null,itemID:null,toJson:function(){var L=
{};this.url&&(L.url=this.url);this.format&&(L.format=this.format);this.itemID&&(L.itemID=this.itemID);return L}});Q("extend-esri")&&J.setObject("tasks.RasterData",P,V);return P})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(P,J,Q,V,L){P=P(null,{declaredClass:"esri.tasks.Date",constructor:function(z){z&&(z.format&&(this.format=z.format),this.date=Q.parse(z.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:Q.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});V("extend-esri")&&J.setObject("tasks.Date",P,L);return P})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(L){J.mixin(this,L)}});Q("extend-esri")&&J.setObject("tasks.ParameterValue",P,V);return P})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(P,J,Q,V,L,z,r){P=P(r,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(u,w){w&&w.imageParameters&&w.imageParameters.extent&&(this.initialExtent=this.fullExtent=w.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=J.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(u,w,x,K){var c=u.spatialReference.wkid;K(this._url.path+"?"+L.objectToQuery(J.mixin(this._params,{f:"image",bbox:Q.toJson(u.toJson()),bboxSR:c,imageSR:c,size:w+","+x})))}});V("extend-esri")&&J.setObject("tasks._GPResultImageLayer",P,z);return P})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b){function q(l,h,A,O,X,W,ba,ea,fa,ha){var S=h.length,T=0;if(ha){var Y=ha.l/X;T=ha.i}else Y=h[0]/X;for(;W<ba;){if(W+Y>ba){var ca={l:(W+Y-ba)*X,i:T};Y=ba-W}T%2||(l.beginPath(),l.arc(A,O,X,W,W+Y,ea),fa&&l.stroke());W+=Y;++T;Y=h[T%S]/X}return ca}function m(l,h,A,O){var X=0,W=0,ba=0;if(O){var ea=O.l;ba=O.i}else ea=h[0];for(;1>W;)W=b.tAtLength(l,ea),1==W&&(X=b.computeLength(l),X={l:ea-X,i:ba}),l=b.splitBezierAtT(l,W),ba%2||A.push(l[0]),l=l[1],++ba,ea=h[ba%h.length];return X}
function e(l,h,A,O){var X=[h.last.x,h.last.y].concat(A),W=!(l instanceof Array);A=4===A.length?"quadraticCurveTo":"bezierCurveTo";var ba=[];h=m(X,h.canvasDash,ba,O);for(O=0;O<ba.length;++O)X=ba[O],W?(l.moveTo(X[0],X[1]),l[A].apply(l,X.slice(2))):(l.push("moveTo",[X[0],X[1]]),l.push(A,X.slice(2)));return h}function d(l,h,A,O,X,W,ba){var ea=0,fa=0,ha=0,S=b.distance(A,O,X,W),T=0;h=h.canvasDash;var Y=A,ca=O,ia=!(l instanceof Array);ba?(ha=ba.l,T=ba.i):ha+=h[0];for(;.01<Math.abs(1-fa);){ha>S&&(ea={l:ha-
S,i:T},ha=S);fa=ha/S;ba=A+(X-A)*fa;var oa=O+(W-O)*fa;T++%2||(ia?(l.moveTo(Y,ca),l.lineTo(ba,oa)):(l.push("moveTo",[Y,ca]),l.push("lineTo",[ba,oa])));Y=ba;ca=oa;ha+=h[T%h.length]}return ea}var g=P.canvas={},E=null,F=K.multiplyPoint,G=Math.PI,D=2*G,k=G/2;c=J.extend;if(L.global.CanvasRenderingContext2D){L=L.doc.createElement("canvas").getContext("2d");var n="function"==typeof L.setLineDash,f="function"==typeof L.fillText}var y={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,
1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};g.Shape=V("dojox.gfx.canvas.Shape",u.Shape,{_render:function(l){l.save();this._renderTransform(l);this._renderClip(l);this._renderShape(l);this._renderFill(l,!0);this._renderStroke(l,!0);l.restore()},_renderClip:function(l){this.canvasClip&&(this.canvasClip.render(l),l.clip())},_renderTransform:function(l){if("canvasTransform"in this){var h=this.canvasTransform;l.translate(h.dx,h.dy);
l.rotate(h.angle2);l.scale(h.sx,h.sy);l.rotate(h.angle1)}},_renderShape:function(l){},_renderFill:function(l,h){if("canvasFill"in this){var A=this.fillStyle;if("canvasFillImage"in this){var O=A.width,X=A.height,W=this.canvasFillImage.width,ba=this.canvasFillImage.height,ea=Math.min(O==W?1:O/W,X==ba?1:X/ba),fa=(O-ea*W)/2,ha=(X-ea*ba)/2;E.width=O;E.height=X;var S=E.getContext("2d");S.clearRect(0,0,O,X);S.drawImage(this.canvasFillImage,0,0,W,ba,fa,ha,ea*W,ea*ba);this.canvasFill=l.createPattern(E,"repeat");
delete this.canvasFillImage}l.fillStyle=this.canvasFill;h&&("pattern"!==A.type||0===A.x&&0===A.y||l.translate(A.x,A.y),l.fill())}else l.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(l,h){var A=this.strokeStyle;A?(l.strokeStyle=A.color.toString(),l.lineWidth=A.width,l.lineCap=A.cap,"number"==typeof A.join?(l.lineJoin="miter",l.miterLimit=A.join):l.lineJoin=A.join,this.canvasDash?n?(l.setLineDash(this.canvasDash),h&&l.stroke()):this._renderDashedStroke(l,h):h&&l.stroke()):h||(l.strokeStyle="rgba(0,0,0,0.0)")},
_renderDashedStroke:function(l,h){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(l){this.inherited(arguments);var h=l?"width"in l?"rect":"cx"in l?"ellipse":"points"in l?"polyline":"d"in l?"path":null:null;if(l&&!h)return this;this.canvasClip=l?I(h,l):null;this.parent&&this.parent._makeDirty();return this}});var I=function(l,h){switch(l){case "ellipse":return{canvasEllipse:a({shape:h}),render:function(A){return g.Ellipse.prototype._renderShape.call(this,
A)}};case "rect":return{shape:J.delegate(h,{r:0}),render:function(A){return g.Rect.prototype._renderShape.call(this,A)}};case "path":return{canvasPath:C(h),render:function(A){this.canvasPath._renderShape(A)}};case "polyline":return{canvasPolyline:h.points,render:function(A){return g.Polyline.prototype._renderShape.call(this,A)}}}return null},C=function(l){var h=new dojox.gfx.canvas.Path;h.canvasPath=[];h._setPath(l.d);return h},N=function(l,h,A){var O=l.prototype[h];l.prototype[h]=A?function(){this.parent&&
this.parent._makeDirty();O.apply(this,arguments);A.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return O.apply(this,arguments)}};N(g.Shape,"setTransform",function(){this.matrix?this.canvasTransform=P.decompose(this.matrix):delete this.canvasTransform});N(g.Shape,"setFill",function(){var l=this.fillStyle;if(l){if("object"==typeof l&&"type"in l){var h=this.surface.rawNode.getContext("2d");switch(l.type){case "linear":case "radial":var A="linear"==l.type?h.createLinearGradient(l.x1,
l.y1,l.x2,l.y2):h.createRadialGradient(l.cx,l.cy,0,l.cx,l.cy,l.r);Q.forEach(l.colors,function(O){A.addColorStop(O.offset,P.normalizeColor(O.color).toString())});break;case "pattern":E||(E=document.createElement("canvas")),h=new Image,this.surface.downloadImage(h,l.src),this.canvasFillImage=h}}else A=l.toString();this.canvasFill=A}else delete this.canvasFill});N(g.Shape,"setStroke",function(){var l=this.strokeStyle;if(l){var h=this.strokeStyle.style.toLowerCase();h in y&&(h=y[h]);if(h instanceof Array){this.canvasDash=
h=h.slice();var A;for(A=0;A<h.length;++A)h[A]*=l.width;if("butt"!=l.cap){for(A=0;A<h.length;A+=2)h[A]-=l.width,1>h[A]&&(h[A]=1);for(A=1;A<h.length;A+=2)h[A]+=l.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!n&&!!this.canvasDash});N(g.Shape,"setShape");g.Group=V("dojox.gfx.canvas.Group",g.Shape,{constructor:function(){u.Container._init.call(this)},_render:function(l){l.save();this._renderTransform(l);this._renderClip(l);for(var h=0;h<this.children.length;++h)this.children[h]._render(l);
l.restore()},destroy:function(){u.Container.clear.call(this,!0);g.Shape.prototype.destroy.apply(this,arguments)}});g.Rect=V("dojox.gfx.canvas.Rect",[g.Shape,u.Rect],{_renderShape:function(l){var h=this.shape,A=Math.min(h.r,h.height/2,h.width/2),O=h.x,X=O+h.width,W=h.y;h=W+h.height;var ba=O+A,ea=X-A,fa=W+A,ha=h-A;l.beginPath();l.moveTo(ba,W);A?(l.arc(ea,fa,A,-k,0,!1),l.arc(ea,ha,A,0,k,!1),l.arc(ba,ha,A,k,G,!1),l.arc(ba,fa,A,G,G+k,!1)):(l.lineTo(ea,W),l.lineTo(X,ha),l.lineTo(ba,h),l.lineTo(O,fa));l.closePath()},
_renderDashedStroke:function(l,h){var A=this.shape,O=Math.min(A.r,A.height/2,A.width/2),X=A.x,W=X+A.width,ba=A.y,ea=ba+A.height,fa=X+O,ha=W-O,S=ba+O,T=ea-O;O?(l.beginPath(),A=d(l,this,fa,ba,ha,ba),h&&l.stroke(),A=q(l,this.canvasDash,ha,S,O,-k,0,!1,h,A),l.beginPath(),A=d(l,this,W,S,W,T,A),h&&l.stroke(),A=q(l,this.canvasDash,ha,T,O,0,k,!1,h,A),l.beginPath(),A=d(l,this,ha,ea,fa,ea,A),h&&l.stroke(),A=q(l,this.canvasDash,fa,T,O,k,G,!1,h,A),l.beginPath(),A=d(l,this,X,T,X,S,A),h&&l.stroke(),q(l,this.canvasDash,
fa,S,O,G,G+k,!1,h,A)):(l.beginPath(),A=d(l,this,fa,ba,ha,ba),A=d(l,this,ha,ba,W,T,A),A=d(l,this,W,T,fa,ea,A),d(l,this,fa,ea,X,S,A),h&&l.stroke())}});var R=[];(function(){var l=x.curvePI4;R.push(l.s,l.c1,l.c2,l.e);for(var h=45;360>h;h+=45){var A=K.rotateg(h);R.push(F(A,l.c1),F(A,l.c2),F(A,l.e))}})();var a=function(l){var h=[],A=l.shape,O=K.normalize([K.translate(A.cx,A.cy),K.scale(A.rx,A.ry)]);var X=F(O,R[0]);h.push([X.x,X.y]);for(A=1;A<R.length;A+=3){var W=F(O,R[A]);var ba=F(O,R[A+1]);X=F(O,R[A+2]);
h.push([W.x,W.y,ba.x,ba.y,X.x,X.y])}if(l._needsDash){X=[];W=h[0];for(A=1;A<h.length;++A)ba=[],m(W.concat(h[A]),l.canvasDash,ba),W=[h[A][4],h[A][5]],X.push(ba);l._dashedPoints=X}return h};g.Ellipse=V("dojox.gfx.canvas.Ellipse",[g.Shape,u.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=a(this);return this},setStroke:function(){this.inherited(arguments);n||(this.canvasEllipse=a(this));return this},_renderShape:function(l){var h=this.canvasEllipse,A;l.beginPath();l.moveTo.apply(l,
h[0]);for(A=1;A<h.length;++A)l.bezierCurveTo.apply(l,h[A]);l.closePath()},_renderDashedStroke:function(l,h){var A=this._dashedPoints;l.beginPath();for(var O=0;O<A.length;++O)for(var X=A[O],W=0;W<X.length;++W){var ba=X[W];l.moveTo(ba[0],ba[1]);l.bezierCurveTo(ba[2],ba[3],ba[4],ba[5],ba[6],ba[7])}h&&l.stroke()}});g.Circle=V("dojox.gfx.canvas.Circle",[g.Shape,u.Circle],{_renderShape:function(l){var h=this.shape;l.beginPath();l.arc(h.cx,h.cy,h.r,0,D,1)},_renderDashedStroke:function(l,h){var A=this.shape,
O=0,X=this.canvasDash.length;for(i=0;O<D;){var W=this.canvasDash[i%X]/A.r;i%2||(l.beginPath(),l.arc(A.cx,A.cy,A.r,O,O+W,0),h&&l.stroke());O+=W;++i}}});g.Line=V("dojox.gfx.canvas.Line",[g.Shape,u.Line],{_renderShape:function(l){var h=this.shape;l.beginPath();l.moveTo(h.x1,h.y1);l.lineTo(h.x2,h.y2)},_renderDashedStroke:function(l,h){var A=this.shape;l.beginPath();d(l,this,A.x1,A.y1,A.x2,A.y2);h&&l.stroke()}});g.Polyline=V("dojox.gfx.canvas.Polyline",[g.Shape,u.Polyline],{setShape:function(){this.inherited(arguments);
var l=this.shape.points,h=l[0],A;this.bbox=null;this._normalizePoints();if(l.length)if("number"==typeof h)h=l;else for(h=[],A=0;A<l.length;++A){var O=l[A];h.push(O.x,O.y)}else h=[];this.canvasPolyline=h;return this},_renderShape:function(l){var h=this.canvasPolyline;if(h.length){l.beginPath();l.moveTo(h[0],h[1]);for(var A=2;A<h.length;A+=2)l.lineTo(h[A],h[A+1])}},_renderDashedStroke:function(l,h){var A=this.canvasPolyline,O=0;l.beginPath();for(var X=0;X<A.length;X+=2)O=d(l,this,A[X],A[X+1],A[X+2],
A[X+3],O);h&&l.stroke()}});g.Image=V("dojox.gfx.canvas.Image",[g.Shape,u.Image],{setShape:function(){this.inherited(arguments);var l=new Image;this.surface.downloadImage(l,this.shape.src);this.canvasImage=l;return this},_renderShape:function(l){var h=this.shape;l.drawImage(this.canvasImage,h.x,h.y,h.width,h.height)}});g.Text=V("dojox.gfx.canvas.Text",[g.Shape,u.Text],{_setFont:function(){this.fontStyle?this.canvasFont=P.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var l=
this.shape,h=0;if(l.text){var A=this.surface.rawNode.getContext("2d");A.save();this._renderTransform(A);this._renderFill(A,!1);this._renderStroke(A,!1);this.canvasFont&&(A.font=this.canvasFont);h=A.measureText(l.text).width;A.restore()}return h},_render:function(l){l.save();this._renderTransform(l);this._renderFill(l,!1);this._renderStroke(l,!1);this._renderShape(l);l.restore()},_renderShape:function(l){var h=this.shape;h.text&&(l.textAlign="middle"===h.align?"center":h.align,this.canvasFont&&(l.font=
this.canvasFont),this.canvasFill&&l.fillText(h.text,h.x,h.y),this.strokeStyle&&(l.beginPath(),l.strokeText(h.text,h.x,h.y),l.closePath()))}});N(g.Text,"setFont");f||g.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var v={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",
t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};g.Path=V("dojox.gfx.canvas.Path",[g.Shape,w.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);n||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(l){var h=J.clone(this.last);this[v[l.action]](this.canvasPath,
l.action,l.args,this._needsDash?this._dashedPath:null);this.last=h;this.inherited(arguments)},_renderShape:function(l){var h=this.canvasPath;l.beginPath();for(var A=0;A<h.length;A+=2)l[h[A]].apply(l,h[A+1])},_renderDashedStroke:n?function(){}:function(l,h){var A=this._dashedPath;l.beginPath();for(var O=0;O<A.length;O+=2)l[A[O]].apply(l,A[O+1]);h&&l.stroke()},_moveToA:function(l,h,A,O){l.push("moveTo",[A[0],A[1]]);O&&O.push("moveTo",[A[0],A[1]]);for(h=2;h<A.length;h+=2)l.push("lineTo",[A[h],A[h+1]]),
O&&(this._dashResidue=d(O,this,A[h-2],A[h-1],A[h],A[h+1],this._dashResidue));this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl={}},_moveToR:function(l,h,A,O){h="x"in this.last?[this.last.x+=A[0],this.last.y+=A[1]]:[this.last.x=A[0],this.last.y=A[1]];l.push("moveTo",h);O&&O.push("moveTo",h);for(h=2;h<A.length;h+=2)l.push("lineTo",[this.last.x+=A[h],this.last.y+=A[h+1]]),O&&(this._dashResidue=d(O,this,O[O.length-1][0],O[O.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl=
{}},_lineToA:function(l,h,A,O){for(h=0;h<A.length;h+=2)O&&(this._dashResidue=d(O,this,this.last.x,this.last.y,A[h],A[h+1],this._dashResidue)),l.push("lineTo",[A[h],A[h+1]]);this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl={}},_lineToR:function(l,h,A,O){for(h=0;h<A.length;h+=2)l.push("lineTo",[this.last.x+=A[h],this.last.y+=A[h+1]]),O&&(this._dashResidue=d(O,this,O[O.length-1][0],O[O.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(l,
h,A,O){for(h=0;h<A.length;++h)l.push("lineTo",[A[h],this.last.y]),O&&(this._dashResidue=d(O,this,O[O.length-1][0],O[O.length-1][1],A[h],this.last.y,this._dashResidue));this.last.x=A[A.length-1];this.lastControl={}},_hLineToR:function(l,h,A,O){for(h=0;h<A.length;++h)l.push("lineTo",[this.last.x+=A[h],this.last.y]),O&&(this._dashResidue=d(O,this,O[O.length-1][0],O[O.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(l,h,A,O){for(h=0;h<A.length;++h)l.push("lineTo",
[this.last.x,A[h]]),O&&(this._dashResidue=d(O,this,O[O.length-1][0],O[O.length-1][1],this.last.x,A[h],this._dashResidue));this.last.y=A[A.length-1];this.lastControl={}},_vLineToR:function(l,h,A,O){for(h=0;h<A.length;++h)l.push("lineTo",[this.last.x,this.last.y+=A[h]]),O&&(this._dashResidue=d(O,this,O[O.length-1][0],O[O.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(l,h,A,O){for(h=0;h<A.length;h+=6)l.push("bezierCurveTo",A.slice(h,h+6)),O&&(this._dashResidue=
e(O,this,l[l.length-1],this._dashResidue));this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl.x=A[A.length-4];this.lastControl.y=A[A.length-3];this.lastControl.type="C"},_curveToR:function(l,h,A,O){for(h=0;h<A.length;h+=6)l.push("bezierCurveTo",[this.last.x+A[h],this.last.y+A[h+1],this.lastControl.x=this.last.x+A[h+2],this.lastControl.y=this.last.y+A[h+3],this.last.x+A[h+4],this.last.y+A[h+5]]),O&&(this._dashResidue=e(O,this,l[l.length-1],this._dashResidue)),this.last.x+=A[h+4],
this.last.y+=A[h+5];this.lastControl.type="C"},_smoothCurveToA:function(l,h,A,O){for(h=0;h<A.length;h+=4){var X="C"==this.lastControl.type;l.push("bezierCurveTo",[X?2*this.last.x-this.lastControl.x:this.last.x,X?2*this.last.y-this.lastControl.y:this.last.y,A[h],A[h+1],A[h+2],A[h+3]]);O&&(this._dashResidue=e(O,this,l[l.length-1],this._dashResidue));this.lastControl.x=A[h];this.lastControl.y=A[h+1];this.lastControl.type="C"}this.last.x=A[A.length-2];this.last.y=A[A.length-1]},_smoothCurveToR:function(l,
h,A,O){for(h=0;h<A.length;h+=4){var X="C"==this.lastControl.type;l.push("bezierCurveTo",[X?2*this.last.x-this.lastControl.x:this.last.x,X?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+A[h],this.last.y+A[h+1],this.last.x+A[h+2],this.last.y+A[h+3]]);O&&(this._dashResidue=e(O,this,l[l.length-1],this._dashResidue));this.lastControl.x=this.last.x+A[h];this.lastControl.y=this.last.y+A[h+1];this.lastControl.type="C";this.last.x+=A[h+2];this.last.y+=A[h+3]}},_qCurveToA:function(l,h,A,O){for(h=
0;h<A.length;h+=4)l.push("quadraticCurveTo",A.slice(h,h+4));O&&(this._dashResidue=e(O,this,l[l.length-1],this._dashResidue));this.last.x=A[A.length-2];this.last.y=A[A.length-1];this.lastControl.x=A[A.length-4];this.lastControl.y=A[A.length-3];this.lastControl.type="Q"},_qCurveToR:function(l,h,A,O){for(h=0;h<A.length;h+=4)l.push("quadraticCurveTo",[this.lastControl.x=this.last.x+A[h],this.lastControl.y=this.last.y+A[h+1],this.last.x+A[h+2],this.last.y+A[h+3]]),O&&(this._dashResidue=e(O,this,l[l.length-
1],this._dashResidue)),this.last.x+=A[h+2],this.last.y+=A[h+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(l,h,A,O){for(h=0;h<A.length;h+=2){var X="Q"==this.lastControl.type;l.push("quadraticCurveTo",[this.lastControl.x=X?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=X?2*this.last.y-this.lastControl.y:this.last.y,A[h],A[h+1]]);O&&(this._dashResidue=e(O,this,l[l.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=A[A.length-2];this.last.y=A[A.length-1]},_qSmoothCurveToR:function(l,
h,A,O){for(h=0;h<A.length;h+=2){var X="Q"==this.lastControl.type;l.push("quadraticCurveTo",[this.lastControl.x=X?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=X?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+A[h],this.last.y+A[h+1]]);O&&(this._dashResidue=e(O,this,l[l.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=A[h];this.last.y+=A[h+1]}},_arcTo:function(l,h,A,O){h="a"==h;for(var X=0;X<A.length;X+=7){var W=A[X+5],ba=A[X+6];h&&(W+=this.last.x,ba+=
this.last.y);var ea=x.arcAsBezier(this.last,A[X],A[X+1],A[X+2],A[X+3]?1:0,A[X+4]?1:0,W,ba);Q.forEach(ea,function(fa){l.push("bezierCurveTo",fa)});O&&(this._dashResidue=e(O,this,p,this._dashResidue));this.last.x=W;this.last.y=ba}this.lastControl={}},_closePath:function(l,h,A,O){l.push("closePath",[]);O&&(this._dashResidue=d(O,this,this.last.x,this.last.y,O[1][0],O[1][1],this._dashResidue));this.lastControl={}}});Q.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(l){N(g.Path,l)});g.TextPath=V("dojox.gfx.canvas.TextPath",[g.Shape,w.TextPath],{_renderShape:function(l){},_setText:function(){},_setFont:function(){}});g.Surface=V("dojox.gfx.canvas.Surface",u.Surface,{constructor:function(){u.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){u.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(l,h){this.width=P.normalizedLength(l);this.height=P.normalizedLength(h);if(!this.rawNode)return this;
l=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,l=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,l=!0);l&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(l){!this.rawNode||!l&&this.pendingImageCount||(l=this.rawNode.getContext("2d"),l.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(l),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender))},render:function(l){l.save();for(var h=0;h<this.children.length;++h)this.children[h]._render(l);l.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(J.hitch(this,this._render),0))},downloadImage:function(l,h){var A=J.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);l.onload=A;l.onerror=A;l.onabort=A;l.src=
h},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});g.createSurface=function(l,h,A){if(!h&&!A){var O=z.position(l);h=h||O.w;A=A||O.h}"number"==typeof h&&(h+="px");"number"==typeof A&&(A+="px");O=new g.Surface;l=r.byId(l);var X=l.ownerDocument.createElement("canvas");X.width=P.normalizedLength(h);X.height=P.normalizedLength(A);l.appendChild(X);
O.rawNode=X;O._parent=l;return O.surface=O};var H=u.Container;V={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(l){this._makeDirty();return H.add.apply(this,arguments)},remove:function(l,h){this._makeDirty();return H.remove.apply(this,arguments)},clear:function(){this._makeDirty();return H.clear.apply(this,arguments)},getBoundingBox:H.getBoundingBox,
_moveChildToFront:function(l){this._makeDirty();return H._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(l){this._makeDirty();return H._moveChildToBack.apply(this,arguments)}};w={createObject:function(l,h){l=new l;l.surface=this.surface;l.setShape(h);this.add(l);return l}};c(g.Group,V);c(g.Group,u.Creator);c(g.Group,w);c(g.Surface,V);c(g.Surface,u.Creator);c(g.Surface,w);g.fixTarget=function(l,h){return!0};return g})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(P,J,Q,V,L,z,r,u,w,x){function K(b,q){for(var m=b.length-1;q<m;)b[q]=b[++q];b.length=m}var c=P.shape={};c.Shape=Q("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(L("gfxRegistry")){var b=c.register(this);this.getUID=function(){return b}}},destroy:function(){L("gfxRegistry")&&c.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b)return null;var q=this._getRealMatrix();return[x.multiplyPoint(q,b.x,b.y),x.multiplyPoint(q,b.x+b.width,b.y),x.multiplyPoint(q,b.x+
b.width,b.y+b.height),x.multiplyPoint(q,b.x,b.y+b.height)]},getEventSource:function(){return this.rawNode},setClip:function(b){this.clip=b},getClip:function(){return this.clip},setShape:function(b){this.shape=P.makeParameters(this.shape,b);this.bbox=null;return this},setFill:function(b){if(!b)return this.fillStyle=null,this;var q=null;if("object"==typeof b&&"type"in b)switch(b.type){case "linear":q=P.makeParameters(P.defaultLinearGradient,b);break;case "radial":q=P.makeParameters(P.defaultRadialGradient,
b);break;case "pattern":q=P.makeParameters(P.defaultPattern,b)}else q=P.normalizeColor(b);this.fillStyle=q;return this},setStroke:function(b){if(!b)return this.strokeStyle=null,this;if("string"==typeof b||J.isArray(b)||b instanceof w)b={color:b};b=this.strokeStyle=P.makeParameters(P.defaultStroke,b);b.color=P.normalizeColor(b.color);return this},setTransform:function(b){this.matrix=x.clone(b?x.normalize(b):x.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var b=
this.getParent();b&&(b._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var b=this.getParent();b&&(b._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(b){return b?this.setTransform([this.matrix,b]):this},applyLeftTransform:function(b){return b?this.setTransform([b,this.matrix]):this},applyTransform:function(b){return b?this.setTransform([this.matrix,b]):this},removeShape:function(b){this.parent&&
this.parent.remove(this,b);return this},_setParent:function(b,q){this.parent=b;return this._updateParentMatrix(q)},_updateParentMatrix:function(b){this.parentMatrix=b?x.clone(b):null;return this._applyTransform()},_getRealMatrix:function(){for(var b=this.matrix,q=this.parent;q;)q.matrix&&(b=x.multiply(q.matrix,b)),q=q.parent;return b}});c._eventsProcessing={on:function(b,q){return z(this.getEventSource(),b,c.fixCallback(this,P.fixTarget,q))},connect:function(b,q,m){"on"==b.substring(0,2)&&(b=b.substring(2));
return this.on(b,m?J.hitch(q,m):q)},disconnect:function(b){return b.remove()}};c.fixCallback=function(b,q,m,e){e||(e=m,m=null);if(J.isString(e)){m=m||V.global;if(!m[e])throw['dojox.gfx.shape.fixCallback: scope["',e,'"] is null (scope\x3d"',m,'")'].join("");return function(d){return q(d,b)?m[e].apply(m,arguments||[]):void 0}}return m?function(d){return q(d,b)?e.apply(m,arguments||[]):void 0}:function(d){return q(d,b)?e.apply(m,arguments):void 0}};J.extend(c.Shape,c._eventsProcessing);c.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(b){var q=b.getParent();q&&q.remove(b,!0);this.children.push(b);return b._setParent(this,this._getRealMatrix())},remove:function(b,q){for(var m=0;m<this.children.length;++m)if(this.children[m]==b){q||(b.parent=null,b.parentMatrix=null);K(this.children,m);break}return this},clear:function(b){for(var q,m=0;m<this.children.length;++m)q=this.children[m],q.parent=null,q.parentMatrix=null,b&&q.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var b=null;r.forEach(this.children,function(q){var m=q.getBoundingBox();m&&((q=q.getTransform())&&(m=x.multiplyRectangle(q,m)),b?(b.x=Math.min(b.x,m.x),b.y=Math.min(b.y,m.y),b.endX=Math.max(b.endX,m.x+m.width),b.endY=Math.max(b.endY,m.y+m.height)):b={x:m.x,y:m.y,endX:m.x+m.width,endY:m.y+m.height})});b&&(b.width=b.endX-b.x,b.height=b.endY-b.y);return b}return null},_moveChildToFront:function(b){for(var q=0;q<this.children.length;++q)if(this.children[q]==
b){K(this.children,q);this.children.push(b);break}return this},_moveChildToBack:function(b){for(var q=0;q<this.children.length;++q)if(this.children[q]==b){K(this.children,q);this.children.unshift(b);break}return this}};c.Surface=Q("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){r.forEach(this._nodes,u.destroy);this._nodes=[];r.forEach(this._events,function(b){b&&b.remove()});this._events=[];this.rawNode=null;
if(L("ie"))for(;this._parent.lastChild;)u.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(b){},whenLoaded:function(b,q){var m=J.hitch(b,q);if(this.isLoaded)m(this);else z.once(this,"load",function(e){m(e)})}});J.extend(c.Surface,c._eventsProcessing);c.Rect=Q("dojox.gfx.shape.Rect",c.Shape,{constructor:function(b){this.shape=P.getDefault("Rect");this.rawNode=
b},getBoundingBox:function(){return this.shape}});c.Ellipse=Q("dojox.gfx.shape.Ellipse",c.Shape,{constructor:function(b){this.shape=P.getDefault("Ellipse");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-b.rx,y:b.cy-b.ry,width:2*b.rx,height:2*b.ry}}return this.bbox}});c.Circle=Q("dojox.gfx.shape.Circle",c.Shape,{constructor:function(b){this.shape=P.getDefault("Circle");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-
b.r,y:b.cy-b.r,width:2*b.r,height:2*b.r}}return this.bbox}});c.Line=Q("dojox.gfx.shape.Line",c.Shape,{constructor:function(b){this.shape=P.getDefault("Line");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:Math.min(b.x1,b.x2),y:Math.min(b.y1,b.y2),width:Math.abs(b.x2-b.x1),height:Math.abs(b.y2-b.y1)}}return this.bbox}});c.Polyline=Q("dojox.gfx.shape.Polyline",c.Shape,{constructor:function(b){this.shape=P.getDefault("Polyline");this.rawNode=b},setShape:function(b,
q){b&&b instanceof Array?(this.inherited(arguments,[{points:b}]),q&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[b]);return this},_normalizePoints:function(){var b=this.shape.points,q=b&&b.length;if(q&&"number"==typeof b[0]){for(var m=[],e=0;e<q;e+=2)m.push({x:b[e],y:b[e+1]});this.shape.points=m}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var b=this.shape.points,q=b.length,m=b[0],e=m.x,d=m.y,g=m.x,E=m.y,F=1;F<q;++F)m=
b[F],e>m.x&&(e=m.x),g<m.x&&(g=m.x),d>m.y&&(d=m.y),E<m.y&&(E=m.y);this.bbox={x:e,y:d,width:g-e,height:E-d}}return this.bbox}});c.Image=Q("dojox.gfx.shape.Image",c.Shape,{constructor:function(b){this.shape=P.getDefault("Image");this.rawNode=b},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});c.Text=Q(c.Shape,{constructor:function(b){this.fontStyle=null;this.shape=P.getDefault("Text");this.rawNode=b},getFont:function(){return this.fontStyle},
setFont:function(b){this.fontStyle="string"==typeof b?P.splitFontString(b):P.makeParameters(P.defaultFont,b);this._setFont();return this},getBoundingBox:function(){var b=null;this.getShape().text&&(b=P._base._computeTextBoundingBox(this));return b}});c.Creator={createShape:function(b){switch(b.type){case P.defaultPath.type:return this.createPath(b);case P.defaultRect.type:return this.createRect(b);case P.defaultCircle.type:return this.createCircle(b);case P.defaultEllipse.type:return this.createEllipse(b);
case P.defaultLine.type:return this.createLine(b);case P.defaultPolyline.type:return this.createPolyline(b);case P.defaultImage.type:return this.createImage(b);case P.defaultText.type:return this.createText(b);case P.defaultTextPath.type:return this.createTextPath(b)}return null},createGroup:function(){return this.createObject(P.Group)},createRect:function(b){return this.createObject(P.Rect,b)},createEllipse:function(b){return this.createObject(P.Ellipse,b)},createCircle:function(b){return this.createObject(P.Circle,
b)},createLine:function(b){return this.createObject(P.Line,b)},createPolyline:function(b){return this.createObject(P.Polyline,b)},createImage:function(b){return this.createObject(P.Image,b)},createText:function(b){return this.createObject(P.Text,b)},createPath:function(b){return this.createObject(P.Path,b)},createTextPath:function(b){return this.createObject(P.TextPath,{}).setText(b)},createObject:function(b,q){return null}};return c})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(P,J,Q,V,L){L=Q("dojox.gfx.path.Path",L.Shape,{constructor:function(z){this.shape=J.clone(P.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=z;this.segmented=!1},setAbsoluteMode:function(z){this._confirmSegmented();this.absolute="string"==typeof z?"absolute"==z:z;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var z=this.bbox,r=this._getRealMatrix();this.bbox=null;for(var u=0,w=this.segments.length;u<w;++u)this._updateWithSegment(this.segments[u],r);r=this.bbox;this.bbox=z;return this.tbbox=r?[{x:r.l,y:r.t},{x:r.r,y:r.t},{x:r.r,y:r.b},{x:r.l,y:r.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(z,r,u){u&&(r=V.multiplyPoint(u,z,r),z=r.x,r=r.y);this.bbox&&"l"in this.bbox?(this.bbox.l>z&&(this.bbox.l=z),this.bbox.r<z&&(this.bbox.r=z),this.bbox.t>r&&(this.bbox.t=r),this.bbox.b<r&&(this.bbox.b=r)):this.bbox={l:z,b:r,r:z,t:r}},_updateWithSegment:function(z,r){var u=z.args,w=u.length,x;switch(z.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(x=0;x<w;x+=2)this._updateBBox(u[x],
u[x+1],r);this.last.x=u[w-2];this.last.y=u[w-1];this.absolute=!0;break;case "H":for(x=0;x<w;++x)this._updateBBox(u[x],this.last.y,r);this.last.x=u[w-1];this.absolute=!0;break;case "V":for(x=0;x<w;++x)this._updateBBox(this.last.x,u[x],r);this.last.y=u[w-1];this.absolute=!0;break;case "m":x=0;"x"in this.last||(this._updateBBox(this.last.x=u[0],this.last.y=u[1],r),x=2);for(;x<w;x+=2)this._updateBBox(this.last.x+=u[x],this.last.y+=u[x+1],r);this.absolute=!1;break;case "l":case "t":for(x=0;x<w;x+=2)this._updateBBox(this.last.x+=
u[x],this.last.y+=u[x+1],r);this.absolute=!1;break;case "h":for(x=0;x<w;++x)this._updateBBox(this.last.x+=u[x],this.last.y,r);this.absolute=!1;break;case "v":for(x=0;x<w;++x)this._updateBBox(this.last.x,this.last.y+=u[x],r);this.absolute=!1;break;case "c":for(x=0;x<w;x+=6)this._updateBBox(this.last.x+u[x],this.last.y+u[x+1],r),this._updateBBox(this.last.x+u[x+2],this.last.y+u[x+3],r),this._updateBBox(this.last.x+=u[x+4],this.last.y+=u[x+5],r);this.absolute=!1;break;case "s":case "q":for(x=0;x<w;x+=
4)this._updateBBox(this.last.x+u[x],this.last.y+u[x+1],r),this._updateBBox(this.last.x+=u[x+2],this.last.y+=u[x+3],r);this.absolute=!1;break;case "A":for(x=0;x<w;x+=7)this._updateBBox(u[x+5],u[x+6],r);this.last.x=u[w-2];this.last.y=u[w-1];this.absolute=!0;break;case "a":for(x=0;x<w;x+=7)this._updateBBox(this.last.x+=u[x+5],this.last.y+=u[x+6],r);this.absolute=!1}z=[z.action];for(x=0;x<w;++x)z.push(P.formatNumber(u[x],!0));if("string"==typeof this.shape.path)this.shape.path+=z.join("");else for(x=
0,w=z.length;x<w;++x)this.shape.path.push(z[x])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(z,r){this.tbbox=null;var u=this._validSegments[z.toLowerCase()];"number"==typeof u&&(u?r.length>=u&&(z={action:z,args:r.slice(0,r.length-r.length%u)},this.segments.push(z),this._updateWithSegment(z)):(z={action:z,args:[]},this.segments.push(z),this._updateWithSegment(z)))},_collectArgs:function(z,r){for(var u=0;u<r.length;++u){var w=r[u];"boolean"==typeof w?z.push(w?1:0):
"number"==typeof w?z.push(w):w instanceof Array?this._collectArgs(z,w):"x"in w&&"y"in w&&z.push(w.x,w.y)}},moveTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"M":"m",z);return this},lineTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"L":"l",z);return this},hLineTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?
"H":"h",z);return this},vLineTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"V":"v",z);return this},curveTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"C":"c",z);return this},smoothCurveTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"S":"s",z);return this},qCurveTo:function(){this._confirmSegmented();var z=
[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"Q":"q",z);return this},qSmoothCurveTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"T":"t",z);return this},arcTo:function(){this._confirmSegmented();var z=[];this._collectArgs(z,arguments);this._pushSegment(this.absolute?"A":"a",z);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var z=
this.shape.path;this.shape.path=[];this._setPath(z);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(z){z=J.isArray(z)?z:z.match(P.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(z){for(var r="",u=[],w=z.length,x=0;x<w;++x){var K=z[x],c=parseFloat(K);isNaN(c)?(r&&this._pushSegment(r,u),u=[],r=K):u.push(c)}this._pushSegment(r,u)}},setShape:function(z){this.inherited(arguments,["string"==typeof z?{path:z}:z]);this.segmented=!1;this.segments=
[];P.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});Q=Q("dojox.gfx.path.TextPath",L,{constructor:function(z){"text"in this||(this.text=J.clone(P.defaultTextPath));"fontStyle"in this||(this.fontStyle=J.clone(P.defaultFont))},getText:function(){return this.text},setText:function(z){this.text=P.makeParameters(this.text,"string"==typeof z?{text:z}:z);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(z){this.fontStyle="string"==typeof z?
P.splitFontString(z):P.makeParameters(P.defaultFont,z);this._setFont();return this}});return P.path={Path:L,TextPath:Q}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(P,J,Q){function V(x){var K=Math.cos(x);x=Math.sin(x);var c={x:K+4/3*(1-K),y:x-4/3*K*(1-K)/x};return{s:{x:K,y:-x},c1:{x:c.x,y:-c.y},c2:c,e:{x:K,y:x}}}var L=2*Math.PI,z=Math.PI/4,r=Math.PI/8,u=z+r,w=V(r);return P.arc={unitArcAsBezier:V,curvePI4:w,arcAsBezier:function(x,K,c,b,q,m,e,d){q=!!q;m=!!m;
var g=Q._degToRad(b);b=K*K;var E=c*c,F=Q.multiplyPoint(Q.rotate(-g),{x:(x.x-e)/2,y:(x.y-d)/2}),G=F.x*F.x,D=F.y*F.y;b=Math.sqrt((b*E-b*D-E*G)/(b*D+E*G));isNaN(b)&&(b=0);b={x:b*K*F.y/c,y:-b*c*F.x/K};q==m&&(b={x:-b.x,y:-b.y});b=Q.multiplyPoint([Q.translate((x.x+e)/2,(x.y+d)/2),Q.rotate(g)],b);K=Q.normalize([Q.translate(b.x,b.y),Q.rotate(g),Q.scale(K,c)]);b=Q.invert(K);x=Q.multiplyPoint(b,x);d=Q.multiplyPoint(b,e,d);e=Math.atan2(x.y,x.x);b=e-Math.atan2(d.y,d.x);m&&(b=-b);0>b?b+=L:b>L&&(b-=L);c=r;d=w;
c=m?c:-c;x=[];for(q=b;0<q;q-=z)q<u&&(c=q/2,d=V(c),c=m?c:-c,q=0),F=Q.normalize([K,Q.rotate(e+c)]),m?(b=Q.multiplyPoint(F,d.c1),g=Q.multiplyPoint(F,d.c2),F=Q.multiplyPoint(F,d.e)):(b=Q.multiplyPoint(F,d.c2),g=Q.multiplyPoint(F,d.c1),F=Q.multiplyPoint(F,d.s)),x.push([b.x,b.y,g.x,g.y,F.x,F.y]),e+=2*c;return x}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(P,J,Q){function V(w,x){return Math.abs(w-x)<=1E-6*(Math.abs(w)+Math.abs(x))}function L(w,x,K,c){if(!isFinite(w))return K;
if(!isFinite(K))return w;x=Math.abs(x);c=Math.abs(c);return(x*w+c*K)/(x+c)}function z(w){w=Q.normalize(w);var x=-w.xx-w.yy,K=w.xx*w.yy-w.xy*w.yx,c=Math.sqrt(x*x-4*K);x=-(x+(0>x?-c:c))/2;K/=x;c=w.xy/(x-w.xx);var b=1,q=w.xy/(K-w.xx),m=1;V(x,K)&&(c=1,q=b=0,m=1);isFinite(c)||(c=1,b=(x-w.xx)/w.xy,isFinite(b)||(c=(x-w.yy)/w.yx,b=1,isFinite(c)||(c=1,b=w.yx/(x-w.yy))));isFinite(q)||(q=1,m=(K-w.xx)/w.xy,isFinite(m)||(q=(K-w.yy)/w.yx,m=1,isFinite(q)||(q=1,m=w.yx/(K-w.yy))));w=Math.sqrt(c*c+b*b);var e=Math.sqrt(q*
q+m*m);isFinite(c/=w)||(c=0);isFinite(b/=w)||(b=0);isFinite(q/=e)||(q=0);isFinite(m/=e)||(m=0);return{value1:x,value2:K,vector1:{x:c,y:b},vector2:{x:q,y:m}}}function r(w,x){var K=0>w.xx*w.yy||0<w.xy*w.yx?-1:1,c=x.angle1=(Math.atan2(w.yx,w.yy)+Math.atan2(-K*w.xy,K*w.xx))/2;K=Math.cos(c);c=Math.sin(c);x.sx=L(w.xx/K,K,-w.xy/c,c);x.sy=L(w.yy/K,K,w.yx/c,c);return x}function u(w,x){var K=0>w.xx*w.yy||0<w.xy*w.yx?-1:1,c=x.angle2=(Math.atan2(K*w.yx,K*w.xx)+Math.atan2(-w.xy,w.yy))/2;K=Math.cos(c);c=Math.sin(c);
x.sx=L(w.xx/K,K,w.yx/c,c);x.sy=L(w.yy/K,K,-w.xy/c,c);return x}return P.decompose=function(w){var x=Q.normalize(w);w={dx:x.dx,dy:x.dy,sx:1,sy:1,angle1:0,angle2:0};if(V(x.xy,0)&&V(x.yx,0))return J.mixin(w,{sx:x.xx,sy:x.yy});if(V(x.xx*x.yx,-x.xy*x.yy))return r(x,w);if(V(x.xx*x.xy,-x.yx*x.yy))return u(x,w);var K=new Q.Matrix2D(x);var c=J.mixin(K,{dx:0,dy:0,xy:K.yx,yx:K.xy});K=z([x,c]);c=z([c,x]);K=new Q.Matrix2D({xx:K.vector1.x,xy:K.vector2.x,yx:K.vector1.y,yy:K.vector2.y});c=new Q.Matrix2D({xx:c.vector1.x,
xy:c.vector1.y,yx:c.vector2.x,yy:c.vector2.y});x=new Q.Matrix2D([Q.invert(K),x,Q.invert(c)]);r(c,w);x.xx*=w.sx;x.yy*=w.sy;u(K,w);x.xx*=w.sx;x.yy*=w.sy;return J.mixin(w,{sx:x.xx,sy:x.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(P){P=P.bezierutils={};P.tAtLength=function(r,u){var w=0,x=6==r.length,K=0,c=0,b=x?V:z,q=function(m,e){for(var d=0,g=0;g<m.length-2;g+=2)d+=Q(m[g],m[g+1],m[g+2],m[g+3]);g=x?Q(r[0],r[1],r[4],r[5]):Q(r[0],r[1],r[6],r[7]);d-g>e||K+d>u+e?(++c,m=b(m,.5),
q(m[0],e),Math.abs(K-u)<=e||q(m[1],e)):(K+=d,w+=1/(1<<c))};u&&q(r,.5);return w};var J=P.computeLength=function(r){for(var u=6==r.length,w=0,x=0;x<r.length-2;x+=2)w+=Q(r[x],r[x+1],r[x+2],r[x+3]);x=u?Q(r[0],r[1],r[4],r[5]):Q(r[0],r[1],r[6],r[7]);return.1<w-x?(r=u?V(r,.5):L(r,.5),w=J(r[0],u),w+=J(r[1],u)):w},Q=P.distance=function(r,u,w,x){return Math.sqrt((w-r)*(w-r)+(x-u)*(x-u))},V=function(r,u){var w=1-u,x=w*w,K=u*u,c=r[0],b=r[1],q=r[2],m=r[3],e=r[4];r=r[5];var d=x*c+2*w*u*q+K*e;x=x*b+2*w*u*m+K*r;
return[[c,b,w*c+u*q,w*b+u*m,d,x],[d,x,w*q+u*e,w*m+u*r,e,r]]},L=function(r,u){var w=1-u,x=w*w,K=x*w,c=u*u,b=c*u,q=r[0],m=r[1],e=r[2],d=r[3],g=r[4],E=r[5],F=r[6];r=r[7];var G=K*q+3*x*u*e+3*w*c*g+b*F;K=K*m+3*x*u*d+3*w*c*E+b*r;return[[q,m,w*q+u*e,w*m+u*d,x*q+2*w*u*e+c*g,x*m+2*w*u*d+c*E,G,K],[G,K,x*e+2*w*u*g+c*F,x*d+2*w*u*E+c*r,w*g+u*F,w*E+u*r,F,r]]},z=P.splitBezierAtT=function(r,u){return 6==r.length?V(r,u):L(r,u)};return P})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(P,J,Q){J.getObject("json",!0,Q);Q.json._slice=function(V,L,z,r){var u=V.length,w=[];z=z||u;L=0>L?Math.max(0,L+u):Math.min(u,L);for(z=0>z?Math.max(0,z+u):Math.min(u,z);L<z;L+=r)w.push(V[L]);return w};Q.json._find=function(V,L){function z(w){L&&(!0!==L||w instanceof Array?w[L]&&r.push(w[L]):r.push(w));for(var x in w){var K=w[x];L?K&&"object"==typeof K&&z(K):r.push(K)}}var r=[];if(L instanceof Array){if(1==L.length)return V[L[0]];for(var u=0;u<L.length;u++)r.push(V[L[u]])}else z(V);
return r};Q.json._distinctFilter=function(V,L){for(var z=[],r={},u=0,w=V.length;u<w;++u){var x=V[u];L(x,u,V)&&("object"==typeof x&&x?x.__included||(x.__included=!0,z.push(x)):r[x+typeof x]||(r[x+typeof x]=!0,z.push(x)))}u=0;for(w=z.length;u<w;++u)z[u]&&delete z[u].__included;return z};return Q.json.query=function(V,L){function z(c,b,q,m,e,d,g,E){return u[E].match(/[\*\?]/)||"~"==g?"/^"+u[E].substring(1,u[E].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==g?"$/i":"$/")+".test("+b+")":c}var r=0,u=[];V=V.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(c){r+="["==c?1:"]"==c?-1:0;return"]"==c&&0<r?"`]":'"'==c.charAt(0)||"'"==c.charAt(0)?"`"+(u.push(c)-1):c});var w="";V.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});V=V.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(c){return"."==c.charAt(0)?c:"@"==c?"$obj":(c.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+c}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(c,b,q){return(b=c.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(q="",c.match(/^\./)&&(w="dojox.json._find("+w,q=",true)"),w=(b[1].match(/=/)?"dojo.map":b[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+w,q+",function($obj){return "+b[2]+"})"):(b=c.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+b[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(m,e,d){return"var av\x3d "+d.replace(/\$obj/,
"a")+",bv\x3d "+d.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==e?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==e?-1:1)+";}\n"})+"return 0;})":(b=c.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(w="dojox.json._slice("+w,","+(b[1]||0)+","+(b[2]||0)+","+(b[3]||1)+")"):c.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(w="dojox.json._find("+w,("."==c.charAt(1)?",'"+q+"'":c.match(/,/)?","+c:"")+")"):c}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
z).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(c,b,q,m,e,d,g,E){return z(c,m,e,d,g,E,q,b)});V=w+("$"==V.charAt(0)?"":"$")+V.replace(/`([0-9]+|\])/g,function(c,b){return"]"==b?"]":u[b]});for(var x=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+V+"}"),K=0;K<arguments.length-1;K++)arguments[K]=arguments[K+1];return L?x.apply(this,arguments):x}})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K){P=P(x,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(c){this._geocodeHandler=J.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=J.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=J.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(c){this.outSpatialReference=c},_geocodeHandler:function(c,b,q,m,e){try{var d=c.candidates;b=[];var g,E=d.length,F=c.spatialReference,G;for(g=0;g<E;g++){var D=d[g];if(G=D.location)G.spatialReference=F;b[g]=new K(D)}this._successHandler([b],"onAddressToLocationsComplete",q,e)}catch(k){this._errorHandler(k,m,e)}},_geocodeAddressesHandler:function(c,b,q,m,e){try{var d=c.locations;b=[];var g,E=d.length,F=c.spatialReference,G;for(g=0;g<E;g++){if(G=
d[g].location)G.spatialReference=F;b[g]=new K(d[g])}this._successHandler([b],"onAddressesToLocationsComplete",q,e)}catch(D){this._errorHandler(D,m,e)}},addressToLocations:function(c,b,q,m,e){var d;if(c.address){m=q;q=b;b=c.outFields;e=c.searchExtent;var g=c.countryCode;var E=c.magicKey;var F=c.distance;var G=c.categories;c.location&&this.normalization&&(d=c.location.normalize());var D=c.locationType;var k=c.maxLocations;var n=c.forStorage;c=c.address}e&&(e=e.shiftCentralMeridian());var f=this.outSpatialReference;
c=this._encode(J.mixin({},this._url.query,c,{f:"json",outSR:f&&L.toJson(f.toJson()),outFields:b&&b.join(",")||null,searchExtent:e&&L.toJson(e.toJson()),category:G&&G.join(",")||null,countryCode:g||null,magicKey:E||null,distance:F||null,location:d||null,locationType:D||null,maxLocations:k||null,forStorage:n||null}));var y=this._geocodeHandler,I=this._errorHandler,C=new V(w._dfdCanceller);C._pendingDfd=u({url:this._url.path+"/findAddressCandidates",content:c,callbackParamName:"callback",load:function(N,
R){y(N,R,q,m,C)},error:function(N){I(N,m,C)}});return C},suggestLocations:function(c){var b=new V(w._dfdCanceller);c.hasOwnProperty("location")&&this.normalization&&(c.location=c.location.normalize());c.searchExtent&&(c.searchExtent=c.searchExtent.shiftCentralMeridian());c=this._encode(J.mixin({},this._url.query,{f:"json",text:c.text,maxSuggestions:c.maxSuggestions,searchExtent:c.searchExtent&&L.toJson(c.searchExtent.toJson()),category:c.categories&&c.categories.join(",")||null,countryCode:c.countryCode||
null,location:c.location||null,distance:c.distance||null},{f:"json"}));c=u({url:this._url.path+"/suggest",content:c,callbackParamName:"callback"});b._pendingDfd=c;c.then(J.hitch(this,function(q){q=q.suggestions||[];this.onSuggestLocationsComplete(q);b.resolve(q)}),J.hitch(this,function(q){this._errorHandler(q);b.reject(q)}));return b},addressesToLocations:function(c,b,q){var m=this.outSpatialReference,e=[],d=c.categories,g=c.locationType,E=c.countryCode;Q.forEach(c.addresses,function(k,n){e.push({attributes:k})});
c=this._encode(J.mixin({},this._url.query,{category:d&&d.join(",")||null,locationType:g||null,sourceCountry:E||null},{addresses:L.toJson({records:e})},{f:"json",outSR:m&&L.toJson(m.toJson())}));var F=this._geocodeAddressesHandler,G=this._errorHandler,D=new V(w._dfdCanceller);D._pendingDfd=u({url:this._url.path+"/geocodeAddresses",content:c,callbackParamName:"callback",load:function(k,n){F(k,n,b,q,D)},error:function(k){G(k,q,D)}});return D},_reverseGeocodeHandler:function(c,b,q,m,e){try{var d=new K({address:c.address,
location:c.location,score:100});this._successHandler([d],"onLocationToAddressComplete",q,e)}catch(g){this._errorHandler(g,m,e)}},locationToAddress:function(c,b,q,m){c&&this.normalization&&(c=c.normalize());var e=this.outSpatialReference;c=this._encode(J.mixin({},this._url.query,{outSR:e&&L.toJson(e.toJson()),location:c&&L.toJson(c.toJson()),distance:b,f:"json"}));var d=this._reverseGeocodeHandler,g=this._errorHandler,E=new V(w._dfdCanceller);E._pendingDfd=u({url:this._url.path+"/reverseGeocode",content:c,
callbackParamName:"callback",load:function(F,G){d(F,G,q,m,E)},error:function(F){g(F,m,E)}});return E},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});z("extend-esri")&&J.setObject("tasks.Locator",P,r);return P})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(P,J,Q,V,L){P=P(null,{declaredClass:"esri.tasks.AddressCandidate",
constructor:function(z){J.mixin(this,z);this.location=new L(this.location)}});Q("extend-esri")&&J.setObject("tasks.AddressCandidate",P,V);return P})},"esri/tasks/LegendLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,J,Q,V){P=P(null,{declaredClass:"esri.tasks.LegendLayer",layerId:null,subLayerIds:null});Q("extend-esri")&&J.setObject("tasks.LegendLayer",P,V);return P})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ./FeatureTable/dataUtils ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k,n,f,y,I,C,N,R,a,v,H,l,h,A,O,X,W,ba,ea,fa){var ha=P([n,E,F],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:fa,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(S,T){J.mixin(this,e.widgets.attributeInspector);S=S||{};S.featureLayer||S.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(S);this._layerInfos=S.layerInfos||[{featureLayer:S.featureLayer,options:S.options||[]}];this._layerInfos=Q.filter(this._layerInfos,function(Y){return!Y.disableAttributeUpdate});this._hideNavButtons=S.hideNavButtons||!1},postCreate:function(){if(Q.every(this._layerInfos,
function(T){return T.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var S=this._layerInfos.length;Q.forEach(this._layerInfos,function(T){T=T.featureLayer;if(T.loaded)S--;else var Y=V.connect(T,"onLoad",this,function(ca){V.disconnect(Y);Y=null;S--;S||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();Q.forEach(this._aiConnects,V.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(S,T){T&&(this._createOnlyFirstTime=!0);
this._updateSelection([S],T);this._updateUI()},onLayerSelectionChange:function(S,T,Y){this._createOnlyFirstTime=!1;this._featureIdx=Y===m.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(S,T,Y,ca){},onLayerError:function(S,T,Y,ca){},onLayerEditsError:function(S,
T,Y,ca){},onLayerEditsComplete:function(S,T,Y,ca){ca=ca||[];if(ca.length){var ia=this._selection,oa=S.featureLayer.objectIdField;Q.forEach(ca,J.hitch(this,function(pa){Q.some(ia,J.hitch(this,function(na,sa){if(na.attributes[oa]!==pa.objectId)return!1;this._selection.splice(sa,1);return!0}))}))}T=T||[];T.length&&(this._selection=y.findFeatures(T,S.featureLayer),this._featureIdx=0);ca=this._numFeatures=(this._selection=y.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(T.length){if(T=
ca?this._selection[this._featureIdx]:null)ca=T.getLayer().getEditCapabilities(),ca.canCreate&&!ca.canUpdate||this._showFeature(T);this._updateUI()}Y=Y||[];if(Y.length){var ja=this._rollbackInfo;Q.forEach(Y,function(pa){var na=y.findFeatures(Y,S.featureLayer)[0];if(!pa.success&&na.attributes[S.featureLayer.objectIdField]===pa.objectId&&ja){var sa=ja.field;pa=ja.graphic.attributes[sa.name];var ua=Q.filter(this._currentLInfo.fieldInfos,function(ya){return ya.fieldName===sa.name},this)[0].dijit;na.attributes[sa.name]=
pa;"esriFieldTypeDate"===sa.type&&(pa=new Date(pa));this._setValue(ua,pa)}},this)}this._rollbackInfo=null},onFieldValueChange:function(S,T){var Y=S.field,ca=S.dijit,ia=this._currentFeature,oa=this._currentLInfo,ja=Y.name;S=this._isFieldRequired(Y,S);if(""===ca.displayedValue||"dijit.form.ValidationTextBox"!==ca.declaredClass||ca.isValid())if(""!==ca.displayedValue&&ca.displayedValue!==T&&ca.isValid&&!ca.isValid())this._setValue(ca,ia.attributes[Y.name]);else{var pa=!("esriFieldTypeInteger"!==Y.type&&
"esriFieldTypeSmallInteger"!==Y.type&&"esriFieldTypeSingle"!==Y.type&&"esriFieldTypeDouble"!==Y.type);if(S&&(null===T||""===T||"undefined"===typeof T||pa&&isNaN(T))){ja=ia.attributes[Y.name];if("esriFieldTypeDate"===Y.type&&(ja=new Date(ja),ca instanceof Array)){this._setValue(ca[0],ja);this._setValue(ca[1],ja);return}this._setValue(ca,ja)}else{if(pa){if(isNaN(T)||""===T)T=null;pa&&null!==T&&(T=Number(T))}"esriFieldTypeDate"===Y.type&&(ca instanceof Array?(T=ca[0].getValue(),ca=ca[1].getValue(),T=
T&&ca?new Date(T.getFullYear(),T.getMonth(),T.getDate(),ca.getHours(),ca.getMinutes(),ca.getSeconds(),ca.getMilliseconds()):T||ca||null):(T=ca.getValue(),Y.domain&&(T=Number(T))),T=T&&T.getTime?T.getTime():T&&T.toGregorian?T.toGregorian().getTime():T);if(this._currentFeature.attributes[Y.name]!==T){if(ja===oa.typeIdField){var na=this._findFirst(oa.types,"id",T);Q.forEach(oa.fieldInfos,function(sa){(Y=sa.field)&&Y.name!==oa.typeIdField&&(sa=sa.dijit,this._setFieldDomain(sa,na,Y)&&sa&&(this._setValue(sa,
ia.attributes[Y.name]+""),!1===sa.isValid()&&this._setValue(sa,null)))},this)}this.onAttributeChange(ia,ja,T)}}}else this._setValue(ca,ia.attributes[Y.name])},onDeleteBtn:function(S){this._deleteFeature()},onNextFeature:function(S){this._onNextFeature(1)},onPreviousFeature:function(S){this._onNextFeature(-1)},onFirstFeature:function(S){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(S){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var S=this._layerInfos;
this._editorTrackingInfos={};Q.forEach(S,this._initLayerInfo,this)},_initLayerInfo:function(S){var T=S.featureLayer,Y;this._userIds={};var ca=T.id;T.credential&&(this._userIds[ca]=T.credential.userId);S.userId&&(this._userIds[ca]=S.userId);this._connect(T,"onSelectionComplete",J.hitch(this,"onLayerSelectionChange",S));this._connect(T,"onSelectionClear",J.hitch(this,"onLayerSelectionClear",S));this._connect(T,"onEditsComplete",J.hitch(this,"onLayerEditsComplete",S));this._connect(T,"error",J.hitch(this,
"onLayerError",S));this._connect(T,"onUpdateEnd",J.hitch(this,"onLayerUpdateEnd",S));S.showAttachments=T.hasAttachments?c.isDefined(S.showAttachments)?S.showAttachments:!0:!1;S.hideFields=S.hideFields||[];S.htmlFields=S.htmlFields||[];S.isEditable=T.isEditable()?c.isDefined(S.isEditable)?S.isEditable:!0:!1;S.typeIdField=T.typeIdField;S.layerId=T.id;S.types=T.types;T.globalIdField&&((Y=this._findFirst(S.fieldInfos,"fieldName",T.globalIdField))||S.showGlobalID||S.hideFields.push(T.globalIdField));(ca=
this._findFirst(S.fieldInfos,"fieldName",T.objectIdField))||S.showObjectID||S.hideFields.push(T.objectIdField);var ia=this._getFields(S.featureLayer);if(ia){var oa=S.fieldInfos||[];oa=Q.map(oa,function(ja){return J.mixin({},ja)});oa.length?S.fieldInfos=Q.filter(Q.map(oa,J.hitch(this,function(ja){var pa=ja.stringFieldOption||(this._isInFields(ja.fieldName,S.htmlFields)?ha.STRING_FIELD_OPTION_RICHTEXT:ha.STRING_FIELD_OPTION_TEXTBOX);return J.mixin(ja,{field:this._findFirst(ia,"name",ja.fieldName),stringFieldOption:pa})})),
"return item.field;"):(ia=Q.filter(ia,J.hitch(this,function(ja){return!this._isInFields(ja.name,S.hideFields)})),S.fieldInfos=Q.map(ia,J.hitch(this,function(ja){var pa=this._isInFields(ja.name,S.htmlFields)?ha.STRING_FIELD_OPTION_RICHTEXT:ha.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:ja.name,field:ja,stringFieldOption:pa}})));S.showGlobalID&&!Y&&oa.push(this._findFirst(ia,"name",T.globalIdField));S.showObjectID&&!ca&&oa.push(this._findFirst(ia,"name",T.objectIdField));Y=[];T.editFieldsInfo&&(T.editFieldsInfo.creatorField&&
Y.push(T.editFieldsInfo.creatorField),T.editFieldsInfo.creationDateField&&Y.push(T.editFieldsInfo.creationDateField),T.editFieldsInfo.editorField&&Y.push(T.editFieldsInfo.editorField),T.editFieldsInfo.editDateField&&Y.push(T.editFieldsInfo.editDateField));this._editorTrackingInfos[T.id]=Y}},_createAttachmentEditor:function(){this._attachmentEditor=null;var S=Q.filter(this._layerInfos,function(T){return T.showAttachments});S&&S.length&&(this._attachmentEditor=new f({"class":this.css.attachmentEditor},
this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(S){var T=this._currentLInfo?this._currentLInfo.featureLayer:null,Y=S.featureLayer;if(T&&T.id===Y.id&&!T.ownershipBasedAccessControlForFeatures&&(T=Y.getEditCapabilities(),!T.canCreate||T.canUpdate))return;this._currentLInfo=S;this._createTable()},_updateSelection:function(S,T){this._selection=S||[];Q.forEach(this._layerInfos,this._getSelection,this);this._selection=y.sortFeaturesById(this._layerInfos,this._selection);
this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?this._selection[this._featureIdx]:null,T)},_getSelection:function(S){S=S.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(S)},_updateUI:function(){var S=this._numFeatures,T=this._currentLInfo;this.layerName.innerHTML=T&&0!==S?T.featureLayer?T.featureLayer.name:"":this.NLS_noFeaturesSelected;u.set(this.attributeTable,"display",S?"":"none");u.set(this.editButtons,"display",S?"":"none");u.set(this.navButtons,
"display",!this._hideNavButtons&&1<S?"":"none");this.navMessage.innerHTML=c.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&u.set(this._attachmentEditor.domNode,"display",T&&T.showAttachments&&S?"":"none");u.set(this.deleteBtn.domNode,"display",T&&!1===T.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(S){this._featureIdx+=
S;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);S=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(S);this._updateUI();this.onNext(S)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(S,T){if(S){this._currentFeature=S;T=T?T:S.getLayer();var Y=T.getEditCapabilities({feature:S,userId:this._userIds[T.id]});this._canUpdate=Y.canUpdate;this._canDelete=Y.canDelete;if(Y=
this._getLInfoFromFeatureLayer(T)){this._setCurrentLInfo(Y);var ca=S.attributes,ia=this._findFirst(Y.types,"id",ca[Y.typeIdField]),oa=null;Q.forEach(Y.fieldInfos,function(ja){oa=ja.field;var pa=[];ja.dijit&&1<ja.dijit.length?Q.forEach(ja.dijit,function(na){pa.push(na)}):pa.push(ja.dijit);Q.forEach(pa,J.hitch(this,function(na){if(na){var sa=this._setFieldDomain(na,ia,oa),ua=ca[oa.name];ua=ua&&sa&&sa.codedValues&&sa.codedValues.length?sa.codedValues[ua]?sa.codedValues[ua].name:ua:ua;c.isDefined(ua)||
(ua="");"dijit.form.DateTextBox"===na.declaredClass||"dijit.form.TimeTextBox"===na.declaredClass?ua=""===ua?null:new Date(ua):"dijit.form.FilteringSelect"===na.declaredClass&&(na._lastValueReported=null,ua=ca[oa.name]+"");try{this._setValue(na,ua),"dijit.form.FilteringSelect"===na.declaredClass&&!1===na.isValid()&&this._setValue(na,null)}catch(ya){na.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&Y.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,
T);(S=T.getEditSummary(S))?(this.editorTrackingInfoDiv.innerHTML=S,b.show(this.editorTrackingInfoDiv)):b.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(S,T,Y){if(!S)return null;var ca=Y.domain;T&&T.domains&&T.domains[Y.name]&&!1===T.domains[Y.name]instanceof q&&(ca=T.domains[Y.name]);if(!ca)return null;ca.codedValues&&0<ca.codedValues.length?(S.set("store",this._toStore(Q.map(ca.codedValues,function(ia){return{id:ia.code+"",name:ia.name}}))),this._setValue(S,ca.codedValues[0].code+"")):
(S.constraints={min:c.isDefined(ca.minValue)?ca.minValue:Number.MIN_VALUE,max:c.isDefined(ca.maxValue)?ca.maxValue:Number.MAX_VALUE},this._setValue(S,S.constraints.min));return ca},_setValue:function(S,T){S.set&&(S._onChangeActive=!1,S.set("value",T,!0),S._onChangeActive=!0)},_getFields:function(S){var T=S._getOutFields();if(!T)return null;S=S.fields;return"*"==T?S:Q.filter(Q.map(T,J.hitch(this,"_findFirst",S,"name")),c.isDefined)},_isInFields:function(S,T){return S&&(T||T.length)?Q.some(T,function(Y){return Y.toLowerCase()===
S.toLowerCase()}):!1},_isFieldNullable:function(S,T){return!(!1===S.nullable||T.field&&!1===T.field.nullable)},_isFieldRequired:function(S,T){return!1!==S.editable&&!1!==T.isEditable&&!this._isFieldNullable(S,T)},_findFirst:function(S,T,Y){return(S=Q.filter(S,function(ca){return ca.hasOwnProperty(T)&&ca[T]===Y}))&&S.length?S[0]:null},_getLInfoFromFeatureLayer:function(S){return this._findFirst(this._layerInfos,"layerId",S?S.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML=
"";this._attributes=w.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var S=w.create("tbody",null,this._attributes),T=this._currentLInfo,Y=this._findFirst(T.types,"id",this._currentFeature.attributes[T.typeIdField]);Q.forEach(T.fieldInfos,J.hitch(this,"_createField",Y,S),this);this._createOnlyFirstTime=!1},_createField:function(S,T,Y){var ca=this._currentLInfo,ia=Y.field;if(!this._isInFields(ia.name,ca.hideFields)&&!this._isInFields(ia.name,this._editorTrackingInfos[ca.featureLayer.id])){var oa=
!1,ja;T=w.create("tr",null,T);var pa=Y.label||ia.alias||ia.name;pa=x.sanitizer?x.sanitizer.sanitize(pa):htmlEntities.encode(pa);pa=w.create("td",{innerHTML:pa,"class":this.css.label,"data-fieldname":ia.name},T);this._isFieldRequired(ia,Y)&&w.create("span",{"class":this.css.red,innerHTML:" *"},pa);T=w.create("td",null,T);if(Y.customField){w.place(Y.customField.domNode||Y.customField,w.create("div",null,T),"first");var na=Y.customField}else if(!1===ca.isEditable||!1===ia.editable||!1===Y.isEditable||
"esriFieldTypeOID"===ia.type||"esriFieldTypeGlobalID"===ia.type||!this._canUpdate&&!this._createOnlyFirstTime)oa=!0;ca=ca.typeIdField&&ia.name.toLowerCase()==ca.typeIdField.toLowerCase();pa=!!this._getDomainForField(ia,S);!na&&ca?na=this._createTypeField(ia,Y,T):!na&&pa&&(na=this._createDomainField(ia,Y,S,T));if(!na)switch(ia.type){case "esriFieldTypeString":na=this._createStringField(ia,Y,T);break;case "esriFieldTypeDate":na=this._createDateField(ia,Y,T);Y.format&&Y.format.time&&(ja=this._createTimeField(ia,
Y,T));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":na=this._createIntField(ia,Y,T);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":na=this._createFltField(ia,Y,T);break;default:na=this._createStringField(ia,Y,T)}Y.tooltip&&Y.tooltip.length&&this._toolTips.push(new O({connectId:[na.id],label:Y.tooltip}));na.onChange=J.hitch(this,"onFieldValueChange",Y);na.set("disabled",oa);ja?(Y.dijit=[na,ja],ja.onChange=J.hitch(this,"onFieldValueChange",Y),ja.set("disabled",oa)):
Y.dijit=na}},_createTypeField:function(S,T,Y){Y=w.create("div",null,Y);var ca=S.domain;return ca&&"range"===ca.type&&ca.minValue===ca.maxValue?new h({"class":this.css.field,trim:!0,maxLength:S.length,name:S.alias||S.name,required:this._isFieldRequired(S,T)},Y):new a({"class":this.css.field,name:S.alias||S.name,required:this._isFieldRequired(S,T),store:this._toStore(Q.map(this._currentLInfo.types,function(ia){return{id:ia.id,name:ia.name}})),searchAttr:"name"},Y)},_getDomainForField:function(S,T){var Y=
S.domain;(S=S.name)&&T&&T.domains&&T.domains[S]&&!1===T.domains[S]instanceof q&&(Y=T.domains[S]);return Y||null},_createDomainField:function(S,T,Y,ca){Y=this._getDomainForField(S,Y);ca=w.create("div",null,ca);return Y.codedValues?new a({"class":this.css.field,name:S.alias||S.name,searchAttr:"name",required:this._isFieldRequired(S,T)},ca):new v({"class":this.css.field},ca)},_createStringField:function(S,T,Y){Y=w.create("div",null,Y);var ca={trim:!0,maxLength:S.length,required:this._isFieldRequired(S,
T)};if(T.stringFieldOption===ha.STRING_FIELD_OPTION_TEXTAREA)return ca["class"]=this.css.field+" "+this.css.textArea,new l(ca,Y);if(T.stringFieldOption===ha.STRING_FIELD_OPTION_RICHTEXT)return ca["class"]=this.css.field+" "+this.css.richText,ca.height="100%",ca.width="100%",ca.plugins=T.richTextPlugins||this._defaultRichTextPlugins,Y=new G(ca,Y),Y.startup(),Y;var ia=this;ca.validator=function(oa,ja){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return ia._isFieldNullable(S,T)||!(""===oa||
null===oa)};return new h(ca,Y)},_createTimeField:function(S,T,Y){Y=w.create("div",null,Y);S={"class":this.css.field,trim:!0,required:this._isFieldRequired(S,T),constraints:{formatLength:"medium"}};this._datePackage&&(S.datePackage=this._datePackage);return new A(S,Y)},_createDateField:function(S,T,Y){Y=w.create("div",null,Y);S={"class":this.css.field,trim:!0,required:this._isFieldRequired(S,T)};this._datePackage&&(S.datePackage=this._datePackage);return new C(S,Y)},_createIntField:function(S,T,Y){Y=
w.create("div",null,Y);return new R({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===S.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(S,T)},Y)},_createFltField:function(S,T,Y){Y=w.create("div",null,Y);return new R({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(S,T)},Y)},_toStore:function(S){return new X({data:{identifier:"id",
label:"name",items:S}})},_connect:function(S,T,Y){this._aiConnects.push(V.connect(S,T,Y))},_getDatePackage:function(S){return null===S.datePackage?null:S.datePackage?S.datePackage:"ar"===z.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){Q.forEach(this._layerInfos,function(S){Q.forEach(S.fieldInfos,function(T){var Y=T.dijit;if(Y){Y._onChangeHandle=null;if(T.customField)return;Y instanceof Array?Q.forEach(Y,J.hitch(this,function(ca){ca.destroyRecursive?ca.destroyRecursive():ca.destroy&&
ca.destroy();ca._onChangeHandle=null})):Y.destroyRecursive?Y.destroyRecursive():Y.destroy&&Y.destroy()}T.dijit=null},this)},this);Q.forEach(this._toolTips,function(S){S.destroy()});this._toolTips=[];this._attributes&&w.destroy(this._attributes)}});J.mixin(ha,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});r("extend-esri")&&J.setObject("dijit.AttributeInspector",ha,K);return ha})},"esri/dijit/FeatureTable/dataUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/number dojo/string dojo/date/locale dojo/promise/all ../../libs/sanitizer/Sanitizer ../../config ../../graphic ../../numberUtils ../../request ../../ArcadeExpression ../../arcadeProfiles/popupProfile ../../layers/FeatureLayer ../../geometry/Extent ../../tasks/query ../../tasks/StatisticDefinition ../../tasks/QueryTask ../../tasks/RelationshipQuery dojo/i18n dojo/i18n!../../nls/jsapi".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D){return{i18nStrings:D.widgets.FeatureTable,numericFieldTypes:["esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeSmallInteger"],statisticDefinitions:[{type:"count",name:"countField"},{type:"sum",name:"sumField"},{type:"min",name:"minField"},{type:"max",name:"maxField"},{type:"avg",name:"avgField"},{type:"stddev",name:"stddevField"}],_reExprField:/^\s*expression\//i,sanitizer:new u({whiteList:{dd:[],dl:[],dt:[],h1:[],
h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],text:[],textpath:[],tspan:[],use:[]}},!0),getOrderByString:function(k,n){return k+(n?" DESC":" ASC")},getWhereString:function(k,n){return k+"\x3d'"+n+"'"},getRelationshipWhereClause:function(k){var n=k.layer,f=k.originRelationship,
y=k.destinationRelationship,I=f.relationshipTableId||f.relatedTableId;f=f.keyFieldInRelationshipTable||f.keyField;var C=y.keyFieldInRelationshipTable||y.keyField,N=n.layerId==I?C:f;k=this.getWhereString(N,k.keyValue);f=n._url.path;f=f.substring(0,f.lastIndexOf("/")+1);return c({url:f+I+"/query",content:{f:"json",outFields:["*"],returnGeometry:!1,where:k},handleAs:"json",callbackParamName:"callback"}).then(J.hitch(this,function(R){if(R&&R.features&&R.features.length){var a=R.features,v=[],H="",l;P.forEach(a,
function(h,A){if(h.attributes&&h.attributes[C])l=h.attributes[C];else{var O=n.getField(N)?n.getField(N).name:null;if(this.isValueEmpty(O)){O=C.toUpperCase();var X=C.toLowerCase();l=h.attributes[O]||h.attributes[X]||null}else l=h.attributes[O]}-1===P.indexOf(v,l)&&(0<v.length&&A<a.length&&(H=H.concat(" OR ")),v.push(l),H=H.concat(this.getWhereString(y.keyField,l)))},this);return H}return null}))},isValueEmpty:function(k){return null===k||" "===k||""===k||"undefined"===typeof k},findFirst:function(k,
n,f){return P.filter(k,function(y){return y.hasOwnProperty(n)&&y[n]===f})[0]||null},compareIntArrays:function(k,n){k.sort();n.sort();var f=P.every(n,function(I){return-1!==P.indexOf(k,I)},this),y=P.every(k,function(I){return-1!==P.indexOf(n,I)},this);return f&&y},findFirstNumberColumn:function(k,n){var f;P.some(k,function(y,I){if(-1!==P.indexOf(this.numericFieldTypes,y.type)&&y.field!==n&&!y.hidden)return f=y,!0},this);return f},getRoundingPrecision:function(k){return 1E3<=k?0:10<=k?2:0<=k?4:6},generateLinkFromString:function(k){var n=
/^\s*(http?:\/\/([^\s]+))\s*$/i,f=/^\s*(https?:\/\/([^\s]+))\s*$/i;if("string"===typeof k){var y;n.test(k)?y=k.indexOf("http:"):f.test(k)&&(y=k.indexOf("https:"));-1<y&&-1===k.indexOf("href\x3d")?(n=k.indexOf(" ",y),-1===n&&(n=k.length),f=k.substring(y,n),k=k.substring(0,y)+"\x3ca href\x3d'"+f+"' target\x3d'_blank'\x3e"+f+"\x3c/a\x3e"+k.substring(n,k.length)):k=this.sanitizer.sanitize(k)}return this.isValueEmpty(k)?"":k},isNumericFieldType:function(k){return-1!==P.indexOf(this.numericFieldTypes,k)},
isIntegerFieldType:function(k){return"esriFieldTypeInteger"===k||"esriFieldTypeSmallInteger"===k},isFloatFieldType:function(k){return"esriFieldTypeDouble"===k||"esriFieldTypeSingle"===k},getDomainValueFromRow:function(k){var n=k.fieldInfo.name,f=k.fieldInfo.domain,y=k.row;if("range"===f.type)return y[n];k=P.filter(f.codedValues,function(I){return I.hasOwnProperty("code")&&I.code==y[n]});return k[0]&&!this.isValueEmpty(k[0].name)?k[0].name:y[n]},getTypeValueFromRow:function(k){var n=k.layerInfo[k.typesProperty],
f=k.typeIdProperty,y=k.fieldInfo,I=k.row;k=n&&n[0];if(k){var C=I[y.name];y=this.isNumericFieldType(y.type);y=(k="string"===typeof k[f])&&y?C.toString():C;C=(C=this.findFirst(n,f,y))?C.name:null}return C},getSubtypeDomainValue:function(k){var n=k.layerInfo,f=k.fieldInfo.name,y=k.row,I;k=(n=this.findFirst(n.types,"id",y[n.typeIdField]))?n.domains:null;if(!n||!k)return y[f];k[f]&&k[f].codedValues&&(I=P.filter(k[f].codedValues,function(C){return C.hasOwnProperty("code")&&C.code==y[f]}));return I&&I[0]&&
!this.isValueEmpty(I[0].name)?I[0].name:y[f]},mergeDictionaries:function(k,n){if(null===k||null===n)return k;for(var f in n){k[f]||(k[f]={});for(var y in n[f])k[f][y]=n[f][y]}return k},isCyclicalRelationship:function(k){return"esriRelCardinalityOneToOne"===k.cardinality||"esriRelCardinalityOneToMany"===k.cardinality&&"esriRelRoleDestination"===k.role},getColumnFromFieldName:function(k){return this.findFirst(k.grid.columns,"field",k.fieldName)},isDateFieldWithStringDataValue:function(k){return"esriFieldTypeDateOnly"===
k||"esriFieldTypeTimeOnly"===k||"esriFieldTypeTimestampOffset"===k},formatNumberForLocale:function(k,n){if(n){var f=G.getLocalization("dojo.cldr","number");if(n.digitSeparator||!f||this.isValueEmpty(k))return isNaN(k)||null===k?null:V.format(k,n);k=isNaN(k)||null===k?null:V.format(k,n);return k.replace(new RegExp("\\"+f.group,"g"),"")}return isNaN(k)||null===k?null:K.format(k,n)},getCombinedDateTime:function(k,n){return new Date(k.getFullYear(),k.getMonth(),k.getDate(),n.getHours(),n.getMinutes(),
n.getSeconds())},formatDateForLocale:function(k){var n=k.dateOptions||{},f=k.timestamp,y=k.fieldInfo,I=!1,C=!1;k={};n=(I=y&&y.dateOptions?y.dateOptions:!1)||n;I=I&&this.isValueEmpty(n.dateEnabled)?!0:!!n.dateEnabled;C=!!n.timeEnabled;this.isValueEmpty(n.datePattern)||(k.datePattern=n.datePattern);this.isValueEmpty(n.timeEnabled)||this.isValueEmpty(n.timePattern)||(k.timePattern=n.timePattern);k.selector=I&&C?"date and time":I&&!C?"date":!I&&C?"time":"date";return z.format(new Date(f),k)},calculateExtentFromFeatures:function(k){var n=
k[0].geometry,f;if(null===n&&1===k.length)return null;for(n=k.length-1;0<=n;n--)null===k[n].geometry&&k.splice(n,1);n=k[0].geometry;var y=n.getExtent();var I=k.length;null===y&&(y=new e(n.x,n.y,n.x,n.y,n.spatialReference));for(f=1;f<I;f++){n=k[f].geometry;var C=n.getExtent();null===C&&(C=new e(n.x,n.y,n.x,n.y,n.spatialReference));y=y.union(C)}return y},initFeatureLayer:function(k,n){k=k._url.path;k=k.substring(0,k.lastIndexOf("/")+1);return new m(k+n,{mode:m.MODE_ONDEMAND,outFields:["*"],visible:!0})},
applyEdits:function(k){var n=[],f=new Q;if(!k||0>=k.length)return f.reject(),f;P.forEach(k,function(y){y.layer&&n.push(y.layer.applyEdits(y.adds,y.updates,y.deletes,function(I,C,N){f.resolve({adds:I,updates:C,deletes:N})},function(I){f.reject(I)}))});0<n.length?r(n):f.reject();return f},applyEditsFromRow:function(k){var n=k.layer,f=new x;f.setAttributes(k.row);return this.applyEdits([{layer:n,updates:[f]}],null)},queryLayer:function(k){var n=k.layer;k=k.ids||null;var f=new d;f.where="1\x3d1";f.returnGeometry=
!1;f.objectIds=k;return n.queryFeatures(f)},queryLayerForFeature:function(k){return this.queryLayerForFeatures({layer:k.layer,ids:[k.id]})},queryLayerForFeatures:function(k){var n=k.layer,f=n.advancedQueryCapabilities;f=f&&f.supportsQueryWithCacheHint;k=k.ids;var y=new d;y.objectIds=k;y.outFields=["*"];f&&(y.cacheHint=!0);return n.queryFeatures(y,function(I){return I.features})},queryLayerForCount:function(k){var n=k.layer,f=n.advancedQueryCapabilities;f=f&&f.supportsQueryWithCacheHint;if(n.queryCount){var y=
new d,I=k.layerInfo;k=k.where||"1\x3d1";y.returnGeometry=!1;y.returnCountOnly=!0;y.where=k;f&&(y.cacheHint=!0);return n.queryCount(y).then(function(C){return C}).otherwise(function(){return I.isFeatureCollection?n.graphics.length:2E3}).always(function(C){return C})}return this.queryLayerCustom({layer:n,returnCountOnly:!0,cacheHint:f}).then(function(C){return C&&C.features?C.features.length:0}).otherwise(function(){return n.maxRecordCount||2E3}).always(function(C){return C})},queryLayerCustom:function(k){var n=
new d,f=k.returnCountOnly||!1,y=k.where||"1\x3d1",I=k.returnGeometry||!1,C=k.outFields||["*"],N=k.cacheHint||!1;k=new E(k.layer.url);n.returnGeometry=I;n.outFields=C;n.where=y;n.returnCountOnly=f;N&&(n.cacheHint=!0);return k.execute(n)},queryLayerForIds:function(k){var n=k.layer,f=n.advancedQueryCapabilities;f=f&&f.supportsQueryWithCacheHint;var y=k.idProperty;k=k.where||"1\x3d1";var I=new d;I.returnGeometry=!1;I.outFields=[y];I.where=k;I.returnIdsOnly=!0;f&&(I.cacheHint=!0);return n.queryIds(I)},
queryLayerForAttachments:function(k){return c({url:k.layer._url.path+"/queryAttachments",content:{f:"json",objectIds:k.ids},handleAs:"json",callbackParamName:"callback"})},queryLayerForAttachmentById:function(k){return k.layer.queryAttachmentInfos(k.id||0)},addAttachmentToLayer:function(k){return k.layer.addAttachment(k.featureId,k.formData)},deleteAttachmentFromLayer:function(k){return k.layer.deleteAttachments(k.featureId,[k.attachmentId])},queryLayerForRelatedRecords:function(k){var n=k.layer,
f=k.ids,y=k.outFields||["*"],I=k.relationship;k=k.returnCountOnly||!1;var C=new F;C.outFields=y;C.returnGeometry=!1;C.relationshipId=I.id;C.returnCountOnly=k;C.objectIds=f;return n.queryRelatedFeatures(C)},queryLayerForRelatedRecordCount:function(k){return c({url:k.layer._url.path+"/queryRelatedRecords",content:{f:"json",objectIds:k.objectIds.toString(),outFields:k.outFields,returnGeometry:!1,relationshipId:k.relationship.id,returnCountOnly:!0},handleAs:"json",callbackParamName:"callback"})},getFieldStatistics:function(k){var n=
new Q,f=k.layer,y=f.advancedQueryCapabilities;y=y&&y.supportsQueryWithCacheHint;var I=k.idProperty,C=k.where||"1\x3d1",N=k.filterIds,R=k.grid.columns[k.columnId].field;k=f.url;var a=[];var v=P.map(this.statisticDefinitions,function(l){var h=new g;h.onStatisticField=R;h.displayFieldName=R;h.outStatisticFieldName=l.name;h.statisticType=l.type;return h});var H=new d;H.outFields=[R];H.outStatistics=[];H.where=C;H.outStatistics=v;y&&(H.cacheHint=!0);N&&0<N.length&&(a=N);H.where&&0<a.length&&(H.where="("+
H.where+") AND ("+I+" IN ("+a.toString()+"))");f.source&&!this.isValueEmpty(f.source.mapLayerId)&&k.endsWith("/dynamicLayer")&&(k=k.slice(0,-13),k=k+"/"+f.source.mapLayerId);(new E(k)).execute(H).then(function(l){n.resolve(l)}).otherwise(function(){n.reject()});return n},selectFeaturesById:function(k){var n=k.grid,f=n.layer;n=n.layerInfo;var y=k.map,I=k.ids;k=k.id;var C=new d;C.returnGeometry=!!y;C.objectIds=I||[k];n.isFeatureCollection||(C.where="1\x3d1");return f.selectFeatures(C,m.SELECTION_NEW)},
isFeatureEditable:function(k){var n=k.layerInfo;return!!k.layer.getEditCapabilities({userId:n.userIds[n.layerId]||null,feature:{attributes:k.attributes}}).canUpdate},isExpressionField:function(k){return this._reExprField.test(k)},getExpressionInfo:function(k,n){if(this.isExpressionField(n)){var f;n=n.replace(this._reExprField,"");n=n.toLowerCase();P.some(k,function(y){y.name.toLowerCase()===n&&(f=y);return!!f});return f}},compileExpressions:function(k){var n={};P.forEach(k,function(f){var y=f.returnType&&
f.returnType.toLowerCase();n[f.name]=new b({expression:f.expression,returnType:"number"===y?"number":"string",profile:q})});return n},getExpressionValue:function(k,n){var f=k.getLayer(),y=f&&f.getMap();return n?k.evaluateExpression(n,q.getEvalOptions({expression:n,feature:k,layer:f,map:y,spatialReference:y&&y.spatialReference})):null}}})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k,n,f){function y(C){return new F({command:C.name})}function I(C){return new F({buttonClass:E,command:C.name})}Q=Q("dijit.Editor",n,{plugins:null,extraPlugins:null,constructor:function(){K.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",G]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(c("ie")||c("trident")||c("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new V;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);K.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=L.getLocalization("dijit._editor",
"commands",this.lang);c("webkit")&&w.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new e({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));J.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);r.add(this.iframe.parentNode,"dijitEditorIFrameContainer");r.add(this.iframe,"dijitEditorIFrame");z.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){J.forEach(this._plugins,function(C){C&&C.destroy&&C.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(C,N){var R=K.isString(C)?{name:C}:K.isFunction(C)?{ctor:C}:C;if(!R.setEditor){var a={args:R,plugin:null,editor:this};R.name&&(F.registry[R.name]?a.plugin=F.registry[R.name](R):q.publish(f._scopeName+".Editor.getPlugin",a));if(!a.plugin)try{var v=
R.ctor||K.getObject(R.name)||P(R.name);v&&(a.plugin=new v(R))}catch(H){throw Error(this.id+": cannot find plugin ["+R.name+"]");}if(!a.plugin)throw Error(this.id+": cannot find plugin ["+R.name+"]");C=a.plugin}1<arguments.length?this._plugins[N]=C:this._plugins.push(C);C.setEditor(this);K.isFunction(C.setToolbar)&&C.setToolbar(this.toolbar)},resize:function(C){C&&g.prototype.resize.apply(this,arguments)},layout:function(){var C=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+u.getPadBorderExtents(this.iframe.parentNode).h+
u.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=C+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(C){var N,R=this.document.body,a=R.clientWidth,v=R.clientHeight,H=R.clientLeft,l=R.offsetWidth,h=R.offsetHeight,A=R.offsetLeft;/^rtl$/i.test(R.dir||"")?a<l&&C.x>a&&C.x<l&&(N=!0):C.x<H&&C.x>A&&(N=!0);N||v<h&&C.y>v&&C.y<h&&(N=!0);N||(delete this._cursorToStart,delete this._savedSelection,"BODY"==C.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(C){this.customUndo&&this.endEditing(!0);"BODY"!=C.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(C){this._inEditing||(this._inEditing=!0,this._beginEditing(C));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(C){if(!this.customUndo||
"undo"!=C&&"redo"!=C){this.customUndo&&(this.endEditing(),this._beginEditing());var N=this.inherited(arguments);this.customUndo&&this._endEditing();return N}return this[C]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(C){try{var N=this.document.execCommand(C,!1,null);if(c("webkit")&&!N)throw{};}catch(R){N=b.substitute,alert(N(this.commands.systemShortcut,
[this.commands[C],N(this.commands[c("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[C]])])),N=!1}return N},queryCommandEnabled:function(C){return!this.customUndo||"undo"!=C&&"redo"!=C?this.inherited(arguments):"undo"==C?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(C){var N=C.mark,R=C.mark;C=C.isCollapsed;var a;if(R)if(9>c("ie")||9===c("ie")&&c("quirks"))if(K.isArray(R))N=[],J.forEach(R,function(l){N.push(k.getNode(l,this.editNode))},this),this.selection.moveToBookmark({mark:N,
isCollapsed:C});else{if(R.startContainer&&R.endContainer&&(a=k.getSelection(this.window))&&a.removeAllRanges){a.removeAllRanges();C=k.create(this.window);var v=k.getNode(R.startContainer,this.editNode);var H=k.getNode(R.endContainer,this.editNode);v&&H&&(C.setStart(v,R.startOffset),C.setEnd(H,R.endOffset),a.addRange(C))}}else(a=k.getSelection(this.window))&&a.removeAllRanges&&(a.removeAllRanges(),C=k.create(this.window),v=k.getNode(R.startContainer,this.editNode),H=k.getNode(R.endContainer,this.editNode),
v&&H&&(C.setStart(v,R.startOffset),C.setEnd(H,R.endOffset),a.addRange(C)))},_changeToStep:function(C,N){this.setValue(N.text);(C=N.bookmark)&&this._moveToBookmark(C)},undo:function(){var C=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var N=this._steps.pop();N&&0<this._steps.length&&(this.focus(),this._changeToStep(N,this._steps[this._steps.length-1]),this._undoedSteps.push(N),this.onDisplayChanged(),delete this._undoRedoActive,C=!0);delete this._undoRedoActive}return C},
redo:function(){var C=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var N=this._undoedSteps.pop();N&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],N),this._steps.push(N),this.onDisplayChanged(),C=!0);delete this._undoRedoActive}return C},endEditing:function(C){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(C),this._inEditing=!1)},_getBookmark:function(){var C=this.selection.getBookmark(),
N=[];if(C&&C.mark){var R=C.mark;if(9>c("ie")||9===c("ie")&&c("quirks")){var a=k.getSelection(this.window);if(K.isArray(R))J.forEach(C.mark,function(H){N.push(k.getIndex(H,this.editNode).o)},this),C.mark=N;else if(a){var v;a.rangeCount&&(v=a.getRangeAt(0));C.mark=v?v.cloneRange():this.selection.getBookmark()}}try{C.mark&&C.mark.startContainer&&(N=k.getIndex(C.mark.startContainer,this.editNode).o,C.mark={startContainer:N,startOffset:C.mark.startOffset,endContainer:C.mark.endContainer===C.mark.startContainer?
N:k.getIndex(C.mark.endContainer,this.editNode).o,endOffset:C.mark.endOffset})}catch(H){C.mark=null}}return C},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:D.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var C=D.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:C,bookmark:this._getBookmark()})},onKeyDown:function(C){c("ie")||this.iframe||C.keyCode!=x.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var N=
C.keyCode;if(C.ctrlKey&&!C.shiftKey&&!C.altKey){if(90==N||122==N){C.stopPropagation();C.preventDefault();this.undo();return}if(89==N||121==N){C.stopPropagation();C.preventDefault();this.redo();return}}this.inherited(arguments);switch(N){case x.ENTER:case x.BACKSPACE:case x.DELETE:this.beginEditing();break;case 88:case 86:if(C.ctrlKey&&!C.altKey&&!C.metaKey){this.endEditing();88==C.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!C.ctrlKey&&!C.altKey&&
!C.metaKey&&(C.keyCode<x.F1||C.keyCode>x.F15)){this.beginEditing();break}case x.ALT:this.endEditing();break;case x.UP_ARROW:case x.DOWN_ARROW:case x.LEFT_ARROW:case x.RIGHT_ARROW:case x.HOME:case x.END:case x.PAGE_UP:case x.PAGE_DOWN:this.endEditing(!0);case x.CTRL:case x.SHIFT:case x.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(C){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(C){this.customUndo?this.isClosed?this.setValue(C):(this.beginEditing(),C||(C="\x26#160;"),this.setValue(C),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(C){this.setValueDeferred.then(K.hitch(this,function(){!this.disabled&&C||!this._buttonEnabledPlugins&&C?
J.forEach(this._plugins,function(N){N.set("disabled",!0)}):this.disabled&&!C&&J.forEach(this._plugins,function(N){N.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(w.set(this.document.body,"color",w.get(this.iframe,"color")),w.set(this.document.body,"background-color",w.get(this.iframe,"background-color")))}catch(C){}}});K.mixin(F.registry,{undo:y,redo:y,cut:y,copy:y,paste:y,insertOrderedList:y,insertUnorderedList:y,
indent:y,outdent:y,justifyCenter:y,justifyFull:y,justifyLeft:y,justifyRight:y,"delete":y,selectAll:y,removeFormat:y,unlink:y,insertHorizontalRule:y,bold:I,italic:I,underline:I,strikethrough:I,subscript:I,superscript:I,"|":function(){return new F({setEditor:function(C){this.editor=C;this.button=new d({ownerDocument:C.ownerDocument})}})}});return Q})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(P,J,Q,V,L,z,r,u){Q("dijit-legacy-requires")&&L(0,function(){P(["dijit/ToolbarSeparator"])});return J("dijit.Toolbar",[z,u,r],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(P,J,Q,V){return P("dijit.ToolbarSeparator",[Q,V],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);J.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(P,J,Q,V,L){J=J("dijit._editor._Plugin",V,{constructor:function(z){this.params=
z||{};Q.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:L,disabled:!1,getLabel:function(z){return this.editor.commands[z]},_initButton:function(){if(this.command.length){var z=this.getLabel(this.command),r=this.editor,u=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(z=Q.mixin({label:z,ownerDocument:r.ownerDocument,dir:r.dir,
lang:r.lang,showLabel:!1,iconClass:u,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete z.name,this.button=new this.buttonClass(z))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(z,r,u){this.own(P.connect(z,r,this,u))},updateState:function(){var z=this.editor,r=this.command;if(z&&z.isLoaded&&r.length){var u=this.get("disabled");if(this.button)try{var w=
z._implCommand(r);var x=!u&&(this[w]?this[w](r):z.queryCommandEnabled(r));this.enabled!==x&&(this.enabled=x,this.button.set("disabled",!x));if(x&&"boolean"==typeof this.button.checked){var K=z.queryCommandState(r);this.checked!==K&&(this.checked=K,this.button.set("checked",z.queryCommandState(r)))}}catch(c){console.log(c)}}},setEditor:function(z){this.editor=z;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",Q.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",Q.hitch(this,"updateState")))},setToolbar:function(z){this.button&&z.addChild(this.button)},set:function(z,r){if("object"===typeof z){for(var u in z)this.set(u,z[u]);return this}u=this._getAttrNames(z);if(this[u.s])var w=this[u.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(z,r);return w||this},get:function(z){var r=this._getAttrNames(z);
return this[r.g]?this[r.g]():this[z]},_setDisabledAttr:function(z){this._set("disabled",z);this.updateState()},_getAttrNames:function(z){var r=this._attrPairNames;if(r[z])return r[z];var u=z.charAt(0).toUpperCase()+z.substr(1);return r[z]={s:"_set"+u+"Attr",g:"_get"+u+"Attr"}},_set:function(z,r){this[z]=r}});J.registry={};return J})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K){return P("dijit._editor.plugins.EnterKeyHandling",w,{blockNodeForEnter:"BR",constructor:function(c){c&&("blockNodeForEnter"in c&&(c.blockNodeForEnter=c.blockNodeForEnter.toUpperCase()),V.mixin(this,c))},setEditor:function(c){if(this.editor!==c)if(this.editor=c,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,c.onLoadDeferred.then(V.hitch(this,function(q){this.own(L(c.document,"keydown",V.hitch(this,function(m){if(m.keyCode==Q.ENTER){var e=V.mixin({},m);e.shiftKey=
!0;this.handleEnterKey(e)||(m.stopPropagation(),m.preventDefault())}})));9<=z("ie")&&10>=z("ie")&&this.own(L(c.document,"paste",V.hitch(this,function(m){setTimeout(V.hitch(this,function(){var e=this.editor.document.selection.createRange();e.move("character",-1);e.select();e.move("character",1);e.select()}),0)})));return q}));else if(this.blockNodeForEnter){var b=V.hitch(this,"handleEnterKey");c.addKeyHandler(13,0,0,b);c.addKeyHandler(13,0,1,b);this.own(this.editor.on("KeyPressed",V.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var c=this.editor.selection.getAncestorElement("LI");if(c){z("mozilla")&&"LI"==c.parentNode.parentNode.nodeName&&(c=c.parentNode.parentNode);var b=c.firstChild;!b||1!=b.nodeType||"UL"!=b.nodeName&&"OL"!=b.nodeName||(c.insertBefore(b.ownerDocument.createTextNode("\u00a0"),b),b=K.create(this.editor.window),b.setStart(c.firstChild,0),c=K.getSelection(this.editor.window,!0),c.removeAllRanges(),c.addRange(b))}else x.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(c=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(c.innerHTML=this.bogusHtmlContent,9>=z("ie")&&(c=this.editor.document.selection.createRange(),c.move("character",-1),c.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(c){var b,q=this.editor.document,m;if(c.shiftKey){c=this.editor.selection.getParentElement();if(b=K.getAncestor(c,this.blockNodes)){if("LI"==b.tagName)return!0;c=K.getSelection(this.editor.window);var e=c.getRangeAt(0);e.collapsed||(e.deleteContents(),c=K.getSelection(this.editor.window),e=c.getRangeAt(0));if(K.atBeginningOfContainer(b,e.startContainer,e.startOffset)){var d=q.createElement("br");e=K.create(this.editor.window);b.insertBefore(d,
b.firstChild);e.setStartAfter(d);c.removeAllRanges();c.addRange(e)}else if(K.atEndOfContainer(b,e.startContainer,e.startOffset))e=K.create(this.editor.window),d=q.createElement("br"),b.appendChild(d),b.appendChild(q.createTextNode("\u00a0")),e.setStart(b.lastChild,0),c.removeAllRanges(),c.addRange(e);else{if((m=e.startContainer)&&3==m.nodeType){var g=m.nodeValue;var E=q.createTextNode(g.substring(0,e.startOffset));var F=q.createTextNode(g.substring(e.startOffset));b=q.createElement("br");""==F.nodeValue&&
z("webkit")&&(F=q.createTextNode("\u00a0"));J.place(E,m,"after");J.place(b,E,"after");J.place(F,b,"after");J.destroy(m);e=K.create(this.editor.window);e.setStart(F,0);c.removeAllRanges();c.addRange(e);return!1}return!0}}else c=K.getSelection(this.editor.window),c.rangeCount?(e=c.getRangeAt(0))&&e.startContainer&&(e.collapsed||(e.deleteContents(),c=K.getSelection(this.editor.window),e=c.getRangeAt(0)),(m=e.startContainer)&&3==m.nodeType?(b=e.startOffset,m.length<b&&(F=this._adjustNodeAndOffset(m,b),
m=F.node,b=F.offset),g=m.nodeValue,E=q.createTextNode(g.substring(0,b)),F=q.createTextNode(g.substring(b)),b=q.createElement("br"),F.length||(F=q.createTextNode("\u00a0")),E.length?J.place(E,m,"after"):E=m,J.place(b,E,"after"),J.place(F,b,"after"),J.destroy(m)):(0<=e.startOffset&&(d=m.childNodes[e.startOffset]),b=q.createElement("br"),F=q.createTextNode("\u00a0"),d?(J.place(b,d,"before"),J.place(F,b,"after")):(m.appendChild(b),m.appendChild(F))),e=K.create(this.editor.window),e.setStart(F,0),e.setEnd(F,
F.length),c.removeAllRanges(),c.addRange(e),this.editor.selection.collapse(!0)):x.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var G=!0;c=K.getSelection(this.editor.window);e=c.getRangeAt(0);e.collapsed||(e.deleteContents(),c=K.getSelection(this.editor.window),e=c.getRangeAt(0));d=K.getBlockAncestor(e.endContainer,null,this.editor.editNode);var D=d.blockNode;if(this._checkListLater=D&&("LI"==D.nodeName||"LI"==D.parentNode.nodeName))return z("mozilla")&&(this._pressedEnterInBlock=
D),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(D.innerHTML)&&(D.innerHTML="",z("webkit")&&(e=K.create(this.editor.window),e.setStart(D,0),c.removeAllRanges(),c.addRange(e)),this._checkListLater=!1),!0;if(!d.blockNode||d.blockNode===this.editor.editNode){try{x.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(k){}d={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(d.blockNode){if(d.blockNode!=this.editor.editNode&&!(d.blockNode.textContent||d.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(d.blockNode),!1}else d.blockNode=this.editor.editNode;c=K.getSelection(this.editor.window);e=c.getRangeAt(0)}D=q.createElement(this.blockNodeForEnter);D.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(d.blockNode);F=e.endOffset;G=e.endContainer;G.length<F&&(F=this._adjustNodeAndOffset(G,F),G=
F.node,F=F.offset);if(K.atEndOfContainer(d.blockNode,G,F))d.blockNode===d.blockContainer?d.blockNode.appendChild(D):J.place(D,d.blockNode,"after"),G=!1,e=K.create(this.editor.window),e.setStart(D,0),c.removeAllRanges(),c.addRange(e),this.editor.height&&u.scrollIntoView(D);else if(K.atBeginningOfContainer(d.blockNode,e.startContainer,e.startOffset))J.place(D,d.blockNode,d.blockNode===d.blockContainer?"first":"before"),D.nextSibling&&this.editor.height&&(e=K.create(this.editor.window),e.setStart(D.nextSibling,
0),c.removeAllRanges(),c.addRange(e),u.scrollIntoView(D.nextSibling)),G=!1;else{d.blockNode===d.blockContainer?d.blockNode.appendChild(D):J.place(D,d.blockNode,"after");G=!1;d.blockNode.style&&D.style&&d.blockNode.style.cssText&&(D.style.cssText=d.blockNode.style.cssText);if((m=e.startContainer)&&3==m.nodeType){F=e.endOffset;m.length<F&&(F=this._adjustNodeAndOffset(m,F),m=F.node,F=F.offset);g=m.nodeValue;E=q.createTextNode(g.substring(0,F));F=q.createTextNode(g.substring(F,g.length));J.place(E,m,
"before");J.place(F,m,"after");J.destroy(m);for(e=E.parentNode;e!==d.blockNode;){g=q.createElement(e.tagName);e.style&&g.style&&e.style.cssText&&(g.style.cssText=e.style.cssText);"FONT"===e.tagName&&(e.color&&(g.color=e.color),e.face&&(g.face=e.face),e.size&&(g.size=e.size));for(;F;)m=F.nextSibling,g.appendChild(F),F=m;J.place(g,e,"after");E=e;F=g;e=e.parentNode}if(1==F.nodeType||3==F.nodeType&&F.nodeValue)D.innerHTML="";for(E=F;F;)m=F.nextSibling,D.appendChild(F),F=m}e=K.create(this.editor.window);
q=E;if("BR"!==this.blockNodeForEnter){for(;q;)b=q,q=m=q.firstChild;b&&b.parentNode?(D=b.parentNode,e.setStart(D,0),c.removeAllRanges(),c.addRange(e),this.editor.height&&u.scrollIntoView(D),z("mozilla")&&(this._pressedEnterInBlock=d.blockNode)):G=!0}else e.setStart(D,0),c.removeAllRanges(),c.addRange(e),this.editor.height&&u.scrollIntoView(D),z("mozilla")&&(this._pressedEnterInBlock=d.blockNode)}return G},_adjustNodeAndOffset:function(c,b){for(;c.length<b&&c.nextSibling&&3==c.nextSibling.nodeType;)b-=
c.length,c=c.nextSibling;return{node:c,offset:b}},removeTrailingBr:function(c){if(c=/P|DIV|LI/i.test(c.tagName)?c:this.editor.selection.getParentOfType(c,["P","DIV","LI"]))c.lastChild&&(1<c.childNodes.length&&3==c.lastChild.nodeType&&/^[\s\xAD]*$/.test(c.lastChild.nodeValue)||"BR"==c.lastChild.tagName)&&J.destroy(c.lastChild),c.childNodes.length||(c.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k,n,f,y,I,C,N){var R=Q("dijit._editor.RichText",[k,n],{constructor:function(a){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};a&&b.isString(a.value)&&(this.value=a.value);this.onLoadDeferred=new V},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[b.trim,b.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);d("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));d("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(d("ie")||d("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[b.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[b.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);E.publish(N._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var a=b.hitch(this,function(l,h){return function(){return!this.execCommand(l,h)}}),v={b:a("bold"),i:a("italic"),u:a("underline"),a:a("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:a("formatblock",
"h1"),2:a("formatblock","h2"),3:a("formatblock","h3"),4:a("formatblock","h4"),"\\":a("insertunorderedlist")};d("ie")||(v.Z=a("redo"));for(var H in v)this.addKeyHandler(H,!0,!1,v[H])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(R._editorCommandsLocalized)this._local2NativeFormatNames=R._local2NativeFormatNames,this._native2LocalFormatNames=R._native2LocalFormatNames;else{R._editorCommandsLocalized=!0;R._local2NativeFormatNames={};
R._native2LocalFormatNames={};this._local2NativeFormatNames=R._local2NativeFormatNames;this._native2LocalFormatNames=R._native2LocalFormatNames;for(var a="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),v="",H,l=0;H=a[l++];)v="l"!==H.charAt(1)?v+("\x3c"+H+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+H+"\x3e\x3cbr/\x3e"):v+("\x3c"+H+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+H+"\x3e\x3cbr/\x3e");var h=u.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:v});this.ownerDocumentBody.appendChild(h);
a=b.hitch(this,function(){for(var A=h.firstChild;A;)try{this.selection.selectElement(A.firstChild);var O=A.tagName.toLowerCase();this._local2NativeFormatNames[O]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[O]]=O;A=A.nextSibling.nextSibling}catch(X){}u.destroy(h)});this.defer(a)}},open:function(a){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new V;this.isClosed||this.close();E.publish(N._scopeName+"._editor.RichText::open",
this);1===arguments.length&&a.nodeName&&(this.domNode=a);var v=this.domNode;if(b.isString(this.value)){var H=this.value;v.innerHTML=""}else if(v.nodeName&&"textarea"==v.nodeName.toLowerCase()){var l=this.textarea=v;this.name=l.name;H=l.value;v=this.domNode=this.ownerDocument.createElement("div");v.setAttribute("widgetId",this.id);l.removeAttribute("widgetId");v.cssText=l.cssText;v.className+=" "+l.className;u.place(v,l,"before");var h=b.hitch(this,function(){x.set(l,{display:"block",position:"absolute",
top:"-1000px"});if(d("ie")){var W=l.style;this.__overflow=W.overflow;W.overflow="hidden"}});d("ie")?this.defer(h,10):h();if(l.form){var A=l.value;this.reset=function(){this.getValue()!==A&&this.replaceValue(A)};q(l.form,"submit",b.hitch(this,function(){z.set(l,"disabled",this.disabled);l.value=this.getValue()}))}}else H=I.getChildrenHtml(v),v.innerHTML="";this.value=H;v.nodeName&&"LI"===v.nodeName&&(v.innerHTML=" \x3cbr\x3e");this.header=v.ownerDocument.createElement("div");v.appendChild(this.header);
this.editingArea=v.ownerDocument.createElement("div");v.appendChild(this.editingArea);this.footer=v.ownerDocument.createElement("div");v.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!J.useXDomain||J.allowXdRichTextSave)){if((H=L.byId(N._scopeName+"._editor.RichText.value"))&&""!==H.value){h=H.value.split(this._SEPARATOR);for(var O=0,X;X=h[O++];)if(X=X.split(this._NAME_CONTENT_SEP),X[0]===this.name){this.value=X[1];h=h.splice(O,1);H.value=h.join(this._SEPARATOR);
break}}R._globalSaveHandler||(R._globalSaveHandler={},F.addOnUnload(function(){for(var W in R._globalSaveHandler){var ba=R._globalSaveHandler[W];b.isFunction(ba)&&ba()}}));R._globalSaveHandler[this.id]=b.hitch(this,"_saveContent")}this.isClosed=!1;H=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");H.id=this.id+"_iframe";H.style.border="none";H.style.width="100%";this._layoutMode?H.style.height="100%":7<=d("ie")?(this.height&&(H.style.height=this.height),this.minHeight&&(H.style.minHeight=
this.minHeight)):H.style.height=this.height?this.height:this.minHeight;H.frameBorder=0;H._loadFunc=b.hitch(this,function(W){this.window=W;this.document=W.document;this.selection=new f.SelectionManager(W);d("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});h=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");h=11>d("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+h+"');document.close()":"javascript: '"+
h+"'";this.editingArea.appendChild(H);H.src=h;"LI"===v.nodeName&&(v.lastChild.style.marginTop="-1.2em");r.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var a=x.getComputedStyle(this.domNode);if(this["aria-label"])var v=this["aria-label"];else{var H=m('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||L.byId(this["aria-labelledby"],this.ownerDocument);H&&(v=H.textContent||H.innerHTML||"")}H="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(v?" aria-label\x3d'"+g.escape(v)+"'":"")+"\x3e\x3c/div\x3e";var l=[a.fontWeight,a.fontSize,a.fontFamily].join(" "),h=a.lineHeight;h=0<=h.indexOf("px")?parseFloat(h)/parseFloat(a.fontSize):0<=h.indexOf("em")?parseFloat(h):"normal";var A="",O=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(X){X=X.replace(/^;/ig,"")+";";var W=X.split(":")[0];if(W){W=b.trim(W);W=W.toLowerCase();var ba,ea="";for(ba=0;ba<W.length;ba++){var fa=W.charAt(ba);switch(fa){case "-":ba++,fa=W.charAt(ba).toUpperCase();
default:ea+=fa}}x.set(O.domNode,ea,"")}A+=X+";"});this.iframe.setAttribute("title",v);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||K.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",v?"\x3ctitle\x3e"+g.escape(v)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",l,";\n",this.height||d("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",h,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",d("ie")||d("trident")||d("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",v?" aria-label\x3d'"+g.escape(v)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+A+"'\x3e",H,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var a=[];this.styleSheets&&(a=this.styleSheets.split(";"),this.styleSheets=
"");a=a.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var v="",H=0,l,h=D.get(this.ownerDocument);l=a[H++];)l=(new G(h.location,l)).toString(),this.editingAreaStyleSheets.push(l),v+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+l+'"/\x3e';return v},addStyleSheet:function(a){var v=a.toString(),H=D.get(this.ownerDocument);if("."===v.charAt(0)||"/"!==v.charAt(0)&&!a.host)v=(new G(H.location,v)).toString();-1<P.indexOf(this.editingAreaStyleSheets,v)||(this.editingAreaStyleSheets.push(v),
this.onLoadDeferred.then(b.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(v);else{var l=this.document.getElementsByTagName("head")[0],h=this.document.createElement("link");h.rel="stylesheet";h.type="text/css";h.href=v;l.appendChild(h)}})))},removeStyleSheet:function(a){var v=a.toString(),H=D.get(this.ownerDocument);if("."===v.charAt(0)||"/"!==v.charAt(0)&&!a.host)v=(new G(H.location,v)).toString();a=P.indexOf(this.editingAreaStyleSheets,v);-1!==a&&(delete this.editingAreaStyleSheets[a],
m('link[href\x3d"'+v+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(a){a=!!a;this._set("disabled",a);if(this.isLoaded){var v=d("ie")&&(this.isLoaded||!this.focusOnLoad);v&&(this.editNode.unselectable="on");this.editNode.contentEditable=!a;this.editNode.tabIndex=a?"-1":this.tabIndex;v&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(d("mozilla")&&!a&&this._mozSettingProps){a=this._mozSettingProps;for(var H in a)if(a.hasOwnProperty(H))try{this.document.execCommand(H,
!1,a[H])}catch(l){}}this._disabledOK=!0}},onLoad:function(a){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=C.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var v=this;this.beforeIframeNode=u.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=u.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){v.editNode.focus()};this.focusNode=
this.editNode;var H=this.events.concat(this.captureEvents),l=this.iframe?this.document:this.editNode;this.own.apply(this,P.map(H,function(h){var A=h.toLowerCase().replace(/^on/,"");return q(l,A,b.hitch(this,h))},this));this.own(q(l,"mouseup",b.hitch(this,"onClick")));d("ie")&&(this.own(q(this.document,"mousedown",b.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);d("webkit")&&(this._webkitListener=this.own(q(this.document,"mouseup",b.hitch(this,"onDisplayChanged")))[0],this.own(q(this.document,
"mousedown",b.hitch(this,function(h){h=h.target;!h||h!==this.document.body&&h!==this.document||this.defer("placeCursorAtEnd")}))));if(d("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(h){}this.isLoaded=!0;this.set("disabled",this.disabled);H=b.hitch(this,function(){this.setValue(a);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&e(b.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(H):H()},onKeyDown:function(a){if(a.keyCode===c.SHIFT||a.keyCode===c.ALT||a.keyCode===c.META||a.keyCode===c.CTRL)return!0;a.keyCode===c.TAB&&this.isTabIndent&&(a.stopPropagation(),a.preventDefault(),this.queryCommandEnabled(a.shiftKey?"outdent":"indent")&&this.execCommand(a.shiftKey?"outdent":"indent"));if(a.keyCode==c.TAB&&!this.isTabIndent&&!a.ctrlKey&&!a.altKey)return a.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>d("ie")&&a.keyCode===c.BACKSPACE&&"Control"===this.document.selection.type&&(a.stopPropagation(),a.preventDefault(),this.execCommand("delete"));d("ff")&&(a.keyCode===c.PAGE_UP||a.keyCode===c.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&a.preventDefault();var v=this._keyHandlers[a.keyCode],H=arguments;v&&!a.altKey&&P.some(v,function(l){if(!(l.shift^a.shiftKey||l.ctrl^(a.ctrlKey||a.metaKey)))return l.handler.apply(this,H)||a.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(a){K.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",a)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(a){this.document?z.set(this.document.body,"spellcheck",!a):this.onLoadDeferred.then(b.hitch(this,function(){z.set(this.document.body,"spellcheck",!a)}));this._set("disableSpellCheck",a)},addKeyHandler:function(a,v,H,l){"string"==
typeof a&&(a=a.toUpperCase().charCodeAt(0));b.isArray(this._keyHandlers[a])||(this._keyHandlers[a]=[]);this._keyHandlers[a].push({shift:H||!1,ctrl:v||!1,handler:l})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(a){(d("ie")||d("trident"))&&this.defer(function(){C.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var v=this.getValue(!0);if(v!==this.value)this.onChange(v);
this._set("value",v)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!d("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>d("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(a,v){a=a.toLowerCase();"formatblock"===a?d("safari")&&void 0===v&&(a="heading"):"hilitecolor"!==a||d("mozilla")||(a="backcolor");return a},_implCommand:function(a){return"_"+this._normalizeCommand(a)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(a){var v=this._qcaCache[a];return void 0!==v?v:this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(a){switch(a.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return d("ie")||d("trident")||d("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!d("webkit");default:return!1}},execCommand:function(a,v){this.focused&&this.focus();a=this._normalizeCommand(a,v);if(void 0!==v){if("heading"===a)throw Error("unimplemented");"formatblock"===
a&&(d("ie")||d("trident"))&&(v="\x3c"+v+"\x3e")}var H="_"+a+"Impl";if(this[H])var l=this[H](v);else if((v=1<arguments.length?v:null)||"createlink"!==a)l=this.document.execCommand(a,!1,v);this.onDisplayChanged();return l},queryCommandEnabled:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);var v=this._implCommand(a);return this[v]?this[v](a):this._browserQueryCommandEnabled(a)},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);
try{return this.document.queryCommandState(a)}catch(v){return!1}},queryCommandValue:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);if(d("ie")&&"formatblock"===a)a=this._native2LocalFormatNames[this.document.queryCommandValue(a)];else if(d("mozilla")&&"hilitecolor"===a){try{var v=this.document.queryCommandValue("styleWithCSS")}catch(H){v=!1}this.document.execCommand("styleWithCSS",!1,!0);a=this.document.queryCommandValue(a);this.document.execCommand("styleWithCSS",
!1,v)}else a=this.document.queryCommandValue(a);return a},_sCall:function(a,v){return this.selection[a].apply(this.selection,v)},placeCursorAtStart:function(){this.focus();var a=!1;if(d("mozilla"))for(var v=this.editNode.firstChild;v;){if(3===v.nodeType){if(0<v.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(v);break}}else if(1===v.nodeType){a=!0;var H=v.tagName?v.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(H)?this.selection.selectElement(v):
this.selection.selectElementChildren(v);break}v=v.nextSibling}else a=!0,this.selection.selectElementChildren(this.editNode);a&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var a=!1;if(d("mozilla"))for(var v=this.editNode.lastChild;v;){if(3===v.nodeType){if(0<v.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(v);break}}else if(1===v.nodeType){a=!0;this.selection.selectElement(v.lastChild||v);break}v=v.previousSibling}else a=!0,this.selection.selectElementChildren(this.editNode);
a&&this.selection.collapse(!1)},getValue:function(a){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,a):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(a){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){a=this._preFilterContent(a);var v=this.isClosed?this.domNode:this.editNode;v.innerHTML=a;this._preDomFilterContent(v)}else this.textarea.value=a;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(b.hitch(this,function(){this.setValue(a)}))},replaceValue:function(a){this.isClosed?this.setValue(a):this.window&&this.window.getSelection&&!d("mozilla")?this.setValue(a):this.window&&this.window.getSelection?(a=this._preFilterContent(a),this.execCommand("selectall"),this.execCommand("inserthtml",a),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(a);this._set("value",this.getValue(!0))},_preFilterContent:function(a){var v=
a;P.forEach(this.contentPreFilters,function(H){H&&(v=H(v))});return v},_preDomFilterContent:function(a){a=a||this.editNode;P.forEach(this.contentDomPreFilters,function(v){v&&b.isFunction(v)&&v(a)},this)},_postFilterContent:function(a,v){if(b.isString(a))var H=a;else a=a||this.editNode,this.contentDomPostFilters.length&&(v&&(a=b.clone(a)),P.forEach(this.contentDomPostFilters,function(l){a=l(a)})),H=I.getChildrenHtml(a);b.trim(H.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(H="");P.forEach(this.contentPostFilters,
function(l){H=l(H)});return H},_saveContent:function(){var a=L.byId(N._scopeName+"._editor.RichText.value");a&&(a.value&&(a.value+=this._SEPARATOR),a.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(a,v){a=a.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");v||(a=a.replace(/'/gm,"\x26#39;"));return a},getNodeHtml:function(a){K.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return I.getNodeHtml(a)},getNodeChildrenHtml:function(a){K.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return I.getChildrenHtml(a)},close:function(a){if(!this.isClosed){arguments.length||(a=!0);a&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);d("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var v=this.textarea.style;v.position="";v.left=v.top="";d("ie")&&(v.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;u.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;r.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);R._globalSaveHandler&&delete R._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,"");a=a.replace(/\sclass="apple-style-span"/gi,
"");return a=a.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(a){if(!a)return!1;
var v=9>d("ie")?this.document.selection.createRange():this.document;try{return v.queryCommandEnabled(a)}catch(H){return!1}},_createlinkEnabledImpl:function(){var a=!0;return a=d("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var a=!0;return a=d("mozilla")||d("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var a=
!0;return a=d("mozilla")||d("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var a=!0;d("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("cut");return a},_copyEnabledImpl:function(){var a=!0;d("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("copy");return a},_pasteEnabledImpl:function(){var a=!0;return d("webkit")?!0:a=this._browserQueryCommandEnabled("paste")},
_inserthorizontalruleImpl:function(a){return d("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,a)},_unlinkImpl:function(a){return this.queryCommandEnabled("unlink")&&(d("mozilla")||d("webkit"))?(a=this.selection.getAncestorElement("a"),this.selection.selectElement(a),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",!1,a)},_hilitecolorImpl:function(a){if(!this._handleTextColorOrProperties("hilitecolor",a))if(d("mozilla")){this.document.execCommand("styleWithCSS",
!1,!0);console.log("Executing color command.");var v=this.document.execCommand("hilitecolor",!1,a);this.document.execCommand("styleWithCSS",!1,!1)}else v=this.document.execCommand("hilitecolor",!1,a);return v},_backcolorImpl:function(a){d("ie")&&(a=a?a:null);var v=this._handleTextColorOrProperties("backcolor",a);v||(v=this.document.execCommand("backcolor",!1,a));return v},_forecolorImpl:function(a){d("ie")&&(a=a?a:null);var v=!1;(v=this._handleTextColorOrProperties("forecolor",a))||(v=this.document.execCommand("forecolor",
!1,a));return v},_inserthtmlImpl:function(a){a=this._preFilterContent(a);var v=!0;if(9>d("ie")){var H=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var l=H.item(0);H.length;)H.remove(H.item(0));l.outerHTML=a}else H.pasteHTML(a);H.select()}else if(8>d("trident")){var h=y.getSelection(this.window);if(h&&h.rangeCount&&h.getRangeAt){H=h.getRangeAt(0);H.deleteContents();var A=u.create("div");A.innerHTML=a;for(l=this.document.createDocumentFragment();a=
A.firstChild;)var O=l.appendChild(a);H.insertNode(l);O&&(H=H.cloneRange(),H.setStartAfter(O),H.collapse(!1),h.removeAllRanges(),h.addRange(H))}}else d("mozilla")&&!a.length?this.selection.remove():v=this.document.execCommand("inserthtml",!1,a);return v},_boldImpl:function(a){var v=!1;if(d("ie")||d("trident"))this._adaptIESelection(),v=this._adaptIEFormatAreaAndExec("bold");v||(v=this.document.execCommand("bold",!1,a));return v},_italicImpl:function(a){var v=!1;if(d("ie")||d("trident"))this._adaptIESelection(),
v=this._adaptIEFormatAreaAndExec("italic");v||(v=this.document.execCommand("italic",!1,a));return v},_underlineImpl:function(a){var v=!1;if(d("ie")||d("trident"))this._adaptIESelection(),v=this._adaptIEFormatAreaAndExec("underline");v||(v=this.document.execCommand("underline",!1,a));return v},_strikethroughImpl:function(a){var v=!1;if(d("ie")||d("trident"))this._adaptIESelection(),v=this._adaptIEFormatAreaAndExec("strikethrough");v||(v=this.document.execCommand("strikethrough",!1,a));return v},_superscriptImpl:function(a){var v=
!1;if(d("ie")||d("trident"))this._adaptIESelection(),v=this._adaptIEFormatAreaAndExec("superscript");v||(v=this.document.execCommand("superscript",!1,a));return v},_subscriptImpl:function(a){var v=!1;if(d("ie")||d("trident"))this._adaptIESelection(),v=this._adaptIEFormatAreaAndExec("subscript");v||(v=this.document.execCommand("subscript",!1,a));return v},_fontnameImpl:function(a){if(d("ie")||d("trident"))var v=this._handleTextColorOrProperties("fontname",a);v||(v=this.document.execCommand("fontname",
!1,a));return v},_fontsizeImpl:function(a){if(d("ie")||d("trident"))var v=this._handleTextColorOrProperties("fontsize",a);v||(v=this.document.execCommand("fontsize",!1,a));return v},_insertorderedlistImpl:function(a){var v=!1;if(d("ie")||d("trident")||d("edge"))v=this._adaptIEList("insertorderedlist",a);v||(v=this.document.execCommand("insertorderedlist",!1,a));return v},_insertunorderedlistImpl:function(a){var v=!1;if(d("ie")||d("trident")||d("edge"))v=this._adaptIEList("insertunorderedlist",a);
v||(v=this.document.execCommand("insertunorderedlist",!1,a));return v},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(a){var v=0;if(a&&a.childNodes){var H;for(H=0;H<a.childNodes.length;H++){var l=w.position(a.childNodes[H]);v+=l.h}}return v},_isNodeEmpty:function(a,v){return 1===a.nodeType?0<a.childNodes.length?this._isNodeEmpty(a.childNodes[0],v):!0:3===a.nodeType?
""===a.nodeValue.substring(v):!1},_removeStartingRangeFromRange:function(a,v){if(a.nextSibling)v.setStart(a.nextSibling,0);else{for(a=a.parentNode;a&&null==a.nextSibling;)a=a.parentNode;a&&v.setStart(a.nextSibling,0)}return v},_adaptIESelection:function(){var a=y.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){for(var v=a.getRangeAt(0),H=v.startContainer,l=v.startOffset;3===H.nodeType&&l>=H.length&&H.nextSibling;)l-=H.length,H=H.nextSibling;for(var h=null;this._isNodeEmpty(H,l)&&H!==
h;)h=H,v=this._removeStartingRangeFromRange(H,v),H=v.startContainer,l=0;a.removeAllRanges();a.addRange(v)}},_adaptIEFormatAreaAndExec:function(a){var v=y.getSelection(this.window),H=this.document,l;if(a&&v&&v.isCollapsed){if(this.queryCommandValue(a)){a=this._tagNamesForCommand(a);var h=v.getRangeAt(0);var A=h.startContainer;if(3===A.nodeType){var O=h.endOffset;A.length<O&&(O=this._adjustNodeAndOffset(X,O),A=O.node,O=O.offset)}for(;A&&A!==this.editNode;){var X=A.tagName?A.tagName.toLowerCase():"";
if(-1<P.indexOf(a,X)){var W=A;break}A=A.parentNode}if(W&&(X=h.startContainer,a=H.createElement(W.tagName),u.place(a,W,"after"),X&&3===X.nodeType)){O=h.endOffset;X.length<O&&(O=this._adjustNodeAndOffset(X,O),X=O.node,O=O.offset);A=X.nodeValue;h=H.createTextNode(A.substring(0,O));var ba=A.substring(O,A.length);ba&&(l=H.createTextNode(ba));u.place(h,X,"before");if(l){var ea=H.createElement("span");ea.className="ieFormatBreakerSpan";u.place(ea,X,"after");u.place(l,ea,"after");l=ea}u.destroy(X);O=h.parentNode;
for(X=[];O!==W;){A=O.tagName;h={tagName:A};X.push(h);A=H.createElement(A);O.style&&A.style&&O.style.cssText&&(A.style.cssText=O.style.cssText,h.cssText=O.style.cssText);"FONT"===O.tagName&&(O.color&&(A.color=O.color,h.color=O.color),O.face&&(A.face=O.face,h.face=O.face),O.size&&(A.size=O.size,h.size=O.size));O.className&&(A.className=O.className,h.className=O.className);if(l)for(;l;)h=l.nextSibling,A.appendChild(l),l=h;A.tagName==O.tagName?(ea=H.createElement("span"),ea.className="ieFormatBreakerSpan",
u.place(ea,O,"after"),u.place(A,ea,"after")):u.place(A,O,"after");h=O;l=A;O=O.parentNode}if(l){if(1===l.nodeType||3===l.nodeType&&l.nodeValue)a.innerHTML="";for(;l;)h=l.nextSibling,a.appendChild(l),l=h}if(X.length){h=X.pop();l=H.createElement(h.tagName);h.cssText&&l.style&&(l.style.cssText=h.cssText);h.className&&(l.className=h.className);"FONT"===h.tagName&&(h.color&&(l.color=h.color),h.face&&(l.face=h.face),h.size&&(l.size=h.size));for(u.place(l,a,"before");X.length;)h=X.pop(),W=H.createElement(h.tagName),
h.cssText&&W.style&&(W.style.cssText=h.cssText),h.className&&(W.className=h.className),"FONT"===h.tagName&&(h.color&&(W.color=h.color),h.face&&(W.face=h.face),h.size&&(W.size=h.size)),l.appendChild(W),l=W;W=H.createTextNode(".");ea.appendChild(W);l.appendChild(W)}else ea=H.createElement("span"),ea.className="ieFormatBreakerSpan",W=H.createTextNode("."),ea.appendChild(W),u.place(ea,a,"before");l=y.create(this.window);l.setStart(W,0);l.setEnd(W,W.length);v.removeAllRanges();v.addRange(l);this.selection.collapse(!1);
W.parentNode.innerHTML="";a.firstChild||u.destroy(a);return!0}return!1}h=v.getRangeAt(0);if((X=h.startContainer)&&3===X.nodeType)return O=h.startOffset,X.length<O&&(O=this._adjustNodeAndOffset(X,O),X=O.node,O=O.offset),A=X.nodeValue,h=H.createTextNode(A.substring(0,O)),ba=A.substring(O),""!==ba&&(l=H.createTextNode(A.substring(O))),ea=H.createElement("span"),W=H.createTextNode("."),ea.appendChild(W),h.length?u.place(h,X,"after"):h=X,u.place(ea,h,"after"),l&&u.place(l,ea,"after"),u.destroy(X),l=y.create(this.window),
l.setStart(W,0),l.setEnd(W,W.length),v.removeAllRanges(),v.addRange(l),H.execCommand(a),u.place(ea.firstChild,ea,"before"),u.destroy(ea),l.setStart(W,0),l.setEnd(W,W.length),v.removeAllRanges(),v.addRange(l),this.selection.collapse(!1),W.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(a){var v=y.getSelection(this.window);if(v.isCollapsed&&v.rangeCount&&!this.queryCommandValue(a)){var H=v.getRangeAt(0),l=H.startContainer;if(l&&3==l.nodeType&&!H.startOffset)return H="ul","insertorderedlist"===
a&&(H="ol"),a=this.document.createElement(H),H=u.create("li",null,a),u.place(a,l,"before"),H.appendChild(l),u.create("br",null,a,"after"),a=y.create(this.window),a.setStart(l,0),a.setEnd(l,l.length),v.removeAllRanges(),v.addRange(a),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(a,v){var H=y.getSelection(this.window),l=this.document,h,A;v=v||null;if(a&&H&&H.isCollapsed&&H.rangeCount){var O=H.getRangeAt(0);if((h=O.startContainer)&&3===h.nodeType){var X=O.startOffset;
h.length<X&&(O=this._adjustNodeAndOffset(h,X),h=O.node,X=O.offset);var W=h.nodeValue;O=l.createTextNode(W.substring(0,X));""!==W.substring(X)&&(A=l.createTextNode(W.substring(X)));W=l.createElement("span");X=l.createTextNode(".");W.appendChild(X);l=l.createElement("span");W.appendChild(l);O.length?u.place(O,h,"after"):O=h;u.place(W,O,"after");A&&u.place(A,W,"after");u.destroy(h);h=y.create(this.window);h.setStart(X,0);h.setEnd(X,X.length);H.removeAllRanges();H.addRange(h);if(d("webkit")){H="color";
if("hilitecolor"===a||"backcolor"===a)H="backgroundColor";x.set(W,H,v);this.selection.remove();u.destroy(l);W.innerHTML="\x26#160;";this.selection.selectElement(W);this.focus()}else this.execCommand(a,v),u.place(W.firstChild,W,"before"),u.destroy(W),h.setStart(X,0),h.setEnd(X,X.length),H.removeAllRanges(),H.addRange(h),this.selection.collapse(!1),X.parentNode.removeChild(X);return!0}}return!1},_adjustNodeAndOffset:function(a,v){for(;a.length<v&&a.nextSibling&&3===a.nextSibling.nodeType;)v-=a.length,
a=a.nextSibling;return{node:a,offset:v}},_tagNamesForCommand:function(a){return"bold"===a?["b","strong"]:"italic"===a?["i","em"]:"strikethrough"===a?["s","strike"]:"superscript"===a?["sup"]:"subscript"===a?["sub"]:"underline"===a?["u"]:[]},_stripBreakerNodes:function(a){if(this.isLoaded)return m(".ieFormatBreakerSpan",a).forEach(function(v){for(;v.firstChild;)u.place(v.firstChild,v,"before");u.destroy(v)}),a},_stripTrailingEmptyNodes:function(a){function v(H){return/^(p|div|br)$/i.test(H.nodeName)&&
0==H.children.length&&/^[\s\xA0]*$/.test(H.textContent||H.innerText||"")||3===H.nodeType&&/^[\s\xA0]*$/.test(H.nodeValue)}for(;a.lastChild&&v(a.lastChild);)u.destroy(a.lastChild);return a},_setTextDirAttr:function(a){this._set("textDir",a);this.onLoadDeferred.then(b.hitch(this,function(){this.editNode.dir=a}))}});return R})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(P,J,Q){var V={getIndex:function(r,u){for(var w=[],x=[],K=r,c,b;r!=
u;){var q=0;for(c=r.parentNode;b=c.childNodes[q++];)if(b===r){--q;break}w.unshift(q);x.unshift(q-c.childNodes.length);r=c}if(0<w.length&&3==K.nodeType){for(b=K.previousSibling;b&&3==b.nodeType;)w[w.length-1]--,b=b.previousSibling;for(b=K.nextSibling;b&&3==b.nodeType;)x[x.length-1]++,b=b.nextSibling}return{o:w,r:x}},getNode:function(r,u){if(!Q.isArray(r)||0==r.length)return u;var w=u;P.every(r,function(x){if(0<=x&&x<w.childNodes.length)w=w.childNodes[x];else return w=null,!1;return!0});return w},getCommonAncestor:function(r,
u,w){w=w||r.ownerDocument.body;var x=function(b){for(var q=[];b;)if(q.unshift(b),b!==w)b=b.parentNode;else break;return q};r=x(r);u=x(u);x=Math.min(r.length,u.length);for(var K=r[0],c=1;c<x;c++)if(r[c]===u[c])K=r[c];else break;return K},getAncestor:function(r,u,w){for(w=w||r.ownerDocument.body;r&&r!==w;){var x=r.nodeName.toUpperCase();if(u.test(x))return r;r=r.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(r,u,w){w=w||r.ownerDocument.body;
u=u||V.BlockTagNames;for(var x=null,K;r&&r!==w;){var c=r.nodeName.toUpperCase();!x&&u.test(c)&&(x=r);!K&&/^(?:BODY|TD|TH|CAPTION)$/.test(c)&&(K=r);r=r.parentNode}return{blockNode:x,blockContainer:K||r.ownerDocument.body}},atBeginningOfContainer:function(r,u,w){var x=!1,K=0==w;K||3!=u.nodeType||/^[\s\xA0]+$/.test(u.nodeValue.substr(0,w))&&(K=!0);if(K)for(x=!0;u&&u!==r;){if(u.previousSibling){x=!1;break}u=u.parentNode}return x},atEndOfContainer:function(r,u,w){var x=!1,K=w==(u.length||u.childNodes.length);
K||3!=u.nodeType||/^[\s\xA0]+$/.test(u.nodeValue.substr(w))&&(K=!0);if(K)for(x=!0;u&&u!==r;){if(u.nextSibling){x=!1;break}u=u.parentNode}return x},adjacentNoneTextNode:function(r,u){var w=r;r=0-r.length||0;for(u=u?"nextSibling":"previousSibling";w&&3==w.nodeType;)r+=w.length,w=w[u];return[w,r]},create:function(r){r=r||window;return r.getSelection?r.document.createRange():new z},getSelection:function(r,u){if(r.getSelection)return r.getSelection();r=new L.selection(r);u||r._getCurrentSelection();return r}};
if(!window.getSelection)var L=V.ie={cachedSelection:{},selection:function(r){this._ranges=[];this.addRange=function(u,w){this._ranges.push(u);w||u._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(u){return this._ranges[u]};this._getCurrentSelection=function(){this.removeAllRanges();var u=r.document.selection.createRange();u="CONTROL"==r.document.selection.type.toUpperCase()?new z(L.decomposeControlRange(u)):
new z(L.decomposeTextRange(u));this.addRange(u,!0),this.isCollapsed=u.collapsed}},decomposeControlRange:function(r){var u=r.item(0),w=r.item(r.length-1);r=u.parentNode;var x=w.parentNode;u=V.getIndex(u,r).o[0];w=V.getIndex(w,x).o[0]+1;return[r,u,x,w]},getEndPoint:function(r,u){var w=r.duplicate();w.collapse(!u);var x="EndTo"+(u?"End":"Start"),K=w.parentElement(),c;if(0<K.childNodes.length)P.every(K.childNodes,function(m,e){if(3!=m.nodeType)if(w.moveToElementText(m),0<w.compareEndPoints(x,r))if(c&&
3==c.nodeType){b=c;var d=!0}else return b=K,q=e,!1;else{if(e==K.childNodes.length-1)return b=K,q=K.childNodes.length,!1}else e==K.childNodes.length-1&&(b=m,d=!0);if(d&&b)return b=(m=V.adjacentNoneTextNode(b)[0])?m.nextSibling:K.firstChild,e=V.adjacentNoneTextNode(b),m=e[0],e=e[1],m?(w.moveToElementText(m),w.collapse(!1)):w.moveToElementText(K),w.setEndPoint(x,r),q=w.text.length-e,!1;c=m;return!0});else{var b=K;var q=0}u||1!=b.nodeType||q!=b.childNodes.length||(u=b.nextSibling)&&3==u.nodeType&&(b=
u,q=0);return[b,q]},setEndPoint:function(r,u,w){r=r.duplicate();var x;if(3!=u.nodeType)if(0<w){if(x=u.childNodes[w-1])if(3==x.nodeType)u=x,w=x.length;else if(x.nextSibling&&3==x.nextSibling.nodeType)u=x.nextSibling,w=0;else{r.moveToElementText(x.nextSibling?x:u);var K=x.parentNode;x=K.insertBefore(x.ownerDocument.createTextNode(" "),x.nextSibling);r.collapse(!1);K.removeChild(x)}}else r.moveToElementText(u),r.collapse(!0);3==u.nodeType&&(x=V.adjacentNoneTextNode(u),K=x[0],x=x[1],K?(r.moveToElementText(K),
r.collapse(!1),"inherit"!=K.contentEditable&&x++):(r.moveToElementText(u.parentNode),r.collapse(!0),r.move("character",1),r.move("character",-1)),w+=x,0<w&&r.move("character",w)!=w&&console.error("Error when moving!"));return r},decomposeTextRange:function(r){var u=L.getEndPoint(r),w=u[0],x=u[1],K=u[0];u=u[1];r.htmlText.length&&(r.htmlText==r.text?u=x+r.text.length:(u=L.getEndPoint(r,!0),K=u[0],u=u[1]));return[w,x,K,u]},setRange:function(r,u,w,x,K,c){u=L.setEndPoint(r,u,w);r.setEndPoint("StartToStart",
u);if(!c)var b=L.setEndPoint(r,x,K);r.setEndPoint("EndToEnd",b||u);return r}},z=V.W3CRange=J(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?V.getCommonAncestor(this.startContainer,
this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(r,u){u=parseInt(u);if(this.startContainer!==r||this.startOffset!=u)delete this._cachedBookmark,this.startContainer=r,this.startOffset=u,this.endContainer?this._updateInternal():this.setEnd(r,u)},setEnd:function(r,u){u=parseInt(u);if(this.endContainer!==r||this.endOffset!=u)delete this._cachedBookmark,this.endContainer=r,this.endOffset=u,this.startContainer?
this._updateInternal():this.setStart(r,u)},setStartAfter:function(r,u){this._setPoint("setStart",r,u,1)},setStartBefore:function(r,u){this._setPoint("setStart",r,u,0)},setEndAfter:function(r,u){this._setPoint("setEnd",r,u,1)},setEndBefore:function(r,u){this._setPoint("setEnd",r,u,0)},_setPoint:function(r,u,w,x){w=V.getIndex(u,u.parentNode).o;this[r](u.parentNode,w.pop()+x)},_getIERange:function(){var r=(this._body||this.endContainer.ownerDocument.body).createTextRange();L.setRange(r,this.startContainer,
this.startOffset,this.endContainer,this.endOffset,this.collapsed);return r},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var r=this.startContainer,u=this._getIERange();3!==r.nodeType||this.startOffset||this.setStartBefore(r);u.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var r=new z([this.startContainer,this.startOffset,
this.endContainer,this.endOffset]);r._body=this._body;return r},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});Q.setObject("dijit.range",V);return V})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(P,J,Q){var V={};J.setObject("dijit._editor.html",V);var L=V.escapeXml=function(z,r){z=z.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,
"\x26gt;").replace(/"/gm,"\x26quot;");r||(z=z.replace(/'/gm,"\x26#39;"));return z};V.getNodeHtml=function(z){var r=[];V.getNodeHtmlHelper(z,r);return r.join("")};V.getNodeHtmlHelper=function(z,r){switch(z.nodeType){case 1:var u=z.nodeName.toLowerCase();if(!u||"/"==u.charAt(0))return"";r.push("\x3c",u);var w=[],x={},K;if(Q("dom-attributes-explicit")||Q("dom-attributes-specified-flag"))for(var c=0;K=z.attributes[c++];){var b=K.name;"_dj"===b.substr(0,3)||Q("dom-attributes-specified-flag")&&!K.specified||
b in x||(K=K.value,("src"==b||"href"==b)&&z.getAttribute("_djrealurl")&&(K=z.getAttribute("_djrealurl")),8===Q("ie")&&"style"===b&&(K=K.replace("HEIGHT:","height:").replace("WIDTH:","width:")),w.push([b,K]),x[b]=K)}else{var q=(/^input$|^img$/i.test(z.nodeName)?z:z.cloneNode(!1)).outerHTML;x=q.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);q=q.substr(0,q.indexOf("\x3e"));P.forEach(x,function(m){if(m){var e=m.indexOf("\x3d");if(0<e&&(m=m.substring(0,e),"_dj"!=m.substr(0,3)))if("src"!=m&&"href"!=m||!z.getAttribute("_djrealurl")){switch(m){case "style":var d=
z.style.cssText.toLowerCase();break;case "class":d=z.className;break;case "width":if("img"===u){(e=/width=(\S+)/i.exec(q))&&(d=e[1]);break}case "height":if("img"===u){(e=/height=(\S+)/i.exec(q))&&(d=e[1]);break}default:d=z.getAttribute(m)}null!=d&&w.push([m,d.toString()])}else w.push([m,z.getAttribute("_djrealurl")])}},this)}w.sort(function(m,e){return m[0]<e[0]?-1:m[0]==e[0]?0:1});for(x=0;K=w[x++];)r.push(" ",K[0],'\x3d"',"string"===typeof K[1]?L(K[1],!0):K[1],'"');switch(u){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":r.push(" /\x3e");
break;case "script":r.push("\x3e",z.innerHTML,"\x3c/",u,"\x3e");break;default:r.push("\x3e"),z.hasChildNodes()&&V.getChildrenHtmlHelper(z,r),r.push("\x3c/",u,"\x3e")}break;case 4:case 3:r.push(L(z.nodeValue,!0));break;case 8:r.push("\x3c!--",L(z.nodeValue,!0),"--\x3e");break;default:r.push("\x3c!-- Element not recognized - Type: ",z.nodeType," Name: ",z.nodeName,"--\x3e")}};V.getChildrenHtml=function(z){var r=[];V.getChildrenHtmlHelper(z,r);return r.join("")};V.getChildrenHtmlHelper=function(z,r){if(z)for(var u=
z.childNodes||z,w=!Q("ie")||u!==z,x,K=0;x=u[K++];)w&&x.parentNode!=z||V.getNodeHtmlHelper(x,r)};return V})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(P,J,Q,V,L,z,r,u,w,x,K,c,b){var q=Q("dijit._editor.plugins.LinkDialog",K,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:c,useDefaultCommand:!1,
urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=z.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(e){P("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),z.hitch(this,function(d,g,E){var F=this;this.tag="insertImage"==this.command?"img":"a";d=z.delegate(d.getLocalization("dijit","common",this.lang),d.getLocalization("dijit._editor",
"LinkDialog",this.lang));var G=this.dropDown=this.button.dropDown=new g({title:d[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:z.hitch(this,"setValue"),onOpen:function(){F._onOpenDialog();g.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(z.hitch(F,"_onCloseDialog"),0)}});d.urlRegExp=this.urlRegExp;d.id=E.getUniqueId(this.editor.id);this._uniqueId=d.id;this._setContent(G.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
x.substitute(this.linkDialogTemplate,d));G.startup();this._urlInput=E.byId(this._uniqueId+"_urlInput");this._textInput=E.byId(this._uniqueId+"_textInput");this._setButton=E.byId(this._uniqueId+"_setButton");this.own(E.byId(this._uniqueId+"_cancelButton").on("click",z.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",z.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",z.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=z.hitch(this,function(){var D=this._urlInput.get("value");return this._urlRegExp.test(D)||this._emailRegExp.test(D)});this.own(r(G.domNode,"keydown",z.hitch(this,z.hitch(this,function(D){!D||D.keyCode!=L.ENTER||D.shiftKey||D.metaKey||D.ctrlKey||D.altKey||this._setButton.get("disabled")||(G.onExecute(),G.execute(G.get("value")))}))));e()}))},_checkAndFixInput:function(){var e=this,d=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var g=d,E=!1,F=!1;g&&1<g.length&&(g=z.trim(g),0!==g.indexOf("mailto:")&&(0<g.indexOf("/")?-1===g.indexOf("://")&&"/"!==g.charAt(0)&&g.indexOf("./")&&0!==g.indexOf("../")&&e._hostRxp.test(g)&&(E=!0):e._userAtRxp.test(g)&&(F=!0)));E&&e._urlInput.set("value","http://"+g);F&&e._urlInput.set("value","mailto:"+g);e._setButton.set("disabled",!e._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(z.hitch(this,
function(){this.own(r(this.editor.editNode,"mouseup",z.hitch(this,"_onMouseUp")));this.own(r(this.editor.editNode,"dblclick",z.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(e){this.dropDown.set({parserScope:"dojo",content:e})},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&e&&e.textInput&&("function"===typeof this.linkFilter?e.textInput=this.linkFilter(e.textInput):
J.forEach(this.linkFilter,function(d){e.textInput=e.textInput.replace(d[0],d[1])}));return e},_createlinkEnabledImpl:function(){return!0},setValue:function(e){this._onCloseDialog();if(9>u("ie")){var d=b.getSelection(this.editor.window).getRangeAt(0).endContainer;3===d.nodeType&&(d=d.parentNode);d&&d.nodeName&&d.nodeName.toLowerCase()!==this.tag&&(d=this.editor.selection.getSelectedElement(this.tag));d&&d.nodeName&&d.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(d),
this.editor.execCommand("unlink"))}e=this._checkValues(e);this.editor.execCommand("inserthtml",x.substitute(this.htmlTemplate,e));w("a",this.editor.document).forEach(function(g){g.innerHTML||V.has(g,"name")||g.parentNode.removeChild(g)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(e){if(e&&e.tagName.toLowerCase()===this.tag){var d=e.getAttribute("_djrealurl")||e.getAttribute("href");var g=e.getAttribute("target")||"_self";var E=e.textContent||
e.innerText;this.editor.selection.selectElement(e,!0)}else E=this.editor.selection.getSelectedText();return{urlInput:d||"",textInput:E||"",targetSelect:g||""}},_onOpenDialog:function(){if(u("ie")){var e=b.getSelection(this.editor.window);if(e.rangeCount){var d=e.getRangeAt(0);var g=d.endContainer;3===g.nodeType&&(g=g.parentNode);g&&g.nodeName&&g.nodeName.toLowerCase()!==this.tag&&(g=this.editor.selection.getSelectedElement(this.tag));if(!g||g.nodeName&&g.nodeName.toLowerCase()!==this.tag)(e=this.editor.selection.getAncestorElement(this.tag))&&
e.nodeName&&e.nodeName.toLowerCase()==this.tag?(g=e,this.editor.selection.selectElement(g)):d.startContainer===d.endContainer&&(e=d.startContainer.firstChild)&&e.nodeName&&e.nodeName.toLowerCase()==this.tag&&(g=e,this.editor.selection.selectElement(g))}}else g=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(g))},_onDblClick:function(e){if(e&&e.target&&(e=e.target,(e.tagName?e.tagName.toLowerCase():
"")===this.tag&&V.get(e,"href"))){var d=this.editor;this.editor.selection.selectElement(e);d.onDisplayChanged();d._updateTimer&&(d._updateTimer.remove(),delete d._updateTimer);d.onNormalizedDisplayChanged();var g=this.button;setTimeout(function(){g.set("disabled",!1);g.loadAndOpenDropDown().then(function(){g.dropDown.focus&&g.dropDown.focus()})},10)}},_onMouseUp:function(){if(u("ff")){var e=this.editor.selection.getAncestorElement(this.tag);if(e){var d=b.getSelection(this.editor.window).getRangeAt(0);
if(d.collapsed&&e.childNodes.length){var g=d.cloneRange();g.selectNodeContents(e.childNodes[e.childNodes.length-1]);g.setStart(e.childNodes[0],0);1!==d.compareBoundaryPoints(g.START_TO_START,g)?d.setStartBefore(e):-1!==d.compareBoundaryPoints(g.END_TO_START,g)&&d.setStartAfter(e)}}}}}),m=Q("dijit._editor.plugins.ImgLinkDialog",[q],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(e){if(e&&e.tagName.toLowerCase()===this.tag){var d=e.getAttribute("_djrealurl")||e.getAttribute("src");var g=e.getAttribute("alt");this.editor.selection.selectElement(e,!0)}else g=this.editor.selection.getSelectedText();return{urlInput:d||"",textInput:g||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(z.hitch(this,function(){this.own(r(this.editor.editNode,"mousedown",z.hitch(this,"_selectTag")))}))},_selectTag:function(e){e&&e.target&&(e=e.target,(e.tagName?e.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(e))},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"\x26quot;"));e&&e.textInput&&(e.textInput=e.textInput.replace(/"/g,"\x26quot;"));return e},_onDblClick:function(e){if(e&&e.target&&(e=e.target,(e.tagName?
e.tagName.toLowerCase():"")===this.tag&&V.get(e,"src"))){var d=this.editor;this.editor.selection.selectElement(e);d.onDisplayChanged();d._updateTimer&&(d._updateTimer.remove(),delete d._updateTimer);d.onNormalizedDisplayChanged();var g=this.button;setTimeout(function(){g.set("disabled",!1);g.loadAndOpenDropDown().then(function(){g.dropDown.focus&&g.dropDown.focus()})},10)}}});K.registry.createLink=function(e){var d={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in e?e.allowUnsafeHtml:!1};
"linkFilter"in e&&(d.linkFilter=e.linkFilter);return new q(d)};K.registry.insertImage=function(){return new m({command:"insertImage"})};q.ImgLinkDialog=m;return q})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(P,J,Q,V,L,z){var r=Q("dijit._editor.plugins.TextColor",L,{buttonClass:z,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var u=this;this.button.loadDropDown=function(w){function x(K){u.button.dropDown=new K({dir:u.editor.dir,ownerDocument:u.editor.ownerDocument,value:u.value,onChange:function(c){u.editor.execCommand(u.command,c)},onExecute:function(){u.editor.execCommand(u.command,this.get("value"))}});w()}"string"==typeof u.colorPicker?P([u.colorPicker],x):x(u.colorPicker)}},updateState:function(){var u=this.editor,w=this.command;if(u&&u.isLoaded&&w.length){if(this.button){var x=this.get("disabled");
this.button.set("disabled",x);if(x)return;try{var K=u.queryCommandValue(w)||""}catch(c){K=""}}""==K&&(K="#000000");"transparent"==K&&(K="#ffffff");"string"==typeof K?-1<K.indexOf("rgb")&&(K=J.fromRgb(K).toHex()):(K=((K&255)<<16|K&65280|(K&16711680)>>>16).toString(16),K="#000000".slice(0,7-K.length)+K);this.value=K;(u=this.button.dropDown)&&u.get&&K!==u.get("value")&&u.set("value",K,!1)}}});L.registry.foreColor=function(u){return new r(u)};L.registry.hiliteColor=function(u){return new r(u)};return r})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d){P=P([x,K],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:e,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(g,E){J.mixin(this,d.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=Q.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=Q.connect(this._uploadField,"onfocus",J.hitch(this,function(g){m.hide(this._attachmentError)}))},destroy:function(){V.forEach(this._aeConnects,Q.disconnect);Q.disconnect(this._uploadField_connect);Q.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(g,E){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";V.forEach(this.domNode.children,function(F,G){m.show(F)});m.hide(this._attachmentError);g&&(this._featureLayer=g.getLayer()||E)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:g}).canUpdate,this._oid=g.attributes[this._featureLayer.objectIdField],this._getAttachments(g)):E&&E.getEditCapabilities()||(m.hide(this._uploadForm),V.forEach(this.domNode.children,function(F,G){m.hide(F)})))},_getAttachments:function(g){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,J.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){m.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(m.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,J.hitch(this,"_onAddAttachmentComplete"),J.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(g,E){this._tempUpload&&(m.show(this._attachmentProgress),E.addAttachment(g,this._tempUpload,J.hitch(this,"_onAddAttachmentComplete"),J.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(g,
E){m.show(this._attachmentProgress);this._featureLayer.deleteAttachments(g,[E],J.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(g){var E=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(E=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(E=this._listHtml+this._endHtml);var F=this._attachmentList;g=V.map(g,J.hitch(this,function(G){return q.substitute({href:G.url,name:G.name,oid:G.objectId,attid:G.id},E)}));F.innerHTML=g.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(g){m.hide(this._attachmentProgress.domNode);var E=this._attachmentList,F=this._uploadField,G=F.value,D=G.lastIndexOf("\\");
-1<D&&(G=G.substring(D+1,G.length));G=G.replace(/ /g,"_");D=u.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var k=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(k=this._listHtml+this._endHtml);g=q.substitute({href:this._featureLayer._url.path+"/"+g.objectId+"/attachments/"+g.attachmentId+(D?"?"+D:""),name:G,oid:g.objectId,attid:g.attachmentId},
k);E.innerHTML=E.innerHTML==this.NLS_none?g:E.innerHTML+g;this._updateConnects();F.value=""},_onAddAttachmentError:function(g){m.hide(this._attachmentProgress.domNode);if(g){var E=this.NLS_error,F=this._attachmentError;q.isDefined(g.code)&&400===g.code&&(E=this.NLS_fileNotSupported);w.set(F,"innerHTML",E);m.show(F)}},_onDeleteAttachmentComplete:function(g){m.hide(this._attachmentProgress.domNode);var E=this._attachmentList;V.every(g,function(F){return F.success})&&(L.query("#node_"+g[0].objectId+
"_"+g[0].attachmentId).orphan(),E.children&&E.children.length||(E.innerHTML=this.NLS_none))},_updateConnects:function(){V.forEach(this._aeConnects,Q.disconnect);L.query(".deleteAttachment").forEach(function(g){this._aeConnects.push(Q.connect(g,"onclick",J.hitch(this,"_deleteAttachment",this._oid,g.id)))},this)}});z("extend-esri")&&J.setObject("dijit.editing.AttachmentEditor",P,b);return P})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(P,J,Q,V,L,z,r,u){return J("dijit.ProgressBar",[z,r],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:u,_indeterminateHighContrastImagePath:P.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(w){var x="rtl"==w.toLowerCase();Q.toggle(this.domNode,"dijitProgressBarRtl",x);Q.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&x);this.inherited(arguments)},update:function(w){V.mixin(this,w||{});w=this.internalProgress;var x=this.domNode,K=1;this.indeterminate?x.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(K=Math.min(parseFloat(this.progress)/100,1),this.progress=K*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),K=this.maximum?this.progress/this.maximum:0),x.setAttribute("aria-valuenow",this.progress));x.setAttribute("aria-labelledby",this.labelNode.id);x.setAttribute("aria-valuemin",0);x.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(K);Q.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);Q.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());w.style.width=100*K+"%";this.onChange()},_setValueAttr:function(w){this._set("value",
w);Infinity==w?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:w})},_setLabelAttr:function(w){this._set("label",w);this.update()},_setIndeterminateAttr:function(w){this._set("indeterminate",w);this.update()},report:function(w){return this.label?this.label:this.indeterminate?"\x26#160;":L.format(w,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(P,J,Q,V){var L={};L={findFeatures:function(z,r,u){var w=r.objectIdField;r=J.filter(r.graphics,function(x){return J.some(z,function(K){return x.attributes[w]===K.objectId})});if(u)u(r);else return r},getSelection:function(z){var r=[];J.forEach(z,function(u){u=u.getSelectedFeatures();J.forEach(u,function(w){r.push(w)})});return r},sortFeaturesById:function(z,r){var u=J.map(z,function(w){return w.featureLayer});r.sort(function(w,x){var K=w.getLayer(),c=x.getLayer();if(!K)return-1;if(!c)return 1;
var b=J.indexOf(u,K);c=J.indexOf(u,c);b-=c;b||(K=K.objectIdField,b=w.attributes[K]-x.attributes[K]);return b});return r}};Q("extend-esri")&&P.setObject("dijit.editing.Util.LayerHelper",L,V);return L})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(P,J,Q,V){var L=J.getObject("date.islamic",!0,P);L.getDaysInMonth=function(z){return z.getDaysInIslamicMonth(z.getMonth(),z.getFullYear())};L.compare=function(z,r,u){z instanceof V&&(z=z.toGregorian());
r instanceof V&&(r=r.toGregorian());return Q.compare.apply(null,arguments)};L.add=function(z,r,u){var w=new V(z);switch(r){case "day":w.setDate(z.getDate()+u);break;case "weekday":var x=z.getDay();if(5>x+u&&0<x+u)w.setDate(z.getDate()+u);else{var K=r=0;5==x?(x=4,K=0<u?-1:1):6==x&&(x=4,K=0<u?-2:2);x=0<u?5-x-1:-x;var c=u-x,b=parseInt(c/5);0!=c%5&&(r=0<u?2:-2);r=r+7*b+c%5+x;w.setDate(z.getDate()+r+K)}break;case "year":w.setFullYear(z.getFullYear()+u);break;case "week":u*=7;w.setDate(z.getDate()+u);break;
case "month":z=z.getMonth();w.setMonth(z+u);break;case "hour":w.setHours(z.getHours()+u);break;case "minute":w._addMinutes(u);break;case "second":w._addSeconds(u);break;case "millisecond":w._addMilliseconds(u)}return w};L.difference=function(z,r,u){r=r||new V;u=u||"day";var w=r.getFullYear()-z.getFullYear(),x=1;switch(u){case "weekday":w=Math.round(L.difference(z,r,"day"));x=parseInt(L.difference(z,r,"week"));if(0==w%7)w=5*x;else{u=0;var K=z.getDay(),c=r.getDay();x=parseInt(w/7);r=w%7;z=new V(z);
z.setDate(z.getDate()+7*x);z=z.getDay();if(0<w)switch(!0){case 5==K:u=-1;break;case 6==K:u=0;break;case 5==c:u=-1;break;case 6==c:u=-2;break;case 5<z+r:u=-2}else if(0>w)switch(!0){case 5==K:u=0;break;case 6==K:u=1;break;case 5==c:u=2;break;case 6==c:u=1;break;case 0>z+r:u=2}w=w+u-2*x}x=w;break;case "year":x=w;break;case "month":u=r.toGregorian()>z.toGregorian()?r:z;K=r.toGregorian()>z.toGregorian()?z:r;x=u.getMonth();c=K.getMonth();if(0==w)x=u.getMonth()-K.getMonth();else for(x=12-c+x,w=K.getFullYear()+
1,u=u.getFullYear(),w;w<u;w++)x+=12;r.toGregorian()<z.toGregorian()&&(x=-x);break;case "week":x=parseInt(L.difference(z,r,"day")/7);break;case "day":x/=24;case "hour":x/=60;case "minute":x/=60;case "second":x/=1E3;case "millisecond":x*=r.toGregorian().getTime()-z.toGregorian().getTime()}return Math.round(x)};return L})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(P,J,Q){var V=J("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var L=arguments.length;L?1==L?(L=arguments[0],"number"==typeof L&&(L=new Date(L)),L instanceof Date?this.fromGregorian(L):""==L?this._date=new Date(""):(this._year=L._year,this._month=L._month,this._date=L._date,this._hours=L._hours,this._minutes=L._minutes,this._seconds=L._seconds,this._milliseconds=L._milliseconds)):3<=L&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(L){L=parseInt(L);if(!(0<L&&L<=this.getDaysInIslamicMonth(this._month,this._year))){var z;if(0<L)for(z=this.getDaysInIslamicMonth(this._month,this._year);L>z;L-=z,z=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(z=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=L;z=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),L+=z}this._date=L;return this},setFullYear:function(L){this._year=+L},setMonth:function(L){this._year+=Math.floor(L/12);this._month=0<L?Math.floor(L%12):Math.floor((L%12+12)%12)},setHours:function(){var L=arguments.length,z=0;1<=L&&(z=parseInt(arguments[0]));2<=L&&(this._minutes=parseInt(arguments[1]));3<=L&&(this._seconds=parseInt(arguments[2]));4==L&&(this._milliseconds=parseInt(arguments[3]));for(;24<=z;)this._date++,L=this.getDaysInIslamicMonth(this._month,
this._year),this._date>L&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=L),z-=24;this._hours=z},_addMinutes:function(L){L+=this._minutes;this.setMinutes(L);this.setHours(this._hours+parseInt(L/60));return this},_addSeconds:function(L){L+=this._seconds;this.setSeconds(L);this._addMinutes(parseInt(L/60));return this},_addMilliseconds:function(L){L+=this._milliseconds;this.setMilliseconds(L);this._addSeconds(parseInt(L/1E3));return this},setMinutes:function(L){this._minutes=
L%60;return this},setSeconds:function(L){this._seconds=L%60;return this},setMilliseconds:function(L){this._milliseconds=L%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var L=new Date;L.setHours(this._hours);L.setMinutes(this._minutes);L.setSeconds(this._seconds);L.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+L.toTimeString()},toGregorian:function(){var L=this._year;L=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(L-1)+Math.floor((3+11*L)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var z=L-this._GREGORIAN_EPOCH,r=Math.floor(z/146097),u=this._mod(z,146097);z=Math.floor(u/36524);var w=this._mod(u,36524);u=Math.floor(w/1461);w=this._mod(w,1461);w=Math.floor(w/365);r=400*r+100*z+4*u+w;4!=z&&4!=w&&r++;z=L-(this._GREGORIAN_EPOCH+365*(r-1)+Math.floor((r-1)/4)-Math.floor((r-1)/100)+Math.floor((r-1)/400));u=this._GREGORIAN_EPOCH-1+365*(r-1)+Math.floor((r-1)/4)-Math.floor((r-1)/100)+Math.floor((r-1)/400)+Math.floor(739/12+(Q.isLeapYear(new Date(r,
3,1))?-1:-2)+1);u=L<u?0:Q.isLeapYear(new Date(r,3,1))?1:2;z=Math.floor((12*(z+u)+373)/367);u=this._GREGORIAN_EPOCH-1+365*(r-1)+Math.floor((r-1)/4)-Math.floor((r-1)/100)+Math.floor((r-1)/400)+Math.floor((367*z-362)/12+(2>=z?0:Q.isLeapYear(new Date(r,z-1,1))?-1:-2)+1);return new Date(r,z-1,L-u+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(L){L=new Date(L);var z=L.getFullYear(),r=L.getMonth(),u=L.getDate();z=this._GREGORIAN_EPOCH-1+365*(z-1)+Math.floor((z-1)/4)+
-Math.floor((z-1)/100)+Math.floor((z-1)/400)+Math.floor((367*(r+1)-362)/12+(2>=r+1?0:Q.isLeapYear(L)?-1:-2)+u);z=Math.floor(z)+.5;z-=this._ISLAMIC_EPOCH;r=Math.floor((30*z+10646)/10631);u=Math.ceil((z-29-this._yearStart(r))/29.5);u=Math.min(u,11);this._date=Math.ceil(z-this._monthStart(r,u))+1;this._month=u;this._year=r;this._hours=L.getHours();this._minutes=L.getMinutes();this._seconds=L.getSeconds();this._milliseconds=L.getMilliseconds();this._day=L.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(L){return 354*(L-1)+Math.floor((3+11*L)/30)},_monthStart:function(L,z){return Math.ceil(29.5*z)+354*(L-1)+Math.floor((3+11*L)/30)},_civilLeapYear:function(L){return 11>(14+11*L)%30},getDaysInIslamicMonth:function(L,z){var r=0;r=29+(L+1)%2;11==L&&this._civilLeapYear(z)&&r++;return r},_mod:function(L,z){return L-z*Math.floor(L/z)}});V.getDaysInIslamicMonth=function(L){return(new V).getDaysInIslamicMonth(L.getMonth(),L.getFullYear())};return V})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(P,J,Q,V,L,z,r,u,w){function x(m,e,d,g,E){return E.replace(/([a-z])\1*/ig,function(F){var G=F.charAt(0);F=F.length;var D=["abbr","wide","narrow"];switch(G){case "G":var k=e.eraAbbr[0];break;case "y":k=String(m.getFullYear());break;case "M":k=m.getMonth();if(3>F){k+=1;var n=!0}else G=["months-format",D[F-3]].join("-"),k=e[G][k];break;case "d":k=m.getDate(!0);n=!0;break;case "E":k=m.getDay();3>F?(k+=1,n=!0):(G=["days-format",D[F-3]].join("-"),k=e[G][k]);break;case "a":k=12>m.getHours()?"am":
"pm";k=e["dayPeriods-format-wide-"+k];break;case "h":case "H":case "K":case "k":n=m.getHours();switch(G){case "h":k=n%12||12;break;case "H":k=n;break;case "K":k=n%12;break;case "k":k=n||24}n=!0;break;case "m":k=m.getMinutes();n=!0;break;case "s":k=m.getSeconds();n=!0;break;case "S":k=Math.round(m.getMilliseconds()*Math.pow(10,F-3));n=!0;break;case "z":if(k=V.getTimezoneName(m.toGregorian()))break;F=4;case "Z":k=m.toGregorian().getTimezoneOffset();k=[0>=k?"+":"-",r.pad(Math.floor(Math.abs(k)/60),2),
r.pad(Math.abs(k)%60,2)];4==F&&(k.splice(0,0,"GMT"),k.splice(3,0,":"));k=k.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+E);}n&&(k=r.pad(k,F));return k})}function K(m,e,d,g){var E=function(D){return D};e=e||E;d=d||E;g=g||E;var F=m.match(/(''|[^'])+/g),G="'"==m.charAt(0);Q.forEach(F,function(D,k){D?(F[k]=(G?d:e)(D),G=!G):F[k]=""});return g(F.join(""))}function c(m,e,d,g){g=z.escapeString(g);L.normalizeLocale(d.locale);return g.replace(/([a-z])\1*/ig,
function(E){var F=E.charAt(0);var G=E.length,D="";d.strict?1<G&&(D="0{"+(G-1)+"}"):D="0?";switch(F){case "y":F="\\d+";break;case "M":F=2<G?"\\S+ ?\\S+":D+"[1-9]|1[0-2]";break;case "d":F="[12]\\d|"+D+"[1-9]|3[01]";break;case "E":F="\\S+";break;case "h":F=D+"[1-9]|1[0-2]";break;case "k":F=D+"\\d|1[01]";break;case "H":F=D+"\\d|1\\d|2[0-3]";break;case "K":F=D+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":F=D+"\\d|[0-5]\\d";break;case "S":F="\\d{"+G+"}";break;case "a":G=d.am||e["dayPeriods-format-wide-am"];
D=d.pm||e["dayPeriods-format-wide-pm"];d.strict?F=G+"|"+D:(F=G+"|"+D,G!=G.toLowerCase()&&(F+="|"+G.toLowerCase()),D!=D.toLowerCase()&&(F+="|"+D.toLowerCase()));break;default:F=".*"}m&&m.push(E);return"("+F+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var b=J.getObject("date.islamic.locale",!0,P);b.format=function(m,e){e=e||{};var d=L.normalizeLocale(e.locale),g=e.formatLength||"short",E=b._getIslamicBundle(d),F=[];d=J.hitch(this,x,m,E,d,e.fullYear);if("year"==e.selector)return m.getFullYear();"time"!=e.selector&&
(m=e.datePattern||E["dateFormat-"+g])&&F.push(K(m,d));"date"!=e.selector&&(e=e.timePattern||E["timeFormat-"+g])&&F.push(K(e,d));return F.join(" ")};b.regexp=function(m){return b._parseInfo(m).regexp};b._parseInfo=function(m){m=m||{};var e=L.normalizeLocale(m.locale);e=b._getIslamicBundle(e);var d=m.formatLength||"short",g=m.datePattern||e["dateFormat-"+d];d=m.timePattern||e["timeFormat-"+d];var E=[];return{regexp:K("date"==m.selector?g:"time"==m.selector?d:"undefined"==typeof d?g:g+" "+d,J.hitch(this,
c,E,e,m)),tokens:E,bundle:e}};b.parse=function(m,e){m=m.replace(/[\u200E\u200F\u202A\u202E]/g,"");e||(e={});var d=b._parseInfo(e),g=d.tokens,E=d.bundle;d=d.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");m=(new RegExp("^"+d+"$")).exec(m);L.normalizeLocale(e.locale);if(!m)return null;var F=[1389,0,1,0,0,0,0],G="",D=["abbr","wide","narrow"];Q.every(m,function(k,n){if(!n)return!0;n=g[n-1];var f=n.length;switch(n.charAt(0)){case "y":F[0]=Number(k);break;case "M":if(2<f){if(n=E["months-format-"+D[f-3]].concat(),
e.strict||(k=k.replace(".","").toLowerCase(),n=Q.map(n,function(I){return I?I.replace(".","").toLowerCase():I})),k=Q.indexOf(n,k),-1==k)return!1}else k--;F[1]=Number(k);break;case "D":F[1]=0;case "d":F[2]=Number(k);break;case "a":n=e.am||E["dayPeriods-format-wide-am"];f=e.pm||E["dayPeriods-format-wide-pm"];if(!e.strict){var y=/\./g;k=k.replace(y,"").toLowerCase();n=n.replace(y,"").toLowerCase();f=f.replace(y,"").toLowerCase()}if(e.strict&&k!=n&&k!=f)return!1;G=k==f?"p":k==n?"a":"";break;case "K":24==
k&&(k=0);case "h":case "H":case "k":F[3]=Number(k);break;case "m":F[4]=Number(k);break;case "s":F[5]=Number(k);break;case "S":F[6]=Number(k)}return!0});m=+F[3];"p"===G&&12>m?F[3]=m+12:"a"===G&&12==m&&(F[3]=0);return new u(F[0],F[1],F[2],F[3],F[4],F[5],F[6])};var q=[];b.addCustomFormats=function(m,e){q.push({pkg:m,name:e})};b._getIslamicBundle=function(m){var e={};Q.forEach(q,function(d){d=L.getLocalization(d.pkg,d.name,m);e=J.mixin(e,d)},this);return e};b.addCustomFormats("dojo.cldr","islamic");b.getNames=
function(m,e,d,g,E){g=b._getIslamicBundle(g);m=[m,d,e];if("standAlone"==d){d=m.join("-");var F=g[d];1==F[0]&&(F=void 0)}m[1]="format";return(F||g[m.join("-")]).concat()};b.weekDays=b.getNames("days","wide","format");b.months=b.getNames("months","wide","format");return b})},"widgets/SituationAwareness/js/SummaryInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/keys jimu/utils jimu/dijit/Message esri/graphic esri/layers/FeatureLayer esri/tasks/query esri/tasks/QueryTask ./analysisUtils".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d){return P("SummaryInfo",[J],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,allFields:!1,configuredPopUpFields:[],constructor:function(g,E,F){this.tab=g;this.container=E;this.parent=F;this.config=F.config;this.graphicsLayer=null;this.baseLabel=""!==g.label?g.label:g.layerTitle?g.layerTitle:
g.layers;this.parentNode=F.domNode},queryTabCount:function(g,E,F,G){var D=new L;this.incidentCount=g.length;var k=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(k=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=
this._getFields(this.summaryLayer),this._performQuery(g,E,F,G,k).then(function(f){D.resolve(f)});else{var n=new q(this.summaryLayer.url);n.infoTemplate=this.tab.tabLayers[0].infoTemplate;k=[n];this.tab.tabLayers=k;w(n,"load",z.hitch(this,function(){this.summaryLayer=n;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(g,E,F,G,k).then(function(f){D.resolve(f)})}))}else this.loading||(n=new q(this.tab.tabLayers[0].url),this.loading=!0,w(n,"load",z.hitch(this,function(){this.summaryLayer=
n;this.summaryFields=this._getFields(this.summaryLayer);for(var f=this.tab.tabLayers[0].url.split("MapServer/")[1],y=this.parent.map.itemInfo.itemData.operationalLayers,I=0;I<y.length;I++){var C=y[I];if(-1<this.tab.tabLayers[0].url.indexOf(C.url)&&"undefined"!==typeof C.layerObject)if(C.layerObject.infoTemplates){if(C=C.layerObject.infoTemplates[f]){n.infoTemplate=C.infoTemplate;break}}else if(C.layerObject.infoTemplate){n.infoTemplate=C.layerObject.infoTemplate;break}}k=[n];this.tab.tabLayers=k;
this.loading=!1;this._performQuery(g,E,F,G,k).then(function(N){D.resolve(N)})})));this.mapServiceLayer||this._performQuery(g,E,F,G,k).then(function(f){D.resolve(f)});return D},_performQuery:function(g,E,F,G,D){var k=new L,n=[],f;0<E.length?f=d.getGeoms(E):0<g.length&&(f=d.getGeoms(g));this.summaryGeoms=f;if(0<f.length)for(g=0;g<f.length;g++){n=f[g];E=d.createDefArray(D,n,this.parent.opLayers,this.tab);var y=0===g?n=E:n=y.concat(E)}(new V(n)).then(z.hitch(this,function(I){for(var C=0,N=0;N<I.length;N++){var R=
I[N][1];isNaN(R)?R&&R.features?C+=R.features.length:R&&"undefined"!==typeof R.length&&(C+=R.length):C+=R}this.updateTabCount(C,F,G);this.queryOnLoad&&z.hitch(this,this._queryFeatures(this.summaryGeoms));k.resolve(C)}));return k},updateTabCount:function(g,E,F){this.featureCount=g;d.updateTabCount(this.featureCount,E,F,this.baseLabel,this.incidentCount)},updateForIncident:function(g,E,F,G,D,k,n){this.incidentCount=g.length;this.allFields="undefined"!==typeof k&&"undefined"!==typeof n?k?!0:n:!1;var f=
"undefined"!==typeof D;this.tabNum=G;if(f)var y=new L;else this.container.innerHTML="",r.add(this.container,"loading");this.summaryIds=[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length){var I=this.summaryGeoms;if("undefined"!==typeof this.tab.tabLayers[0].infoTemplate){this.summaryLayer=this.tab.tabLayers[0];var C=new q(this.summaryLayer.url);C.infoTemplate=this.tab.tabLayers[0].infoTemplate;this.tab.tabLayers[1]=C;this.summaryFields=this._getFields(this.tab.tabLayers[0]);this.configuredPopUpFields=
d.getPopupConfiguredFields(this.tab.tabLayers[0]);f?this._queryFeatures(I,f).then(function(N){y.resolve(N)}):(this._initGraphicsLayer(F),z.hitch(this,this._queryFeatures(I)))}else C=new q(this.tab.tabLayers[0].url),w(C,"load",z.hitch(this,function(){this.summaryLayer=C;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var N=this.tab.tabLayers[0].url.split("MapServer/")[1],R=this.parent.map.itemInfo.itemData.operationalLayers,a=0;a<R.length;a++){var v=R[a];if(-1<this.tab.tabLayers[0].url.indexOf(v.url)&&
"undefined"!==typeof v.layerObject&&v.layerObject.infoTemplates&&(v=v.layerObject.infoTemplates[N])){C.infoTemplate=v.infoTemplate;break}}this.tab.tabLayers[1]=C;this.summaryLayer=this.tab.tabLayers[1];this.summaryFields=this._getFields(this.tab.tabLayers[1]);this.configuredPopUpFields=d.getPopupConfiguredFields(this.tab.tabLayers[1]);f?this._queryFeatures(I,f).then(function(H){y.resolve(H)}):(this._initGraphicsLayer(F),z.hitch(this,this._queryFeatures(I)))}));if(f)return y}},_initGraphicsLayer:function(g){null!==
g&&(this.graphicsLayer=g,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(g,E){var F;E&&(F=new L);var G=[],D=-1===[null,void 0,""].indexOf(this.tab.tabLayers[0].id)?this.tab.tabLayers[0].id:this.tab.layers;
D=d.getFilter(D,this.parent.opLayers);for(var k=new m,n=0;n<g.length;n++)k.geometry=g[n],k.where=D,G.push(this.summaryLayer.queryIds(k));(new V(G)).then(z.hitch(this,function(f){for(var y,I,C=0;C<f.length;C++)f[C][0]&&(y=f[C][1],I=y=0===C?y:I.concat(y));y?(this.summaryIds=y,0<this.summaryIds.length?E?this._queryFeaturesByIds(E).then(function(N){F.resolve(N)}):this._queryFeaturesByIds():E||this._processResults()):E||this._processResults()}),z.hitch(this,function(f){console.error(f);new c({message:f})}));
if(E)return F},_queryFeaturesByIds:function(g){var E,F=[];g&&(E=new L);var G=this.summaryLayer.maxRecordCount||1E3,D=this.summaryIds.slice(0,G);this.summaryIds.splice(0,G);var k=new m;k.where=d.getFilter(this.summaryLayer.id,this.parent.opLayers);var n=!1;Q.some(this.summaryFields,z.hitch(this,function(y){if("area"===y.type||"length"===y.type||this.graphicsLayer)return n=!0}));g&&(n=!0);k.returnGeometry=n;k.outSpatialReference=this.parent.map.spatialReference;k.outFields=["*"];k.objectIds=D;var f=
new e(this.summaryLayer.url);for(F.push(f.execute(k));0<this.summaryIds.length;)D=this.summaryIds.slice(0,G),this.summaryIds.splice(0,G),k.objectIds=D,F.push(f.execute(k));(new V(F)).then(z.hitch(this,function(y){this.summaryFeatures=[];for(var I=0;I<y.length;I++)if(y[I][0]){var C=y[I][1];C.features&&(this.summaryFeatures=this.summaryFeatures.concat(C.features))}g?this._processResults(g).then(z.hitch(this,function(N){this.SA_SAT_download&&r.replace(this.SA_SAT_download,"download","processing");E.resolve(N)})):
(this._processResults(),this.SA_SAT_download&&r.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&r.replace(this.SA_SAT_download,"download","processing")}),z.hitch(this,function(y){console.error(y);new c({message:y})}));if(g)return E},_prepResults:function(){for(var g=0;g<this.summaryFields.length;g++){var E=this.summaryFields[g],F=E.field,G=E.total;switch(E.type){case "count":G=this.summaryFeatures.length;break;case "area":G=d.getArea(this.summaryFeatures,this.summaryGeoms,
this.config.distanceSettings,this.config.distanceUnits,this.tab.advStat);break;case "length":G=d.getLength(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits,this.tab.advStat);break;case "sum":G=d.getSum(this.summaryFeatures,F);break;case "avg":G=d.getSum(this.summaryFeatures,F)/this.summaryFeatures.length;break;case "min":G=d.getMin(this.summaryFeatures,F);break;case "max":G=d.getMax(this.summaryFeatures,F)}E.total=G}},_processResults:function(g){this._prepResults();
var E=this.summaryFields,F=0;if(g)var G=new L;else{this.container.innerHTML="";r.remove(this.container,"loading");if(0===this.summaryFeatures.length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var D=u.create("div",{},this.container);r.add(D,"SAT_tabPanelContent");var k=u.create("div",{},D);r.add(k,"SATcolExport");r.add(k,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var n=u.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV,
tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"summaryDownLoadCSVButton"},k);K.initFirstFocusNode(this.parentNode,n);K.initLastFocusNode(this.parentNode,n);r.add(n,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);r.add(n,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");n.focus();w(n,"click",z.hitch(this,this._exportToCSV,E));w(n,"keydown",z.hitch(this,function(N){if(!N.shiftKey||N.keyCode!==x.TAB)if(N.keyCode===x.TAB&&n.focus(),
N.keyCode===x.ENTER||N.keyCode===x.SPACE)this._exportToCSV(E,N),setTimeout(function(){n.focus()},500)}))}k=[];for(var f=0;f<E.length;f++){var y=E[f],I=K.stripHTML(y.alias?y.alias:"")+"\x3cbr/\x3e";y=d.formatNumber(y.total,y);F=y.total;y=y.num;if(g)k.push({num:y,info:I,total:F});else{F=u.create("div",{"class":"SATcol"},D);r.add(F,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var C=u.create("div",{style:"max-height: 60px;"},F);u.create("div",{"class":" SATcolWrap",style:"max-height: 30px; overflow: hidden;",
innerHTML:I},C);u.create("div",{"class":" colSummary",innerHTML:y},F)}}D=[];f=null!==this.graphicsLayer;!g&&f&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(I=0;I<this.summaryFeatures.length;I++)y=this.summaryFeatures[I],this.lyrSymbol?y.symbol=this.lyrSymbol:f&&this.graphicsLayer.renderer?(F=this.graphicsLayer.renderer.getSymbol(y),y.symbol=F):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(y.symbol=this.summaryLayer.renderer.getSymbol(y)),
y=y.toJson?new b(y.toJson()):y,!g&&f?(this.graphicsLayer.add(y),this.tab.tabLayers[1].add(y)):D.push(y);!g&&f&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.restore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(g)return G.resolve({graphics:D,analysisResults:k,context:this}),G},_exportToCSV:function(g,E,F,G){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var D=this.parent.config.exportFieldsOptionForCSV;
else this.parent.config.hasOwnProperty("csvAllFields")&&(D=this.parent.config.csvAllFields);g=d.exportToCSV(this.summaryFeatures,E,F,G,{type:"summary",baseLabel:this.baseLabel,csvAllFields:D,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.summary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,calcFields:this.calcFields,allFields:this.allFields,configuredPopUpFields:this.configuredPopUpFields});this.summaryLayer=g.summaryLayer;return g.details},_getFieldInfoByFieldInfo:function(g,
E,F){return this._getFieldInfo(g[E],E,F)},_getFieldInfoByName:function(g,E){var F=["count","area","length","tabCount"],G;for(G in g)if(-1===F.indexOf(G))return this._getFieldInfo(g[G],G,E)},_getFieldInfo:function(g,E,F){for(var G=0;G<g.length;G++){var D=g[G];if(D.expression&&D.expression===F)return{field:{field:D.expression,alias:D.label,type:E,modify:D.modify,round:D.round,roundPlaces:D.roundPlaces,truncate:D.truncate,truncatePlaces:D.truncatePlaces,total:0,show1KSeparator:"undefined"!==typeof D.show1KSeparator?
D.show1KSeparator:!0},index:G}}},_getFields:function(g){this.layerDefinition=K.getFeatureLayerDefinition(g);this.layerObject=g;var E=d.getSkipFields(g),F=[];if("undefined"!==typeof this.tab.advStat){var G=z.clone(this.tab.advStat.stats);this.tab.advStat.fieldOrder&&Q.forEach(this.tab.advStat.fieldOrder,z.hitch(this,function(N){if((N=N&&N.hasOwnProperty("fieldName")?this._getFieldInfoByFieldInfo(G,N.fieldType,N.fieldName):this._getFieldInfoByName(G,N))&&N.field){var R=G[N.field.type];R.splice(N.index,
1);0===R.length&&delete G[N.field.type];F.push(N.field)}}));for(var D in G)0<G[D].length&&Q.forEach(G[D],function(N){F.push({field:N.expression,alias:N.label,type:D,modify:N.modify,round:N.round,roundPlaces:N.roundPlaces,truncate:N.truncate,truncatePlaces:N.truncatePlaces,total:0,show1KSeparator:"undefined"!==typeof N.show1KSeparator?N.show1KSeparator:!0})})}else{if(g.infoTemplate)var k=g.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var n=this.tab.tabLayers[0].url.split("MapServer/")[1],
f=this.parent.map.itemInfo.itemData.operationalLayers;k=null;for(var y=0;y<f.length;y++){var I=f[y];if(I.layerObject.infoTemplates&&(I=I.layerObject.infoTemplates[n])){k=I.infoTemplate.info.fieldInfos;break}}}else k=g.fields;k||(k=g.fields);for(n=0;n<k.length;n++)if(f=k[n],"undefined"!==typeof g.fields){y=g.fields[n].type;var C;f.name===g.objectIdField||"esriFieldTypeDouble"!==y&&"esriFieldTypeInteger"!==y&&"esriFieldTypeSmallInteger"!==y||("undefined"!==typeof f.visible?f.visible&&(C={field:f.fieldName,
alias:f.label,type:"sum",total:0}):C={field:f.name,alias:f.alias,type:"sum",total:0},C&&-1===E.indexOf(C.field)&&F.push(C),C=null)}}this.calcFields=z.clone(F);if(this.allFields)for(k=0;k<g.fields.length;k++){C=g.fields[k];n=!0;f=0;b:for(;f<F.length;f++)if(C.name===F[f].field){n=!1;break b}-1===E.indexOf(C.name)&&n&&F.push({field:C.name,alias:C.alias,type:C.type})}g=d.getSpecialFields(g);this.dateFields=g.dateFields;this.specialFields=g.specialFields;this.typeIdField=g.typeIdField;this.types=g.types;
return F}})})},"widgets/SituationAwareness/js/analysisUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/dom-style esri/tasks/query esri/geometry/geometryEngine esri/geometry/Polyline ./CSVUtils jimu/utils".split(" "),function(P,J,Q,V,L,z,r,u,w,x){function K(c){return function(b,q){return b.attributes[c]<q.attributes[c]?-1:b.attributes[c]>q.attributes[c]?1:0}}return{getFields:function(c,b,q,m){var e=this.getSkipFields(c),d=[];if(!q&&b.advStat&&b.advStat.stats&&
b.advStat.stats.outFields&&0<b.advStat.stats.outFields.length)P.forEach(b.advStat.stats.outFields,function(D){d.push(D.expression)});else{if(c.infoTemplate)b=c.infoTemplate.info.fieldInfos;else if(0<m.map.itemInfo.itemData.operationalLayers.length){m=m.map.itemInfo.itemData.operationalLayers;b=null;var g=0;a:for(;g<m.length;g++){var E=m[g];if("ArcGISMapServiceLayer"===E.layerType&&"undefined"!==typeof E.layers)for(var F=0;F<E.layers.length;F++){var G=E.layers[F];if(G.id===c.layerId&&G.popupInfo){b=
G.popupInfo.fieldInfos;break a}}}b||(b=c.fields)}else b=c.fields;if(b)for(m=0;m<b.length;m++)g=b[m],q||"undefined"===typeof g.visible?(g=g.name?g.name:g.fieldName,-1===e.indexOf(g)&&d.push(g)):g.visible&&-1===e.indexOf(g.fieldName)&&d.push(g.fieldName)}c=this.getSpecialFields(c);return{dateFields:c.dateFields,specialFields:c.specialFields,typeIdField:c.typeIdField,types:c.types,fields:3<d.length&&!q?d.slice(0,3):d,allFields:d}},getField:function(c,b){for(var q=0;q<c.length;q++){var m=c[q];if(m.name===
b||m.alias===b)return m}},getFieldValue:function(c,b,q,m,e,d,g,E,F,G){g=!1;var D=b;d="string"===typeof D?!0:!1;q[c]&&(g="esriFieldTypeDate"===q[c].type)&&D&&(-1<Object.keys(m).indexOf(c)?(q=m[c],e="undefined"!==typeof q?{dateFormat:q}:{dateFormat:e}):e={dateFormat:e},D=x.fieldFormatter.getFormattedDate(new Date(b),e));!g&&E&&F&&(D=(c=x.getDisplayValueForCodedValueOrSubtype(E,c,F))&&c.hasOwnProperty("displayValue")&&c.isCodedValueOrSubtype?c.displayValue:d?c.displayValue:this.formatNumber(D,G).num);
return D},getSkipFields:function(c){var b=[];if(c.fields)for(var q=0;q<c.fields.length;q++){var m=c.fields[q];m&&m.type&&m.name&&"esriFieldTypeGeometry"===m.type&&b.push(m.name)}return b},getSpecialFields:function(c){var b={},q=[];c.fields&&P.forEach(c.fields,J.hitch(this,function(m){if("esriFieldTypeDate"===m.type||m.domain||m.name===c.typeIdField){if("esriFieldTypeDate"===m.type&&c.infoTemplate)for(var e in c.infoTemplate._fieldsMap)"undefined"!==typeof c.infoTemplate._fieldsMap[e].fieldName&&c.infoTemplate._fieldsMap[e].fieldName===
m.name&&c.infoTemplate._fieldsMap[e].format&&"undefined"!==typeof c.infoTemplate._fieldsMap[e].format.dateFormat&&(q[m.name]=c.infoTemplate._fieldsMap[e].format.dateFormat);b[m.name]=m}}));return{specialFields:b,dateFields:q,typeIdField:c.typeIdField,types:c.types}},getSummaryFields:function(){},getPopupFields:function(c){var b=[];0<c.tabLayers.length&&P.forEach(c.tabLayers,J.hitch(this,function(q){var m=this.getSkipFields(q);"undefined"!==typeof q.popupInfo?P.forEach(q.popupInfo.fieldInfos,J.hitch(this,
function(e){if(e.visible&&-1===m.indexOf(e.fieldName)){var d={value:0};d.expression=e.fieldName;d.label=e.label;b.push(d)}})):q.infoTemplate&&P.forEach(q.infoTemplate.info.fieldInfos,J.hitch(this,function(e){if(e.visible&&-1===m.indexOf(e.fieldName)){var d={value:0};d.expression=e.fieldName;d.label=e.label;b.push(d)}}))}));return b},getDisplayFields:function(c){if("undefined"!==typeof c.advStat&&"undefined"!==typeof c.advStat.stats&&"undefined"!==typeof c.advStat.stats.outFields)var b=c.advStat.stats.outFields;
else b=[],0<c.tabLayers.length&&P.forEach(c.tabLayers,J.hitch(this,function(q){"undefined"!==typeof q.popupInfo?P.forEach(q.popupInfo.fieldInfos,J.hitch(this,function(m){if(m.visible){var e={value:0};e.expression=m.fieldName;e.label=m.label;b.push(e)}})):q.infoTemplate?P.forEach(q.infoTemplate.info.fieldInfos,J.hitch(this,function(m){if(m.visible){var e={value:0};e.expression=m.fieldName;e.label=m.label;b.push(e)}})):P.forEach((q.layerObject?q.layerObject:q).fields,J.hitch(this,function(m){var e=
{value:0};e.expression=m.name;e.label=m.alias;b.push(e)}))}));return b},exportToCSV:function(c,b,q,m,e){if(0===c.length)return!1;var d=e.baseLabel,g=[],E=[];"proximity"===e.type&&c.sort(this.compareDistance);if("undefined"===typeof b.altKey)var F=b;else F=!1,q=e.csvAllFields;P.forEach(c,J.hitch(this,function(H){"closest"===e.type&&delete H.attributes.DISTANCE;"proximity"===e.type&&(H.attributes.DISTANCE=this.getDistanceLabel(H.attributes.DISTANCE,e.unit,e.approximateLabel));g.push(H.attributes)}));
if("summary"===e.type||"grouped"===e.type)if(e.hasOwnProperty("csvAllFields")&&"allFields"===e.csvAllFields||e.hasOwnProperty("csvAllFields")&&(!0===e.csvAllFields||"true"===e.csvAllFields))for(var G in g[0])E.push(G);else if(e.hasOwnProperty("csvAllFields")&&"popUpFields"===e.csvAllFields)if(e.allFields)for(c=0;c<e.summaryFields.length;c++)E.push(e.summaryFields[c].field);else if(0===e.configuredPopUpFields.length)g=[],g.push({});else for(c=0;c<e.configuredPopUpFields.length;c++)E.push(e.configuredPopUpFields[c]);
else for(c=0;c<e.summaryFields.length;c++)E.push(e.summaryFields[c].field);else for(var D in g[0])E.push(D);c=e.layer;G=c.fields;if(c&&c.loaded&&G||F){D=b?[]:this.getSkipFields(c);var k={};if(e.opLayers&&e.opLayers._layerInfos){var n=e.opLayers.getLayerInfoById(c.id);n?k.popupInfo=n.getPopupInfo():"undefined"!==typeof c.popupInfo?k.popupInfo=c.popupInfo:c.infoTemplate&&(k.popupInfo=c.infoTemplate.info)}n=[];var f=0;for(;f<E.length;f++){var y=E[f];if(-1===D.indexOf(y)){var I=!1,C=0;b:for(;C<G.length;C++){var N=
G[C];if(N.name===y){I=!0;break b}}I?n.push(N):n.push({name:y,alias:y,show:!0,type:"esriFieldTypeString"})}}k.datas=g;k.fromClient=!1;k.withGeometry=!1;k.outFields=n;k.formatDate=!0;k.formatCodedValue=!0;k.formatNumber=!1;var R=[],a=[];if(!b&&q&&"undefined"!==typeof m)switch(e.type){case "proximity":R.push(e.nlsCount);a.push(m);break;case "closest":var v=0;P.forEach(m,J.hitch(this,function(H){0===v&&(P.forEach(H,function(h){R.push(h.label)}),v+=1);var l=[];P.forEach(H,function(h){l.push(h.value)});
a.push(l)}));break;case "summary":P.forEach(m,J.hitch(this,function(H){var l=H.info.replace("\x3cbr/\x3e",""),h=!1,A=0;a:for(;A<e.calcFields.length;A++)if(l===e.calcFields[A].alias){h=!0;break a}h&&(R.push(l),a.push(H.total))}));break;case "grouped":P.forEach(m,function(H){R.push(H.info.replace("\x3cbr/\x3e",""));a.push(H.total)})}if(F)return{summaryLayer:c,details:n};w.exportCSVFromFeatureLayer(d,c,k);return{summaryLayer:c,details:{appendColumns:R,appendDatas:a,name:d,type:e.nlsValue}}}w.exportCSV(d,
g,E)},isURL:function(c){return/(https?:\/\/|ftp:)/g.test(c)},isEmail:function(c){return/\S+@\S+\.\S+/.test(c)},queryTabCount:function(){},performQuery:function(){},getFilter:function(c,b){var q="";b.traversal(function(m){if(c===m.id&&m.getFilter())return q=m.getFilter(),!0});return q},getGeoms:function(c){for(var b=[],q=[],m=0;m<c.length;m++){var e=c[m].geometry?c[m].geometry:c[m];if("polygon"===e.type&&-1===b.indexOf(m)){for(var d=0;d<c.length;d++)if(d!==m&&-1===b.indexOf(d)){var g=c[d].geometry?
c[d].geometry:c[d];"polygon"===g.type?r.intersects(e,g)&&(b.push(d),e=r.union(e,g)):b.push(d)}q.push(e)}}return q},createDefArray:function(c,b,q,m){for(var e=[],d=0;d<c.length;d++){var g=c[d];if(g){var E=new z;E.returnGeometry=!1;E.geometry=b;var F=-1===[null,void 0,""].indexOf(g.id)?g.id:m.layers;E.where=this.getFilter(F,q);"undefined"!==typeof g.queryCount?e.push(g.queryCount(E)):"undefined"!==typeof g.queryIds?e.push(g.queryIds(E)):"undefined"!==typeof g.queryFeatures&&e.push(g.queryFeatures(E))}}return e},
updateTabCount:function(c,b,q,m,e){var d="undefined"!==typeof e&&0<e?!0:!1;e=V.position(b).w;"undefined"!==typeof c&&0===c?(Q.remove(b,"noFeatures"),Q.remove(b,"noFeaturesActive"),Q.add(b,d?"noFeaturesActive":"noFeatures")):(d&&Q.contains(b,"noFeatures")&&Q.remove(b,"noFeatures"),d&&Q.contains(b,"noFeaturesActive")&&Q.remove(b,"noFeaturesActive"));q&&(c="undefined"!==typeof c?m+" ("+x.localizeNumber(c).toString()+")":m,b.innerHTML=c);q=V.position(b).w;c=0;if(q>e){var g=!0;c=q-e}else e>q&&(g=!1,c=
e-q);e=V.position(b.parentNode).w;if(0<e){g=g?e+c:e-c;L.set(b.parentNode,"width",g+"px");b=b.parentNode.parentNode;e=b.parentNode;if(e&&e.children&&0<e.children.length)for(c=0;c<e.children.length;c++)if(q=e.children[c],window.isRTL){if(-1<q.className.indexOf("SA_panelLeft")&&q){var E=q;break}}else if(-1<q.className.indexOf("SA_panelRight")){var F=q;break}E&&b&&(g>V.position(e).w?(L.set(b,"left","58px"),L.set(E,"display","block")):(L.set(b,"left","24px"),L.set(E,"display","none")));F&&b&&(g>V.position(e).w?
(L.set(b,"right","58px"),L.set(F,"display","block")):(L.set(b,"right","24px"),L.set(F,"display","none")))}},getDistanceLabel:function(c,b,q){return Math.round(100*c)/100+" "+b+" ("+q+")"},getSum:function(c,b){var q=0;P.forEach(c,function(m){q+=m.attributes[b]});return q},getMin:function(c,b){c.sort(K(b));return c[0].attributes[b]},getMax:function(c,b){c.sort(K(b));c.reverse();return c[0].attributes[b]},getArea:function(c,b,q,m,e){var d=0;q=J.clone(q);q.miles=109413;q.kilometers=109414;q.feet=109405;
q.meters=109404;q.yards=109442;q.nauticalMiles=109409;var g=q[m],E;e&&e.stats&&e.stats.area&&0<e.stats.area.length&&(E=e.stats.area[0]);P.forEach(c,function(F){for(var G=0;G<b.length;G++){var D=r.intersect(F.geometry,b[G]);if(null!==D){var k=D.spatialReference;d=4326===k.wkid||k.isWebMercator()||k.isGeographic&&k.isGeographic()?d+r.geodesicArea(D,g):d+r.planarArea(D,g)}}});return this.formatNumber(d,E).total},getLength:function(c,b,q,m,e){var d=0,g=q[m],E;e&&e.stats&&e.stats.length&&0<e.stats.length.length&&
(E=e.stats.length[0]);P.forEach(c,function(F){for(var G=0;G<b.length;G++){var D=r.intersect(F.geometry,b[G]);if(null!==D){var k=D.spatialReference;d=4326===k.wkid||k.isWebMercator()||k.isGeographic&&k.isGeographic()?d+r.geodesicLength(D,g):d+r.planarLength(D,g)}}});return this.formatNumber(d,E).total},getDistance:function(c,b,q){var m="point"!==c.type?c.getExtent().getCenter():c;b="point"!==b.type?b.getExtent().getCenter():b;m=new u([[m.x,m.y],[b.x,b.y]]);m.spatialReference=c.spatialReference;q="nauticalMiles"===
q?"nautical-miles":q;return 4326===c.spatialReference.wkid||c.spatialReference.isWebMercator()?r.geodesicLength(m,q):r.planarLength(m,q)},compareDistance:function(c,b){return c.attributes.DISTANCE<b.attributes.DISTANCE?-1:c.attributes.DISTANCE>b.attributes.DISTANCE?1:0},formatNumber:function(c,b){var q=c;if(!isNaN(c)&&null!==c&&""!==c){q=b&&b.modify&&!isNaN(c);var m;q&&"undefined"!==typeof b.truncatePlaces&&!isNaN(b.truncatePlaces)&&(m=new RegExp(0<b.truncatePlaces?"^\\d*[.]?\\d{0,"+b.truncatePlaces+
"}":"^\\d*"));q=q&&b.round?1*c.toFixed(b.roundPlaces):q&&b.truncate?1*m.exec(c)[0]:c;isNaN(q)&&(q=0)}c=q;isNaN(q)||null===q||""===q||!(b=b&&b.show1KSeparator)&&"undefined"!==typeof b||(c=x.localizeNumber(q));return{total:q,num:c}},getPopupConfiguredFields:function(c){var b=[];"undefined"!==typeof c.popupInfo?P.forEach(c.popupInfo.fieldInfos,J.hitch(this,function(q){q.visible&&b.push(q.fieldName)})):c.infoTemplate&&P.forEach(c.infoTemplate.info.fieldInfos,J.hitch(this,function(q){q.visible&&b.push(q.fieldName)}));
return b}}})},"widgets/SituationAwareness/js/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(P,J,Q,V,L,z,r,u,w,x){function K(c){var b=J.clone(c.attributes);(c=c.geometry)&&"point"===c.type&&("x"in b?b._x=c.x:b.x=c.x,"y"in b?b._y=c.y:b.y=c.y);return b}P.exportCSV=function(c,b,q,m,e){return P._createCSVStr(b,q,m,e).then(function(d){return P._download(c+".csv",
d)})};P.exportCalculatedResultsCSV=function(c,b){var q="",m=0;Q.forEach(b,function(e){q+=e.name+" ("+e.type+")\r\n";P._createCSVStr([],[],e.appendColumns,e.appendDatas).then(function(d){q+=d;m++;if(m===b.length)return P._download(c+".csv",q);q+="\r\n\r\n"})})};P.exportCSVFromFeatureLayer=function(c,b,q){q=q||{};return P._getExportData(b,{datas:q.datas,fromClient:q.fromClient,withGeometry:q.withGeometry,outFields:q.outFields,filterExpression:q.filterExpression}).then(function(m){return P._formattedData(b,
m,{formatNumber:q.formatNumber,formatDate:q.formatDate,formatCodedValue:q.formatCodedValue,popupInfo:q.popupInfo,appendColumns:q.appendColumns,appendDatas:q.appendDatas}).then(function(e){return P.exportCSV(c,e.datas,e.columns,e.appendColumns,e.appendDatas)})})};P.exportCSVByAttributes=function(c,b,q,m){m=J.mixin({},m);m.datas=q;return P.exportCSVFromFeatureLayer(c,b,m)};P.exportCSVByGraphics=function(c,b,q,m){q=Q.map(q,function(e){return e.attributes});return P.exportCSVByAttributes(c,b,q,m)};P._createCSVStr=
function(c,b,q,m){var e=new z,d="",g=0,E=0,F="",G="";try{if(b&&0<b.length){Q.forEach(b,function(n){d=d+F+n;F=","});d+="\r\n";g=c.length;E=b.length;for(var D=0;D<g;D++){F="";for(var k=0;k<E;k++)(G=c[D][b[k]])||"number"===typeof G||(G=""),G&&/[",\r\n]/g.test(G)&&(G='"'+G.replace(/(")/g,'""')+'"'),d=d+F+G,F=",";d+="\r\n"}}"undefined"!==typeof q&&"undefined"!==typeof m&&0<q.length&&0<m.length&&(F="",Q.forEach(q,function(n){d=d+F+n;F=","}),F="",d+="\r\n",Q.forEach(m,function(n){Array.isArray(n)?(Q.forEach(n,
function(f){d=d+F+f;F=","}),F="",d+="\r\n"):(d=d+F+n,F=",")}));e.resolve(d)}catch(n){console.error(n),e.resolve("")}return e};P._isIE11=function(){return 11===r.has("ie")};P._isEdge=function(){return r.has("edge")};P._getDownloadUrl=function(c){return window.Blob&&window.URL&&window.URL.createObjectURL?(c=new Blob(["\ufeff"+c],{type:"text/csv"}),URL.createObjectURL(c)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(c)};P._download=function(c,b){var q=new z;try{if(L("ie")&&10>L("ie")){var m=
window.top.open("about:blank","_blank");m.document.write("sep\x3d,\r\n"+b);m.document.close();m.document.execCommand("SaveAs",!0,c);m.close()}else if(10===L("ie")||P._isIE11()||P._isEdge()){var e=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(e,c)}else{var d=V.create("a",{href:P._getDownloadUrl(b),target:"_blank",download:c},document.body);if(L("safari")){var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);d.dispatchEvent(g)}else d.click();V.destroy(d)}q.resolve()}catch(E){q.reject(E)}return q};
P._getExportData=function(c,b){var q=new z,m=null,e=b.datas,d=b.withGeometry;m=b.outFields;m&&m.length||(m=c.fields);m=J.clone(m);if(d&&!(e&&0<e.length)){var g="";g=-1!==m.indexOf("x")?"_x":"x";m.push({name:g,alias:g,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});g=-1!==m.indexOf("y")?"_y":"y";m.push({name:g,alias:g,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}e&&0<e.length?q.resolve({data:e||[],outFields:m}):b.fromClient?(e=Q.map(c.graphics,function(E){return d?
K(E):J.clone(E)}),q.resolve({data:e||[],outFields:m})):P._getExportDataFromServer(c,m,b).then(function(E){q.resolve({data:E||[],outFields:m})});return q};P._getExportDataFromServer=function(c,b,q){var m=new z;if("esri.layers.FeatureLayer"!==c.declaredClass)return m.resolve([]),m;var e=new w(c.url),d=new x;d.where=q.filterExpression||c.getDefinitionExpression&&c.getDefinitionExpression()||"1\x3d1";0<b.length?(c=Q.map(b,function(g){return g.name}),d.outFields=c):d.outFields=["*"];d.returnGeometry=q.withGeometry;
e.execute(d,function(g){g=Q.map(g.features,function(E){return K(E)});m.resolve(g)},function(g){console.error(g);m.resolve([])});return m};P._formattedData=function(c,b,q){var m=new z,e=[],d=b.data;b=b.outFields;for(var g=r.getFeatureLayerDefinition(c),E=0,F=d.length;E<F;E++){for(var G={},D=0;D<b.length;D++){var k=b[D];G[k.alias||k.name]=P._getExportValue(d[E][k.name],k,c.objectIdField,c.typeIdField,d[E][c.typeIdField],c.types,q,g,d[E],c)}e.push(G)}c=Q.map(b,function(n){return n.alias||n.name});m.resolve({datas:e,
columns:c,appendColumns:q.appendColumns,appendDatas:q.appendDatas});return m};P._getExportValue=function(c,b,q,m,e,d,g,E,F,G){function D(y){if(k&&u.isDefined(k.fieldInfos))for(var I=0,C=k.fieldInfos.length;I<C;I++){var N=k.fieldInfos[I];if(N.fieldName===y)return N.format}return null}var k=g.popupInfo,n=!!b.domain&&g.formatCodedValue;g="esriFieldTypeDate"===b.type&&g.formatDate;var f=q&&b.name===q;m=m&&b.name===m;G=G&&G.renderer?G:E;return g?(c=r.fieldFormatter.getFormattedDate(c,D(b.name)),-1<c.indexOf(",")?
c.replace(",",""):c):(m||n)&&E&&F&&(E=r.getDisplayValueForCodedValueOrSubtype(G,b.name,F))&&E.hasOwnProperty("displayValue")?E.displayValue:n||g||f||m?c:(n=null,q&&d&&0<d.length&&(q=(q=Q.filter(d,function(y){return y.id===e}))&&q[0])&&q.domains&&q.domains[b.name]&&q.domains[b.name].codedValues&&(b=r.getDisplayValueForCodedValueOrSubtype(G,b.name,F))&&b.hasOwnProperty("displayValue")&&(n=b.displayValue),null!==n?n:c)}})},"widgets/SituationAwareness/js/GroupedCountInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/keys jimu/utils jimu/dijit/Message esri/graphic esri/layers/FeatureLayer esri/tasks/query ./analysisUtils".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e){return P("GroupedCountInfo",[J],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,popupFields:[],groupedResults:{},specialFields:null,dateFields:{},symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,incidentCount:0,displayCount:!1,allFields:!1,configuredPopUpFields:[],constructor:function(d,g,E){this.tab=d;this.container=g;this.parent=E;this.config=E.config;this.graphicsLayer=null;this.specialFields=
{};this.typeIdField="";this.types=[];this.dateFields={};this.baseLabel=""!==d.label?d.label:d.layerTitle?d.layerTitle:d.layers;this.parentNode=E.domNode},queryTabCount:function(d,g,E,F){var G=new L;this.displayCount=F;this.incidentCount=d.length;var D=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(D=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==
typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(d,g,E,F,D).then(function(n){G.resolve(n)});else{var k=new q(this.summaryLayer.url);k.infoTemplate=this.tab.tabLayers[0].infoTemplate;D=[k];this.tab.tabLayers=D;w(k,"load",z.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(d,
g,E,F,D).then(function(n){G.resolve(n)})}))}else this.loading||(k=new q(this.tab.tabLayers[0].url),this.loading=!0,w(k,"load",z.hitch(this,function(){this.summaryLayer=k;this.summaryFields=this._getFields(this.summaryLayer);for(var n=this.tab.tabLayers[0].url.split("MapServer/")[1],f=this.parent.map.itemInfo.itemData.operationalLayers,y=0;y<f.length;y++){var I=f[y];if(-1<this.tab.tabLayers[0].url.indexOf(I.url)&&"undefined"!==typeof I.layerObject)if(I.layerObject.infoTemplates){if(I=I.layerObject.infoTemplates[n]){k.infoTemplate=
I.infoTemplate;break}}else if(I.layerObject.infoTemplate){k.infoTemplate=I.layerObject.infoTemplate;break}}D=[k];this.tab.tabLayers=D;this.loading=!1;this._performQuery(d,g,E,F,D).then(function(C){G.resolve(C)})})));this.mapServiceLayer||this._performQuery(d,g,E,F,D).then(function(n){G.resolve(n)});return G},_performQuery:function(d,g,E,F,G){var D=new L,k=[],n;0<g.length?n=e.getGeoms(g):0<d.length&&(n=e.getGeoms(d));this.summaryGeoms=n;if(0<n.length)for(d=0;d<n.length;d++){k=n[d];g=e.createDefArray(G,
k,this.parent.opLayers,this.tab);var f=0===d?k=g:k=f.concat(g)}(new V(k)).then(z.hitch(this,function(y){for(var I=0,C=0;C<y.length;C++){var N=y[C][1];isNaN(N)?N&&N.features?I+=N.features.length:N&&"undefined"!==typeof N.length&&(I+=N.length):I+=N}this.updateTabCount(I,E,F);this.queryOnLoad&&z.hitch(this,this._queryFeatures(this.summaryGeoms));D.resolve(I)}));return D},updateTabCount:function(d,g,E){this.displayCount=E;this.featureCount=d;e.updateTabCount(this.featureCount,g,E,this.baseLabel,this.incidentCount)},
updateForIncident:function(d,g,E,F,G,D,k){this.incidentCount=d.length;this.allFields="undefined"!==typeof D&&"undefined"!==typeof k?D?!0:k:!1;var n="undefined"!==typeof G;this.tabNum=F;if(n)var f=new L;else this.container.innerHTML="",r.add(this.container,"loading");this.summaryIds=[];this.summaryFeatures=[];this.groupedResults={};if(0<this.tab.tabLayers.length){var y=[];if(0<g.length)y=g;else for(g=0;g<d.length;g++)F=d[g].geometry?d[g].geometry:d[g],"polygon"===F.type&&y.push(F);if("undefined"!==
typeof this.tab.tabLayers[0].infoTemplate){this.summaryLayer=this.tab.tabLayers[0];var I=new q(this.summaryLayer.url);I.infoTemplate=this.tab.tabLayers[0].infoTemplate;this.tab.tabLayers[1]=I;this.summaryFields=this._getFields(this.tab.tabLayers[0]);this.configuredPopUpFields=e.getPopupConfiguredFields(this.tab.tabLayers[0]);n?this._queryFeatures(y,n).then(function(C){f.resolve(C)}):(this._initGraphicsLayer(E),z.hitch(this,this._queryFeatures(y)))}else I=new q(this.tab.tabLayers[0].url),w(I,"load",
z.hitch(this,function(){this.summaryLayer=I;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var C=this.tab.tabLayers[0].url.split("MapServer/")[1],N=this.parent.map.itemInfo.itemData.operationalLayers,R=0;R<N.length;R++){var a=N[R];if(-1<this.tab.tabLayers[0].url.indexOf(a.url)&&"undefined"!==typeof a.layerObject&&a.layerObject.infoTemplates&&(a=a.layerObject.infoTemplates[C])){I.infoTemplate=a.infoTemplate;break}}this.tab.tabLayers[1]=I;this.summaryLayer=this.tab.tabLayers[1];this.summaryFields=
this._getFields(this.tab.tabLayers[1]);this.configuredPopUpFields=e.getPopupConfiguredFields(this.tab.tabLayers[1]);n?this._queryFeatures(y,n).then(function(v){f.resolve(v)}):(this._initGraphicsLayer(E),z.hitch(this,this._queryFeatures(y)))}));if(n)return f}},_initGraphicsLayer:function(d){null!==d&&(this.graphicsLayer=d,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==
typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(d,g){var E;g&&(E=new L);var F=[],G=-1===[null,void 0,""].indexOf(this.tab.tabLayers[0].id)?this.tab.tabLayers[0].id:this.tab.layers;G=e.getFilter(G,this.parent.opLayers);for(var D=new m,k=0;k<d.length;k++)D.geometry=d[k],D.where=G,F.push(this.summaryLayer.queryIds(D));(new V(F)).then(z.hitch(this,function(n){for(var f,y,I=0;I<
n.length;I++)n[I][0]&&(f=n[I][1],y=f=0===I?f:y.concat(f));f?(this.summaryIds=f,0<this.summaryIds.length?g?this._queryFeaturesByIds(g).then(function(C){E.resolve(C)}):this._queryFeaturesByIds():g||this._processResults()):g||this._processResults()}),z.hitch(this,function(n){console.error(n);new c({message:n})}));if(g)return E},_queryFeaturesByIds:function(d){var g,E=[];d&&(g=new L);var F=this.summaryLayer.maxRecordCount||1E3,G=this.summaryIds.slice(0,F);this.summaryIds.splice(0,F);var D=new m,k=-1===
[null,void 0,""].indexOf(this.summaryLayer.id)?this.summaryLayer.id:this.tab.layers;D.where=e.getFilter(k,this.parent.opLayers);var n=!1;Q.some(this.summaryFields,z.hitch(this,function(f){if("area"===f.type||"length"===f.type||this.graphicsLayer)return n=!0}));d&&(n=!0);this.summaryLayer.supportsAdvancedQueries&&(D.orderByFields=[this.summaryFields[0].field]);D.returnGeometry=n;D.outSpatialReference=this.parent.map.spatialReference;D.outFields=["*"];D.objectIds=G;for(E.push(this.summaryLayer.queryFeatures(D));0<
this.summaryIds.length;)G=this.summaryIds.slice(0,F),this.summaryIds.splice(0,F),D.objectIds=G,E.push(this.summaryLayer.queryFeatures(D));(new V(E)).then(z.hitch(this,function(f){this.summaryFeatures=[];for(var y=0;y<f.length;y++)if(f[y][0]){var I=f[y][1];I.features&&(this.summaryFeatures=this.summaryFeatures.concat(I.features))}d?this._processResults(d).then(z.hitch(this,function(C){this.SA_SAT_download&&r.replace(this.SA_SAT_download,"download","processing");g.resolve(C)})):(this._processResults(),
this.SA_SAT_download&&r.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&r.replace(this.SA_SAT_download,"download","processing")}),z.hitch(this,function(f){console.error(f);new c({message:f})}));if(d)return g},_prepGroupedResults:function(){for(var d=0;d<this.summaryFeatures.length;d++){var g=this.summaryFeatures[d];if("undefined"!==typeof this.summaryFields&&0<this.summaryFields.length){var E=e.getFieldValue(this.summaryFields[0].field,g.attributes[this.summaryFields[0].field],
this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,g.attributes);E="undefined"!==typeof E&&null!==E?K.stripHTML(E.toString()):"";E in this.groupedResults?this.groupedResults[E].features.push(g):this.groupedResults[E]={features:[g]}}}},_prepResults:function(){for(var d in this.groupedResults){var g=this.summaryFields[0];g.total=this.groupedResults[d].features.length;this.groupedResults[d].total=
g.total;this.groupedResults[d].type=g.type;this.groupedResults[d].label=g.alias}},_processResults:function(d){this._prepGroupedResults();this._prepResults();var g=this.groupedResults,E=0;if(d)var F=new L;else{this.container.innerHTML="";r.remove(this.container,"loading");if(0===Object.keys(this.groupedResults).length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var G=u.create("div",{},this.container);r.add(G,"SAT_tabPanelContent");var D=u.create("div",{},G);r.add(D,"SATcolExport");
r.add(D,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var k=u.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSVdownloadCSV,"class":"grpSummaryDownLoadCSVButton"},D);r.add(k,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);r.add(k,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");k.focus();K.initFirstFocusNode(this.parentNode,k);K.initLastFocusNode(this.parentNode,
k);w(k,"click",z.hitch(this,this._exportToCSV,g));w(k,"keydown",z.hitch(this,function(a){if(!a.shiftKey||a.keyCode!==x.TAB)if(a.keyCode===x.ENTER||a.keyCode===x.SPACE)this._exportToCSV(g,a),setTimeout(function(){k.focus()},500)}))}var n=Object.keys(g).sort();D=[];this.displayCount&&D.push({total:this.featureCount,a:void 0,info:this.parent.nls.count,c:void 0});for(var f in n){E=n[f];var y=g[E],I=K.stripHTML(E.toString());E=y.total;isNaN(E)&&(E=0);E=K.localizeNumber(E);var C="pre"===y.type?y.label.trim():
I;I="pre"===y.type?I:y.label.trim();y=""!==y.label?"colGroupedSummary":"colSummary";if(d)D.push({total:E,a:C,info:""===I?C:I,c:y});else{var N=u.create("div",{"class":"SATcol"},G);r.add(N,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var R=u.create("div",{style:"max-height: 45px;"},N);u.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:C},R);u.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:I},R);u.create("div",
{"class":y,innerHTML:E},N)}}G=[];f=null!==this.graphicsLayer;!d&&f&&(this.graphicsLayer.clear(),this.tab.tabLayers[1]&&this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(n=0;n<this.summaryFeatures.length;n++)E=this.summaryFeatures[n],this.lyrSymbol?E.symbol=this.lyrSymbol:this.graphicsLayer?this.graphicsLayer.renderer&&(C=this.graphicsLayer.renderer.getSymbol(E),E.symbol=C):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(E.symbol=this.summaryLayer.renderer.getSymbol(E)),
E=E.toJson?new b(E.toJson()):E,!d&&f?(this.graphicsLayer.add(E),this.tab.tabLayers[1].add(E)):G.push(E);!d&&f&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.retsore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(d)return F.resolve({graphics:G,analysisResults:D,context:this}),F},_exportToCSV:function(d,g,E,F){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var G=this.parent.config.exportFieldsOptionForCSV;
else this.parent.config.hasOwnProperty("csvAllFields")&&(G=this.parent.config.csvAllFields);d=e.exportToCSV(this.summaryFeatures,g,E,F,{type:"grouped",baseLabel:this.baseLabel,csvAllFields:G,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.groupedSummary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,allFields:this.allFields,configuredPopUpFields:this.configuredPopUpFields});this.summaryLayer=d.summaryLayer;return d.details},_getFields:function(d){this.layerDefinition=
K.getFeatureLayerDefinition(d);this.layerObject=d;var g=e.getSkipFields(d),E,F=[];if("undefined"!==typeof this.tab.advStat){var G=this.tab.advStat.stats,D;for(D in G)0<G[D].length&&Q.forEach(G[D],function(n){var f={field:n.expression,alias:n.label+"",type:D,total:0};E=n.expression;F.push(f)})}G=e.getSpecialFields(d);this.dateFields=G.dateFields;this.specialFields=G.specialFields;this.typeIdField=G.typeIdField;this.types=G.types;if(this.allFields)for(G=0;G<d.fields.length;G++){var k=d.fields[G];-1===
g.indexOf(k.name)&&E!==k.name&&F.push({field:k.name,alias:k.alias,type:k.type})}return F}})})},"widgets/SituationAwareness/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/keys jimu/utils esri/geometry/geometryEngine esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k){return P("ClosestInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(n,f,y){this.tab=n;this.container=f;this.parent=y;this.graphicsLayer=this.incident=null;this.map=y.map;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=y.config;this.parentNode=y.domNode;this.baseLabel=""!==n.label?n.label:n.layerTitle?n.layerTitle:n.layers},queryTabCount:function(n,
f,y,I){var C=new z;this.incidentCount=n.length;var N=this.parent.config.distanceSettings[this.parent.config.distanceUnits],R=this.parent.config.maxDistance;f=[];for(var a=0;a<n.length;a++){var v=n[a].geometry;"4326"===v.spatialReference.wkid||v.spatialReference.isWebMercator()?f.push(q.geodesicBuffer(v,R,N)):f.push(q.buffer(v,R,N))}var H=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(H=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&
-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(n,f,y,I,H).then(function(h){C.resolve(h)});else{var l=new d(this.summaryLayer.url);l.infoTemplate=this.tab.tabLayers[0].infoTemplate;H=[l];this.tab.tabLayers=H;K(l,"load",J.hitch(this,
function(){this.summaryLayer=l;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(n,f,y,I,H).then(function(h){C.resolve(h)})}))}else this.loading||(l=new d(this.tab.tabLayers[0].url),this.loading=!0,K(l,"load",J.hitch(this,function(){this.summaryLayer=l;this.summaryFields=this._getFields(this.summaryLayer);for(var h=this.tab.tabLayers[0].url.split("MapServer/")[1],A=this.parent.map.itemInfo.itemData.operationalLayers,O=0;O<A.length;O++){var X=A[O];if(-1<this.tab.tabLayers[0].url.indexOf(X.url)&&
"undefined"!==typeof X.layerObject&&X.layerObject.infoTemplates&&(X=X.layerObject.infoTemplates[h])){l.infoTemplate=X.infoTemplate;break}}H=[l];this.tab.tabLayers=H;this.loading=!1;this._performQuery(n,f,y,I,H).then(function(W){C.resolve(W)})})));this.mapServiceLayer||this._performQuery(n,f,y,I,H).then(function(h){C.resolve(h)});return C},_performQuery:function(n,f,y,I,C){var N=new z,R=[];this.summaryGeoms=f;if(0<f.length)for(n=0;n<f.length;n++){R=f[n];var a=k.createDefArray(C,R,this.parent.opLayers,
this.tab);var v=0===n?R=a:R=v.concat(a)}(new L(R)).then(J.hitch(this,function(H){for(var l=0,h=0;h<H.length;h++){var A=H[h][1];isNaN(A)?A&&A.features?0<A.features.length&&(l+=1):A&&"undefined"!==typeof A.length&&0<A.length&&(l+=1):0<A&&(l+=1)}this.updateTabCount(l,y,I);N.resolve(l)}));return N},updateTabCount:function(n,f,y){this.featureCount=0===parseInt(n,10)?0:n;k.updateTabCount(this.featureCount,f,y,this.baseLabel,this.incidentCount)},updateForIncident:function(n,f,y,I,C,N){this.incidentCount=
n.length;this.allFields="undefined"!==typeof C&&"undefined"!==typeof N?C?!0:N:!1;var R="undefined"!==typeof I,a;V.forEach(this.tab.tabLayers,J.hitch(this,function(v){R&&(a=new z);if(v.url){var H=new d(v.url,{mode:d.MODE_ONDEMAND,infoTemplate:v.infoTemplate});K(H,"load",J.hitch(this,function(){this.tab.tabLayers=[H];R?this.processIncident(n,f,y,I).then(J.hitch(this,function(l){a.resolve(l)}),J.hitch(this,function(l){console.error(l);a.reject(l)})):this.processIncident(n,f,y,I)}))}else R?this.processIncident(n,
f,y,I).then(J.hitch(this,function(l){a.resolve(l)}),J.hitch(this,function(l){console.error(l);a.reject(l)})):this.processIncident(n,f,y,I)}));if(R)return a},processIncident:function(n,f,y,I){this.incidents=n;var C="undefined"!==typeof I;if(C)var N=new z;else this.container.innerHTML="",r.add(this.container,"loading");var R=[];I=this.parent.config.distanceSettings[this.parent.config.distanceUnits];for(var a=[],v=0;v<n.length;v++){var H=n[v].geometry;var l="4326"===H.spatialReference.wkid||H.spatialReference.isWebMercator()?
q.geodesicBuffer(H,f,I):q.buffer(H,f,I);a.push({geometry:H,buffer:l})}(this.graphicsLayer=y)&&this.graphicsLayer.clear();n=[];f=this.tab.tabLayers[0];y=-1===[null,void 0,""].indexOf(f.id)?f.id:this.tab.layers;y=k.getFilter(y,this.parent.opLayers);var h=this._getFields(f),A=k.getPopupConfiguredFields(f);for(I=0;I<a.length;I++)v=new D,v.returnGeometry=!0,v.outSpatialReference=this.parent.map.spatialReference,v.geometry=a[I].buffer,v.where=y,v.outFields=["*"],"undefined"!==typeof f.queryFeatures&&n.push(f.queryFeatures(v));
(new L(n)).then(J.hitch(this,function(O){for(var X=0;X<O.length;X++)if(O[X][0]){var W=O[X][1].features,ba=[],ea=a[X].geometry;if(W&&0<W.length){for(var fa=0;fa<W.length;fa++){var ha=new m(W[fa].toJson()),S=k.getDistance(ea,ha.geometry,this.parent.config.distanceUnits),T={DISTANCE:S};V.forEach(h,J.hitch(this,function(Y){T[Y]=ha.attributes[Y]}));this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"allFields"===this.config.exportFieldsOptionForCSV||this.config.hasOwnProperty("csvAllFields")&&(!0===
this.config.csvAllFields||"true"===this.config.csvAllFields)?ha.attributes.DISTANCE=S:(this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"popUpFields"===this.config.exportFieldsOptionForCSV&&!this.allFields&&(T={DISTANCE:S},V.forEach(A,J.hitch(this,function(Y){T[Y]=ha.attributes[Y]}))),ha.attributes=T);ba.push(ha)}ba.sort(k.compareDistance);R.push(ba[0])}}else O[X][1]&&O[X][1].message&&console.log(O[X][1].message);R.sort(k.compareDistance);C?this._processResults(R,!0).then(J.hitch(this,function(Y){N.resolve(Y)})):
this._processResults(R)}),J.hitch(this,function(O){console.error(O);N.reject(O)}));if(C)return N},_processResults:function(n,f){var y=n&&0<n.length;if(y&&"point"!==n[0].geometry.type)for(var I=n.length-1;0<=I;I--)"undefined"===typeof n[I].geometry.getExtent()&&n.splice(I,1);if(f)var C=new z;else if(this.container.innerHTML="",r.remove(this.container,"loading"),y){var N=u.create("div",{"class":"SAT_tabPanelContent"},this.container);I=u.create("div",{},N);r.add(I,"SATcolExport");r.add(I,this.parent.lightTheme?
"lightThemeBorder":"darkThemeBorder");var R=u.create("div",{title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"closestDownLoadCSVButton"},I);b.initFirstFocusNode(this.parentNode,R);r.add(R,"btnExport");r.add(R,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");K(R,"click",J.hitch(this,this._exportToCSV,n));K(R,"keydown",J.hitch(this,function(ca){if(!ca.shiftKey||ca.keyCode!==c.TAB)if(ca.keyCode===c.ENTER||ca.keyCode===c.SPACE)this._exportToCSV(n,
ca),setTimeout(function(){R.focus()},500)}));R.focus()}I=this.parent.nls[this.parent.config.distanceUnits];var a=[];if(y)for(var v=0;v<n.length;v++){var H=v+1,l=n[v],h=l.geometry,A=h;"point"!==h.type&&(A=h.getExtent().getCenter());h=l.attributes;var O;"point"===this.incidents[0].geometry.type&&(O=Math.round(100*h.DISTANCE)/100+" "+I+" ("+this.parent.nls.approximate+")");var X="",W=0,ba=[];if("undefined"!==typeof this.displayFields)for(var ea=0;ea<this.displayFields.length;ea++){var fa=this.displayFields[ea],
ha;a:for(ha in h)if("DISTANCE"!==ha&&3>W&&fa.expression===ha){var S=k.getFieldValue(ha,h[ha],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,h,fa);S="undefined"!==typeof S&&null!==S?b.stripHTML(S.toString()):"";var T="undefined"!==typeof fa.label&&""!==fa.label?fa.label:void 0,Y=l._layer&&l._layer.fields?l._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:
void 0;Y&&"undefined"===typeof T&&(Y=k.getField(Y,ha))&&(T=Y.alias);if("undefined"===typeof T||T in[""," ",null,void 0])T=ha;k.isURL(S)?S='\x3ca href\x3d"'+S+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+T+"\x3c/a\x3e":k.isEmail(S)&&(S='\x3ca href\x3d"mailto:'+S+'" style\x3d"color: inherit;"\x3e'+T+"\x3c/a\x3e");X+=fa.validLabel?("undefined"!==typeof fa.label&&""!==fa.label?T+" ":"")+S+"\x3cbr/\x3e":S+"\x3cbr/\x3e";W+=1;ba.push({value:S,label:T});break a}}a.push(ba);f||(l=u.create("div",{},
N),r.add(l,"SATcolRec"),r.add(l,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),W=u.create("div",{},l),r.add(W,"SATcolRecBar"),ba=u.create("div",{innerHTML:H,tabindex:"0",role:"button","aria-label":this.parent.nls.zoomToFeature+" "+H},W),r.add(ba,"SATcolRecNum"),x.set(ba,"backgroundColor",this.parent.config.activeColor),K(ba,"click",J.hitch(this,this._zoomToLocation,A,null)),K(ba,"keydown",J.hitch(this,this._zoomToLocation,A,!0)),b.initLastFocusNode(this.parentNode,ba),O&&(ba=u.create("div",
{innerHTML:O},W),r.add(ba,"SATcolDistance")),this.parent.config.enableRouting&&(W=u.create("div",{"class":"directionsButton",title:this.parent.nls.get_directions,tabindex:"0","aria-label":this.parent.nls.get_directions,role:"button"},W),r.add(W,"SATcolDir"),K(W,"click",J.hitch(this,this._routeToIncident,A,null)),K(W,"keydown",J.hitch(this,this._routeToIncident,A,!0)),b.initLastFocusNode(this.parentNode,W)),X=u.create("div",{"class":"SATcolWrap",innerHTML:X},l),r.add(X,"SATcolInfo"),X=new E(E.STYLE_SOLID,
new Q.fromRgb(this.parent.config.activeMapGraphicColor),1),X=new g(g.STYLE_CIRCLE,24,X,new Q.fromRgb(this.parent.config.activeMapGraphicColor)),l=new F,l.family="Arial",l.size="12px",H=new G(H,l,new e(this.parent.config.fontColor)),H.setOffset(0,-4),this.graphicsLayer.add(new m(A,X,h)),this.graphicsLayer.add(new m(A,H,h)))}if(f&&y)return C.resolve({graphics:n,analysisResults:a,context:this}),C},_exportToCSV:function(n,f,y,I){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var C=this.parent.config.exportFieldsOptionForCSV;
else this.parent.config.hasOwnProperty("csvAllFields")&&(C=this.parent.config.csvAllFields);n=k.exportToCSV(n,f,y,I,{type:"closest",baseLabel:this.baseLabel,csvAllFields:C,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.closest,nlsCount:this.parent.nls.count});this.summaryLayer=n.summaryLayer;return n.details},_getFields:function(n){this.layerDefinition=b.getFeatureLayerDefinition(n);this.layerObject=n;n=k.getFields(n,this.tab,this.allFields,this.parent);this.dateFields=
n.dateFields;this.specialFields=n.specialFields;this.typeIdField=n.typeIdField;this.types=n.types;this.displayFields=k.getDisplayFields(this.tab);return n.fields},_zoomToLocation:function(n,f,y){y.shiftKey&&y.keyCode===c.TAB?(y.stopPropagation(),y.cancelBubble=!0):f&&y.keyCode!==c.ENTER&&y.keyCode!==c.SPACE||this.parent.zoomToLocation(n)},_routeToIncident:function(n,f,y){f&&y.keyCode!==c.ENTER&&y.keyCode!==c.SPACE||this.parent.routeToIncident(n)}})})},"widgets/SituationAwareness/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/query dojo/keys esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query esri/geometry/geometryEngine jimu/utils ./analysisUtils".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k,n){return P("ProximityInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(f,y,I){this.tab=f;this.container=y;this.parent=I;this.graphicsLayer=this.incident=null;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=I.config;this.parentNode=I.domNode;this.baseLabel=""!==f.label?f.label:f.layerTitle?f.layerTitle:f.layers},queryTabCount:function(f,y,I,C){var N=
new z;this.incidentCount=f.length;var R=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(R=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=this._getFields(this.summaryLayer),
this._performQuery(f,y,I,C,R).then(function(v){N.resolve(v)});else{var a=new e(this.summaryLayer.url);a.infoTemplate=this.tab.tabLayers[0].infoTemplate;R=[a];this.tab.tabLayers=R;K(a,"load",J.hitch(this,function(){this.summaryLayer=a;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(f,y,I,C,R).then(function(v){N.resolve(v)})}))}else this.loading||(a=new e(this.tab.tabLayers[0].url),this.loading=!0,K(a,"load",J.hitch(this,function(){this.summaryLayer=a;this.summaryFields=this._getFields(this.summaryLayer);
for(var v=this.tab.tabLayers[0].url.split("MapServer/")[1],H=this.parent.map.itemInfo.itemData.operationalLayers,l=0;l<H.length;l++){var h=H[l];if(-1<this.tab.tabLayers[0].url.indexOf(h.url)&&"undefined"!==typeof h.layerObject&&h.layerObject.infoTemplates&&(h=h.layerObject.infoTemplates[v])){a.infoTemplate=h.infoTemplate;break}}this.tab.tabLayers=[a];this.loading=!1;this._performQuery(f,y,I,C,this.tab.tabLayers).then(function(A){N.resolve(A)})})));this.mapServiceLayer||this._performQuery(f,y,I,C,
R).then(function(v){N.resolve(v)});return N},_performQuery:function(f,y,I,C,N){var R=new z,a=[],v;0<y.length?v=n.getGeoms(y):0<f.length&&(v=n.getGeoms(f));this.summaryGeoms=v;if(0<v.length)for(f=0;f<v.length;f++){a=v[f];y=n.createDefArray(N,a,this.parent.opLayers,this.tab);var H=0===f?a=y:a=H.concat(y)}(new L(a)).then(J.hitch(this,function(l){for(var h=0,A=0;A<l.length;A++){var O=l[A][1];isNaN(O)?O&&O.features?h+=O.features.length:O&&"undefined"!==typeof O.length&&(h+=O.length):h+=O}this.updateTabCount(h,
I,C);R.resolve(h)}));return R},updateTabCount:function(f,y,I){this.featureCount=f;n.updateTabCount(this.featureCount,y,I,this.baseLabel,this.incidentCount)},updateForIncident:function(f,y,I,C,N,R){this.incidentCount=f.length;this.allFields="undefined"!==typeof N&&"undefined"!==typeof R?N?!0:R:!1;var a="undefined"!==typeof C,v;V.forEach(this.tab.tabLayers,J.hitch(this,function(H){a&&(v=new z);if(H.url){var l=new e(H.url,{mode:e.MODE_ONDEMAND,infoTemplate:H.infoTemplate});K(l,"load",J.hitch(this,function(){this.tab.tabLayers=
[l];a?this.processIncident(f,y,I,C,N).then(J.hitch(this,function(h){v.resolve(h)}),J.hitch(this,function(h){console.error(h);v.reject(h)})):this.processIncident(f,y,I,C,N)}))}else a?this.processIncident(f,y,I,C,N).then(J.hitch(this,function(h){v.resolve(h)}),J.hitch(this,function(h){console.error(h);v.reject(h)})):this.processIncident(f,y,I,C,N)}));if(a)return v},processIncident:function(f,y,I,C,N){this.incidents=f;var R=[];if(0===y.length)for(var a=0;a<f.length;a++){var v=f[a];v=v.geometry?v.geometry:
v;"polygon"===v.type?(y.push(v),R.push({geometry:v,buffer:v})):R.push({geometry:void 0,buffer:void 0})}else for(a=0;a<f.length;a++){v=f[a];var H=y[a].geometry?y[a].geometry:y[a];v=v.geometry?v.geometry:v;R.push({geometry:v,buffer:H})}if(0!==y.length){for(f=0;f<R.length;f++)if(y=R[f].buffer,"undefined"!==typeof y)for(v=0;v<R.length;v++)if(v!==f&&(a=R[v].buffer,"undefined"!==typeof a&&D.overlaps(y,a))){R[f].buffer=D.difference(y,a);R[v].buffer=D.difference(a,y);a=D.union(a,y);a=D.difference(a,R[f].buffer);
a=D.difference(a,R[v].buffer);if(Array.isArray(R[f].geometry)){if(Array.isArray(R[v].geometry))for(H=0;H<R[v].geometry.length;H++)R[f].geometry.push(R[v].geometry[H]);else R[f].geometry.push(R[v].geometry);H=R[f].geometry}else if(H=[],H.push(R[f].geometry),Array.isArray(R[v].geometry))for(var l=0;l<R[v].geometry.length;l++)H.push(R[v].geometry[l]);else H.push(R[v].geometry);R.push({geometry:H,buffer:a})}var h="undefined"!==typeof C;if(h)var A=new z;else this.container.innerHTML="",r.add(this.container,
"loading");var O=[];this.graphicsLayer=I;I=this.tab.tabLayers[0];var X=this._getFields(I),W=n.getPopupConfiguredFields(I);C=-1===[null,void 0,""].indexOf(I.id)?I.id:this.tab.layers;C=n.getFilter(C,this.parent.opLayers);f=[];for(y=0;y<R.length;y++)v=new G,v.returnGeometry=!0,v.outSpatialReference=this.parent.map.spatialReference,v.geometry=R[y].buffer,v.where=C,v.outFields=["*"],"undefined"!==typeof I.queryFeatures&&f.push(I.queryFeatures(v));(new L(f)).then(J.hitch(this,function(ba){for(var ea=0;ea<
ba.length;ea++){var fa=ba[ea][1];if(fa&&fa.features){fa=fa.features;for(var ha=R[ea].geometry,S=0;S<fa.length;S++){var T=fa[S],Y=T.geometry;if(Array.isArray(ha)){for(var ca,ia=0;ia<ha.length;ia++){var oa=n.getDistance(ha[ia],Y,this.parent.config.distanceUnits);if("undefined"===typeof ca||oa<ca)ca=oa}Y=ca;var ja={DISTANCE:ca}}else Y=n.getDistance(ha,Y,this.parent.config.distanceUnits),ja={DISTANCE:Y};V.forEach(X,J.hitch(this,function(na){ja[na]=T.attributes[na]}));this.config.hasOwnProperty("exportFieldsOptionForCSV")&&
"allFields"===this.config.exportFieldsOptionForCSV||this.config.hasOwnProperty("csvAllFields")&&(!0===this.config.csvAllFields||"true"===this.config.csvAllFields)?T.attributes.DISTANCE=Y:(this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"popUpFields"===this.config.exportFieldsOptionForCSV&&!N&&(ja={DISTANCE:Y},V.forEach(W,J.hitch(this,function(na){ja[na]=T.attributes[na]}))),T.attributes=ja);O.push(T)}}}O.sort(n.compareDistance);if(h){var pa={graphics:O,analysisResults:O.length,context:this};
this._processResults(O,!0).then(J.hitch(this,function(na){A.resolve(J.mixin(pa,na))}))}else this._processResults(O)}),J.hitch(this,function(ba){console.error(ba);A.reject(ba)}));if(h)return A}},_processResults:function(f,y){var I=f&&0<f.length;if(I&&"point"!==f[0].geometry.type)for(var C=f.length-1;0<=C;C--)"undefined"===typeof f[C].geometry.getExtent()&&f.splice(C,1);if(y)var N=new z;else if(this.container.innerHTML="",r.remove(this.container,"loading"),this.graphicsLayer.clear(),I){var R=u.create("div",
{"class":"SAT_tabPanelContent"},this.container);C=u.create("div",{},R);r.add(C,"SATcolExport");r.add(C,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var a=u.create("div",{title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"proximityDownLoadCSVButton"},C);r.add(a,"btnExport");r.add(a,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");a.focus();k.initFirstFocusNode(this.parentNode,a);K(a,"click",J.hitch(this,
this._exportToCSV,f));K(a,"keydown",J.hitch(this,function(ia){if(!ia.shiftKey||ia.keyCode!==b.TAB)if(ia.keyCode===b.ENTER||ia.keyCode===b.SPACE)this._exportToCSV(f,ia),setTimeout(function(){a.focus()},500)}))}C=this.parent.nls[this.parent.config.distanceUnits];if("undefined"!==typeof this.tab.advStat&&"undefined"!==typeof this.tab.advStat.stats&&"undefined"!==typeof this.tab.advStat.stats.outFields)var v=this.tab.advStat.stats.outFields;else v=[],0<this.tab.tabLayers.length&&V.forEach(this.tab.tabLayers,
J.hitch(this,function(ia){"undefined"!==typeof ia.popupInfo?V.forEach(ia.popupInfo.fieldInfos,J.hitch(this,function(oa){if(oa.visible){var ja={value:0};ja.expression=oa.fieldName;ja.label=oa.label;v.push(ja)}})):ia.infoTemplate?V.forEach(ia.infoTemplate.info.fieldInfos,J.hitch(this,function(oa){if(oa.visible){var ja={value:0};ja.expression=oa.fieldName;ja.label=oa.label;v.push(ja)}})):V.forEach((ia.layerObject?ia.layerObject:ia).fields,J.hitch(this,function(oa){var ja={value:0};ja.expression=oa.name;
ja.label=oa.alias;v.push(ja)}))}));var H=[];if(I)for(I=0;I<f.length;I++){var l=I+1,h=f[I],A=h.geometry,O=A;"point"!==A.type&&(O=A.getExtent().getCenter());A=h.attributes;var X=n.getDistanceLabel(A.DISTANCE,C,this.parent.nls.approximate),W="",ba=0,ea=[];if("undefined"!==typeof v){for(var fa=0;fa<v.length;fa++){var ha=v[fa],S;for(S in A)if("DISTANCE"!==S&&3>ba&&ha.expression===S){var T=n.getFieldValue(S,A[S],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&
this.layerObject.renderer?this.layerObject:this.layerDefinition,A,ha);T="undefined"!==typeof T&&null!==T?k.stripHTML(T.toString()):"";var Y="undefined"!==typeof ha.label&&""!==ha.label?ha.label:void 0,ca=h._layer&&h._layer.fields?h._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;ca&&"undefined"===typeof Y&&(ca=n.getField(ca,S))&&(Y=ca.alias);if("undefined"===typeof Y||Y in[""," ",null,void 0])Y=S;n.isURL(T)?T='\x3ca href\x3d"'+T+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+
Y+"\x3c/a\x3e":n.isEmail(T)&&(T='\x3ca href\x3d"mailto:'+T+'" style\x3d"color: inherit;"\x3e'+Y+"\x3c/a\x3e");W+=ha.validLabel?("undefined"!==typeof ha.label&&""!==ha.label?Y+" ":"")+T+"\x3cbr/\x3e":T+"\x3cbr/\x3e";ba+=1;ea.push({label:Y,value:T})}}ea.push({label:this.parent.nls.distance,value:X});0<ea.length&&H.push(ea)}y||(h=u.create("div",{},R),r.add(h,"SATcolRec"),r.add(h,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),ba=u.create("div",{},h),r.add(ba,"SATcolRecBar"),ea=u.create("div",
{innerHTML:l,tabindex:"0",role:"button","aria-label":this.parent.nls.zoomToFeature+" "+l,isLastElement:f.length-1===I},ba),r.add(ea,"SATcolRecNum"),f.length-1===I&&k.initLastFocusNode(this.parentNode,ea),x.set(ea,"backgroundColor",this.parent.config.activeColor),K(ea,"click",J.hitch(this,this._zoomToLocation,O,null)),K(ea,"keydown",J.hitch(this,this._zoomToLocation,O,!0)),"point"===this.incidents[0].geometry.type&&(X=u.create("div",{innerHTML:X},ba),r.add(X,"SATcolDistance")),this.parent.config.enableRouting&&
(X=u.create("div",{"class":"directionsButton",title:this.parent.nls.get_directions,tabindex:"0","aria-label":this.parent.nls.get_directions,role:"button"},ba),r.add(X,"SATcolDir"),K(X,"click",J.hitch(this,this._routeToIncident,O,null)),K(X,"keydown",J.hitch(this,this._routeToIncident,O,!0)),k.initLastFocusNode(this.parentNode,X)),W=u.create("div",{"class":"SATcolWrap",innerHTML:W},h),r.add(W,"SATcolInfo"),W=new g(g.STYLE_SOLID,new Q.fromString(this.parent.config.activeMapGraphicColor),1),W=new d(d.STYLE_CIRCLE,
24,W,new Q.fromString(this.parent.config.activeMapGraphicColor)),X=new E,X.family="Arial",X.size="12px",l=new F(l,X,new m(this.parent.lightTheme?"#111111":this.parent.config.fontColor)),l.setOffset(0,-4),this.graphicsLayer.add(new q(O,W,A)),this.graphicsLayer.add(new q(O,l,A)))}if(y)return N.resolve({reportResults:H}),N},_exportToCSV:function(f,y,I,C){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var N=this.parent.config.exportFieldsOptionForCSV;else this.parent.config.hasOwnProperty("csvAllFields")&&
(N=this.parent.config.csvAllFields);f=n.exportToCSV(f,y,I,C,{type:"proximity",baseLabel:this.baseLabel,csvAllFields:N,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.proximity,nlsCount:this.parent.nls.count,unit:this.parent.nls[this.parent.config.distanceUnits],approximateLabel:this.parent.nls.approximate});this.summaryLayer=f.summaryLayer;return f.details},_getFields:function(f){this.layerDefinition=k.getFeatureLayerDefinition(f);this.layerObject=f;f=n.getFields(f,
this.tab,this.allFields,this.parent);this.dateFields=f.dateFields;this.specialFields=f.specialFields;this.typeIdField=f.typeIdField;this.types=f.types;this.displayFields=n.getDisplayFields(this.tab);return f.fields},_zoomToLocation:function(f,y,I){I.shiftKey&&I.keyCode===b.TAB||y&&I.keyCode!==b.ENTER&&I.keyCode!==b.SPACE||this.parent.zoomToLocation(f)},_routeToIncident:function(f,y,I){y&&I.keyCode!==b.ENTER&&I.keyCode!==b.SPACE||this.parent.routeToIncident(f)}})})},"widgets/SituationAwareness/js/SnapShotUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/_base/array jimu/utils jimu/dijit/SnapShot ./CSVUtils".split(" "),
function(P,J,Q,V,L,z,r,u){return P("SnapShotUtils",null,{portal:null,portalUrl:"",logo:"",originMapId:"",originAppId:"",credential:null,nls:null,layerArray:[],parent:null,downloadAll:!1,time:null,constructor:function(w){this.parent=w;this.snapshot=new r(w.appConfig,w.map);this.map=this.parent.map;this.extent=this.map.extent;this.nls=J.mixin({},w.nls,window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(w){var x=new Q,K=z.stripHTML(w.name),c=this._getTime(w.time);this.createLayerItems(w,
c,K).then(J.hitch(this,function(b){this.snapshot.createSnapShot({folderOptions:{folderName:K+"_"+c,title:K+"_"+c,description:K+" "+this.nls.snapshot},mapTitle:K+" ("+this.nls.snapshot_append+" "+c+")",name:K+" ("+c+")",shareWith:{everyone:!1,org:!1,groups:w.groups.join()},mapExtent:this.map.extent,data:b}).then(function(){x.resolve()})}));return x},_getTime:function(w){w=new Date(w);var x=w.getTimezoneOffset();return z.fieldFormatter.getFormattedDate(w,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+
(0>x?"+"+Math.abs(x)/60:"-"+x/60)},createLayerItems:function(w,x,K){var c=new Q,b=w.layers.reverse();this.buffers=w.buffers;this.incidents=w.incidents;w=[];for(var q=0;q<b.length;q++){var m=!0;b[q].analysisObject&&"undefined"!==typeof b[q].analysisObject.featureCount&&0===b[q].analysisObject.featureCount&&(m=!1);b[q].graphics&&0===b[q].graphics.length&&(m=!1);m&&w.push(this.createItem(b[q],this.incidents,this.buffers,x,this.nls,K))}var e=[];(new V(w)).then(J.hitch(this,function(d){for(var g=0;g<d.length;g++){var E=
d[g][1];if(Array.isArray(E))for(var F=0;F<E.length;F++)e.push(E[F]);else e.push(E)}c.resolve(e)}),J.hitch(this,function(d){c.reject(d)}));return c},createItem:function(w,x,K,c,b,q){var m=new Q,e={label:w.label,title:w.label+"_"+c,desc:b.snapshot_append+" "+b.of_append+" "+(w.type?w.type:w.label)+" "+b.layer_append+" "+w.label+" ("+c+")",name:w.label+"("+c+")",tags:[q+","+b.snapshot_append],originalLayerName:w.label};if(w.layerObject){var d=w.layerObject;q=w.analysisObject;if(d.infoTemplate&&d.infoTemplate.info)var g=
d.infoTemplate.info;e.popupInfo=g;"groupedSummary"===w.type||"summary"===w.type?q.updateForIncident(x,K,null,null,!0,!0,!0).then(J.hitch(this,function(E){E=this.createAnalysisLayerJSON(E,d,b,c,e);m.resolve(E)})):q.updateForIncident(x,"closest"===w.type?this.parent.config.maxDistance:K,null,!0,!0,!0).then(J.hitch(this,function(E){E=this.createAnalysisLayerJSON(E,d,b,c,e);m.resolve(E)}))}else w=this.createIncidentBufferLayerJSON(w.graphics,b,c,e),m.resolve(w);return m},createAnalysisLayerJSON:function(w,
x,K,c,b){K=w.graphics;c=w.context._exportToCSV(K,!0);w=[];for(var q=0;q<c.length;q++){var m=c[q];"esriFieldTypeOID"!==m.type&&w.push(m)}for(c=0;c<K.length;c++)q=K[c],q.geometry.cache&&(q.geometry.clearCache(),delete q.geometry.cahce);return{graphics:K,renderer:x.renderer,infoTemplate:b.popupInfo,fields:w,tags:b.tags,description:b.desc,name:b.name,visibleOnStartup:!1,typeIdField:x.typeIdField,types:x.types,minScale:x.minScale,maxScale:x.maxScale,originalLayerName:b.originalLayerName}},createIncidentBufferLayerJSON:function(w,
x,K,c){var b=[],q=[],m=[];x=[];L.forEach(w,function(E){switch(E.geometry.type){case "point":b.push(E);break;case "polyline":q.push(E);break;case "polygon":m.push(E)}});w=[];0<b.length&&w.push(b);0<q.length&&w.push(q);0<m.length&&w.push(m);K={point:this.nls.point,polyline:this.nls.line,polygon:this.nls.polygon};for(var e=0;e<w.length;e++){var d=w[e];if(0<d.length){var g=d[0];g=K["undefined"!==typeof g.geometry?g.geometry.type:g.type];x.push({graphics:d,fields:[],tags:c.tags,description:c.desc,name:1===
w.length?c.name:g+" "+c.name,visibleOnStartup:!1,originalLayerName:c.originalLayerName})}}return x},createDownloadZip:function(w,x,K){var c=new Q,b=this.nls.calculated_results;this._performAnalysis(w,x,K,this.downloadAll,!1).then(function(q){for(var m=[],e=0;e<q.length;e++){var d=q[e];(d=d.context._exportToCSV(d.graphics,!1,!0,d.analysisResults))&&m.push(d)}0<m.length&&u.exportCalculatedResultsCSV(b,m);c.resolve("success")},function(q){c.reject(q)});return c},_performAnalysis:function(w,x,K,c,b){for(var q=
new Q,m=[],e=0;e<w.length;e++){var d=w[e];console.log("AO: "+d);var g=!0;d.analysisObject&&"undefined"!==typeof d.analysisObject.featureCount&&0===d.analysisObject.featureCount&&(g=!1);g&&("groupedSummary"===d.type||"summary"===d.type?m.push(d.analysisObject.updateForIncident(x,K,null,null,!0,b,c)):m.push(d.analysisObject.updateForIncident(x,"closest"===d.type?this.parent.config.maxDistance:K,null,!0,b,c)))}var E=[];(new V(m)).then(J.hitch(this,function(F){for(var G=0;G<F.length;G++)E.push(F[G][1]);
q.resolve(E)}),J.hitch(this,function(F){console.error(F);q.reject(F)}));return q}})})},"jimu/dijit/SnapShot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/DeferredList jimu/utils esri/request esri/geometry/webMercatorUtils jimu/portalUtils jimu/tokenUtils jimu/dijit/Message esri/layers/FeatureLayer esri/graphic".split(" "),function(P,J,Q,V,L,z,r,u,w,x,K,c,b){return P("Snapshot",null,{_portal:null,_portalUrl:"",_layerArray:[],_originMapId:"",_originAppId:"",
_credential:null,name:"",appendTimeStamp:null,baseMap:null,tags:"",description:"",shareWith:null,logo:"",time:null,constructor:function(q,m){this.map=m;this.appConfig=q;this._originAppId=q.appId;this._originMapId=m.itemId;this._mapItemInfo=m.itemInfo;this._portalUrl=q.portalUrl;this._portal=w.getPortal(this._portalUrl);this._baseUrl=this._portalUrl+"sharing/rest/";this.nls=J.mixin({},window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(q){this.ids=[];this.layerArray=[];this.time=
this._getDateString(Date.now());this.name=(q.appendTimeStamp&&q.name?q.name+"_"+this.time:q.name)||this._mapItemInfo.item.title+"_"+this.time;this.extent=q.mapExtent||this.map.extent;this.logo=q.logo||this.appConfig.logo;this.mapName=q.mapTitle||this.name;this.shareWith=q.shareWith||{everyone:!1,org:!1,groups:""};var m=q.folderOptions;m.name=q.folderOptions.name||this.name;m.title=q.folderOptions.title||this.name;m.description=q.folderOptions.description||this.name;q=q.data.reverse();return this._createSnapshot(m,
q)},_createSnapshot:function(q,m){var e=new V;this._portal.getUser().then(J.hitch(this,this._processUser),function(d){e.reject(d)}).then(J.hitch(this,this._createFolder,q),function(d){e.reject(d)}).then(J.hitch(this,this._createItems,m),function(d){e.reject(d)}).then(J.hitch(this,this._addLayers),function(d){e.reject(d)}).then(J.hitch(this,this._createMap,this._mapItemInfo),function(d){e.reject(d)}).then(J.hitch(this,this._processMap),function(d){e.reject(d)}).then(J.hitch(this,this._shareItems),
function(d){e.reject(d)}).then(J.hitch(this,this._showMessage),function(d){e.reject(d)}).then(function(){e.resolve()});return e},_processUser:function(q){var m=new V;this.user=q;this.groups=q.groups;m.resolve();return m},_createFolder:function(q){var m=new V;q={url:this._baseUrl+"content/users/"+this.user.username+"/createFolder",content:J.mixin({f:"json"},q),handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&(q.content.token=this._credential.token);r(q,{usePost:!0}).then(J.hitch(this,
function(e){e.success?((this.folder=e.folder)&&this.folder.id&&this.ids.push(this.folder.id),m.resolve(e.folder)):(console.log(e),m.reject(e))}),J.hitch(this,function(e){m.reject(e)}));return m},_createItems:function(q){var m=new V,e=[];Q.forEach(q,J.hitch(this,function(g){g.graphics&&0<g.graphics.length&&e.push(this._createLayerItem(g))}));var d=[];(new L(e)).then(J.hitch(this,function(g){for(var E=0;E<g.length;E++)!0===g[E][0]&&null!==g[E][1]&&d.push(g[E][1]);m.resolve(d)}),J.hitch(this,function(g){m.reject(g)}));
return m},_addLayers:function(q){for(var m=new V,e=[],d=0;d<q.length;d++)e.push(q[d].itemId),this.ids.push(q[d].itemId);m.resolve(e);return m},_createMap:function(q){for(var m=q.itemData,e=this.name,d=[],g=0;g<m.baseMap.baseMapLayers.length;g++){var E=m.baseMap.baseMapLayers[g];d.push({id:E.id,layerType:E.layerType,url:E.url,visibility:E.visibility,opacity:E.opacity,title:E.title,styleUrl:E.styleUrl,itemId:E.itemId})}m={baseMapLayers:d};d=[];for(g=0;g<this.layerArray.length;g++)E=this.layerArray[g],
d.push({id:E.layer.id,layerType:"ArcGISFeatureLayer",visibility:E.layer.visible,opacity:E.layer.opacity,title:E.layer.label,type:"feature",url:E.layer.url,popupInfo:E.layer.popupInfo});g=u.webMercatorToGeographic(this.extent);q={title:e,type:"Web Map",item:e,extent:g.xmin+","+g.ymin+","+g.xmax+","+g.ymax,text:JSON.stringify({operationalLayers:d,baseMap:m,spatialReference:this.map.spatialReference,version:q&&q.itemData&&q.itemData.version?q.itemData.version:"2.4"}),tags:this.name+","+this.nls.snapshot_append,
wabType:"HTML"};return this.user.addItem(q,this.folder.id)},_processMap:function(q){var m=new V;q.id&&this.ids.push(q.id);q.success?m.resolve(q.id):m.reject("fail");return m},_shareItems:function(q){var m=new V,e={url:this._baseUrl+"content/users/"+this.user.username+"/shareItems",content:{f:"json",everyone:this.shareWith.everyone,org:this.shareWith.org,items:this.ids.join(),groups:this.shareWith.groups,confirmItemControl:this._validateGroupItemControl(this.shareWith.groups)},handleAs:"json",callbackParamName:"callback"};
this._isValidCredential()&&(e.content.token=this._credential.token);r(e,{usePost:!0}).then(J.hitch(this,function(d){d.results&&0<d.results.length?m.resolve(this._portalUrl+"home/webmap/viewer.html?webmap\x3d"+q):m.reject("fail")}),J.hitch(this,function(d){m.reject(d)}));return m},_validateGroupItemControl:function(q){var m=q.split(",");return 0<this.groups.filter(function(e){var d=e.capabilities||[];return-1<m.indexOf(e.id)&&-1<d.indexOf("updateitemcontrol")}).length},_showMessage:function(q){var m=
new V;"fail"===q?(new K({message:this.nls.snapshot_failed}),m.reject(q)):(new K({message:'\x3ca href\x3d"'+q+'" target\x3d"_blank"\x3e'+this.nls.snapshot_complete+"\x3c/a\x3e"}),m.resolve("success"));return m},_getDateString:function(q){q=new Date(q);var m=q.getTimezoneOffset();return z.fieldFormatter.getFormattedDate(q,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+(0>m?"+"+Math.abs(m)/60:"-"+m/60)},_checkCredential:function(){var q=x.isValidCredential(this._credential);q||this._clearCredential();
return q},_isValidCredential:function(){this._updateCredential();return this._checkCredential()},_updateCredential:function(){this._checkCredential()||(this._credential=x.getPortalCredential(this._portalUrl))},_clearCredential:function(){this._credential=null},_createLayerItem:function(q){var m=new V,e={description:q.name,name:q.name,tags:[q.name],type:"Feature Service",title:q.name};this._createFeatureService(q.originalLayerName).then(J.hitch(this,function(d){if(d.success){var g=d.serviceurl.replace(RegExp("rest",
"g"),"rest/admin")+"/addToDefinition",E=this._createLayer(J.mixin(q,e));this._addDefinitionToService(g,E).then(J.hitch(this,function(F){F.success&&(F=new c(d.serviceurl+"/0?token\x3d"+this._credential.token,{id:e.name,outFields:["*"]}),e.url=d.serviceurl+"/0",e.itemId=d.itemId,this.layerArray.push({layer:{id:e.name,label:e.name,opacity:1,visible:!0,url:e.url,popupInfo:q.infoTemplate&&q.infoTemplate.info?q.infoTemplate.info:q.infoTemplate?q.infoTemplate:void 0}}),this._applyEditsOnLayer(F,q.graphics,
m,e))}),J.hitch(this,function(F){console.log(F.message);m.reject(null)}))}else m.reject(null)}),J.hitch(this,function(d){console.log(d.message);m.reject(null)}));return m},_applyEditsOnLayer:function(q,m,e,d){var g=[];Q.forEach(m,function(E){E.attributes?g.push(new b(E.geometry,null,E.attributes)):g.push(new b(E.geometry,null,{}))},this);q.applyEdits(g,null,null).then(J.hitch(this,function(){e.resolve(d)})).otherwise(J.hitch(this,function(E){console.log(E.message);e.reject(null)}))},_createFeatureService:function(q){return r({url:this._portalUrl+
"sharing/rest/content/users/"+this.user.username+"/"+this.folder.id+"/createService",content:{f:"json",token:this._credential.token,typeKeywords:"ArcGIS Server,Data,Feature Access,Feature Service,Service,Hosted Service",createParameters:JSON.stringify(this._getFeatureServiceParams(q)),outputType:"featureService"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},_getFeatureServiceParams:function(q){return{name:q+"_"+(new Date).getTime(),serviceDescription:"",hasStaticData:!1,maxRecordCount:1E3,
supportedQueryFormats:"JSON",capabilities:"Create,Delete,Query,Update,Editing",tags:"",description:"",copyrightText:"",spatialReference:{wkid:102100},initialExtent:{xmin:this.map.extent.xmin,ymin:this.map.extent.ymin,xmax:this.map.extent.xmax,ymax:this.map.extent.ymax,spatialReference:{wkid:102100}},allowGeometryUpdates:!0,units:"esriMeters",xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"}}},_addDefinitionToService:function(q,m){return r({url:q,
content:{token:this._credential.token,addToDefinition:JSON.stringify(m),f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},_createLayer:function(q){var m=this.nls,e=q.graphics[0],d={point:"esriGeometryPoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon"}["undefined"!==typeof e.geometry?e.geometry.type:e.type];e=e.symbol?e.symbol.toJson():"";var g=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:m.snapshot_append,alias:m.snapshot_append,type:"esriFieldTypeString"}];
q.fields&&0<q.fields.length&&Q.forEach(q.fields,function(E){g.push({name:E.name,alias:E.alias,type:E.type,domain:E.domain})});m={xmin:this.extent.xmin,ymin:this.extent.ymin,xmax:this.extent.xmax,ymax:this.extent.ymax,spatialReference:this.extent.spatialReference};e=q.renderer&&q.renderer.toJson?q.renderer.toJson():q.renderer?JSON.stringify(q.renderer):{type:"simple",label:"",description:"",symbol:e};return{layers:[{adminLayerInfo:{geometryField:{name:"Shape"},xssTrustedFields:""},id:0,name:q.name,
type:"Feature Layer",displayField:"",description:q.description,tags:"SA",copyrightText:"",defaultVisibility:!0,ownershipBasedAccessControlForFeatures:{allowOthersToQuery:!1,allowOthersToDelete:!1,allowOthersToUpdate:!1},relationships:[],isDataVersioned:!1,supportsCalculate:!0,supportsAttachmentsByUploadId:!0,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,supportsValidateSql:!0,supportsCoordinatesQuantization:!0,supportsApplyEditsWithGlobalIds:!0,advancedQueryCapabilities:{supportsPagination:!0,
supportsQueryWithDistance:!0,supportsReturningQueryExtent:!0,supportsStatistics:!0,supportsOrderBy:!0,supportsDistinct:!0,supportsQueryWithResultType:!0,supportsSqlExpression:!0,supportsReturningGeometryCentroid:!0},useStandardizedQueries:!1,geometryType:d,minScale:0,maxScale:0,extent:m,drawingInfo:{renderer:e},allowGeometryUpdates:!0,hasAttachments:!1,htmlPopupType:"esriServerHTMLPopupTypeNone",hasM:!1,hasZ:!1,objectIdField:"OBJECTID",globalIdField:"",typeIdField:"",fields:this._getLayerFields(q.fields),
indexes:[],types:[],templates:[{name:"New Feature",description:"",drawingTool:"esriFeatureEditToolPolygon",prototype:{attributes:{}}}],supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:1E4,standardMaxRecordCount:4E3,tileMaxRecordCount:4E3,maxRecordCountFactor:1,exceedsLimitFactor:1,capabilities:"Query,Editing,Create,Update,Delete"}]}},_getLayerFields:function(q){var m=[{name:"OBJECTID",type:"esriFieldTypeOID",actualType:"int",alias:"OBJECTID",sqlType:"sqlTypeOther",nullable:!1,editable:!1,
domain:null,defaultValue:null}];Q.forEach(q,J.hitch(this,function(e){"esriFieldTypeString"===e.type&&(e.actualType="nvarchar",e.sqlType="sqlTypeNVarchar");m.push(e)}));return m}})})},"widgets/SituationAwareness/js/PropertyHelper":function(){define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/dom-attr dojo/keys dojo/query dojo/Deferred jimu/BaseWidget jimu/portalUtils dojo/Evented dojo/text!./PropertyHelper.html jimu/dijit/formSelect dijit/form/ValidationTextBox".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m){return P([K,J,b],{templateString:q,baseClass:"jimu-widget-SAT-property-helper",constructor:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls.common=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.windowResize=this.own(z(window,"resize",Q.hitch(this,this._resize)));"report"===this.type?this.initReportControls():this.initSnapshotControls();this.startup()},_resize:function(){var e=!isNaN(window.innerWidth)&&
null!==window.innerWidth&&""!==window.innerWidth&&window.innerWidth?window.innerWidth:450;this.popup.width=450<=e?450:e},startup:function(){this.snapshotName.invalidMessage=this.invalidMessage;this.snapshotName.validator="report"===this.type?this.checkReportString:this.checkString;this.btnCancel.innerText=this.nls.common.cancel;r.set(this.btnCancel,"aria-label",this.nls.common.cancel);this.own(z(this.btnCancel,"click",Q.hitch(this,function(){this.emit("cancel")})));this.own(z(this.btnCancel,"keydown",
Q.hitch(this,function(e){e.keyCode!==u.ENTER&&e.keyCode!==u.SPACE||this.emit("cancel")})));this.btnOk.innerText=this.nls.common.ok;r.set(this.btnOk,"aria-label",this.nls.common.ok);this.own(z(this.btnOk,"click",Q.hitch(this,function(){this.onOkButtonClicked()})));this.own(z(this.btnOk,"keydown",Q.hitch(this,function(e){if(e.keyCode===u.ENTER||e.keyCode===u.SPACE)this.onOkButtonClicked()})))},onOkButtonClicked:function(){if(!L.contains(this.btnOk,"jimu-state-disabled")){var e={name:this.snapshotName.value.trim()};
"report"===this.type?e=Q.mixin(e,{reportLayout:{orientation:this.pageUtils.Orientation[this.orientationSelect.selectControl.value],pageSize:this.pageUtils.PageSizes[this.pageSizeSelect.selectControl.value]},comments:this.commentTextArea.value}):e.groups=[this.shareSelect.selectControl.value!==this.nls.choose_group?this.shareSelect.selectControl.value:""];this.emit("ok",e)}},initWidth:function(){this._resize()},checkString:function(e){e=e.trim();e=101>e.length&&e;var d=w(".snapshot-name-footer")[0];
d&&(this.hasNoGroups?(V.addClass(d.children[0],"jimu-state-disabled"),r.set(d.children[0],"tabindex","-1")):e?(V.removeClass(d.children[0],"jimu-state-disabled"),r.set(d.children[0],"tabindex","0")):(V.addClass(d.children[0],"jimu-state-disabled"),r.set(d.children[0],"tabindex","-1")));return e},checkReportString:function(e){e=0<e.trim().length?!0:!1;var d=w(".snapshot-name-footer")[0];d&&(e?(V.removeClass(d.children[0],"jimu-state-disabled"),r.set(d.children[0],"tabindex","0")):(V.addClass(d.children[0],
"jimu-state-disabled"),r.set(d.children[0],"tabindex","-1")));return e},getPageUtilValues:function(e,d,g){var E="A3 A4 Letter_ANSI_A Tabloid_ANSI_B Landscape Portrait".split(" "),F=["Letter ANSI A","Portrait"],G=Object.keys(e),D=[],k;for(k in G){var n=G[k],f=e[n];n&&f.hasOwnProperty(d)&&-1<E.indexOf(n)&&D.push({label:f[d],value:n,selected:f[d]===g||-1<F.indexOf(f[d])})}return D},getGroupValues:function(e){var d=new x;c.getPortal(this.portalUrl).getUser().then(Q.hitch(this,function(g){var E=[],F;for(F in g.groups){var G=
g.groups[F];E.push({label:G.title,value:G.id,selected:G.title===e})}d.resolve(E)}),Q.hitch(this,function(g){console.log(g);d.resolve([])}));return d},initSnapshotControls:function(){this.nameSpan.innerHTML=this.nls.common.name+":";this.shareSpan.innerHTML=this.nls.select_group+":";this.toggleRow(this.shareRow,!1);this.toggleRow(this.orientationRow,!0);this.toggleRow(this.pageSizeRow,!0);this.toggleRow(this.commentsRow,!0);if(null!==this.storedProps){var e=JSON.parse(this.storedProps,!0);if(e.share)var d=
e.share}this.getGroupValues(d).then(Q.hitch(this,function(g){0===g.length?this.snapshotName.hasNoGroups=!0:(this.snapshotName.hasNoGroups=!1,g=g.sort(function(E,F){return E.label.toLowerCase()<F.label.toLowerCase()?-1:E.label.toLowerCase()>F.label.toLowerCase()?1:0}));this.addSelect(this.shareSpan.innerHTML,this.shareSelect,g)}))},initReportControls:function(){this.nameSpan.innerHTML=this.nls.common.title+":";this.toggleRow(this.orientationRow,!1);this.toggleRow(this.pageSizeRow,!1);this.toggleRow(this.commentsRow,
!1);this.toggleRow(this.shareRow,!0);if(null!==this.storedProps){var e=JSON.parse(this.storedProps,!0);if(e.reportLayout){var d=e.reportLayout.pageSize;var g=e.reportLayout.orientation.Text;d=d.SizeName}}this.addSelect(this.nls.orientation,this.orientationSelect,this.getPageUtilValues(this.pageUtils.Orientation,"Text",g));this.addSelect(this.nls.pageSize,this.pageSizeSelect,this.getPageUtilValues(this.pageUtils.PageSizes,"SizeName",d))},addSelect:function(e,d,g){d.selectControl=new m({options:g,"aria-label":e,
style:"width: 100%;"});d.selectControl.placeAt(d).startup()},toggleRow:function(e,d){L.contains(e,d?"display-on":"display-off")&&L.remove(e,d?"display-on":"display-off");L.add(e,d?"display-off":"display-on")},destroy:function(){}})})},"esri/dijit/util/busyIndicator":function(){define("dijit/registry dojo/_base/lang dojo/_base/window dojo/dom dojo/dom-construct dojox/widget/Standby require".split(" "),function(P,J,Q,V,L,z,r){var u={_defaultStandbyParams:{image:r.toUrl("../images/loading-throb.gif"),
color:"#fff",opacity:.75,duration:200},create:function(w){if(w=this._normalizeParams(w))return w=new z(u._toStandbyParams(w)),L.place(w.domNode,Q.doc.body),u._createHandle(w)},_normalizeParams:function(w){if(w){if(w.target)return w;if("string"===typeof w){var x=P.byId(w);w=x?x.domNode:V.byId(w)}else w=w.domNode?w.domNode:V.byId(w);if(w)return{target:w}}},_toStandbyParams:function(w){w.imageUrl&&(w.image=w.imageUrl);w.backgroundColor&&(w.color=w.backgroundColor);w.backgroundOpacity&&(w.opacity=w.backgroundOpacity);
w.fadeDuration&&(w.duration=w.fadeDuration);return J.mixin({},u._defaultStandbyParams,w)},_createHandle:function(w){return{show:function(){w&&w.show()},hide:function(){w&&w.hide()},destroy:function(){w&&(w.destroy(),w=null)}}}};return u})},"dojox/widget/Standby":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/window dojo/_base/window dojo/_base/fx dojo/fx dijit/_Widget dijit/_TemplatedMixin dijit/registry".split(" "),
function(P,J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d){P.experimental("dojox.widget.Standby");return J("dojox.widget.Standby",[m,e],{image:require.toUrl("dojox/widget/Standby/images/loading.gif").toString(),imageText:"Please Wait...",text:"Please wait...",centerIndicator:"image",target:"",color:"#C0C0C0",duration:500,zIndex:"auto",opacity:.75,templateString:'\x3cdiv\x3e\x3cdiv style\x3d"display: none; opacity: 0; z-index: 9999; position: absolute; cursor:wait;" dojoAttachPoint\x3d"_underlayNode"\x3e\x3c/div\x3e\x3cimg src\x3d"${image}" style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px; left: 0px; cursor:wait;" dojoAttachPoint\x3d"_imageNode"\x3e\x3cdiv style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px;" dojoAttachPoint\x3d"_textNode"\x3e\x3c/div\x3e\x3c/div\x3e',
_underlayNode:null,_imageNode:null,_textNode:null,_centerNode:null,_displayed:!1,_resizeCheck:null,_started:!1,_parent:null,startup:function(g){if(!this._started){if("string"===typeof this.target){var E=d.byId(this.target);this.target=E?E.domNode:z.byId(this.target)}this.text&&(this._textNode.innerHTML=this.text);"image"===this.centerIndicator?(this._centerNode=this._imageNode,r.set(this._imageNode,"src",this.image),r.set(this._imageNode,"alt",this.imageText)):this._centerNode=this._textNode;x.set(this._underlayNode,
{display:"none",backgroundColor:this.color});x.set(this._centerNode,"display","none");this.connect(this._underlayNode,"onclick","_ignore");this.domNode.parentNode&&this.domNode.parentNode!=c.body()&&c.body().appendChild(this.domNode);7==L("ie")&&(this._ieFixNode=u.create("div"),x.set(this._ieFixNode,{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}),c.body().appendChild(this._ieFixNode));this.inherited(arguments)}},show:function(){this._displayed||(this._anim&&(this._anim.stop(),delete this._anim),
this._displayed=!0,this._size(),this._disableOverflow(),this._fadeIn())},hide:function(){if(this._displayed)try{this._anim&&(this._anim.stop(),delete this._anim),this._size()}catch(g){console.error(g)}finally{this._fadeOut(),this._displayed=!1,null!==this._resizeCheck&&(clearInterval(this._resizeCheck),this._resizeCheck=null)}},isVisible:function(){return this._displayed},onShow:function(){},onHide:function(){},uninitialize:function(){this._displayed=!1;this._resizeCheck&&clearInterval(this._resizeCheck);
x.set(this._centerNode,"display","none");x.set(this._underlayNode,"display","none");7==L("ie")&&this._ieFixNode&&(c.body().removeChild(this._ieFixNode),delete this._ieFixNode);this._anim&&(this._anim.stop(),delete this._anim);this._centerNode=this._textNode=this._imageNode=this.target=null;this.inherited(arguments)},_size:function(){if(this._displayed){var g=r.get(c.body(),"dir");g&&(g=g.toLowerCase());var E=this._scrollerWidths(),F=this.target,G=x.get(this._centerNode,"display");x.set(this._centerNode,
"display","block");var D=w.position(F,!0);if(F===c.body()||F===c.doc)D=K.getBox(),D.x=D.l,D.y=D.t;var k=w.getMarginBox(this._centerNode);x.set(this._centerNode,"display",G);if(this._ieFixNode){var n=-this._ieFixNode.offsetTop/1E3;D.x=Math.floor((D.x+.9)/n);D.y=Math.floor((D.y+.9)/n);D.w=Math.floor((D.w+.9)/n);D.h=Math.floor((D.h+.9)/n)}var f=x.get(F,"zIndex"),y=G=f;if("auto"===this.zIndex)if("auto"!=f)G=parseInt(G,10),y=parseInt(y,10);else{var I=F;if(I&&I!==c.body()&&I!==c.doc)for(I=F.parentNode,
n=-1E5;I&&I!==c.body();)(f=x.get(I,"zIndex"))&&"auto"!==f&&(f=parseInt(f,10),n<f&&(n=f,G=f+1,y=f+1)),I=I.parentNode}else G=parseInt(this.zIndex,10),y=parseInt(this.zIndex,10);x.set(this._centerNode,"zIndex",y);x.set(this._underlayNode,"zIndex",G);if((G=F.parentNode)&&G!==c.body()&&F!==c.body()&&F!==c.doc){I=D.h;y=D.w;F=w.position(G,!0);this._ieFixNode&&(n=-this._ieFixNode.offsetTop/1E3,F.x=Math.floor((F.x+.9)/n),F.y=Math.floor((F.y+.9)/n),F.w=Math.floor((F.w+.9)/n),F.h=Math.floor((F.h+.9)/n));F.w-=
G.scrollHeight>G.clientHeight&&0<G.clientHeight?E.v:0;F.h-=G.scrollWidth>G.clientWidth&&0<G.clientWidth?E.h:0;"rtl"===g&&(L("opera")?(D.x+=G.scrollHeight>G.clientHeight&&0<G.clientHeight?E.v:0,F.x+=G.scrollHeight>G.clientHeight&&0<G.clientHeight?E.v:0):L("ie")?F.x+=G.scrollHeight>G.clientHeight&&0<G.clientHeight?E.v:0:L("webkit"));F.w<D.w&&(D.w-=F.w);F.h<D.h&&(D.h-=F.h);var C=F.y,N=F.y+F.h,R=D.y,a=D.y+I;g=F.x;n=F.x+F.w;f=D.x;var v=D.x+y;if(a>C&&R<C)D.y=F.y,I-=C-R,D.h=I<F.h?I:D.h-2*(G.scrollWidth>
G.clientWidth&&0<G.clientWidth?E.h:0);else if(R<N&&a>N)D.h=N-R;else if(a<=C||R>=N)D.h=0;if(v>g&&f<g)D.x=F.x,y-=g-f,D.w=y<F.w?y:D.w-2*(G.scrollHeight>G.clientHeight&&0<G.clientHeight?E.w:0);else if(f<n&&v>n)D.w=n-f;else if(v<=g||f>=n)D.w=0}0<D.h&&0<D.w?(x.set(this._underlayNode,{display:"block",width:D.w+"px",height:D.h+"px",top:D.y+"px",left:D.x+"px"}),E=["borderRadius","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],this._cloneStyles(E),L("ie")||(E=
"MozBorderRadius MozBorderRadiusTopleft MozBorderRadiusTopright MozBorderRadiusBottomleft MozBorderRadiusBottomright WebkitBorderRadius WebkitBorderTopLeftRadius WebkitBorderTopRightRadius WebkitBorderBottomLeftRadius WebkitBorderBottomRightRadius".split(" "),this._cloneStyles(E,this)),E=D.h/2-k.h/2,G=D.w/2-k.w/2,D.h>=k.h&&D.w>=k.w?x.set(this._centerNode,{top:E+D.y+"px",left:G+D.x+"px",display:"block"}):x.set(this._centerNode,"display","none")):(x.set(this._underlayNode,"display","none"),x.set(this._centerNode,
"display","none"));if(null===this._resizeCheck){var H=this;this._resizeCheck=setInterval(function(){H._size()},100)}}},_cloneStyles:function(g){Q.forEach(g,function(E){x.set(this._underlayNode,E,x.get(this.target,E))},this)},_fadeIn:function(){var g=this,E=b.animateProperty({duration:g.duration,node:g._underlayNode,properties:{opacity:{start:0,end:g.opacity}}}),F=b.animateProperty({duration:g.duration,node:g._centerNode,properties:{opacity:{start:0,end:1}},onEnd:function(){g.onShow();delete g._anim}});
this._anim=q.combine([E,F]);this._anim.play()},_fadeOut:function(){var g=this,E=b.animateProperty({duration:g.duration,node:g._underlayNode,properties:{opacity:{start:g.opacity,end:0}},onEnd:function(){x.set(this.node,{display:"none",zIndex:"-1000"})}}),F=b.animateProperty({duration:g.duration,node:g._centerNode,properties:{opacity:{start:1,end:0}},onEnd:function(){x.set(this.node,{display:"none",zIndex:"-1000"});g.onHide();g._enableOverflow();delete g._anim}});this._anim=q.combine([E,F]);this._anim.play()},
_ignore:function(g){g&&V.stop(g)},_scrollerWidths:function(){var g=u.create("div");x.set(g,{position:"absolute",opacity:0,overflow:"hidden",width:"50px",height:"50px",zIndex:"-100",top:"-200px",padding:"0px",margin:"0px"});var E=u.create("div");x.set(E,{width:"200px",height:"10px"});g.appendChild(E);c.body().appendChild(g);E=w.getContentBox(g);x.set(g,"overflow","scroll");var F=w.getContentBox(g);c.body().removeChild(g);return{v:E.w-F.w,h:E.h-F.h}},_setTextAttr:function(g){this.text=this._textNode.innerHTML=
g},_setColorAttr:function(g){x.set(this._underlayNode,"backgroundColor",g);this.color=g},_setImageTextAttr:function(g){r.set(this._imageNode,"alt",g);this.imageText=g},_setImageAttr:function(g){r.set(this._imageNode,"src",g);this.image=g},_setCenterIndicatorAttr:function(g){this.centerIndicator=g;"image"===g?(this._centerNode=this._imageNode,x.set(this._textNode,"display","none")):(this._centerNode=this._textNode,x.set(this._imageNode,"display","none"))},_setTargetAttr:function(g){if("string"===typeof g){var E=
d.byId(g);this._set("target",E?E.domNode:z.byId(g))}else this._set("target",g)},_disableOverflow:function(){if(this.target===c.body()||this.target===c.doc){this._overflowDisabled=!0;var g=c.body();this._oldOverflow=g.style&&g.style.overflow?x.get(g,"overflow"):"";if(L("ie")&&!L("quirks")){if(g.parentNode&&g.parentNode.style&&g.parentNode.style.overflow)this._oldBodyParentOverflow=g.parentNode.style.overflow;else try{this._oldBodyParentOverflow=x.get(g.parentNode,"overflow")}catch(E){this._oldBodyParentOverflow=
"scroll"}x.set(g.parentNode,"overflow","hidden")}x.set(g,"overflow","hidden")}},_enableOverflow:function(){if(this._overflowDisabled){delete this._overflowDisabled;var g=c.body();L("ie")&&!L("quirks")&&(g.parentNode.style.overflow=this._oldBodyParentOverflow,delete this._oldBodyParentOverflow);x.set(g,"overflow",this._oldOverflow);if(L("webkit")){var E=u.create("div",{style:{height:"2px"}});g.appendChild(E);setTimeout(function(){g.removeChild(E)},0)}delete this._oldOverflow}}})})},"widgets/SituationAwareness/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:jimu/dijit/templates/ReportTemplate.html":'\x3c!DOCTYPE HTML\x3e\r\n\x3chtml lang\x3d"en" dir\x3d"ltr"\x3e\r\n\r\n\x3chead id\x3d"reportHead"\x3e\r\n  \x3cmeta charset\x3d"utf-8"\x3e\r\n  \x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e\r\n  \x3ctitle\x3e\x3c/title\x3e\r\n  \x3cscript\x3e\r\n    // Show/hide text area controls based on the value\r\n    function onPrintButtonClicked() {\r\n      var notesContainer, i;\r\n      notesContainer \x3d document.getElementsByClassName("esriCTNotesContainer");\r\n      //process notes to show/hide based on contents\r\n      for (i \x3d 0; i \x3c notesContainer.length; i++) {\r\n        if (notesContainer[i]) {\r\n          //Hide the notes which are not having values\r\n          if (notesContainer[i].children[1].value.trim() \x3d\x3d\x3d "") {\r\n            notesContainer[i].className +\x3d " esriCTHideReportNotes";\r\n          }\r\n          else {\r\n            //Removes hidden class if available\r\n            notesContainer[i].className \x3d\r\n              notesContainer[i].className.replace("esriCTHideReportNotes", "");\r\n          }\r\n        }\r\n      }\r\n      //after processing notes, print the window\r\n      window.print();\r\n    }\r\n  \x3c/script\x3e\r\n  \x3c!-- Report prev page css --\x3e\r\n  \x3cstyle type\x3d"text/css"\x3e\r\n    .esriCTReportMapWait {\r\n      height: 5px;\r\n      width: 100%;\r\n      position: relative;\r\n      overflow: hidden;\r\n      background-color: #ddd;\r\n    }\r\n\r\n    .esriCTReportMapWait:before {\r\n      display: block;\r\n      position: absolute;\r\n      content: "";\r\n      left: -200px;\r\n      width: 200px;\r\n      height: 5px;\r\n      background-color: #2980b9;\r\n      animation: loading 2s linear infinite;\r\n    }\r\n\r\n    @keyframes loading {\r\n      from {\r\n        left: -200px;\r\n        width: 30%;\r\n      }\r\n      50% {\r\n        width: 30%;\r\n      }\r\n      70% {\r\n        width: 70%;\r\n      }\r\n      80% {\r\n        left: 50%;\r\n      }\r\n      95% {\r\n        left: 120%;\r\n      }\r\n      to {\r\n        left: 100%;\r\n      }\r\n    }\r\n\r\n    .esriCTHTMLData {\r\n      position: relative;\r\n      width: 100%;\r\n      height: auto;\r\n    }\r\n\r\n    .jimu-rtl .esriCTHTMLData {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable {\r\n      margin-top: 10px;\r\n      padding: 0;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n      width: 100%;\r\n      page-break-inside: avoid;\r\n      table-layout: fixed;\r\n    }\r\n\r\n    .jimu-rtl .esriCTTable {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n      background-color: #E4E4E4;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTSectionTitle {\r\n      font-size: 18px;\r\n      color: #0f96cc;\r\n      font-weight: bold;\r\n      margin: 30px 0px;\r\n      width: calc(100% - 10px);\r\n      word-break: break-all;\r\n    }\r\n\r\n    .jimu-rtl .esriCTSectionTitle {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportMap .esriCTSectionTitle {\r\n      float: none;\r\n    }\r\n\r\n    .esriCTReportLogo {\r\n      float: left;\r\n      max-width: calc(50% - 10px);\r\n      margin: auto 10px auto 0;\r\n      max-height: 90%;\r\n      position: absolute;\r\n      top: 0;\r\n      bottom: 0;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportLogo {\r\n      float: right;\r\n      margin: auto 0 auto 10px;\r\n    }\r\n\r\n    .esriCTPrintTitleDiv {\r\n      height: 56px;\r\n      float: right;\r\n      min-width: 50%;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintTitleDiv {\r\n      float: left;\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTInputTitle {\r\n      height: 55px;\r\n      line-height: 55px;\r\n      border: none;\r\n      font-size: 25px;\r\n      width: 100%;\r\n      padding: 0px;\r\n    }\r\n\r\n    .esriCTInputTitle::-ms-clear {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      background: #FFF;\r\n      border: solid 1px #000;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n      width: 797px;\r\n    }\r\n\r\n    .esriCTReportMap {\r\n      text-align: center;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      max-width: 96%;\r\n      margin-top: 10px;\r\n    }\r\n\r\n    .esriCTReportLandscapeMapImg {\r\n      max-width: 80%;\r\n    }\r\n\r\n    .esriCTReportMapFail {\r\n      height: 50px;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      text-align: center;\r\n      font-size: 80%;\r\n      padding: 10px 0;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTPrintPage {\r\n      padding: 30px 0;\r\n      margin: 20px auto;\r\n      font-family: arial, sans-serif;\r\n      font-size: 13px;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      width: 100%;\r\n      position: fixed;\r\n      left: 0;\r\n      top: 0;\r\n      z-index: 6;\r\n      height: 50px;\r\n      background: #e2f1fc;\r\n      border-bottom: 1px solid #000;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBar {\r\n      left: inherit;\r\n      right: 0;\r\n    }\r\n\r\n    .esriCTPrintButton,\r\n    .esriCTCloseButton {\r\n      color: #444;\r\n      font-family: Verdana, Helvetica, sans-serif;\r\n      font-size: 12px;\r\n      -moz-border-radius: 3px;\r\n      -webkit-border-radius: 3px;\r\n      border-radius: 3px;\r\n      border: 1px solid #8b8b8b;\r\n      box-shadow: none;\r\n      -webkit-box-shadow: none;\r\n      background: #F2F2F2;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #F2F2F2), color-stop(100%, #D1D1D1));\r\n      background: -webkit-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -o-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -ms-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: linear-gradient(to bottom, #F2F2F2 0%, #D1D1D1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#F2F2F2\', endColorstr\x3d\'#D1D1D1\', GradientType\x3d0);\r\n      margin: 10px 20px;\r\n      line-height: 16px;\r\n      display: block;\r\n      padding: 5px 10px;\r\n      outline: 0;\r\n      text-decoration: none;\r\n      cursor: pointer;\r\n      font-weight: 400;\r\n      white-space: nowrap;\r\n      float: right;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintButton,\r\n    .jimu-rtl .esriCTCloseButton {\r\n      float: left;\r\n    }\r\n\r\n    .esriCTPrintButton:hover,\r\n    .esriCTPrintButton:focus,\r\n    .esriCTCloseButton:hover,\r\n    .esriCTCloseButton:focus {\r\n      background: #E5E6E6;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E5E6E6), color-stop(100%, #A0A1A1));\r\n      background: -webkit-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -o-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -ms-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: linear-gradient(to bottom, #E5E6E6 0%, #A0A1A1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#E5E6E6\', endColorstr\x3d\'#A0A1A1\', GradientType\x3d0);\r\n    }\r\n\r\n    .esriCTReportHeader {\r\n      display: block;\r\n      width: 100%;\r\n      height: 60px;\r\n      border-bottom: 1px solid #000;\r\n      margin-bottom: 5px;\r\n      position: relative;\r\n    }\r\n\r\n    .esriCTReportBarMsg {\r\n      text-align: center;\r\n      margin-top: 16px;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBarMsg {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTNotesContainer {\r\n      width: 100%;\r\n      margin-top: 30px;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      resize: none;\r\n      width: calc(100% - 5px);\r\n      max-width: calc(100% - 5px);\r\n      font-family: "Arial";\r\n      font-size: 13px;\r\n      border: 1px solid gray;\r\n      overflow-y: hidden;\r\n      /* prevents scroll bar flash */\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: none;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotesParagraph {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotes {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTHidden {\r\n      display: none;\r\n    }\r\n  \x3c/style\x3e\r\n  \x3c!-- Media print css --\x3e\r\n  \x3cstyle type\x3d"text/css" media\x3d"print"\x3e\r\n    .esriCTPrintPage {\r\n      padding: 0;\r\n      color: #000;\r\n      margin: 0;\r\n      float: none;\r\n      background: #fff url(none);\r\n    }\r\n\r\n    .esriCTTable {\r\n      page-break-inside: avoid;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n    }\r\n\r\n    .esriCTPageBreak {\r\n      page-break-after: always;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      font-size: 75%;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      box-shadow: none;\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: block;\r\n    }\r\n\r\n    .esriCTHideReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n    }\r\n\r\n    .esriCTTable tr {\r\n      page-break-inside: avoid;\r\n      page-break-after: auto;\r\n    }\r\n\r\n  \x3c/style\x3e\r\n  \x3cscript\x3e\r\n    function showError(evt) {\r\n      alert(document.getElementById(\'showErrorButton\').innerHTML);\r\n    }\r\n  \x3c/script\x3e\r\n\x3c/head\x3e\r\n\r\n\x3cbody id\x3d"reportBody" class\x3d"esriCTPrintPage"\x3e\r\n  \x3cbutton id\x3d"showErrorButton" style\x3d"display: none" onclick\x3d"showError()"\x3e\x3c/button\x3e\r\n  \x3cdiv class\x3d"esriCTReportBar"\x3e\r\n    \x3cdiv id\x3d"closeButton" class\x3d"esriCTCloseButton" title\x3d"Close" onclick\x3d"window.close();"\x3eClose\x3c/div\x3e\r\n    \x3cdiv id\x3d"printButton" class\x3d"esriCTPrintButton" title\x3d"Print" onclick\x3d"onPrintButtonClicked();"\x3ePrint\x3c/div\x3e\r\n    \x3cdiv id\x3d"reportBarMsg" class\x3d"esriCTReportBarMsg"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"reportMain" class\x3d"esriCTReportMain"\x3e\r\n    \x3cdiv id\x3d"reportHeader" class\x3d"esriCTReportHeader"\x3e\r\n      \x3cimg id\x3d"reportLogo" class\x3d"esriCTReportLogo esriCTHidden" src\x3d""\x3e\r\n      \x3cdiv id\x3d"printTitleDiv" class\x3d"esriCTPrintTitleDiv"\x3e\r\n        \x3cinput id\x3d"reportTitle" type\x3d"text" class\x3d"esriCTInputTitle" tabindex\x3d"0" role\x3d"textbox"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"reportData"\x3e\x3c/div\x3e\r\n    \x3cdiv id\x3d"footNotes" class\x3d"esriCTReportFooter"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/body\x3e\r\n\r\n\x3c/html\x3e',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/js/PropertyHelper.html":'\x3cdiv\x3e  \r\n  \x3cdiv class\x3d"jimu-r-row"\x3e\r\n    \x3ctable class\x3d"width-all"\x3e\r\n      \x3c!--name--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"nameRow"\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"nameSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cinput class\x3d"width-all" data-dojo-attach-point\x3d"snapshotName" data-dojo-type\x3d"dijit/form/ValidationTextBox" /\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--share--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"shareRow"\x3e\r\n        \x3ctd class\x3d"width-all pad-top-10"\x3e\r\n          \x3cspan class\x3d"hintText"\x3e${nls.select_group_instruction}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"shareSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"shareSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--orientation--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"orientationRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"orientationSpan"\x3e${nls.orientation}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"orientationSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--page size--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"pageSizeRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"pageSizeSpan"\x3e${nls.pageSize}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"pageSizeSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--comments--\x3e\r\n  \x3cdiv class\x3d"display-off pad-top-10" data-dojo-attach-point\x3d"commentsRow"\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3cdiv class\x3d"jimu-r-row"\x3e\r\n        \x3cspan class\x3d"label" data-dojo-attach-point\x3d"commentsSpan"\x3e${nls.comments}:\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3ctextarea aria-label\x3d"${nls.comments}" class\x3d"commentTextArea" data-dojo-attach-point\x3d"commentTextArea" rows\x3d"5"\x3e\x3c/textarea\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"snapshot-name-footer jimu-float-trailing pad-top-10"\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"-1" class\x3d"jimu-btn ok pad-right-5 jimu-state-disabled" data-dojo-attach-point\x3d"btnOk"\x3e\x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"jimu-btn cancel" data-dojo-attach-point\x3d"btnCancel"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"footerNode" class\x3d"SA_panelFooter dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelLeft" class\x3d"SA_panelLeft" data-dojo-attach-event\x3d"onclick:_navTabsLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"footerContentNode" class\x3d"SA_panelFooterContent"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv role\x3d"tablist" data-dojo-attach-point\x3d"tabsNode" class\x3d"SA_SAT_tabs"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelRight" class\x3d"SA_panelRight" data-dojo-attach-event\x3d"onclick:_navTabsRight"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" data-dojo-attach-point\x3d"closeButton" tabindex\x3d"-1" class\x3d"SA_panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBL" class\x3d"innerBL" data-dojo-attach-event\x3d"onclick:_navLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"SA_tabPanel0" role\x3d"tabpanel" class\x3d"SAT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"SAT_tabPanelContent" style\x3d"min-width: 650px"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"incidentsLocate" class\x3d"SATcolLocate" style\x3d"width:auto; min-width:220px"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locateIncident" class\x3d"label locateIncident"\x3e\x3c/div\x3e\r\n            \x3cdiv role\x3d"button" aria-label\x3d"${nls.clearIncident}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearIncident"\r\n              class\x3d"label clearIncident" data-dojo-attach-event\x3d"onclick:_clear"\x3e\r\n              ${nls.clearIncident}\r\n            \x3c/div\x3e\r\n            \x3cbr /\x3e\r\n            \x3cdiv class\x3d"locateIncidentContainer"\x3e\r\n              \x3cdiv class\x3d"colBar SATdrawCol"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"imgContainer" class\x3d"imgContainer"\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn0"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn1"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn2"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv class\x3d"bufferIncidentContainer"\x3e\r\n                \x3cdiv class\x3d"bufferControlsContainer"\x3e\r\n                  \x3cdiv data-a11y-label-id\x3d"spinnerValue" data-dojo-attach-point\x3d"buffer_lbl" class\x3d"label bufferLabel"\x3e\x3c/div\x3e\r\n                  \x3cdiv class\x3d"spinnerValueDIV"\x3e\r\n                    \x3cinput data-a11y-label-by\x3d"spinnerValue" role\x3d"button" role\x3d"textbox" tabindex\x3d"0" data-dojo-attach-point\x3d"spinnerValue"\r\n                      data-dojo-type\x3d"dijit/form/NumberSpinner" class\x3d"spinnerValue" name\x3d"spinnerValue" /\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"buffer_lbl_unit" class\x3d"label bufferUnit"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"saveOptions" class\x3d"SATcol2"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"borderCol" class\x3d"borderCol display-off"\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"SATcol reverseGeocodingDIV"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"div_reversed_address" class\x3d"label reversedAddressDIV"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBR" class\x3d"innerBR" data-dojo-attach-event\x3d"onclick:_navRight"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"messageNode" class\x3d"SA_panelMessage"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/css/style.css":".jimu-widget-SAT {color: #ffffff !important; background-color: #4c4c4c; left: 0px; right: 0px; bottom: 0px; height: 155px !important; display: block; z-index: 100 !important;}.action2 {padding-left: 10px;}.jimu-widget-SAT .innerBL {display: none; width: 10px; height: 20px; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; left: 0px; z-index: 2; background-size:cover; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBL {right: 0px;}.jimu-widget-SAT .innerBL:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .innerBR {display: none; width: 10px; height: 20px; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; right: 0px; z-index: 2; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBR {left: 0px;}.jimu-widget-SAT .innerBR:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-SAT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-SAT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-SAT .reversedAddressDIV {width:100%;}.jimu-widget-SAT .spinnerValue {width: 80px; align: left;}.jimu-widget-SAT .panelBottom {position: absolute; width: 100%; height: 155px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-SAT .SA_panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-SAT .SA_panelFooter {position: absolute; top: 0px; left: 0px; right: 0px; height: 30px; line-height: 30px; overflow: hidden; border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 0px; right: 24px; height: 30px; overflow-x: hidden; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-SAT .SA_panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 30px; line-height: 30px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 12px;}.jimu-widget-SAT .SA_panelRight {display: none; position: absolute; left: auto; right: 24px; width: 34px; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelRight:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelRight {right: 0px; left: auto; width: 0px;}.jimu-widget-SAT .SA_panelLeft {display: none; position: absolute; left: 0px; right: auto; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-rtl .jimu-widget-SAT .SA_panelLeft {left: 24px; width: 34px; right: auto;}.jimu-widget-SAT .SA_panelLeft:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .panelContainer {position: absolute; top: 30px; width: 100%; height: 125px; overflow: hidden; display: block;}.jimu-widget-SAT .SAT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 115px; display: none; overflow: auto;}.jimu-widget-SAT .SAT_tabPanelContent {position: absolute; top: 0px; height: 100px; white-space: nowrap; display: flex; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;}.jimu-widget-SAT .locateIncidentContainer {display: flex; float: left; margin-top: 20px;}.jimu-rtl .jimu-widget-SAT .locateIncidentContainer {display: flex; float: right; margin-top: 20px;}.jimu-widget-SAT .bufferIncidentContainer {display: table-cell;}.jimu-widget-SAT .bufferControlsContainer {float: left; padding-left: 20px;}.jimu-widget-SAT .SA_SAT_tabs {white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}@supports (-ms-ime-align:auto) {.SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}} _:-ms-fullscreen, :root .SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-SAT .SATTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 30px; float: left; line-height: 30px; font-size: 13px; padding: 0 30px 0 30px; cursor: pointer; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; opacity: .85; border-right: 1px solid #d2dae2; border-top: 2px solid transparent;}.jimu-widget-SAT .active .SATTab:focus {border-top: 2px solid #15a4fa; opacity: 1;}.jimu-rtl .jimu-widget-SAT .SATTab {float: right;}.jimu-widget-SAT .active {background-color: #353535; background-color: rgba(0, 0, 0, 0.3); opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .activeBlack {background-color: #353535; opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .SATcol {float: left; height: 100px; min-width: 220px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcol {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolExport {float: left; height: 100px; width: 65px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolExport {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .lightThemeBorder{border-right: 1px solid #353535; border-right: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBorder{border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-SAT .lightThemeBorder{border-left: 1px solid #353535; border-left: 1px solid rgba(0, 0, 0, 0.3);}.jimu-rtl .jimu-widget-SAT .darkThemeBorder{border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-SAT .SATcolLocate {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 30px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolLocate {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolWrap {white-space: pre-wrap; white-space: -moz-pre-wrap; word-wrap: break-word;}.jimu-widget-SAT .SATcol2 {float: left; height: 100px; border-left: none; margin-left: 5px; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden; display: table;}.jimu-rtl .jimu-widget-SAT .SATcol2 {float: right; border-right: none; overflow: hidden; margin-right: 5px;}.jimu-widget-SAT .borderCol {height: 100px; float: left;}.jimu-rtl .jimu-widget-SAT .borderCol {float: right; border-right: none;}.jimu-widget-SAT .SATcolSmall {float: left; height: 90px; width: 165px; border-left: none; margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-SAT .SATcolSmall {float: right; border-right: none;}.jimu-widget-SAT .SATcolLast {border-left: none; border-right: none;}.jimu-widget-SAT .SATcol .label,.jimu-widget-SAT .SATcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-SAT .SATcol .colBar {height: 32px; display: table-cell; width: 130px;}.jimu-widget-SAT .SATdrawCol {display: block; float: left;}.jimu-rtl .jimu-widget-SAT .SATdrawCol {display: block; float: right;}.jimu-widget-SAT .displayTC{display: table-cell;}.jimu-widget-SAT .displayTR{display: table-row;}.jimu-widget-SAT .displayT{display: table;}.jimu-widget-SAT .display-on{display: block;}.jimu-widget-SAT .display-off{display: none;}.jimu-widget-SAT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32 {width: 32px; height: 32px; border-radius: 2px; margin-right: 5px; cursor: pointer;}.jimu-widget-SAT .btn32img {padding: 8px; height: 32px; width: 32px; background-repeat: no-repeat; background-position: center;}.jimu-widget-SAT .lightThemeBackground{background-color: #353535; background-color: rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBackground{}.jimu-widget-SAT .btn32img:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32imgBlack {padding: 8px; height: 32px; width: 32px; background-repeat: no-repeat; background-position: center;}.jimu-widget-SAT .btn32imgBlack:hover {background-color: #262626;}.jimu-widget-SAT .dijitTextBox,.jimu-widget-SAT .dijitTextBoxHover,.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputInner,.jimu-widget-SAT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-SAT .btnExport {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btnExport:focus, .jimu-widget-SAT .directionsButton:focus {outline: #15a4fa solid 2px !important; outline-offset: -2px;}.jimu-widget-SAT .btnExportBlack {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExportBlack:hover {background-color: #262626;}.jimu-widget-SAT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-SAT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-SAT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-SAT .btnDisabled {opacity: .5; cursor: default;}.jimu-widget-SAT .colSummary {font-size: 28px; padding-top: 10px;}.jimu-widget-SAT .colGroupedSummary {font-size: 28px; padding-top: 3px;}.jimu-widget-SAT .SATcolRec {float: left; height: 100%; border-left: none; margin-left: 0; padding: 0 10px; text-align: left; text-overflow: ellipsis; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; min-width: 220px;}.jimu-rtl .jimu-widget-SAT .SATcolRec {float: right; border-right: none; text-align: right;}.jimu-widget-SAT .SATcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-SAT .SATcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-SAT .SATcolRecNum:focus{outline: #15a4fa solid 2px !important; outline-offset: -2px;}.jimu-widget-SAT .SATcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .SATcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .SATcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-SAT .SATcolInfo {position: relative; margin-top: 5px; width: 100%; display: block; overflow: hidden;}.jimu-widget-SAT .noFeaturesActive {opacity: .5; cursor: default;}.jimu-widget-SAT .noFeatures {display: none;}.jimu-widget-SAT .locateIncident{float: left;}.jimu-rtl .jimu-widget-SAT .locateIncident{float: right;}.jimu-widget-SAT .clearIncident{float: right; text-decoration: underline; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .clearIncident{float: left; text-decoration: underline; cursor: pointer;}.jimu-widget-SAT .imgContainer{display: table; width: 130px; padding-top: 10px;}.jimu-widget-SAT .bufferLabel{}.jimu-widget-SAT .spinnerValueDIV{float: right; margin-top: 8px; margin-left: 4px; display: table-row;}.jimu-rtl .jimu-widget-SAT .spinnerValueDIV{float: left; margin-top: 8px; margin-right: 4px; display: table-row;}.jimu-widget-SAT .bufferUnit{display: inline; margin-left: 4px; margin-top: 7px;}.jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .pad-top-5{padding-top: 5px;}.jimu-widget-SAT .pad-top-10{padding-top: 10px;}.jimu-popup .SAT-warning-icon {width: 25px; height: 25px; position: relative; background-size: contain; background-repeat: no-repeat; background-image: url('../images/warning.png'); margin-top: 8px;}.jimu-popup .SAT-warning-hint {color: #898989; font-size: 11px; margin-bottom: 10px;}.jimu-widget-SAT-property-helper .pad-top-5{padding-top: 5px;}.jimu-widget-SAT-property-helper .pad-top-10{padding-top: 10px;}.jimu-widget-SAT-property-helper .pad-right-5{padding-right: 5px;}.jimu-rtl .jimu-widget-SAT-property-helper .pad-right-5{padding-left: 5px;}.jimu-widget-SAT-property-helper .commentTextArea{width: 100%;}.jimu-widget-SAT-property-helper .width-all{width: 100%;}.jimu-widget-SAT-property-helper .display-on{display: block;}.jimu-widget-SAT-property-helper .display-off{display: none;}.jimu-widget-SAT-property-helper .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden; max-width: 153px;}@media screen and (max-width: 420px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 133px;}}@media screen and (max-width: 400px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 113px;}}@media screen and (max-width: 360px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 105px;}}@media screen and (max-width: 320px) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 87px;}}.jimu-widget-SAT-property-helper .hintText {font-size: 12px; color: #a0acbf; font-style: oblique;}.esriMobileInfoViewItem .esriAttributeInspector .esriCTAIDeleteButtonWidth {width: 60px !important; background-image: none !important;}.jimu-rtl .esriMobileInfoViewItem .esriAttributeInspector .atiDeleteButton {float: right;}.jimu-widget-SAT-ai .esriAttributeInspector .atiRichTextField{}.jimu-widget-SAT-ai .esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px; width: 100%;}.jimu-widget-SAT-ai .esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.jimu-widget-SAT-ai .esriAttributeInspector .atiButton {padding-top:2px; margin-right: 10px; display: inline-table; background-image: none;}.jimu-rtl .jimu-widget-SAT-ai .esriAttributeInspector .atiButton {float: right;}.jimu-widget-SAT-ai .esriAttributeInspector .atiButtons {height:30px; width:100%; display:inline-block; width:100%;}.jimu-widget-SAT-ai .esriAttributeInspector {display:inline-block;}.jimu-widget-SAT-ai .esriAttributeInspector .dijitArrowButtonContainer {margin-top:0px; margin-right:0px; margin-bottom:0px; width:18px;}.jimu-widget-SAT-ai .esriAttributeInspector .atiNavButtons {display:none; visibility:hidden; height: 0px;}.jimu-widget-SAT-ai .esriPopup .spinner {display: none;}.DashboardTheme.light .jimu-widget-SAT .panelBottom {color: #000000 !important;}",
"*now":function(P){P(['dojo/i18n!*preload*widgets/SituationAwareness/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dijit/form/Button jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/accessibleUtils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/dijit/Report jimu/dijit/PageUtils dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-attr dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dojo/topic dojo/aspect dojo/Deferred dojo/DeferredList dojo/string dojo/colors esri/geometry/geometryEngine esri/geometry/Point esri/geometry/webMercatorUtils esri/tasks/ProjectParameters esri/geometry/jsonUtils esri/graphic esri/graphicsUtils esri/geometry/geodesicUtils esri/Color esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/SpatialReference esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/GeometryService esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/toolbars/draw esri/dijit/AttributeInspector jimu/dijit/Popup esri/tasks/query esri/request esri/lang ./js/SummaryInfo ./js/GroupedCountInfo ./js/ClosestInfo ./js/ProximityInfo ./js/SnapShotUtils ./js/PropertyHelper ./js/analysisUtils dojo/keys esri/dijit/util/busyIndicator dojo/domReady!".split(" "),function(P,
J,Q,V,L,z,r,u,w,x,K,c,b,q,m,e,d,g,E,F,G,D,k,n,f,y,I,C,N,R,a,v,H,l,h,A,O,X,W,ba,ea,fa,ha,S,T,Y,ca,ia,oa,ja,pa,na,sa,ua,ya,Fa,Ga,Da,Ha,Ia,Ja,Ka,Aa,La,Ea,qa,Ma){return P([V,J],{baseClass:"jimu-widget-SAT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,lyrSummary:null,lyrEdit:null,toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incidents:[],buffers:[],gsvc:null,locator:null,stops:[],initalLayerVisibility:{},
startX:0,mouseDown:!1,btnNodes:[],panelNodes:[],tabNodes:[],currentSumLayer:null,currentGrpLayer:null,mapBottom:null,mapResize:null,geomExtent:void 0,selectedGraphic:!1,honorTemplate:!1,Incident_Local_Storage_Key:"SAT_Incident",SLIDER_MAX_VALUE:1E4,isInitialLoad:!0,busyIndicator:null,postCreate:function(){this.inherited(arguments);this.nls=G.mixin(this.nls,window.jimuNls.units);this.nls=G.mixin(this.nls,window.jimuNls.common);this.widgetActive=this.openAtStartAysn=!0;window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);E.set(this.closeButton,"aria-label",this.nls.close);this.own(m(this.domNode,"keydown",G.hitch(this,function(t){t.keyCode===qa.ESCAPE&&(t.stopPropagation(),this.closeButton.focus())})));this.own(m(this.panelContainer,"keydown",G.hitch(this,function(t){t.keyCode===qa.ESCAPE&&(t.stopPropagation(),n(".SATTab.active",this.domNode)[0].focus())})));this.own(m(this.closeButton,"keydown",G.hitch(this,function(t){if(t.keyCode===qa.ENTER||t.keyCode===qa.SPACE)t.stopPropagation(),this._close()})));z.has("chrome")&&
e.set(this.tabsNode,"position","absolute");this.div_reverse_geocoding&&b.setStyle(this.div_reverse_geocoding,"display","none")},postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0},startup:function(){this.inherited(arguments);this.updateTabs();this.btnNodes=[];this.panelNodes=[];this.tabNodes=[];this.reportSrc=this.folderUrl+"css/images/report.png";this.saveSrc=this.folderUrl+"css/images/save.png";this.downloadAllSrc=this.folderUrl+"css/images/download_all.png";this.snapshotSrc=
this.folderUrl+"css/images/snapshot.png";this.processingSrc=this.folderUrl+"css/images/processing.gif";this.editTemplate=this.config.editTemplate;this.saveEnabled=this.config.saveEnabled;this.summaryDisplayEnabled=this.config.summaryDisplayEnabled;this.busyIndicator=Ma.create({target:this.domNode,backgroundOpacity:0});this.snapshotEnabled="undefined"!==typeof this.config.snapshotEnabled?this.config.snapshotEnabled:!1;this.reportEnabled="undefined"!==typeof this.config.reportEnabled?this.config.reportEnabled:
!1;this.allEnabled=this.saveEnabled&&this.snapshotEnabled&&this.reportEnabled;this.SLIDER_MAX_VALUE=z.parseNumber(z.localizeNumber(this.config.bufferRange.maximum.toString()));this.SLIDER_MAX_VALUE_DISPLAY=z.localizeNumber(this.config.bufferRange.maximum.toString());this.SLIDER_MIN_VALUE=z.parseNumber(z.localizeNumber(this.config.bufferRange.minimum.toString()));this.SLIDER_MIN_VALUE_DISPLAY=z.localizeNumber(this.config.bufferRange.minimum.toString());"undefined"===typeof this.config.bufferRange._default&&
(this.config.bufferRange._default=this.config.bufferRange.minimum);this.SLIDER_DEFAULT_VALUE=z.parseNumber(z.localizeNumber(this.config.bufferRange._default.toString()));u.getInstance(this.map,this.map.itemInfo).then(G.hitch(this,function(t){this.opLayers=t;this._initJimuLayerInfos();this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this._getAttributeTable();this._mapLoaded();setTimeout(G.hitch(this,function(){this.isInitialLoad=!1}),500)}))},_togglePopupClass:function(t){if(this.map.infoWindow&&
this.map.infoWindow.domNode&&this.saveEnabled){var B=n(".contentPane",this.map.infoWindow.domNode)[0];B&&(t?d.add:d.remove)(B,"jimu-widget-SAT-ai")}},updateTabs:function(){if(this.config&&this.config.tabs&&this.config.tabs.length)for(var t=this.config.tabs,B=0;B<t.length;B++){var M=t[B];M.type&&"weather"===M.type&&t.splice(B,1)}},onOpen:function(){this.inherited(arguments);this.widgetActive=!0;this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.setPosition();this.windowResize=m(window,
"resize",G.hitch(this,this._resize));null===this.mapResize&&(this.mapResize=this.map.on("resize",G.hitch(this,this._mapResize)));this._mapResize();this.own(y.subscribe("changeMapPosition",G.hitch(this,this._onMapPositionChange)));(this.disableVisibilityManagement="undefined"!==typeof this.config.disableVisibilityManagement?this.config.disableVisibilityManagement:!1)||this._storeInitalVisibility();this._checkHideContainer();this._initEditInfo();this._clickTab(0);this._updateCounts(!0);this._restoreIncidents();
!this.isInitialLoad&&z.isAutoFocusFirstNodeWidget(this)&&z.focusFirstFocusNode(this.domNode)},_checkHideContainer:function(){this.hideContainer=!1;var t=this.map.infoWindow;t.popupInfoView&&t.popupInfoView.container&&(this.hideContainer=!0,this.own(m(t,"show",G.hitch(this,this._handlePopup))))},onClose:function(){this._storeIncidents();this._toggleTabLayersOld();this._resetInfoWindow(!0);this.mapResize&&(this.mapResize.remove(),this.mapResize=null);this.windowResize&&(this.windowResize.remove(),this.windowResize=
null);this._clear(!0);this.widgetActive=!1;this.saveEnabled&&(this.scSignal.remove(),this.sfSignal.remove());this._mapResize();this.disableVisibilityManagement||this._resetInitalVisibility();this.inherited(arguments);this._resetMapPosition();this._togglePopupClass(!1)},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear(!0);this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&
this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.removeLayer(this.lyrProximity);this.lyrSummary&&this.map.removeLayer(this.lyrSummary);this.lyrGroupedSummary&&this.map.removeLayer(this.lyrGroupedSummary);this.inherited(arguments)},onAppConfigChanged:function(t,B){switch(B){case "themeChange":case "layoutChange":case "styleChange":this._updateUI(t);break;case "widgetPoolChange":this._verifyRouting();break;case "mapChange":window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);break;case "attributeChange":this._updateUI(t)}},_handlePopup:function(){this._clearMobileSetAsIncidentStyle();var t=q.byId("main-page");if(this.map.infoWindow.popupInfoView){var B=this.map.infoWindow.popupInfoView.container;var M=".mainSection { overflow-y: auto; height: "+(t.clientHeight-60).toString()+"px; }";var U=".atiAttributes {overflow: auto; height: "+(t.clientHeight-130).toString()+"px; }"}else B=n("div.atiAttributes",this.map.infoWindow.domNode)[0],M=".mainSection { overflow-y: none; }",
U=".atiAttributes {overflow: none; }";t.clientHeight&&B&&(t=document.createElement("style"),t.type="text/css",t.id="_tempMainSectionOverride",B.appendChild(t),t.sheet.insertRule(M,0),t.sheet.insertRule(U,1))},_updateUI:function(t){this._getStyleColor(t)},_updateFontColor:function(t){"undefined"===typeof t&&(t=this.appConfig);t=g.create("div",{id:"tempTitle",innerHTML:t.title}).getElementsByTagName("font");this.config.fontColor=t&&0<t.length?/^#[0-9A-F]{6}$/i.test(t[0].color)?t[0].color:"#ffffff":
"#ffffff";g.destroy("tempTitle");t=document.querySelectorAll(".panelBottom ");for(var B=0;B<t.length;B++)t[B].style.color=this.config.fontColor},_updateButtonBackgrounds:function(t,B){D.forEach(this.imgContainer.children,function(U){d.contains(U.children[0],t?"btn32img":"btn32imgBlack")&&d.remove(U.children[0],t?"btn32img":"btn32imgBlack");d.add(U.children[0],t?"btn32imgBlack":"btn32img");d.contains(U.children[0],B?"darkThemeBackground":"lightThemeBackground")&&d.remove(U.children[0],B?"darkThemeBackground":
"lightThemeBackground");d.add(U.children[0],B?"lightThemeBackground":"darkThemeBackground")});var M=this.allEnabled;D.forEach(this.saveOptions.children,function(U){M?D.forEach(U.children,function(aa){d.contains(aa.children[0],t?"btn32img":"btn32imgBlack")&&d.remove(aa.children[0],t?"btn32img":"btn32imgBlack");d.add(aa.children[0],t?"btn32imgBlack":"btn32img");d.contains(aa.children[0],B?"darkThemeBackground":"lightThemeBackground")&&d.remove(aa.children[0],B?"darkThemeBackground":"lightThemeBackground");
d.add(aa.children[0],B?"lightThemeBackground":"darkThemeBackground")}):(d.contains(U.children[0],t?"btn32img":"btn32imgBlack")&&d.remove(U.children[0],t?"btn32img":"btn32imgBlack"),d.add(U.children[0],t?"btn32imgBlack":"btn32img"),d.contains(U.children[0],B?"darkThemeBackground":"lightThemeBackground")&&d.remove(U.children[0],B?"darkThemeBackground":"lightThemeBackground"),d.add(U.children[0],B?"lightThemeBackground":"darkThemeBackground"))})},_getStyleColor:function(t){this._updateFontColor(t);setTimeout(G.hitch(this,
function(){if(this.footerNode){var B=window.getComputedStyle(this.footerNode,null).getPropertyValue("background-color");this.config.activeMapGraphicColor=B;B=c.fromRgb(B);this.lightTheme=210>.2126*B.r+.7152*B.g+.0722*B.b?!1:!0;this.config.color=B.toHex();this.isBlackTheme="#000000"===this.config.color?!0:!1;this._updateButtonBackgrounds(this.isBlackTheme,this.lightTheme);this.updateActiveNodes(this.lightTheme,!0);this.updateActiveNodes(this.lightTheme,!1);this.isBlackTheme?(d.remove(this.tabNodes[this.curTab],
"active"),d.add(this.tabNodes[this.curTab],"activeBlack"),this.config.activeColor="rgb(53, 53, 53)"):(d.remove(this.tabNodes[this.curTab],"activeBlack"),d.add(this.tabNodes[this.curTab],"active"),this.config.activeColor="rgba(39, 39, 39, 0.3)");this._setupSymbols();this.dataValue?this._drawIncident(this.dataValue,void 0,void 0,!0).then(G.hitch(this,function(){this.dataValue=void 0})):this._bufferIncident()}}),300)},updateActiveNodes:function(t,B){if(B){B=[".SATcolLocate",".SATcol",".SATcolRec",".borderCol",
".SATcolSmall"];var M="lightThemeBorder";var U="darkThemeBorder"}else B=".btn32img .innerBL .innerBR .SA_panelClose .SA_panelRight .SA_panelLeft".split(" "),M="lightThemeBackground",U="darkThemeBackground";D.forEach(B,function(aa){aa=n(aa);for(var Z=0;Z<aa.length;Z++){var da=aa[Z];d.remove(da,t?U:M);d.add(da,t?M:U)}})},setPosition:function(t,B){this.widgetActive&&(B=window.jimuConfig.layoutId,"TabTheme"===this.appConfig.theme.name?this.position={left:this.widgetManager.getControllerWidgets()[0].domNode.clientWidth,
right:0,bottom:24,height:155,relativeTo:"browser"}:"DashboardTheme"===this.appConfig.theme.name?(this.position={left:0,right:0,bottom:0,height:155},B=this.map.id):this.position={left:0,right:0,bottom:0,height:155,relativeTo:"browser"},t=z.getPositionStyle(this.position),t.position="absolute",b.place(this.domNode,B),b.setStyle(this.domNode,t),this.started&&this.resize(),y.publish("changeMapPosition",{bottom:155}))},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&
this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(t){var B=t.feature?t.feature:this.map.infoWindow.getSelectedFeature();if(t&&"add"===t.type)B={eventType:"IncidentLocationAdd",dataValue:B},this.incidents=[],this.buffers=[],this.lyrIncidents.clear(),this.lyrBuffer.clear();else{for(var M=!0,U,aa=0;aa<this.lyrIncidents.graphics.length;aa++){var Z=this.lyrIncidents.graphics[aa];if(Z.geometry.type===B.geometry.type){var da=!v.equals(Z.geometry,B.geometry);Z.attributes&&B.attributes&&!da&&(da=
da&&f.stringify(Z.attributes)===f.stringify(B.attributes));M=M&&da;da||(U=Z)}}B={eventType:M?"IncidentLocationAdd":"IncidentLocationRemove",dataValue:B,removeGraphic:U}}this.onReceiveData("","",B);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();t&&(t=this.map.infoWindow,t.popupNavigationBar&&(B=n(".esriMobileNavigationBar",t.popupNavigationBar.domNode),0<B.length&&b.setStyle(B[0],"display","none")),t.popupInfoView&&(B=n(".esriMobileInfoView",t.popupInfoView.domNode),0<B.length&&b.setStyle(B[0],
"display","none")));d.remove(this.panelContainer,"loading")},_initLayers:function(){this.gsvc=new ja(this.config.geometryService&&this.config.geometryService.url?this.config.geometryService.url:this.appConfig.geometryService);this.locator=new oa(this.config.geocodeService.url);this.own(m(this.locator,"location-to-address-complete",G.hitch(this,this._showIncidentAddress)));this.own(m(this.locator,"error",G.hitch(this,this._onAddressError)));this.lyrIncidents=new ea;this.map.addLayer(this.lyrIncidents);
this.lyrClosest=new ea;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new ea;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity);this.summaryDisplayEnabled&&(this.lyrSummary=new ea,this.lyrSummary.setVisibility(!1),this.map.addLayer(this.lyrSummary),this.lyrGroupedSummary=new ea,this.lyrGroupedSummary.setVisibility(!1),this.map.addLayer(this.lyrGroupedSummary));this.lyrBuffer=new ea;this.map.addLayer(this.lyrBuffer)},_mapLoaded:function(){n("[data-reference]").style("z-index",
0);this._processOperationalLayers();this.saveEnabled&&this._initEdit();var t=this.map.itemInfo.itemData.baseMap.baseMapLayers[0];"ArcGISTiledMapServiceLayer"===t.layerType&&t.resourceInfo.singleFusedMapCache||(this.config.defaultZoomLevel=.5);this._clickTab(0)},_initEdit:function(){var t=this.map.infoWindow;this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0,this.config.polyEditLayer=
this.config.editLayer,this.polyTemplate=this.config.editTemplate,this.honorTemplate=!0);this.config.savePoints&&this._initEditLayer(this.config.pointEditLayer,"point");this.config.saveLines&&this._initEditLayer(this.config.lineEditLayer,"line");this.config.savePolys&&this._initEditLayer(this.config.polyEditLayer,"poly");this.scSignal=m(t,"selection-change",G.hitch(this,this._selectionChanged));this.sfSignal=m(t,"set-features",G.hitch(this,this._setPopupFeature));var B=n(".esriPopupWrapper",t.domNode);
0<B.length&&"undefined"!==typeof B[0].clientHeight&&"undefined"!==typeof B[0].clientWidth&&(this.defaultPopupSize={width:B[0].clientWidth});t.highlight=!0},_getLayerIDs:function(){var t=[];D.forEach(this.opLayers._layerInfos,G.hitch(this,function(B){0<B.newSubLayers.length?this._recurseLayersIDs(B.newSubLayers,t):t.push({id:B.id,title:B.title})}));return t},_recurseLayersIDs:function(t,B){D.forEach(t,G.hitch(this,function(M){0<M.newSubLayers.length?this._recurseLayersIDs(M.newSubLayers,B):B.push({id:M.id,
title:M.title})}))},_initJimuLayerInfos:function(){if(this.config&&this.config.tabs&&this.config.tabs.length){for(var t=this.config.tabs,B=[],M=this._getLayerIDs(),U=t.length-1;0<=U;U--){var aa=t[U],Z=aa.layerTitle?aa.layerTitle:aa.layers;if(aa.layers&&(aa.jimuLayerInfo=this.opLayers.getLayerInfoById(aa.layers),!aa.jimuLayerInfo)){if(M&&M.hasOwnProperty("length")&&0<M.length){var da=0;a:for(;da<M.length;da++){var la=M[da];if(la&&la.hasOwnProperty("title")&&la.title===Z){aa.jimuLayerInfo=this.opLayers.getLayerInfoById(la.id);
break a}}}aa.jimuLayerInfo||(this.config.tabs.splice(U,1),B.push(Z))}}if(0<B.length){var ma="";D.forEach(B,G.hitch(this,function(ka){ma+=Da.substitute({name:ka},this.nls.missingLayer)+"\x3c/br\x3e\x3c/br\x3e"}));t=g.create("div",{style:"max-height:500px;overflow:auto;"});g.create("div",{className:"SAT-warning-hint",innerHTML:this.nls.missingLayerHint},t);g.create("div",{innerHTML:ma.substr(0,ma.lastIndexOf("\x3c/br\x3e\x3c/br\x3e")),style:"padding-"+(window.isRTL?"right":"left")+": 10px;"},t);new L({titleLabel:"\x3cdiv class\x3d'SAT-warning-icon' style\x3d'float: "+
(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;'\x3e\x3c/div\x3e"+this.nls.layerNotAvalible,message:t,maxWidth:350})}}},_initEditLayer:function(t,B){if("point"===B){this.pointEditLayer=this.opLayers.getLayerInfoById(t).layerObject;this.isPointEditable=this._isEditable(this.pointEditLayer);var M=this.pointEditLayer;M.templates&&0<M.templates.length?this.pointTemplate=M.templates[0]:M.types&&0<M.types.length&&(this.pointTemplate=M.types[0].templates[0]);this.pointTemplate&&(this.pointEditLayerPrototype=
this.pointTemplate.prototype)}else"line"===B?(this.lineEditLayer=this.opLayers.getLayerInfoById(t).layerObject,this.isLineEditable=this._isEditable(this.lineEditLayer),M=this.lineEditLayer,M.templates&&0<M.templates.length?this.lineTemplate=M.templates[0]:M.types&&0<M.types.length&&(this.lineTemplate=M.types[0].templates[0]),this.lineTemplate&&(this.lineEditLayerPrototype=this.lineTemplate.prototype)):"poly"===B&&(this.polyEditLayer=this.opLayers.getLayerInfoById(t).layerObject,this.isPolyEditable=
this._isEditable(this.polyEditLayer),M=this.polyEditLayer,this.honorTemplate||(M.templates&&0<M.templates.length?this.polyTemplate=M.templates[0]:M.types&&0<M.types.length&&(this.polyTemplate=M.types[0].templates[0])),this.polyTemplate&&(this.polyEditLayerPrototype=this.polyTemplate.prototype));M&&this.own(m(M,"click",G.hitch(this,function(U){if(U.graphic)switch(U=U.graphic,U.geometry.type){case "point":this.pointUpdateFeature=U;break;case "polyline":this.lineUpdateFeature=U;break;case "polygon":this.polyUpdateFeature=
U}})))},_isEditable:function(t){var B=!1;t.isEditable()&&t.getEditCapabilities&&(B=t.getEditCapabilities());return B&&B.canUpdate&&B.canCreate},_initEditInfo:function(){if(this.saveEnabled){var t=!1;this.polyEditLayer&&this.isPolyEditable&&(t=!0,this.defaultPolyContent=this.polyEditLayer.infoTemplate?this.polyEditLayer.infoTemplate.content:void 0,this.polyEditLayer.infoTemplate.setContent(G.hitch(this,this._setEditLayerPopup)));this.lineEditLayer&&this.isLineEditable&&(t=!0,this.defaultLineContent=
this.lineEditLayer.infoTemplate?this.lineEditLayer.infoTemplate.content:void 0,this.lineEditLayer.infoTemplate.setContent(G.hitch(this,this._setEditLayerPopup)));this.pointEditLayer&&this.isPointEditable&&(t=!0,this.defaultPointContent=this.pointEditLayer.infoTemplate?this.pointEditLayer.infoTemplate.content:void 0,this.pointEditLayer.infoTemplate.setContent(G.hitch(this,this._setEditLayerPopup)));t&&this.map.infoWindow.resize(350,340)}},_setPopupFeature:function(){if(0<this.map.infoWindow.count){var t=
this.map.infoWindow.getSelectedFeature();switch(t.geometry.type){case "point":this.pointUpdateFeature=t;break;case "polyline":this.lineUpdateFeature=t;break;case "poly":this.polyUpdateFeature=t}}},_selectionChanged:function(){if(0<this.map.infoWindow.count){var t=this.map.infoWindow.getSelectedFeature();switch(t.geometry.type){case "point":this.pointUpdateFeature=t;break;case "polyline":this.lineUpdateFeature=t;break;case "poly":this.polyUpdateFeature=t}}},_setEditLayerPopup:function(t){if("polygon"===
t.geometry.type)var B=this.polyEditLayer;"polyline"===t.geometry.type&&(B=this.lineEditLayer);"point"===t.geometry.type&&(B=this.pointEditLayer);for(var M=[],U=this._getPopupFields(B),aa=0;aa<U.length;aa++){var Z=U[aa];Z.hasOwnProperty("isEditableOnLayer")||(Z.isEditableOnLayer=Z.isEditable);Z.isEditable&&Z.isEditableOnLayer&&(Z.hasOwnProperty("format")&&-1===[null,void 0,""].indexOf(Z.format)&&Z.format.hasOwnProperty("dateFormat")&&0<=Z.format.dateFormat.toString().toUpperCase().indexOf("TIME")?
(Z.format.time=!0,M.push({fieldName:Z.fieldName,isEditable:Z.isEditable,format:Z.format})):M.push({fieldName:Z.fieldName,isEditable:Z.isEditable}))}this.attInspector=new ua({layerInfos:[{featureLayer:B,showAttachments:!1,isEditable:!0,fieldInfos:M}]},g.create("div"));M=new Q({label:this.nls.update_btn,"class":"atiButton"},g.create("div"));g.place(M.domNode,this.attInspector.deleteBtn.domNode.parentNode);this._togglePopupClass(!0);z.isMobileUa()&&(U=n(".esriMobileInfoViewItem .esriAttributeInspector .atiDeleteButton"))&&
0<U.length&&d.add(this.attInspector.deleteBtn.domNode,"esriCTAIDeleteButtonWidth");this.own(m(M,"click",G.hitch(this,function(){B.applyEdits(null,[t],null,G.hitch(this,function(){this.map.infoWindow.hide();setTimeout(G.hitch(this,function(){this.saveButton.focus()}),100)}),function(da){var la="Error";"undefined"!==typeof da.details&&(la=da.details);"undefined"!==typeof da.message&&(la=da.message);new L({message:la})})})));this.own(m(this.attInspector,"attribute-change",G.hitch(this,function(da){switch(da.feature.geometry.type){case "point":this.pointUpdateFeature=
da.feature;this.pointUpdateFeature.attributes[da.fieldName]=da.fieldValue;break;case "polyline":this.lineUpdateFeature=da.feature;this.lineUpdateFeature.attributes[da.fieldName]=da.fieldValue;break;case "polygon":this.polyUpdateFeature=da.feature,this.polyUpdateFeature.attributes[da.fieldName]=da.fieldValue}})));this.own(m(this.attInspector,"next",G.hitch(this,function(da){switch(da.feature.geometry.type){case "point":this.pointUpdateFeature=da.feature;break;case "polyline":this.pointUpdateFeature=
da.feature;break;case "poly":this.pointUpdateFeature=da.feature}})));this.own(m(this.attInspector,"delete",G.hitch(this,function(da){var la=!1;if(0<this.incidents.length){for(var ma=0;ma<this.incidents.length;ma++)v.equals(da.feature.geometry,this.incidents[ma].geometry)&&(la=!0);if(!la&&0<this.lyrBuffer.graphics.length)for(ma=0;ma<length;ma++)v.equals(da.feature.geometry,this.lyrBuffer.graphics[ma].geometry)&&(la=!0)}B.applyEdits(null,null,[da.feature],function(){},function(ka){var ra="Error";"undefined"!==
typeof ka.details&&(ra=ka.details);"undefined"!==typeof ka.message&&(ra=ka.message);new L({message:ra})});this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);la&&this._clear(!1);this.map.infoWindow.hide();setTimeout(G.hitch(this,function(){z.focusFirstFocusNode(this.domNode)}),100)})));switch(t.geometry.type){case "point":this.pointUpdateFeature=
t;break;case "polyline":this.lineUpdateFeature=t;break;case "polygon":this.polyUpdateFeature=t}this.attInspector.showFeature(t);return this.attInspector.domNode},_getPopupFields:function(t){if(t.infoTemplate)var B=t.infoTemplate.info.fieldInfos;else if("undefined"!==typeof t.popupInfo||null!==t.popupInfo)B=t.popupInfo.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var M=this.tab.tabLayers[0].url.split("MapServer/")[1],U=this.parent.map.itemInfo.itemData.operationalLayers;B=
null;for(var aa=0;aa<U.length;aa++){var Z=U[aa];if(Z.layerObject.infoTemplates&&(Z=Z.layerObject.infoTemplates[M])){B=Z.infoTemplate.info.fieldInfos;break}}}else B=t.fields;B||(B=t.fields);return B},_updatePopup:function(t,B,M){B=[];for(M=0;M<t.length;M++){var U=t[M],aa=new Fa;aa.objectIds=[U.oid];B.push(U.layer.selectFeatures(aa,fa.SELECTION_NEW))}(new N(B)).then(G.hitch(this,function(Z){for(var da=[],la=0;la<Z.length;la++){var ma=Z[la];if(ma[0]){ma=ma[1][0];da.push(ma);switch(ma.geometry.type){case "point":this.pointUpdateFeature=
ma;break;case "polyline":this.lineUpdateFeature=ma;break;case "poly":this.polyUpdateFeature=ma}this.attInspector||this._setEditLayerPopup(ma);this.attInspector&&this.attInspector.showFeature(ma)}}}))},_processOperationalLayers:function(){for(var t=0;t<this.config.tabs.length;t++){var B=this.config.tabs[t];B.layers&&""!==B.layers&&(this.hasLayerTitle="undefined"!==typeof B.layerTitle,B.tabLayers=this._getTabLayers(B.layers))}},_goToNextTab:function(t,B){if(t.keyCode===qa.LEFT_ARROW||t.shiftKey&&t.keyCode===
qa.TAB)B=0===B?this.tabNodes.length-1:B-1;else if(t.keyCode===qa.RIGHT_ARROW||t.keyCode===qa.TAB)B=B===this.tabNodes.length-1?0:B+1;else return;var M=n("div[tabNum\x3d"+B+"]",this.domNode)[0];d.contains(M,"noFeaturesActive")&&(M=this._goToNextTab(t,B));return M},_createUI:function(){var t=z.stripHTML(this.config.bufferLabel?this.config.bufferLabel:"");this.buffer_lbl.innerHTML=t;this.buffer_lbl_unit.innerHTML=this.nls[this.config.distanceUnits];this.spinnerValue.isRenderIdForAttrs=!0;this.spinnerValue.constraints=
{min:this.SLIDER_MIN_VALUE,max:this.SLIDER_MAX_VALUE};this.spinnerValue.intermediateChanges=!0;t=Da.substitute({min:this.SLIDER_MIN_VALUE_DISPLAY,max:this.SLIDER_MAX_VALUE_DISPLAY},this.nls.buffer_invalid);this.spinnerValue.invalidMessage=t;this.spinnerValue.rangeMessage=t;this.spinnerValue.set("value",this.SLIDER_DEFAULT_VALUE);this.locateIncident.innerHTML="undefined"!==typeof this.config.locateIncidentLabel?this.config.locateIncidentLabel:this.nls.locate_incident;this.config.tabs.splice(0,0,{type:"incidents",
label:"undefined"!==typeof this.config.incidentLabel?this.config.incidentLabel:this.nls.incident,color:this.config.color});this.panelNodes.push(this.SA_tabPanel0);var B=this.panelContainer;t=this.tabsNode;for(var M=0,U=0;U<this.config.tabs.length;U++){var aa=this.config.tabs[U],Z=aa.label;Z&&""!==Z||(Z=aa.layerTitle?aa.layerTitle:aa.layers);Z=g.create("div",{"data-dojo-attach-point":"SA_tab"+U,tabindex:"0",tabNum:U,role:"tab","aria-label":z.stripHTML(Z?Z:""),"aria-selected":"false",innerHTML:z.stripHTML(Z?
Z:"")},t);this.tabNodes.push(Z);d.add(Z,"SATTab");M+=F.position(Z).w;m(Z,"click",G.hitch(this,this._clickTab,U));m(Z,"keydown",G.hitch(this,function(da){var la=parseInt(E.get(da.currentTarget,"tabNum"),10);da.keyCode===qa.TAB?(da.preventDefault(),da=this._goToNextTab(da,la),da.focus()):da.keyCode===qa.LEFT_ARROW||da.keyCode===qa.RIGHT_ARROW?(da=this._goToNextTab(da,la),da.focus()):da.keyCode===qa.ENTER||da.keyCode===qa.SPACE?(this._clickTab(parseInt(E.get(da.currentTarget,"tabNum"),10)),"0"===E.get(da.currentTarget,
"tabNum")&&setTimeout(G.hitch(this,function(){this.clearIncident.focus()}),100)):da.keyCode===qa.ESCAPE&&(this.closeButton.focus(),da.stopPropagation())}));0<U&&(Z=g.create("div",{"data-dojo-attach-point":"SA_tabPanel"+U,role:"tabpanel",innerHTML:""},B),this.panelNodes.push(Z),m(this.panelNodes[U],"keydown",G.hitch(this,function(da){da.keyCode===qa.ESCAPE&&(D.forEach(this.tabNodes,G.hitch(this,function(la){d.contains(la,"active")&&la.focus()})),da.stopPropagation(),da.cancelBubble=!0)})),d.add(Z,
"SAT_tabPanel"),"summary"===aa.type&&(aa.summaryInfo=new Ha(aa,Z,this),this.own(m(aa.summaryInfo,"summary-complete",G.hitch(this,this.restore)))),"groupedSummary"===aa.type&&(aa.groupedSummaryInfo=new Ia(aa,Z,this),this.own(m(aa.groupedSummaryInfo,"summary-complete",G.hitch(this,this.restore)))),"closest"===aa.type&&(aa.closestInfo=new Ja(aa,Z,this)),"proximity"===aa.type&&(aa.proximityInfo=new Ka(aa,Z,this)))}M+=10;e.set(t,"width",M+"px");M>F.position(this.footerNode).w&&(B=this.footerContentNode,
window.isRTL?(e.set(B,"left","58px"),e.set(this.panelLeft,"display","block"),e.set(this.panelRight,"display","none")):(e.set(B,"right","58px"),e.set(this.panelRight,"display","block")));m(t,"scroll",G.hitch(this,this._onPanelScroll));this.own(m(this.clearIncident,"keydown",G.hitch(this,function(da){if(da.keyCode===qa.ENTER||da.keyCode===qa.SPACE)this._clear(),this.SA_btn0.focus(),this._getLastNodeForEachTab(0)})))},restore:function(t){t.tab===this.curTab&&this._clickTab(t.tab)},validateSavePrivileges:function(){var t=
new C;w.getPortal(this.appConfig.portalUrl).getUser().then(G.hitch(this,function(B){B&&B.privileges?t.resolve(-1<B.privileges.indexOf("features:user:edit")?!0:!1):t.resolve(!0)}),G.hitch(this,function(B){console.log(B);t.resolve(!0)}));return t},validateSnapshotPrivileges:function(){var t=new C;w.getPortal(this.appConfig.portalUrl).getUser().then(G.hitch(this,function(B){B&&B.privileges?t.resolve(-1<B.privileges.indexOf("portal:publisher:publishFeatures")&&-1<B.privileges.indexOf("portal:user:createItem")?
!0:!1):t.resolve(!1)}),G.hitch(this,function(B){console.log(B);t.resolve(!1)}));return t},_loadUI:function(){var t=this.allEnabled?g.create("div",{"class":"displayT pad-top-5"},this.saveOptions):this.saveOptions,B=this.allEnabled?g.create("div",{"class":"displayT pad-top-10"},this.saveOptions):this.saveOptions,M=this.allEnabled?"displayTC":"displayTR";this.reportEnabled&&(this.createReportButtonSpan=g.create("span",{"class":"btn32 "+M},t),this.createReportButton=g.create("div",{"class":"btn32img",
title:this.nls.createReport,"aria-label":this.nls.createReport,tabindex:"0",role:"button"},this.createReportButtonSpan),e.set(this.createReportButton,"backgroundImage","url("+this.reportSrc+")"),this.own(m(this.createReportButton,"click",G.hitch(this,this._createReport))),this.own(m(this.createReportButton,"keydown",G.hitch(this,function(U){U.keyCode!==qa.ENTER&&U.keyCode!==qa.SPACE||this._createReport()}))));this.saveEnabled&&(this.saveButtonSpan=g.create("span",{"class":"btn32 "+M},t),this.validateSavePrivileges().then(G.hitch(this,
function(U){this.userCanSave=U;this.saveButton=g.create("div",{"class":U?"btn32img":"btn32img btnDisabled",title:U?this.nls.saveIncident:this.nls.user_credentials,"aria-label":U?this.nls.saveIncident:this.nls.user_credentials,tabindex:"0",role:"button"},this.saveButtonSpan);e.set(this.saveButton,"backgroundImage","url("+this.saveSrc+")");U&&(this.own(m(this.saveButton,"click",G.hitch(this,this._saveIncident))),this.own(m(this.saveButton,"keydown",G.hitch(this,function(aa){aa.keyCode!==qa.ENTER&&aa.keyCode!==
qa.SPACE||this._saveIncident()}))))}),function(U){console.log(U)}));t=g.create("span",{"class":"btn32 "+M},B);this.downloadAllButon=g.create("div",{"class":"btn32img",title:this.nls.downloadAll,"aria-label":this.nls.downloadAll,tabindex:"0",role:"button"},t);e.set(this.downloadAllButon,"backgroundImage","url("+this.downloadAllSrc+")");this.own(m(this.downloadAllButon,"click",G.hitch(this,this._downloadAll)));this.own(m(this.downloadAllButon,"keydown",G.hitch(this,function(U){U.keyCode!==qa.ENTER&&
U.keyCode!==qa.SPACE||this._downloadAll()})));this.snapshotEnabled&&(this.createSnapshotButtonSpan=g.create("span",{"class":"btn32 "+M},B),this.validateSnapshotPrivileges().then(G.hitch(this,function(U){this.userCanSnapshot=U;this.createSnapshotButton=g.create("div",{"class":U?"btn32img":"btn32img btnDisabled",title:U?this.nls.createSnapshot:this.nls.user_credentials,"aria-label":U?this.nls.createSnapshot:this.nls.user_credentials,tabindex:"0",role:"button"},this.createSnapshotButtonSpan);e.set(this.createSnapshotButton,
"backgroundImage","url("+this.snapshotSrc+")");U&&(this.own(m(this.createSnapshotButton,"click",G.hitch(this,this._createSnapshot))),this.own(m(this.createSnapshotButton,"keydown",G.hitch(this,function(aa){aa.keyCode!==qa.ENTER&&aa.keyCode!==qa.SPACE||this._createSnapshot()}))))}),function(U){console.log(U)}));B={0:this.nls.drawPoint,1:this.nls.drawLine,2:this.nls.drawPolygon};this.btnNodes=[this.SA_btn0,this.SA_btn1,this.SA_btn2];for(M=0;3>M;M++)t=this.btnNodes[M],e.set(t,"backgroundImage","url("+
this.folderUrl+"images/btn"+M+".png)"),b.setAttr(t,"title",B[M]),b.setAttr(t,"aria-label",B[M]),b.setAttr(t,"toolNum",M),b.setAttr(t,"aria-pressed","false"),this.own(m(t,"click",G.hitch(this,this._clickIncidentsButton,M))),this.own(m(t,"keydown",G.hitch(this,function(U){U.keyCode!==qa.ENTER&&U.keyCode!==qa.SPACE||this._clickIncidentsButton(parseInt(E.get(U.currentTarget,"toolNum"),10))})));this.toolbar=new sa(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-complete",G.hitch(this,this._drawIncident));
this.own(m(this.spinnerValue,"change",G.hitch(this,function(){this._updateSpinnerValue(!1)})));this.own(m(this.spinnerValue,"blur",G.hitch(this,function(){this._updateSpinnerValue(!0)})));this.own(m(this.spinnerValue,"keyup",G.hitch(this,function(U){U.keyCode===qa.ENTER?this._updateSpinnerValue(!0):this._updateSpinnerValue(!1)})))},_locateBuffer:function(t){if(null!==t&&(t="extent"===t.type?t:t.getExtent(),null!==t)){t=t.expand(1.5);var B=80/this.map.height,M=t.getHeight();t.update(t.xmin,t.ymin-
M*B,t.xmax,t.ymax-M*B,this.map.spatialReference);this.map.setExtent(t,!0)}},_clickIncidentsButton:function(t){if(3>t){for(var B=0;3>B;B++){var M=this.btnNodes[B];d.remove(M,"btnOn");b.setAttr(M,"aria-pressed","false")}-1<t&&t!==this.tool?(M=this.btnNodes[t],3>t&&(d.add(M,"btnOn"),b.setAttr(M,"aria-pressed","true")),this.tool=t):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear(!1);this.toolbar.activate(sa.POINT);this.disableWebMapPopup();
break;case 1:this._clear(!1);this.toolbar.activate(sa.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(!1),this.toolbar.activate(sa.POLYGON),this.disableWebMapPopup()}}else this._clear(!0)},_saveIncident:function(){this.map.infoWindow.hide();this._updateProcessing(this.saveButton,!0,this.saveSrc);var t=[];this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0);
if(this.config.savePolys){var B=this._getIncidentGraphics("polygon",this.polyEditLayerPrototype);0<B.length&&t.push({layer:this.polyEditLayer,graphics:B})}this.config.saveLines&&(B=this._getIncidentGraphics("polyline",this.lineEditLayerPrototype),0<B.length&&t.push({layer:this.lineEditLayer,graphics:B}));this.config.savePoints&&(B=this._getIncidentGraphics("point",this.pointEditLayerPrototype),0<B.length&&t.push({layer:this.pointEditLayer,graphics:B}));0<t.length?this._applyEdits(t):this._updateProcessing(this.saveButton,
!1,this.saveSrc);this._clickIncidentsButton(-1)},_getIncidentGraphics:function(t,B){var M=[];B=f.parse(f.stringify(B));if("polygon"===t)for(var U=0;U<this.lyrBuffer.graphics.length;U++){var aa=this.lyrBuffer.graphics[U],Z=new O;Z.geometry=aa.geometry;Z.setAttributes(B.attributes);M.push(Z)}for(U=0;U<this.incidents.length;U++)aa=this.incidents[U],aa.geometry.type===t&&(Z=new O,Z.geometry=aa.geometry,Z.setAttributes(B.attributes),M.push(Z));return M},_applyEdits:function(t){for(var B=new C,M=[],U=[],
aa=0;aa<t.length;aa++){var Z=t[aa];Z.layer.visible||Z.layer.setVisibility(!0);var da=[];if(1<Z.graphics.length&&"polygon"===Z.graphics[0].geometry.type){var la=Z.graphics[0],ma=Z.graphics.map(function(ka){return ka.geometry});if(ma=v.union(ma))la.geometry=ma,da.push(la)}M.push(Z.layer.applyEdits(0<da.length?da:Z.graphics,null,null))}(new N(M)).then(G.hitch(this,function(ka){for(var ra=!1,va="",xa=0;xa<ka.length;xa++)va=ka[xa][1][0],va.success?(ra=!0,va.hasOwnProperty("objectId")&&U.push({oid:va.objectId,
layer:t[xa].layer})):(va=ka[xa][1][0].error.message,new L({title:this.nls.saveIncident,message:this.nls.saveIncidentErrorMessage+va}));this._smartEdit();if(!this.map.infoWindow.isShowing){ka=this.incidents[0].geometry;switch(ka.type){case "point":var ta=ka;break;case "polyline":ta=ka.paths[0][parseInt(ka.paths[0].length/2,10)];ta=new H(ta[0],ta[1],ka.spatialReference);break;case "polygon":ta=ka.getCentroid()}ka=this.map.toScreen(ta);0<U.length&&this._updatePopup(U,ta,ka);this._updateProcessing(this.saveButton,
!1,this.saveSrc);this.map.emit("click",{bubbles:!0,cancelable:!0,screenPoint:ka,mapPoint:ta})}B.resolve(ra)}),G.hitch(this,function(ka){console.error(ka);this._updateProcessing(this.saveButton,!1,this.saveSrc);new L({message:ka});B.reject(ka)}));return B},_smartEdit:function(){if(!this.smartEditor){var t=this.appConfig.getConfigElementsByName("SmartEditor");D.forEach(t,G.hitch(this,function(B){"SmartEditor"===B.name&&(this.smartEditor=this.widgetManager.getWidgetById(B.id))}))}this.smartEditor&&this.smartEditor.state&&
"opened"===this.smartEditor.state&&this.smartEditor._mapClickHandler(!0)},_clear:function(t){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.geomExtent=void 0;this.summaryDisplayEnabled&&this.lyrSummary&&this.lyrSummary.clear();this.summaryDisplayEnabled&&this.lyrGroupedSummary&&this.lyrGroupedSummary.clear();this.saveOptions&&(d.remove(this.saveOptions,"displayT"),d.add(this.saveOptions,"display-off"));this.borderCol&&
(d.remove(this.borderCol,"display-on"),d.add(this.borderCol,"display-off"));this.clearIncident&&(d.remove(this.clearIncident,"display-on"),d.add(this.clearIncident,"display-off"));this.smartEditor&&this.smartEditor._onCancelButtonClicked();this.incidents=[];this.buffers=[];this.div_reversed_address&&(this.div_reversed_address.innerHTML="");this.div_reverse_geocoding&&b.setStyle(this.div_reverse_geocoding,"display","none");this._updateCounts(!0);this._clearGraphics();t&&this.spinnerValue&&this.spinnerValue.set("value",
this.SLIDER_DEFAULT_VALUE);this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);this._clearMobileSetAsIncidentStyle()},_clearMobileSetAsIncidentStyle:function(){g.destroy(q.byId("_tempMainSectionOverride"))},_updateSpinnerValue:function(t){if(this.spinnerValue.validate()){var B=this.spinnerValue.displayedValue;"string"===typeof B&&
(B=z.parseNumber(B.toString()));B<this.SLIDER_MIN_VALUE?this.spinnerValue.set("value",this.SLIDER_MIN_VALUE):B>this.SLIDER_MAX_VALUE&&this.spinnerValue.set("value",this.SLIDER_MAX_VALUE);t&&this._bufferIncident()}},_clickTab:function(t){this._validateFeatureCount(t)&&(E.set(this.tabNodes[t],"aria-selected","true"),D.forEach(this.tabNodes,G.hitch(this,function(B,M){t!==M&&E.set(B,"aria-selected","false")})),this._toggleTabs(t),this._toggleTabLayers(t),this.curTab=t,this._clickIncidentsButton(-1),setTimeout(G.hitch(this,
function(){this._getLastNodeForEachTab(t)}),100))},_getLastNodeForEachTab:function(t){var B=this._getLastFocusNodeInDom(t);B&&(0===t&&(d.contains(this.clearIncident,"display-off")?z.initFirstFocusNode(this.domNode,this.SA_btn0):z.initFirstFocusNode(this.domNode,this.clearIncident)),z.initLastFocusNode(this.domNode,B.domNode?B.domNode:B))},_getLastFocusNodeInDom:function(t){if(0===t)return this._getLastFocusNodeInIncidentTab()},_getLastFocusNodeInIncidentTab:function(){if(!d.contains(this.saveOptions,
"display-off")){if(this.config.snapshotEnabled&&this.createSnapshotButton&&!d.contains(this.createSnapshotButton,"btnDisabled"))var t=this.createSnapshotButton;t||!this.downloadAllButon||d.contains(this.downloadAllButon,"btnDisabled")||(t=this.downloadAllButon);!t&&this.config.saveEnabled&&this.saveButton&&!d.contains(this.saveButton,"btnDisabled")&&(t=this.saveButton);!t&&this.config.reportEnabled&&this.createReportButton&&!d.contains(this.createReportButton,"btnDisabled")&&(t=this.createReportButton)}!t&&
this.spinnerValue&&(t=this.spinnerValue);return t},_validateFeatureCount:function(t){var B=!0;t=this.config.tabs[t];switch(t.type){case "summary":B=0<t.summaryInfo.featureCount;break;case "groupedSummary":B=0<t.groupedSummaryInfo.featureCount;break;case "closest":B=0<t.closestInfo.featureCount;break;case "proximity":B=0<t.proximityInfo.featureCount}return B},_toggleTabs:function(t){for(var B=0;B<this.config.tabs.length;B++)B===t?(d.add(this.tabNodes[B],this.isBlackTheme?"activeBlack":"active"),e.set(this.panelNodes[B],
"display","block")):(d.remove(this.tabNodes[B],"active"),d.remove(this.tabNodes[B],"activeBlack"),e.set(this.panelNodes[B],"display","none"));this._scrollToTab(t)},_toggleTabLayers:function(t){this._toggleTabLayersOld();this._toggleTabLayersNew(t)},_toggleTabLayersOld:function(){var t=this.config.tabs[this.curTab];t&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.lyrSummary&&this.lyrSummary.setVisibility(!1),this.lyrGroupedSummary&&this.lyrGroupedSummary.setVisibility(!1),
this._setLayerVisible(t,!1))},_toggleTabLayersNew:function(t){var B=this.config.tabs[t];switch(B.type){case "summary":var M=!1;this.lyrSummary&&(this.currentSumLayer!==t&&(M=!0),this.lyrSummary.clear());B.tabLayers&&1<B.tabLayers.length&&(this.lyrSummary&&(this.lyrSummary.infoTemplate=B.tabLayers[1].infoTemplate,D.forEach(B.tabLayers[1].graphics,G.hitch(this,function(U){this.lyrSummary.add(U)})),B.tabLayers[0]&&B.tabLayers[0].hasOwnProperty("opacity")&&this.lyrSummary.setOpacity(B.tabLayers[0].opacity),
this.lyrSummary.setVisibility(!0)),M&&(this.currentSumLayer=t,this._toggleTabLayersNew(t)));0<this.incidents.length&&!0===B.updateFlag?(B.summaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrSummary:null,t),this.currentSumLayer=t):(t=n(".summaryDownLoadCSVButton",this.domNode))&&0<t.length&&(t[0].focus(),z.initFirstFocusNode(this.domNode,t[0]),z.initLastFocusNode(this.domNode,t[0]));break;case "groupedSummary":this.lyrGroupedSummary&&(this.currentSumLayer!==
t&&(M=!0),this.lyrGroupedSummary.clear());B.tabLayers&&1<B.tabLayers.length&&(this.lyrGroupedSummary&&(this.lyrGroupedSummary.infoTemplate=B.tabLayers[1].infoTemplate,D.forEach(B.tabLayers[1].graphics,G.hitch(this,function(U){this.lyrGroupedSummary.add(U)})),this.lyrGroupedSummary.setVisibility(!0)),M&&(this.currentSumLayer=t,this._toggleTabLayersNew(t)));0<this.incidents.length&&!0===B.updateFlag?(B.groupedSummaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrGroupedSummary:
null,t),this.currentGrpLayer=t):(t=n(".grpSummaryDownLoadCSVButton",this.domNode))&&0<t.length&&(t[0].focus(),z.initFirstFocusNode(this.domNode,t[0]),z.initLastFocusNode(this.domNode,t[0]));break;case "closest":this._setLayerVisible(B,!0);this.lyrClosest.setVisibility(!0);0<this.incidents.length&&(B.closestInfo&&B.closestInfo.container&&(B.closestInfo.container.innerHTML="",d.add(B.closestInfo.container,"loading")),!1===B.updateFlag&&this.lyrClosest.clear(),B.closestInfo.updateForIncident(this.incidents,
this.config.maxDistance,this.lyrClosest));break;case "proximity":this._setLayerVisible(B,!0),this.lyrProximity.setVisibility(!0),0<this.incidents.length&&(B.proximityInfo&&B.proximityInfo.container&&(B.proximityInfo.container.innerHTML="",d.add(B.proximityInfo.container,"loading")),!1===B.updateFlag&&this.lyrProximity.clear(),B.proximityInfo.updateForIncident(this.incidents,this.buffers,this.lyrProximity))}B.updateFlag=!1},_setLayerVisible:function(t,B){this.disableVisibilityManagement||t.tabLayers&&
D.forEach(t.tabLayers,function(M){"undefined"!==typeof M.visible&&M.setVisibility(B);t&&t.jimuLayerInfo&&t.jimuLayerInfo.setTopLayerVisible&&t.jimuLayerInfo.setTopLayerVisible(B)})},_drawIncident:function(t,B,M,U){var aa=new C;t=Array.isArray(t)?t:[t];for(var Z=!1,da=[],la=[],ma=[],ka=0;ka<t.length;ka++){var ra=t[ka],va=ra.geometry.type;null===this.symPoint&&this._getStyleColor();"point"===va&&(U=!0,this._getIncidentAddress(ra.geometry));Z="polyline"===va?this.isLineEditable:"polygon"===va?this.isPolyEditable:
this.isPointEditable;U?ma.push(ra.geometry):da.push(this._updateGeom(ra.geometry));la.push({symbol:"polyline"===va?this.symLine:"polygon"===va?this.symPoly:this.symPoint,attributes:ra.attributes,infoTemplate:ra.infoTemplate})}U?(this._drawIncidentComplete(ma,la,Z,B,M),aa.resolve()):(new N(da)).then(G.hitch(this,function(xa){D.forEach(xa,function(ta){ma.push(ta[1])});this._drawIncidentComplete(ma,la,Z,B,M);aa.resolve()}));return aa},_drawIncidentComplete:function(t,B,M,U,aa){for(var Z=0;Z<t.length;Z++){var da=
B[Z];da=new O(t[Z],da.symbol,da.attributes,da.infoTemplate);this.incidents.push(da);this.lyrIncidents.add(da)}this._updatePanel(M);this.toolbar.deactivate();this._clickIncidentsButton(-1);this._bufferIncident(U,aa);this.clearIncident.focus()},_updatePanel:function(t){this.div_reversed_address.innerHTML="";b.setStyle(this.div_reverse_geocoding,"display","none");this.saveEnabled&&(d.remove(this.saveButton,"display-off"),(t=t&&this.userCanSave)&&d.contains(this.saveButton,"btnDisabled")&&(d.remove(this.saveButton,
"btnDisabled"),E.set(this.saveButton,"tabindex","0")),d.add(this.saveButton,t?"displayT":"displayT btnDisabled"));d.remove(this.saveOptions,"display-off");d.add(this.saveOptions,"displayT");d.remove(this.borderCol,"display-off");d.add(this.borderCol,"display-on");d.remove(this.clearIncident,"display-off");d.add(this.clearIncident,"display-on")},_updateGeom:function(t){var B=new C,M=t.spatialReference;this.config.drawGeodesic?this._getGeographicGeom(t).then(G.hitch(this,function(U){U=W.geodesicDensify(U,
5E3);if(l.canProject(U,M))B.resolve(l.project(U,M));else if(this.transformation){var aa=new h;aa.outSR=M;aa.geometries=[U];isNaN(this.transformation)||(aa.transformForward=!1);aa.transformation=this.transformation;try{this.gsvc.project(aa,G.hitch(this,function(Z){B.resolve(Z[0])}))}catch(Z){console.log(Z),B.resolve(t)}}else B.resolve(t)}),G.hitch(this,function(U){console.log(U);B.resolve(t)})):B.resolve(t);return B},_getIncidentAddress:function(t){this.incidentPoint=t;this.map.graphics.clear();this._getGeographicGeom(t).then(G.hitch(this,
function(B){this.locator.locationToAddress(B,100)}),function(B){console.log(B)})},_getGeographicGeom:function(t){var B=new C,M=new ha(3857);l.canProject(t,M)?B.resolve(l.webMercatorToGeographic(l.project(t,M))):(M=v.buffer(t,100,9001),M={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:t.spatialReference.wkid,outSR:4326,extentOfInterest:f.stringify(M.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"},Ga(M,{usePost:!1}).then(G.hitch(this,function(U){(U=U&&U.transformations?
U.transformations:void 0)&&0<U.length&&(this.transformation=U[0].wkid?U[0].wkid:U[0].geoTransforms?U[0]:void 0);U=new h;U.outSR=new ha(4326);U.geometries=[t];U.transformation=this.transformation;try{this.gsvc.project(U,G.hitch(this,function(aa){B.resolve(aa[0])}))}catch(aa){console.log(aa),B.resolve(t)}}),G.hitch(this,function(U){B.reject(U)})));return B},_showIncidentAddress:function(t){if(t.address.address){var B=t.address.address.Address,M=new S;M.family="Arial";M.size="18px";M=new ia(B,M,new ba("#000000"));
M.setOffset(20,-4);M.horizontalAlignment="left";this.map.graphics.add(new O(this.incidentPoint,M,{}));this.div_reversed_address.innerHTML=B+"\x3c/br\x3e"+t.address.address.City+", "+t.address.address.Region+" "+t.address.address.Postal;b.setStyle(this.div_reverse_geocoding,"display","block")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;b.setStyle(this.div_reverse_geocoding,"display","block")},_bufferIncident:function(t,B){var M=new C;if(0!==this.incidents.length&&
this.spinnerValue.validate()){for(var U=0;U<this.config.tabs.length;U++)this.config.tabs[U].updateFlag=!0;this.buffers=[];this.lyrBuffer.clear();var aa=!1;U=[];for(var Z=0;Z<this.incidents.length;Z++){var da=this.incidents[Z],la=this.spinnerValue.get("value"),ma=this.config.distanceSettings[this.config.distanceUnits];if(0<la){var ka=da.geometry.spatialReference.wkid;if(this.config.drawGeodesic)if(4326===ka||da.geometry.spatialReference.isWebMercator()){var ra=v.geodesicBuffer(da.geometry,la,ma);this.buffers.push(ra)}else U.push(this._updateGeom(da.geometry));
else ra=v.buffer(da.geometry,la,ma),this.buffers.push(ra)}else t=!1,da=da.geometry.type,"polyline"!==da||aa||(aa=this.isLineEditable),"polygon"!==da||aa||(aa=this.isPolyEditable),"point"!==da||aa||(aa=this.isPointEditable)}0<U.length?(new N(U)).then(G.hitch(this,function(va){D.forEach(va,G.hitch(this,function(xa){ra=v.geodesicBuffer(xa[1],la,ma);this.buffers.push(ra)}));this._useBuffers(t,B,aa);M.resolve()})):(this._useBuffers(t,B,aa),M.resolve());return M}},_useBuffers:function(t,B,M){0<this.buffers.length?
(this.saveEnabled&&(d.remove(this.saveButton,"display-off"),d.contains(this.saveButton,"btnDisabled")&&this.isPolyEditable&&this.userCanSave&&(d.remove(this.saveButton,"btnDisabled"),E.set(this.saveButton,"tabindex","0")),d.add(this.saveButton,"displayT")),this._handleBuffers(this.symPoly,t)):(this.saveEnabled&&(M&&this.userCanSave?d.contains(this.saveButton,"btnDisabled")&&(d.remove(this.saveButton,"btnDisabled"),E.set(this.saveButton,"tabindex","0")):(d.add(this.saveButton,"btnDisabled"),E.set(this.saveButton,
"tabindex","-1"))),this.zoomToIncidents(B));setTimeout(G.hitch(this,function(){n(".noFeaturesActive",this.domNode).forEach(function(U){E.set(U,"tabindex","-1")});this._getLastNodeForEachTab(0)}),100)},_handleBuffers:function(t,B){this.bufferLookUp=[];for(var M=0;M<this.buffers.length;M++){var U=new O(this.buffers[M],t);this.lyrBuffer.add(U);this.bufferLookUp[M]=U}B||this._locateBuffer(v.union(this.buffers));this._performAnalysis()},_performAnalysis:function(){this._updateCounts(!1);this._toggleTabLayersNew(this.curTab)},
_updateCounts:function(t){for(var B=[],M=0;M<this.config.tabs.length;M++){t&&0<M&&this.panelNodes[M]&&(this.panelNodes[M].innerHTML="");var U=this.config.tabs[M],aa=this.tabNodes[M],Z=null,da=!1;U.advStat&&U.advStat.stats&&("undefined"!==typeof U.advStat.stats.tabCount?da=U.advStat.stats.tabCount:U.advStat.stats.count&&(da=!0));"proximity"===U.type?Z=U.proximityInfo:"closest"===U.type?Z=U.closestInfo:"summary"===U.type?Z=U.summaryInfo:"groupedSummary"===U.type&&(Z=U.groupedSummaryInfo);Z&&(t?("undefined"!==
typeof Z.incidentCount&&(Z.incidentCount=0),Z.updateTabCount(0,aa,da)):B.push(Z.queryTabCount(this.incidents,this.buffers,aa,da)))}(new N(B)).then(G.hitch(this,function(la){for(var ma=0,ka=0;ka<la.length;ka++){var ra=la[ka][1];isNaN(ra)||(ma+=ra)}this._updateBtnState(this.downloadAllButon,"btnDisabled",ma);this.userCanSnapshot&&this._updateBtnState(this.createSnapshotButton,"btnDisabled",ma);this._getLastNodeForEachTab(0)}))},_updateBtnState:function(t,B,M){t&&(0===M?(d.add(t,B),E.set(t,"tabindex",
"-1")):d.contains(t,B)&&(d.remove(t,B),E.set(t,"tabindex","0")))},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var t=this.appConfig.getConfigElementsByName("Directions");D.forEach(t,G.hitch(this,function(B){"Directions"===B.name&&(this.dirConfig=B,this.config.enableRouting=!0)}))}},_getAttributeTable:function(){var t=this.appConfig.getConfigElementsByName("AttributeTable");D.forEach(t,G.hitch(this,function(B){"AttributeTable"===B.name&&(this.attributeTable=
B)}))},zoomToIncidents:function(t){var B=!1;if(0<this.incidents.length){var M;1<this.buffers.length?M=v.union(this.buffers):1===this.buffers.length&&(M=this.buffers[0]);var U=this.incidents;if(M){B=!0;var aa=new O(M,M.spatialReference);U.push(aa)}this.geomExtent=X.graphicsExtent(this.incidents);aa&&aa.destroy&&aa.destroy()}"undefined"===typeof t&&(this.geomExtent?this.map.setExtent(this.geomExtent.expand(1.5)):U&&(t=U[0].geometry&&"point"===U[0].geometry.type?U[0].geometry:U[0].geometry.getCentroid(),
this.map.centerAndZoom(t,this.config.defaultZoomLevel)));if(!B){for(t=0;t<this.incidents.length;t++)if("polygon"===this.incidents[t].geometry.type){B=!0;break}this._performAnalysis()}B&&this._performAnalysis()},zoomToLocation:function(t){var B;if(.5===this.config.defaultZoomLevel){if(0<this.buffers.length)var M=v.union(this.buffers)._extent;else if(0<this.incidents.length){for(var U=[],aa=[],Z=[],da=0;da<this.incidents.length;da++){var la=this.incidents[da];switch(la.geometry.type){case "point":U.push(la.geometry._extent);
break;case "polyline":aa.push(la.geometry);break;case "polygon":Z.push(la.geometry)}}da=[];0<U.length&&da.push(v.union(U)._extent);0<aa.length&&da.push(v.union(aa)._extent);0<Z.length&&da.push(v.union(Z)._extent);1<da.length?M=v.union(da)._extent:1===da.length&&(1<U.length||0<aa.length||0<Z.length)&&(M=da[0])}M&&(B=M.expand(.5))}"undefined"===typeof t&&(t=B.getCentroid());B&&this.map.setExtent(B);this.map.centerAt(t)},routeToIncident:function(t){var B=this.incidents[0].geometry,M=B;"point"!==B.type&&
(M=null);this.stops=[M,t];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(G.hitch(this,function(U){if(U&&"closed"!==U.state){var aa=U._dijitDirections;aa?this._addStops(aa):U.getDirectionsDijit().then(G.hitch(this,function(Z){this._addStops(Z)}))}}))},_addStops:function(t){t.clearDirections();t.removeStops();t.reset();t.addStops(this.stops)},_getTabLayers:function(t){var B=[];D.forEach(this.opLayers._layerInfos,G.hitch(this,function(M){if(0<M.newSubLayers.length)this._recurseOpLayers(M.newSubLayers,
B,t);else{var U=this.hasLayerTitle?M.id:M.title;if(Array.isArray(t)?-1<t.indexOf(U):t===U)B.push(M.layerObject),"undefined"===typeof M.layerObject.visible||M.layerObject.visible||(M.layerObject.setVisibility(!0),M.layerObject.setVisibility(!1))}}));return B},_recurseOpLayers:function(t,B,M){D.forEach(t,G.hitch(this,function(U){if(0<U.newSubLayers.length)this._recurseOpLayers(U.newSubLayers,B,M);else{var aa=this.hasLayerTitle?U.id:U.title;(Array.isArray(M)?-1<M.indexOf(aa):M===aa)&&B.push(U.layerObject)}}))},
_setupSymbols:function(){var t=this.config.selectionColor?c.fromString(this.config.selectionColor):c.fromString(this.config.color);var B=t.toRgb();B.push(.2);var M=c.fromString("#000000");t=c.blendColors(t,M,.2).toRgb();M=new T(T.STYLE_SOLID,new c([255,255,255,.25]),1);this.symPoint=new ca(ca.STYLE_CIRCLE,20,M,new c([t[0],t[1],t[2],.7]));this.symLine=new T(T.STYLE_SOLID,new c([t[0],t[1],t[2],.7]),3);this.symPoly=new Y(Y.STYLE_SOLID,this.symLine,new c([t[0],t[1],t[2],.3]));this.symBuffer=new Y(Y.STYLE_SOLID,
M,new c(B));this.symSelection=new Y(Y.STYLE_NULL,new T(T.STYLE_SOLID,new c([0,255,255]),2),new c([0,0,0,0]))},onReceiveData:function(t,B,M){null!==M&&M.eventType&&("IncidentLocationAdd"===M.eventType?M.dataValue&&null!==M.dataValue&&(this._clickTab(0),null===this.symPoint?this.dataValue=M.dataValue:this._drawIncident(M.dataValue,void 0,void 0,!0)):"IncidentLocationRemove"===M.eventType?(t=this.incidents.indexOf(M.removeGraphic),this.incidents.splice(t,1),this.lyrIncidents.remove(M.removeGraphic),
this.bufferLookUp&&0<this.bufferLookUp.length&&(this.lyrBuffer.remove(this.bufferLookUp[t]),this.bufferLookUp.splice(t,1)),this.buffers&&0<this.buffers.length&&this.buffers.splice(t,1),this.incidents&&0<this.incidents.length?(this.config.tabs[this.curTab].updateFlag=!0,this._performAnalysis()):this._clear(!1)):"WebMapChanged"===M.eventType&&this._storeIncidents())},_storeIncidents:function(){if(0<this.incidents.length){for(var t=[],B=0;B<this.incidents.length;B++)t.push(f.stringify(this.incidents[B].geometry.toJson()));
t={location:f.stringify(t),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.spinnerValue.get("value"),unit:this.config.distanceUnits,curTab:this.curTab,extent:f.stringify(this.map.extent.toJson())};t=f.stringify(t);window.localStorage.setItem(this.Incident_Local_Storage_Key,t);console.log("Incident saved to storage")}},_restoreIncidents:function(){var t=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==t&&"null"!==t){window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);var B=f.parse(t,!0),M=B.buffer_dist,U=f.parse(B.location);this.curTab=B.curTab;t=[];for(var aa=0;aa<U.length;aa++)t.push({geometry:A.fromJson(f.parse(U[aa]))});this.spinnerValue.set("value",M);for(M=0;M<this.config.tabs.length;M++)this.config.tabs[M].restore=!0;this._drawIncident(t,!0,!0,!0).then(G.hitch(this,function(){this._clickTab(0,!0);this._toggleTabs(B.curTab);this._toggleTabLayers(B.curTab);this.curTab=B.curTab;this._clickIncidentsButton(-1);this._updateW();var Z=A.fromJson(f.parse(B.extent));
v.equals(Z,this.map.extent)||this.map.setExtent(Z,!1)}))}else d.remove(this.saveOptions,"displayT"),d.add(this.saveOptions,"display-off"),d.remove(this.borderCol,"display-on"),d.add(this.borderCol,"display-off"),d.remove(this.clearIncident,"display-on"),d.add(this.clearIncident,"display-off")},_updateW:function(){for(var t=0,B=0;B<this.tabNodes.length;B++)t+=F.position(this.tabNodes[B]).w;t+=10;e.set(this.tabsNode,"width",t+"px");t>F.position(this.footerNode).w&&(e.set(this.footerContentNode,window.isRTL?
"left":"right","58px"),window.isRTL?(e.set(this.panelLeft,"display","block"),e.set(this.panelRight,"display","none")):e.set(this.panelRight,"display","block"))},_mapResize:function(){var t=e.getComputedStyle(this.map.container);if(t){var B=this._getSAPanelHeight();t=parseFloat(t.bottom.replace("px",""));if("opened"===this.state||"active"===this.state){var M=this._getAttributeTableHeight();M>B&&(B=M);t<=B&&y.publish("changeMapPosition",{bottom:B})}}},_onMapPositionChange:function(t){t&&(this.left=
t.left,this.right=t.right,isFinite(this.left)&&"number"===typeof this.left&&e.set(this.domNode,window.isRTL?"right":"left",parseFloat(this.left)+"px"),isFinite(this.right)&&"number"===typeof this.right&&e.set(this.domNode,window.isRTL?"left":"right",parseFloat(this.right)+"px"));this._onPanelScroll()},_resetMapPosition:function(){y.publish("changeMapPosition",{bottom:this._getAttributeTableHeight()})},_getSAPanelHeight:function(){var t=parseInt(this.position.height.toString().replace("px",""),10),
B=parseInt(this.position.bottom.toString().replace("px",""),10);return t+B},_getAttributeTableHeight:function(){var t=parseInt(this.position.bottom.toString().replace("px",""),10);if(this.attributeTable){var B=q.byId(this.attributeTable.id);B&&(B=e.getComputedStyle(B))&&B.height&&(t+=parseInt(B.height.toString().replace("px",""),10))}return t},_resize:function(t){try{this._onPanelScroll(this.curTab),this.hideContainer&&this._handlePopup(),this._clearMobileSetAsIncidentStyle(),this._resetInfoWindow(!1),
this._initEditInfo(),this._checkHideContainer()}catch(B){console.log(B)}},_onPanelScroll:function(t){t=this.footerContentNode.getBoundingClientRect();if(window.isRTL){for(var B=0;B<this.tabsNode.children.length;B++){var M=this.tabsNode.children[B];M=M.getBoundingClientRect();M=M.right;M=parseFloat(M.toString().split(".")[0]);if(M<=t.right){var U=B;var aa=M;break}}for(B=0;B<this.tabsNode.children.length;B++)if(M=this.tabsNode.children[B],M=M.getBoundingClientRect(),M=M.left,M<t.left){var Z=B;break}t=
this.footerContentNode;B=0;"TabTheme"===this.appConfig.theme.name&&(B+=this.right);B=1<=U||aa<B;e.set(t,"right",B?"34px":"0px");e.set(this.panelRight,"display",B?"block":"none");e.set(this.panelRight,"width",B?"34px":"0px");U=Z<=this.tabsNode.children.length;e.set(t,"left",U?"58px":"24px");e.set(this.panelLeft,"display",U?"block":"none");e.set(this.panelLeft,"width",U?"34px":"0px");d.contains(this.clearIncident,"display-off")&&(e.set(this.panelLeft,"display","none"),e.set(this.panelRight,"display",
"none"))}else{for(B=0;B<this.tabsNode.children.length;B++)if(M=this.tabsNode.children[B],M=M.getBoundingClientRect(),M=window.isRTL?M.right:M.left,0<=M){U=B;aa=M;break}for(B=0;B<this.tabsNode.children.length;B++)if(M=this.tabsNode.children[B],M=M.getBoundingClientRect(),M=window.isRTL?M.left:M.right,M>(window.isRTL?t.left:t.right)){Z=B;break}t=this.footerContentNode;B=Z<=this.tabsNode.children.length;e.set(t,window.isRTL?"left":"right",B?"58px":"24px");e.set(this.panelRight,"display",B?"block":"none");
B=0;"TabTheme"===this.appConfig.theme.name&&(B+=window.isRTL?this.right:this.left);U=1<=U||aa<B;e.set(t,window.isRTL?"right":"left",U?"34px":"0px");e.set(this.panelLeft,"display",U?"block":"none");e.set(this.panelLeft,"width",U?"34px":"0px")}},_scrollToTab:function(t){var B=F.position(this.footerContentNode).w;if(F.position(this.tabsNode).w>B){var M=F.getMarginBox(this.tabNodes[t]);this.footerContentNode.scrollLeft=M.l-(B-M.w)/2}this._onPanelScroll(t)},_navLeft:function(t){},_navRight:function(t){},
_navTabsLeft:function(t){this._navTabs(!1)},_navTabsRight:function(t){this._navTabs(!0)},_navTabs:function(t){var B=this.footerContentNode.getBoundingClientRect();if(window.isRTL)for(var M=this.tabsNode.children.length-1;0<=M;M--){var U=this.tabsNode.children[M];U=U.getBoundingClientRect();if(t){if(U.right>B.right){this._scrollToTab(M);break}}else if(0<U.right){this._scrollToTab(M);break}}else for(M=0;M<this.tabsNode.children.length;M++)if(U=this.tabsNode.children[M],U=U.getBoundingClientRect(),t){if(U.right>
B.right){this._scrollToTab(M);break}}else if(0<U.right){this._scrollToTab(M);break}},_storeInitalVisibility:function(){D.forEach(this.config.tabs,G.hitch(this,function(t){D.forEach(t.tabLayers,G.hitch(this,function(B){"undefined"!==typeof B.visible&&(!B.id||B.id in this.initalLayerVisibility||(this.initalLayerVisibility[B.id]=B.visible),B.setVisibility(!1));t&&t.jimuLayerInfo&&t.jimuLayerInfo.setTopLayerVisible&&(B=t.jimuLayerInfo.isShowInMap(),this.initalLayerVisibility.hasOwnProperty(t.jimuLayerInfo.id)||
(this.initalLayerVisibility[t.jimuLayerInfo.id]=B),B&&t.jimuLayerInfo.setTopLayerVisible(!1))}))}))},_resetInitalVisibility:function(){D.forEach(this.config.tabs,G.hitch(this,function(t){D.forEach(t.tabLayers,G.hitch(this,function(B){"undefined"!==typeof B.visible&&B.id&&B.id in this.initalLayerVisibility&&(B.setVisibility(this.initalLayerVisibility[B.id]),B.hasOwnProperty("visible")&&(B.visible=this.initalLayerVisibility[B.id]),B.redraw?B.redraw():B.refresh&&B.refresh());t&&t.jimuLayerInfo&&t.jimuLayerInfo.setTopLayerVisible&&
t.jimuLayerInfo.isShowInMap()!==this.initalLayerVisibility[t.jimuLayerInfo.id]&&t.jimuLayerInfo.setTopLayerVisible(this.initalLayerVisibility[t.jimuLayerInfo.id])}))}));this.initalLayerVisibility=[]},_clearGraphics:function(){D.forEach(this.config.tabs,G.hitch(this,function(t){if("summary"===t.type&&t.tabLayers&&1<t.tabLayers.length)for(var B=1;B<t.tabLayers.length;B++)t.tabLayers.pop()}))},_resetInfoWindow:function(t){this.defaultPointContent&&this.pointEditLayer.infoTemplate.setContent(this.defaultPointContent);
this.defaultLineContent&&this.lineEditLayer.infoTemplate.setContent(this.defaultLineContent);this.defaultPolyContent&&this.polyEditLayer.infoTemplate.setContent(this.defaultPolyContent);this.defaultPopupSize&&this.map.infoWindow.resize(this.defaultPopupSize.width,"auto");(!this._isAndroid()||t)&&this.map.infoWindow.isShowing&&this.map.infoWindow.hide()},_close:function(){this.widgetManager.closeWidget(this.id)},_downloadAll:function(){for(var t=this.downloadAllButon.classList?this.downloadAllButon.classList:
this.downloadAllButon.className.split(" "),B=!0,M=0;M<t.length;M++)if("btnDisabled"===t[M]){B=!1;break}B&&(this._updateProcessing(this.downloadAllButon,!0,this.downloadAllSrc),this._verifyIncident(!1)&&(t=this._getAnalysisObjects(),(new Aa(this)).createDownloadZip(t,this.incidents,this.buffers).then(G.hitch(this,function(U){this._updateProcessing(this.downloadAllButon,!1,this.downloadAllSrc);setTimeout(G.hitch(this,function(){this.downloadAllButon.focus()}),1E3)}),function(U){this._updateProcessing(this.downloadAllButon,
!1,this.downloadAllSrc);new L({message:U.message})})));setTimeout(G.hitch(this,function(){this.downloadAllButon.focus()}),1E3)},_updateProcessing:function(t,B,M){b.setAttr(t,"src",B?this.processingSrc:M)},_getAnalysisObjects:function(){var t=["proximity","closest","summary","groupedSummary"],B=[];D.forEach(this.config.tabs,function(M){if(-1<t.indexOf(M.type)){switch(M.type){case "proximity":var U=M.proximityInfo;break;case "closest":U=M.closestInfo;break;case "summary":U=M.summaryInfo;break;case "groupedSummary":U=
M.groupedSummaryInfo}var aa="undefined"!==typeof M.layerTitle?M.layerTitle:M.layers;B.push({layerObject:M.tabLayers[0],label:""!==M.label?M.label:aa,analysisObject:U,type:M.type})}});return B.reverse()},_verifyIncident:function(t,B){if(0===this.buffers.length){for(var M=!1,U=0;U<this.incidents.length;U++)if("polygon"===this.incidents[U].geometry.type){M=!0;break}M||(M=0<this.config.tabs.filter(function(aa){return"closest"===aa.type}).length&&0<parseInt(this.config.maxDistance,10));M||(new L({message:t?
this.nls.notPolySnapShot:B?this.nls.notPolyReport:this.nls.notValidDownload}),this._updateProcessing(t?this.createSnapshotButton:B?this.createReportButton:this.downloadAllButon,!1,t?this.snapshotSrc:B?this.reportSrc:this.downloadAllSrc));return M}return!0},_createSnapshot:function(){for(var t=this.createSnapshotButton.classList?this.createSnapshotButton.classList:this.createSnapshotButton.className.split(" "),B=!0,M=0;M<t.length;M++)if("btnDisabled"===t[M]){B=!1;break}B&&this._verifyIncident(!0)&&
this._getName("snapshot").then(G.hitch(this,function(U){if(U&&"cancel"!==U){this._updateProcessing(this.createSnapshotButton,!0,this.snapshotSrc);var aa=[];0<this.buffers.length&&aa.push({graphics:this.lyrBuffer.graphics,label:1<this.buffers.length?this.nls.buffers:this.nls.buffer});aa.push({graphics:this.incidents,label:1<this.incidents.length?this.nls.incidents:this.nls.incident});(new Aa(this)).createSnapShot({layers:aa.concat(this._getAnalysisObjects()),incidents:this.incidents,buffers:this.buffers,
time:Date.now(),name:U.name,groups:U.groups}).then(G.hitch(this,function(Z){this.busyIndicator.hide();this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc)}),G.hitch(this,function(Z){this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);new L({message:Z.message});this.busyIndicator.hide()}))}else this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);this.createSnapshotButton.focus()}))},_initReportDijit:function(t){var B="";t.logo&&(B=t.logo,B=-1<B.indexOf("${appPath}")?
R.substitute(B,{appPath:this.folderUrl.slice(0,this.folderUrl.lastIndexOf("widgets"))}):B);this.reportDijit=new x({alignNumbersToRight:window.isRTL,reportLogo:B,appConfig:this.appConfig,footNotes:t.footnote,printTaskUrl:t.printTaskURL,reportLayout:t.reportLayout,styleSheets:[this.folderUrl+"/css/reportDijitOverrides.css"],styleText:".esriCTTable th{background-color: "+t.textColor+"; color: "+this.getTextColor(t.textColor)+";} .esriCTSectionTitle{color: black;} .esriCTHTMLData{height:100%;}",maxNoOfCols:7});
this.own(m(this.reportDijit,"reportError",G.hitch(this,function(){new L({message:window.jimuNls.common.error})})))},getTextColor:function(t){t=(new a(t)).toRgb();return.5>1-(.299*t[0]+.587*t[1]+.114*t[2])/255?"#000":"#fff"},_getName:function(t){var B=new C,M=new La({nls:this.nls,type:t,pageUtils:K,storedProps:this._getStoredPropData("SA-REPORT-PROPS"),portalUrl:this.appConfig.portalUrl}),U=new ya({autoHeight:!0,content:M,titleLabel:"report"===t?this.nls.report_name:this.nls.snapshot_name,invalidMessage:"report"===
t?this.nls.invalid_report_name:this.nls.invalid_snapshot_name});M.initWidth();this.own(m(M,"ok",G.hitch(this,function(aa){M.destroy();M=null;U.close();"report"!==t&&this.busyIndicator.show();this._storePropData("SA-REPORT-PROPS",aa);B.resolve(aa)})));this.own(m(M,"cancel",G.hitch(this,function(){M.destroy();M=null;U.close();B.resolve("cancel")})));return B},_storePropData:function(t,B){window.localStorage.setItem(t,f.stringify(B))},_getStoredPropData:function(t){return window.localStorage.getItem(t)},
_createReport:function(){this.reportEnabled&&this._verifyIncident(!1,!0)&&(this._updateProcessing(this.createReportButton,!0,this.reportSrc),this._getReportData().then(G.hitch(this,function(t){this._updateProcessing(this.createReportButton,!1,this.reportSrc);this._getName("report").then(G.hitch(this,function(B){if(B&&"cancel"!==B){this._updateProcessing(this.createReportButton,!0,this.reportSrc);this._initReportDijit(G.mixin(this.config.reportSettings,B));for(var M,U=0;U<t.length;U++){var aa=t[U];
if("map"===aa.type){M=U;aa.printTemplate=this._getPrintTemplate();break}}B.comments&&""!==B.comments&&t.splice(M+1,0,{type:"html",data:"\x3cp style\x3d'white-space: pre-wrap;'\x3e"+B.comments+"\x3c/p\x3e"});this.reportDijit.maxNoOfCols="Landscape"===B.reportLayout.orientation.Type?12:7;this.reportDijit.print(B.name,t)}this._updateProcessing(this.createReportButton,!1,this.reportSrc);this.createReportButton.focus()}))})))},_getReportData:function(t){var B=new C,M=[];M.push({addPageBreak:!0,type:"map",
map:this.map});t=this._getAnalysisObjects().reverse();var U=this.nls;(new Aa(this))._performAnalysis(t,this.incidents,this.buffers,!1,!0).then(function(aa){D.forEach(aa,G.hitch(this,function(Z){if(Z){var da=[],la=[],ma=[];if(!Z.context.tab.advStat.hasOwnProperty("analysisSummaryForReport")||Z.context.tab.advStat.hasOwnProperty("analysisSummaryForReport")&&Z.context.tab.advStat.analysisSummaryForReport){for(var ka=Z.context.tab.type,ra="summary"===ka?U.summary:"closest"===ka?U.closest:"proximity"===
ka?U.proximity:U.groupedSummary,va="proximity"===ka?Z.reportResults:Z.analysisResults,xa=0;xa<va.length;xa++){var ta=va[xa];if("summary"!==ka&&"groupedSummary"!==ka)ma=[],0===xa&&D.forEach(ta,function(wa){da.push(wa.label)}),D.forEach(ta,function(wa){ma.push(wa.value)}),la.push(ma);else if("summary"===ka){var Ba=[];D.forEach(Z.context.calcFields,function(wa){Ba.push(wa.alias?wa.alias:wa.field)});0<Ba.length&&-1<Ba.indexOf(ta.info.replace("\x3cbr/\x3e",""))&&(da.push(ta.info.replace("\x3cbr/\x3e",
"")),ma.push(ta.num))}else da.push(-1===["",null,void 0].indexOf(ta.a)?ta.a+" "+ta.info:ta.info),ma.push(ta.total)}"summary"!==ka&&"groupedSummary"!==ka||la.push(ma);M.push({title:Z.context.baseLabel+" ("+ra+")",addPageBreak:!1,type:"table",data:{cols:da,rows:la}})}if(!Z.context.tab.advStat.hasOwnProperty("PopUpSummaryForReport")||Z.context.tab.advStat.hasOwnProperty("PopUpSummaryForReport")&&Z.context.tab.advStat.PopUpSummaryForReport){var za={};da=[];la=[];ma=[];ka=Ea.getPopupFields(Z.context.tab);
if(0<ka.length){D.forEach(ka,function(wa){za[wa.expression]=wa.label});for(ka=0;ka<Z.graphics.length;ka++){ma=[];var Ca=Z.graphics[ka].attributes;ra=Object.keys(Ca);0===ka&&D.forEach(ra,function(wa){za.hasOwnProperty(wa)&&da.push(za[wa])});D.forEach(ra,function(wa){za.hasOwnProperty(wa)&&ma.push(Ea.getFieldValue(wa,Ca[wa],Z.context.specialFields,Z.context.dateFields,Z.context.defaultDateFormat,Z.context.typeIdField,Z.context.types,Z.context.layerObject&&Z.context.layerObject.renderer?Z.context.layerObject:
Z.context.layerDefinition,Ca))});la.push(ma)}M.push({title:Z.context.baseLabel,addPageBreak:!1,type:"table",data:{cols:da,rows:la}})}}}}));B.resolve(M)},function(aa){this._updateProcessing(this.createReportButton,!1,this.reportSrc);new L({message:aa.message})});return B},_getPrintTemplate:function(){var t=[];var B=new pa;this.reportDijit._printService.legendAll=!0;this.reportDijit._printService._getPrintDefinition(this.map,B);D.forEach(this.reportDijit._printService.allLayerslegend,G.hitch(this,function(M){if(M.id!==
this.lyrIncidents.id&&M.id!==this.lyrBuffer.id){var U=new na;U.layerId=M.id;M.subLayerIds&&(U.subLayerIds=M.subLayerIds);t.push(U)}}));this.reportDijit._printService.legendAll=!1;B.layoutOptions={legendLayers:t,customTextElements:[{Date:(new Date).toLocaleString()}]};B=this.reportDijit.setMapLayout(B);B.preserveScale=!1;B.showAttribution=!0;B.format="jpg";return B},_isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")}})});