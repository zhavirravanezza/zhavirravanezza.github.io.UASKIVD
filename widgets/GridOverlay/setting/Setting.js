// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/GridOverlay/lib/GridOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array ./mgrs-utils esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/geometry/Extent esri/geometry/ScreenPoint esri/Color esri/geometry/webMercatorUtils jimu/utils xstyle/css!./GridOverlay.css".split(" "),function(I,g,r,n,m,d,b,a,c,l,k){Math.log10||(Math.log10=function(f){return Math.log(f)/Math.LN10});return I(null,{minIntervalSpacing:150,currentInterval:0,levelOfDetail:"default",
labelPlacement:null,verticalLabels:!0,cornerLabelXOffset:10,cornerLabelYOffset:10,intervalLabelXOffset:30,intervalLabelYOffset:30,colors:null,lineWidths:null,fontSizes:null,lineOpacity:.8,labelOpacity:1,centerLabelOpacity:.4,centerLabelScaleFactor:3,fontFamily:"Arial, Helvetica, sans-serif",map:null,_lineGraphics:null,_labelGraphics:null,constructor:function(f){f=f||{};f.map||console.warn("Before the grid will draw, you must use the 'setMap' method to define which map object to draw on");f.hasOwnProperty("enabled")?
this.enabled=f.enabled:this.enabled=!0;this._lineGraphicsLayer=new m;this._labelGraphicsLayer=new m({className:"gridOverlay"});this._centerLabelGraphicsLayer=new m({className:"gridOverlay"});this.enable=g.hitch(this,this.enable);this.disable=g.hitch(this,this.disable);this.clearGrid=g.hitch(this,this.clearGrid);this.drawGrid=g.hitch(this,this.drawGrid);this.getLayers=g.hitch(this,function(){return[this._lineGraphicsLayer,this._labelGraphicsLayer,this._centerLabelGraphicsLayer]});this.labelPlacement=
{lowerLeft:!0,lowerRight:!0,upperLeft:!0,upperRight:!0,center:!0};this.colors="#FA5858 #F7FE2E #2EFE2E #2EFEF7 #FFF #BDBDBD #000".split(" ");this.lineWidths=[3,2,1,1,1,1,1];this.fontSizes=[29,27,19,16,15,13,11];this.map=f.map||{};this._lineGraphics=[];this._labelGraphics=[];this._lineGraphicsLayer.setOpacity(this.lineOpacity);this._labelGraphicsLayer.setOpacity(this.labelOpacity);this._centerLabelGraphicsLayer.setOpacity(this.centerLabelOpacity);for(var e=0;e<this.colors.length;e++)this.colors[e]=
new c(this.colors[e]);this.setProperties(f)},setProperties:function(f){f.lineWidths&&this.setLineWidths(f.lineWidths);f.minIntervalSpacing&&this.setMinIntervalSpacing(f.minIntervalSpacing);f.levelOfDetail&&this.setLevelOfDetail(f.levelOfDetail);f.labelPlacement&&this.setLabelPlacement(f.labelPlacement);f.hasOwnProperty("verticalLabels")&&this.setVerticalLabels(f.verticalLabels);f.cornerLabelXOffset&&this.setCornerLabelXOffset(f.cornerLabelXOffset);f.cornerLabelYOffset&&this.setCornerLabelYOffset(f.cornerLabelYOffset);
f.intervalLabelXOffset&&this.setIntervalLabelXOffset(f.intervalLabelXOffset);f.intervalLabelYOffset&&this.setIntervalLabelYOffset(f.intervalLabelYOffset);f.colors&&this.setColors(f.colors);f.lineWidths&&this.setLineWidths(f.lineWidths);f.fontSizes&&this.setFontSizes(f.fontSizes);f.lineOpacity&&this.setLineOpacity(f.lineOpacity);f.labelOpacity&&this.setLabelOpacity(f.labelOpacity);f.centerLabelOpacity&&this.setCenterLabelOpacity(f.centerLabelOpacity);f.centerLabelScaleFactor&&this.setCenterLabelScaleFactor(f.centerLabelScaleFactor);
f.fontFamily&&this.setFontFamily(f.fontFamily);if(this.enabled&&this.map.loaded)this.enable();else if(this.enabled&&this.map.on)this.map.on("load",g.hitch(this,this.enable))},getMinIntervalSpacing:function(){return this.minIntervalSpacing},setMinIntervalSpacing:function(f){"number"===typeof f&&(this.minIntervalSpacing=f,this.drawGrid())},setLevelOfDetail:function(f){if("string"!==typeof f)return null;f=f.toLowerCase();switch(f){case "more":case "best":case "high":case "maximum":case "max":this.levelOfDetail=
"more";break;case "less":case "low":case "minimum":case "mim":this.levelOfDetail="less";break;default:this.levelOfDetail="default"}this.drawGrid()},getLevelOfDetail:function(){return this.levelOfDetail},getLabelPlacement:function(){return this.labelPlacement},setLabelPlacement:function(f,e){if("object"===typeof f&&f.length)for(this.labelPlacement={lowerLeft:!1,lowerRight:!1,upperLeft:!1,upperRight:!1,center:!1},e=0;e<f.length;e++)this.setLabelPlacement(f[e],!0);else if("object"===typeof f)this.labelPlacement=
f;else if("undefined"===typeof e?(this.labelPlacement={lowerLeft:!1,lowerRight:!1,upperLeft:!1,upperRight:!1,center:!1},e=!0):e=!0===e,f.toLowerCase){switch(f.toLowerCase()){case "center":case "middle":this.labelPlacement.center=e;break;case "top":case "upper":this.labelPlacement.upperLeft=e;this.labelPlacement.upperRight=e;break;case "bottom":case "lower":this.labelPlacement.lowerLeft=e;this.labelPlacement.lowerRight=e;break;case "left":this.labelPlacement.lowerLeft=e;this.labelPlacement.upperLeft=
e;break;case "right":this.labelPlacement.lowerRight=e;this.labelPlacement.upperRight=e;break;case "lower-left":case "bottom-left":this.labelPlacement.lowerLeft=e;break;case "upper-left":case "top-left":this.labelPlacement.upperLeft=e;break;case "lower-right":case "bottom-right":this.labelPlacement.lowerRight=e;break;case "upper-right":case "top-right":this.labelPlacement.upperRight=e;break;case "all":this.labelPlacement.lowerLeft=e;this.labelPlacement.lowerRight=e;this.labelPlacement.upperLeft=e;
this.labelPlacement.upperRight=e;this.labelPlacement.center=e;break;default:this.labelPlacement.lowerLeft=e,this.labelPlacement.lowerRight=e,this.labelPlacement.upperLeft=e,this.labelPlacement.upperRight=e}this.drawGrid()}},getVerticalLabels:function(){return this.verticalLabels},setVerticalLabels:function(f){"boolean"===typeof f&&(this.verticalLabels=f,this.drawGrid())},getCornerLabelXOffset:function(){return this.cornerLabelXOffset},setCornerLabelXOffset:function(f){"number"===typeof f&&(this.cornerLabelXOffset=
f,this.drawGrid())},getCornerLabelYOffset:function(){return this.cornerLabelYOffset},setCornerLabelYOffset:function(f){"number"===typeof f&&(this.cornerLabelYOffset=f,this.drawGrid())},getIntervalLabelXOffset:function(){return this.intervalLabelXOffset},setIntervalLabelXOffset:function(f){"number"===typeof f&&(this.intervalLabelXOffset=f,this.drawGrid())},getIntervalLabelYOffset:function(){return this.intervalLabelYOffset},setIntervalLabelYOffset:function(f){"number"===typeof f&&(this.intervalLabelYOffset=
f,this.drawGrid())},getColor:function(f){return"number"!==typeof f||0>f||f>this.colors.length-1?null:this.colors[f]},setColor:function(f,e){if("number"!==typeof f||0>f||f>this.colors.length-1)return null;this.colors[f]=new c(e);this.drawGrid()},setColors:function(f){if("object"!==typeof f||!f.length)return null;for(var e,h=0;h<this.colors.length;h++)e=f.length>h?h:f.length-1,this.colors[h]=new c(f[e]);this.drawGrid()},getLineWidth:function(f){return"number"!==typeof f||0>f||f>this.lineWidths.length-
1?null:this.lineWidths[f]},setLineWidth:function(f,e){if("number"!==typeof f||"number"!==typeof e||0>f||f>this.lineWidths.length-1)return null;this.lineWidths[f]=e;this.drawGrid()},setLineWidths:function(f){if("object"!==typeof f||!f.length)return null;for(var e,h=0;h<this.lineWidths.length;h++)e=f.length>h?h:f.length-1,"number"===typeof f[e]&&(this.lineWidths[h]=f[e]);this.drawGrid()},getFontSize:function(f){return"number"!==typeof f||0>f||f>this.fontSizes.length-1?null:this.fontSizes[f]},setFontSize:function(f,
e){if("number"!==typeof f||"number"!==typeof e||0>f||f>this.fontSizes.length-1)return null;this.fontSizes[f]=e;this.drawGrid()},setFontSizes:function(f){if("object"!==typeof f||!f.length)return null;for(var e,h=0;h<this.fontSizes.length;h++)e=f.length>h?h:f.length-1,"number"===typeof f[e]&&(this.fontSizes[h]=f[e]);this.drawGrid()},getCenterLabelScaleFactor:function(){return this.centerLabelScaleFactor},setCenterLabelScaleFactor:function(f){"number"===typeof f&&(this.centerLabelScaleFactor=f,this.drawGrid())},
getCenterLabelOpacity:function(){return this.centerLabelOpacity},setCenterLabelOpacity:function(f){"number"===typeof f&&(this.centerLabelOpacity=f,this._centerLabelGraphicsLayer.setOpacity(f),this.drawGrid())},getFontFamily:function(){return this.fontFamily},setFontFamily:function(f){"string"===typeof f&&(this.fontFamily=f,this.drawGrid())},getInterval:function(){return this.currentInterval},setInterval:function(){this.currentInterval=n.getInterval(this.getMinIntervalSpacing(),this.map,this.getLevelOfDetail())},
getMap:function(){return this.map},setMap:g.hitch(this,function(f){this.map.loaded&&this.clearGrid();this.map=f;if(this.enabled&&this.map.loaded)this.enable();else if(this.enabled)this.map.on("load",g.hitch(this,this.enable))}),getLineOpacity:function(){return this.lineOpacity},setLineOpacity:function(f){"number"===typeof f&&(this.lineOpacity=f,this._lineGraphicsLayer.setOpacity(f))},getLabelOpacity:function(){return this.labelOpacity},setLabelOpacity:function(f){"number"===typeof f&&(this.labelOpacity=
f,this._labelGraphicsLayer.setOpacity(f))},getSettings:function(){return{minIntervalSpacing:this.minIntervalSpacing,levelOfDetail:this.levelOfDetail,labelPlacement:this.labelPlacement,verticalLabels:this.verticalLabels,cornerLabelXOffset:this.cornerLabelXOffset,cornerLabelYOffset:this.cornerLabelYOffset,intervalLabelXOffset:this.intervalLabelXOffset,intervalLabelYOffset:this.intervalLabelYOffset,colors:r.map(this.colors,function(f){return f.toHex()}),lineWidths:this.lineWidths,fontSizes:this.fontSizes,
lineOpacity:this.lineOpacity,labelOpacity:this.labelOpacity,centerLabelOpacity:this.centerLabelOpacity,centerLabelScaleFactor:this.centerLabelScaleFactor,fontFamily:this.fontFamily}},enable:function(){var f=this.getMap();this.enabled=!0;f.addLayers(this.getLayers());this._drawEvent=f.on("extent-change",g.hitch(this,function(){this._drawGrid()}));this._drawGrid()},disable:function(){var f=this.getMap();this.enabled=!1;this._drawEvent&&(this._drawEvent.remove(),this._drawEvent=null);this.clearGrid();
for(var e=this.getLayers(),h=0;h<e.length;h++)f.removeLayer(e[h])},clearGrid:function(){var f=this.getMap();if(!f.loaded)var e=f.on("load",g.hitch(this,function(){e.remove();this.clearGrid()}));this._lineGraphicsLayer.clear();this._labelGraphicsLayer.clear();this._centerLabelGraphicsLayer.clear();this._lineGraphics=[];this._labelGraphics=[];this._centerLabelGraphics=[]},drawGrid:function(){this._drawing&&this._drawGrid()},_createExtentFromScreen:function(f,e,h,p){var v=this.map.toScreen(f);e=this.map.toMap(new a(v.x+
e,v.y+h));return new b(f.x,f.y,e.x,e.y,p)},_performOverlapCheck:function(f){for(var e=0;e<f.length;e++)for(var h=e+1;h<f.length;h++)this._doLabelsOverlap(f[e],f[h])&&f[e].symbol.setOffset(0,40)},_doLabelsOverlap:function(f,e){return f&&e?(f=this._createExtentFromScreen(f.geometry,f.symbol.getWidth(),f.symbol.getHeight(),this.map.spatialReference),e=this._createExtentFromScreen(e.geometry,e.symbol.getWidth(),e.symbol.getHeight(),this.map.spatialReference),d.intersects(f,e)):!1},_drawGrid:function(){var f=
this.getMap(),e,h;this._drawing&&clearTimeout(this._drawing);this._drawing=setTimeout(g.hitch(this,function(){if(f.loaded&&this.enabled){h=n.zonesFromExtent(this);this._zoneCount=h.length;this.clearGrid();this.setInterval();this._lineGraphics=[];this._lineGraphics0=[];this._lineGraphics1=[];this._lineGraphics2=[];this._lineGraphics3=[];this._lineGraphics4=[];this._lineGraphics5=[];n.processZonePolygons(h,this);for(e=0;e<this._centerLabelGraphics.length;e++)this._centerLabelGraphicsLayer.add(this._centerLabelGraphics[e]);
r.forEach([this._lineGraphics5,this._lineGraphics4,this._lineGraphics3,this._lineGraphics2,this._lineGraphics1,this._lineGraphics0],function(t){this._lineGraphics=this._lineGraphics.concat(t)},this);for(e=0;e<this._lineGraphics.length;e++)this._lineGraphics[e].geometry=l.project(this._lineGraphics[e].geometry,this._lineGraphicsLayer.spatialReference),this._lineGraphicsLayer.add(this._lineGraphics[e]);this._performOverlapCheck(this._labelGraphics);for(e=0;e<this._labelGraphics.length;e++){this._labelGraphics[e].geometry=
l.project(this._labelGraphics[e].geometry,this._lineGraphicsLayer.spatialReference);this._labelGraphicsLayer.add(this._labelGraphics[e]);var p=this._labelGraphics[e].getNode();if(p){var v=this._labelGraphics[e].symbol.color;v=128<.2126*v.r+.7152*v.g+.0722*v.b?"black":"white";k.has("ie")||k.has("edge")?p.className+=" text-symbol-halo-"+v:p.classList.add("text-symbol-halo-"+v)}}delete this._lineGraphics;delete this._lineGraphics0;delete this._lineGraphics1;delete this._lineGraphics2;delete this._lineGraphics3;
delete this._lineGraphics4;delete this._lineGraphics5}}),50)}})})},"widgets/GridOverlay/lib/mgrs-utils":function(){define("dojo/json ./constants ./geometry-utils ./labeling-utils ./mgrs ./NonPolarGridZone ./VisibleGridZone ./GridPolygon esri/geometry/geometryEngine esri/graphic esri/geometry/Point esri/geometry/Polyline esri/geometry/Polygon esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/Color".split(" "),function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t){return{_ZonesDictionary:function(){var q,
w,u,y="CDEFGHJKLMNPQRSTUVWX".split(""),x={};for(q=1;60>=q;q++)for(w=0;w<y.length;w++){var z=u=void 0,B=void 0,E=void 0;u=void 0;var F=q+y[w];"32X"===F||"34X"===F||"36X"===F?u=null:("31V"===F?u={xmin:0,ymin:56,xmax:3,ymax:64,id:F}:"32V"===F?u={xmin:3,ymin:56,xmax:12,ymax:64,id:F}:"31X"===F?u={xmin:0,ymin:72,xmax:9,ymax:84,id:F}:"33X"===F?u={xmin:9,ymin:72,xmax:21,ymax:84,id:F}:"35X"===F?u={xmin:21,ymin:72,xmax:33,ymax:84,id:F}:"37X"===F?u={xmin:33,ymin:72,xmax:42,ymax:84,id:F}:(E=(q-1)*g.ZONE_WIDTH_DEGREES-
180,B=q*g.ZONE_WIDTH_DEGREES-180,z=w*g.ZONE_HEIGHT_DEGREES+g.MIN_MGRS_LATITUDE,u=(w+1)*g.ZONE_HEIGHT_DEGREES+g.MIN_MGRS_LATITUDE,E=180===E?g.POSITIVE_180:E,E=-180===E?g.NEGATIVE_180:E,B=180===B?g.POSITIVE_180:B,B=-180===B?g.NEGATIVE_180:B,80===u&&(u=g.MAX_MGRS_LATITUDE),u={xmin:E,ymin:z,xmax:B,ymax:u,id:F}),u=new d(u));u&&(x[u.id]=u)}return x}(),getInterval:function(q,w,u){var y=0;var x=w.getResolutionInMeters()*q;var z=w.extent.getCenter();var B=w.toMap(w.toScreen(z).offset(0,q/2));for(x=w.toMap(w.toScreen(z).offset(0,
-q/2));84<=B.getLatitude()||84<=x.getLatitude();)y++,B=w.toMap(w.toScreen(z).offset(0,q/2+y*q)),x=w.toMap(w.toScreen(z).offset(0,-q/2+y*q));for(;-80>=B.getLatitude()||-80>=x.getLatitude();)y++,B=w.toMap(w.toScreen(z).offset(0,q/2-y*q)),x=w.toMap(w.toScreen(z).offset(0,-q/2-y*q));q=B.getLatitude();w=B.getLongitude();B=x.getLatitude();y=x.getLongitude();x=m.getZoneNumber(q,w);x=Math.abs(m.LLtoUTM(q,w,x)[1]-m.LLtoUTM(B,y,x)[1]);q=Math.log10(x);switch(u){case "more":u=Math.floor(q);break;case "less":case "strict":u=
Math.ceil(q);break;default:u=Math.round(q)}u=Math.pow(10,u);x>2*u&&(u*=10);return 1E5<u?!1:u},zonesFromExtent:function(q){var w;var u=q.map.extent;var y=u.spatialReference.isWebMercator()?g.WEBMERCATOR_360:g.GEOGRAPHIC_360,x={xOffset:q.getCornerLabelXOffset(),yOffset:q.getCornerLabelYOffset(),rotation:0,color:q.getColor(0),fontFamily:q.getFontFamily(),fontSize:q.getFontSize(0)},z="CDEFGHJKLMNPQRSTUVWX".split(""),B=[];if(u.xmax-u.xmin>y)return B;y=r.extentToPolygon(u);y=r.toWebMercator(y);var E=r.pointToGeographic(new k([u.xmin,
u.ymin],u.spatialReference)),F=r.pointToGeographic(new k([u.xmax,u.ymax],u.spatialReference));u=E.y;var A=F.y;var C=E.offsetX;var G=F.offsetX;for(var H=C;H<=G;H++){var N=H>C?g.NEGATIVE_180:E.x;var M=H<G?g.POSITIVE_180:F.x;var R=Math.min(Math.max(Math.floor((u+80)/g.ZONE_HEIGHT_DEGREES),0),19);var S=Math.min(Math.floor((A+80)/g.ZONE_HEIGHT_DEGREES),19);N=Math.floor((N+180)/g.ZONE_WIDTH_DEGREES);for(M=Math.min(Math.floor((M+180)/g.ZONE_WIDTH_DEGREES)+2,60);N<=M;N++)for(var U=R;U<=S;U++){var Y=z[U];
Y=N+Y;if(this._ZonesDictionary[Y]){var Z=I.parse(I.stringify(this._ZonesDictionary[Y]._rings));for(w=0;w<Z[0].length;w++)Z[0][w][0]+=H*g.GEOGRAPHIC_360;w=new e({rings:Z});var J=new f({paths:Z});if(Z=c.intersect(r.toWebMercator(w),y))w=c.intersect(r.toWebMercator(J),y),B.push(new b({map:q.map,polyline:w,polygon:Z,offset:H,nonPolarGridZone:this._ZonesDictionary[Y],labelParameters:x}))}}}return B},processZonePolygons:function(q,w){for(var u={},y=w.getInterval(),x=0;x<q.length;x++){var z=q[x];z&&(this.handleZonePolygon(z,
w),y&&(u[z.nonPolarGridZone.utmZone]?u[z.nonPolarGridZone.utmZone].polygon=c.union([r.toWebMercator(z.polygon),u[z.nonPolarGridZone.utmZone].polygon]):u[z.nonPolarGridZone.utmZone]={polygon:r.toWebMercator(z.polygon),offset:z.offset}))}if(y)for(q=Object.keys(u),x=0;x<q.length;x++){z=q[x];var B=u[z].polygon,E=u[z].offset,F=r.toGeographic(B.getExtent()),A=m.LLtoUTM(F.ymin,F.xmin,z),C=m.LLtoUTM(F.ymin,F.xmax,z),G=m.LLtoUTM(F.ymax,F.xmax,z);F=m.LLtoUTM(F.ymax,F.xmin,z);z={minE:Math.min(A[0],C[0],G[0],
F[0]),maxE:Math.max(A[0],C[0],G[0],F[0]),minN:Math.min(A[1],C[1],G[1],F[1]),maxN:Math.max(A[1],C[1],G[1],F[1]),utmZone:z,polygon:B,offset:E,grid:w};this.handle100kGrids(z);1E5>y&&this.handleIntervals(z)}},handleZonePolygon:function(q,w){var u=q.polyline;var y=w.getColor(0);var x=w.getLineWidth(0);w._lineGraphics0.push(new l(u,new h(h.STYLE_SOLID,new t(y),x)));36978596<w.map.getScale()||w._labelGraphics.push(q.getCenterLabel(!0))},handle100kGrids:function(q){var w=q.polygon,u=q.offset,y=q.utmZone,
x=q.minE,z=q.maxE,B=q.minN,E=q.maxN;q=q.grid;var F=q.getColor(1),A=q.getLineWidth(1),C=q.getMap(),G,H;for(B=1E5*Math.floor(B/1E5);B<E;B+=1E5)for(G=1E5*Math.floor(x/1E5);G<z;G+=1E5){var N=m.findGridLetters(y,0>B+5E4?1E7+(B+5E4):B+5E4,G+5E4);var M=[];for(H=G;H<=G+1E5;H+=1E4){var R=m.UTMtoLL(B,H,y);M.push([R.lon,R.lat])}for(H=B;H<B+1E5;H+=1E4)R=m.UTMtoLL(H,G+1E5,y),M.push([R.lon,R.lat]);for(H=G+1E5;H>=G;H-=1E4)R=m.UTMtoLL(B+1E5,H,y),M.push([R.lon,R.lat]);for(H=B+1E5;H>=B;H-=1E4)R=m.UTMtoLL(H,G,y),M.push([R.lon,
R.lat]);for(H=0;H<M.length;H++)M[H][0]+=u*g.GEOGRAPHIC_360;M=new e([M]);H=r.polygonToPolyline(M);R=c.intersect(r.toWebMercator(M),r.toWebMercator(w));H=c.intersect(r.toWebMercator(H),r.toWebMercator(w));if(R&&(N={clippedPolygon:R,unclippedPolygon:M,map:C,xmin:G%1E6,ymin:B%1E6,xmax:(G+1E5)%1E6,ymax:(B+1E5)%1E6,minMaxType:"utm",utmZone:y,text:N,labelParameters:{xOffset:10,yOffset:10,rotation:0,color:q.getColor(1),fontFamily:q.getFontFamily(),fontSize:q.getFontSize(1)}},N=new a(N),!(4622324<q.map.getScale())))for(N=
[N.getCenterLabel(!0)],H&&q._lineGraphics1.push(new l(H,new h(h.STYLE_SOLID,new t(F),A))),H=0;H<N.length;H++)q._labelGraphics.push(N[H])}},handleIntervals:function(q){var w=q.polygon,u=q.utmZone,y=q.offset,x=q.minE,z=q.maxE,B=q.minN,E=q.maxN;q=q.grid;var F=q.getFontFamily(),A=q.getIntervalLabelXOffset(),C=q.getIntervalLabelYOffset(),G=q.getInterval(),H=q.getMap(),N=q.getVerticalLabels(),M;for(M=Math.floor(B/G)*G;M<=E;M+=G)if(0!==M%1E5){if(0===M%1E4){var R=2;var S=q._lineGraphics2}else 0===M%1E3?(R=
3,S=q._lineGraphics3):0===M%100?(R=4,S=q._lineGraphics4):(R=5,S=q._lineGraphics5);var U=q.getColor(R);var Y=q.getLineWidth(R);R=q.getFontSize(R);var Z=new v(R,v.STYLE_NORMAL,v.VARIANT_NORMAL,v.WEIGHT_BOLD,F);var J=[];var O=m.UTMtoLL(M,x,u);var T=m.UTMtoLL(M,z,u);for(O=0;O<z;O+=1E4){var W=m.UTMtoLL(M,x+O,u);J.push([W.lon,W.lat])}J.push([T.lon,T.lat]);for(O=0;O<J.length;O++)J[O][0]+=y*g.GEOGRAPHIC_360;if(T=c.intersect(r.toWebMercator(new f([J])),r.toWebMercator(w))){Y=new l(T,new h(h.STYLE_SOLID,new t(U),
Y));S.push(Y);S=n.padZero((0>B?1E7+M:M)%1E5/G,5-Math.log10(G));J=T.paths[0];O=new k({x:J[0][0]+.001,y:J[0][1],spatialReference:T.spatialReference});T=new k({x:J[J.length-1][0]-.001,y:J[J.length-1][1],spatialReference:T.spatialReference});Y=n.screenDistanceBetweenPoints(O,T,H).horizontal;J=n.distanceFromMapEdge(O,H).horizontal;if(2>J||200<J&&300<Y)J=(new p(S)).setAngle(0).setColor(U).setOffset(A,-(R/1.333)/2).setAlign("start").setFont(Z),J=new l(O,J),q._labelGraphics.push(J);J=n.distanceFromMapEdge(T,
H).horizontal;if(2>J||200<J&&300<Y)J=(new p(S)).setAngle(0).setColor(U).setOffset(-A,-(R/1.333)/2).setAlign("end").setFont(Z),J=new l(T,J),q._labelGraphics.push(J)}}for(x=Math.floor(x/G)*G;x<=z;x+=G)if(0!==x%1E5){0===x%1E4?(R=2,S=q._lineGraphics2):0===x%1E3?(R=3,S=q._lineGraphics3):0===x%100?(R=4,S=q._lineGraphics4):(R=5,S=q._lineGraphics5);U=q.getColor(R);Y=q.getLineWidth(R);R=q.getFontSize(R);Z=new v(R,v.STYLE_NORMAL,v.VARIANT_NORMAL,v.WEIGHT_BOLD,F);J=[];M=m.UTMtoLL(B-1E4,x,u);A=m.UTMtoLL(E+1E4,
x,u);J.push([M.lon,M.lat]);J.push([A.lon,A.lat]);for(O=0;O<J.length;O++)J[O][0]+=y*g.GEOGRAPHIC_360;if(A=c.intersect(r.toWebMercator(new f([J])),r.toWebMercator(w))){M=new l(A,new h(h.STYLE_SOLID,new t(U),Y));S.push(M);S=n.padZero(x%1E5/G,5-Math.log10(G));J=A.paths[0];M=new k({x:J[0][0],y:J[0][1]+.001,spatialReference:{wkid:102100}});A=new k({x:J[J.length-1][0],y:J[J.length-1][1]-.001,spatialReference:{wkid:102100}});Y=n.screenDistanceBetweenPoints(M,A,H).vertical;J=n.distanceFromMapEdge(M,H).vertical;
if(2>J||200<J&&300<Y)J=(new p(S)).setAngle(N?90:0).setColor(U).setOffset(N?-(R/1.333)/2:0,C).setAlign(N?"end":"middle").setFont(Z),J=new l(M,J),q._labelGraphics.push(J);J=n.distanceFromMapEdge(A,H).vertical;if(2>J||200<J&&300<Y)J=(new p(S)).setAngle(N?90:0).setColor(U).setOffset(N?-(R/1.333)/2:0,N?-C:-C-R/1.333).setAlign(N?"start":"middle").setFont(Z),J=new l(A,J),q._labelGraphics.push(J)}}}}})},"widgets/GridOverlay/lib/constants":function(){define([],function(){return{ZONE_WIDTH_DEGREES:6,ZONE_HEIGHT_DEGREES:8,
MIN_MGRS_LATITUDE:-80,MAX_MGRS_LATITUDE:84,POSITIVE_180:179.99999999,NEGATIVE_180:-179.99999999,WEST_GEOGRAPHIC_LIMIT:-180,EAST_GEOGRAPHIC_LIMIT:180,GEOGRAPHIC_360:360,WEST_WEBMERCATOR_LIMIT:-2.0037508342789244E7,EAST_WEBMERCATOR_LIMIT:2.0037508342789244E7,WEBMERCATOR_360:4.007501668557849E7,DEGREES_PER_RADIAN:57.29577951308232,RADIANS_PER_DEGREE:.017453292519943295,WGS84_EQUATORIAL_RADIUS:6378137,WGS84_HALF_EQUATORIAL_RADIUS:3189068.5,HALF_PI:1.5707963267948966}})},"widgets/GridOverlay/lib/geometry-utils":function(){define(["./constants",
"esri/geometry/webMercatorUtils","esri/geometry/Polyline","esri/geometry/Polygon"],function(I,g,r,n){return{toGeographic:function(m){return m.spatialReference.isWebMercator()?g.webMercatorToGeographic(m):m},toWebMercator:function(m){return m.spatialReference.isWebMercator()?m:g.geographicToWebMercator(m)},_latitudeToWebMercatorY:function(m){return I.GEOGRAPHIC_360/2*(I.HALF_PI-2*Math.atan(Math.exp(-1*m/I.WGS84_EQUATORIAL_RADIUS)))/Math.PI},_longitudeToWebMercatorX:function(m){var d=I.GEOGRAPHIC_360,
b=I.GEOGRAPHIC_360/2,a=I.WGS84_EQUATORIAL_RADIUS;return m/a*b/Math.PI-Math.floor((m/a*b/Math.PI+b)/d)*d},pointToGeographic:function(m){for(var d=m.x,b=m.y,a=(m=m.spatialReference.isWebMercator())?I.WEST_WEBMERCATOR_LIMIT:I.WEST_GEOGRAPHIC_LIMIT,c=m?I.EAST_WEBMERCATOR_LIMIT:I.EAST_GEOGRAPHIC_LIMIT,l=m?I.WEBMERCATOR_360:I.GEOGRAPHIC_360,k=0;d<=a;)d+=l,--k;for(;d>c;)d-=l,k+=1;m&&(d=this._longitudeToWebMercatorX(d),b=this._latitudeToWebMercatorY(b));return{x:d,y:b,offsetX:k}},extentToPolygon:function(m){return new n({rings:[[[m.xmin,
m.ymin],[m.xmax,m.ymin],[m.xmax,m.ymax],[m.xmin,m.ymax],[m.xmin,m.ymin]]],spatialReference:m.spatialReference})},polygonToPolyline:function(m){return new r({paths:m.rings,spatialReference:{wkid:m.spatialReference.wkid}})}}})},"widgets/GridOverlay/lib/labeling-utils":function(){define(["./mgrs","esri/geometry/Point"],function(I,g){var r=document.createElement("canvas").getContext("2d");return{getWidthOfText:function(n,m,d){r.font=d+"px "+m;return r.measureText(n).width},padZero:function(n,m){for(n=
n.toString();n.length<m;)n="0"+n;return n},getScreenSize:function(n,m){var d=n.getExtent();n=new g([d.xmin,d.ymin],d.spatialReference);d=new g([d.xmax,d.ymax],d.spatialReference);n=m.toScreen(n);m=m.toScreen(d);return{width:Math.abs(m.x-n.x),height:Math.abs(m.y-n.y)}},distanceFromMapEdge:function(n,m){var d=m.toScreen(n);"undefined"===typeof I&&(I=!0);var b=Math.min(Math.abs(m.width-d.x),Math.abs(d.x));m=Math.min(Math.abs(m.height-d.y),Math.abs(d.y));I&&(n=Math.round(1E4*n.getLatitude())/1E4,84===
n||-80===n)&&(m=0);return{horizontal:b,vertical:m,total:Math.sqrt(b*b+m*m)}},screenDistanceBetweenPoints:function(n,m,d){n=d.toScreen(n);d=d.toScreen(m);m=Math.abs(n.x-d.x);n=Math.abs(n.y-d.y);return{horizontal:m,vertical:n,total:Math.sqrt(m*m+n*n)}}}})},"widgets/GridOverlay/lib/mgrs":function(){define(["esri/geometry/Point"],function(I){var g=6378137;var r=.00669437999;var n=r/(1-r);var m=(1-Math.sqrt(1-r))/(1+Math.sqrt(1-r));return{setSpheroid:function(d){d=d.toUpperCase();switch(d){case "AIRY 1830":g=
6377563.396;r=.00667053999998536;break;case "AIRY MODIFIED":g=6377340.189;r=.00667053999998536;break;case "AVERAGE TERRESTRIAL SYSTEM 1977":g=6378135;r=.00669438499958795;break;case "AUSTRALIAN NATIONAL":g=6378160;r=.00669454185458764;break;case "BESSEL 1841":g=6377397.155;r=.00667437223180214;break;case "BESSEL MODIFIED":g=6377492.018;r=.00667437223180214;break;case "BESSEL NAMIBIA":g=6377483.865;r=.00667437223180214;break;case "CLARKE 1858":g=6378293.639;r=.00678514600473303;break;case "NAD27":case "CLARKE 1866":g=
6378206.4;r=.00676865799760964;break;case "CLARKE 1866 MICHIGAN":g=6378450.047;r=.00676865830738507;break;case "CLARKE 1880":g=6378249.138;r=.00680348101883452;break;case "CLARKE 1880 (ARC)":g=6378249.145;r=.00680348101883452;break;case "CLARKE 1880 (BENOIT)":g=6378300.79;r=.00680348271028565;break;case "CLARKE 1880 (IGN)":g=6378249.2;r=.00680348767623919;break;case "CLARKE 1880 (RGS)":g=6378249.145;r=.00680351128284906;break;case "CLARKE 1880 (SGA)":g=6378249.2;r=.00680348860198551;break;case "EVEREST 1830 (DEFINITION)":g=
6377299.36;r=.00663784663019969;break;case "EVEREST 1830 (MODIFIED)":g=6377304.063;r=.00663784663019969;break;case "EVEREST (ADJUSTMENT 1937)":g=6377276.345;r=.00663784663019969;break;case "EVEREST (DEFINITION 1962)":g=6377301.243;r=.00663784606842344;break;case "EVEREST (DEFINITION 1967)":g=6377298.556;r=.00663784663019969;break;case "EVEREST (DEFINITION 1975)":g=6377299.151;r=.00663784606842344;break;case "NAD83":case "GEM GRAVITY POTENTIAL MODEL":case "GRS 1980":g=6378137;r=.00669438002290079;
break;case "GRS 1967 \x3d INTERNATIONAL 1967":g=6378160;r=.00669460532856765;break;case "HELMERT 1906":g=6378200;r=.00669342162296594;break;case "INDONESIAN NATIONAL":g=6378160;r=.0066946090804091;break;case "INTERNATIONAL 1924":g=6378388;r=.00672267002233332;break;case "INTERNATIONAL 1967":g=6378160;r=.00669454185458764;break;case "KRASOVSKY 1940":g=6378245;r=.00669342162296594;break;case "TRANSIT PRECISE EPHEMERIS":g=6378145;r=.00669454185458764;break;case "OSU 1986 GEOIDAL MODEL":g=6378136.2;r=
.00669438006997852;break;case "OSU 1991 GEOIDAL MODEL":g=6378136.3;r=.00669438006997852;break;case "PLESSIS 1817":g=6376523;r=.00646954373789485;break;case "STRUVE 1860":g=6378298.3;r=.00677435980080942;break;case "WAR OFFICE":g=6378300.583;r=.00674534331628926;break;case "NWL-10D \x3d\x3d WGS 1972":g=6378135;r=.00669431777826672;break;case "WGS 1972":g=6378135;r=.00669431777826672;break;case "WGS84":case "WGS 1984":g=6378137;r=.00669437999014132;break;case "WGS 1966":g=6378145;r=.00669454185458764;
break;case "FISCHER 1960":g=6378166;r=.00669342162296594;break;case "FISCHER 1968":g=6378150;r=.00669342162296594;break;case "FISCHER MODIFIED":g=6378155;r=.00669342162296594;break;case "HOUGH 1960":g=6378270;r=.00672267002233332;break;case "EVEREST MODIFIED 1969":g=6377295.664;r=.00663784663019969;break;case "WALBECK":g=6376896;r=.00659454809414964;break;case "GRS 1967 TRUNCATED":g=6378160,r=.00669454185458764}n=r/(1-r);m=(1-Math.sqrt(1-r))/(1+Math.sqrt(1-r))},getSpheroidList:function(){return"AIRY 1830;AIRY MODIFIED;AUSTRALIAN NATIONAL;AVERAGE TERRESTRIAL SYSTEM 1977;BESSEL 1841;BESSEL MODIFIED;BESSEL NAMIBIA;CLARKE 1858;CLARKE 1866 MICHIGAN;CLARKE 1866;CLARKE 1880 (ARC);CLARKE 1880 (BENOIT);CLARKE 1880 (IGN);CLARKE 1880 (RGS);CLARKE 1880 (SGA);CLARKE 1880;EVEREST (ADJUSTMENT 1937);EVEREST (DEFINITION 1962);EVEREST (DEFINITION 1967);EVEREST (DEFINITION 1975);EVEREST 1830 (DEFINITION);EVEREST 1830 (MODIFIED);EVEREST MODIFIED 1969;FISCHER 1960;FISCHER 1968;FISCHER MODIFIED;GEM GRAVITY POTENTIAL MODEL;GRS 1967 \x3d INTERNATIONAL 1967;GRS 1967 TRUNCATED;GRS 1980;HELMERT 1906;HOUGH 1960;INDONESIAN NATIONAL;INTERNATIONAL 1924;INTERNATIONAL 1967;KRASOVSKY 1940;NWL-10D \x3d\x3d WGS 1972;OSU 1986 GEOIDAL MODEL;OSU 1991 GEOIDAL MODEL;PLESSIS 1817;STRUVE 1860;TRANSIT PRECISE EPHEMERIS;WALBECK;WAR OFFICE;WGS 1966;WGS 1972;WGS 1984".split(";")},
getZoneNumber:function(d,b){d=parseFloat(d);b=parseFloat(b);if(360<b||-180>b){for(;-180>b;)b+=360;for(;180<b;)b-=360}(360<b||-180>b||90<d||-90>d)&&console.error("Bad input. lat: "+d+" lon: "+b);b=b+180-360*Math.floor((b+180)/360)-180;var a=Math.floor((b+180)/6)+1;56<=d&&64>d&&3<=b&&12>b&&(a=32);72<=d&&84>d&&(0<=b&&9>b?a=31:9<=b&&21>b?a=33:21<=b&&33>b?a=35:33<=b&&42>b&&(a=37));return a},LLtoUTM:function(d,b,a){d=parseFloat(d);b=parseFloat(b);if(84<d||-80>d)return"undefined, ensure 84N \x3e Lat \x3e 80S";
if(360<b||-180>b){for(;-180>b;)b+=360;for(;180<b;)b-=360}(360<b||-180>b||90<d||-90>d)&&console.error("Bad input. lat: "+d+" lon: "+b);var c=b+180-360*Math.floor((b+180)/360)-180;var l=d*Math.PI/180;c=c*Math.PI/180;b=a?a:this.getZoneNumber(d,b);a=(6*(b-1)-180+3)*Math.PI/180;this.UTMLetterDesignator(d);d=g/Math.sqrt(1-r*Math.sin(l)*Math.sin(l));var k=Math.tan(l)*Math.tan(l);var f=n*Math.cos(l)*Math.cos(l);c=Math.cos(l)*(c-a);return[.9996*d*(c+(1-k+f)*c*c*c/6+(5-18*k+k*k+72*f-58*n)*c*c*c*c*c/120)+5E5,
.9996*(g*((1-r/4-3*r*r/64-5*r*r*r/256)*l-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*l)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*l)-35*r*r*r/3072*Math.sin(6*l))+d*Math.tan(l)*(c*c/2+(5-k+9*f+4*f*f)*c*c*c*c/24+(61-58*k+k*k+600*f-330*n)*c*c*c*c*c*c/720)),b]},LLtoUSNG:function(d,b,a,c){a=a||5;var l=c?c:this.getZoneNumber(d,b);d=parseFloat(d);b=parseFloat(b);var k=this.LLtoUTM(d,b,l);c=k[0];var f=k[1];0>d&&(f+=1E7);k=this.findGridLetters(l,f,c);l=Math.round(f)%1E5;c=Math.round(c)%1E5;l=Math.floor(l/Math.pow(10,
5-a));c=Math.floor(c/Math.pow(10,5-a));d=this.getZoneNumber(d,b)+this.UTMLetterDesignator(d)+" "+k+" ";for(b=String(c).length;b<a;b++)d+="0";d+=c+" ";for(b=String(l).length;b<a;b++)d+="0";return d+l},UTMLetterDesignator:function(d){d=parseFloat(d);return 84>=d&&72<=d?"X":72>d&&64<=d?"W":64>d&&56<=d?"V":56>d&&48<=d?"U":48>d&&40<=d?"T":40>d&&32<=d?"S":32>d&&24<=d?"R":24>d&&16<=d?"Q":16>d&&8<=d?"P":8>d&&0<=d?"N":0>d&&-8<=d?"M":-8>d&&-16<=d?"L":-16>d&&-24<=d?"K":-24>d&&-32<=d?"J":-32>d&&-40<=d?"H":-40>
d&&-48<=d?"G":-48>d&&-56<=d?"F":-56>d&&-64<=d?"E":-64>d&&-72<=d?"D":-72>d&&-80<=d?"C":"Z"},findSet:function(d){d=parseInt(d,10);switch(d%6){case 0:return 6;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;default:return-1}},findGridLetters:function(d,b,a){d=parseInt(d,10);b=parseFloat(b);a=parseFloat(a);var c=1;for(b=Math.round(b);1E5<=b;)b-=1E5,c++;c%=20;b=0;for(a=Math.round(a);1E5<=a;)a-=1E5,b++;b%=8;return this.lettersHelper(this.findSet(d),c,b)},lettersHelper:function(d,
b,a){0===b?b=19:b--;0===a?a=7:a--;switch(d){case 1:return d="ABCDEFGHJKLMNPQRSTUV","ABCDEFGH".charAt(a)+d.charAt(b);case 2:return d="FGHJKLMNPQRSTUVABCDE","JKLMNPQR".charAt(a)+d.charAt(b);case 3:return d="ABCDEFGHJKLMNPQRSTUV","STUVWXYZ".charAt(a)+d.charAt(b);case 4:return d="FGHJKLMNPQRSTUVABCDE","ABCDEFGH".charAt(a)+d.charAt(b);case 5:return d="ABCDEFGHJKLMNPQRSTUV","JKLMNPQR".charAt(a)+d.charAt(b);case 6:return d="FGHJKLMNPQRSTUVABCDE","STUVWXYZ".charAt(a)+d.charAt(b)}},UTMtoLL:function(d,b,a){b=
parseFloat(b)-5E5;d=parseFloat(d);a=parseInt(a,10);d=d/.9996/(g*(1-r/4-3*r*r/64-5*r*r*r/256));d=d+(3*m/2-27*m*m*m/32)*Math.sin(2*d)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*d)+151*m*m*m/96*Math.sin(6*d);var c=g/Math.sqrt(1-r*Math.sin(d)*Math.sin(d)),l=Math.tan(d)*Math.tan(d),k=n*Math.cos(d)*Math.cos(d),f=b/(.9996*c);b=d-c*Math.tan(d)/(g*(1-r)/Math.pow(1-r*Math.sin(d)*Math.sin(d),1.5))*(f*f/2-(5+3*l+10*k-4*k*k-9*n)*f*f*f*f/24+(61+90*l+298*k+45*l*l-252*n-3*k*k)*f*f*f*f*f*f/720);b=180*b/Math.PI;d=(f-(1+
2*l+k)*f*f*f/6+(5-2*k+28*l-3*k*k+8*n+24*l*l)*f*f*f*f*f/120)/Math.cos(d);d=6*(a-1)-180+3+180*d/Math.PI;a={};a.lat=b;a.lon=d;return a},USNGtoUTM:function(d,b,a,c,l,k){a=1+"ABCDEFGHJKLMNPQRSTUVWXYZ".indexOf(a)%8;var f="CDEFGHJKLMNPQRSTUVWX".indexOf(b);c=d%2?"ABCDEFGHJKLMNPQRSTUV".indexOf(c):"FGHJKLMNPQRSTUVABCDE".indexOf(c);c=Number([0,2,2,2,4,4,6,6,8,8,0,0,0,2,2,4,4,6,6,6][f])+c/10;c<[1.1,2,2.9,3.8,4.7,5.6,6.5,7.3,8.2,9.1,0,.8,1.7,2.6,3.5,4.4,5.3,6.2,7,7.9][f]&&(c+=2);f={};f.N=1E6*c+Number(k)*Math.pow(10,
5-k.length);f.E=1E5*a+Number(l)*Math.pow(10,5-l.length);f.zone=d;f.letter=b;return f},USNGtoLL:function(d){d=this.parseUSNG_str(d);var b=this.USNGtoUTM(d.zone,d.ltr,d.sq1,d.sq2,d.east,d.north);"N">d.ltr&&(b.N-=1E7);b=this.UTMtoLL(b.N,b.E,d.zone);return[b.lat,b.lon]},parseUSNG_str:function(d){var b=[];d=d.toUpperCase();b=/%20/g;b=d.replace(b,"");b=/ /g;b=d.replace(b,"");if(7>b.length)return 0;d={};var a=0;d.zone=10*b.charAt(a++)+1*b.charAt(a++);d.ltr=b.charAt(a++);d.sq1=b.charAt(a++);d.sq2=b.charAt(a++);
d.precision=(b.length-a)/2;d.east="";d.north="";for(var c=0;c<d.precision;c++)d.east+=b.charAt(a++);" "===b[a]&&a++;for(c=0;c<d.precision;c++)d.north+=b.charAt(a++);return d},isUSNG:function(d){d=d.toUpperCase();var b=/%20/g;d=d.replace(b,"");b=/ /g;d=d.replace(b,"");if(15<d.length)return 0;b=RegExp("^[0-9]{2}[CDEFGHJKLMNPQRSTUVWX]$");if(d.match(b))return 0;b=RegExp("^[0-9]{2}[CDEFGHJKLMNPQRSTUVWX][ABCDEFGHJKLMNPQRSTUVWXYZ][ABCDEFGHJKLMNPQRSTUV]([0-9][0-9]){0,5}");return!d.match(b)||7>d.length?0:
d},LLtoMGRS:function(d,b,a){return this.LLtoUSNG(d,b,a||5).replace(/ /g,"")},USNGtoPoint:function(d){d=this.USNGtoLL(d);return new I(d[1],d[0])},pointToUSNG:function(d,b){var a=d.getLatitude();d=d.getLongitude();return this.LLtoUSNG(a,d,b)},LLtoUSNG_nad27:function(d,b,a){return this.LLtoUSNG(d,b,a||5)+" (NAD27)"}}})},"widgets/GridOverlay/lib/NonPolarGridZone":function(){define("dojo/_base/declare dojo/json ./constants esri/geometry/Polygon esri/geometry/Polyline esri/geometry/Extent".split(" "),function(I,
g,r,n,m,d){return I(null,{extent:null,id:null,utmZone:null,latitudeZone:null,_rings:[],constructor:function(b){var a=b.id.match(/(\d+)|([A-Za-z]+)/g);this.id=b.id;this.utmZone=1*a[0];this.latitudeZone=a[1];this.extent=new d({xmin:b.xmin,ymin:b.ymin,xmax:b.xmax,ymax:b.ymax,spatialReference:b.spatialReference||{wkid:4326}});b=[this.extent.xmin,this.extent.ymin];this._rings=[[b,[this.extent.xmax,this.extent.ymin],[this.extent.xmax,this.extent.ymax],[this.extent.xmin,this.extent.ymax],b]]},toPolygon:function(b){var a=
g.parse(g.stringify(this._rings));if(b)for(var c=0;c<a[0].length;c++)a[0][c][0]+=b*r.GEOGRAPHIC_360;return new n({rings:a,spatialReference:this.spatialReference})},toPolyline:function(b){var a=g.parse(g.stringify(this._rings));if(b)for(var c=0;c<a[0].length;c++)a[0][c][0]+=b*r.GEOGRAPHIC_360;return new m({paths:a,spatialReference:this.spatialReference})}})})},"widgets/GridOverlay/lib/VisibleGridZone":function(){define(["dojo/_base/declare","./GridPolygon"],function(I,g){return I(null,{polyline:null,
polygon:null,offset:null,nonPolarGridZone:null,map:null,constructor:function(r){this.offset=Math.round(r.offset);this.polyline=r.polyline;this.polygon=r.polygon;this.nonPolarGridZone=r.nonPolarGridZone;this.map=r.map;r={clippedPolygon:this.polygon,unclippedPolygon:this.nonPolarGridZone.toPolygon(r.offset),map:this.map,xmin:this.nonPolarGridZone.extent.xmin,ymin:this.nonPolarGridZone.extent.ymin,xmax:this.nonPolarGridZone.extent.xmax,ymax:this.nonPolarGridZone.extent.ymax,minMaxType:"degrees",utmZone:0,
text:this.nonPolarGridZone.id,labelParameters:r.labelParameters};this.gridPolygon=new g(r)},getLabels:function(){return this.gridPolygon.getLabels(!0)},getCenterLabel:function(){return this.gridPolygon.getCenterLabel(!0)}})})},"widgets/GridOverlay/lib/GridPolygon":function(){define(["dojo/_base/declare","./mgrs","./labeling-utils","./LabelElement","esri/geometry/Point"],function(I,g,r,n,m){return I(null,{clippedPolygon:null,unclippedPolygon:null,map:null,xmin:0,ymin:0,xmax:0,ymax:0,minMaxType:"",
utmZone:0,text:"",color:null,labelParameters:null,_centerLabelSet:!1,_centerLabel:null,_labelsSet:!1,_labels:[],_cornerLabels:[],_borderLabels:[],_interiorLabels:[],candidatePoint:null,constructor:function(d){this.unclippedPolygon=d.unclippedPolygon;this.clippedPolygon=d.clippedPolygon;this.map=d.map;this.xmin=d.xmin;this.ymin=d.ymin;this.xmax=d.xmax;this.ymax=d.ymax;this.minMaxType=d.minMaxType;this.utmZone=Math.round(d.utmZone);this.text=d.text;this.labelParameters=d.labelParameters;this._cornerLabels=
[];this._borderLabels=[];this._interiorLabels=[];this._centerLabel=null;this._labelsSet=this._centerLabelSet=!1},getLabels:function(d){d=d||!1;this._labelsSet||(this._cornerLabels=this.setLabels(d),this._labelsSet=!0);d=0<this._cornerLabels.length?this._cornerLabels:0<this._borderLabels.length?this._borderLabels:this._interiorLabels;for(var b=0;b<d.length;b++)d[b]=d[b].getLabelGraphic();return d},getCenterLabel:function(d){this._centerLabelSet||(this.setCenterLabel(d),this._centerLabelSet=!0);return this._centerLabel.getLabelGraphic()},
setCenterLabel:function(d){d=d?this.clippedPolygon:this.unclippedPolygon;var b={xOffset:0,yOffset:0,rotation:0,color:this.labelParameters.color,fontFamily:this.labelParameters.fontFamily,fontSize:this.labelParameters.fontSize};this._centerLabel=new n({map:this.map,point:d.getCentroid(),labelParameters:b,text:this.text,verticalAlign:"middle",horizontalAlign:"middle"});b=new n({map:this._centerLabel.map,point:this._centerLabel.point,labelParameters:b,text:"utm"===this.minMaxType?"WW":"22W",verticalAlign:"middle",
horizontalAlign:"middle"});b.shrinkToFit(d,12);this._centerLabel.font.setSize(b.font.size);this._centerLabel.setExtent()},setLabels:function(d){d=d||!1;for(var b=this.clippedPolygon.rings,a=r.getScreenSize(this.clippedPolygon.getExtent(),this.map),c={xmin:Math.round(1E3*this.xmin)/1E3,ymin:Math.round(1E3*this.ymin)/1E3,xmax:Math.round(1E3*this.xmax)/1E3,ymax:Math.round(1E3*this.ymax)/1E3,map_xmin:this.map.extent.xmin,map_ymin:this.map.extent.ymin,map_xmax:this.map.extent.xmax,map_ymax:this.map.extent.ymax},
l,k,f={"lower-left":{label:null,priority:99,hidden:!1},"lower-right":{label:null,priority:99,hidden:!1},"upper-left":{label:null,priority:99,hidden:!1},"upper-right":{label:null,priority:99,hidden:!1}},e=0;e<b.length;e++){l=null;for(var h=0;h<b[e].length-1;h++){this.candidatePoint=new m(b[e][h],this.clippedPolygon.spatialReference);k=new m(b[e][h+1],this.clippedPolygon.spatialReference);if(0===h){var p=new m(b[e][b[e].length-2],this.clippedPolygon.spatialReference);l=this._findAngle(p,this.candidatePoint)}k=
this._findAngle(this.candidatePoint,k);if(k!==l&&(p="",0===k&&90===l?p="lower-right":270===k&&180===l?p="lower-right":0===k&&270===l?p="lower-left":90===k&&180===l?p="lower-left":90===k&&0===l?p="upper-left":180===k&&270===l?p="upper-left":180===k&&90===l?p="upper-right":270===k&&0===l&&(p="upper-right"),p)){l=this._findType(this.candidatePoint,c);var v=l.priority,t=new n({map:this.map,point:this.candidatePoint,labelParameters:this.labelParameters,text:this.text,verticalAlign:p.split("-")[0],horizontalAlign:p.split("-")[1]});
f[p].priority>v&&(f[p].label=t,f[p].priority=v,f[p].xOffset=l.xOffset,f[p].yOffset=l.yOffset)}l=k}}b=f["lower-left"];c=f["upper-left"];e=f["lower-right"];f=f["upper-right"];300>a.width&&(b.priority>e.priority&&(b.hidden=!0),e.priority>b.priority&&(e.hidden=!0),c.priority>f.priority&&(c.hidden=!0),f.priority>c.priority&&(f.hidden=!0));200>a.height&&(b.priority>c.priority&&(b.hidden=!0),e.priority>f.priority&&(e.hidden=!0),c.priority>b.priority&&(c.hidden=!0),f.priority>e.priority&&(f.hidden=!0));"utm"===
this.minMaxType&&(b.xOffset&&(b.label.xOffset=70),c.xOffset&&(c.label.xOffset=70),f.xOffset&&(f.label.xOffset=70),e.xOffset&&(e.label.xOffset=70),b.yOffset&&(b.label.yOffset=40),c.yOffset&&(c.label.yOffset=40),f.yOffset&&(f.label.yOffset=40),e.yOffset&&(e.label.yOffset=40));a=[];!b.hidden&&b.label&&a.push(b.label);!c.hidden&&c.label&&a.push(c.label);!f.hidden&&f.label&&a.push(f.label);!e.hidden&&e.label&&a.push(e.label);d=d?this.unclippedPolygon:this.clippedPolygon;for(f=0;f<a.length;f++)(new n({map:this.map,
point:a[f].point,labelParameters:this.labelParameters,text:"utm"===this.minMaxType?"WW":"22W",verticalAlign:a[f].verticalAlign,horizontalAlign:a[f].horizontalAlign})).fitsInPolygon(d)||(a.splice(f,1),f--);return a},_findXY:function(d){var b=d.getLongitude();d=d.getLatitude();"utm"===this.minMaxType?(d=g.LLtoUTM(d,b,this.utmZone),b=100*Math.round(d[0]/100),d=100*Math.round(d[1]/100),b%=1E6,d%=1E6):(b=Math.round(1E3*b)/1E3,d=Math.round(1E3*d)/1E3);return{x:b,y:d}},_findAngle:function(d,b){for(d=-(180*
Math.atan2(b.y-d.y,b.x-d.x)/Math.PI)+90;0>d;)d+=360;for(;360<=d;)d-=360;15>d||345<d?d=0:105>d&&75<d?d=90:195>d&&165<d?d=180:285>d&&255<d&&(d=270);return d},_findType:function(d,b){var a=this._findXY(this.candidatePoint),c=a.x;a=a.y;var l=!1,k=!1,f=0;d.x===b.map_xmin||d.x===b.map_xmax?(l=!0,f+=2):c===b.xmin||c===b.xmax?console.warn():f+=1;d.y===b.map_ymin||d.y===b.map_ymax?(k=!0,f+=2):a===b.ymin||a===b.ymax?console.warn():f+=1;return{priority:f,xOffset:l,yOffset:k}}})})},"widgets/GridOverlay/lib/LabelElement":function(){define("dojo/_base/declare ./geometry-utils ./labeling-utils esri/geometry/geometryEngine esri/geometry/screenUtils esri/graphic esri/geometry/Point esri/geometry/Extent esri/symbols/Font esri/symbols/TextSymbol".split(" "),
function(I,g,r,n,m,d,b,a,c,l){return I(null,{map:null,point:null,xOffset:0,yOffset:0,text:"",verticalAlign:"",horizontalAlign:"",rotation:0,color:null,fontFamily:"",fontSize:0,font:null,constructor:function(k){this.map=k.map;this.point=k.point;this.xOffset=k.labelParameters.xOffset||0;this.yOffset=k.labelParameters.yOffset||0;this.text=k.text;this.verticalAlign=k.verticalAlign||"bottom";this.verticalAlign.toLowerCase();this.horizontalAlign=k.horizontalAlign||"middle";this.horizontalAlign.toLowerCase();
this.rotation=k.labelParameters.rotation||0;this.rotation=90*Math.round(this.rotation/90);this.color=k.labelParameters.color;this.font=(new c).setFamily(k.labelParameters.fontFamily||"Arial, Helvetica, sans-serif").setSize(k.labelParameters.fontSize||0).setWeight(c.WEIGHT_BOLD)},getPixelWidth:function(){return 0!==this.rotation%180?this.font.size:r.getWidthOfText(this.text,this.font.family,this.font.size)},getPixelHeight:function(){return 0!==this.rotation%180?r.getWidthOfText(this.text,this.font.family,
this.font.size):this.font.size},decreaseFontSize:function(k){0!==this.font.size&&(this.font.setSize(this.font.size-(k||1)),this.setExtent())},setExtent:function(){var k=this.map,f=k.toScreen(this.point),e=this.getPixelWidth(),h=this.getPixelHeight()/1.3333;switch(this.horizontalAlign){case "left":f=f.offset(this.xOffset,0);var p=f.x;var v=f.x+e;break;case "middle":case "center":p=f.x-e/2;v=f.x+e/2;break;case "right":f=f.offset(-this.xOffset,0),p=f.x-e,v=f.x}switch(this.verticalAlign){case "bottom":case "lower":f=
f.offset(0,-this.yOffset);var t=f.y;var q=f.y-h;break;case "middle":case "center":t=f.y+h/2;q=f.y-h/2;break;case "upper":case "top":f=f.offset(0,this.yOffset),t=f.y+h,q=f.y}f=new a({xmin:p,ymin:t,xmax:v,ymax:q});this.extent=g.toWebMercator(m.toMapGeometry(k.extent,k.width,k.height,f))},getExtent:function(){this.extent||this.setExtent();return this.extent},fitsInPolygon:function(k){var f=this.getExtent();f=g.toWebMercator(f);k=g.toWebMercator(k);return n.contains(k,f)},fitsInExtent:function(k){var f=
this.getExtent();f=g.toWebMercator(f);k=g.toWebMercator(k);return n.contains(k,f)},shrinkToFit:function(k,f){f=f||0;!this.fitsInPolygon(k)&&0<this.font.size&&(this.font.setSize(this.font.size-1),this.font.size<f&&this.font.setSize(0),this.setExtent(),this.shrinkToFit(k,f))},getLabelGraphic:function(){var k=(new l(this.text)).setColor(this.color).setAlign(l.ALIGN_START).setFont(this.font),f=this.getExtent(),e=this.map.toScreen(this.point);f=this.map.toScreen(new b([f.xmin,f.ymin],f.spatialReference));
k.setOffset(f.x-e.x,-(f.y-e.y));return new d(this.point,k)}})})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z,B,E,F,A,C,G,H,N,M,R,S,U,Y,Z){g=g([Y,p,v],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:Z,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(J,O){J=J||{};J.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=J.map;this._hasUI=O?!0:!1;this.bingMapsKey=J.bingMapsKey&&0<J.bingMapsKey.length?J.bingMapsKey:null;this.showArcGISBasemaps=!1!==J.showArcGISBasemaps;this.basemaps=J.basemaps||[];this.basemapIds=J.basemapIds;this.referenceIds=J.referenceIds;this.basemapsGroup=J.basemapsGroup;this.arcgisUrl=t.dijit._arcgisUrl;J.portalUrl&&(this.arcgisUrl=J.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=w.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(m.hitch(this,function(J){this._supportsVTL=J}));r.forEach(this.basemaps,function(J){J.id&&0!==J.id.length||(J.id=this._getUniqueId());r.forEach(J.layers,function(O){O.opacity=0<=O.opacity?O.opacity:1;O.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&r.forEach(this.basemapIds,function(J){this.map.getLayer(J)._basemapGalleryLayerType="basemap"},
this);this.referenceIds&&0<this.referenceIds.length&&r.forEach(this.referenceIds,function(J){J=this.map.getLayer(J);J._basemapGalleryLayerType="reference";J.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(m.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(m.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?
this._refreshUI():n.connect(this,"onLoad",m.hitch(this,function(){this._refreshUI()}))},select:function(J){this._select(J)},getSelected:function(){return this._selectedBasemap},get:function(J){var O;for(O=0;O<this.basemaps.length;O++)if(this.basemaps[O].id===J)return this.basemaps[O];return null},add:function(J){return J&&!J.id?(J.id=this._getUniqueId(),this.basemaps.push(J),this._refreshUI(),this.onAdd(J),!0):J&&this._isUniqueId(J.id)?(this.basemaps.push(J),this._refreshUI(),this.onAdd(J),!0):!1},
remove:function(J){var O;for(O=0;O<this.basemaps.length;O++){var T=this.basemaps[O];if(T.id===J)return this._selectedBasemap&&this._selectedBasemap.id===T.id&&(this._selectedBasemap=null),this.basemaps.splice(O,1),this._refreshUI(),this.onRemove(T),T}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(J){},onRemove:function(J){},onError:function(J){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=
!0;this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(J){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,J):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(J))},_findArcGISBasemapsGroup:function(J){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(J);
else{var O=this.arcgisUrl+"/portals/self",T={f:"json"};T.culture=d.locale;u({url:O,content:T,callbackParamName:"callback",load:m.hitch(this,function(W,X){W&&W.useVectorBasemaps&&W.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(m.hitch(this,function(D){this._basemapGalleryGroupQuery=D?W.vectorBasemapGalleryGroupQuery:W&&W.basemapGalleryGroupQuery?W.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(J)})):(this._basemapGalleryGroupQuery=
W&&W.basemapGalleryGroupQuery?W.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(J))}),error:m.hitch(this,function(W,X){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(J){var O=m.hitch(this,"_findArcGISBasemaps"),T=this.arcgisUrl+"/community/groups",W={};W.q=this._basemapGalleryGroupQuery;W.f="json";u({url:T,content:W,callbackParamName:"callback",load:m.hitch(this,function(X,D){if(0<
X.results.length)O(X.results[0].id,J,X.results[0].sortField,X.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:m.hitch(this,function(X){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(J,O,T,W){var X=m.hitch(this,function(D,L,K,Q){var P=this.arcgisUrl+"/search",V={};V.q="group:"+D+' AND type:"web map" NOT type:"web mapping application"';V.sortField=K;V.sortOrder="asc"===Q?
"desc":"asc";V.num=100;V.f="json";u({url:P,content:V,callbackParamName:"callback",load:m.hitch(this,function(aa,ba){if(0<aa.results.length)L(aa.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:m.hitch(this,function(aa,ba){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});T&&W?X(J,O,T,W):u({url:this.arcgisUrl+"/community/groups/"+J,content:{f:"json"},callbackParamName:"callback",load:m.hitch(this,function(D,L){D.sortField?
X(J,O,D.sortField,D.sortOrder):X(J,O,"name","desc")}),error:m.hitch(this,function(D,L){X(J,O,"name","desc")})})},_handleArcGISBasemapsResponse:function(J){0<J.length&&(r.forEach(J,function(O,T){if(this.bingMapsKey||!this.bingMapsKey&&O.title&&-1===O.title.indexOf("Bing Maps")){T={};T.id=this._getUniqueId();T.title=O.title;T.thumbnailUrl="";if(O.thumbnail&&O.thumbnail.length&&(T.thumbnailUrl=this.arcgisUrl+"/content/items/"+O.id+"/info/"+O.thumbnail,t.id)){var W=t.id.findCredential(w.urlToObject(this.arcgisUrl).path);
W&&(T.thumbnailUrl+="?token\x3d"+W.token)}T.itemId=O.id;O=new U(T,this);this.basemaps.splice(0,0,O)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(e.empty(this.flowContainer),r.forEach(this.basemaps,function(J,O){J.id||(J.id="basemap_"+O);this.flowContainer.appendChild(this._buildNodeLayout(J))},this),e.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(J){var O=e.create("div",{id:"galleryNode_"+J.id,"class":"esriBasemapGalleryNode"}),
T=e.create("a",{href:"javascript:void(0);"},O);n.connect(T,"onclick",m.hitch(this,"_onNodeClick",J));var W=J.title||"";J.thumbnailUrl?e.create("img",{"class":"esriBasemapGalleryThumbnail",src:J.thumbnailUrl,title:W,alt:W},T):e.create("img",{"class":"esriBasemapGalleryThumbnail",src:I.toUrl("./images/transparent.gif"),title:W,alt:W},T);J=e.create("div",{"class":"esriBasemapGalleryLabelContainer"},O);e.create("span",{innerHTML:W,alt:W,title:W},J);return O},_onNodeClick:function(J,O){O.preventDefault();
this._markSelected(J);this.select(J.id)},_markSelected:function(J){J&&(r.forEach(d.query(".esriBasemapGallerySelectedNode",this.domNode),function(O){h.remove(O,"esriBasemapGallerySelectedNode")}),(J=f.byId("galleryNode_"+J.id))&&h.add(J,"esriBasemapGallerySelectedNode"))},_select:function(J){this._selectBasemapInProgress=!0;var O=this.get(J);O?(O.layers?this._getServiceInfos(O):(J=O.getLayers(this.arcgisUrl),m.isArray(J)?this._getServiceInfos(O):J.addCallback(m.hitch(this,function(T){this._getServiceInfos(O)}))),
this._markSelected(O)):this._selectBasemapInProgress=!1},_getServiceInfos:function(J){"https:"===location.protocol&&r.forEach(J.layers,function(T){if(this._isAgolService(T.url)||this._isHostedService(T.url))T.url=T.url.replace("http:","https:")},this);this._selectedBasemap=J;var O=[];r.forEach(J.layers,function(T){T.url&&0<T.url.length&&!T.isReference&&!T.type&&(T.deferredsPos=O.length,O.push(this._getServiceInfo(T.url)))},this);0<O.length?(new k(O)).addCallback(m.hitch(this,function(T){var W=null;
r.forEach(J.layers,function(X){if(0===X.deferredsPos||X.deferredsPos){X.serviceInfoResponse=T[X.deferredsPos][1];var D=X.serviceInfoResponse.fullExtent;D||(D=X.serviceInfoResponse.extent);W=W?W.union(new y(D)):new y(D)}},this);this.map.extent&&5>this._getIntersectionPercent(W,this.map.extent)&&this.map.setExtent(W,!0);this._switchBasemapLayers(J);this._updateReferenceLayer(J)})):(this._switchBasemapLayers(J),this._updateReferenceLayer(J))},_checkVTLSupport:function(){var J=new l;b("ie")?J.resolve(!1):
J.resolve(C.supported());return J},_switchBasemapLayers:function(J){var O=J.layers,T=!1,W,X,D;r.forEach(O,function(K){"VectorTileLayer"===K.type&&(T=!0)});if(T&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===O[0].type||O[0].type&&-1<O[0].type.indexOf("BingMaps")||"WebTiledLayer"===O[0].type||"VectorTileLayer"===
O[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{r.forEach(O,function(K){if(!K.isReference&&K.type&&-1<K.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var L=0;r.forEach(O,function(K,Q){if(!K.isReference){if("OpenStreetMap"===K.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var P=new B({id:"layer_osm",opacity:K.opacity})}else if(K.type&&-1<K.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}P=z.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===K.type?P=z.MAP_STYLE_AERIAL:"BingMapsRoad"===K.type&&(P=z.MAP_STYLE_ROAD);P=new z({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:P,
opacity:K.opacity})}else if("WebTiledLayer"===K.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}P=K.initialExtent||K.fullExtent;P=new A(K.templateUrl||K.url,{visible:K.visibility,opacity:K.opacity,copyright:K.copyright,fullExtent:K.fullExtent&&new y(K.fullExtent),initialExtent:P&&new y(P),subDomains:K.subDomains,tileInfo:K.tileInfo?
new G(K.tileInfo):null,tileServers:K.tileServers,wmtsInfo:K.wmtsInfo})}else if("VectorTileLayer"===K.type){P=new C(K.styleUrl,{visible:K.visibility,opacity:K.opacity});0===Q&&1<O.length&&this._removeBasemapLayers();var V=this;n.connect(P,"onLoad",m.hitch(this,function(aa,ba,la){var qa=V._sameSpatialReference(la.spatialReference,V.map.spatialReference);if(V.map.spatialReference&&!qa)V.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
else{if(0<V.map.getNumLevels()){if(qa=V._sameTilingScheme(la.tileInfo,V.map.__tileInfo),!qa){V.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(V.map.loaded){V.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===ba&&1===O.length&&V._removeBasemapLayers();la._basemapGalleryLayerType="basemap";V.map.addLayer(la,aa)}},
L,Q))}else if(K.serviceInfoResponse&&K.serviceInfoResponse.mapName){W=new x(K.serviceInfoResponse.spatialReference);X=this._sameSpatialReference(W,this.map.spatialReference);if(this.map.spatialReference&&!X){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===K.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(D=this._sameTilingScheme(K.serviceInfoResponse.tileInfo,this.map.__tileInfo),!D){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}}else if(!0===K.serviceInfoResponse.singleFusedMapCache&&-1<K.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}P=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===K.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(K):this._loadAsDynamic(K)}else if(K.serviceInfoResponse&&
K.serviceInfoResponse.pixelSizeX){W=new x(K.serviceInfoResponse.spatialReference);X=this._sameSpatialReference(W,this.map.spatialReference);if(this.map.spatialReference&&!X){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===K.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&(D=this._sameTilingScheme(K.serviceInfoResponse.tileInfo,this.map.__tileInfo),!D)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}K.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==K.type?P="Raster"===K.serviceInfoResponse.cacheType?new S(K.url,{serviceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility,bandIds:K.bandIds&&0<K.bandIds.length?K.bandIds:null}):new E(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility}):K.serviceInfoResponse.pixelSizeX?(P=new N,P.bandIds=K.bandIds,K.renderingRule?P.renderingRule=new R(K.renderingRule):!K.bandIds&&K.serviceInfoResponse.bandCount&&
3<parseInt(K.serviceInfoResponse.bandCount,10)&&(P.bandIds=[0,1,2]),P=new H(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility,imageServiceParameters:P})):(P=new M,P.format="png24",K.serviceInfoResponse.supportedImageFormatTypes&&-1<K.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(P.format="png32"),P=new F(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility,imageParameters:P}))}"VectorTileLayer"===K.type?L++:P&&(0===Q&&this._removeBasemapLayers(),
P._basemapGalleryLayerType="basemap",this.map.addLayer(P,L),L++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var J=this.map.layerIds,O=[];r.forEach(J,function(T){T=this.map.getLayer(T);"basemap"===T._basemapGalleryLayerType&&O.push(T)},this);0===O.length&&0<J.length&&O.push(this.map.getLayer(J[0]));0<O.length&&r.forEach(O,function(T){this.map.removeLayer(T)},this)},_updateReferenceLayer:function(J){var O;this._removeReferenceLayer();for(O=0;O<
J.layers.length;O++)!0===J.layers[O].isReference&&this._addReferenceLayer(J.layers[O])},_removeReferenceLayer:function(){var J;for(J=this.map.layerIds.length-1;0<=J;J--){var O=this.map.getLayer(this.map.layerIds[J]);"reference"===O._basemapGalleryLayerType&&this.map.removeLayer(O)}},_addReferenceLayer:function(J){"VectorTileLayer"===J.type?this._handleReferenceServiceInfoResponse(J):this._getServiceInfo(J.url,m.hitch(this,"_handleReferenceServiceInfoResponse",J))},_handleReferenceServiceInfoResponse:function(J,
O,T){J.serviceInfoResponse=O;if("VectorTileLayer"===J.type)var W=new C(J.styleUrl,{visible:J.visibility,opacity:J.opacity});else O&&O.mapName?W=!0===O.singleFusedMapCache?this._loadAsCached(J):this._loadAsDynamic(J):O&&O.pixelSizeX&&(J.serviceInfoResponse.singleFusedMapCache?W=new E(J.url,{resourceInfo:J.serviceInfoResponse,opacity:J.opacity,visible:J.visibility}):J.serviceInfoResponse.pixelSizeX?(T=new N,T.bandIds=J.bandIds,J.renderingRule?T.renderingRule=new R(J.renderingRule):!J.bandIds&&O.bandCount&&
3<parseInt(O.bandCount,10)&&(T.bandIds=[0,1,2]),W=new H(J.url,{resourceInfo:O,opacity:J.opacity,visible:J.visibility,imageServiceParameters:T})):(O=new M,O.format="png24",J.serviceInfoResponse.supportedImageFormatTypes&&-1<J.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(O.format="png32"),O.transparent=!0,W=new F(J.url,{resourceInfo:J.serviceInfoResponse,opacity:J.opacity,visible:J.visibility,imageParameters:O})));W&&(W._basemapGalleryLayerType="reference",W.attr("data-reference",
!0),this.map.addLayer(W))},_getServiceInfo:function(J,O){return u({url:J,content:{f:"json"},callbackParamName:"callback",load:function(T,W){O&&O(T,W)},error:m.hitch(this,function(T,W){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(J){var O=[];J.displayLevels||(O=r.map(J.serviceInfoResponse.tileInfo.lods,function(W){return W.level}));var T=null;J.exclusionAreas&&J.exclusionAreas.length&&(T=[],r.forEach(J.exclusionAreas,function(W){T.push({minZoom:W.minZoom,
maxZoom:W.maxZoom,minScale:W.minScale,maxScale:W.maxScale,geometry:new y(W.geometry)})}));return new E(J.url,{resourceInfo:J.serviceInfoResponse,opacity:J.opacity,visible:J.visibility,exclusionAreas:T,displayLevels:J.displayLevels||O})},_loadAsDynamic:function(J){var O=new F(J.url,{resourceInfo:J.serviceInfoResponse,opacity:J.opacity,visible:J.visibility});J.visibleLayers&&O.setVisibleLayers(J.visibleLayers);return O},_getIntersectionPercent:function(J,O){return(J=O.intersects(J))?(J=J.getWidth()*
J.getHeight(),O=O.getWidth()*O.getHeight(),J/O*100):0},_getIds:function(){var J=[];r.forEach(this.basemaps,function(O){J.push(O.id)},this);return J},_getUniqueId:function(){for(var J=","+this._getIds().toString()+",",O=0;;)if(-1<J.indexOf(",basemap_"+O+","))O++;else return"basemap_"+O},_isUniqueId:function(J){return-1===(","+this._getIds().toString()+",").indexOf(","+J+",")?!0:!1},_isAgolService:function(J){return J?-1!==J.indexOf("/services.arcgisonline.com/")||-1!==J.indexOf("/server.arcgisonline.com/"):
!1},_isHostedService:function(J){return J?-1!==J.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(J,O){return J&&O&&J.wkt==O.wkt&&(J.wkid===O.wkid||q.isDefined(J.latestWkid)&&J.latestWkid===O.wkid||q.isDefined(O.latestWkid)&&J.wkid===O.latestWkid||q.isDefined(J.latestWkid)&&J.latestWkid===O.latestWkid)||J&&O&&J.isWebMercator()&&O.isWebMercator()?!0:!1},_sameTilingScheme:function(J,O){var T=this.map;T=T.width>T.height?T.width:T.height;var W=!1,X=!1,D,L;for(D=0;D<J.lods.length;D++){var K=
J.lods[D].scale;J.dpi!==O.dpi&&(K=J.lods[D].scale/J.dpi);for(L=0;L<O.lods.length;L++){var Q=O.lods[L].scale;J.dpi!==O.dpi&&(Q=O.lods[L].scale/O.dpi);if(Math.abs(Q-K)/Q<1/T)if(W){X=!0;break}else W=!0;if(Q<K)break}if(X)break}return X||W&&(1===J.lods.length||1===O.lods.length)?!0:!1}});a("extend-esri")&&m.setObject("dijit.BasemapGallery",g,t);return g})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p){I=I(e,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(v){try{if(v=g.mixin({bingMapsKey:null,culture:"en-US"},v||{}),this.url=l.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=l.urlToObject(this.url),this.spatialReference=new k({wkid:102100}),this.tileInfo=new f({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new k({wkid:102100})),g.mixin(this,v),this.hasAttributionData=this.showAttribution,this._initLayer=g.hitch(this,this._initLayer),this._errorHandler=g.hitch(this,this._errorHandler),this._getTileInfo=g.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(t){throw this.onError(t),t;}},_unsetMap:function(v,t){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var v=this._url.path+"/Imagery/Metadata/"+this.mapStyle,t=window.location.protocol;if(this.bingMapsKey){var q=this.resourceInfo;!this.loaded&&q?this._initLayer(q):p({url:v,content:g.mixin({},{uriScheme:"https:"===t?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(v,t){if(200!==v.statusCode)t=Error(),t.code=v.statusCode,t.message=v.statusDescription,t.details=v.errorDetails,t.authenticationResultCode=v.authenticationResultCode,this.onError(t);else try{this.resourceInfo=r.toJson(v);var q=v.resourceSets[0].resources[0],w=q.imageUrl.replace("{","${");this.tileServers=n.map(q.imageUrlSubdomains,function(y){var x=l.getProtocolForWebResource();return b.substitute(w,{subdomain:y}).replace("http:",x)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var u=this.loadCallback;u&&(delete this.loadCallback,u(this))}}catch(y){this.onError(y)}},getAttributionData:function(){var v=new a,t=r.fromJson(this.resourceInfo),q;this.hasAttributionData&&t&&(q=g.getObject("resourceSets.0.resources.0.imageryProviders",!1,t));q?v.callback({contributors:q}):
(t=Error("Layer does not have attribution data"),t.log=m.isDebug,v.errback(t));return v},getTileUrl:function(v,t,q){return b.substitute(this.tileServers[t%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(v,t,q),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(v,t,q){var w="",u;for(u=v;0<u;u--){v="0";var y=1<<u-1;0!=(q&y)&&v++;0!=(t&y)&&(v++,v++);w+=v}return w},setMapStyle:function(v){this.mapStyle=v;this._getTileInfo()},setCulture:function(v){this.culture=v;this._getTileInfo()},
setBingMapsKey:function(v){this.bingMapsKey=v},onMapStyleChange:function(){}});g.mixin(I,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});d("extend-esri")&&g.setObject("virtualearth.VETiledLayer",I,c);return I})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h){function p(v,t){var q=[];if(v&&t&&(t.customLayerParameters||t.customParameters)){var w=g.clone(t.customParameters||{});g.mixin(w,t.customLayerParameters||{});v=l.urlToObject(v);for(var u in v.query)w.hasOwnProperty(u)||q.push(u+"\x3d"+v.query[u]);v=v.path+(q.length?"?"+q.join("\x26"):"")}return v}I=I(e,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(v,t){t||(t={});this.urlTemplate=v=p(v,t.wmtsInfo);var q=new f(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new k({wkid:102100})),w=new f(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new k({wkid:102100}));this.initialExtent=t.initialExtent||q;this.fullExtent=t.fullExtent||w;this.tileInfo=t.tileInfo?t.tileInfo:new h({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new k(this.tileInfo.spatialReference.toJson());this.copyright=t.copyright||"";var u=new n(v);q=u.scheme+"://"+u.authority+"/";this.urlPath=v.substring(q.length);this.tileServers=t.tileServers||[];-1===u.authority.indexOf("{subDomain}")&&
this.tileServers.push(q);if(t.subDomains&&0<t.subDomains.length&&1<u.authority.split(".").length){this.subDomains=t.subDomains;var y;r.forEach(t.subDomains,function(B){-1<u.authority.indexOf("${subDomain}")?y=u.scheme+"://"+d.substitute(u.authority,{subDomain:B})+"/":-1<u.authority.indexOf("{subDomain}")&&(y=u.scheme+"://"+u.authority.replace(/\{subDomain\}/gi,B)+"/");this.tileServers.push(y)},this)}this.tileServers=r.map(this.tileServers,function(B){"/"!==B.charAt(B.length-1)&&(B+="/");return B});
this._levelToLevelValue=[];var x=0;r.forEach(this.tileInfo.lods,function(B,E){this._levelToLevelValue[B.level]=B.levelValue||B.level;0===E&&(x=this._levelToLevelValue[B.level])},this);this._wmtsInfo=t.wmtsInfo;var z=g.hitch(this,function(){this.loaded=!0;this.onLoad(this)});m("chrome")?(v=this.getTileUrl(x,0,0),t=b.defaults.io,q="with-credentials"===t.useCors?l.canUseXhr(v,!0):-1,(t=-1<q?t.corsEnabledServers[q]:null)&&t.withCredentials?c({url:v,handleAs:"arraybuffer"}).addBoth(function(){z()}):z()):
z()},getTileUrl:function(v,t,q){v=this._levelToLevelValue[v];var w=this.tileServers[t%this.tileServers.length]+d.substitute(this.urlPath,{level:v,z:v,col:q,x:q,row:t,y:t});w=w.replace(/\{level\}/gi,v).replace(/\{row\}/gi,t).replace(/\{col\}/gi,q).replace(/\{z\}/gi,v).replace(/\{x\}/gi,q).replace(/\{y\}/gi,t);w=this._appendCustomLayerParameters(w);w=this.addTimestampToURL(w);return l.addProxy(w)},_appendCustomLayerParameters:function(v){var t;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var q=g.clone(this._wmtsInfo.customParameters||{});g.mixin(q,this._wmtsInfo.customLayerParameters||{});for(t in q)v+=(-1===v.indexOf("?")?"?":"\x26")+t+"\x3d"+encodeURIComponent(q[t])}return v}});m("extend-esri")&&g.setObject("layers.WebTiledLayer",I,a);return I})},"esri/layers/VectorTileLayer":function(){(function(){var I=function(){try{var r=window.WebGLRenderingContext}catch(c){r=!1}try{for(var n=document.createElement("canvas"),m=["webgl","experimental-webgl",
"webkit-3d","moz-webgl"],d=null,b=0;b<m.length;++b){try{d=n.getContext(m[b])}catch(c){}if(d)break}var a=d}catch(c){a=!1}return r&&a?!0:!1}(),g=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];I&&g.push("./VectorTileLayerImpl");define(g,function(r,n,m,d,b,a){b=a?a:b.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var c=new m;c.reject(Error("esri.layers.VectorTileLayer is not supported"));c.promise.otherwise(r.hitch(this,function(l){this._errorHandler(l)}))}});
b.ACCESS_TOKEN=null;b.supported=function(){return I};n("extend-esri")&&r.setObject("layers.VectorTileLayer",b,d);return b})})()},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(I,g,r,n,m,d){I=I(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,
mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(b){var a=this.bbox||this.extent;b=(a=a&&b&&a._normalize(!0))?a.spatialReference.wkid||r.toJson(a.spatialReference.toJson()):null;var c=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:b,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:c?c.wkid||r.toJson(c.toJson()):b,format:this.format,
interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?r.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?r.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?r.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};
b=this.timeExtent;a.time=b?b.toJson().join(","):null;return d.filter(a,function(l){if(null!==l&&void 0!==l)return!0})}});g.mixin(I,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});n("extend-esri")&&g.setObject("layers.ImageServiceParameters",I,m);return I})},"esri/layers/RasterXLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/function/StretchFunction ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z,B,E,F,A,C,G,H,N,M,R,S,U,Y,Z,J,O,T,W){var X=h.defaults.map.zoomDuration;I=I([W],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(D,L){L=L||{};this.tileMode=null!=L.tileMode?L.tileMode:this.tileMode;this.useWebGL=null!=L.useWebGL?
L.useWebGL:this.useWebGL;this.roaming=null!=L.roaming?L.roaming:this.roaming;this.drawMode=null!=L.drawMode?L.drawMode:this.drawMode;this.bandIds=L.bandIds&&0<L.bandIds.length?L.bandIds:null;this.renderer=L.renderer;this._customModules=L.customModules;this.useMapTime=null!=L.useMapTime?L.useMapTime:!0;if(L.multidimensionalDefinition&&0<L.multidimensionalDefinition.length){var K=new H;K.multidimensionalDefinition=L.multidimensionalDefinition.map(function(Q){return Q.toJson?Q:new N(Q)});K.method=H.METHOD_NONE;
this.mosaicRule=K}this.infoTemplate=L.infoTemplate;this.drawMode||(this._contextType=L._contextType||L.drawType);this._supportLegacyPropMethods=!1!==L.legacySupport;this._rasterHandler=new T({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(D,L);c(this,"load",g.hitch(this,function(){k(this._rasterHandler._connected||this._rasterHandler._connectionPromise,g.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,
raster:{rasterInfo:this.raster.rasterInfo,rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=g.hitch(this,this._animatePan2d)},setOpacity:function(D){this.opacity!==
D&&(this.opacity=D,this.onOpacityChange(D))},onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(D,L,K,Q){this._canDraw()&&(this.useWebGL||(K?this._context.clearRect(D,L,K,Q):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},
onResume:function(){this.inherited(arguments);this._toggleTime();v.show(this._div);if("css-transforms"===this._map.navigationMode){var D=this._map.__visibleDelta;this._left=this._tdx=D.x;this._top=this._tdy=D.y;a.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(g.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();
v.hide(this._div);clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var D=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?D&&(D.src||D.texture):D)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(D);else{this.tileManager.tiles.forEach(function(K){K&&(K.update=null,K.completed=!1,K.processedPixelBlock=null,K.renderedPixelBlock=null)});D.processedPixelBlock=
null;var L=this.raster.rasterFunction?this.raster.rasterFunction.read(D):{extent:D.extent,pixelBlock:D.src[this.tileManager.identifiers[0]]&&D.src[this.tileManager.identifiers[0]].pixelBlock};D.renderedPixelBlock=null;D=this._rasterRenderer?this._rasterRenderer.draw(L):L;this._drawOneFrame(D)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(D.processedPixelBlock=null,L=this.raster.rasterFunction?this.raster.rasterFunction.read(D):{extent:D.extent,pixelBlock:D.src?
D.src[this.tileManager.identifiers[0]]&&D.src[this.tileManager.identifiers[0]].pixelBlock:D.pixelBlock},D.renderedPixelBlock=null,D=this._rasterRenderer?this._rasterRenderer.draw(L):L,this._drawOneFrame(D))},getCurrentResolution:function(){var D=this._map.extent;return new A((D.xmax-D.xmin)/this._map.width,(D.ymax-D.ymin)/this._map.height,D.spatialReference)},getCustomRasterFields:function(D){var L=D?D.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,K={name:this._rasterFieldPrefix+"ServicePixelValue",
alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString"};D=this.fields?g.clone(this.fields):[];D.push(K);(K=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<K.length&&(K=n.filter(K,function(Q){return"esriFieldTypeOID"!==Q.type&&"value"!==Q.name.toLowerCase()}),K=n.map(K,function(Q){var P=g.clone(Q);P.name=L+Q.name;return P}),D=D.concat(K));return D},setRenderer:function(D,L){if(this.loaded&&D){if(D.declaredClass&&-1<
D.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=D;this._rasterRenderer.bind({layer:this});var K=this.bandIds=D.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:K});this._params&&(this._params.bandIds=K&&0<K.length?K.join(","):null);this.renderer=this._getCommonRenderer(D)}else K=g.clone(D.toJson?D.toJson():D),"rasterStretch"===K.type&&(K.bandIndex=this.bandIds,K.bandIndex&&1<K.bandIndex.length||!K.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(K.type=
"rgb"),this._rasterRenderer=Z.create(K),this.renderer=D.declaredClass?D:this._getCommonRenderer(this._rasterRenderer),this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var Q=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}L||(Q?Q.then(g.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(D,L){this.bandIds=D;this.raster&&this.raster.setFetchParameters({bandIds:D});
this._params&&(this._params.bandIds=D&&0<D.length?D.join(","):null);this.setRenderer(this.renderer,L)},_setTime:function(D){D=D?D.toJson():null;this._params&&(this._params.time=D);this.raster.setFetchParameters({time:D});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(D){this.infoTemplate=D;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(D,L){var K=D&&D.multidimensionalDefinition;if(K&&this.loaded){var Q=K&&K[0].variableName;
""===Q&&(Q=this._multidimensionalInfo.variables[0].name,K.forEach(function(V){V.variableName=Q}));if("ImageService"===this.raster.sourceType){var P=this.raster._getAllDimensionDefinition(K,Q);P.defChanged&&(D.multidimensionalDefinition=P.definition,this.setMosaicRule(D,!0))}this.raster.setFetchParameters({multidimensionalDefinition:K});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();Q&&this._updateRasterInfo(Q);L||this.refresh()}},_updateRasterInfo:function(D){var L=this.raster.rasterInfo,
K=this.getHistograms({variableName:D});D=this.getStatistics(D);(new f([K,D])).then(g.hitch(this,function(Q){Q[0][0]&&(L.histograms=Q[0][1].histograms);Q[1][0]&&(L.statistics=Q[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(D){if(D&&!(1>D.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var L,K;var Q=this.infoTemplate.info.fieldInfos;for(L=0;L<D.length;L++){var P=D[L];for(K=0;K<Q.length;K++)if(Q[K].fieldName.toLowerCase()===
P.name.toLowerCase()&&Q[K].fieldName!==P.name){Q[K].fieldName=P.name;break}}}},getPixelData:function(D){return this.tileMode?D?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(D){var L=new m;this.identify(D.geometry).then(function(K){var Q=K.pixelValue;this.hasStdTime()&&Q&&Q.length&&null!=Q[0]&&(Q=Q.map(function(aa){return this.getStdTimeValue(aa)}.bind(this)).join(", "));
if(Q){K={ObjectId:0,"Raster.ServicePixelValue":Q};var P=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(P&&0<P.length&&(P=n.filter(P,function(aa){if(aa&&aa.attributes)return aa.attributes.hasOwnProperty("Value")?aa.attributes.Value==Q:aa.attributes.VALUE==Q}),0<P.length&&(P=g.clone(P[0]))))for(var V in P.attributes)P.attributes.hasOwnProperty(V)&&(K[this._rasterFieldPrefix+V]=P.attributes[V]);V=new q(new E(this.projectedFullExtent||this.fullExtent),null,K);V.setInfoTemplate(this.infoTemplate);
V._layer=this;this._lastPopup=[V];L.resolve([V])}else this._lastPopup=[],L.resolve()}.bind(this),function(K){this._lastPopup=[];L.resolve(K)});return L},getPopupFromTiles:function(){return this._lastPopup},identify:function(D,L){return this.raster?this.raster.identify(D):(D=new m,D.reject("layer must be initialized to identify"),D.promise)},_getCommonRenderer:function(D){switch(D.rendererName){case "RGB":case "Stretch":return new y(D.toCommonRendererJson());case "UniqueValue":return new x(D.toCommonRendererJson());
case "ClassBreaks":return new u(D.toCommonRendererJson());case "Colormap":return new z(D.toCommonRendererJson());case "ShadedRelief":return new B(D.toCommonRendererJson())}},_getProjectedFullExtent:function(D){return this.raster.getProjectedFullExtent(D).then(g.hitch(this,function(L){this.projectedFullExtent=L}))},_initialize:function(D,L){L=L||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]=
{method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]={method:"onSpatialReferenceChange"});this.raster={};var K=L.raster?L.raster.url:D;K&&-1<K.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(K,L);var Q=g.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);
this.onLoad(this);var P=this._loadCallback;P&&(delete this._loadCallback,P(this))});(D?U.create(g.mixin({url:D},L)):L.raster&&L.raster.open()).then(g.hitch(this,function(P){if(P){this.raster=P;var V=this._getSourceImageServiceRaster();this.url||(this.url=V&&V.url);this.url&&(this._url=t.urlToObject(D));var aa=L.minScale,ba=L.maxScale,la=P.tileInfo&&"Raster"===P.tileInfo.tileType;null==ba&&(ba=la&&L.zoomFactor?P.tileInfo.lods[P.tileInfo.lods.length-1].scale/L.zoomFactor:this.maxScale);null==aa&&(aa=
la&&L.zoomFactor?P.tileInfo.lods[0].scale*L.zoomFactor:this.minScale);V&&"ImageService"===V.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(D,L);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new G(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;
this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=
this._defaultMultidimensionalDefinition);null==aa||this._hasMin||this.setMinScale(aa);null==ba||this._hasMax||this.setMaxScale(ba);this._workInitPromise?this._workInitPromise.then(Q,Q):Q()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var D=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(D&&"ImageService"===
D.sourceType)return D},_addLegacySupport:function(D,L){this._url=t.urlToObject(D);L=L||{};this.format=(D=L.imageServiceParameters)&&D.format;this.compressionTolerance=D&&D.compressionTolerance?D.compressionTolerance:.01;this.interpolation=D?D.interpolation:null;this.compressionQuality=D?D.compressionQuality:null;this.bandIds=D&&D.bandIds||L&&L.bandIds||null;this.mosaicRule||(this.mosaicRule=D?D.mosaicRule:null);this.renderingRule||(this.renderingRule=D?D.renderingRule:null);this.useMapDimensionValue=
L.hasOwnProperty("useMapDimensionValue")?!!L.useMapDimensionValue:!0;this.hasImageFilter=L.hasImageFilter;this.activeMapDimensions=L.activeMapDimensions;this._params=g.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},D?D.toJson():{});this.pixelFilter=L.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=g.hitch(this,this._queryVisibleRastersHandler);
this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var K={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},Q,P=new R;Object.keys(K).forEach(g.hitch(this,function(V){this[V]=g.hitch(this,function(aa,ba){Q=
{};Q[K[V]]=aa;this.raster&&(this.raster.setFetchParameters(Q),P[V].bind(this)(aa,ba))})}));this.setDisableClientCaching=function(V){P.setDisableClientCaching.bind(this)(V);var aa=this._getSourceImageServiceRaster();aa?aa.disableClientCaching=V:null}.bind(this);this.setDefinitionExpression=P.setDefinitionExpression.bind(this);this.setUseMapTime=P.setUseMapTime.bind(this);this._toggleTime=P._toggleTime.bind(this);this._onTimeExtentChangeHandler=P._onTimeExtentChangeHandler.bind(this);this.setPixelFilter=
P.setPixelFilter.bind(this);this.getHistograms=P.getHistograms.bind(this);this.getRasterFunctionInfos=P.getRasterFunctionInfos.bind(this);this.getKeyProperties=P.getKeyProperties.bind(this);this.getRasterAttributeTable=P.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=P.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=P._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=P._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=
P.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(V){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=P.getMultidimensionalInfo.bind(this);this.getColormap=P.getColormap.bind(this);this.getRenderingRuleColormap=P.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=P.getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultMultidimensionalDefinition=P._getDefaultMultidimensionalDefinition.bind(this);this._getDefaultDimensionValue=P._getDefaultDimensionValue.bind(this);this.getStatistics=P.getStatistics.bind(this)},_addGeneralProperties:function(){var D=this._getSourceImageServiceRaster();if(D){var L=["minScale","maxScale","tileInfo"];Object.keys(D.serviceInfo).forEach(function(P){null==this[P]&&-1===L.indexOf(P)&&(this[P]=D.serviceInfo[P])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);this.bands=D.rasterInfo.statistics;var K,Q=[];this.fields=this.fields||[];for(K=0;K<this.fields.length;K++)Q.push(new C(this.fields[K]));this.fields=Q;this.version=this.currentVersion;this.defaultMosaicRule=D.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var D=Z.createDefaultRenderer(this);if(null!=D){var L=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;
if(this._multidimensionalInfo&&L&&"Stretch"===D.rendererName){var K=this.mosaicRule.multidimensionalDefinition[0].variableName;(L=this._multidimensionalInfo.variables.filter(function(Q){return Q.name===K})[0])&&L.histograms&&L.histograms.length&&(D.histograms=L.histograms,6===D.stretchType&&(D.dra=!1));L&&L.statistics&&L.statistics.length&&(D.statistics=L.statistics.map(function(Q){return[Q.min,Q.max,Q.mean,Q.stddev||Q.standardDeviation]}),6!==D.stretchType&&(D.dra=!1))}this.setRenderer(D,!0)}}},
setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var D=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;if(D)switch(D.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{D=this.raster.dataType&&this.raster.dataType.toLowerCase();var L=!!this.raster.rasterInfo.colormap;
this.raster.rasterInfo.vat||L||"thematic"===D||"StdTime"===D?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(D,L){this.inherited(arguments);D.spatialReference&&
(D.spatialReference.ics||D.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=new J(null,{refTileInfo:D.tileInfo,spatialReference:D.spatialReference,extent:this.raster.rasterInfo.extent});var K=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};
this._tileParams.size=K.cols+","+K.rows;this.tileManager=new O({tileInfo:K,layer:this,mapSR:D.spatialReference})}this._dragOrigin={x:0,y:0};K=this._div=b.create("div",null,L);var Q={width:D.width+"px",height:D.height+"px",position:"absolute"};"css-transforms"===D.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(Q[e._css.names.transform]=e._css.translate(D.__visibleDelta.x,D.__visibleDelta.y),this._left=D.__visibleDelta.x,this._top=D.__visibleDelta.y):this._left=this._top=0;a.set(K,Q);this._canvas=
b.create("canvas",{width:D.width+"px",height:D.height+"px",style:"position: absolute;"},K);p.isDefined(this.opacity)&&a.set(K,"opacity",this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=!0);this._context||
console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(D.acquireWebGLContext(this),this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||this.setDefaultRenderer();
this.interpolation||this.setDefaultInterpolation();this._mapWidth=D.width;this._mapHeight=D.height;this._connects=[];this._connects.push(r.connect(D,"onPan",this,this._panHandler));this._connects.push(r.connect(D,"onPanEnd",this,this._panEndHandler));"css-transforms"===D.navigationMode?this._connects.push(r.connect(D,"onScale",this,this._onScaleHandler)):(this._connects.push(r.connect(D,"onZoom",this,this._onZoomHandler)),this._connects.push(r.connect(D,"onZoomEnd",this,this._onZoomEndHandler)));
this._connects.push(r.connect(D,"onResize",this,this._onResizeHandler));this._connects.push(r.connect(D,"onExtentChange",this,this._extentChangeHandler));this._connects.push(r.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(r.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:D.width,height:D.height};this.evaluateSuspension();if(this.suspended&&!D.loaded)var P=r.connect(D,"onLoad",this,function(){r.disconnect(P);
P=null;this.evaluateSuspension()});return K},_unsetMap:function(D,L){this.useWebGL&&D.releaseWebGLContext(this);n.forEach(this._connects,r.disconnect,this);var K=this._div;K&&(L.removeChild(K),b.destroy(K));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(D){"CancelError"!==D.name&&(this.clear(),
this.onError(D))},_clonePixelData:function(D){if(null===D||D.texture)return D;var L={};D.extent&&(L.extent=g.clone(D.extent));var K=D.pixelBlock;null!=K&&(L.pixelBlock=K.clone());L.texture=D.texture;return L},_setPixelData:function(D){if(D){D=this._clonePixelData(D);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(D)):this.pixelFilter(D));this.pixelData=D;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;this._drawPixelData()}this._rasterReadPromise=
null},_requestData:function(D,L,K){this._rasterReadPromise&&this._rasterReadPromise.cancel();D=g.clone(D)._normalize(!0);this._rasterReadPromise=this.raster.read({extent:D,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(g.hitch(this,function(Q){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=Q&&Q.srcData?{extent:Q.extent,src:Q.srcData}:Q,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!0),this._setPixelData(Q))}),g.hitch(this,
this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(D){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top)),a.set(this._canvas,e._css.names.transform,
e._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);if(this._canDraw()&&this.drawMode&&this.drawMode&&(D=D||this.pixelData)&&D.pixelBlock){var L=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(D):D;D=L.pixelBlock;var K=this._context,Q=K.createImageData(D.width,D.height);Q.data.set(D.getAsRGBA());L=L.extent;var P=this._map.extent,V=this.getCurrentResolution(),aa=0,ba=0;Math.abs(L.xmin-
P.xmin)>V.x&&(aa=Math.round((L.xmin-P.xmin)/V.x));Math.abs(P.ymax-L.ymax)>V.y&&(ba=Math.round((P.ymax-L.ymax)/V.y));"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top)),a.set(this._canvas,e._css.names.transform,e._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,
{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(aa,ba,D.width,D.height):this.clear();K.putImageData(Q,aa,ba,0,0,D.width,D.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var D=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition;D=D&&D.length?D[0]:this._defaultMultidimensionalDefinition[0];var L=this.raster.rasterInfo.multidimensionalInfo.variables,
K=D?D.variableName:L[0].name;return L.some(function(Q){if(Q.name===K)return!Q.dimensions||0===Q.dimensions.length||Q.dimensions.some(function(P){return"StdTime"===P.name})})},getStdTimeValue:function(D){return(new Date(864E5*(D-25569))).toString()},computeHistograms:function(D){D=new m;var L=this.getPixelData(!0);if(L&&L.pixelBlock&&L.pixelBlock.pixels&&((new S({}))._calculateStatisticsHistograms(L),L.pixelBlock.histograms))return D.resolve({histograms:L.pixelBlock.histograms}),D;D.reject();return D},
_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(D,L){return this.tileManager.updateTile(D,
!0).then(g.hitch(this,function(K){(this._hasTilingEffects||this.useWebGL||L)&&this._drawOneFrame(K)}))},_drawOneFrame:function(D,L){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||this._levelChange)this._levelChange=
!1,this._resetDrawing();if(D&&(D.renderedPixelBlock||D.pixelBlock)&&this._canDraw()&&this.drawMode){L=D.extent;var K=this._map.extent;if(!this._isExtentOutSide(L,K)){var Q=D.pixelBlock||D.renderedPixelBlock,P=this._context,V=P.createImageData(Q.width,Q.height);V.data.set((D.renderedPixelBlock||D.pixelBlock).getAsRGBA());D=this.getCurrentResolution();var aa=0,ba=0;Math.abs(L.xmin-K.xmin)>D.x&&(aa=Math.round((L.xmin-K.xmin)/D.x));Math.abs(K.ymax-L.ymax)>D.y&&(ba=Math.round((K.ymax-L.ymax)/D.y));P.putImageData(V,
aa,ba,0,0,Q.width,Q.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(D,L){return D.xmax<=L.xmin||D.xmin>=L.xmax||D.ymax<=L.ymin||D.ymin>=L.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var D=this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(D,this._startRect.left,this._startRect.top)}this._dragOrigin=
{x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top)),a.set(this._canvas,e._css.names.transform,e._css.translate(-this._left,
-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var D=this._frames,L=0,K;for(K=0;K<D.length;K++)if(D[K].completed)L++;else if(D[K].tileData.renderedPixelBlock){D[K].completed=!0;var Q=D[K].tileData;break}else if(D[K].tileData._fetched&&
!D[K].tileData.src){D[K].completed=!0;break}else if(D[K].tileData.update&&D[K].tileData.update.isFulfilled()&&!D[K].tileData.renderedPixelBlock){D[K].completed=!0;break}else D[K].tileData.fetch&&(!0===D[K].tileData.fetch||D[K].tileData.fetch.isCanceled()||D[K].tileData.fetch.isRejected())?(D[K].completed=!0,L++):this._isExtentOutSide(D[K].tileData.extent,this._map.extent)&&(D[K].completed=!0,L++);if(Q){L++;var P=Q.extent,V=this._map.extent,aa=this.getCurrentResolution(),ba=K=0;Math.abs(P.xmin-V.xmin)>
aa.x&&(K=Math.round((P.xmin-V.xmin)/aa.x));Math.abs(V.ymax-P.ymax)>aa.y&&(ba=Math.round((V.ymax-P.ymax)/aa.y));Q.renderedPixelBlock?(P=Q.renderedPixelBlock,V=this._context.createImageData(P.width,P.height),V.data.set(Q.renderedPixelBlock.getAsRGBA()),this._context.putImageData(V,K,ba,0,0,P.width,P.height)):this.clear(K,ba,Q.width,Q.height)}L===D.length?(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(g.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=
requestAnimationFrame(g.hitch(this,this._drawAllFrames))},_fetchTiles:function(D,L){if(!this.suspended&&this.loaded){this._cancelAnimation();var K=this.tileManager,Q=!(K.xformSetting.requireProjection&&K.xformSetting.requirePE)||Y.load();k(Q,g.hitch(this,function(){K.updateExtent(D,this.getCurrentResolution());this._resetCss=!1;K.fetchTiles(L);L&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<K.tiles.length?(K.fillupTiles(),K._validateRawPixelBlocks(K.originalPixelData)?this._updateAllTilesOnce(K.originalPixelData):
K.originalPixelData&&K.originalPixelData.src&&K.tiles.some(function(P){return P.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),K.tiles.forEach(g.hitch(this,function(P){P.update&&!P.updateCompleted&&P.update.then(function(V){P.updateCompleted||(P.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&this._drawOneFrame(V)}.bind(this))}))):this._hasTilingEffects&&k(K.fetchAllCompleted.isResolved()||K.fetchAllCompleted,g.hitch(this,function(){this._updateAllTilesOnce(K.originalPixelData)})):
(this._frames=K.tiles.map(function(P){return{completed:!1,tileData:P}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(D,L){this._drawTile=!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=L,!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+L.x,this._top=this._map.__visibleDelta.y+L.y,
a.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+L.x+"px",top:this._startRect.top+L.y+"px"});this.tileMode&&this._fetchTiles(D)},_panEndHandler:function(D,L){L&&(this._startRect.left+=L.x,this._startRect.top+=L.y);this.oldData=null;this._roamingAnimation&&(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(D,L){var K={},Q=e._css.names;a.set(this._canvas,Q.transition,
L?"none":Q.transformName+" "+X+"ms ease");this._matrix=D;D=this._multiply?l.multiply(D,this._multiply):D;if(this._tdx||this._tdy)D=l.multiply(D,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});K[Q.transform]=e._css.matrix(D);a.set(this._canvas,K)},_onZoomHandler:function(D,L,K){var Q=this._startRect;D=Q.width*L;L*=Q.height;var P=Q.left-(D-Q.width)*(K.x-Q.left)/Q.width;K=Q.top-(L-Q.height)*(K.y-Q.top)/Q.height;a.set(this._canvas,{left:P+"px",top:K+"px",width:D+"px",height:L+"px"});this._endRect=
{left:P,top:K,width:D,height:L}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(D,L,K){a.set(this._div,{width:L+"px",height:K+"px"});a.set(this._canvas,{width:L+"px",height:K+"px"});this._startRect.width=this._canvas.width=L;this._startRect.height=this._canvas.height=K;this.useWebGL&&this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(D,L,K,Q){if(this.loaded&&!this.suspended&&(!L||0!==
L.x||0!==L.y||K)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(L&&(this._dragOrigin.x+=L.x,this._dragOrigin.y+=L.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&this.tileMode&&this.useWebGL||K||a.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top)),K&&(a.set(this._canvas,e._css.names.transition,"none"),this._multiply=this._multiply?l.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();
var P=this._map;L=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(aa){return aa._rasterId}):[this.raster._rasterId];var V={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||(L.forEach(function(aa,ba){V[aa]={extent:P.extent,pixelBlock:new M({width:P.width,height:P.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}),this.tileManager.originalPixelData={extent:P.extent,src:V}),this.projectedFullExtent?this._fetchTiles(D,!0):this._getProjectedFullExtent(P.spatialReference).then(g.hitch(this,
function(){this._fetchTiles(D,!0)}))):this._requestData(P.extent,P.width,P.height)}},_visibilityChangeHandler:function(D){D?v.show(this._div):v.hide(this._div)},_opacityChangeHandler:function(D){a.set(this._div,"opacity",D)}});d("extend-esri")&&g.setObject("layers.RasterXLayer",I,e);return I})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(I,g,r,n,m,d,b){return I([r,b],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,
5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=
a.raster.histograms);this.rasterInfo=g.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?
a.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments,l=c.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l;else{var k=a.pixelBlock,f=k.pixels.length,e=6===c.stretchType&&(c.dra||!l)||3===c.stretchType&&c.dra;e&&(k.statistics||k.calculateStatistics(),this._calculateStatisticsHistograms(a));
if(c.dra)if(k.statistics||k.calculateStatistics(),e)this._statistics=k.statistics,this._histograms=k.histograms;else for(c=k.statistics,this._statistics=[],a=0;a<f;a++)this._statistics[a]=[c[a].minValue,c[a].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:
this.srcStatistics,this._histograms=l,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var c=[],l;for(l=0;l<a.length;l++)c[l]=1<a[l]?2<a[l]?6.5+Math.pow(a[l]-2,2.5):6.5+100*Math.pow(2-a[l],4):1;return c}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,
l=c.pixels;c=c.width*c.height;var k=l.length,f,e;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var h=this.LUT,p=this.LUTOffset;for(f=0;f<k;f++){var v=h[f];for(e=0;e<c;e++){var t=l[f][e];l[f][e]=v[t-p]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var c=a.pixelType,l=a.pixels,k=a.mask,f=l.length,e,h,p=function(E){this.min=-.5;this.max=255.5;this.size=256;g.mixin(this,E);this.counts=this.counts||new Uint32Array(this.size)},v=[],t,q;for(e=
0;e<f;e++){var w=new p;var u=w.counts;var y=l[e];if("U8"===c)if(k)for(h=0;h<a.width*a.height;h++)k[h]&&u[y[h]]++;else for(h=0;h<a.width*a.height;h++)u[y[h]]++;else{var x=a.statistics[e].minValue;var z=a.statistics[e].maxValue;w.min=x;w.max=z;z=(z-x)/256;var B=new Uint32Array(257);if(k)for(h=0;h<a.width*a.height;h++)k[h]&&B[Math.floor((y[h]-x)/z)]++;else for(h=0;h<a.width*a.height;h++)B[Math.floor((y[h]-x)/z)]++;for(h=0;255>h;h++)u[h]=B[h];u[255]=B[255]+B[256]}v.push(w);y=[];x=a.statistics[e].minValue;
z=a.statistics[e].maxValue;for(h=q=t=B=0;h<w.size;h++)B+=u[h],t+=h*u[h];t/=B;for(h=0;h<w.size;h++)q+=u[h]*Math.pow(h-t,2);u=Math.sqrt(q/(B-1));h=(t+.5)*(w.max-w.min)/w.size+w.min;w=u*(w.max-w.min)/w.size;y.push(x);y.push(z);y.push(h);y.push(w);a.statistics[e]={min:x,minValue:x,max:z,maxValue:z,mean:h,stddev:w}}a.histograms=v},_getCutOffPoints:function(a){var c=this.functionArguments,l=999;a&&a.pixelBlock?l=a.pixelBlock.pixels.length:a&&a.texture&&(l=3);a=Math.min(l,this._statistics.length);var k=
[],f=[],e,h;switch(c.stretchType){case 5:for(e=0;e<a;e++)k[e]=this._statistics[e][0],f[e]=this._statistics[e][1];break;case 3:for(e=0;e<a;e++)k[e]=this._statistics[e][2]-c.numberOfStandardDeviations*this._statistics[e][3],f[e]=this._statistics[e][2]+c.numberOfStandardDeviations*this._statistics[e][3],k[e]<this._statistics[e][0]&&(k[e]=this._statistics[e][0]),f[e]>this._statistics[e][1]&&(f[e]=this._statistics[e][1]);break;case 6:for(e=0;e<a;e++){l=this._histograms[e];var p=new Uint32Array(l.size);
var v=l.counts;var t=0;var q=-.5===l.min&&1===(l.max-l.min)/v?.5:0;for(h=0;h<l.size;h++)t+=v[h],p[h]=t;v=c.minPercent*t/100;for(h=0;h<l.size;h++)if(p[h]>v){k[e]=l.min+(l.max-l.min)/l.size*(h+q);break}v=(1-c.maxPercent/100)*t;for(h=l.size-2;0<=h;h--)if(p[h]<v){f[e]=l.min+(l.max-l.min)/l.size*(h+2-q);break}}break;default:for(e=0;e<l;e++)k[e]=0,f[e]=255}return{minCutOff:k,maxCutOff:f}},_createLUT:function(a){var c=this.functionArguments,l=a.pixelBlock,k=l.pixelType;if("U8"===k||"U16"===k||"S8"===k||
"S16"===k){if(this._LUTSignature&&(k=this._computeLutSignature(),k.length===this._LUTSignature.length&&!k.some(function(F,A){return F!==this._LUTSignature[A]}.bind(this))))return;k=l.pixels.length;var f=[],e=[],h=c.max,p=c.min,v=c.gamma,t=h-p,q=this._getCutOffPoints(a);a=q.minCutOff;q=q.maxCutOff;var w=0,u=256;"S8"===l.pixelType?w=-127:"S16"===l.pixelType&&(w=-32767);if("U16"===l.pixelType||"S16"===l.pixelType)u=65536;for(l=0;l<k;l++)f[l]=q[l]-a[l];var y=this._gammaCorrection;if(c.useGamma)for(l=
0;l<k;l++){var x=[];for(c=0;c<u;c++){var z=c+w;var B=(z-a[l])/f[l];var E=1;1<v[l]&&(E-=Math.pow(1/t,B*y[l]));z<q[l]&&z>a[l]?x[c]=Math.floor(E*t*Math.pow(B,1/v[l]))+p:z>q[l]?x[c]=h:z<a[l]&&(x[c]=p)}e[l]=x}else for(l=0;l<k;l++){x=[];for(c=0;c<u;c++)z=c+w,x[c]=z<a[l]?p:z>q[l]?h:Math.floor((z-a[l])/f[l]*t)+p;e[l]=x}this.LUT=e;this.LUTOffset=w;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,c=[],l,k;c.push(a.stretchType);c.push(a.min);c.push(a.max);
c.push(a.numberOfStandardDeviations);if(this._statistics)for(l=0;l<this._statistics.length;l++)for(k=0;k<this._statistics[l].length;k++)c.push(this._statistics[l][k]);c.push(a.dra?1:0);c.push(a.minPercent);c.push(a.maxPercent);if(a.gamma)for(l=0;l<this._statistics.length;l++)c.push(a.gamma[l]);c.push(a.useGamma?1:0);return c},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=this.functionArguments,l=a.pixelBlock,k=l.pixels,f=l.mask;l=l.width*l.height;var e=
k.length,h=[],p=[],v=c.max,t=c.min,q=c.gamma,w=v-t;var u=this._getCutOffPoints(a);var y=u.minCutOff,x=u.maxCutOff;for(u=0;u<e;u++)h[u]=x[u]-y[u];if(c.useGamma&&null!==q&&q.length>=e)for(u=0;u<e;u++)p[u]=1<q[u]?2<q[u]?6.5+Math.pow(q[u]-2,2.5):6.5+100*Math.pow(2-q[u],4):1;if(c.useGamma)if(void 0!==f&&null!==f)for(c=0;c<l;c++){if(f[c])for(u=0;u<e;u++){var z=k[u][c];var B=(z-y[u])/h[u];var E=1;1<q[u]&&(E-=Math.pow(1/w,B*p[u]));z<x[u]&&z>y[u]?k[u][c]=Math.floor(E*w*Math.pow(B,1/q[u]))+t:z>x[u]?k[u][c]=
v:z<y[u]&&(k[u][c]=t)}}else for(c=0;c<l;c++)for(u=0;u<e;u++)z=k[u][c],B=(z-y[u])/h[u],E=1,1<q[u]&&(E-=Math.pow(1/w,B*p[u])),z<x[u]&&z>y[u]?k[u][c]=Math.floor(E*w*Math.pow(B,1/q[u]))+t:z>x[u]?k[u][c]=v:z<y[u]&&(k[u][c]=t);else if(void 0!==f&&null!==f)for(c=0;c<l;c++){if(f[c])for(u=0;u<e;u++)z=k[u][c],z<x[u]&&z>y[u]?k[u][c]=Math.floor((z-y[u])/h[u]*w)+t:z>x[u]?k[u][c]=v:z<y[u]&&(k[u][c]=t)}else for(c=0;c<l;c++)for(u=0;u<e;u++)z=k[u][c],z<x[u]&&z>y[u]?k[u][c]=Math.floor((z-y[u])/h[u]*w)+t:z>x[u]?k[u][c]=
v:z<y[u]&&(k[u][c]=t);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var c=this._statistics.length,l,k=[];for(l=0;l<c;l++){var f=this._statistics[l][2];"U8"!==a&&(f=255*(f-this._statistics[l][0])/(this._statistics[l][1]-this._statistics[l][0]));k.push(this._computeGammaValue(f))}return k},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var c=0;0<a&&150!=a&&255>a&&(c=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));c=Math.log((a+c)/255);if(0!==c&&(a=Math.log(a/255)/
c,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,l,k=a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,f=a.pixelBlock,e=this.gl,h=e.drawingBufferWidth,p=e.drawingBufferHeight;if(!f&&this.functionArguments.dra){var v=new Float32Array(h*p*4),t=new Uint8Array(h*p);var q=new Float32Array(h*p);var w=new Float32Array(h*p);var u=
new Float32Array(h*p);e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE&&e.readPixels(0,0,h,p,e.RGBA,e.FLOAT,v);for(l=0;l<h*p;l++)q[l]=v[4*l],w[l]=v[4*l+1],u[l]=v[4*l+2],t[l]=v[4*l+3];a.pixelBlock=new n({width:h,height:p,pixels:[q,w,u],mask:t});a.pixelBlock.calculateStatistics()}!f&&this.functionArguments.dra&&this._useGPUStats?(q=new Float32Array(k),w=new Float32Array(k)):(this._updateStatistisHistograms(a),v=this._getCutOffPoints(a),q=new Float32Array(k),w=new Float32Array(k),q.set(v.minCutOff.slice(0,
k)),w.set(v.maxCutOff.slice(0,k)));this._initializeProgram({fragment:d.stretch,fragmentName:"Stretch"});v=this._setupTextureData(a);t=this.bindFrameBuffer();this.renderTexture=!1;this._performance.start();if(!f&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[h,p],u_bandCount:k});if(1===k)var y=this._readMinMax(v,2);else{y=this._readMinMax(v,0);var x=this._readMinMax(v,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)l=
this._readHistogram(y,x,a),q=l.minCutOff||q,w=l.minCutOff||w}u=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(k);for(l=0;l<k;l++)a[l]=u/(w[l]-q[l]);this._useGPUStats&&this._initializeProgram({fragment:d.stretch,fragmentName:"Stretch"});e.blendFunc(e.SRC_ALPHA,e.ZERO);u=new Float32Array(3);var z=new Float32Array(3);for(l=0;3>l;l++)u[l]=this.functionArguments.min,z[l]=this.functionArguments.max;l=this.functionArguments.useGamma;var B=this.functionArguments.gamma,E=this._gammaCorrection;
Array.isArray(B)&&B.length>=k||(l=!1);this._setUniforms({u_sourceDim:[h,p],u_bandCount:k,u_minOutput:u,u_maxOutput:z,u_minCutOff:q,u_maxCutOff:w,u_factor:a,u_state:100,u_useGamma:l,u_gamma:B,u_scaled:!c,u_gammaCorrection:E,u_minMaxTexture:!f&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;e.viewport(0,0,h,p);this._bindTexture(v.texture,"u_image");!f&&this.functionArguments.dra&&this._useGPUStats&&(c=e.getUniformLocation(this.rasterProgram,"u_image1"),e.uniform1i(c,1),e.activeTexture(e.TEXTURE1),
e.bindTexture(e.TEXTURE_2D,y.texture),1<k&&(k=e.getUniformLocation(this.rasterProgram,"u_image2"),e.uniform1i(k,2),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,x.texture)));this._drawGL();return{extent:v.extent,texture:t.texture}},_readMinMax:function(a,c){var l=this.gl,k=a.width||l.drawingBufferWidth,f=a.height||l.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var e=a.texture;for(l.activeTexture(l.TEXTURE0);1<k||1<f;){var h=this._createTexture();c=Math.max(Math.ceil(k/
2),1);var p=Math.max(Math.ceil(f/2),1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,c,p,0,l.RGBA,l.FLOAT,null);a=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,a);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,h,0);l.viewport(0,0,c,p);l.bindTexture(l.TEXTURE_2D,e);this._setUniforms({u_sourceDim:[k,f]});k=c;f=p;this._drawGL(!0);e=h}a=new Float32Array(k*f*4);l.checkFramebufferStatus(l.FRAMEBUFFER)==l.FRAMEBUFFER_COMPLETE&&l.readPixels(0,0,k,f,
l.RGBA,l.FLOAT,a);return{texture:h,minmax:a}},_readHistogram:function(a,c,l){if(a)try{var k=this.gl,f=k.drawingBufferWidth,e=k.drawingBufferHeight,h,p,v;if(a.texture instanceof WebGLTexture){var t=!0;var q=[1,0,0,1];if(c){var w=a.minmax;var u=c.minmax}else w=[a.minmax[0]],u=[a.minmax[1]]}else for(u=c,w=a,q=new Float32Array(u.length),h=0;h<u.length;h++)q[h]=256/(u[h]-w[h]);var y=new Float32Array(f*e);for(v=0;v<y.length;v++)y[v]=v;if(!this.histogramProgram){var x=m.getShader(k,m.histogram),z=d.getShader(k,
d.constant);this.histogramProgram=this._loadProgram(x,z)}k.blendFunc(k.ONE,k.ONE);k.enable(k.BLEND);k.useProgram(this.histogramProgram);var B=k.getAttribLocation(this.histogramProgram,"a_pixelIndex"),E=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,E);k.bufferData(k.ARRAY_BUFFER,y,k.STATIC_DRAW);k.enableVertexAttribArray(B);k.vertexAttribPointer(B,1,k.FLOAT,!1,0,0);var F=this._setupHistTexture(l),A=this._createTexture();k.getExtension("OES_texture_float");k.texImage2D(k.TEXTURE_2D,0,k.RGBA,257,1,0,
k.RGBA,k.FLOAT,null);var C=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,C);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,A,0);k.viewport(0,0,257,1);var G=k.getUniformLocation(this.histogramProgram,"u_image");k.uniform1i(G,0);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,F);var H=k.getUniformLocation(this.histogramProgram,"u_sourceDim");k.uniform2f(H,f,e);var N=k.getUniformLocation(this.histogramProgram,"u_bandCount");k.uniform1i(N,3);var M=k.getUniformLocation(this.histogramProgram,
"u_halfPixel");k.uniform2f(M,.5/f,.5/e);var R=k.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(t){k.uniform1i(R,1);var S=k.getUniformLocation(this.histogramProgram,"u_image1");k.uniform1i(S,1);k.activeTexture(k.TEXTURE1);k.bindTexture(k.TEXTURE_2D,a.texture);if(c){var U=k.getUniformLocation(this.histogramProgram,"u_image2");k.uniform1i(U,2);k.activeTexture(k.TEXTURE2);k.bindTexture(k.TEXTURE_2D,c.texture)}}else{var Y=k.getUniformLocation(this.histogramProgram,"u_mins");k.uniform4f(Y,
w[0],w[0],w[0],w[0]);k.uniform1i(R,0)}var Z=k.getUniformLocation(this.histogramProgram,"u_color"),J=k.getUniformLocation(this.histogramProgram,"u_factors"),O=k.getUniformLocation(this.histogramProgram,"u_size");k.uniform1f(O,256);a=[];c=[];k.uniform4fv(Z,[1,0,0,1]);k.uniform4fv(J,[q[0],0,0,1]);k.drawArrays(k.POINTS,0,y.length);var T=this.sourceRasterInfo.raster.bandCount;1<T&&(k.uniform4fv(Z,[0,1,0,1]),k.uniform4fv(J,[0,q[0],0,1]),k.drawArrays(k.POINTS,0,y.length),k.uniform4fv(Z,[0,0,1,1]),k.uniform4fv(J,
[0,0,q[0],1]),k.drawArrays(k.POINTS,0,y.length));if(k.checkFramebufferStatus(k.FRAMEBUFFER)==k.FRAMEBUFFER_COMPLETE){var W=new Float32Array(1028);k.readPixels(0,0,257,1,k.RGBA,k.FLOAT,W);k=0;var X=-.5===w[0]&&1===(u[0]-w[0])/256?.5:0;for(h=0;h<T;h++){var D=new Float32Array(257);var L=new Float32Array(257);for(v=k=0;256>v;v++)k+=W[4*v+h],D[v]=k,L[v]=W[4*v+h];L[256]=W[1024+h];D[256]=k+W[1024+h];var K=this.functionArguments.minPercent*k/100;if(u){for(p=0;256>p;p++)if(D[p]>K){a[h]=w[0]+(u[0]-w[0])/256*
(p+X);break}K=(1-this.functionArguments.maxPercent/100)*k;for(p=254;0<=p;p--)if(D[p]<K){c[h]=w[0]+(u[0]-w[0])/256*(p+2-X);break}}}}return{histogram:W,minCutOff:a,maxCutOff:c}}catch(Q){console.debug("webgl filter exception: "+Q.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var c=this.originalHistTexture=this._createTexture(),l=this.gl;a=a.pixelBlock;var k=a.width,f=a.height;l.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,
0,l.RGBA,k,f,0,l.RGBA,l.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),function(I,g,r,n,m,d){return I(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(b){b&&(this.pixelType=b.outputPixelType||b.OutputPixelType||this.pixelType,this.renderTexture=b.renderTexture,
this._initFunction())},mixinIgnoreCase:function(b,a){var c=Object.keys(b),l=Object.keys(a),k,f,e=c.length;for(k=0;k<l.length;k++){var h=a[l[k]];if(null!=h)for(f=0;f<e;f++)if(c[f].toLowerCase()===l[k].toLowerCase()){b[c[f]]=h;break}}return b},bind:function(b){},setProcessingContext:function(b){if(!b)throw"cannot bind to layer without options";this.useWebGL=!!b.useWebGL;this._tileMode=!!b.tileMode;this._glSetting=b.glSetting;this._rawRasterInfo=b.rawRasterInfo;this._xformSetting=b.xformSetting||this._xformSetting;
if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,c=this.functionArguments.raster2,l=this.functionArguments.dem,k=this.functionArguments.fillRaster,f=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(b);c&&c.functionArguments&&c.setProcessingContext(b);l&&l.functionArguments&&l.setProcessingContext(b);k&&
k.functionArguments&&k.setProcessingContext(b);if(f)for(a=0;a<f.length;a++)f[a]&&f[a].functionArguments&&f[a].setProcessingContext(b);this.bind()}},updateBranchStructure:function(){var b=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&(b+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(b+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(b=a.rasters.length,
a.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(b+=a.dem.updateBranchStructure());return 1===b?0:b},read:function(b){b=this.processRasterArgument(b);return this.useWebGL?this.readGL(b):this.read2D(b)},hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var b,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),
a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],b=0;b<this.functionArguments.rasters.length;b++)a.rasters[b]=this._bindRaster(this.functionArguments.rasters[b]);else a.raster=this._bindRaster(this.functionArguments.raster);return this.sourceRasterInfo=a},processRasterArgument:function(b){var a=this.bind();if(!0!==a)throw a;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,
b),c.raster2=this._readRaster(this.functionArguments.raster2,b);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._readRaster(this.functionArguments.rasters[a],b);else c.raster=this._readRaster(this.functionArguments.raster,b);return c},toJson:function(){var b=this.functionArguments,a=b.raster,c=b.raster2;b=b.rasters;a=a?a.toJson?a.toJson():a:null;c=c?c.toJson?c.toJson():c:null;var l;b&&0<b.length&&(l=b.map(function(k){return k.toJson?
k.toJson():k}));b=g.mixin({},this.functionArguments);b.raster=a;b.raster2=c;b.rasters=l;b=this._fixRasterFunctionJson(b);return{rasterFunction:this.functionName,rasterFunctionArguments:b,outputPixelType:this.pixelType}},_initFunction:function(b){},_getIntegerRange:function(b){switch(b){case "U8":var a=[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(b,
a){return b&&"unknown"!==b.toLowerCase()?b:a},_clonePixelData:function(b){if(null==b)return b;var a={};b.extent&&(a.extent=new m(b.extent.xmin,b.extent.ymin,b.extent.xmax,b.extent.ymax,b.extent.spatialReference));b=b.pixelBlock;if(null==b)return a;a.pixelBlock=b.clone?b.clone():d.prototype.clone(b);return a},_readRaster:function(b,a){if(null==b||"$$"===b)var c=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else b&&b.rasterInfo&&!b.functionArguments?c=this._clonePixelData(a.src[b._rasterId]):isNaN(b)?
b.read&&(c=b.functionArguments?b.read(a):this._clonePixelData(a)):(c=a.src?a.src[Object.keys(a.src)[0]]:a,a=c.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(b)),c=this._clonePixelData(c),c.pixelBlock.pixels=[a],c.isConstant=!0);return c},_bindRaster:function(b){if(b&&"$$"!==b)isNaN(b)?b.rasterInfo?a=b.rasterInfo:b.bind&&b.bind()&&(a=b.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new n(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(b,
a){switch(b){case "U8":b=new Uint8Array(a);break;case "U16":b=new Uint16Array(a);break;case "U32":b=new Uint32Array(a);break;case "S8":b=new Int8Array(a);break;case "S16":b=new Int16Array(a);break;case "S32":b=new Int32Array(a);break;case "U32":b=new Uint32Array(a);break;case "F32":b=new Float32Array(a);break;case "F64":b=new Float64Array(a);break;default:b=new Float32Array(a)}return b},_clampBand:function(b,a,c){if(("F64"===a||"F32"===a)&&!c)return b;var l,k=this._getIntegerRange(a),f=b.length;if(k)for(c=
k[1],k=k[0],a=this._getOutputBand(a,f),l=0;l<f;l++){var e=b[l];a[l]=e>c?c:e<k?k:e}else a=b;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},_addPerformanceMetric:function(b){r.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(b),50<self.rasterFunctionPerformance.length&&
self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(b){for(var a in b)b.hasOwnProperty(a)&&(null==b[a]?delete b[a]:b[a]instanceof Object&&!b[a].sourceType&&this._fixRasterFunctionJson(b[a],!0));return b}})})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(I,g,r,n,m){return I(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",
bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(d){g.mixin(this,d);this.extent=this.extent?this.extent.toJson?this.extent:new r(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?
this.spatialReference:new n(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new m(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?g.clone(this.colormap):null,
attributeTable:this.attributeTable?g.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?g.clone(this.multiDimensionalInfo):null,statistics:this.statistics?g.clone(this.statistics):null,histograms:this.histograms?g.clone(this.histograms):null,catalogInfo:this.catalogInfo?g.clone(this.catalogInfo):null,keyProperties:this.keyProperties?g.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&
this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?g.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),
function(I,g,r,n,m,d,b){return I([b],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,c){if(a||c){var l=c&&c.refTileInfo;a?this.virtual=!1:(this.virtual=!0,g.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),
this.width=this.cols,this.height=this.rows,this.origin||(l?this.origin=l.origin:c.spatialReference.isWebMercator()||c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var a=b.prototype.toJson.apply(this);a.tileType=this.tileType;
a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(I,g,r){I={shaderType:"vertex",getShader:function(n,m){var d=n.createShader(n.VERTEX_SHADER);n.shaderSource(d,m);n.compileShader(d);n.getShaderParameter(d,n.COMPILE_STATUS)||(d=null);return d}};g.mixin(I,r);return I})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaderScripts"],function(I,g,r){I={shaderType:"fragment",getShader:function(n,m){var d=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(d,m);n.compileShader(d);n.getShaderParameter(d,n.COMPILE_STATUS)||(d=null);return d}};g.mixin(I,r);return I})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(I,g,r,n,m,d,b){return I(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return c},_initializeProgram:function(a){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var l=this._glSetting.programUniforms,k="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,f=l[k];if(f)this._uniforms=f.uniforms,this.rasterProgram=f.program;else{var e=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?m.mesh:m.basic,h=m.getShader(c,a.vertex||e),p=n.getShader(c,a.fragment),v=this._loadProgram(h,p),t={rasterProgram:d.getUniforms(c,v)};l[k]={uniforms:t,program:v};this.rasterProgram=
v;this._uniforms=t}c.useProgram(this.rasterProgram);var q=c.getAttribLocation(this.rasterProgram,"a_texCoord"),w=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,w);var u=d.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,u,c.STATIC_DRAW);c.enableVertexAttribArray(q);c.vertexAttribPointer(q,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(y){console.error("webgl exception: "+y.message)}else console.error("WebGL is required.")},_setUniform:function(a,c,l){null!=c&&(l&&!this._uniforms[l]&&(this._uniforms[l]=d.getUniforms(this.gl,this[l])),l=l?this._uniforms[l]:this._uniforms.rasterProgram,(a=l[a]||l[a+"[0]"])&&d.setUniform(this.gl,a,c))},_setUniforms:function(a,c){var l=Object.keys(a),k,f=l.length;for(k=0;k<f;k++)this._setUniform(l[k],a[l[k]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",
!1,c);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,l=this._xformSetting.scale):(a=[0,0],l=[1,1]),this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",l,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),c)):this._setUniform("u_projection",!1,c))):(a=[0,0],l=[1,1],this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",l,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,c){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var l=c&&c.notOriginal,k=c&&c.bandIDs;c&&c.reCreate?c=!1:(c=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(c=k?this._originalBandIDs.join("")===k.join(""):!1);0<this._glSetting.branchCount&&(c=!1);if(c&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};c=this._createTexture();l||(this.originalTexture=c,this._originalBandIDs=k);l=this.gl;var f=a.pixelBlock;this._rawResolution=f?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var e=0;k&&0<k.length&&f&&(e=Math.max.apply(null,k),f.pixels.length>e&&k&&(f.pixels=k.map(function(p){return f.pixels[p]}),f.statistics&&(f.statistics=k.map(function(p){return f.statistics[p]}))));k=f.width;e=f.height;l.getExtension("OES_texture_float");var h=f.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,e,0,l.RGBA,l.FLOAT,h);return{extent:a.extent,texture:c}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var c=d.createBufferTexture(this.gl,!1);a.pingpong.push(c);c=d.createBufferTexture(this.gl,!1);a.pingpong.push(c);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var c=0,l=a.branchCount;if(0<l){for(c=0;c<l;c++){var k=d.createBufferTexture(this.gl,!1);a.branches.push(k)}a.branchIndex=l-1}}},_setupXformTexture:function(a){for(var c=this._createTexture(),l=this.gl,k=4*this._xformSetting.gridConfig.size[0],
f=this._xformSetting.gridConfig.size[1],e=new Float32Array(k*f*4),h=0,p=0;p<this._xformSetting.gridConfig.coefficients.length;p++)e[h++]=this._xformSetting.gridConfig.coefficients[p],2===p%3&&(e[h++]=1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,f,0,l.RGBA,l.FLOAT,e);this._bindTexture(c,"u_transformGrid",a)},_createTexture:function(a){return d.createTexture(this.gl,a)},_bindTexture:function(a,c,l){c=c||"u_image";l=this._uniforms[l||"rasterProgram"];var k=this._getTextureIndex(c);
if(-1!==k){var f=this.gl;f.uniform1i(l[c].location,k);f.activeTexture(f.TEXTURE0+k);f.bindTexture(f.TEXTURE_2D,a)}},_getTextureIndex:function(a,c){c=this._uniforms[c||"rasterProgram"];if(!c||!c[a]||c[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);
a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var c=a.getAttribLocation(this.meshProgram,"a_texCoord"),l=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,l);l=this._xformSetting.meshSize||
[1,1];var k=d.createMesh(l,!0);a.bufferData(a.ARRAY_BUFFER,k,a.STATIC_DRAW);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,l[0]*l[1]*10)}},_setupMeshProgram:function(){var a=m.getShader(this.gl,m.mesh),c=n.getShader(this.gl,n.constant);return this._loadProgram(a,c)},_loadProgram:function(a,c){return d.loadProgram(this.gl,a,c)},_getShaderScript:function(a,
c){c=document.getElementById(c);if(!c)return null;a="";for(c=c.firstChild;c;)3==c.nodeType&&(a+=c.textContent),c=c.nextSibling;return a}})})},"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var I={getUniforms:function(g,r){var n=g.getProgramParameter(r,g.ACTIVE_UNIFORMS),m,d,b={};for(m=0;m<n;m++)(d=g.getActiveUniform(r,m))&&(b[d.name]={location:g.getUniformLocation(r,d.name),info:d});return b},setUniform:function(g,r,n){var m=r.info,d=r.location,b=m.type;if(null==n)console.log("uniform "+
r.info.name+" has null or undefined value");else switch(b){case g.FLOAT:1<m.size?0===n.length?console.log("uniform "+r.info.name+" has length 0"):g.uniform1fv(d,n):g.uniform1f(d,n);break;case g.FLOAT_VEC2:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}g.uniform2fv(d,n);break;case g.FLOAT_VEC3:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}g.uniform3fv(d,n);break;case g.FLOAT_VEC4:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");
break}g.uniform4fv(d,n);break;case g.INT:case g.BOOL:1<m.size?0===n.length?console.log("uniform "+r.info.name+" has length 0"):g.uniform1iv(d,n):g.uniform1i(d,n);break;case g.INT_VEC2:case g.BOOL_VEC2:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}g.uniform2iv(d,n);break;case g.INT_VEC3:case g.BOOL_VEC3:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}g.uniform3iv(d,n);break;case g.INT_VEC4:case g.BOOL_VEC4:0===n.length?console.log("uniform "+
r.info.name+" has length 0"):g.uniform4iv(d,n)}},createTexture:function(g,r){var n=g.createTexture();g.bindTexture(g.TEXTURE_2D,n);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,r?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r?g.LINEAR:g.NEAREST);return n},createBufferTexture:function(g,r,n){r=I.createTexture(g,r);g.getExtension("OES_texture_float");
n=n||[g.drawingBufferWidth,g.drawingBufferHeight];g.texImage2D(g.TEXTURE_2D,0,g.RGBA,n[0],n[1],0,g.RGBA,g.FLOAT,null);n=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,n);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,r,0);return{texture:r,frameBuffer:n}},getShader:function(g,r,n){n=n?g.createShader(g.VERTEX_SHADER):g.createShader(g.FRAGMENT_SHADER);g.shaderSource(n,r);g.compileShader(n);g.getShaderParameter(n,g.COMPILE_STATUS)||(console.log(g.getShaderInfoLog(n)),n=null);
return n},loadProgram:function(g,r,n){var m=g.createProgram();g.attachShader(m,r);g.attachShader(m,n);g.linkProgram(m);g.getProgramParameter(m,g.LINK_STATUS)||(console.warn("failed to load webgl program: "+g.getProgramInfoLog(m)),g.deleteProgram(m),m=null);return m},createMesh:function(g,r){if(!g||1===g[0]&&1===g[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var n=g&&r?new Float32Array(g[0]*g[1]*20):new Float32Array(g[0]*g[1]*12);var m=.9998/g[1],d=.9998/g[0],b,a,c=0;for(b=0;b<g[1];b++)for(a=
0;a<g[0];a++){var l=1E-4+m*b;var k=1E-4+d*a;g&&!r?(n[c++]=l,n[c++]=k,n[c++]=l+m,n[c++]=k,n[c++]=l,n[c++]=k+d,n[c++]=l,n[c++]=k+d,n[c++]=l+m,n[c++]=k,n[c++]=l+m,n[c++]=k+d):(n[c++]=l,n[c++]=k,n[c++]=l,n[c++]=k+d,n[c++]=l,n[c++]=k+d,n[c++]=l+m,n[c++]=k+d,n[c++]=l+m,n[c++]=k+d,n[c++]=l+m,n[c++]=k,n[c++]=l,n[c++]=k,n[c++]=l+m,n[c++]=k,n[c++]=l,n[c++]=k+d,n[c++]=l+m,n[c++]=k)}return n}};return I})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var I={Default:[0,0,0,
0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,
.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,
0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(g){switch(g){case 0:return I.LineDetectionHorizontal;case 1:return I.LineDetectionVertical;case 2:return I.LineDetectionLeftDiagonal;case 3:return I.LineDetectionRightDiagonal;case 4:return I.GradientNorth;case 5:return I.GradientWest;case 6:return I.GradientEast;case 7:return I.GradientSouth;case 8:return I.GradientNorthEast;
case 9:return I.GradientNorthWest;case 10:return I.SmoothArithmeticMean;case 11:return I.Smoothing3x3;case 12:return I.Smoothing5x5;case 13:return I.Sharpening3x3;case 14:return I.Sharpening5x5;case 15:return I.Laplacian3x3;case 16:return I.Laplacian5x5;case 17:return I.SobelHorizontal;case 18:return I.SobelVertical;case 19:return I.Sharpen;case 20:return I.Sharpen2;case 21:return I.PointSpread;default:return I.Default}}};return I})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t){I={customDrivers:[],create:function(q){if(q){if(q.url){var w=e.urlToObject(q.url);var u=w.path;var y=w.query}w=q.serviceInfo;var x=q.rasterFxArgs||{},z=new n,B=r.hitch(this,function(C){console.error(C);this._trycustomDrivers(r.mixin({url:u},q),0,z)});if(u)if(-1===u.toLowerCase().indexOf("imageserver")&&-1===u.toLowerCase().indexOf("mapserver")){var E=new v(r.mixin({},q,{url:u}));q.rasterFx&&(E=new t({rasterFx:q.rasterFx,rasterFxArgs:r.mixin({},x,{raster:E})}));
var F=E}else{F=new n;w=w||this._getServiceInfo(u,y);var A=r.hitch(this,function(C){C.bandCount?E=new h(r.mixin({},{serviceInfo:C},y,q,{url:u})):C.tileInfo&&(E=new p(r.mixin({},{serviceInfo:C},y,this._options,{url:u})));q.rasterFx&&(E=new t({rasterFx:q.rasterFx,rasterFxArgs:r.mixin({},x,{raster:E})}));F.resolve(E)});a(w,A,B)}else F=E=new t({rasterFx:q.rasterFx,rasterFxArgs:r.mixin({},x,{raster:E})});a(F,r.hitch(this,function(C){C?C.open().then(r.hitch(this,function(G){z.resolve(C)}),B):B(Error("There is no raster to open"))}),
B);return z.promise}},register:function(q){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(w){return w.sourceType===q.prototype.sourceType}).length||this.customDrivers.push(q)},_trycustomDrivers:function(q,w,u){u=u||new n;var y=this.customDrivers[w];if(y){var x=new y(q);x.open().then(r.hitch(this,function(z){u.resolve(x)}),r.hitch(this,function(z){this._trycustomDrivers(q,w+1,u)}))}else u.reject("cannot load layer "+(q&&q.url||""));return u.promise},_getServiceInfo:function(q,
w){w=w||{};var u=w.bandIds;w=w.renderingRule;var y=new n(f._dfdCanceller),x={f:"json"};u&&(x.bandIds=u);w&&(x.renderingRule=w.toJson?JSON.stringify(w.toJson()):JSON.stringify(w));y._pendingDfd=k({url:q,content:x,handleAs:"json",callbackParamName:"callback"});y._pendingDfd.then(function(z){y.callback(z)},function(z){y.errback(z)});return y.promise}};b("extend-esri")&&r.setObject("layers.rasterLib.raster.rasterFactory",I,c);return I})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z,B,E,F){I=g([B],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(A){A&&(this._imageServiceParams=A.imageServiceParameters,this._commonReqParams=A._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:A.interpolation,pixelType:A.pixelType,format:A.format||"lerc",compressionQuality:A.compressionQuality,bandIds:A.bandIds,noDataInterpretation:A.noDataInterpretation,
adjustAspectRatio:A.adjustAspectRatio,mosaicRule:A.mosaicRule,renderingRule:A.interpolation}))},open:function(){var A=new n;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),A.resolve(this),A.promise;var C=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),G=r.hitch(this,function(N){this._fixServiceInfo(N);this.serviceInfo=N;this._findCredential();var M=this._parseRasterInfo(N),
R={};N.defaultMosaicMethod?(R.method=N.defaultMosaicMethod,R.operation=N.mosaicOperator,R.sortField=N.sortField,R.sortValue=N.sortValue):R.method=u.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new u(R);this.serviceInfo.defaultMosaicRule.ascending=!0;N=this._getColormap(this);R=this._getHistograms(this);var S=this._getRasterAttributeTable(this),U=this._getKeyProperties(this),Y=this._getMultidimensionalInfo(),Z=this._getSlices();(new c([N,R,S,U,Y,Z])).then(r.hitch(this,function(J){J[0][0]&&(M.colormap=
J[0][1]);J[1][0]&&(M.histograms=J[1][1]);J[2][0]&&(M.vat=J[2][1]);J[3][0]&&(M.keyProperties=J[3][1]);J[4][0]&&(M.multidimensionalInfo=J[4][1],M.multidimensionalInfo&&M.multidimensionalInfo.variables&&M.multidimensionalInfo.variables.forEach(function(O){O.statistics&&(O.statistics.forEach(function(T){T.stddev=T.standardDeviation}),M.statistics||O.statistics.length!==M.bandCount||(M.statistics=O.statistics));!M.histograms&&O.histograms&&O.histograms.length===M.bandCount&&(M.histograms=O.histograms)}));
M.keyProperties=M.keyProperties||{};this._slices=J[5][0]?J[5][1]:null;M.keyProperties&&M.keyProperties.DataType&&(this.dataType=M.keyProperties.DataType);M.keyProperties&&M.keyProperties.DefaultVariable&&(this.defaultVariable=M.keyProperties.DefaultVariable);this.loaded=!0;this.rasterInfo=M;this.setFetchParameters(this._imageServiceParams);A.resolve(this)}))}),H=r.hitch(this,function(N){this.loaded=!0;A.reject(N)});l(C,G,H);return A.promise},setFetchParameters:function(A,C){if(C)this.imageServiceParams=
A;else{var G=this.imageServiceParams;G&&A?Object.keys(A).forEach(function(H){G[H]=A[H]}):this.imageServiceParams=A}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(A){if(A.pixelBlock||A.texture){var C=new n;C.resolve(A);return C.promise}if(!1===A.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(A);if(this._slices){var G=this._getSliceId();if(null==G)return C=new n,C.resolve(A),C.promise}var H=A.extent,N=H.spatialReference.wkid||b.toJson(H.spatialReference.toJson(!1)),
M=A.timeExtent?A.timeExtent.toJson().join(","):null;C=this.url+"/exportImage";var R={};this._slices&&(R.sliceid=G);this.disableClientCaching&&(R._ts=(new Date).getTime());G=r.mixin({},this._commonReqParams,{bbox:H.xmin+","+H.ymin+","+H.xmax+","+H.ymax,imageSR:N,bboxSR:N,size:A.width+","+A.height,time:M},R);return this._requestPixels({url:C,payload:G,decodeParams:{width:A.width,height:A.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:A})},readTile:function(A){var C=
this.tileBoundary&&this.tileBoundary[A.level];if(C&&(C.minRow>A.row||C.maxRow<A.row||C.minCol>A.col||C.maxCol<A.col)){var G=new n;G.resolve(A);return G.promise}if(this._slices&&(G=this._getSliceId(),null==G))return G=new n,G.resolve(A),G.promise;C=this.url+"/tile/"+A.level+"/"+A.row+"/"+A.col;var H={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,useWasm:!0,isPoint:"elevation"===A.tileType.toLowerCase()?!0:!1};G=this._slices?"sliceid\x3d"+
G+"\x26":"";G=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():G.replace(/&$/,"");return this._requestPixels({url:C+(0<G.length?"?"+G:""),payload:{},decodeParams:H,tileOptions:A})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var A=r.clone(this._imageServiceParams.multidimensionalDefinition),C=r.clone(this._imageServiceParams.time);
if(null==this._slices||null==C&&(null==A||0===A.length))return 0;var G=A||this.defaultMultidimensionalDefinition,H=G[0].variableName;G=this._getAllDimensionDefinition(G,H).definition;A=null;if(null==G||0===G.length)return null;if(C&&this.serviceInfo.timeInfo){if(null==C[1]||C[1]===C[0])var N=C[0];else{var M=this.serviceInfo.timeInfo.startTimeField;N=this.rasterInfo.multidimensionalInfo.variables.find(function(U){return U.name===H}).dimensions.find(function(U){return U.name===M}).values.filter(function(U){return Array.isArray(U)?
Math.max(U[0],C[0])<Math.min(U[1],C[1]):U>=C[0]&&U<=C[1]}).sort(function(U,Y){U=Array.isArray(U)?U[1]:U;Y=Array.isArray(Y)?U[1]:Y;return Math.abs(C[1]-U)-Math.abs(C[1]-Y)})[0]||[C[1]]}G.some(function(U){if(U.dimensionName===M)return U.values[0]=N,!0;if(!U.dimensionName)return U.dimensionName=M,U.isSlice=!0,U.values=[N],!0})||G.push({variableName:H,dimensionName:M,isSlice:!0,values:[N]})}for(var R=0;R<this._slices.length;R++){var S=this._slices[R].multidimensionalDefinition;if(S.length===G.length&&
!S.some(function(U){var Y=G.filter(function(J){return U.variableName===J.variableName&&J.dimensionName===U.dimensionName})[0];if(!Y)return!0;var Z=Array.isArray(U.values[0])?U.values[0][0]:U.values[0];Y=Array.isArray(Y.values[0])?Y.values[0][0]:Y.values[0];return Z!==Y})){A=R;break}}return A},_getAllDimensionDefinition:function(A,C){var G=A.map(function(N){return N.dimensionName}),H=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(N){N.name!==C||N.dimensions.length===A.length&&G[0]||
(N.dimensions.forEach(function(M){0>G.indexOf(M.name)&&(G[0]?A.push({variableName:C,dimensionName:M.name,values:[M.values[0]]}):(A[0].dimensionName=M.name,A[0].values=[M.values[0]],M[0]=M.name))}),H=!0)},this);return{defChanged:H,definition:A}},_generateServiceInfo:function(A){var C=this.url,G=new n(q._dfdCanceller);G._pendingDfd=e({url:C,content:{f:"json",renderingRule:A?b.toJson(A.toJson()):null},handleAs:"json",callbackParamName:"callback"});G._pendingDfd.then(function(H){G.callback(H)},function(H){G.errback(H)});
return G},_fixServiceInfo:function(A){var C=A.spatialReference.wkid;A.tileInfo&&0===A.extent.xmin&&360===A.extent.xmax&&C&&null==t[C]&&(A.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(A){var C=new z;C.bandCount=A.bandCount;C.extent=new h(A.fullExtent);C.spatialReference=A.spatialReference;C.pixelType=A.pixelType;C.width=Math.floor((A.fullExtent.xmax-A.fullExtent.xmin)/A.pixelSizeX+.5);C.height=Math.floor((A.fullExtent.ymax-A.fullExtent.ymin)/A.pixelSizeY+.5);C.cellSize=new p({x:A.pixelSizeX,
y:A.pixelSizeY,spatialReference:A.spatialReference});var G;if(A.minValues&&0<A.minValues.length&&A.maxValues&&A.stdvValues&&A.meanValues){var H=[];for(G=0;G<A.minValues.length;G++)H.push({min:A.minValues[G],max:A.maxValues[G],mean:A.meanValues[G],stddev:A.stdvValues[G]});A.bandCount!==H.length&&(H=null)}this.dataType=A.serviceDataType?A.serviceDataType.replace("esriImageServiceDataType",""):"Generic";C.statistics=H;A.objectIdField&&A.fields&&(C.catalogInfo={objectIdField:A.objectIdField,fields:A.fields});
C.timeInfo=A.timeInfo;if(A.tileInfo){this.tileInfo=new F(A.tileInfo);this.tileInfo.tileType=A.cacheType||"Map";C.tileInfo=this.tileInfo;var N=C.extent,M=this.tileInfo.origin,R=this.tileInfo.cols,S=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(U){return{minCol:Math.floor((N.xmin-M.x+.1*U.resolution)/R/U.resolution),maxCol:Math.floor((N.xmax-M.x-.1*U.resolution)/R/U.resolution),minRow:Math.floor((M.y-N.ymax+.1*U.resolution)/S/U.resolution),maxRow:Math.floor((M.y-N.ymin-.1*U.resolution)/
S/U.resolution)}})}return C},_getColormap:function(A){A=this.url+"/colormap";var C=new n(q._dfdCanceller),G={f:"json"},H=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&H?(C._pendingDfd=e({url:A,content:G,handleAs:"json",callbackParamName:"callback"}),C._pendingDfd.then(function(N){C.callback(N.colormap)},function(N){C.errback(N)})):C.callback(null);return C},_getHistograms:function(A){var C=this.url+"/histograms",G=new n(q._dfdCanceller),
H={f:"json"},N=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;A&&A.renderingRule&&(H.renderingRule=b.toJson(A.renderingRule.toJson()),N=!0);10<this.serviceInfo.currentVersion&&N?(G._pendingDfd=e({url:C,content:H,handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(function(M){G.callback(M.histograms)},function(M){G.errback(M)})):G.callback(null);return G},_getRasterAttributeTable:function(A){var C=this.url+"/rasterAttributeTable",G=new n(q._dfdCanceller),
H={f:"json"},N=this.serviceInfo.hasRasterAttributeTable;A&&A.renderingRule&&(H.renderingRule=b.toJson(A.renderingRule.toJson()),N=!0);10<this.serviceInfo.currentVersion&&N?(G._pendingDfd=e({url:C,content:H,handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(function(M){G.callback(M)},function(M){G.errback(M)})):G.callback(null);return G},_getKeyProperties:function(A){var C=this.url+"/keyProperties",G=new n(q._dfdCanceller),H={f:"json"};A&&A.renderingRule&&(H.renderingRule=b.toJson(A.renderingRule.toJson()));
10<this.serviceInfo.currentVersion?(G._pendingDfd=e({url:C,content:H,handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(function(N){G.callback(N)},function(N){G.errback(N)})):G.callback(null);return G},_getMultidimensionalInfo:function(){var A=this.url+"/multidimensionalInfo",C=new n(q._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(C._pendingDfd=e({url:A,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),C._pendingDfd.then(r.hitch(this,
function(G){C.callback(G.multidimensionalInfo)}),function(G){C.errback(G)})):C.callback(null);return C},_getSlices:function(){var A=this.url+"/slices",C=new n(q._dfdCanceller);this.serviceInfo.hasMultidimensions?(C._pendingDfd=e({url:A,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),C._pendingDfd.then(r.hitch(this,function(G){C.callback(G.slices)}),function(G){C.errback(G)})):C.callback(null);return C},_initializationFailed:function(){},_constructGetImageParams:function(){var A=
this.imageServiceParams||{},C=r.mixin({},this._query,{f:"image",interpolation:A.interpolation,pixelType:A.pixelType,format:A.format||"lerc",compressionQuality:A.compressionQuality,bandIds:A.bandIds?A.bandIds.join(","):null,noData:null!=A.noData?A.noData.join(","):null,noDataInterpretation:A.noDataInterpretation,adjustAspectRatio:null==A.adjustAspectRatio?null:A.adjustAspectRatio,mosaicRule:A.mosaicRule?b.toJson(A.mosaicRule.toJson()):null,renderingRule:A.renderingRule?b.toJson(A.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===C.format.toLowerCase()?(C.compressionTolerance=A.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(C.lercVersion=A.lercVersion||2)):"tiff"===C.format.toLowerCase()?C.compression=A.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(C.format.toLowerCase())&&(C.compression=A.compression);this._commonReqParams=C},_getRasterIdentifier:function(A){if(this._rasterId)return this._rasterId;A=this.url.replace("http:","").replace("https:",
"");var C=[],G=this.imageServiceParams||{};C.push(A);C.push(G.interpolation);C.push(G.pixelType);C.push(G.compressionQuality);C.push(G.bandIds?G.bandIds.join(","):"");C.push(G.mosaicRule?b.toJson(G.mosaicRule.toJson()):"");C.push(G.renderingRule?b.toJson(G.renderingRule.toJson()):"");A=C.join("|");return this._rasterId=this._computeSignature(A)},_wrapExtent:function(A){var C=A.spatialReference._getInfo();if(C){var G=C.valid[0];C=C.valid[1];if(A.xmin<G-this.resolution.x||A.xmax>C+this.resolution.y){var H=
new h((A.xmin-G)%(C-G),A.ymin,(A.xmax-C)%(C-G),A.ymax,A.spatialReference);H.xmax<H.xmin&&(H=null)}}return H||A}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.ImageServiceRaster",I,k);return I})},"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z,B,E){return g([f],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(F){if(F){var A=F.url;A&&(A=q.urlToObject(A),this.url=A.path,this._query=A.query);this.dataType=F.dataType;this.serviceInfo=F.serviceInfo;this.rasterInfo=F.rasterInfo;this.tileInfo=F.tileInfo;this.serviceInfo=F.serviceInfo}},open:function(){},read:function(F){},identify:function(F){var A=new n,C=this.rasterInfo.extent;if(B.requirePE(C.spatialReference,
F.spatialReference))B.load().then(r.hitch(this,function(){G=B.project(F,C.spatialReference);A.resolve(G)}),function(){A.reject(Error("cannot project into this spatial reference"))});else{var G=B.project(F,C.spatialReference);A.resolve(G)}return A.then(r.hitch(this,function(H){var N=this.tileInfo,M=N.origin,R=N.lods[N.lods.length-1],S=(H.x-M.x)/N.cols/R.resolution;H=(M.y-H.y)/N.rows/R.resolution;var U=Math.round((H-Math.floor(H))*N.rows)*N.cols+Math.round((S-Math.floor(S))*N.cols);M=new h(M.x+R.resolution*
N.cols*S,M.y-R.resolution*N.rows*(H+1),M.x+R.resolution*N.cols*(S+1),M.y-R.resolution*N.rows*H,C.spatialReference);var Y=this.getMemberRasters?this.getMemberRasters()[0]:this;return Y.read({level:R.level,row:Math.floor(H),col:Math.floor(S),extent:M,width:N.cols,height:N.rows,virtual:Y.tileInfo.virtual,tileType:Y.tileInfo.tileType}).then(function(Z){return(Z=Z&&Z.pixelBlock)&&Z.pixels&&0<Z.pixels.length&&(!Z.mask||Z.mask[U])?{pixelValue:Z.pixels.map(function(J){return J[U]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(F,A){var C=new n;if(this.projectedFullExtent&&!A)return C.resolve(this.projectedFullExtent),C.promise;var G=this.rasterInfo.extent;if(B.requirePE(this.rasterInfo.extent.spatialReference,F))B.load().then(r.hitch(this,function(){H=B.project(G,F);this.projectedFullExtent=H=new h(H.toJson());C.resolve(H)}),function(){C.reject(Error("cannot project into this spatial reference"))});else{var H=B.project(G,F);this.projectedFullExtent=H=new h(H.toJson());C.resolve(H)}return C.promise},
setFetchParameters:function(F,A){},_setRasterHandler:function(F){this._rasterHandler=F;this.getMemberRasters&&this.getMemberRasters().forEach(r.hitch(this,function(A){A._rasterHandler=F}))},_findCredential:function(){this.url&&((this._credential=k.id&&k.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new z;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(F){var A=F.url,C=F.payload,G=F.decodeParams,H=F.tileOptions,N=new n(t._dfdCanceller);this._rasterHandler||this._initWorker();var M=this._rasterHandler,R={};A={url:A,handleAs:"arraybuffer",content:C};F.headers&&(A.headers=F.headers);N._pendingDfd=e(A).then(r.hitch(this,function(S){(M&&this._rasterHandlerInitialized?M.decode({encodedData:S,decodeParams:G}):x.decode(S,G)).then(function(U){R.pixelBlock=new y(U);R.extent=H.extent;R.level=H.level;R.row=H.row;R.col=
H.col;R.width=H.width;R.height=H.height;t._resDfd(N,[R])},function(U){t._resDfd(N,[U],!0)})}),function(S){t._resDfd(N,[S],!0)});return N},_computeSignature:function(F){if("string"===typeof F){for(var A=new Uint8Array(F.length),C=0;C<F.length;C++)A[C]=F.charCodeAt(C);F=A}C=A=65535;for(var G=F.length,H=Math.floor(G/2),N=0;H;){var M=359<=H?359:H;H-=M;do A+=F[N++]<<8,C+=A+=F[N++];while(--M);A=(A&65535)+(A>>>16);C=(C&65535)+(C>>>16)}G&1&&(C+=A+=F[N]<<8);return((C&65535)+(C>>>16)<<16|(A&65535)+(A>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./Lerc ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(I,g,r,n,m,d,b,a,c,l,k,f){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var e=new ArrayBuffer(4),h=new Uint8Array(e);(new Uint32Array(e))[0]=
1;return 1===h[0]}(),decode:function(e,h){if(void 0===h||null===h)throw"missing decode options";var p;h.format&&(p=h.format.toUpperCase());"BSQ"!==p&&"BIP"!==p&&(p=this._getFormat(e));var v=h.decodeFunc;if(void 0===v||null===v)v=this._getFormatDecoderDfd(p,h.useWasm);return v(e,h)},_getFormatDecoderDfd:function(e,h){if(h&&("LERC"===e||"LERC2"===e))return this._decodeLercWasm.bind(this);var p=null;switch(e){case "LERC":p=this._decodeLerc;break;case "LERC2":p=this._decodeLerc2;break;case "JPEG":p=this._decodeJpeg;
break;case "PNG":p=this._decodePng;break;case "BSQ":p=this._decodeBsq;break;case "BIP":p=this._decodeBip;break;case "TIFF":p=this._decodeTiff;break;default:p=function(v,t){throw"The raster format is not supported";}}p=r.hitch(this,p);return function(v,t){var q=new n;t.isPoint&&t.width&&(t.width++,t.height++);v=p(v,t);t.isPoint&&t.width&&(this._interpolatePointGrid(v),t.width--,t.height--);q.resolve(v);return q}.bind(this)},_getFormat:function(e){e=new Uint8Array(e,0,10);var h="";if(255===e[0]&&216===
e[1])h="JPEG";else if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])h="PNG";else if(67===e[0]&&110===e[1]&&116===e[2]&&90===e[3]&&73===e[4]&&109===e[5]&&97===e[6]&&103===e[7]&&101===e[8]&&32===e[9])h="LERC";else if(76===e[0]&&101===e[1]&&114===e[2]&&99===e[3]&&50===e[4]&&32===e[5])h="LERC2";else if(-1<String.fromCharCode.apply(null,e).toLowerCase().indexOf("error"))h="ERROR";else if(73===e[0]&&73===e[1]&&42===e[2]&&0===e[3]||77===e[0]&&77===e[1]&&0===e[2]&&42===e[3])h="TIFF";return h},_validateDecodeParams:function(e){if(!e.height||
Math.floor(e.height)!==e.height)throw"Height not provided.";if(!e.width||Math.floor(e.width)!==e.width)throw"Width not provided.";},_decodeJpeg:function(e,h){if(!c)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(h);e=(new c).decode(e);if(!this._verifyResult(e,h))throw"The decoded image dimensions are incorrect.";h=new m({width:e.width,height:e.height,pixels:e.pixels,pixelType:"U8",mask:e.mask,statistics:null});h.calculateStatistics();return h},_decodePng:function(e,h){if(!l)throw"The png decoder module is not loaded.";
this._validateDecodeParams(h);e=new Uint8Array(e);var p=new l(e);e=new Uint8Array(h.width*h.height*4);p.copyToImageData(e,p.decodePixels());var v=p=0;v=new Uint8Array(h.width*h.height);for(p=0;p<h.width*h.height;p++)v[p]=e[4*p+3];var t=new m({width:h.width,height:h.height,pixels:[],pixelType:"U8",mask:v,statistics:[]});for(p=0;3>p;p++){var q=new Uint8Array(h.width*h.height);for(v=0;v<h.width*h.height;v++)q[v]=e[4*v+p];t.addData({pixels:q})}t.calculateStatistics();return t},_decodeBsq:function(e,h){if(!k)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(h);var p=h.noDataValue;h.pixelType=this._getpixelTypeAndNoData(h.pixelType);e=k.decodeBSQ(e,{bandCount:h.planes,width:h.width,height:h.height,pixelType:h.pixelType,noDataValue:p});h=new m({width:h.width,height:h.height,pixels:e.pixels,pixelType:h.pixelType,mask:e.maskData,statistics:null});h.calculateStatistics();return h},_decodeBip:function(e,h){this._validateDecodeParams(h);var p=h.noDataValue;h.pixelType=this._getpixelTypeAndNoData(h.pixelType);e=k.decodeBIP(e,{bandCount:h.planes,
width:h.width,height:h.height,pixelType:h.pixelType,noDataValue:p});h=new m({width:h.width,height:h.height,pixels:e.pixels,pixelType:h.pixelType,mask:e.maskData,statistics:null});h.calculateStatistics();return h},_decodeTiff:function(e,h){this._validateDecodeParams(h);h.pixelType=this._getpixelTypeAndNoData(h.pixelType);e=f.decode(e);e=new m({width:e.width,height:e.height,pixels:e.pixels,pixelType:e.pixelType,mask:e.maskData,statistics:null});e.calculateStatistics();return e},_decodeLerc:function(e,
h){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(h);var p=h.noDataValue;h.pixelType=this._getpixelTypeAndNoData(h.pixelType);for(var v=0,t,q=0,w,u=e.byteLength-10;q<u;){var y=d.decode(e,{inputOffset:q,encodedMaskData:t,returnMask:0===v?!0:!1,returnEncodedMask:0===v?!0:!1,returnFileInfo:!0,pixelType:h.pixelType,noDataValue:p});q=y.fileInfo.eofOffset;0===v&&(t=y.encodedMaskData,w=new m({width:h.width,height:h.height,pixels:[],
pixelType:h.pixelType,mask:y.maskData,statistics:[]}));v++;if(!this._verifyResult(y,h))throw"The decoded image dimensions are incorrect";w.addData({pixels:y.pixelData,statistics:{minValue:y.minValue,maxValue:y.maxValue,noDataValue:y.noDataValue}})}return w},_decodeLerc2:function(e,h){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(h);h.pixelType=this._getpixelTypeAndNoData(h.pixelType);for(var p=0,v,t,q,w=0,u,y=e.byteLength-
10,x=[],z,B=0;w<y;){t=b.decode(e,{inputOffset:w,maskData:v,returnFileInfo:!0});w=t.fileInfo.eofOffset;v=t.maskData;0===p&&(q=t.fileInfo.numValidPixel,u=new m({width:h.width,height:h.height,pixels:[],dimCount:t.dimCount||1,pixelType:t.fileInfo.pixelType,mask:v,statistics:[]}));t.fileInfo.mask&&0<t.fileInfo.mask.numBytes&&B++;v&&x.push(v);p++;if(!this._verifyResult(t,h))throw"The decoded image dimensions are incorrect";u.addData({pixels:t.pixelData,statistics:{minValue:t.minValue,maxValue:t.maxValue,
noDataValue:t.noDataValue,dimStats:t.dimStats}})}if(1<B){h=u.width*u.height;u.bandMasks=x;v=new Uint8Array(h);v.set(x[0]);for(q=1;q<x.length;q++)for(z=x[q],e=0;e<h;e++)v[e]&=z[e];for(e=q=0;e<h;e++)q+=z[e];u.mask=v}u.validPixelCount=q;return u},_decodeLercWasm:function(e,h){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(h);var p=new n;a.load().then(function(){var v=a.decode(e,{inputOffset:0,noDataValue:h.noDataValue,pixelType:h.pixelType&&
h.pixelType.toUpperCase()});v=new m({width:v.width,height:v.height,pixelType:v.pixelType.toUpperCase(),pixels:v.pixels,mask:v.mask,statistics:v.statistics,validPixelCount:v.validPixelCount});h.isPoint&&h.width&&(this._interpolatePointGrid(v),h.width--,h.height--);p.resolve(v)}.bind(this),function(){p.reject("Cannot load lerc wasm decoder")});return p},_interpolatePointGrid:function(e,h){var p=e.pixels;if(p&&0!==p.length){var v=p.length,t=e.width,q=e.mask,w=t-1,u=e.height-1,y=[],x,z;if(0===(null==
h?1:h)){for(h=0;h<v;h++){var B=p[h];var E=new B.constructor(w*u);for(x=0;x<u;x++){var F=x*t;for(z=0;z<w;z++)E[x*w+z]=B[F+z]}y.push(E)}if(q){var A=new Uint8Array(w*u);for(x=0;x<u;x++)for(F=x*t,z=0;z<w;z++)A[x*w+z]=q[F+z]}}else{for(h=0;h<v;h++){B=p[h];E=new B.constructor(w*u);for(x=0;x<u;x++)for(F=x*t,z=0;z<w;z++)E[x*w+z]=(B[F+z]+B[F+z+1]+B[F+t+z]+B[F+t+z+1])/4;y.push(E)}if(q)for(A=new Uint8Array(w*u),x=0;x<u;x++)for(F=x*t,z=0;z<w;z++)A[x*w+z]=Math.min.apply(null,[q[F+z],q[F+z+1],q[F+t+z],q[F+t+z+1]])}e.width=
w;e.height=u;e.mask=A;e.pixels=y;return e}},_getpixelTypeAndNoData:function(e){return"U1"===e||"U2"===e||"U4"===e||"U8"===e?"U8":e},_verifyResult:function(e,h){return e.height!==h.height||e.width!==h.width?!1:!0}}})},"esri/layers/rasterFormats/Lerc":function(){var I=this&&this.__createBinding||(Object.create?function(m,d,b,a){void 0===a&&(a=b);Object.defineProperty(m,a,{enumerable:!0,get:function(){return d[b]}})}:function(m,d,b,a){void 0===a&&(a=b);m[a]=d[b]}),g=this&&this.__setModuleDefault||(Object.create?
function(m,d){Object.defineProperty(m,"default",{enumerable:!0,value:d})}:function(m,d){m["default"]=d}),r=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var d={};if(null!=m)for(var b in m)"default"!==b&&Object.prototype.hasOwnProperty.call(m,b)&&I(d,m,b);g(d,m);return d},n=this&&this.__read||function(m,d){var b="function"===typeof Symbol&&m[Symbol.iterator];if(!b)return m;m=b.call(m);var a,c=[];try{for(;(void 0===d||0<d--)&&!(a=m.next()).done;)c.push(a.value)}catch(k){var l={error:k}}finally{try{a&&
!a.done&&(b=m["return"])&&b.call(m)}finally{if(l)throw l.error;}}return c};define(["require","exports"],function(m,d){function b(f){var e=f._malloc,h=f._free,p=f._lerc_getBlobInfo,v=f._lerc_getDataRanges,t=f._lerc_decode_4D,q,w=Object.values(f.asm).find(function(y){return y&&"buffer"in y&&y.buffer===f.HEAPU8.buffer}),u=function(y){y=y.map(function(E){return(E>>3<<3)+16});var x=y.reduce(function(E,F){return E+F}),z=e(x);q=new Uint8Array(w.buffer);x=y[0];y[0]=z;for(z=1;z<y.length;z++){var B=y[z];y[z]=
y[z-1]+x;x=B}return y};k.getBlobInfo=function(y){var x,z=new Uint8Array(48),B=new Uint8Array(24),E=n(u([y.length,z.length,B.length]),3),F=E[0],A=E[1];E=E[2];q.set(y,F);q.set(z,A);q.set(B,E);if(x=p(F,y.length,A,E,12,3))throw h(F),"lerc-getBlobInfo: error code is ".concat(x);q=new Uint8Array(w.buffer);z.set(q.slice(A,A+z.length));B.set(q.slice(E,E+B.length));z=new Uint32Array(z.buffer);E=new Float64Array(B.buffer);A=n(z,11);B=A[2];z=A[5];var C=A[10];A={version:A[0],dimCount:B,width:A[3],height:A[4],
validPixelCount:A[6],bandCount:z,blobSize:A[7],maskCount:A[8],dataType:A[1],minValue:E[0],maxValue:E[1],maxZerror:E[2],statistics:[],bandCountWithNoData:C};if(C)return A;if(1===B&&1===z)return h(F),A.statistics.push({minValue:E[0],maxValue:E[1]}),A;var G=B*z*8,H=new Uint8Array(G),N=new Uint8Array(G);E=F;C=0;var M=!1;if(q.byteLength<F+2*G){h(F);M=!0;x=n(u([y.length,G,G]),3);E=x[0];C=x[1];var R=x[2];q.set(y,E)}else x=n(u([G,G]),2),C=x[0],R=x[1];q.set(H,C);q.set(N,R);if(x=v(F,y.length,B,z,C,R))throw h(E),
M||h(C),"lerc-getDataRanges: error code is ".concat(x);q=new Uint8Array(w.buffer);H.set(q.slice(C,C+G));N.set(q.slice(R,R+G));y=new Float64Array(H.buffer);F=new Float64Array(N.buffer);x=A.statistics;for(N=0;N<z;N++)if(1<B){G=y.slice(N*B,(N+1)*B);H=F.slice(N*B,(N+1)*B);R=Math.min.apply(null,G);var S=Math.max.apply(null,H);x.push({minValue:R,maxValue:S,dimStats:{minValues:G,maxValues:H}})}else x.push({minValue:y[N],maxValue:F[N]});h(E);M||h(C);return A};k.decode=function(y,x){var z=x.maskCount,B=x.dimCount,
E=x.bandCount,F=x.width,A=x.height,C=x.dataType,G=x.bandCountWithNoData,H=a[C],N=F*A;x=new Uint8Array(N*E);var M=N*B*E*H.size;H=new Uint8Array(M);N=new Uint8Array(E);var R=8*E,S=new Uint8Array(R),U=n(u([y.length,x.length,H.length,N.length,S.length]),5),Y=U[0],Z=U[1],J=U[2],O=U[3];U=U[4];q.set(y,Y);q.set(x,Z);q.set(H,J);q.set(N,O);q.set(S,U);if(y=t(Y,y.length,z,Z,B,F,A,E,C,J,O,U))throw h(Y),"lerc-decode: error code is ".concat(y);q=new Uint8Array(w.buffer);H.set(q.slice(J,J+M));x.set(q.slice(Z,Z+x.length));
y=null;if(G)for(N.set(q.slice(O,O+E)),S.set(q.slice(U,U+R)),y=[],E=0;E<N.length;E++)y.push(N[E]?S[E]:null);h(Y);return{data:H,maskData:x,noDataValues:y}}}Object.defineProperty(d,"__esModule",{value:!0});d.getBlobInfo=d.decode=d.isLoaded=d.load=void 0;var a=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",
size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}],c=null,l=!1;d.load=function(){return c?c:c=(new Promise(function(f,e){m(["./lerc-wasm"],f,e)})).then(r).then(function(f){f=f.default;return f({locateFile:function(e){return m.toUrl("./"+e)}})}).then(function(f){b(f);
l=!0})};d.isLoaded=function(){return l};var k={getBlobInfo:null,decode:null};d.decode=function(f,e){var h;void 0===e&&(e={});var p=null!==(h=e.inputOffset)&&void 0!==h?h:0;h=f instanceof Uint8Array?f.subarray(p):new Uint8Array(f,p);f=k.getBlobInfo(h);var v=k.decode(h,f),t=v.maskData;h=f.width;p=f.height;var q=f.bandCount,w=f.dimCount,u=f.maskCount,y=f.statistics,x=a[f.dataType],z=new x.ctor(v.data.buffer);v=[];for(var B=[],E=h*p,F=E*w,A=0;A<q;A++){var C=z.subarray(A*F,(A+1)*F);if(e.returnPixelInterleavedDims)v.push(C);
else{var G=E,H=w;if(!(2>H)){for(var N=new x.ctor(G*H),M=0,R=0;M<G;M++)for(var S=0,U=M;S<H;S++,U+=G)N[U]=C[R++];C=N}v.push(C)}B.push(t.subarray(A*F,(A+1)*F))}t=0===u?null:1===u?B[0]:new Uint8Array(E);if(1<u)for(t.set(B[0]),A=1;A<B.length;A++)for(z=B[A],F=0;F<E;F++)t[F]&=z[F];A=e.noDataValue;A=null!=A&&x.range[0]<=A&&x.range[1]>=A;if(0<u&&A)for(G=e.noDataValue,A=0;A<q;A++)for(C=v[A],z=B[A]||t,F=0;F<E;F++)0===z[F]&&(C[F]=G);return{width:h,height:p,bandCount:q,pixelType:e.pixelType&&0===f.version?e.pixelType:
x.pixelType,dimCount:w,statistics:y,pixels:v,mask:t,bandMasks:u===q&&1<q?B:null}};d.getBlobInfo=function(f,e){var h,p;void 0===e&&(e={});var v=f instanceof Uint8Array?f.subarray(null!==(h=e.inputOffset)&&void 0!==h?h:0):new Uint8Array(f,null!==(p=e.inputOffset)&&void 0!==p?p:0);return k.getBlobInfo(v)}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(I,g,r){return I(null,{constructor:function(){},decode:function(n){var m=new Uint8Array(n);n=
new r;n.parse(m);var d=n.numComponents,b=n.getData(n.width,n.height,!0),a=n.width*n.height,c=n.eof,l=0,k=0,f=0;if(c<m.length-1){k=(new g(m.subarray(c))).getBytes();var e=new Uint8Array(a);for(l=m=0;l<k.length;l++)for(f=7;0<=f;f--)e[m++]=k[l]>>f&1}m=[];if(1===d&&b.length===a)m=[b,b,b];else{for(l=0;3>l;l++)d=new Uint8Array(a),m.push(d);for(k=f=0;k<a;k++)for(l=0;3>l;l++)m[l][k]=b[f++]}return{width:n.width,height:n.height,pixels:m,mask:e}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var I=
function(){function g(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}g.prototype={ensureBuffer:function(r){var n=this.buffer,m=n?n.byteLength:0;if(r<m)return n;for(var d=512;d<r;)d<<=1;r=new Uint8Array(d);for(d=0;d<m;++d)r[d]=n[d];return this.buffer=r},getByte:function(){for(var r=this.pos;this.bufferLength<=r;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(r){var n=this.pos;if(r){this.ensureBuffer(n+r);for(r=n+r;!this.eof&&this.bufferLength<
r;)this.readBlock();var m=this.bufferLength;r>m&&(r=m)}else{for(;!this.eof;)this.readBlock();r=this.bufferLength}this.pos=r;return this.buffer.subarray(n,r)},lookChar:function(){for(var r=this.pos;this.bufferLength<=r;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var r=this.pos;this.bufferLength<=r;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(r,n,m){for(var d=
r+n;this.bufferLength<=d&&!this.eof;)this.readBlock();return new Stream(this.buffer,r,n,m)},skip:function(r){r||(r=1);this.pos+=r},reset:function(){this.pos=0}};return g}();return function(){function g(c){throw Error(c);}function r(c){var l=0,k=c[l++],f=c[l++];-1!=k&&-1!=f||g("Invalid header in flate stream");8!=(k&15)&&g("Unknown compression method in flate stream");0!=((k<<8)+f)%31&&g("Bad FCHECK in flate stream");f&32&&g("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=l;this.codeBuf=
this.codeSize=0;I.call(this)}if(!self||!self.Uint32Array)return null;var n=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),d=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,
794625,798721,868353,876545]),b=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,
524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,
524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,
524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,
524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,
524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,
524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,
524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];r.prototype=Object.create(I.prototype);r.prototype.getBits=function(c){for(var l=this.codeSize,k=this.codeBuf,f=this.bytes,e=this.bytesPos,h;l<c;)"undefined"==
typeof(h=f[e++])&&g("Bad encoding in flate stream"),k|=h<<l,l+=8;this.codeBuf=k>>c;this.codeSize=l-=c;this.bytesPos=e;return k&(1<<c)-1};r.prototype.getCode=function(c){var l=c[0],k=c[1];c=this.codeSize;for(var f=this.codeBuf,e=this.bytes,h=this.bytesPos;c<k;){var p;"undefined"==typeof(p=e[h++])&&g("Bad encoding in flate stream");f|=p<<c;c+=8}k=l[f&(1<<k)-1];l=k>>16;k&=65535;(0==c||c<l||0==l)&&g("Bad encoding in flate stream");this.codeBuf=f>>l;this.codeSize=c-l;this.bytesPos=h;return k};r.prototype.generateHuffmanTable=
function(c){for(var l=c.length,k=0,f=0;f<l;++f)c[f]>k&&(k=c[f]);for(var e=1<<k,h=new Uint32Array(e),p=1,v=0,t=2;p<=k;++p,v<<=1,t<<=1)for(var q=0;q<l;++q)if(c[q]==p){var w=0,u=v;for(f=0;f<p;++f)w=w<<1|u&1,u>>=1;for(f=w;f<e;f+=t)h[f]=p<<16|q;++v}return[h,k]};r.prototype.readBlock=function(){function c(w,u,y,x,z){for(w=w.getBits(y)+x;0<w--;)u[v++]=z}var l=this.getBits(3);l&1&&(this.eof=!0);l>>=1;if(0==l){var k=this.bytes,f=this.bytesPos,e;"undefined"==typeof(e=k[f++])&&g("Bad block header in flate stream");
var h=e;"undefined"==typeof(e=k[f++])&&g("Bad block header in flate stream");h|=e<<8;"undefined"==typeof(e=k[f++])&&g("Bad block header in flate stream");l=e;"undefined"==typeof(e=k[f++])&&g("Bad block header in flate stream");(l|e<<8)!=(~h&65535)&&g("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;e=this.bufferLength;l=this.ensureBuffer(e+h);this.bufferLength=h=e+h;for(var p=e;p<h;++p){if("undefined"==typeof(e=k[f++])){this.eof=!0;break}l[p]=e}this.bytesPos=f}else{if(1==
l)f=b,e=a;else if(2==l){l=this.getBits(5)+257;e=this.getBits(5)+1;k=this.getBits(4)+4;f=Array(n.length);for(var v=0;v<k;)f[n[v++]]=this.getBits(3);f=this.generateHuffmanTable(f);v=k=0;e=l+e;for(h=Array(e);v<e;)p=this.getCode(f),16==p?c(this,h,2,3,k):17==p?c(this,h,3,3,k=0):18==p?c(this,h,7,11,k=0):h[v++]=k=p;f=this.generateHuffmanTable(h.slice(0,l));e=this.generateHuffmanTable(h.slice(l,e))}else g("Unknown block type in flate stream");h=(l=this.buffer)?l.length:0;for(p=this.bufferLength;;){var t=
this.getCode(f);if(256>t)p+1>=h&&(l=this.ensureBuffer(p+1),h=l.length),l[p++]=t;else{if(256==t){this.bufferLength=p;break}t-=257;t=m[t];var q=t>>16;0<q&&(q=this.getBits(q));k=(t&65535)+q;t=this.getCode(e);t=d[t];q=t>>16;0<q&&(q=this.getBits(q));t=(t&65535)+q;p+k>=h&&(l=this.ensureBuffer(p+k),h=l.length);for(q=0;q<k;++q,++p)l[p]=l[p-t]}}}};return r}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var I=function(){function g(r){this.message="JPEG error: "+r}g.prototype=Error();
g.prototype.name="JpegError";return g.constructor=g}();return function(){function g(){this.decodeTransform=null;this.colorTransform=-1}function r(a,c){for(var l=0,k=[],f,e,h=16;0<h&&!a[h-1];)h--;k.push({children:[],index:0});var p=k[0],v;for(f=0;f<h;f++){for(e=0;e<a[f];e++){p=k.pop();for(p.children[p.index]=c[l];0<p.index;)p=k.pop();p.index++;for(k.push(p);k.length<=f;)k.push(v={children:[],index:0}),p.children[p.index]=v.children,p=v;l++}f+1<h&&(k.push(v={children:[],index:0}),p.children[p.index]=
v.children,p=v)}return k[0].children}function n(a,c,l,k,f,e,h,p,v){function t(){if(0<G)return G--,C>>G&1;C=a[c++];if(255===C){var D=a[c++];if(D)throw new I("unexpected marker "+(C<<8|D).toString(16));}G=7;return C>>>7}function q(D){for(;;){D=D[t()];if("number"===typeof D)return D;if("object"!==typeof D)throw new I("invalid huffman sequence");}}function w(D){for(var L=0;0<D;)L=L<<1|t(),D--;return L}function u(D){if(1===D)return 1===t()?1:-1;var L=w(D);return L>=1<<D-1?L:L+(-1<<D)+1}function y(D,L){var K=
q(D.huffmanTableDC);K=0===K?0:u(K);D.blockData[L]=D.pred+=K;for(K=1;64>K;){var Q=q(D.huffmanTableAC),P=Q&15;Q>>=4;if(0===P){if(15>Q)break;K+=16}else K+=Q,D.blockData[L+b[K]]=u(P),K++}}function x(D,L){var K=q(D.huffmanTableDC);K=0===K?0:u(K)<<v;D.blockData[L]=D.pred+=K}function z(D,L){D.blockData[L]|=t()<<v}function B(D,L){if(0<H)H--;else for(var K=e;K<=h;){var Q=q(D.huffmanTableAC),P=Q&15;Q>>=4;if(0===P){if(15>Q){H=w(Q)+(1<<Q)-1;break}K+=16}else K+=Q,D.blockData[L+b[K]]=u(P)*(1<<v),K++}}function E(D,
L){for(var K=e,Q=0,P;K<=h;){P=b[K];switch(N){case 0:Q=q(D.huffmanTableAC);P=Q&15;Q>>=4;if(0===P)15>Q?(H=w(Q)+(1<<Q),N=4):(Q=16,N=1);else{if(1!==P)throw new I("invalid ACn encoding");M=u(P);N=Q?2:3}continue;case 1:case 2:D.blockData[L+P]?D.blockData[L+P]+=t()<<v:(Q--,0===Q&&(N=2===N?3:0));break;case 3:D.blockData[L+P]?D.blockData[L+P]+=t()<<v:(D.blockData[L+P]=M<<v,N=0);break;case 4:D.blockData[L+P]&&(D.blockData[L+P]+=t()<<v)}K++}4===N&&(H--,0===H&&(N=0))}var F=l.mcusPerLine,A=c,C=0,G=0,H=0,N=0,M,
R=k.length,S,U,Y,Z;p=l.progressive?0===e?0===p?x:z:0===p?B:E:y;var J=0;l=1===R?k[0].blocksPerLine*k[0].blocksPerColumn:F*l.mcusPerColumn;for(var O,T;J<l;){var W=f?Math.min(l-J,f):l;for(S=0;S<R;S++)k[S].pred=0;H=0;if(1===R){var X=k[0];for(Z=0;Z<W;Z++)p(X,64*((X.blocksPerLine+1)*(J/X.blocksPerLine|0)+J%X.blocksPerLine)),J++}else for(Z=0;Z<W;Z++){for(S=0;S<R;S++)for(X=k[S],O=X.h,T=X.v,U=0;U<T;U++)for(Y=0;Y<O;Y++)p(X,64*((X.blocksPerLine+1)*((J/F|0)*X.v+U)+(J%F*X.h+Y)));J++}G=0;(X=d(a,c))&&X.invalid&&
(console.log("decodeScan - unexpected MCU data, next marker is: "+X.invalid),c=X.offset);X=X&&X.marker;if(!X||65280>=X)throw new I("marker was not found");if(65488<=X&&65495>=X)c+=2;else break}(X=d(a,c))&&X.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+X.invalid),c=X.offset);return c-A}function m(a,c){a=c.blocksPerLine;for(var l=c.blocksPerColumn,k=new Int16Array(64),f=0;f<l;f++)for(var e=0;e<a;e++){var h=void 0,p=void 0,v=void 0,t=void 0,q=void 0,w=void 0,u=void 0,y=
void 0,x=q=w=t=p=h=void 0,z=void 0,B=void 0,E=void 0,F=64*((c.blocksPerLine+1)*f+e),A=k,C=c.quantizationTable,G=c.blockData;if(!C)throw new I("missing required Quantization Table.");for(var H=0;64>H;H+=8)h=G[F+H],y=G[F+H+1],u=G[F+H+2],w=G[F+H+3],q=G[F+H+4],t=G[F+H+5],v=G[F+H+6],p=G[F+H+7],h*=C[H],0===(y|u|w|q|t|v|p)?(h=5793*h+512>>10,A[H]=h,A[H+1]=h,A[H+2]=h,A[H+3]=h,A[H+4]=h,A[H+5]=h,A[H+6]=h,A[H+7]=h):(y*=C[H+1],u*=C[H+2],w*=C[H+3],q*=C[H+4],t*=C[H+5],v*=C[H+6],p*=C[H+7],E=5793*h+128>>8,B=5793*
q+128>>8,z=u,x=v,q=2896*(y-p)+128>>8,p=2896*(y+p)+128>>8,w<<=4,t<<=4,E=E+B+1>>1,B=E-B,h=3784*z+1567*x+128>>8,z=1567*z-3784*x+128>>8,x=h,q=q+t+1>>1,t=q-t,p=p+w+1>>1,w=p-w,E=E+x+1>>1,x=E-x,B=B+z+1>>1,z=B-z,h=2276*q+3406*p+2048>>12,q=3406*q-2276*p+2048>>12,p=h,h=799*w+4017*t+2048>>12,w=4017*w-799*t+2048>>12,t=h,A[H]=E+p,A[H+7]=E-p,A[H+1]=B+t,A[H+6]=B-t,A[H+2]=z+w,A[H+5]=z-w,A[H+3]=x+q,A[H+4]=x-q);for(C=0;8>C;++C)h=A[C],y=A[C+8],u=A[C+16],w=A[C+24],q=A[C+32],t=A[C+40],v=A[C+48],p=A[C+56],0===(y|u|w|q|
t|v|p)?(h=5793*h+8192>>14,h=-2040>h?0:2024<=h?255:h+2056>>4,G[F+C]=h,G[F+C+8]=h,G[F+C+16]=h,G[F+C+24]=h,G[F+C+32]=h,G[F+C+40]=h,G[F+C+48]=h,G[F+C+56]=h):(E=5793*h+2048>>12,B=5793*q+2048>>12,z=u,x=v,q=2896*(y-p)+2048>>12,p=2896*(y+p)+2048>>12,E=(E+B+1>>1)+4112,B=E-B,h=3784*z+1567*x+2048>>12,z=1567*z-3784*x+2048>>12,x=h,q=q+t+1>>1,t=q-t,p=p+w+1>>1,w=p-w,E=E+x+1>>1,x=E-x,B=B+z+1>>1,z=B-z,h=2276*q+3406*p+2048>>12,q=3406*q-2276*p+2048>>12,p=h,h=799*w+4017*t+2048>>12,w=4017*w-799*t+2048>>12,t=h,h=E+p,p=
E-p,y=B+t,v=B-t,u=z+w,t=z-w,w=x+q,q=x-q,h=16>h?0:4080<=h?255:h>>4,y=16>y?0:4080<=y?255:y>>4,u=16>u?0:4080<=u?255:u>>4,w=16>w?0:4080<=w?255:w>>4,q=16>q?0:4080<=q?255:q>>4,t=16>t?0:4080<=t?255:t>>4,v=16>v?0:4080<=v?255:v>>4,p=16>p?0:4080<=p?255:p>>4,G[F+C]=h,G[F+C+8]=y,G[F+C+16]=u,G[F+C+24]=w,G[F+C+32]=q,G[F+C+40]=t,G[F+C+48]=v,G[F+C+56]=p)}return c.blockData}function d(a,c,l){var k=a.length-1;l=l<c?l:c;if(c>=k)return null;var f=a[c]<<8|a[c+1];if(65472<=f&&65534>=f)return{invalid:null,marker:f,offset:c};
for(c=a[l]<<8|a[l+1];!(65472<=c&&65534>=c);){if(++l>=k)return null;c=a[l]<<8|a[l+1]}return{invalid:f.toString(16),marker:c,offset:l}}if(!self||!self.Uint8ClampedArray)return null;var b=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);g.prototype={parse:function(a){function c(){var C=a[f]<<8|a[f+1];f+=2;return C}function l(){var C=c();C=f+C-2;var G=
d(a,C,f);G&&G.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+G.invalid),C=G.offset);C=a.subarray(f,C);f+=C.length;return C}function k(C){for(var G=Math.ceil(C.samplesPerLine/8/C.maxH),H=Math.ceil(C.scanLines/8/C.maxV),N=0;N<C.components.length;N++){A=C.components[N];var M=Math.ceil(Math.ceil(C.samplesPerLine/8)*A.h/C.maxH),R=Math.ceil(Math.ceil(C.scanLines/8)*A.v/C.maxV);A.blockData=new Int16Array(64*H*A.v*(G*A.h+1));A.blocksPerLine=M;A.blocksPerColumn=R}C.mcusPerLine=
G;C.mcusPerColumn=H}var f=0,e=null,h=null,p=[],v=[],t=[],q=c();if(65496!==q)throw new I("SOI not found");for(q=c();65497!==q;){switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=l();65504===q&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(e={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],
thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])});65518===q&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&(h={version:w[5]<<8|w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:q=c()+f-2;for(var u;f<q;){var y=a[f++],x=new Uint16Array(64);if(0===y>>4)for(w=0;64>w;w++)u=b[w],x[u]=a[f++];else if(1===y>>4)for(w=0;64>w;w++)u=b[w],x[u]=c();else throw new I("DQT - invalid table spec");p[y&15]=x}break;case 65472:case 65473:case 65474:if(z)throw new I("Only single frame JPEGs supported");
c();var z={};z.extended=65473===q;z.progressive=65474===q;z.precision=a[f++];z.scanLines=c();z.samplesPerLine=c();z.components=[];z.componentIds={};w=a[f++];for(q=x=y=0;q<w;q++){u=a[f];var B=a[f+1]>>4;var E=a[f+1]&15;y<B&&(y=B);x<E&&(x=E);B=z.components.push({h:B,v:E,quantizationId:a[f+2],quantizationTable:null});z.componentIds[u]=B-1;f+=3}z.maxH=y;z.maxV=x;k(z);break;case 65476:u=c();for(q=2;q<u;){y=a[f++];x=new Uint8Array(16);for(w=B=0;16>w;w++,f++)B+=x[w]=a[f];E=new Uint8Array(B);for(w=0;w<B;w++,
f++)E[w]=a[f];q+=17+B;(0===y>>4?t:v)[y&15]=r(x,E)}break;case 65501:c();var F=c();break;case 65498:c();u=a[f++];w=[];for(q=0;q<u;q++){y=z.componentIds[a[f++]];var A=z.components[y];y=a[f++];A.huffmanTableDC=t[y>>4];A.huffmanTableAC=v[y&15];w.push(A)}q=a[f++];u=a[f++];y=a[f++];q=n(a,f,z,w,F,q,u,y>>4,y&15);f+=q;break;case 65535:255!==a[f]&&f--;break;default:if(255===a[f-3]&&192<=a[f-2]&&254>=a[f-2])f-=3;else throw new I("unknown marker "+q.toString(16));}q=c()}this.width=z.samplesPerLine;this.height=
z.scanLines;this.jfif=e;this.eof=f;this.adobe=h;this.components=[];for(q=0;q<z.components.length;q++){A=z.components[q];if(e=p[A.quantizationId])A.quantizationTable=e;this.components.push({output:m(z,A),scaleX:A.h/z.maxH,scaleY:A.v/z.maxV,blocksPerLine:A.blocksPerLine,blocksPerColumn:A.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(a,c){var l=this.width/a,k=this.height/c,f,e,h=0,p=this.components.length,v=a*c*p,t=new Uint8ClampedArray(v),q=new Uint32Array(a);
for(e=0;e<p;e++){var w=this.components[e];var u=w.scaleX*l;var y=w.scaleY*k;h=e;var x=w.output;var z=w.blocksPerLine+1<<3;for(f=0;f<a;f++)w=0|f*u,q[f]=(w&4294967288)<<3|w&7;for(u=0;u<c;u++)for(w=0|u*y,w=z*(w&4294967288)|(w&7)<<3,f=0;f<a;f++)t[h]=x[w+q[f]],h+=p}if(c=this.decodeTransform)for(e=0;e<v;)for(a=w=0;w<p;w++,e++,a+=2)t[e]=(t[e]*c[a]>>8)+c[a+1];return t},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===
this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,l,k,f=0,e=a.length;f<e;f+=3)c=a[f],l=a[f+1],k=a[f+2],a[f]=c-179.456+1.402*k,a[f+1]=c+135.459-.344*l-.714*k,a[f+2]=c-226.816+1.772*l;return a},_convertYcckToRgb:function(a){for(var c,l,k,f,e=0,h=0,p=a.length;h<p;h+=4)c=a[h],l=a[h+1],k=a[h+2],f=a[h+3],a[e++]=-122.67195406894+l*(-6.60635669420364E-5*l+4.37130475926232E-4*k-5.4080610064599E-5*c+4.8449797120281E-4*f-.154362151871126)+k*(-9.57964378445773E-4*k+8.17076911346625E-4*c-.00477271405408747*
f+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*f+.48357088451265)+f*(-3.36197177618394E-4*f+.484791561490776),a[e++]=107.268039397724+l*(2.19927104525741E-5*l-6.40992018297945E-4*k+6.59397001245577E-4*c+4.26105652938837E-4*f-.176491792462875)+k*(-7.78269941513683E-4*k+.00130872261408275*c+7.70482631801132E-4*f-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*f+.25802910206845)+f*(-3.18913117588328E-4*f-.213742400323665),a[e++]=-20.810012546947+l*(-5.70115196973677E-4*
l-2.63409051004589E-5*k+.0020741088115012*c-.00288260236853442*f+.814272968359295)+k*(-1.53496057440975E-5*k-1.32689043961446E-4*c+5.60833691242812E-4*f-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*f+.116935020465145)+f*(-3.43531996510555E-4*f+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,l,k,f=0,e=a.length;f<e;f+=4)c=a[f],l=a[f+1],k=a[f+2],a[f]=434.456-c-1.402*k,a[f+1]=119.541-c+.344*l+.714*k,a[f+2]=481.816-c-1.772*l;return a},_convertCmykToRgb:function(a){for(var c,
l,k,f,e=0,h=1/255,p=0,v=a.length;p<v;p+=4)c=a[p]*h,l=a[p+1]*h,k=a[p+2]*h,f=a[p+3]*h,a[e++]=255+c*(-4.387332384609988*c+54.48615194189176*l+18.82290502165302*k+212.25662451639585*f-285.2331026137004)+l*(1.7149763477362134*l-5.6096736904047315*k-17.873870861415444*f-5.497006427196366)+k*(-2.5217340131683033*k-21.248923337353073*f+17.5119270841813)-f*(21.86122147463605*f+189.48180835922747),a[e++]=255+c*(8.841041422036149*c+60.118027045597366*l+6.871425592049007*k+31.159100130055922*f-79.2970844816548)+
l*(-15.310361306967817*l+17.575251261109482*k+131.35250912493976*f-190.9453302588951)+k*(4.444339102852739*k+9.8632861493405*f-24.86741582555878)-f*(20.737325471181034*f+187.80453709719578),a[e++]=255+c*(.8842522430003296*c+8.078677503112928*l+30.89978309703729*k-.23883238689178934*f-14.183576799673286)+l*(10.49593273432072*l+63.02378494754052*k+50.606957656360734*f-112.23884253719248)+k*(.03296041114873217*k+115.60384449646641*f-193.58209356861505)-f*(22.33816807309886*f+180.12613974708367);return a},
getData:function(a,c,l){if(4<this.numComponents)throw new I("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&l){l=a.length;c=new Uint8ClampedArray(3*l);for(var k=0,f=0;f<l;f++){var e=a[f];c[k++]=e;c[k++]=e;c[k++]=e}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===this.numComponents){if(this._isColorConversionNeeded())return l?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(l)return this._convertCmykToRgb(a)}return a}};
return g}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(I){return function(){function g(n){var m,d;this.data=n;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(d=null;;){var b=this.readUInt32();var a=n=void 0;n=[];for(a=0;4>a;++a)n.push(String.fromCharCode(this.data[this.pos++]));n=n.join("");switch(n){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=
this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":d&&this.animation.frames.push(d);this.pos+=4;d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};n=this.readUInt16();b=this.readUInt16()||
100;d.delay=1E3*n/b;d.disposeOp=this.data[this.pos++];d.blendOp=this.data[this.pos++];d.data=[];break;case "IDAT":case "fdAT":"fdAT"===n&&(this.pos+=4,b-=4);n=(null!=d?d.data:void 0)||this.imgData;for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)n.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(n=0;0<=b?n<b:n>b;0<=b?++n:--n)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=
this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;case "tEXt":a=this.read(b);b=a.indexOf(0);n=String.fromCharCode.apply(String,a.slice(0,b));this.text[n]=String.fromCharCode.apply(String,a.slice(b+1));break;case "IEND":d&&this.animation.frames.push(d);a:{switch(this.colorType){case 0:case 3:case 4:d=1;break a;case 2:case 6:d=3;break a}d=void 0}this.colors=d;this.hasAlphaChannel=4===(m=this.colorType)||6===m;m=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*
m;a:{switch(this.colors){case 1:m="DeviceGray";break a;case 3:m="DeviceRGB";break a}m=void 0}this.colorSpace=m;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}g.load=function(n,m,d){"function"===typeof m&&(d=m);var b=new XMLHttpRequest;b.open("GET",n,!0);b.responseType="arraybuffer";b.onload=function(){var a=new Uint8Array(b.response||b.mozResponseArrayBuffer);a=new g(a);"function"===typeof(null!=
m?m.getContext:void 0)&&a.render(m);return"function"===typeof d?d(a):void 0};return b.send(null)};g.prototype.read=function(n){var m;var d=[];for(m=0;0<=n?m<n:m>n;0<=n?++m:--m)d.push(this.data[this.pos++]);return d};g.prototype.readUInt32=function(){var n=this.data[this.pos++]<<24;var m=this.data[this.pos++]<<16;var d=this.data[this.pos++]<<8;var b=this.data[this.pos++];return n|m|d|b};g.prototype.readUInt16=function(){var n=this.data[this.pos++]<<8;var m=this.data[this.pos++];return n|m};g.prototype.decodePixels=
function(n){var m,d,b,a,c,l,k,f;null==n&&(n=this.imgData);if(0===n.length)return new Uint8Array(0);n=new I(n);n=n.getBytes();var e=this.pixelBitlength/8;var h=e*this.width;var p=new Uint8Array(h*this.height);var v=n.length;for(d=a=c=0;a<v;){switch(n[a++]){case 0:for(b=m=0;m<h;b=m+=1)p[d++]=n[a++];break;case 1:for(b=l=0;l<h;b=l+=1){m=n[a++];var t=b<e?0:p[d-e];p[d++]=(m+t)%256}break;case 2:for(b=t=0;t<h;b=t+=1){m=n[a++];var q=(b-b%e)/e;l=c&&p[(c-1)*h+q*e+b%e];p[d++]=(l+m)%256}break;case 3:for(b=f=0;f<
h;b=f+=1)m=n[a++],q=(b-b%e)/e,t=b<e?0:p[d-e],l=c&&p[(c-1)*h+q*e+b%e],p[d++]=(m+Math.floor((t+l)/2))%256;break;case 4:for(b=f=0;f<h;b=f+=1){m=n[a++];q=(b-b%e)/e;t=b<e?0:p[d-e];0===c?l=k=0:(l=p[(c-1)*h+q*e+b%e],k=q&&p[(c-1)*h+(q-1)*e+b%e]);var w=t+l-k;b=Math.abs(w-t);q=Math.abs(w-l);w=Math.abs(w-k);t=b<=q&&b<=w?t:q<=w?l:k;p[d++]=(m+t)%256}break;default:throw Error("Invalid filter algorithm: "+n[a-1]);}c++}return p};g.prototype.decodePalette=function(){var n,m,d,b,a;var c=this.palette;var l=this.transparency.indexed||
[];var k=new Uint8Array((l.length||0)+c.length);var f=d=n=m=0;for(b=c.length;d<b;f=d+=3)k[m++]=c[f],k[m++]=c[f+1],k[m++]=c[f+2],k[m++]=null!=(a=l[n++])?a:255;return k};g.prototype.copyToImageData=function(n,m){var d,b;var a=this.colors;var c=null;var l=this.hasAlphaChannel;this.palette.length&&(c=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),a=4,l=!0);n=n.data||n;var k=n.length;var f=c||m;d=b=0;if(1===a)for(;d<k;)a=c?4*m[d/4]:b,b=f[a++],n[d++]=b,n[d++]=b,n[d++]=b,n[d++]=
l?f[a++]:this.transparency.grayscale&&this.transparency.grayscale===b?0:255,b=a;else for(;d<k;)a=c?4*m[d/4]:b,n[d++]=f[a++],n[d++]=f[a++],n[d++]=f[a++],n[d++]=l?f[a++]:this.transparency.rgb&&this.transparency.rgb[1]===f[a-3]&&this.transparency.rgb[3]===f[a-2]&&this.transparency.rgb[5]===f[a-1]?0:255,b=a};g.prototype.decode=function(){var n=new Uint8Array(this.width*this.height*4);this.copyToImageData(n,this.decodePixels());return n};var r=function(n){(void 0).clearRect(0,0,n.width,n.height);(void 0).putImageData(n,
0,0);n=new Image;n.src=(void 0).toDataURL();return n};g.prototype.decodeFrames=function(n){var m,d;if(this.animation){var b=this.animation.frames;var a=[];var c=m=0;for(d=b.length;m<d;c=++m){c=b[c];var l=n.createImageData(c.width,c.height);var k=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(l,k);c.imageData=l;a.push(c.image=r(l))}return a}};g.prototype.renderFrame=function(n,m){var d=this.animation.frames;var b=d[m];d=d[m-1];0===m&&n.clearRect(0,0,this.width,this.height);1===(null!=
d?d.disposeOp:void 0)?n.clearRect(d.xOffset,d.yOffset,d.width,d.height):2===(null!=d?d.disposeOp:void 0)&&n.putImageData(d.imageData,d.xOffset,d.yOffset);0===b.blendOp&&n.clearRect(b.xOffset,b.yOffset,b.width,b.height);return n.drawImage(b.image,b.xOffset,b.yOffset)};g.prototype.animate=function(n){var m,d=this;var b=0;var a=this.animation;var c=a.numFrames;var l=a.frames;var k=a.numPlays;return(m=function(){var f=b++%c;var e=l[f];d.renderFrame(n,f);if(1<c&&b/c<k)return d.animation._timeout=setTimeout(m,
e.delay)})()};g.prototype.stopAnimation=function(){var n;return clearTimeout(null!=(n=this.animation)?n._timeout:void 0)};g.prototype.render=function(n){n._png&&n._png.stopAnimation();n._png=this;n.width=this.width;n.height=this.height;n=n.getContext("2d");if(this.animation)return this.decodeFrames(n),this.animate(n);var m=n.createImageData(this.width,this.height);this.copyToImageData(m,this.decodePixels());return n.putImageData(m,0,0)};return g}()})},"esri/layers/rasterFormats/Raw":function(){define([],
function(){return{decodeBIP:function(I,g){var r=g.pixelType,n=g.bandCount,m=[],d=g.width*g.height,b=this.getBandCount(I,g);n=n||b;var a=I.byteLength-I.byteLength%(d*this._getPixelLength(r)),c=new r(I,0,d*b),l,k,f;for(l=0;l<n;l++){var e=new r(d);for(k=0;k<d;k++)e[k]=c[k*b+l];m.push(e)}a<I.byteLength-1&&(f=this._decodeMask(I.slice(a),g));return{pixels:m,maskData:f}},decodeBSQ:function(I,g){var r=g.pixelType,n=g.bandCount;if(void 0===n||null===n)n=this.getBandCount(I,g);var m=[],d=g.width*g.height,b=
d*n,a=I.byteLength-I.byteLength%(d*this._getPixelLength(r));r=new r(I,0,b);var c;for(b=0;b<n;b++)m.push(r.subarray(b*d,(b+1)*d));a<I.byteLength-1&&(c=this._decodeMask(I.slice(a),g));return{pixels:m,maskData:c}},getBandCount:function(I,g){return Math.floor(I.byteLength/(g.width*g.height*this._getPixelLength(g.pixelType)))},_getPixelLength:function(I){var g=1;switch(I){case Uint8Array:case Int8Array:case Uint8ClampedArray:g=1;break;case Uint16Array:case Int16Array:g=2;break;case Uint32Array:case Int32Array:case Float32Array:g=
4;break;case Float64Array:g=8}return g},_decodeMask:function(I,g){var r=g.width*g.height;if(8*I.byteLength<r)return null;I=new Uint8Array(I,0,Math.ceil(r/8));g=new Uint8Array(g.width*g.height);var n=0,m=0,d=0,b=0;for(d=0;d<I.length-1;d++)for(m=I[d],b=7;0<=b;b--)g[n++]=m>>b&1;for(b=7;n<r-1;)m=I[I.length-1],g[n++]=m>>b&1,b--;return g}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(I,g){var r=function(){var b=new ArrayBuffer(4),a=new Uint8Array(b);b=new Uint32Array(b);
a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===b[0]},n=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]="CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";
b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";
b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]="INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";
b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]="YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34735]="GEOKEYDIRECTORY";b[34736]=
"GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";return b}(),m=[0,1,1,2,4,8,1,1,2,4,8,4,8],d=function(b,a){var c="UNKNOWN";3===b?c="F32":1===b?8>=a?c="U8":16>=a?c="U16":32>=a&&(c="U32"):2===b&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(b){var a=new DataView(b,0,8),c=a.getUint16(0,!1);if(18761===c)var l=!0;else if(19789===c)l=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,l))throw"unexpected tiff identifier";var k=a.getUint32(4,l);var f=l;var e,h;var p=
k;for(var v=[];p;){var t=(new DataView(b,p,2)).getUint16(0,f);var q=p+2;p=(new DataView(b,q+12*t,4)).getUint32(0,f);var w={};for(e=0;e<t;e++){var u=new DataView(b,q,12);var y=u.getUint16(0,f);var x=u.getUint16(2,f);var z=u.getUint32(4,f);var B=u.getUint32(8,f);q+=12;if(!(7===x||12<x)){var E=h={fieldTag:y,fieldType:x,fieldValueCount:z,fieldValueOffset:B},F=void 0,A=void 0,C=b,G=f,H=[],N=h.fieldType,M=h.fieldValueCount,R=h.fieldValueOffset,S=R,U=m[N],Y=8*U,Z=M*U,J=M*m[N]*8;if(32>=J)if(G||(R>>>=32-J),
1===M)H=[R];else for(F=0;F<M;F++)H.push(R<<Y*F>>>32-Y);else for(S=R;S<R+Z;S+=U){switch(N){case 1:A=(new DataView(C,S,1)).getUint8(0);break;case 2:A=(new DataView(C,S,1)).getUint8(0);break;case 3:A=(new DataView(C,S,2)).getUint16(0,G);break;case 4:A=(new DataView(C,S,4)).getUint32(0,G);break;case 5:A=(new DataView(C,S,4)).getUint32(0,G)/(new DataView(C,S+4,4)).getUint32(0,G);break;case 6:A=(new DataView(C,S,1)).getInt8(0);break;case 8:A=(new DataView(C,S,2)).getInt16(0,G);break;case 9:A=(new DataView(C,
S,4)).getInt32(0,G);break;case 10:A=(new DataView(C,S,4)).getInt32(0,G)/(new DataView(C,S+4,4)).getInt32(0,G);break;case 11:A=(new DataView(C,S,4)).getFloat32(0,G);break;case 12:A=(new DataView(C,S,8)).getFloat64(0,G);break;case 7:A=null;break;default:A=null}H.push(A)}if(2===N){var O="",T=H;H=[];for(F=0;F<T.length;F++)0===T[F]&&""!==O?(H.push(O),O=""):O+=String.fromCharCode(T[F]);""===O&&0!==H.length||H.push(O)}E.fieldValues=H;var W=w,X=n[y];void 0===X&&(X="unknown"+y);W[X]={type:x,values:h.fieldValues}}}v.push(w)}if(0===
v.length)throw"no valid image file directory";var D,L=v[0],K=void 0===L.GDAL_NODATA||null===L.GDAL_NODATA?null:parseFloat(L.GDAL_NODATA.values[0]);if(L.TILEOFFSETS){var Q=r()===f,P=L.TILEOFFSETS?L.TILEOFFSETS.values:void 0;if(void 0===P)var V=void 0;else{var aa=L.TILEBYTECOUNTS.values,ba=L.TILEWIDTH.values[0],la=L.TILELENGTH.values[0],qa=L.IMAGEWIDTH.values[0],Sa=L.IMAGELENGTH.values[0],ra=qa*Sa,ma=L.BITSPERSAMPLE.values[0],ha=L.SAMPLESPERPIXEL.values[0],Ea=L.SAMPLEFORMAT?L.SAMPLEFORMAT.values[0]:
1,Ma=d(Ea,ma);if(1!==(L.PLANARCONFIGURATION?L.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var pa=L.COMPRESSION?L.COMPRESSION.values[0]:1;if(1!==pa&&6!==pa&&8!==pa&&32946!==pa)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";if(3<Ea)V=void 0;else{if(3===Ea){var sa=new Float32Array(ra*ha);var wa=Float32Array}else 1===Ea?8>=ma?(sa=new Uint8Array(ra*
ha),wa=Uint8Array):16>=ma?(sa=new Uint16Array(ra*ha),wa=Uint16Array):32>=ma&&(sa=new Uint32Array(ra*ha),wa=Uint32Array):2===Ea&&(8>=ma?(sa=new Int8Array(ra*ha),wa=Int8Array):16>=ma?(sa=new Int16Array(ra*ha),wa=Int16Array):32>=ma&&(sa=new Int32Array(ra*ha),wa=Int32Array));var da,Fa,ia,Ga,Ta,Ya=Math.ceil(qa/ba);if(0===ma%8)for(da=0;da<P.length;da++){var Za=Math.floor(da/Ya)*la;var $a=da%Ya*ba;var ab=(Za*qa+$a)*ha;if("U8"===Ma||"S8"===Ma||Q)if(8===pa||32946===pa){var ea=new Uint8Array(b,P[da],aa[da]);
var Ua=new g(ea);var bb=Ua.getBytes();var ta=new ArrayBuffer(bb.length);ea=new Uint8Array(ta);ea.set(bb);ea.length!==ba*la*ha*ma/8&&console.log("tile byte counts is different than expected")}else if(6===pa){ea=new Uint8Array(b,P[da],aa[da]);var Na=new I;Na.parse(ea);var cb=Na.getData(Na.width,Na.height);ta=new ArrayBuffer(cb.length);ea=new Uint8Array(ta);ea.set(cb)}else 1===pa&&(aa[da]!==ba*la*ha*ma/8&&console.log("tile byte counts is different than expected"),ta=b.slice(P[da],P[da]+aa[da]));else{if(8===
pa||32946===pa){ea=new Uint8Array(b,P[da],aa[da]);Ua=new g(ea);ea=Ua.getBytes();ta=new ArrayBuffer(ea.length);var Ca=new Uint8Array(ta);ea.length!==ba*la*ha*ma/8&&console.log("tile byte counts is different than expected")}else 1===pa&&(aa[da]!==ba*la*ha*ma/8&&console.log("tile byte counts is different than expected"),ta=new ArrayBuffer(aa[da]),ea=new Uint8Array(b,P[da],aa[da]),Ca=new Uint8Array(ta));switch(Ma){case "U16":case "S16":for(ia=0;ia<ea.length;ia+=2)Ca[ia]=ea[ia+1],Ca[ia+1]=ea[ia];break;
case "U32":case "S32":case "F32":for(ia=0;ia<ea.length;ia+=4)Ca[ia]=ea[ia+3],Ca[ia+1]=ea[ia+2],Ca[ia+2]=ea[ia+1],Ca[ia+3]=ea[ia]}}var hb=new wa(ta);var Va=0;var Wa=ab;var ib=Math.min(ba,qa-$a);var jb=Math.min(la,Sa-Za);for(Ga=0;Ga<jb;Ga++)for(Wa=ab+Ga*qa*ha,Va=Ga*ba*ha,Ta=0;Ta<ib*ha;Ta++,Wa++,Va++)sa[Wa]=hb[Va]}var Oa={width:qa,height:Sa,pixelType:Ma};if(1===ha)Oa.pixels=[sa];else for(Oa.pixels=[],da=0;da<ha;da++){var db=new wa(ra);for(Fa=0;Fa<ra;Fa++)db[Fa]=sa[Fa*ha+da];Oa.pixels.push(db)}V=Oa}}}else if(L.STRIPOFFSETS){var kb=
r()===f,xa=L.STRIPOFFSETS?L.STRIPOFFSETS.values:void 0;if(void 0===xa)V=void 0;else{var ya=L.STRIPBYTECOUNTS.values,Ha=L.ROWSPERSTRIP.values,za=L.IMAGEWIDTH.values[0],Ia=L.IMAGELENGTH.values[0],Aa=za*Ia,na=L.BITSPERSAMPLE.values[0],ka=L.SAMPLESPERPIXEL.values[0],Ja=L.SAMPLEFORMAT?L.SAMPLEFORMAT.values[0]:1,Pa=d(Ja,na);if(1!==(L.PLANARCONFIGURATION?L.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var oa=L.COMPRESSION?
L.COMPRESSION.values[0]:1;if(1!==oa&&6!==oa&&8!==oa&&32946!==oa)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ja)V=void 0;else{if(3===Ja){var ua=new Float32Array(Aa*ka);var Ba=Float32Array}else 1===Ja?8>=na?(ua=new Uint8Array(Aa*ka),Ba=Uint8Array):16>=na?(ua=new Uint16Array(Aa*ka),Ba=Uint16Array):32>=na&&(ua=new Uint32Array(Aa*ka),Ba=Uint32Array):2===Ja&&(8>=na?(ua=new Int8Array(Aa*ka),Ba=Int8Array):16>=na?(ua=new Int16Array(Aa*
ka),Ba=Int16Array):32>=na&&(ua=new Int32Array(za*Ia*ka),Ba=Int32Array));var ca,Ka,ja,La=Ha;if(0===na%8)for(ca=0;ca<xa.length;ca++){var lb=ca*Ha*za*ka;La=(ca+1)*Ha>Ia?Ia-ca*Ha:Ha;if("U8"===Pa||"S8"===Pa||kb)if(8===oa||32946===oa){var fa=new Uint8Array(b,xa[ca],ya[ca]);var Xa=new g(fa);var eb=Xa.getBytes();var va=new ArrayBuffer(eb.length);fa=new Uint8Array(va);fa.set(eb);fa.length!==La*za*ka*na/8&&console.log("strip byte counts is different than expected")}else if(6===oa){fa=new Uint8Array(b,xa[ca],
ya[ca]);var Qa=new I;Qa.parse(fa);var fb=Qa.getData(Qa.width,Qa.height);va=new ArrayBuffer(fb.length);fa=new Uint8Array(va);fa.set(fb)}else 1===oa&&(ya[ca]!==La*za*ka*na/8&&console.log("strip byte counts is different than expected"),va=b.slice(xa[ca],xa[ca]+ya[ca]));else{if(6===oa||8===oa||32946===oa){fa=new Uint8Array(b,xa[ca],ya[ca]);Xa=new g(fa);fa=Xa.getBytes();va=new ArrayBuffer(fa.length);var Da=new Uint8Array(va);fa.length!==La*za*ka*na/8&&console.log("strip byte counts is different than expected")}else 1===
oa&&(ya[ca]!==La*za*ka*na/8&&console.log("strip byte counts is different than expected"),va=new ArrayBuffer(ya[ca]),fa=new Uint8Array(b,xa[ca],ya[ca]),Da=new Uint8Array(va));switch(Pa){case "U16":case "S16":for(ja=0;ja<fa.length;ja+=2)Da[ja]=fa[ja+1],Da[ja+1]=fa[ja];break;case "U32":case "S32":case "F32":for(ja=0;ja<fa.length;ja+=4)Da[ja]=fa[ja+3],Da[ja+1]=fa[ja+2],Da[ja+2]=fa[ja+1],Da[ja+3]=fa[ja]}}var mb=new Ba(va);ua.set(mb,lb)}var Ra={width:za,height:Ia,pixelType:Pa};if(1===ka)Ra.pixels=[ua];
else for(Ra.pixels=[],ca=0;ca<ka;ca++){var gb=new Ba(Aa);for(Ka=0;Ka<Aa;Ka++)gb[Ka]=ua[Ka*ka+ca];Ra.pixels.push(gb)}V=Ra}}}if(null!==K){V.maskData=new Uint8Array(V.width*V.height);if(1E24<Math.abs(K))for(D=0;D<V.width*V.height;D++)V.maskData[D]=1E-6>Math.abs((V.pixels[0][D]-K)/K)?0:1;else for(D=0;D<V.width*V.height;D++)V.maskData[D]=V.pixels[0][D]===K?0:1;V.noDataValue=K}return V}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f){function e(h){var p=new n;m(h).then(function(v){p.resolve()});return p.promise}return function(){function h(p){this.customModules=p&&p.customModules}h.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};h.prototype.start=function(){this.stop();var p=new n,v=0,t=this.customModules?this.customModules.length+1:1,q=c.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",I,r),w=b.open(q,{client:this}).then(function(u){this._connection=u;v++;
v===t&&(this._connected=!0,p.resolve())}.bind(this));this._openDL=[w];this.customModules&&this.customModules.forEach(function(u){w=b.open(u,{client:this}).then(function(y){v++;v===t&&(this._connected=!0,p.resolve())});this._openDL.push(w);console.log(u)}.bind(this));return this._connectionPromise=p.promise};h.prototype.stop=function(){this._openDL?this._openDL.forEach(function(p){p.isFulfilled()||p.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();
this._connection&&(this._connection.close(),this._connection=null)};h.prototype.decode=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};return this._connection.invoke("decode",p,[],v).then(function(t){t.targetWorker=v;return t})};h.prototype.process=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};p.layerId=this.rasterLayer.layerId;var t=new n;
this._connection.invoke("process",p,[],v).then(function(q){q.targetWorker=v;q.src?Object.keys(q.src).forEach(function(w){q.src[w].pixelBlock=new d(q.src[w].pixelBlock)}):q.src=null;q.pixelBlock&&(q.pixelBlock=new d(q.pixelBlock));t.resolve(q)});return t.promise};h.prototype.render=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};p.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",p,[],v).then(function(t){t.targetWorker=
v;t.pixelBlock=t.pixelBlock?new d(t.pixelBlock):null;return t})};h.prototype.setLayer=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));this.rasterLayer=p;p=this._connection.broadcast("setLayer",p,[],{id:null});return e(p)};h.prototype.setRasterFunction=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));p=this._connection.broadcast("setRasterFunction",p,[],{id:null});return e(p)};
h.prototype.setRasterRenderer=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));p=this._connection.broadcast("setRasterRenderer",p,[],{id:null});return e(p)};return h}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(I,g,r){Object.defineProperty(g,"__esModule",{value:!0});for(var n in r)g.hasOwnProperty(n)||(g[n]=r[n])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(I,g,r,n,m,d,b,a,c){function l(){if(v)return v;for(var t=k+f,q=[],w=function(y){var x=c.create(y).then(function(z){return p[y]=z});q.push(x)},u=0;u<t;u++)w(u);return v=n(q).then(function(){})}Object.defineProperty(g,"__esModule",{value:!0});g.Connection=b;g.RemoteClient=a;(b=navigator.hardwareConcurrency)||(b=r("safari")&&r("mac")||r("trident")?8:2);var k=r("esri-workers-debug")?1:Math.max(1,Math.ceil(b/2)),f=r("esri-workers-debug")?1:Math.max(1,Math.floor(b/2)),e=m.getLogger("esri.core.workers"),
h=0,p=[];g.initialize=function(){l()};g.open=function(t,q,w){void 0===q&&(q={});if(Array.isArray(t))return new g.Connection(t.map(function(x){return new g.RemoteClient(x,q.client)}));if("string"!==typeof t){e.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var u=t;t=q;q={client:u,strategy:w?"dedicated":"distributed"}}var y=q.strategy||"distributed";return"local"===y?d.create(function(x){I([t],function(z){x(g.RemoteClient.connect(z))})}).then(function(x){return new g.Connection([new g.RemoteClient(x,
q.client)])}):l().then(function(){if("dedicated"===y){var x=k+h++;h%=f;return p[x].open(t).then(function(z){return new g.Connection([new g.RemoteClient(z,q.client)])})}return d.all(p.map(function(z){return z.open(t)})).then(function(z){return new g.Connection(z.map(function(B){return new g.RemoteClient(B,q.client)}))})})};g.terminate=function(){for(var t=0;t<p.length;t++)p[t]&&p[t].terminate();p.length=0};var v})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(I,g,r){var n={info:0,warn:1,error:2};I=function(){function m(d){void 0===d&&(d={});this.module=d.module||"";this.writer=d.writer||null;this.level=d.level||null;null!=d.enabled&&(this.enabled=!!d.enabled);m._loggers[this.module]=this;d=this.module.lastIndexOf(".");-1!==d&&(this.parent=m.getLogger(this.module.slice(0,d)))}m.prototype.log=function(d){for(var b=[],a=1;a<arguments.length;a++)b[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(d)&&(a=this._inheritedWriter())&&a.apply(void 0,
[d,this.module].concat(b))};m.prototype.error=function(){for(var d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];this.log.apply(this,["error"].concat(d))};m.prototype.warn=function(){for(var d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];this.log.apply(this,["warn"].concat(d))};m.prototype.info=function(){for(var d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];this.log.apply(this,["info"].concat(d))};m.prototype.getLogger=function(d){return m.getLogger(this.module+"."+d)};m.getLogger=function(d){var b=
m._loggers[d];b||(b=new m({module:d}));return b};m.prototype._parentWithMember=function(d,b){for(var a=this;a&&null==a[d];)a=a.parent;return a?a[d]:b};m.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};m.prototype._consoleWriter=function(d,b){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];console[d].apply(console,["["+b+"]"].concat(a))};m.prototype._matchLevel=function(d){return n[this._parentWithMember("level","error")]<=n[d]};m.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};m._loggers={};return m}();g=I.getLogger("esri");r("dojo-debug-messages")?g.level="info":g.level="warn";return I})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(I,g,r,n,m,d){function b(a){if(a){if("function"!==typeof a.forEach){var c=Object.keys(a),l=c.map(function(h){return a[h]});return b(l).then(function(h){var p={};c.forEach(function(v,
t){return p[v]=h[t]});return p})}var k=new r,f=[],e=a.length;0===e&&k.resolve(f);a.forEach(function(h){var p={promise:h};f.push(p);h.then(function(v){p.value=v}).catch(function(v){p.error=v}).then(function(){--e;0===e&&k.resolve(f)})});return k.promise}}Object.defineProperty(g,"__esModule",{value:!0});g.all=function(a){return m(a)};g.filter=function(a,c){var l=a.slice();return m(a.map(function(k,f){return c(k,f)})).then(function(k){return l.filter(function(f,e){return k[e]})})};g.eachAlways=b;g.create=
function(a,c){var l=new r(c);a(function(k){void 0===k&&(k=null);return n(k).then(l.resolve)},l.reject);return l.promise};g.reject=function(a){var c=new r;c.reject(a);return c.promise};g.resolve=function(a){void 0===a&&(a=null);var c=new r;c.resolve(a);return c.promise};g.after=function(a,c){void 0===c&&(c=null);var l=0,k=new r(function(){l&&(clearTimeout(l),l=0)});l=setTimeout(function(){k.resolve(c)},a);return k.promise};g.timeout=function(a,c,l){var k=0,f=new r(a.cancel);a.then(function(e){f.isFulfilled()||
(f.resolve(e),k&&(clearTimeout(k),k=0))});a.catch(function(e){f.isFulfilled()||(f.reject(e),k&&(clearTimeout(k),k=0))});k=setTimeout(function(){var e=l||new d("promiseUtils:timeout","The wrapped promise did not resolve within "+c+" ms");f.reject(e)},c);return f.promise};g.wrapCallback=function(a){var c=!1,l=new r(function(){return c=!0});a(function(k){c||l.resolve(k)});return l.promise};g.isThenable=function(a){return a&&"function"===typeof a.then};g.when=function(a){return n(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(I,g,r,n,m){I=function(d){function b(a,c,l){var k=d.call(this,a,c,l)||this;return k instanceof b?k:new b(a,c,l)}r(b,d);b.prototype.toJSON=function(){return{name:this.name,message:this.message,details:n.clone(this.details),dojoType:this.dojoType}};b.fromJSON=function(a){var c=new b(a.name,a.message,a.details);null!=a.dojoType&&(c.dojoType=a.dojoType);return c};return b}(m);I.prototype.type="error";return I})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,r){g.__proto__=r}||function(g,r){for(var n in r)r.hasOwnProperty(n)&&(g[n]=r[n])};return function(g,r){function n(){this.constructor=g}I(g,r);g.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(I,g,r,n,
m,d){function b(h){return void 0!==h&&null!==h}function a(h){return b(h)?h:""}function c(h,p,v){var t=v.match(/([^\(]+)(\([^\)]+\))?/i),q=g.trim(t[1]);v=p[h];t=JSON.parse((t[2]?g.trim(t[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var w=t.utcOffset;if(-1===f.indexOf(q))q=g.getObject(q),g.isFunction(q)&&(v=q(v,h,p,t));else if("number"===typeof v||"string"===typeof v&&v&&!isNaN(Number(v)))switch(v=
Number(v),q){case "NumberFormat":h=g.mixin({},t);p=parseFloat(h.places);if(isNaN(p)||0>p)h.places=Infinity;return n.format(v,h);case "DateString":v=new Date(v);if(t.local||t.systemLocale)return t.systemLocale?v.toLocaleDateString()+(t.hideTime?"":" "+v.toLocaleTimeString()):v.toDateString()+(t.hideTime?"":" "+v.toTimeString());v=v.toUTCString();t.hideTime&&(v=v.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return v;case "DateFormat":return v=new Date(v),b(w)&&(v=r.add(v,"minute",v.getTimezoneOffset()-
w)),m.format(v,t)}return a(v)}function l(h,p){var v;if(p)for(v in h)h.hasOwnProperty(v)&&(void 0===h[v]?delete h[v]:h[v]instanceof Object&&l(h[v],!0));else for(v in h)h.hasOwnProperty(v)&&void 0===h[v]&&delete h[v];return h}function k(h){if(!h||"object"!=typeof h||g.isFunction(h))return h;if(h instanceof Int8Array||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Int16Array||h instanceof Int32Array||h instanceof Uint16Array||h instanceof Uint32Array||h instanceof Float32Array||
h instanceof Float64Array||h instanceof Date)return new h.constructor(h);if(h instanceof ArrayBuffer)return h.slice(0,h.byteLength);if("function"===typeof h.clone)h=h.clone();else if("function"===typeof h.map&&"function"===typeof h.forEach)h=h.map(k);else if("function"===typeof h.notifyChange&&"function"===typeof h.watch)h=h.clone();else{var p={},v,t={};for(v in h){var q=h[v];var w=!(v in t)||t[v]!==q;if(!(v in p)||p[v]!==q&&w)p[v]=k?k(q):q}h=p}return h}var f=["NumberFormat","DateString","DateFormat"],
e=/<\/?[^>]+>/g;return{equals:function(h,p){return h===p||"number"===typeof h&&isNaN(h)&&"number"===typeof p&&isNaN(p)||g.isFunction((h||{}).getTime)&&g.isFunction((p||{}).getTime)&&h.getTime()==p.getTime()||g.isFunction((h||{}).equals)&&h.equals(p)||g.isFunction((p||{}).equals)&&p.equals(h)||!1},mixin:g.mixin,valueOf:function(h,p){for(var v in h)if(h[v]==p)return v;return null},stripTags:function(h){if(h){var p=typeof h;if("string"===p)h=h.replace(e,"");else if("object"===p)for(var v in h)(p=h[v])&&
"string"===typeof p&&(p=p.replace(e,"")),h[v]=p}return h},substitute:function(h,p,v){if(b(v))if(g.isObject(v)){var t=v.first;var q=v.dateFormat;var w=v.numberFormat}else t=v;if(p&&"{*}"!==p)return g.replace(p,g.hitch({obj:h},function(y,x){y=x.split(":");return 1<y.length?(x=y[0],y.shift(),c(x,this.obj,y.join(":"))):q&&-1!==(q.properties||[]).indexOf(x)?c(x,this.obj,q.formatter||"DateString"):w&&-1!==(w.properties||[]).indexOf(x)?c(x,this.obj,w.formatter||"NumberFormat"):a(this.obj[x])}));p=[];var u;
p.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+d.fieldsSummary+'"\x3e\x3ctbody\x3e');for(u in h)if(v=h[u],q&&-1!==(q.properties||[]).indexOf(u)?v=c(u,h,q.formatter||"DateString"):w&&-1!==(w.properties||[]).indexOf(u)&&(v=c(u,h,w.formatter||"NumberFormat")),p.push("\x3ctr\x3e\x3cth\x3e"+u+"\x3c/th\x3e\x3ctd\x3e"+a(v)+"\x3c/td\x3e\x3c/tr\x3e"),t)break;p.push("\x3c/tbody\x3e\x3c/table\x3e");return p.join("")},filter:function(h,p,v){p=[g.isString(h)?h.split(""):h,v||I.global,g.isString(p)?
new Function("item","index","array",p):p];v={};var t;h=p[0];for(t in h)p[2].call(p[t],h[t],t,h)&&(v[t]=h[t]);return v},startsWith:function(h,p,v){v=v||0;return h.indexOf(p,v)===v},endsWith:function(h,p,v){if("number"!==typeof v||!isFinite(v)||Math.floor(v)!==v||v>h.length)v=h.length;v-=p.length;h=h.indexOf(p,v);return-1!==h&&h===v},isDefined:b,fixJson:l,clone:k}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(I,g,r){return function(){function n(m,
d,b){this instanceof n&&(this.name=m,this.message=d&&r.substitute(d,b,function(a){return null==a?"":a})||"",this.details=b)}n.prototype.toString=function(){return"["+this.name+"]: "+this.message};return n}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(I,g,r){return function(){function n(m){this._clientIdx=0;this._clients=m}n.prototype.broadcast=function(m,d,b){for(var a=[],c=0,l=this._clients;c<l.length;c++)a.push(l[c].invoke(m,
d,b));return a};n.prototype.close=function(){for(var m=0,d=this._clients;m<d.length;m++)d[m].close();this._clients=[]};n.prototype.invoke=function(m,d,b,a){var c=a&&a.client;if(!this._clients||!this._clients.length)return r.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(l){return l.isBusy()?!1:(c=l,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);m=c.invoke(m,d,b);a&&(a.client=c);return m};n.prototype.openPorts=
function(){return r.all(this._clients.map(function(m){return m.openPort()}))};return n}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(I,g,r,n,m,d){function b(h,p){h["delete"](p)}var a=d.MessageType.CLOSE,c=d.MessageType.CANCEL,l=d.MessageType.INVOKE,k=d.MessageType.RESPONSE,f=d.MessageType.OPEN_PORT,e=function(){function h(p){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=p;this._timer=null;this._process=this._process.bind(this)}h.prototype.push=function(p){p.type===d.MessageType.CANCEL?this._cancelledJobIds.add(p.jobId):(this._invokeMessages.push(p),null===this._timer&&(this._timer=setTimeout(this._process,0)))};h.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};h.prototype._process=function(){this._timer=null;for(var p=0,v=this._invokeMessages;p<v.length;p++){var t=v[p];this._cancelledJobIds.has(t.jobId)||
this._invoke(t)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return h}();return function(){function h(p,v,t){this._outJobs=new Map;this._inJobs=new Map;this._queue=new e(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=v;this._port=p;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=t}h.connect=function(p){var v=new MessageChannel;p="function"===typeof p?new p:"default"in p&&"function"===typeof p.default?new p.default:
p;p.remoteClient=new h(v.port1,p,v);return v.port2};h.prototype.close=function(){this._post({type:a});this._close()};h.prototype.isBusy=function(){return 0<this._outJobs.size};h.prototype.invoke=function(p,v,t){var q=this;if(!this._port)return m.reject(new n("remote-client:port-closed","Can't invoke(), port is closed"));var w=d.newJobId(),u=new r(function(){b(q._outJobs,w);q._post({type:c,jobId:w})});this._outJobs.set(w,u);this._post({type:l,jobId:w,methodName:p},v,t);return u.promise};h.prototype.openPort=
function(){var p=this,v=d.newJobId(),t=new r(function(){b(p._outJobs,v);p._post({type:c,jobId:v})});this._outJobs.set(v,t);this._post({type:f,jobId:v});return t.promise};h.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(p){p.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};h.prototype._onMessage=function(p){if(p=d.receiveMessage(p))switch(p.type){case k:this._onResponse(p);
break;case l:this._queue.push(p);break;case c:this._onCancel(p);break;case a:this._close();break;case f:this._onOpenPort(p)}};h.prototype._onCancel=function(p){var v=this._inJobs,t=p.jobId,q=v.get(t);this._queue.push(p);q&&(b(v,t),q.cancel())};h.prototype._onInvoke=function(p){var v=this,t=p.methodName,q=p.jobId;p=p.data;var w=this._inJobs,u=this._client,y=u[t];try{if(!y&&t&&-1!==t.indexOf("."))for(var x=t.split("."),z=0;z<x.length-1;z++)u=u[x[z]],y=u[x[z+1]];if("function"!==typeof y)throw new TypeError(t+
" is not a function");var B=y.call(u,p,this)}catch(E){this._post({type:k,jobId:q,error:d.toInvokeError(E)});return}m.isThenable(B)?(w.set(q,B),B.then(function(E){w.has(q)&&(b(w,q),v._post({type:k,jobId:q},E))}).catch(function(E){w.has(q)&&(b(w,q),E&&"cancel"===E.dojoType||v._post({type:k,jobId:q,error:d.toInvokeError(E||{message:"Error encountered at method "+t})}))})):this._post({type:k,jobId:q},B)};h.prototype._onOpenPort=function(p){var v=new MessageChannel;new h(v.port1,this._client);this._post({type:k,
jobId:p.jobId},v.port2,[v.port2])};h.prototype._onResponse=function(p){var v=p.jobId,t=p.error;p=p.data;var q=this._outJobs;if(q.has(v)){var w=q.get(v);b(q,v);t?w.reject(n.fromJSON(JSON.parse(t))):w.resolve(p)}};h.prototype._post=function(p,v,t){return d.postMessage(this._port,p,v,t)};return h}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(I,g,r){function n(d){return d&&"object"===typeof d&&("result"in d||"transferList"in d)}Object.defineProperty(g,
"__esModule",{value:!0});(function(d){d[d.HANDSHAKE=0]="HANDSHAKE";d[d.CONFIGURE=1]="CONFIGURE";d[d.CONFIGURED=2]="CONFIGURED";d[d.OPEN=3]="OPEN";d[d.OPENED=4]="OPENED";d[d.RESPONSE=5]="RESPONSE";d[d.INVOKE=6]="INVOKE";d[d.CANCEL=7]="CANCEL";d[d.CLOSE=8]="CLOSE";d[d.OPEN_PORT=9]="OPEN_PORT"})(g.MessageType||(g.MessageType={}));var m=0;g.newJobId=function(){return m++};g.isTranferableResult=n;g.toInvokeError=function(d){return d?d.toJSON?JSON.stringify(d):JSON.stringify({name:d.name,message:d.message,
details:d.details,stack:d.stack}):null};g.postMessage=function(d,b,a,c){2===arguments.length||void 0===a&&void 0===c?d.postMessage(b):(r("esri-workers-supports-transfer-arraybuffer")||(c?(c=c.filter(function(l){return!(l instanceof ArrayBuffer)}),c.length||(c=null)):n(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(l){return!(l instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),c?(b.data=a,d.postMessage(b,c)):n(a)?(b.data=a.result,a.transferList?d.postMessage(b,
a.transferList):d.postMessage(b)):(b.data=a,d.postMessage(b)))};g.receiveMessage=function(d){return d?(d=d.data)?"string"===typeof d?JSON.parse(d):d:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(I,g,r,n,m,d,b,a,c){var l=d.getLogger("esri.core.workers"),k=a.MessageType.CANCEL,f=a.MessageType.INVOKE,e=a.MessageType.OPEN,h=a.MessageType.OPENED,
p=a.MessageType.RESPONSE;return function(){function v(t,q){this._outJobs=new Map;this._inJobs=new Map;this.worker=t;this.id=q;t.addEventListener("message",this._onMessage.bind(this));t.addEventListener("error",function(w){w.preventDefault();l.error(w)})}v.create=function(t){return c.createWorker().then(function(q){return new v(q,t)})};v.prototype.terminate=function(){this.worker.terminate()};v.prototype.open=function(t){var q=this,w=a.newJobId(),u=new r(function(y){q._outJobs["delete"](w);q._post({type:k,
jobId:w})});this._outJobs.set(w,u);this._post({type:e,jobId:w,modulePath:t});return u.promise};v.prototype._onMessage=function(t){if(t=a.receiveMessage(t))switch(t.type){case h:case p:this._onResponse(t);break;case k:this._onCancel(t);break;case f:this._onInvoke(t)}};v.prototype._onCancel=function(t){(t=this._inJobs.get(t.jobId))&&t.cancel()};v.prototype._onInvoke=function(t){var q=this,w=t.methodName,u=t.jobId;t=t.data;var y=this._inJobs,x=n.workerMessages[w];try{if("function"!==typeof x)throw new TypeError(w+
" is not a function");var z=x.call(null,t)}catch(B){this._post({type:p,jobId:u,error:a.toInvokeError(B)});return}b.isThenable(z)?(y.set(u,z),z.then(function(B){y["delete"](u);q._post({type:p,jobId:u},B)}).catch(function(B){y["delete"](u);B||(B={message:"Error encountered at method"+w});B.dojoType&&"cancel"===B.dojoType||q._post({type:p,jobId:u,error:a.toInvokeError(B)})})):this._post({type:p,jobId:u},z)};v.prototype._onResponse=function(t){var q=t.jobId,w=t.error;t=t.data;var u=this._outJobs.get(q);
u&&(this._outJobs["delete"](q),w?u.reject(m.fromJSON(JSON.parse(w))):u.resolve(t))};v.prototype._post=function(t,q,w){return a.postMessage(this.worker,t,q,w)};return v}()})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(I,g,r,n,m,d,b,a,c,l,k,f,e){function h(x){return a.create(function(z){function B(F){if(F=
f.receiveMessage(F))switch(F.type){case y:F=x;var A=m.workers.loaderUrl||k.DEFAULT_LOADER_URL;if(null!=m["default"]){var C=r({},m);delete C["default"];C=JSON.parse(JSON.stringify(C))}else C=JSON.parse(JSON.stringify(m));var G=m.workers.loaderConfig;G=k.default({baseUrl:G.baseUrl,locale:n.locale,has:r({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":c("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":c("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},G.has),map:r({},G.map),paths:r({},G.paths),packages:G.packages||[]});F.postMessage({type:u,configure:{esriConfig:C,loaderUrl:A,loaderConfig:G}});break;case w:x.removeEventListener("message",B),x.removeEventListener("error",E),z(x)}}function E(F){F.preventDefault();x.removeEventListener("message",B);x.removeEventListener("error",E);t.warn("Failed to create Worker. Fallback to execute module in main thread",F);x=new e;x.addEventListener("message",B);x.addEventListener("error",
E)}x.addEventListener("message",B);x.addEventListener("error",E)})}Object.defineProperty(g,"__esModule",{value:!0});var p=l.normalize(I.toUrl("./worker.js")),v=!l.hasSameOrigin(p,location.href),t=b.getLogger("esri.core.workers"),q=null,w=f.MessageType.CONFIGURED,u=f.MessageType.CONFIGURE,y=f.MessageType.HANDSHAKE;g.createWorker=function(){if(!c("esri-workers"))return h(new e);if(!v){var x=void 0;try{x=new Worker(p)}catch(z){t.warn("Failed to create Worker. Fallback to execute module in main thread",
event),x=new e}return h(x)}q||(q=d(p,{responseType:"text"}));return q.then(function(z){return new Worker(URL.createObjectURL(new Blob([z.data],{type:"text/javascript"})))}).catch(function(z){t.warn("Failed to create Worker. Fallback to execute module in main thread",z);return new e}).then(function(z){return h(z)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(I){for(var g,r=1,n=arguments.length;r<n;r++){g=arguments[r];for(var m in g)Object.prototype.hasOwnProperty.call(g,
m)&&(I[m]=g[m])}return I}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(I,g,r){Object.defineProperty(r,"workers",{get:function(){return r.defaults.workers},set:function(n){return r.defaults.workers=n}});return r})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(I,g,r,n,m){return function(d,b){d=n.mixin({},{url:d,failOk:!0},b);"array-buffer"===b.responseType?(d.handleAs=
"arraybuffer",delete d.responseType):b.responseType&&(d.handleAs=b.responseType,delete d.responseType);null!==b.query&&(d.content=d.query,delete d.query);if(b.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:b.allowImageDataAccess};delete d.allowImageDataAccess}var c=new m(function(){l.isFulfilled()||l.cancel()});var l=r(d,a).then(function(k){c.resolve({data:k})}).catch(function(k){k&&null!=k.httpCode&&(k.details=k.details||{},k.details.httpStatus=k.httpCode);c.reject(k)});return c.promise}})},
"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(I,g,r,n,m){function d(){var l={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},k=document.createElement("canvas");if(!k)return l;var f=m.createContext(k,{failIfMajorPerformanceCaveat:!0},"webgl");!f&&(f=m.createContext(k,{},"webgl"))&&
(l.majorPerformanceCaveat=!0);if(!f)return l;k=f.getParameter(f.VERSION);if(!k)return l;if(k=k.match(/^WebGL\s+([\d.]*)/))l.version=parseFloat(k[1]),l.available=.94<=l.version,k=f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT),l.supportsHighPrecisionFragment=k&&0<k.precision,l.supportsVertexShaderSamplers=0<f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l.supportsElementIndexUint=null!==f.getExtension("OES_element_index_uint"),l.supportsStandardDerivatives=null!==f.getExtension("OES_standard_derivatives");
return l}function b(){var l={available:!1,version:0},k=document.createElement("canvas");if(!k)return l;k=m.createContext(k,{},"webgl2");if(!k)return l;l.available=!0;k=k.getParameter(k.VERSION);if(!k)return l;if(k=k.match(/^WebGL\s+([\d.]*)/))l.version=parseFloat(k[1]);return l}(function(){var l=navigator.userAgent,k=l.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);l=l.match(/iPhone/i);k&&r.add("esri-mobile",k);l&&r.add("esri-iPhone",l);r.add("esri-phonegap",!!n.cordova);
r.add("esri-cors",r("esri-phonegap")||"XMLHttpRequest"in n&&"withCredentials"in new XMLHttpRequest);r.add("esri-geolocation",function(){return!!navigator.geolocation});r.add("esri-canvas-svg-support",function(){return!(r("trident")||r("ie"))});r.add("esri-secure-context",function(){if("isSecureContext"in n)return n.isSecureContext;if(n.location&&n.location.origin)return 0===n.location.origin.indexOf("https:")});r.add("esri-wasm","WebAssembly"in n);r("host-webworker")||(r.add("esri-workers","Worker"in
n),r.add("esri-script-sandbox",function(){return"MessageChannel"in n&&"HTMLIFrameElement"in n&&"sandbox"in HTMLIFrameElement.prototype}),r.add("esri-url-encodes-apostrophe",function(){var f=n.document.createElement("a");f.href="?'";return-1<f.href.indexOf("?%27")}),a||(a=d()),r.add("esri-webgl",a.available),r.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),r.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),r.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
r.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),r.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),r.add("esri-featurelayer-webgl-labeling",!0),c||(c=b()),r.add("esri-webgl2",c.available))})();var a=null,c=null;return r})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(I,g){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(I,g){function r(b,a,c){void 0===a&&(a={});switch(c){case "webgl":var l=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":l=["webgl2"];break;default:l=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}c=null;for(var k=0;k<l.length;k++){var f=l[k];try{c=b.getContext(f,a)}catch(e){}if(c)break}return c}function n(b,a){(b=b.parentNode)&&(b.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(g,"__esModule",{value:!0});g.createContextOrErrorHTML=function(b,a,c){void 0===a&&(a={});if(!window.WebGLRenderingContext)return n(b,m),null;a=r(b,a,c);return a?a:(n(b,d),null)};g.createContext=r;var m='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',d='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(I,g,r,n){function m(u){return r.normalize(u)}function d(u){return"data:"===u.slice(0,5)}function b(u){return a(u)||q.test(u)}function a(u){return u&&"/"===u[0]&&"/"===u[1]}function c(u){return r.urlToObject(u)}function l(u){if("string"===typeof u)return new n(f(u));u.scheme||(u.scheme=g.appUrl.scheme);return u}function k(u){if(d(u))return null;var y=u.indexOf("://");if(-1===y&&
a(u))y=2;else if(-1!==y)y+=3;else return null;y=u.indexOf("/",y);return-1===y?u:u.slice(0,y)}function f(u,y,x){void 0===y&&(y=g.appBaseUrl);if(a(u))return x&&x.preserveProtocolRelative?u:"http"===g.appUrl.scheme&&g.appUrl.authority===k(u).slice(2)?"http:"+u:"https:"+u;if(q.test(u))return u;x=h;if("/"===u[0]){var z=y.indexOf("//");z=y.indexOf("/",z+2);y=-1===z?y:y.slice(0,z)}return x(y,u)}function e(u,y,x){void 0===x&&(x=!1);u=l(u);y=l(y);return x||u.scheme===y.scheme?u.host.toLowerCase()===y.host.toLowerCase()&&
u.port===y.port:!1}function h(){for(var u=[],y=0;y<arguments.length;y++)u[y]=arguments[y];if(u&&u.length){y=[];if(b(u[0])){var x=u[0],z=x.indexOf("//");y.push(x.slice(0,z+1));t.test(u[0])&&(y[0]+="/");u[0]=x.slice(z+2)}else"/"===u[0][0]&&y.push("");u=u.reduce(function(B,E){return E?B.concat(E.split("/")):B},[]);for(x=0;x<u.length;x++)z=u[x],".."===z&&0<y.length?y.pop():!z||"."===z&&0!==y.length||y.push(z);return y.join("/")}}function p(u,y,x){if(!(y&&x&&u&&b(u)))return u;var z=u.indexOf("//"),B=u.indexOf("/",
z+2),E=u.indexOf(":",z+2);B=Math.min(0>B?u.length:B,0>E?u.length:E);if(u.slice(z+2,B).toLowerCase()!==y.toLowerCase())return u;y=u.slice(0,z+2);u=u.slice(B);return""+y+x+u}function v(u,y,x){void 0===y&&(y=g.appBaseUrl);if(!b(u))return u;var z=m(u),B=z.toLowerCase();y=m(y).toLowerCase().replace(/\/+$/,"");if((x=x?m(x).toLowerCase().replace(/\/+$/,""):null)&&0!==y.indexOf(x))return u;for(var E=function(C,G,H){H=C.indexOf(G,H);return-1===H?C.length:H},F=E(B,"/",B.indexOf("//")+2),A=-1;B.slice(0,F+1)===
y.slice(0,F)+"/";){A=F+1;if(F===B.length)break;F=E(B,"/",F+1)}if(-1===A||x&&A<x.length)return u;u=z.slice(A);z=y.slice(A-1).replace(/[^/]+/g,"").length;if(0<z)for(B=0;B<z;B++)u="../"+u;else u="./"+u;return u}Object.defineProperty(g,"__esModule",{value:!0});g.normalize=m;g.canUseXhr=function(u){return r.canUseXhr(u)};g.removeTrailingSlash=function(u){return u.replace(/\/+$/,"")};I=Function("return this")();g.appUrl=new n(I.location);g.appBaseUrl=function(){var u=g.appUrl.path;u=u.substring(0,u.lastIndexOf(u.split("/")[u.split("/").length-
1]));return g.appUrl.scheme+"://"+g.appUrl.host+(null!=g.appUrl.port?":"+g.appUrl.port:"")+u}();var t=/^\s*file:/i,q=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;g.isDataProtocol=d;g.isAbsolute=b;g.isProtocolRelative=a;g.urlToObject=c;g.getOrigin=k;g.makeAbsolute=f;g.hasSameOrigin=e;g.join=h;g.removeFile=function(u){var y=0;if(b(u)){var x=u.indexOf("//");-1!==x&&(y=x+2)}x=u.lastIndexOf("/");return x<y?u:u.slice(0,x+1)};g.addProxy=function(u){return r.addProxy(u)};g.makeData=function(u){return u.isBase64?"data:"+
u.mediaType+";base64,"+u.data:"data:"+u.mediaType+","+u.data};var w=/^data:(.*?)(;base64)?,(.*)$/;g.dataComponents=function(u){return(u=u.match(w))?{mediaType:u[1],isBase64:!!u[2],data:u[3]}:null};g.changeDomain=p;g.read=function(u,y){var x=y&&y.url&&y.url.path;u&&x&&(u=f(u,x,{preserveProtocolRelative:!0}));(y=y&&y.portal)&&!y.isPortal&&y.urlKey&&y.customBaseUrl?(x=y.urlKey+"."+y.customBaseUrl,y=e(g.appUrl,g.appUrl.scheme+"://"+x)?p(u,y.portalHostname,x):p(u,x,y.portalHostname)):y=u;return y};g.write=
function(u,y){if(!u)return u;!b(u)&&y&&y.blockedRelativeUrls&&y.blockedRelativeUrls.push(u);var x=f(u);if(y){var z=y.verifyItemRelativeUrls&&y.verifyItemRelativeUrls.rootPath||y.url&&y.url.path;z&&(x=v(x,z,z),x!==u&&y.verifyItemRelativeUrls&&y.verifyItemRelativeUrls.writtenUrls.push(x))}u=x;x=(y=y&&y.portal)&&!y.isPortal&&y.urlKey&&y.customBaseUrl?p(u,y.urlKey+"."+y.customBaseUrl,y.portalHostname):u;return x};g.makeRelative=v;g.removeQueryParameters=function(u){u=c(u);Object.keys(u.query||{});return u.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(I,g,r,n,m){Object.defineProperty(g,"__esModule",{value:!0});g.DEFAULT_LOADER_URL=m.makeAbsolute(m.removeQueryParameters(I.toUrl("./worker-init.js")));g.DEFAULT_CONFIG={baseUrl:function(){var d=m.removeQueryParameters(I.toUrl("dojo/x.js"));return m.makeAbsolute(d.slice(0,d.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};g.default=
function(d){var b={async:d.async,isDebug:d.isDebug,locale:d.locale,baseUrl:d.baseUrl,has:r({},d.has),map:r({},d.map),packages:d.packages&&d.packages.concat()||[],paths:r({},d.paths)};d.hasOwnProperty("async")||(b.async=!0);d.hasOwnProperty("isDebug")||(b.isDebug=!1);d.baseUrl||(b.baseUrl=g.DEFAULT_CONFIG.baseUrl);g.DEFAULT_CONFIG.packages.forEach(function(k){a:{for(var f=b.packages,e=0;e<f.length;e++)if(f[e].name===k.name)break a;k=r({},k);e=m.removeQueryParameters(I.toUrl(k.name+"/x.js"));e=e.slice(0,
e.length-5);k.location=m.makeAbsolute(e);f.push(k)}});d=b.map=b.map||{};for(var a=0,c=Object.keys(g.DEFAULT_CONFIG.map);a<c.length;a++){var l=c[a];d[l]||(d[l]=g.DEFAULT_CONFIG.map[l])}return b}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(I,g,r,n,m){var d=function(){return function(){var c=this,l=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(k){c[k]=
function(){for(var f=[],e=0;e<arguments.length;e++)f[e]=arguments[e];return l[k].apply(l,f)}})}}(),b=n.MutationObserver||n.WebKitMutationObserver,a=function(){if(n.process&&n.process.nextTick)var c=function(f){n.process.nextTick(f)};else if(n.Promise)c=function(f){n.Promise.resolve().then(f)};else if(b){var l=[],k=document.createElement("div");(new b(function(){for(;0<l.length;)l.shift()()})).observe(k,{attributes:!0});c=function(f){l.push(f);k.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=
new d;this._isInitialized=!1;this._workerPostMessage({type:m.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(l){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=l)&&this.addEventListener("message",l)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(l){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=l)&&this.addEventListener("error",l)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(l,k){var f=this;a(function(){f._workerMessageHandler(new MessageEvent("message",{data:l}))})};c.prototype.dispatchEvent=function(l){return this._dispatcher.dispatchEvent(l)};c.prototype.addEventListener=function(l,k,f){this._dispatcher.addEventListener(l,k,f)};c.prototype.removeEventListener=function(l,k,f){this._dispatcher.removeEventListener(l,
k,f)};c.prototype._workerPostMessage=function(l,k){var f=this;a(function(){f.dispatchEvent(new MessageEvent("message",{data:l}))})};c.prototype._workerMessageHandler=function(l){var k=this;if(l=m.receiveMessage(l)){var f=l.jobId;switch(l.type){case m.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:m.MessageType.CONFIGURED});break;case m.MessageType.OPEN:l=l.modulePath,r("esri-webpack")?I(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",l],function(e,h,p,v,t,q,w,u){switch(u){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":h=p;break;case "esri/views/3d/layers/PointCloudWorker":h=v;break;case "esri/views/3d/layers/SceneLayerWorker":h=t;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":h=
q;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":h=w;break;default:h=u}e=e.connect(h);k._workerPostMessage({type:m.MessageType.OPENED,jobId:f,data:e})}):I(["./RemoteClient",l],function(e,h){e=e.connect(h);k._workerPostMessage({type:m.MessageType.OPENED,jobId:f,data:e})})}}};return c}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(I,g,r){function n(m,d){if(Array.isArray(d)){var b=new r;m(d,function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.resolve(a)});return b.promise}return n(m,[d]).then(function(a){return a[0]})}Object.defineProperty(g,"__esModule",{value:!0});g.when=n;g.getAbsMid=function(m,d,b){return d.toAbsMid?d.toAbsMid(m):b.id.replace(/\/[^\/]*$/gi,"/")+m}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(I,g,r){return{create:function(n,m){if(n){var d=n.renderTexture,b=Object.keys(n);
if(n.read&&!m)return n;n.read&&m&&(n=n.toJson());-1<b.indexOf("name")&&b.indexOf(!1)?(n=g.mixin({},n),m=this._parseV2(n,m)):(n="esri.layers.RasterFunction"===n.declaredClass?n.toJson():g.mixin({},n),m=this._parseV1(n,m));m.branchCount=m.updateBranchStructure();m.renderTexture||(m.renderTexture=!!d);return m}},_parseV1:function(n,m){var d=n.rasterFunction,b=n.rasterFunctionArguments,a=n.renderTexture||n.rasterFunctionArguments.renderTexture||!1,c,l,k,f,e,h,p;(f=b.raster||b.Raster)&&f.rasterFunction&&
(c=this._parseV1(f,m));(f=b.raster2||b.Raster2)&&f.rasterFunction&&(l=this._parseV1(f,m));(f=b.rasters||b.Rasters)&&0<f.length&&(k=f.map(g.hitch(this,function(v){return v&&v.rasterFunction?this._parseV1(v,m):v})));(f=b.dem||b.DEM)&&(f.functionName||f.rasterFunction)&&(e=this._parseV1(f,m));(f=b.fillRaster||b.FillRaster)&&(f.functionName||f.rasterFunction)&&(h=this._parseV1(f,m));f=r.functions[d];if(!f)return console.error("Function is not currently supported: "+d),null;d=new f(b);d.variableName&&
(f=b[d.variableName])&&(f.functionName||f.rasterFunction)&&(p=this._parseV1(f,m));n.outputPixelType&&(d.pixelType=n.outputPixelType);"$$"===c?d.functionArguments.raster=m&&m.raster:null!=c?d.functionArguments.raster=c:d.functionArguments.raster||(d.functionArguments.raster=m&&m.raster);null!=l&&(d.functionArguments.raster2=l);null!=k&&(d.functionArguments.rasters=k.map(function(v){"$$"===v&&(v=m&&m.raster);return v}));null!=e&&(d.functionArguments.dem=e);null!=h&&(d.functionArguments.fillRaster=h);
null!=p&&(d.functionArguments[d.variableName]=p);d.renderTexture=a;return d},_parseV2:function(n,m){if(!n)return null;n=g.clone(n);this._bindV2Args(n,m);var d={};this._convertTov1(n,d);return this._parseV1(d,m)},_bindV2Args:function(n,m){(n||m)&&Object.keys(n).forEach(function(d){n[d]["function"]&&n[d].arguments?this._bindV2Args(n[d].arguments,m):null!=m[n[d].name]&&(n[d].value=m[n[d].name])}.bind(this))},_convertV2Types:function(n){if(!n)return null;"ArgumentArray"===n.type?n.elements&&"RasterStatistics"===
n.elements[0].type&&(n=n.elements):n instanceof Array&&0===n.length&&(n=null);return n},_convertTov1:function(n,m){if((n||m)&&n["function"]){var d=n["function"],b=n.arguments;m.rasterFunction=d.type.replace("Function","");m.outputPixelType="UNKNOWN"===d.pixelType?"Unknown":d.pixelType;m.rasterFunctionArguments={};var a;Object.keys(b).forEach(function(c){b[c]["function"]&&b[c].arguments?(m.rasterFunctionArguments[c]={},this._convertTov1(b[c],m.rasterFunctionArguments[c])):(a=b[c].value,m.rasterFunctionArguments[c]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q){return function(){function w(z){z.prototype.supportWebGL&&(y[z.prototype.functionName]=z);z.prototype.support2D&&(u[z.prototype.functionName]=z);x[z.prototype.functionName]=z}var u={},y={},x={};w(r);w(n);w(m);w(d);w(b);w(a);w(c);w(l);w(k);w(f);w(e);w(h);w(p);w(v);w(t);w(q);return{cpu:u,gpu:y,functions:x,register:w,getFunction:function(z){return x[z]},support:function(z,B){return!!("gpu"===B?y:"cpu"===B?u:x)[z]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(I,g,r,n,m,d,b,a){return I([r,b],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=a.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:d.aspect,fragmentName:"Aspect"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),f=this.gl,e=f.drawingBufferWidth;f=f.drawingBufferHeight;var h=l.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/e,1/f],u_cellSize:[(h.xmax-h.xmin)/e,(h.ymax-h.ymin)/f]});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(I){return{hillshade:function(g,r){if(null!==g&&null!==g.pixelBlock&&
null!==g.pixelBlock.pixels){var n=this._clonePixelBlock(g.pixelBlock),m=r.altitude,d=r.azimuth,b=r.zFactor,a=r.psPower,c=r.psFactor,l=r.hillshadeType,k=r.slopeType,f=r.isGCS;1===l&&(b*=2);r=n.width;var e=n.height,h=n.pixels[0],p=n.mask,v=new Uint8Array(r*e);p&&v.set(p);var t=new Uint8Array(r*e),q=(g.extent.xmax-g.extent.xmin)/r,w=(g.extent.ymax-g.extent.ymin)/e,u=b/(8*q),y=b/(8*w);.001<b&&f&&(u/=111E3,y/=111E3);3===k&&(f?(u=111E3*q,y=111E3*w,u=(b+Math.pow(u,a)*c)/(8*u),y=(b+Math.pow(y,a)*c)/(8*y)):
(u=(b+Math.pow(q,a)*c)/(8*q),y=(b+Math.pow(w,a)*c)/(8*w)));f=(90-m)*Math.PI/180;m=Math.cos(f);var x=(360-d+90)*Math.PI/180;d=Math.sin(f)*Math.cos(x);f=Math.sin(f)*Math.sin(x);b=[];a=[];c=[];q=[315,270,225,360,180,0];var z=[60,60,60,60,60,90];k=[3,5,3,2,1,4];var B=k.reduce(function(R,S){return R+S});w=k.map(function(R){return R/B});if(1===l){var E=q.length;for(k=0;k<E;k++)m=z[k],d=q[k],f=(90-m)*Math.PI/180,m=Math.cos(f),x=(360-d+90)*Math.PI/180,d=Math.sin(f)*Math.cos(x),f=Math.sin(f)*Math.sin(x),b.push(m),
a.push(d),c.push(f)}var F=0;for(k=1;k<e-1;k++)for(z=k*r,q=1;q<r-1;q++)if(p&&!p[z+q])t[z+q]=0;else{x=0;if(p&&(x=p[z-r+q-1]+p[z-r+q]+p[z-r+q+1]+p[z+q-1]+p[z+q+1]+p[z+r+q-1]+p[z+r+q]+p[z+r+q+1],7>x)){t[z+q]=0;v[z+q]=0;continue}if(7===x){var A=p[z-r+q-1]?h[z-r+q-1]:h[z+q];var C=p[z-r+q]?h[z-r+q]:h[z+q];var G=p[z-r+q+1]?h[z-r+q+1]:h[z+q];x=p[z+q-1]?h[z+q-1]:h[z+q];var H=p[z+q+1]?h[z+q+1]:h[z+q];F=p[z+r+q-1]?h[z+r+q-1]:h[z+q];var N=p[z+r+q]?h[z+r+q]:h[z+q];var M=p[z+r+q+1]?h[z+r+q+1]:h[z+q]}else A=h[z-
r+q-1],C=h[z-r+q],G=h[z-r+q+1],x=h[z+q-1],H=h[z+q+1],F=h[z+r+q-1],N=h[z+r+q],M=h[z+r+q+1];x=(G+H+H+M-(A+x+x+F))*u;C=(F+N+N+M-(A+C+C+G))*y;G=Math.sqrt(1+x*x+C*C);F=0;if(0===l)N=f*C-d*x,N=255*(m+N)/G,0>N&&(N=0),F=N;else if(1===l)for(A=0;A<E;A++)N=c[A]*C-a[A]*x,N=255*(b[A]+N)/G,0>N&&(N=0),F+=N*w[A];t[z+q]=F}for(k=0;k<e;k++)t[k*r]=t[k*r+1],t[(k+1)*r-1]=t[(k+1)*r-2];for(k=1;k<r-1;k++)t[k]=t[k+r],t[k+(e-1)*r]=t[k+(e-2)*r];n.pixelType="U8";n.pixels=[t];n.statistics=[{minValue:0,maxValue:255}];p&&(n.mask=
v);return{extent:g.extent,pixelBlock:n}}},slope:function(g,r){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var n=this._clonePixelBlock(g.pixelBlock),m=r.zFactor,d=r.psPower,b=r.psFactor,a=r.slopeType,c=r.isGCS;r=n.width;var l=n.height,k=n.pixels[0],f=n.mask,e=new Uint8Array(r*l);f&&e.set(f);var h=new Float32Array(r*l),p=(g.extent.xmax-g.extent.xmin)/r,v=(g.extent.ymax-g.extent.ymin)/l,t=m/(8*p),q=m/(8*v);1E-4>Math.abs(m-1)&&c&&(t/=111E3,q/=111E3);3===a&&(c?(t=111E3*p,q=111E3*v,t=
(m+Math.pow(t,d)*b)/(8*t),q=(m+Math.pow(q,d)*b)/(8*q)):(t=(m+Math.pow(p,d)*b)/(8*p),q=(m+Math.pow(v,d)*b)/(8*v)));for(m=1;m<l-1;m++)for(b=m*r,d=1;d<r-1;d++)if(f&&!f[b+d])h[b+d]=0;else{v=0;if(f&&(v=f[b-r+d-1]+f[b-r+d]+f[b-r+d+1]+f[b+d-1]+f[b+d+1]+f[b+r+d-1]+f[b+r+d]+f[b+r+d+1],7>v)){h[b+d]=0;e[b+d]=0;continue}if(7===v){v=f[b-r+d-1]?k[b-r+d-1]:k[b+d];c=f[b-r+d]?k[b-r+d]:k[b+d];p=f[b-r+d+1]?k[b-r+d+1]:k[b+d];var w=f[b+d-1]?k[b+d-1]:k[b+d];var u=f[b+d+1]?k[b+d+1]:k[b+d];var y=f[b+r+d-1]?k[b+r+d-1]:k[b+
d];var x=f[b+r+d]?k[b+r+d]:k[b+d];var z=f[b+r+d+1]?k[b+r+d+1]:k[b+d]}else v=k[b-r+d-1],c=k[b-r+d],p=k[b-r+d+1],w=k[b+d-1],u=k[b+d+1],y=k[b+r+d-1],x=k[b+r+d],z=k[b+r+d+1];w=(p+u+u+z-(v+w+w+y))*t;v=(y+x+x+z-(v+c+c+p))*q;v=Math.sqrt(w*w+v*v);h[b+d]=1===a||3===a?57.2957795*Math.atan(v):100*v}for(m=0;m<l;m++)h[m*r]=h[m*r+1],h[(m+1)*r-1]=h[(m+1)*r-2];for(m=1;m<r-1;m++)h[m]=h[m+r],h[m+(l-1)*r]=h[m+(l-2)*r];n.pixelType="F32";n.pixels=[h];n.statistics=[{minValue:0,maxValue:255}];f&&(n.mask=e);return{extent:g.extent,
pixelBlock:n}}},aspect:function(g){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var r=this._clonePixelBlock(g.pixelBlock),n=r.width,m=r.height,d=r.pixels[0],b=r.mask,a=new Uint8Array(n*m);b&&a.set(b);var c=new Float32Array(n*m),l=1/((g.extent.xmax-g.extent.xmin)/n),k=1/((g.extent.ymax-g.extent.ymin)/m),f,e;for(f=1;f<m-1;f++){var h=f*n;for(e=1;e<n-1;e++)if(b&&!b[h+e])c[h+e]=0;else{var p=0;if(b&&(p=b[h-n+e-1]+b[h-n+e]+b[h-n+e+1]+b[h+e-1]+b[h+e+1]+b[h+n+e-1]+b[h+n+e]+b[h+n+e+1],7>p)){c[h+
e]=0;a[h+e]=0;continue}if(7===p){p=b[h-n+e-1]?d[h-n+e-1]:d[h+e];var v=b[h-n+e]?d[h-n+e]:d[h+e];var t=b[h-n+e+1]?d[h-n+e+1]:d[h+e];var q=b[h+e-1]?d[h+e-1]:d[h+e];var w=b[h+e+1]?d[h+e+1]:d[h+e];var u=b[h+n+e-1]?d[h+n+e-1]:d[h+e];var y=b[h+n+e]?d[h+n+e]:d[h+e];var x=b[h+n+e+1]?d[h+n+e+1]:d[h+e]}else p=d[h-n+e-1],v=d[h-n+e],t=d[h-n+e+1],q=d[h+e-1],w=d[h+e+1],u=d[h+n+e-1],y=d[h+n+e],x=d[h+n+e+1];q=(t+w+w+x-(p+q+q+u))*l;p=(u+y+y+x-(p+v+v+t))*k;0===q&&0===p?p=-1:(p=90-57.29578*Math.atan2(p,-q),0>p&&(p+=
360),360===p?p=0:360<p&&(p%=360));c[h+e]=p}}for(f=0;f<m;f++)c[f*n]=c[f*n+1],c[(f+1)*n-1]=c[(f+1)*n-2];for(f=1;f<n-1;f++)c[f]=c[f+n],c[f+(m-1)*n]=c[f+(m-2)*n];r.pixelType="F32";r.pixels=[c];r.statistics={minValue:0,maxValue:360};b&&(r.mask=a);return{extent:g.extent,pixelBlock:r}}},_clonePixelBlock:function(g){return g.clone?g.clone():I.clone(g)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(I,g,r,n,m,d,b){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=g.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.bandArithmetic,fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(e){return parseInt(e,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var l=this.bindFrameBuffer(),k=this.functionArguments.method,f=2<c.length?c.slice(2):null;this._alterBand?this._setUniforms({u_method:k,u_bandId_nir:0,u_bandId_red:1,u_constants:f}):this._setUniforms({u_method:k,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:f});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(I){return{calculate:function(g,r){if(g&&g.pixels&&g.pixels.length){var n=r&&r.bandIndexes;r=r&&r.method;var m=n.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});g=this._clonePixelBlock(g);var d=g.pixels,b=g.mask;switch(r){case 1:d=this._calculateNDVI(b,d[m[0]-1],d[m[1]-1]);break;case 2:d=this._calculateSAVI(b,d[m[0]-1],d[m[1]-1],m[2]);break;case 3:d=this._calculateTSAVI(b,d[m[0]-1],d[m[1]-1],m[2],m[3],m[4]);break;case 4:d=this._calculateMSAVI(b,
d[m[0]-1],d[m[1]-1]);break;case 5:d=this._calculateGEMI(b,d[m[0]-1],d[m[1]-1]);break;case 6:d=this._calculatePVI(b,d[m[0]-1],d[m[1]-1],m[2],m[3]);break;case 7:d=this._calculateGVITM(b,d[m[0]-1],d[m[1]-1],d[m[2]-1],d[m[3]-1],d[m[4]-1],d[m[5]-1]);break;case 8:d=this._calculateSultan(b,d[m[0]-1],d[m[1]-1],d[m[2]-1],d[m[3]-1],d[m[4]-1],d[m[5]-1]);break;case 9:d=this._calculateVARI(b,d[m[0]-1],d[m[1]-1],d[m[2]-1]);break;case 0:d=this._calculateUserDefined(b,d,n)}g.pixels=d;g.pixelType="F32";g.calculateStatistics();
return g}},_clonePixelBlock:function(g){return g.clone?g.clone():I.clone(g)},_parseUserDefined:function(g,r){g=g.replace(" ","");0===g.indexOf("-")&&(g="0"+g);0===g.indexOf("+")&&(g=g.slice(1,g.length));g=g.split("");var n=[],m=[],d="+-*/()".split(""),b,a="";for(b=0;b<g.length;b++){var c=g[b];d.some(function(l){return l===c})?(""!==a&&m.push(parseFloat(a)),n.push(c),a=""):"b"===c.toLowerCase()?(b++,a=c.concat(g[b]),m.push(r[parseInt(a[1],10)-1]),a=""):(a=a.concat(c),b===g.length-1&&m.push(parseFloat(a)))}return{ops:n,
nums:m}},_op:function(g,r,n,m){if(n.constructor===Number&&m.constructor===Number)return n+m;var d;if(n.constructor===Number){var b=m.length;var a=n;n=new Float32Array(b);for(d=0;d<b;d++)n[d]=a}else if(b=n.length,m.constructor===Number)for(a=m,m=new Float32Array(b),d=0;d<b;d++)m[d]=a;a=new Float32Array(b);if(null==g)if("+"===r)for(d=0;d<b;d++)a[d]=n[d]+m[d];else if("-"===r)for(d=0;d<b;d++)a[d]=n[d]-m[d];else if("*"===r)for(d=0;d<b;d++)a[d]=n[d]*m[d];else{if("/"===r)for(d=0;d<b;d++)a[d]=n[d]/m[d]}else if("+"===
r)for(d=0;d<b;d++)g[d]&&(a[d]=n[d]+m[d]);else if("-"===r)for(d=0;d<b;d++)g[d]&&(a[d]=n[d]-m[d]);else if("*"===r)for(d=0;d<b;d++)g[d]&&(a[d]=n[d]*m[d]);else if("/"===r)for(d=0;d<b;d++)g[d]&&(a[d]=n[d]/m[d]);return a},_shrinkOp:function(g,r){g.splice(r,1);var n=r=0,m=0;do{for(r=m=n=0;r<g.length;r++)if("("===g[r])n=r;else if(")"===g[r]){m=r;break}m===n+1&&g.splice(n,2)}while(m===n+1);return g},_getPriorityOpIndex:function(g,r){if(1===g.length)return{opIndex:0,numIndex:0};var n=r=0,m=0,d=-1,b=0;for(r=
0;r<g.length;r++)if("("===g[r])n=r;else if(")"===g[r]){m=r;break}var a=0===m?g:g.slice(n+1,m);for(r=0;r<a.length;r++)if("*"===a[r]||"/"===a[r]){d=r;break}if(!(-1<d))for(r=0;r<a.length;r++)if("+"===a[r]||"-"===a[r]){d=r;break}0<m&&(d+=n+1);for(r=0;r<d;r++)"("===g[r]&&b++;return{opIndex:d,numIndex:d-b}},_calculateUserDefined:function(g,r,n){r=this._parseUserDefined(n,r);n=r.ops;for(var m=r.nums,d,b,a;0<n.length&&(r=this._getPriorityOpIndex(n,m),d=n[r.opIndex],b=m[r.numIndex],a=m[r.numIndex+1],d=this._op(g,
d,b,a),1!==n.length);)n=this._shrinkOp(n,r.opIndex),m.splice(r.numIndex,2,d);return[d]},_calculateNDVI:function(g,r,n){var m=n.length,d=new Float32Array(m),b;if(null==g)for(b=0;b<m;b++){var a=n[b];var c=r[b];d[b]=(c-a)/(c+a)}else for(b=0;b<m;b++)g[b]&&(a=n[b],c=r[b],d[b]=(c-a)/(c+a));return[d]},_calculateSAVI:function(g,r,n,m){var d=n.length,b=new Float32Array(d),a;if(null==g)for(a=0;a<d;a++){var c=n[a];var l=r[a];b[a]=(l-c)/(l+c+m)*(1+m)}else for(a=0;a<d;a++)g[a]&&(c=n[a],l=r[a],b[a]=(l-c)/(l+c+
m)*(1+m));return[b]},_calculateTSAVI:function(g,r,n,m,d,b){var a=n.length,c=new Float32Array(a),l=-d*m+b*(1+m*m);if(null==g)for(b=0;b<a;b++){var k=n[b];var f=r[b];c[b]=m*(f-m*k-d)/(d*f+k+l)}else for(b=0;b<a;b++)g[b]&&(k=n[b],f=r[b],c[b]=m*(f-m*k-d)/(d*f+k+l));return[c]},_calculateMSAVI:function(g,r,n){var m=n.length,d=new Float32Array(m),b;if(null==g)for(b=0;b<m;b++){var a=n[b];var c=r[b];d[b]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a)))}else for(b=0;b<m;b++)g[b]&&(d[b]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*
c+1,2)-8*(c-a))));return[d]},_calculateGEMI:function(g,r,n){var m=n.length,d=new Float32Array(m),b;if(null==g)for(b=0;b<m;b++){var a=n[b];var c=r[b];c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5);d[b]=c*(1-.25*c)-(a-.125)/(1-a)}else for(b=0;b<m;b++)g[b]&&(a=n[b],c=r[b],c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5),d[b]=c*(1-.25*c)-(a-.125)/(1-a));return[d]},_calculatePVI:function(g,r,n,m,d){var b=n.length,a=new Float32Array(b),c,l=Math.sqrt(1+m*m);if(null==g)for(c=0;c<b;c++){var k=n[c];var f=r[c];a[c]=(f-m*k-d)/l}else for(c=
0;c<b;c++)g[c]&&(k=n[c],f=r[c],a[c]=(f-m*k-d)/l);return[a]},_calculateGVITM:function(g,r,n,m,d,b,a){var c=r.length,l=new Float32Array(c),k;if(null==g)for(k=0;k<c;k++)l[k]=-.2848*r[k]-.2435*n[k]-.5436*m[k]+.7243*d[k]+.084*b[k]-1.18*a[k];else for(k=0;k<c;k++)g[k]&&(l[k]=-.2848*r[k]-.2435*n[k]-.5436*m[k]+.7243*d[k]+.084*b[k]-1.18*a[k]);return[l]},_calculateSultan:function(g,r,n,m,d,b,a){n=r.length;var c=new Float32Array(n),l=new Float32Array(n),k=new Float32Array(n),f;if(null==g)for(f=0;f<n;f++)c[f]=
b[f]/a[f]*100,l[f]=b[f]/r[f]*100,k[f]=m[f]/d[f]*(b[f]/d[f])*100;else for(f=0;f<n;f++)g[f]&&(c[f]=b[f]/a[f]*100,l[f]=b[f]/r[f]*100,k[f]=m[f]/d[f]*(b[f]/d[f])*100);return[c,l,k]},_calculateVARI:function(g,r,n,m){var d=r.length,b=new Float32Array(d),a;if(null==g)for(a=0;a<d;a++){var c=r[a];var l=n[a];var k=m[a];b[a]=(l-c)/(l+c-k)}else for(a=0;a<d;a++)if(g[a])for(a=0;a<d;a++)c=r[a],l=n[a],k=m[a],b[a]=(l-c)/(l+c-k);return[b]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(I,g,r,n,m,d,b){return I([n,d],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var c=Object.keys(a[0].attributes);var l=c.filter(function(v){return"alpha"===
v.toLowerCase()})[0];var k=c.filter(function(v){return"value"===v.toLowerCase()})[0];var f=c.filter(function(v){return"red"===v.toLowerCase()})[0];var e=c.filter(function(v){return"green"===v.toLowerCase()})[0];var h=c.filter(function(v){return"blue"===v.toLowerCase()})[0];if(!(k&&f&&e&&h))throw"invalid colormap";a=a.map(function(v){return l?[v.attributes[k],v.attributes[f],v.attributes[e],v.attributes[h],v.attributes[l]]:[v.attributes[k],v.attributes[f],v.attributes[e],v.attributes[h]]});var p=1.1>
Math.max.apply(null,a.map(function(v){return v[1]}));c=l&&1.1>Math.max.apply(null,a.map(function(v){return v[4]}));if(p)for(p=0;p<a.length;p++)a[p][1]=Math.round(255*a[p][1]),a[p][2]=Math.round(255*a[p][2]),a[p][3]=Math.round(255*a[p][3]),c&&(a[p][4]=Math.round(255*a[p][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=g.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=b.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,c){for(var l=0,k=a.length-1,f=0,e=0;l<k;)if(f=Math.floor((l+k)/2),e=a[f],e[0]<c)l=f;else if(e[0]>c)k=f;else return e.slice(1);return null},_sortClr:function(a,c){var l,k=[];for(l=0;l<a.length;l++)k.push(a[l]);for(l=0;l<k.length-1;l++){var f=k[l];for(a=l+1;a<k.length;a++)f[0]>k[a][0]&&(f=k[a],k[a]=k[l],
k[l]=f)}if(c)for(l=0;l<k.length/2;l++)f=k[l],k[k.length-1-l]=k[l],k[l]=f;return k},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(l){return{fromColor:l.toColor,toColor:l.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=b.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?r.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):r.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?r.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
r.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=r.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var c=0;0>a[0][0]&&(c=a[0][0]);var l=[],k=5===a[0].length,f;for(f=0;f<a.length;f++)l[a[f][0]-c]=k?a[f].slice(1):a[f].slice(1).concat([255]);return l},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:m.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,l=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var k=this._clrTexture,f=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:l,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(k,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:f.texture}},_setupColormapTexture:function(a){var c=
this._createTexture(),l=this.gl,k=a.length/4,f=new Float32Array(a.length),e,h=this.renderTexture?255:1;for(e=0;e<a.length;e++)f[e]=a[e]/h;l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,1,0,l.RGBA,l.FLOAT,f);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(I,g,r){return{createAlgorithmicColorRamp:function(n,m){if(!n)return null;var d=n.fromColor,b=n.toColor;if(!d||!b)return null;
void 0===d.r&&3<=d.length&&(d={r:d[0],g:d[1],b:d[2]});void 0===b.r&&3<=b.length&&(b={r:b[0],g:b[1],b:b[2]});var a=n.size||256;n=n.algorithm||"cie-lab";if(1===a)var c=[d.r,d.g,d.b,255];else if(2===a)c=[d.r,d.g,d.b,255,b.r,b.g,d.b,255];else if(-1<n.toLowerCase().indexOf("hsv")){c=r.toHSV(d);b=r.toHSV(b);a=a||256;var l=0===c.s,k=0===b.s;d=c.h;n=b.h;l&&!k?d=c.h=n:k&&!l&&(n=b.h=d);l=Math.abs(n-d);180>l?n=(n-d)/(a-1):(l=360-l,n=d>n?l/(a-1):-l/(a-1));l=(b.s-c.s)/(a-1);k=(b.v-c.v)/(a-1);var f=c.s;c=c.v;var e,
h=new Uint8Array(4*a);for(e=0;e<a-1;e++){var p=r.toRGB({h:d,s:f,v:c});h[4*e]=p.r;h[4*e+1]=p.g;h[4*e+2]=p.b;h[4*e+3]=255;d+=n;f+=l;c+=k;360<d?d-=360:0>d&&(d+=360)}p=r.toRGB(b);h[4*(a-1)]=p.r;h[4*(a-1)+1]=p.g;h[4*(a-1)+2]=p.b;h[4*(a-1)+3]=255;c=h}else if(-1<n.toLowerCase().indexOf("lch")){f=r.toLCH(d);b=r.toLCH(b);a=a||256;c=(b.l-f.l)/(a-1);d=(b.c-f.c)/(a-1);n=(b.h-f.h)/(a-1);l=f.l;k=f.c;f=f.h;h=new Uint8Array(4*a);for(e=0;e<a-1;e++)p=r.toRGB({l:l,c:k,h:f}),h[4*e]=p.r,h[4*e+1]=p.g,h[4*e+2]=p.b,h[4*
e+3]=255,l+=c,k+=d,f+=n;p=r.toRGB(b);h[4*(a-1)]=p.r;h[4*(a-1)+1]=p.g;h[4*(a-1)+2]=p.b;h[4*(a-1)+3]=255;c=h}else if(-1<n.toLowerCase().indexOf("lab")){f=r.toLAB(d);b=r.toLAB(b);a=a||256;c=(b.l-f.l)/(a-1);d=(b.a-f.a)/(a-1);n=(b.b-f.b)/(a-1);l=f.l;k=f.a;f=f.b;h=new Uint8Array(4*a);for(e=0;e<a-1;e++)p=r.toRGB({l:l,a:k,b:f}),h[4*e]=p.r,h[4*e+1]=p.g,h[4*e+2]=p.b,h[4*e+3]=255,l+=c,k+=d,f+=n;p=r.toRGB(b);h[4*(a-1)]=p.r;h[4*(a-1)+1]=p.g;h[4*(a-1)+2]=p.b;h[4*(a-1)+3]=255;c=h}if(m&&!1===m.flattened)for(m=c,
c=[],b=0;b<c/4;b++)c[b]=m.slice(4*b,4*b+4);return c},createMultiPartColorRamp:function(n,m){if(!n)return null;m=m&&g.clone(m)||{flattened:!0};var d=n.colorRamps;if(!d||0===d.length)return null;var b=n.size||256;n=Math.max(Math.floor(b/d.length),1);var a=Math.max(n,b-(d.length-1)*n),c=!1!==m.flattened;m.flattened=!0;b=(d.length-1)*n+a;var l=new Uint8Array(4*b);for(b=0;b<d.length;b++){var k={fromColor:d[b].fromColor,toColor:d[b].toColor,size:b===d.length-1?a:n};l instanceof Array?l.concat(this.createAlgorithmicColorRamp(k,
m)):l.set(this.createAlgorithmicColorRamp(k,m),n*b*4)}if(!c)for(m=l,l=[],b=0;b<l/4;b++)l[b]=m.slice(4*b,4*b+4);return l},createRandomColorRamp:function(n){n=n||{};var m=n.size||256,d=!1===n.flattened;var b=d?new Uint8Array(4*m):[];for(n=0;n<m;n++)d?(b[4*n]=Math.round(255*Math.random()),b[4*n+1]=Math.round(255*Math.random()),b[4*n+2]=Math.round(255*Math.random()),b[4*n+3]=255):b[n]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return b}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(I){return{mask:function(g,r){if(g&&g.pixels&&g.pixels.length){g=this._clonePixelBlock(g);var n=r.includedRanges,m=r.noDataInterpretation;r=r.noDataValues;if(null===n&&null===r)return g;var d=g.pixels,b=g.mask,a=g.width*g.height,c=d.length,l;if(null!==r&&r.length!==c)throw"expect "+c+" elements in noDataValues";if(null!==n&&n.length!==2*c)throw"expect "+2*c+" elements in IncludeRanges";if(null==b){b=new Uint8Array(a);for(l=0;l<a;l++)b[l]=1;g.mask=b}if(0===m)for(m=0;m<c;m++){var k=d[m];var f=
null===n?null:n[2*m];var e=null===n?null:n[2*m+1];var h=null===r?null:parseFloat(r[m]);if(null===f||null===e)for(l=0;l<a;l++){if(b[l]){var p=k[l];p===h&&(b[l]=0)}}else if(null===h)for(l=0;l<a;l++)b[l]&&(p=k[l],p<f||p>e)&&(b[l]=0);else for(l=0;l<a;l++)b[l]&&(p=k[l],p<f||p>e||p===h)&&(b[l]=0)}else{var v=new Uint8Array(a);for(l=0;l<a;l++)v[l]=b[l];for(m=0;m<c;m++)if(k=d[m],f=null===n?null:n[2*m],e=null===n?null:n[2*m+1],h=null===r?null:parseFloat(r[m]),null===f||null===e)for(l=0;l<a;l++)v[l]&&(p=k[l],
p!==h&&(v=0));else if(null===h)for(l=0;l<a;l++)v[l]&&(p=k[l],p<=f&&p<=e&&(v=0));else for(l=0;l<a;l++)v[l]&&(p=k[l],p<=f&&p<=e&&p!==h&&(v=0));for(l=0;l<a;l++)b[l]&&v[l]&&(b[l]=0)}return g}},calculateStatisticsHistograms:function(g,r){g=this._clonePixelBlock(g);r=g.pixelType;var n=g.pixels,m=g.mask,d=n.length,b,a,c=[],l;for(b=0;b<d;b++){var k={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var f=k.counts;var e=n[b];if("U8"===r)if(m)for(a=0;a<g.width*g.height;a++)m[a]&&f[e[a]]++;else for(a=
0;a<g.width*g.height;a++)f[e[a]]++;else{var h=g.statistics[b].minValue;var p=g.statistics[b].maxValue;k.min=h;k.max=p;p=(p-h)/256;var v=new Uint32Array(257);if(m)for(a=0;a<g.width*g.height;a++)m[a]&&v[Math.floor((e[a]-h)/p)]++;else for(a=0;a<g.width*g.height;a++)v[Math.floor((e[a]-h)/p)]++;for(a=0;255>a;a++)f[a]=v[a];f[255]=v[255]+v[256]}c.push(k);h=g.statistics[b].minValue;p=g.statistics[b].maxValue;for(a=v=l=e=0;a<k.size;a++)e+=f[a],l+=a*f[a];l/=e;for(a=0;a<k.size;a++)v+=f[a]*Math.pow(a-l,2);f=
Math.sqrt(v/(e-1));a=(l+.5)*(k.max-k.min)/k.size+k.min;k=f*(k.max-k.min)/k.size;g.statistics[b]={min:h,minValue:h,max:p,maxValue:p,mean:a,stddev:k}}g.histograms=c;return g},buildIndexedColormap:function(g,r){if(!g)return null;var n=0;0>g[0][0]&&(n=g[0][0]);var m=Math.max(256,g[g.length-1][0]-n);if(65536<m)return null;var d=new Uint8Array(4*m),b=[],a=0,c=5===g[0].length;if(r)for(b=g[a],r=b[0]-n;r<m;r++)d[4*r]=b[1],d[4*r+1]=b[2],d[4*r+2]=b[3],d[4*r+3]=c?b[4]:255,r===b[0]-n&&(b=a===g.length-1?b:g[++a]);
else for(r=0;r<g.length;r++)b=g[r],a=4*(b[0]-n),d[a]=b[1],d[a+1]=b[2],d[a+2]=b[3],d[a+3]=c?b[4]:255;return{indexedColormap:d,offset:n,alphaSpecified:c}},colorize:function(g,r){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);var n=g.pixels,m=g.width*g.height,d=g.mask,b=r.indexedColormap,a=r.indexedColormapOffset,c=b&&b.length-1,l=r.indexed2DColormap;r=r.alphaSpecified;if(3<=n.length)throw"colormap only works on single band image";var k=n[0],f=new Uint8Array(k.length),e=new Uint8Array(k.length),
h=new Uint8Array(k.length),p=0;if(b)if(d)for(n=0;n<m;n++)d[n]&&(p=4*(k[n]-a),p<a||p>c?d[n]=0:(f[n]=b[p],e[n]=b[p+1],h[n]=b[p+2],d[n]=b[p+3]));else{d=new Uint8Array(m);for(n=0;n<m;n++)p=4*(k[n]-a),p<a||p>c?d[n]=0:(f[n]=b[p],e[n]=b[p+1],h[n]=b[p+2],d[n]=b[p+3]);g.mask=d}else if(d)for(n=0;n<m;n++)d[n]&&(b=l[k[n]],f[n]=b[0],e[n]=b[1],h[n]=b[2],d[n]=b[3]);else{d=new Uint8Array(m);for(n=0;n<m;n++)b=l[k[n]],f[n]=b[0],e[n]=b[1],h[n]=b[2],d[n]=b[3];g.mask=d}g.pixels=[f,e,h];g.statistics=null;g.pixelType="U8";
g.maskIsAlpha=r;return g}},convolute:function(g,r){g=this._clonePixelBlock(g);var n=g.pixels,m=g.width,d=g.height,b=m*d,a=n.length,c,l,k,f,e=[],h=[],p=r.normalizedKernel,v=r.kernelRows,t=r.kernelCols;for(r=0;r<a;r++){var q=n[r];var w=new Float32Array(b);w.set(q);for(k=1;k<d-1;k++){var u=k*m;for(f=1;f<m-1;f++){for(c=h=0;c<v;c++)for(l=0;l<t;l++)h+=q[u+f+(c-1)*m+l-1]*p[c*t+l];w[u+f]=h}}e.push(w)}g.pixels=e;return g},contrastBrightnessStretch:function(g,r){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);
var n=g.pixels,m=g.mask,d=g.width*g.height,b=n.length;var a=r&&r.contrastOffset;r=r&&r.brightnessOffset;if("U8"!==g.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var c=this._createContrastBrightnessLUT(a,r);if(null==m)for(a=0;a<d;a++)for(r=0;r<b;r++)n[r][a]=c[n[r][a]];else for(a=0;a<d;a++)if(m[a])for(r=0;r<b;r++)n[r][a]=c[n[r][a]];g.pixelType="U8";return g}},isNull:function(g,r){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);r=g.mask;var n=
g.pixels[0],m=n.length,d;if(r){for(d=0;d<m;d++)n[d]=r[d]?0:1;g.mask=null}else if(n.fill)n.fill(0);else for(d=0;d<m;d++)n[d]=0;return g}},setNull:function(g){if(null!==r&&null!==r.pixels){var r=this._clonePixelBlock(g);g=r.mask;var n=r.pixels[0],m=n.length,d;g=g||new Uint8Array(m);for(d=0;d<m;d++)g[d]=n[d]?0:1;r.mask=g;return r}},local:function(g,r){if(!r)return g[0];var n=r.rasterCountNeeded;r=r.functor;var m=this._clonePixelBlock(g[0]);if(null!==m&&null!==m.pixels){var d=m.width*m.height,b;g=(b=
g[1])&&b.pixels[0];var a=b&&b.mask,c=m.mask,l=m.pixels[0];if(2===n)if(!c&&a)c=a;else if(c&&a)for(b=0;b<d;b++)c[b]=c[b]&&a[b]?1:0;m.mask=c;if(1===n)if(null==c)for(b=0;b<d;b++)l[b]=r(l[b]);else for(b=0;b<d;b++)c[b]&&(l[b]=r(l[b]));else if(2===n)if(null==c)for(b=0;b<d;b++)l[b]=r(l[b],g[b]);else for(b=0;b<d;b++)c[b]&&(l[b]=r(l[b],g[b]));m.mask=c;m.calculateStatistics();return m}},remapColor:function(g,r){g=this._clonePixelBlock(g);var n=g.width*g.height,m=r.length,d=Math.floor(m/2),b=r[Math.floor(d)],
a=r[0].value,c=r[r.length-1].value,l=g.pixels[0],k,f,e=!1,h=new Uint8Array(n),p=new Uint8Array(n),v=new Uint8Array(n),t=g.mask,q=4===r[0].mappedColor.length;t&&0!==t.length||(t=new Uint8Array(n),t.fill(q?255:1),g.mask=t);for(f=0;f<n;f++)if(t[f]){var w=l[f];if(w<a||w>c)h[f]=p[f]=v[f]=t[f]=0;else{e=!1;var u=d;var y=b;var x=0;for(k=m-1;1<k-x;){if(w===y.value){e=!0;break}w>y.value?x=u:k=u;u=Math.floor((x+k)/2);y=r[Math.floor(u)]}e||(y=w===r[k].value?r[k]:r[x]);h[f]=y.mappedColor[0];p[f]=y.mappedColor[1];
v[f]=y.mappedColor[2];t[f]=y.mappedColor[3]}}g.pixels=[h,p,v];g.mask=t;g.pixelType="u8";g.maskIsAlpha=q;return g},_clonePixelBlock:function(g){if(g.clone)return g.clone();var r=I.clone(g),n;if(g.pixels&&g.pixels[0]&&0<g.pixels[0].length&&!(r.pixels&&r.pixels[0]&&0<r.pixels[0].length)){r.pixels=[];var m=g.pixels.length;for(n=0;n<m;n++)r.pixels[n]=new g.pixels[n].constructor(g.pixels[n])}if(g.statistics)for(r.statistics=[],m=g.statistics.length,n=0;n<m;n++)r.statistics[n]=I.clone(g.statistics[n]);g.mask&&
(r.mask=new Uint8Array(g.mask));return r},_createContrastBrightnessLUT:function(g,r){if(this._contrastCache&&this._contrastCache.contrastOffset===g&&this._contrastCache.brightnessOffset===r)return this._contrastCache.lut;var n=Math.min(Math.max(g,-100),100),m=Math.min(Math.max(r,-100),100),d,b=new Uint8Array(256);for(d=0;256>d;d++){if(0<n&&100>n)var a=(200*d-25500+510*m)/(2*(100-n))+128;else 0>=n&&-100<n?a=(200*d-25500+510*m)*(100+n)/2E4+128:100===n?(a=200*d-25500+256*(100-n)+510*m,a=0<a?255:0):-100===
n&&(a=128);b[d]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:g,brightnessOffset:r,lut:b};return b}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(I,g,r,n,m,d){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=
this.mixinIgnoreCase({rasters:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],c=[],l=b.rasters.length,k;if(b.rasters[0].statistics)for(k=0;k<l;k++)a.push(b.rasters[k].statistics[0]);if(b.rasters[0].histograms)for(k=0;k<l;k++)c.push(b.rasters[k].histograms[0]);this.rasterInfo=g.mixin(b.rasters[0],{bandCount:l,pixelType:this._calculatePixelType(this.pixelType,b.rasters[0].pixelType),statistics:a,
histograms:c});return!0},read2D:function(b){b=b.rasters;if(null!=b&&0!==b.length){var a=this._clonePixelData(b[0]),c=a.pixelBlock,l=[],k=[];for(f=0;f<b.length;f++)l.push(b[f].pixelBlock.pixels[0]),k.push(b[f].pixelBlock.statistics[0]);c.pixels=l;c.stackedStatistics=k;c.planes=b.length;var f;k=c.width*c.height;for(f=0;f<b.length;f++)if(c=b[f].pixelBlock.mask,e&&c)for(l=0;l<k;l++)e[l]&=c[l];else var e=e||c;a.maks=e;return a}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:m.compositeBand,
fragmentName:"CompositeBand"});var a=b.rasters;if(null!=a&&0!==a.length){a=a.length;var c,l=this.bindFrameBuffer();for(c=0;c<a;c++){var k=this._setupTextureData(b.rasters[c],{notOriginal:0<c});var f=0<c?c.toString():"";this._bindTexture(k.texture,"u_image"+f)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:k.extent,texture:l.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(I,g,r,n,m,d,b){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=g.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(g.hitch(this,function(l){return this._clampBand(l,c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:m.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(I,g,r,n,m,d,b,a){return I([r,
b],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),
statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var l=this._analyzeKernel(),k=a.convolute(c.pixelBlock,{normalizedKernel:l.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(k.pixelType=this.pixelType);k.pixels=k.pixels.map(g.hitch(this,function(f){return this._clampBand(f,k.pixelType)}));return{extent:c.extent,pixelBlock:k}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:d.convolution,fragmentName:"Convolution"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),f=this.gl,e=f.drawingBufferWidth;f=f.drawingBufferHeight;var h=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/
c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/e,1/f],u_kernel:h,u_kernelSize:h.length});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,l=c.reduce(function(e,h){return e+h});0!==l&&1!==l&&(c=c.map(function(e){return e/l}));var k,f=[];for(k=0;k<c.length;k++)f.some(function(e){return e===c[k]})||f.push(c[k]);return{normalizedKernel:c,
distinctValues:f}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,l=this.functionArguments.columns,k=this.functionArguments.kernel,f=[],e,h;for(e=0;e<c;e++)f.push({weights:k.slice(e*l,(e+1)*l)});var p;for(e=1;e<c;e++){var v=f[e].weights;for(k=0;k<e;k++)if(p=f[k].weights){var t=v[0]/p[0];for(h=1;h<l;h++)v[h]/p[h]!==t&&(t=null);null!==t&&(f[e]={row:k,factor:t})}}return f}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(I,g,r,n,m,d){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to extract band function is invalid.");var a=[],c=b.raster.statistics,l=[],k=b.raster.histograms,f=this.functionArguments.bandIDs.length||
b.raster.bandCount;this.functionArguments.bandIDs.forEach(g.hitch(this,function(e){if(e>=f-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+e);e=f-1}if(0>e)return Error("missing band "+e);void 0!==c&&null!==c&&0<c.length&&a.push(c[e]);void 0!==k&&null!==k&&0<k.length&&l.push(k[e])}));this.rasterInfo=g.mixin(b.raster,{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),statistics:a,histograms:l});return!0},read2D:function(b){b=this._clonePixelData(b.raster);
if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){this._performance.start();var a=b.pixelBlock,c=a.statistics,l=a.pixels,k=l.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return b;var f=[],e=[];this.functionArguments.bandIDs.forEach(function(h){if(h>=k-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+h;h=k-1}if(0>h)throw"missing band "+h;f.push(l[h]);void 0!==c&&null!==c&&0<c.length&&
e.push(c[h])});a.pixels=f;a.statistics=e;a.planes=this.functionArguments.bandIDs.length;return b}},readGL:function(b){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:m.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var c=!!(this._alterBand&&b.raster&&b.raster.texture);b=this._setupTextureData(b.raster,{bandIDs:a});var l=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(b.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(I,g,r,n,m,d,b,a,c,l){return I([r,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(k){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},k);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var f=this._weights.reduce(function(e,
h){return e+h});this._weights=this._weights.map(function(e){return e/f})},bind:function(k){k=this.getSourceRasterInfo(k);if(!k.raster)return Error("The raster input to hillshade function is invalid.");k.raster.statistics&&(this.srcStatistics=k.raster.statistics);this.rasterInfo=g.mixin(k.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(k){this._performance.start();k=k.raster;k=c.hillshade(k,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:k.extent.spatialReference.wkid&&null==m[k.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return k},readGL:function(k){this._performance.start();this._initializeProgram({fragment:b.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var f=this._setupTextureData(k.raster),e=this.bindFrameBuffer(),h=this.gl,p=h.drawingBufferWidth;h=h.drawingBufferHeight;var v=f.extent,t=(v.xmax-v.xmin)/p,q=(v.ymax-v.ymin)/h,w=this.functionArguments.altitude,u=this.functionArguments.azimuth,
y=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(y*=2);var x=y/(8*t),z=y/(8*q);.001<y&&v.spatialReference.wkid&&null==m[v.spatialReference.wkid]&&(x/=111E3,z/=111E3);var B=this.functionArguments.psPower,E=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((x=v.spatialReference.wkid&&null==m[v.spatialReference.wkid])?(x=111E3*t,z=111E3*q,x=(y+Math.pow(x,B)*E)/(8*x),z=(y+Math.pow(z,B)*E)/(8*z)):(x=(y+Math.pow(t,B)*E)/(8*t),z=(y+Math.pow(q,B)*E)/(8*q)));
var F=(90-w)*Math.PI/180;w=Math.cos(F);var A=(360-u+90)*Math.PI/180;u=Math.sin(F)*Math.cos(A);F=Math.sin(F)*Math.sin(A);B=Array(6);E=Array(6);v=Array(6);var C=this._weights,G;if(1===this.functionArguments.hillshadeType){var H=this._azimuths.length;for(G=0;G<H;G++)w=this._altitudes[G],u=this._azimuths[G],F=(90-w)*Math.PI/180,w=Math.cos(F),A=(360-u+90)*Math.PI/180,u=Math.sin(F)*Math.cos(A),F=Math.sin(F)*Math.sin(A),B[G]=w,E[G]=u,v[G]=F}else B[0]=w,E[0]=u,v[0]=F;B=B.map(function(N){return parseFloat(N)});
E=E.map(function(N){return parseFloat(N)});v=v.map(function(N){return parseFloat(N)});this._setUniforms({u_cellSize:[t,q],u_zfactor:y,u_xFactor:x,u_yFactor:z,u_sinZcosA:u,u_sinZsinA:F,u_cosZ:w,u_sinZcosAs:E,u_sinZsinAs:v,u_cosZs:B,u_weights:C,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:k&&k.raster&&k.raster.pixelBlock?[1/k.raster.pixelBlock.width,1/k.raster.pixelBlock.height]:[1/p,1/h],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var k=this._indexedColormap,f=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(f=l.buildIndexedColormap(this.functionArguments.colormap))&&f.alphaSpecified,this._indexedColormap=f&&f.indexedColormap,this._indexedColormapOffset=f&&f.offset):f?(this._indexedColormap="multipart"===f.type?this.invert?n.createMultiPartColorRamp(this._invertColorRamp(f)):n.createMultiPartColorRamp(f):this.invert?n.createAlgorithmicColorRamp(this._invertColorRamp(f)):n.createAlgorithmicColorRamp(f),f.fromColor&&f.toColor&&"000"===f.fromColor.slice(0,
3).join("")&&"255255255"===f.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=n.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(k&&this._indexedColormap){f=!0;for(var e=0;e<k.length;e++)if(k[e]!==this._indexedColormap[e]){f=!1;break}f||(this._clrTexture=null)}},_setupColormapTexture:function(k){var f=this._createTexture(),e=this.gl,
h=k.length/4,p=new Float32Array(k.length),v;for(v=0;v<k.length;v++)p[v]=k[v]/255;e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,h,1,0,e.RGBA,e.FLOAT,p);return f}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(I,g,r,n,m,d,b){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(l){return l.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(l){return!!l.extent})[0];this.rasterInfo=g.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[];c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(h){return h.pixelBlock});var l=this.functionArguments.operation;if(null===l)return c[0];this._performance.start();var k=this._getOperations(),f=k.operators[l-1];k=k.functors[l-1];
if(!this.functionArguments.rasters){if(1!==f)throw"no sufficient rasters, require "+f;}else if(999!==f&&this.functionArguments.rasters.length!==f)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+f;var e=31===l?b.isNull(a[0]):50===l?b.setNull(a[0]):b.local(a,{rasterCountNeeded:f,functor:k});"Unknown"!==this.pixelType&&(e.pixelType=this.pixelType,e.pixels=e.pixels.map(g.hitch(this,function(h){return this._clampBand(h,e.pixelType)})));e.statistics||e.calculateStatistics();
return{extent:c[0].extent,pixelBlock:e}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,l=this._getWebGLOperations(),k=l.operators[c-1],f=m.local;l="result\x3d"+l.functors[c-1]+";";31!==c&&50!==c&&(l+="result \x3d vec4(result.rgb, a.a);");f=f.replace("vec4 replaceme"+k+";",l);l=this.gl.getParameter(this.gl.VERSION);var e="";if(-1<l.toLowerCase().indexOf("webgl 1.0")||-1<l.toLowerCase().indexOf("webgl 0."))e=this._getPolyfill(c);f=f.replace("vec4 polyfill;",e);
1<k&&(f=f.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",k.toString())));this._initializeProgram({fragment:f,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){c=c.length;l=this.bindFrameBuffer();for(k=0;k<c;k++){f=0<k?k.toString():"";var h=this._setupTextureData(a.rasters[k],{reCreate:!0});this._bindTexture(h.texture,"u_image"+f)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:l.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,c){return a+c},function(a,c){return a-c},function(a,c){return a*c},function(a){return Math.sqrt(a)},function(a,c){return Math.pow(a,c)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,c){return a&c},function(a,c){return a<<c},function(a){return~a},function(a,c){return a|c},function(a,c){return a>>c},function(a,c){return a^c},function(a,c){return a&&c},function(a){return!a},function(a,c){return a||c},function(a,c){return a!=c},function(a){return Math.cos(a)},function(a,c){return Math.cosh(a)},function(a,c){return a/c},function(a,c){return a==c},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,c){return a>c?1:0},function(a,c){return a>=c?1:0},function(a,c){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,c){return a<c?1:0},function(a,c){return a<=c?1:0},function(a){return Math.log(a)},function(a,c){return Math.log10(a)},function(a,c){return Math.log2(a)},999,999,999,999,999,999,function(a,c){return a%c},function(a){return-a},function(a,c){return a!=c?1:0},999,function(a,c){return Math.floor(a)},function(a,c){return Math.ceil(a)},function(a,c){return c?
0:a},function(a,c){return Math.sin(a)},function(a,c){return Math.sinh(a)},function(a,c){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,c){return Math.atan2(a,c)},function(a,c){return a/c},function(a,c){return Math.floor(a/c)},999,999,999,999,999,999,999,999,999,999,function(a,c,l){return a?c:l}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c=
"";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(I,g,r,n,m,d,b){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=g.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),l=this.functionArguments.includedRanges,k=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(f){return parseFloat(f,10)}):null;this._setUniforms({u_includedRanges:l,u_includedRanges_specified:l?!0:!1,u_noDataValues:k,u_noDataValues_specified:k?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(I,g,r,n,m,d,b){return I([r,d],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=g.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),l;if(this.functionArguments.scaled){var k=c.pixels[0];var f=c.mask;var e=k.length;var h=new Uint8Array(e);if(null==f)for(l=0;l<e;l++)h[l]=100*k[l]+100&255;else for(l=0;l<e;l++)f[l]&&(h[l]=100*k[l]+100&255);c.pixels[0]=h;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,l=this.functionArguments.infraredBandID,k=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(l,c)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[l,c,l]}:null});var f=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:k}):this._setUniforms({u_bandId_nir:l,u_bandId_red:c,u_scaled:k});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(I,g,r,n,m,d,
b,a){return I([r,b],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=a.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==n[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:d.slope,fragmentName:"Slope"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),f=this.gl,e=f.drawingBufferWidth;f=f.drawingBufferHeight;var h=l.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/e,1/f],u_cellSize:[(h.xmax-h.xmin)/e,(h.ymax-h.ymin)/f],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(I,g,r,n,m,d,b){return I([n,d],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",
pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);this.rasterInfo=g.mixin(a.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,
"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var c=b.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_remapGL:function(a){this._performance.start();
this._initializeProgram({fragment:m.remap,fragmentName:"Remap"});var c=new Uint8Array(64),l=this.functionArguments.colorBreaks;l.forEach(function(h,p){c[4*p]=h.mappedColor[0];c[4*p+1]=h.mappedColor[1];c[4*p+2]=h.mappedColor[2];c[4*p+3]=1>=h.mappedColor[3]?255*h.mappedColor[3]:h.mappedColor[3]});var k=l[l.length-1],f=k.mappedColor;c[60]=f[0];c[61]=f[1];c[62]=f[2];c[63]=1>=f[3]?255*f[3]:f[3];var e=new Float32Array(16);l.forEach(function(h,p){e[p]=h.value});e[15]=k.value;this._clrTexture||(this._clrTexture=
this._setupColormapTexture(c));l=this._clrTexture;k=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:e});this._bindTexture(l,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:k.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),l=a.length/4,k=new Float32Array(a.length),f=this.renderTexture?255:1,e,h=this.gl;for(e=0;e<a.length;e++)k[e]=a[e]/
f;h.getExtension("OES_texture_float");h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l,1,0,h.RGBA,h.FLOAT,k);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(I,g,r,n,m){return I([n,m],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments={raster:null}},
bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=g.mixin(d.raster,{});return!0},read2D:function(d){return d.raster},readGL:function(d){this._initializeProgram({fragment:r.identity,fragmentName:"identity"});d=this._setupTextureData(d.raster);var b=this.bindFrameBuffer();this._bindTexture(d.texture,"u_image");this._drawGL();return{extent:d.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(I,g,r,n,m){return I([n,m],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to convolution function is invalid.");
this.rasterInfo=g.mixin(d.raster,{bandCount:d.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,d.raster.pixelType),statistics:d.raster.statistics,histograms:d.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(d){this._performance.start();this._initializeProgram({fragment:r.resample,fragmentName:"Resample"});var b=this._setupTextureData(d.raster),a=this.bindFrameBuffer(),c=this.gl,l=c.drawingBufferWidth;c=c.drawingBufferHeight;
var k=d.raster;void 0!==k.pixelBlock?(b=b||this._setupTextureData(k),d=k.pixelBlock.width,k=k.pixelBlock.height):(b=b||k,d=l,k=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[d/l,k/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/l,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),
function(I,g,r,n,m,d,b,a,c){var l=function(){function k(e){f[e.prototype.rendererName]=e}var f={};k(n);k(d);k(b);k(m);k(a);k(c);return f}();return{wellKnownRenderers:l,isSupported:function(k){if(!k)return!1;var f=!0;l[k.rendererName]||(f=!1);return f},create:function(k){if(!k)return null;if(k.rendererName){var f=k.rendererName;k=k.rendererArguments}else f="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(k.type),f="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[f],
"rasterStretch"===k.type&&k.bandIndex&&1<k.bandIndex.length&&(f="RGB");return(f=l[f])?new f(k):null},createDefaultRenderer:function(k){if(k&&k.raster){var f=k.raster.rasterInfo,e=k.raster.dataType;if(f){var h=k.raster.rasterFunction,p=["Stretch","Colormap","ContrastAndBrightness"];if(h&&"U8"===f.pixelType&&-1<p.indexOf(h.functionName))h.renderTexture=!0;else if("Processed"!==e||!(k.useWebGL&&h&&h.renderTexture||!k.useWebGL&&"U8"===f.pixelType)){h&&(f=h.rasterInfo);h=f.bandCount;var v=f.colormap,t=
f.vat;p=f.histograms;p&&0===p.length&&(p=null);var q=f.statistics&&f.statistics.map(function(y){return[y.min,y.max,y.mean,y.stddev]});if(1===h&&v&&0<v.length)var w=this._getDefaultColormapRenderer(t,v);else if(1===h&&t&&t.features&&0<t.features.length)w=new m({});else{v=0;t=!1;e||!k.raster||!k.raster.tileInfo||void 0!==k.raster.tileInfo.tileType&&"Map"!==k.raster.tileInfo.tileType?"U8"===f.pixelType&&"Processed"===e?(v=5,q=q||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],t=!1):"U8"===f.pixelType||"Elevation"===
e?(v=5,t=q?!1:!0):"Scientific"===e||"StdTime"===e?(v=5,t=q?!1:!0,w=this._getDefaultScientificColorRamp()):p&&0<p.length?(v=6,t=!1):q?(v=5,t=!1):(v=6,t=!0):(q=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],v=5,t=!1);q||(v=5,t=!0);k=k.bandIds||k.raster&&k.raster.imageServiceParams&&k.raster.imageServiceParams.bandIds;var u;3<=h&&(u=k&&3===k.length?k.slice():this.getDefaultBandCombination(f));u&&q&&(q=u.map(function(y){return q[y]}));f={stretchType:v,min:0,max:255,dra:t,minPercent:.25,maxPercent:.25,useGamma:!1,
computeGamma:!1,statistics:q,histograms:p,numberOfStandardDeviations:2.5,bandIndex:u};1===h||u&&1===u.length?(w&&(f.colorRamp=w,f.invert=!1),w=new b(f)):w=new d(f)}return w}}}},getDefaultBandCombination:function(k){var f=k.bandCount;if(1===f)return null;if(2===f)return[0];var e=(k=k.keyProperties)&&k.ChangeAnalysisParameters&&k.ChangeAnalysisParameters.AnalysisType;if(e&&("ccdc"===e.toLowerCase()||"landtrendr"===e.toLowerCase()))return[0];k=k&&k.BandProperties;var h;if(k&&k.length===f){var p=this.getWellKnownBandIndexes(k);
k=p.red;e=p.green;var v=p.blue;p=p.nir;null!=k&&null!=e&&null!=v?h=[k,e,v]:null!=p&&null!=k&&null!=e&&(h=[p,k,e])}!h&&3<=f&&(h=[0,1,2]);return h},getWellKnownBandIndexes:function(k){for(var f={},e=0;e<k.length;e++){var h=k[e],p=h.BandName&&h.BandName.toLowerCase();"red"===p?f.red=e:"green"===p?f.green=e:"blue"===p?f.blue=e:"nearinfrared"===p||"nearinfrared_1"===p||"nir"===p?f.nir=e:h.WavelengthMax&&h.WavelengthMin&&(p=h.WavelengthMin,h=h.WavelengthMax,null==f.blue&&410<=p&&480>=p&&480<=h&&540>=h?
f.blue=e:null==f.green&&490<=p&&560>=p&&560<=h&&610>=h?f.green=e:null==f.red&&595<=p&&670>=p&&660<=h&&730>=h?f.red=e:null==f.nir&&700<=p&&860>=p&&800<=h&&950>=h&&(f.nir=e))}return f},_getDefaultColormapRenderer:function(k,f){if(f||f.length){var e=[],h=this._ratContainsColormap(k);if(h)var p=this._getRATValueClassNameMap(k);f.forEach(function(v){var t=p?p[v[0]]:v[0];e.push({color:[v[1],v[2],v[3]],value:v[0],label:h?null!=t?t:"":v[0]})});return new n({colormapInfos:e})}},_ratContainsColormap:function(k){if(!k||
!k.fields)return!1;var f,e,h;return k.fields.some(function(p){p&&p.name&&(p=p.name.toLowerCase(),"red"===p&&(f=!0),"green"===p&&(e=!0),"blue"===p&&(h=!0));return f&&e&&h})},_getRATValueClassNameMap:function(k){if(!k||!k.fields)return null;var f={},e,h;k.fields.forEach(function(p){if("classname"===p.name.toLowerCase()||"class_name"===p.name.toLowerCase())e=p.name;"value"===p.name.toLowerCase()&&(h=p.name)});k.features.forEach(function(p){p=p.attributes;f[p[h]]=e?p[e]:p[h]});return f},_getDefaultScientificColorRamp:function(){return{type:"multipart",
colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(k){return{fromColor:k.toColor,toColor:k.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(I,g,r,n){return I([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",
renderTexture:!0,constructor:function(m){m&&m.colormapInfos&&(m.colormap=m.colormapInfos.map(function(d){return[d.value].concat(d.color)}));this._function=new n(m);this._function.outputPixelType="U8";this._function.renderTexture=!0},draw2D:function(m){this._updateColormapParameters();m=this._clonePixelData(m);return m=this._function._colorize(m)},drawGL:function(m){this._updateColormapParameters();this._function._colorizeGL(m)},toJson:function(){var m=this._function.toJson().rasterFunctionArguments;
return{rendererName:this.rendererName,rendererArguments:m}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(m){return{value:m[0],color:m.slice(1),label:m[0]}})}},_updateColormapParameters:function(){var m=this._function.functionArguments;m.colormap=this.colormap;m.colormapName=this.colormapName;m.colorRamp=this.colorRamp;m.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(I,g,r,n){return I(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(m){m=m||{};this.raster=m.raster||m.Raster||this.raster;this.draw=g.hitch(this,this.draw);this.bind=g.hitch(this,this.bind);m=g.clone(m);Object.keys(m).forEach(function(d){null==m[d]&&delete m[d]});g.mixin(this,m)},bind:function(m){if(!m)throw"failed to bind without options";var d=m;m.layer&&(m=m.layer,d={id:m.id,
rawRasterInfo:m.raster.rasterInfo,glSetting:m._glSetting,xformSetting:m.tileManager&&m.tileManager.xformSetting,useWebGL:m.useWebGL,resampling:m.tileMode&&m.tileManager&&m.tileManager.xformSetting.requireProjection&&!m._hasTilingEffects&&"Thematic"!==m.raster.dataType?1:0,tileMode:m.tileMode});this._rawRasterInfo=d.rawRasterInfo;this.useWebGL=d.useWebGL;this._function&&this._function.setProcessingContext(g.mixin({useProcessedData:!0},d));this._processingContext=d},hasTilingEffects:function(){},draw:function(m){return this.useWebGL?
this.drawGL(m):this.draw2D(m)},toJson:function(){},_clonePixelData:function(m){if(null==m)return m;var d={};m.extent&&(d.extent=new r(m.extent.xmin,m.extent.ymin,m.extent.xmax,m.extent.ymax,m.extent.spatialReference));m=m.processedPixelBlock||m.pixelBlock;if(null==m)return d;d.pixelBlock=m.clone?m.clone():n.prototype.clone(m);return d}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction",
"../../../renderers/colorRampGenerator"],function(I,g,r,n,m){return I([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(d){d&&d.colormap&&(this.colormap=d.colormap,this._function=new n(d),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(d){this.inherited(arguments);if(!this._function){var b=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;
if(!b)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var l=b.fields.filter(function(w){return"value"===w.name.toLowerCase()})[0];if(l)var k=l.name;a||((a=b.fields.filter(function(w){return-1<["classname","category"].indexOf(w.name.toLowerCase())})[0])||(a=b.fields.filter(function(w){return"esriFieldTypeString"===
w.type})[0]),this.alias=(this.field=a=a&&a.name||k)&&a.alias||k);var f=[],e;if(!c){c=[];var h=b.fields.filter(function(w){return"alpha"===w.name.toLowerCase()})[0];var p=b.fields.filter(function(w){return"red"===w.name.toLowerCase()})[0];var v=b.fields.filter(function(w){return"green"===w.name.toLowerCase()})[0];var t=b.fields.filter(function(w){return"blue"===w.name.toLowerCase()})[0];for(l=0;l<b.features.length;l++){var q=b.features[l].attributes;(e=c.some(function(w){w.value===q[a]}))||(h&&p&&
v&&t?c.push({value:q[a],alias:q[a],color:[q[p.name],q[v.name],q[t.name],q[h.name]]}):p&&v&&t?c.push({value:q[a],alias:q[a],color:[q[p.name],q[v.name],q[t.name]]}):c.push({value:q[a],alias:q[a]}))}if(!(p&&v&&t))for(e=m.createRandomColorRamp({size:c.length}),l=0;l<c.length;l++)c[l].color=e[l];this.uniqueValueInfos=c}if(c)c.forEach(function(w){f=f.concat(b.features.filter(function(u){return w.value==u.attributes[a]}).map(function(u){return[u.attributes[k]].concat(w.color||w.symbol&&w.symbol.color)}))}),
this.defaultColor&&b.features.filter(function(w){f.some(function(u){return u[0]===w.attributes[k]})||f.push([w.attributes[k]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=new n({colormap:f});this.colormap=f;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(d){d=this._clonePixelData(d);return d=this._function._colorize(d)},drawGL:function(d){this._function._colorizeGL(d)},
toJson:function(d){var b={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};d&&(b.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:b}},toCommonRendererJson:function(){var d=this.attributeField||this.field1||this.field,b=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",
field1:d,uniqueValueInfos:b}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),function(I,g,r,n,m,d){return I([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);b=g.mixin({},b,{stretchType:this.stretchType});this._stretchFunction=new n(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=b.bandIndex||b.BandIndex;this._function=new m(b);
this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&!this.contrastOffset&&!this.brightnessOffset)return b;this._stretchFunction._stretch(b);var a=b.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c);a&&a.pixels.length>l&&c&&(a.pixels=c.map(function(k){return a.pixels[k]}),
a.statistics&&(a.statistics=c.map(function(k){return a.statistics[k]})));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=d.contrastBrightnessStretch(b.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();b.pixelBlock&&(b=this._clonePixelData(b));var a=b.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c),k=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,
f=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,e,h;a&&a.pixels.length>l&&c&&(a.pixels=c.map(function(p){return a.pixels[p]}),a.statistics&&(a.statistics=c.map(function(p){return a.statistics[p]})),k&&0<k.length&&k.length!==c.length&&(e=c.map(function(p){return k[p]})),f&&0<f.length&&f.length!==c.length&&(h=c.map(function(p){return f[p]})));this._stretchFunction.functionArguments.statistics=e||k;this._stretchFunction.functionArguments.histograms=
h||f;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._function._cbGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=this._stretchFunction.toJson().rasterFunctionArguments;b.bandIndex=this.bandIndex;b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:b}},
toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:g.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:g.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},
_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),
function(I,g,r,n,m,d,b,a){return I([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=g.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(l){null==c[l]&&delete c[l]});this._function=new d(c);this._stretchFunction=new m(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new b(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var l=c.pixelBlock,k=this.bandIndex?this.bandIndex[0]:0;l&&1<l.pixels.length&&l.pixels.length>k&&(l.pixels=[l.pixels[k]],l.statistics&&(l.statistics=[l.statistics[k]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=a.contrastBrightnessStretch(c.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();c.pixelBlock&&(c=this._clonePixelData(c));var l=c.pixelBlock,k=this.bandIndex?this.bandIndex[0]||0:0,f=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,e=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,h,p;l&&1<l.pixels.length&&
l.pixels.length>k&&(l.pixels=[l.pixels[k]],l.statistics&&(l.statistics=[l.statistics[k]]),f&&f.length>k&&(h=[f[k]]),e&&e.length>k&&(p=[e[k]]));this._stretchFunction.functionArguments.statistics=h||f;this._stretchFunction.functionArguments.histograms=p||e;l=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),l&&(c=this._clrFunction._colorizeGL(c)),
this._function._cbGL(c)):l?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:g.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:g.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(I,g,r,n,m){return I([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(d){d=d||{};this._function=new m(d);this._function.outputPixelType="U8";var b=
d.classBreakInfos;d=d.minValue;null!=d&&b&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(d,b))},bind:function(d){this.inherited(arguments);this.isColormapFunction=!1;var b=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=b&&b.vat;if(a&&"u8"===b.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(b=a.fields.filter(function(p){return"value"===p.name.toLowerCase()})[0])var l=b.name;var k=a.features.sort(function(p,v){return parseFloat(p.attributes[c])-
parseFloat(v.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var f=[],e=this.field,h=this.classBreakInfos;h.forEach(function(p,v){a.features.forEach(function(t){var q=h[v-1]&&h[v-1].classMaxValue||k;t.attributes[e]<=p.classMaxValue&&(t.attributes[e]>q||t.attributes[e]===k)&&(q=p.symbol.color,f.some(function(w){return w[0]===t.attributes[l]})||f.push([t.attributes[l]].concat(q)))})});this._function=new n({colormap:f});this.colormap=f;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(g.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(d){if(this.isColormapFunction)return this._updateColormapParameters(),d=this._clonePixelData(d),d=this._function._colorize(d);this._updateRemapParameters();return this._function._remap(d)},drawGL:function(d){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(d)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(d))},
toJson:function(){var d=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:d}},toCommonRendererJson:function(){var d,b=this.classBreakInfos,a=this.colorBreaks;if(null==b&&a)for(b=[],d=0;d<a.length-1;d++)b.push({classMaxValue:a[d+1].value,symbol:{color:a[d].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[d].value+" - "+a[d+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:b}},
_updateRemapParameters:function(){var d=this.classBreakInfos,b=this.minValue;null!=b&&d&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(b,d))},_getSortedColorBreaks:function(d,b){b=b.map(function(c){return{maxValue:c.classMaxValue,color:c.symbol.color}}).sort(function(c,l){return c.maxValue-l.maxValue});var a=[{value:d,mappedColor:b[0].color}];for(d=0;d<b.length;d++)a.push({value:b[d].maxValue,mappedColor:d===b.length-1?b[d].color:b[d+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(I,g,r,n,m,d,b){return I([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=g.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(c){null==a[c]&&delete a[c]});this._function=new m(a);this._hillshadeFunction=new n(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k){I={requirePE:function(e,h){return!(e.equals(h)||e._canProject(h))},load:function(){var e=new r;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var h=new r;h.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=h.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?e.resolve():this._loadPromise.isRejected()&&e.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(e),this._loadPromise.then(g.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.resolve()})}),g.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.reject()})})));return e.promise},computeError:function(e,h){return[Math.abs((e[0]+e[4]+e[4*h.rows]+e[4*h.rows+4])/4-e[2*h.rows+2]),Math.abs((e[1]+e[5]+e[4*h.rows+1]+e[4*h.rows+5])/4-e[2*h.rows+3])]},getDefaultDatumTransformationForDataset:function(e,h,p){if(!(h&&e.spatialReference&&
this.requirePE(e.spatialReference,h)&&a.isLoaded()))return null;e=new b(e.toJson());h=new l(h.toJson());return p?a.getTransformation(h,e.spatialReference,e):a.getTransformation(e.spatialReference,h,e)},project:function(e,h,p){if(!h||e.spatialReference.equals(h))return e;var v=a.isLoaded()?a:c;"esri.geometry.Extent"===e.declaredClass?e=new b(e.toJson()):"esri.geometry.Point"===e.declaredClass&&(e=new k(e.toJson()));h=new l(h.toJson());(e=v.project(e,h))&&"esri.geometry.Extent"===e.declaredClass?(e=
new b(e.toJson()),p&&(1E-5>Math.abs(e.xmin+180)&&1E-5>Math.abs(e.xmax-180)?(e.xmin=0,e.xmax=360):(0>e.xmin&&(e.xmin+=360,e.xmax+=360),0>e.xmax&&(e.xmax+=360)))):e&&"esri.geometry.Point"===e.declaredClass&&(e=new k(e.toJson()),p&&0>e.x&&(e.x+=360));return e},projectResolution:function(e,h,p){var v=p.xmin+(p.xmax-p.xmin)/2;p=p.ymin+(p.ymax-p.ymin)/2;e=new b(v,p,v+e.x,p+e.y,e.spatialReference);e=this.project(e,h);return new k(e.xmax-e.xmin,e.ymax-e.ymin,h)},getProjectionOffsetGrid:function(e,h,p,v,t,
q,w){null==w&&(w=[32,32]);var u=e.xmin,y=e.ymin,x=e.xmax,z=e.ymax,B=e.spatialReference,E=h.spatialReference,F=a.isLoaded()?a:c,A=t?-t:null,C=w[0]*p.x,G=w[1]*p.y;x={cols:Math.ceil((x-u)/C)+1,rows:Math.ceil((z-y)/G)+1};e=[];for(z=0;z<x.cols;z++){var H=N;var N=[];for(p=0;p<x.rows;p++){var M=new k({x:u+C*z,y:y+G*p,spatialReference:B});M=F.project(M,E,q);if(!M)return null;v&&0>M.x&&(M.x+=360);N.push(M);0<z&&null!=A&&M.x<H[p].x&&(M.x+=t-A,M.x<H[p].x&&(M.x+=t-A));e.push((M.x-h.xmin)/(h.xmax-h.xmin));e.push((M.y-
h.ymin)/(h.ymax-h.ymin))}}h=this.computeError(e,x);v=new Float32Array((x.cols-1)*(x.rows-1)*12);t=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);q=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(z=0;z<x.cols-1;z++)for(p=0;p<x.rows-1;p++){C=z*x.rows*2+2*p;u=e[C];y=e[C+1];N=e[C+2];B=e[C+3];C+=2*x.rows;E=e[C];F=e[C+1];A=e[C+2];G=e[C+3];H=0;M=12*(p*(x.cols-1)+z);for(C=0;3>C;C++)v[M++]=t[H++]*u+t[H++]*N+t[H++]*A;for(C=H=0;3>C;C++)v[M++]=t[H++]*y+t[H++]*B+t[H++]*G;for(C=H=0;3>C;C++)v[M++]=q[H++]*u+q[H++]*E+q[H++]*
A;for(C=H=0;3>C;C++)v[M++]=q[H++]*y+q[H++]*F+q[H++]*G}return{offsets:e,error:h,coefficients:v,spacing:w,size:[x.cols-1,x.rows-1]}},getHalfWorldWidth:function(e){var h=e&&e.wkid;if(null!=h)return e.isWebMercator()&&(h=3857),null==d[h]?180:f[h]}};n("extend-esri")&&g.setObject("layers.rasterLib.raster.rasterProjectionHelper",I,m);var f={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7};return I})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),function(I,g,r,n,m,d){function b(f,e,h,p,v){void 0===p&&(p=null);void 0===v&&(v=!1);if(null===p){var t=d.cacheKey(e,h);void 0!==k[t]?p=k[t]:(p=a(e,h,null),null===p&&(p=new d),k[t]=p)}return c._project(f,e,h instanceof m||!1===v?h:new m(h),p,v)}function a(f,e,h){void 0===h&&(h=null);f=c._getTransformation(f,
e,h);return null!==f?d.fromGE(f):null}Object.defineProperty(g,"__esModule",{value:!0});var c=null;g.isLoaded=function(){return!!c&&n.isLoaded()};g.isSupported=function(){return n.isSupported()};var l=null;g.load=function(){if(l)return l.promise;l=new r;var f=n.load();I(["./geometryEngine"],function(e){c=e;f.then(function(){c._enableProjection(n);l.resolve()},function(h){l.reject(h)})});return l.promise};g.project=function(f,e,h){void 0===h&&(h=null);return f instanceof Array?0===f.length?[]:b(f,f[0].spatialReference,
e,h):b([f],f.spatialReference,e,h)[0]};var k={};g.projectMany=b;g.getTransformation=a;g.getTransformations=function(f,e,h){void 0===h&&(h=null);f=c._getTransformationBySuitability(f,e,h);if(null!==f){e=[];for(h=0;h<f.length;h++)e.push(d.fromGE(f[h]));return e}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(I,g,r,n,m){function d(t){function q(x,z,B){x[z]=B(x[z])}g._pe=t;f.init();e.init();h.init();p.init();
v.init();g.PeGCSExtent=function(x){function z(){return null!==x&&x.apply(this,arguments)||this}r(z,x);z.prototype.destroy=function(){g._pe.destroy(this)};return z}(g._pe.PeGCSExtent);for(var w=0,u=[g._pe.PeDatum,g._pe.PeGeogcs,g._pe.PeGeogtran,g._pe.PeObject,g._pe.PeParameter,g._pe.PePrimem,g._pe.PeProjcs,g._pe.PeSpheroid,g._pe.PeUnit];w<u.length;w++)t=u[w],q(t.prototype,"getName",function(x){return function(){return x.call(this,Array(f.PE_NAME_MAX))}});w=0;for(u=[g._pe.PeGeogtran,g._pe.PeProjcs];w<
u.length;w++)t=u[w],q(t.prototype,"getParameters",function(x){return function(){for(var z=Array(f.PE_PARM_MAX),B=x.call(this),E=0;E<z.length;E++){var F=g._pe.getValue(B,"*");z[E]=F?g._pe.wrapPointer(F,g._pe.PeParameter):null;B+=Int32Array.BYTES_PER_ELEMENT}return z}});q(g._pe.PeHorizon.prototype,"getCoord",function(x){return function(){var z=this.getSize();if(!z)return null;var B=[],E=x.call(this);l(B,z,E);return B}});q(g._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(x){var z=g._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var B=null,E=x.call(this);if(!g._pe.compare(E,g._pe.NULL)){B=[E];var F=this.getSteps();if(1<F){E=g._pe.getPointer(E);for(var A=1;A<F;A++)B.push(g._pe.wrapPointer(E+z*A,g._pe.PeGTlistExtendedGTs))}}return B}});var y=g._pe._pe_getPeHorizonSize();t=function(x){return function(){var z=this._cache;z||(this._cache=z=new Map);if(z.has(x))return z.get(x);var B=null,E=x.call(this);if(!g._pe.compare(E,g._pe.NULL)){B=[E];var F=E.getNump();if(1<F){E=g._pe.getPointer(E);for(var A=1;A<F;A++)B.push(g._pe.wrapPointer(E+
y*A,g._pe.PeHorizon))}}z.set(x,B);return B}};q(g._pe.PeProjcs.prototype,"horizonGcsGenerate",t);q(g._pe.PeProjcs.prototype,"horizonPcsGenerate",t);g._pe.PeObject.prototype.toString=function(x){void 0===x&&(x=f.PE_STR_OPTS_NONE);g._pe.ensureCache.prepare();var z=g._pe.getPointer(this),B=g._pe.ensureInt8(Array(f.PE_BUFFER_MAX));return g._pe.UTF8ToString(g._pe._pe_object_to_string_ext(z,x,B))}}function b(t){if(t){var q=g._pe.getClass(t);q&&(q=g._pe.getCache(q))&&(t=g._pe.getPointer(t))&&delete q[t]}}
function a(t,q){var w=[];q=Array(q);for(var u=0;u<t;u++)w.push(g._pe.ensureInt8(q));return w}function c(t){if(Array.isArray(t[0])){var q=[];t.forEach(function(w){q.push(w[0],w[1])})}else q=t;return q}function l(t,q,w,u){void 0===u&&(u=!1);if(u)for(u=0;u<2*q;u++)t[u]=g._pe.getValue(w+u*Float64Array.BYTES_PER_ELEMENT,"double");else{var y=0===t.length;for(u=0;u<q;u++)y&&(t[u]=Array(2)),t[u][0]=g._pe.getValue(w,"double"),t[u][1]=g._pe.getValue(w+Float64Array.BYTES_PER_ELEMENT,"double"),w+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(g,"__esModule",{value:!0});var k;g._pe=null;g.isLoaded=function(){return!!g._pe};g.isSupported=function(){return!!m("esri-wasm")};g.load=function(){if(k)return k.promise;k=new n;I(["./support/pe-wasm"],function(t){t({locateFile:function(q){return I.toUrl("./support/"+q)},onAbort:function(q){k.reject(Error(q))}}).then(function(q){d(q);k.resolve()})});return k.promise};(function(t){function q(y,x,z){g._pe.ensureCache.prepare();var B=c(z),E=z===B;B=g._pe.ensureFloat64(B);(y=g._pe._pe_geog_to_proj(g._pe.getPointer(y),
x,B))&&l(z,x,B,E);return y}function w(y,x,z){return u(y,x,z,0)}function u(y,x,z,B){g._pe.ensureCache.prepare();var E=c(z),F=z===E;E=g._pe.ensureFloat64(E);(y=g._pe._pe_proj_to_geog_center(g._pe.getPointer(y),x,E,B))&&l(z,x,E,F);return y}t.geogToProj=q;t.projGeog=function(y,x,z,B){switch(B){case f.PE_TRANSFORM_P_TO_G:return w(y,x,z);case f.PE_TRANSFORM_G_TO_P:return q(y,x,z)}return 0};t.projToGeog=w;t.projToGeogCenter=u})(g.PeCSTransformations||(g.PeCSTransformations={}));var f;(function(t){t.init=
function(){t.PE_BUFFER_MAX=g._pe.PeDefs.prototype.PE_BUFFER_MAX;t.PE_NAME_MAX=g._pe.PeDefs.prototype.PE_NAME_MAX;t.PE_MGRS_MAX=g._pe.PeDefs.prototype.PE_MGRS_MAX;t.PE_USNG_MAX=g._pe.PeDefs.prototype.PE_USNG_MAX;t.PE_DD_MAX=g._pe.PeDefs.prototype.PE_DD_MAX;t.PE_DDM_MAX=g._pe.PeDefs.prototype.PE_DDM_MAX;t.PE_DMS_MAX=g._pe.PeDefs.prototype.PE_DMS_MAX;t.PE_UTM_MAX=g._pe.PeDefs.prototype.PE_UTM_MAX;t.PE_PARM_MAX=g._pe.PeDefs.prototype.PE_PARM_MAX;t.PE_TYPE_NONE=g._pe.PeDefs.prototype.PE_TYPE_NONE;t.PE_TYPE_GEOGCS=
g._pe.PeDefs.prototype.PE_TYPE_GEOGCS;t.PE_TYPE_PROJCS=g._pe.PeDefs.prototype.PE_TYPE_PROJCS;t.PE_TYPE_GEOGTRAN=g._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;t.PE_TYPE_COORDSYS=g._pe.PeDefs.prototype.PE_TYPE_COORDSYS;t.PE_TYPE_UNIT=g._pe.PeDefs.prototype.PE_TYPE_UNIT;t.PE_STR_OPTS_NONE=g._pe.PeDefs.prototype.PE_STR_OPTS_NONE;t.PE_STR_AUTH_NONE=g._pe.PeDefs.prototype.PE_STR_AUTH_NONE;t.PE_STR_AUTH_TOP=g._pe.PeDefs.prototype.PE_STR_AUTH_TOP;t.PE_STR_NAME_CANON=g._pe.PeDefs.prototype.PE_STR_NAME_CANON;t.PE_PARM_X0=
g._pe.PeDefs.prototype.PE_PARM_X0;t.PE_PARM_ND=g._pe.PeDefs.prototype.PE_PARM_ND;t.PE_TRANSFORM_1_TO_2=g._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;t.PE_TRANSFORM_2_TO_1=g._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;t.PE_TRANSFORM_P_TO_G=g._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;t.PE_TRANSFORM_G_TO_P=g._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;t.PE_HORIZON_RECT=g._pe.PeDefs.prototype.PE_HORIZON_RECT;t.PE_HORIZON_POLY=g._pe.PeDefs.prototype.PE_HORIZON_POLY;t.PE_HORIZON_LINE=g._pe.PeDefs.prototype.PE_HORIZON_LINE;
t.PE_HORIZON_DELTA=g._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(f=g.PeDefs||(g.PeDefs={}));(function(t){function q(x,z){var B=null,E=u[x];E||(E={},u[x]=E);E.hasOwnProperty(String(z))?B=E[z]:(x=g._pe.PeFactory.prototype.factoryByType(x,z),g._pe.compare(x,g._pe.NULL)||(B=x,E[z]=B));return B=w(B)}function w(x){if(x){var z=x.getType();switch(z){case f.PE_TYPE_GEOGCS:x=g._pe.castObject(x,g._pe.PeGeogcs);break;case f.PE_TYPE_PROJCS:x=g._pe.castObject(x,g._pe.PeProjcs);break;case f.PE_TYPE_GEOGTRAN:x=g._pe.castObject(x,
g._pe.PeGeogtran);break;default:z&f.PE_TYPE_UNIT&&(x=g._pe.castObject(x,g._pe.PeUnit))}}return x}var u={},y={};t.initialize=function(){g._pe.PeFactory.prototype.initialize(null)};t.coordsys=function(x){return q(f.PE_TYPE_COORDSYS,x)};t.factoryByType=q;t.fromString=function(x,z){var B=null,E=y[x];E||(E={},y[x]=E);E.hasOwnProperty(z)?B=E[z]:(x=g._pe.PeFactory.prototype.fromString(x,z),g._pe.compare(x,g._pe.NULL)||(B=x,E[z]=B));return B=w(B)};t.geogcs=function(x){return q(f.PE_TYPE_GEOGCS,x)};t.geogtran=
function(x){return q(f.PE_TYPE_GEOGTRAN,x)};t.getCode=function(x){return g._pe.PeFactory.prototype.getCode(x)};t.projcs=function(x){return q(f.PE_TYPE_PROJCS,x)};t.unit=function(x){return q(f.PE_TYPE_UNIT,x)}})(g.PeFactory||(g.PeFactory={}));g.PeGCSExtent=null;var e;(function(t){var q;t.init=function(){t.PE_GTLIST_OPTS_COMMON=g._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;q=g._pe._pe_getPeGTlistExtendedEntrySize()};t.getGTlist=function(w,u,y,x,z,B){var E=null,F=new g._pe.PeInteger(B);try{var A=
g._pe.PeGTlistExtended.prototype.getGTlist(w,u,y,x,z,F);if(B=F.val)if(E=[A],1<B){var C=g._pe.getPointer(A);for(w=1;w<B;w++)E.push(g._pe.wrapPointer(C+q*w,g._pe.PeGTlistExtendedEntry))}}finally{g._pe.destroy(F)}return E}})(e=g.PeGTlistExtended||(g.PeGTlistExtended={}));(function(t){t.destroy=function(q){if(q&&q.length){for(var w=0;w<q.length;w++){var u=q[w];b(u);u.getEntries().forEach(function(y){b(y);y=y.getGeogtran();b(y);y.getParameters().forEach(b);[y.getGeogcs1(),y.getGeogcs2()].forEach(function(x){b(x);
var z=x.getDatum();b(z);b(z.getSpheroid());b(x.getPrimem());b(x.getUnit())})})}g._pe.PeGTlistExtendedEntry.prototype.Delete(q[0])}}})(g.PeGTlistExtendedEntry||(g.PeGTlistExtendedEntry={}));(function(t){t.geogToGeog=function(q,w,u,y,x){g._pe.ensureCache.prepare();var z=c(u),B=u===z;z=g._pe.ensureFloat64(z);var E=0;y&&(E=g._pe.ensureFloat64(y));(q=g._pe._pe_geog_to_geog(g._pe.getPointer(q),w,z,E,x))&&l(u,w,z,B);return q}})(g.PeGTTransformations||(g.PeGTTransformations={}));(function(t){function q(u,
y,x,z,B,E){g._pe.ensureCache.prepare();switch(u){case "dd":var F=g._pe._pe_geog_to_dd;var A=f.PE_DD_MAX;break;case "ddm":F=g._pe._pe_geog_to_ddm;A=f.PE_DDM_MAX;break;case "dms":F=g._pe._pe_geog_to_dms,A=f.PE_DMS_MAX}u=0;y&&(u=g._pe.getPointer(y));y=c(z);y=g._pe.ensureFloat64(y);A=a(x,A);z=g._pe.ensureInt32(A);if(B=F(u,x,y,B,z))for(F=0;F<x;F++)E[F]=g._pe.UTF8ToString(A[F]);return B}function w(u,y,x,z,B){g._pe.ensureCache.prepare();switch(u){case "dd":var E=g._pe._pe_dd_to_geog;break;case "ddm":E=g._pe._pe_ddm_to_geog;
break;case "dms":E=g._pe._pe_dms_to_geog}u=0;y&&(u=g._pe.getPointer(y));y=z.map(function(F){return g._pe.ensureString(F)});z=g._pe.ensureInt32(y);y=g._pe.ensureFloat64(Array(2*x));(E=E(u,x,z,y))&&l(B,x,y);return E}t.geog_to_dms=function(u,y,x,z,B){return q("dms",u,y,x,z,B)};t.dms_to_geog=function(u,y,x,z){return w("dms",u,y,x,z)};t.geog_to_ddm=function(u,y,x,z,B){return q("ddm",u,y,x,z,B)};t.ddm_to_geog=function(u,y,x,z){return w("ddm",u,y,x,z)};t.geog_to_dd=function(u,y,x,z,B){return q("dd",u,y,
x,z,B)};t.dd_to_geog=function(u,y,x,z){return w("dd",u,y,x,z)}})(g.PeNotationDms||(g.PeNotationDms={}));var h;(function(t){t.init=function(){t.PE_MGRS_STYLE_NEW=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;t.PE_MGRS_STYLE_OLD=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;t.PE_MGRS_STYLE_AUTO=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;t.PE_MGRS_180_ZONE_1_PLUS=g._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;t.PE_MGRS_ADD_SPACES=g._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
t.geog_to_mgrs_extended=function(q,w,u,y,x,z,B){g._pe.ensureCache.prepare();var E=0;q&&(E=g._pe.getPointer(q));q=c(u);u=g._pe.ensureFloat64(q);q=a(w,f.PE_MGRS_MAX);var F=g._pe.ensureInt32(q);if(y=g._pe._pe_geog_to_mgrs_extended(E,w,u,y,x,z,F))for(x=0;x<w;x++)B[x]=g._pe.UTF8ToString(q[x]);return y};t.mgrs_to_geog_extended=function(q,w,u,y,x){g._pe.ensureCache.prepare();var z=0;q&&(z=g._pe.getPointer(q));q=u.map(function(B){return g._pe.ensureString(B)});u=g._pe.ensureInt32(q);q=g._pe.ensureFloat64(Array(2*
w));(y=g._pe._pe_mgrs_to_geog_extended(z,w,u,y,q))&&l(x,w,q);return y}})(h=g.PeNotationMgrs||(g.PeNotationMgrs={}));(function(t){t.geog_to_usng=function(q,w,u,y,x,z,B){g._pe.ensureCache.prepare();var E=0;q&&(E=g._pe.getPointer(q));q=c(u);u=g._pe.ensureFloat64(q);q=a(w,f.PE_MGRS_MAX);var F=g._pe.ensureInt32(q);if(y=g._pe._pe_geog_to_usng(E,w,u,y,x,z,F))for(x=0;x<w;x++)B[x]=g._pe.UTF8ToString(q[x]);return y};t.usng_to_geog=function(q,w,u,y){g._pe.ensureCache.prepare();var x=0;q&&(x=g._pe.getPointer(q));
q=u.map(function(z){return g._pe.ensureString(z)});u=g._pe.ensureInt32(q);q=g._pe.ensureFloat64(Array(2*w));(x=g._pe._pe_usng_to_geog(x,w,u,q))&&l(y,w,q);return x}})(g.PeNotationUsng||(g.PeNotationUsng={}));var p;(function(t){t.init=function(){t.PE_UTM_OPTS_NONE=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;t.PE_UTM_OPTS_ADD_SPACES=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;t.PE_UTM_OPTS_NS=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};t.geog_to_utm=function(q,w,u,y,x){g._pe.ensureCache.prepare();
var z=0;q&&(z=g._pe.getPointer(q));q=c(u);u=g._pe.ensureFloat64(q);q=a(w,f.PE_UTM_MAX);var B=g._pe.ensureInt32(q);if(y=g._pe._pe_geog_to_utm(z,w,u,y,B))for(z=0;z<w;z++)x[z]=g._pe.UTF8ToString(q[z]);return y};t.utm_to_geog=function(q,w,u,y,x){g._pe.ensureCache.prepare();var z=0;q&&(z=g._pe.getPointer(q));q=u.map(function(B){return g._pe.ensureString(B)});u=g._pe.ensureInt32(q);q=g._pe.ensureFloat64(Array(2*w));(y=g._pe._pe_utm_to_geog(z,w,u,y,q))&&l(x,w,q);return y}})(p=g.PeNotationUtm||(g.PeNotationUtm=
{}));var v;(function(t){var q=new Map;t.init=function(){t.PE_PCSINFO_OPTION_NONE=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;t.PE_PCSINFO_OPTION_DOMAIN=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;t.PE_POLE_OUTSIDE_BOUNDARY=g._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;t.PE_POLE_POINT=g._pe.PePCSInfo.prototype.PE_POLE_POINT};t.generate=function(w,u){void 0===u&&(u=t.PE_PCSINFO_OPTION_DOMAIN);var y;if(q.has(w)){var x=q.get(w);x[u]&&(y=x[u])}y||(y=g._pe.PePCSInfo.prototype.generate(w,
u),x||(x=[],q.set(w,x)),x[u]=y);return y}})(v=g.PePCSInfo||(g.PePCSInfo={}));(function(t){t.version_string=function(){return g._pe.PeVersion.prototype.version_string()}})(g.PeVersion||(g.PeVersion={}));g._init=d})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,r){g.__proto__=r}||function(g,r){for(var n in r)r.hasOwnProperty(n)&&(g[n]=r[n])};return function(g,r){function n(){this.constructor=
g}I(g,r);g.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(I,g,r){return function(){function n(m){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(m&&m.steps){var d=0;for(m=m.steps;d<m.length;d++){var b=m[d];b instanceof r?this.steps.push(b):this.steps.push(new r({wkid:b.wkid,wkt:b.wkt,isInverse:b.isInverse}))}}}n.cacheKey=
function(m,d){return[void 0!==m.wkid&&null!==m.wkid?m.wkid.toString():"-1",void 0!==m.wkt&&null!==m.wkt?m.wkt.toString():"",void 0!==d.wkid&&null!==d.wkid?d.wkid.toString():"-1",void 0!==d.wkt&&null!==d.wkt?d.wkt.toString():""].join()};n.fromGE=function(m){var d=new n,b="",a=0;for(m=m.steps;a<m.length;a++){var c=r.fromGE(m[a]);d.steps.push(c);b+=c.uid.toString()+","}d._cached_projection={};d._gtlistentry=null;d._chain=b;return d};n.prototype.getInverse=function(){var m=new n;m.steps=[];for(var d=
this.steps.length-1;0<=d;d--)m.steps.push(this.steps[d].getInverse());return m};n.prototype.getGTListEntry=function(){for(var m="",d=0,b=this.steps;d<b.length;d++)m+=b[d].uid.toString()+",";m!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=m);return this._gtlistentry};n.prototype.assignCachedGe=function(m,d,b){this._cached_projection[n.cacheKey(m,d)]=b};n.prototype.getCachedGeTransformation=function(m,d){for(var b="",a=0,c=this.steps;a<c.length;a++)b+=c[a].uid.toString()+
",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);m=this._cached_projection[n.cacheKey(m,d)];return void 0===m?null:m};return n}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require","exports"],function(I,g){var r=0;return function(){function n(m){void 0===m&&(m=null);this.uid=r++;m?(this._wkt=void 0!==m.wkt?m.wkt:null,this._wkid=void 0!==m.wkid?m.wkid:-1,this._isInverse=void 0!==m.isInverse?!0===m.isInverse:!1):(this._wkt=null,this._wkid=
-1,this._isInverse=!1)}n.fromGE=function(m){var d=new n;d._wkt=m.wkt;d._wkid=m.wkid;d._isInverse=m.isInverse;return d};Object.defineProperty(n.prototype,"wkt",{get:function(){return this._wkt},set:function(m){this._wkt=m;this.uid=r++},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"wkid",{get:function(){return this._wkid},set:function(m){this._wkid=m;this.uid=r++},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"isInverse",{get:function(){return this._isInverse},
set:function(m){this._isInverse=m;this.uid=r++},enumerable:!0,configurable:!0});n.prototype.getInverse=function(){var m=new n;m._wkt=this.wkt;m._wkid=this._wkid;m._isInverse=!this.isInverse;return m};return n}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z){I=g([z],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(B){},open:function(){var B=new n,E=this.serviceInfo||this._getServiceInfo(null),F=r.hitch(this,function(C){this.serviceInfo=C;this.version=C.currentVersion;this.rasterInfo=this._parseRasterInfo(C);this.loaded=!0;this._getRasterIdentifier();B.resolve(this)}),A=r.hitch(this,function(C){this.loaded=!0;this._getRasterIdentifier();B.reject(C)});l(E,F,A);return B.promise},
read:function(B){var E=this.url+"/tile/"+B.level+"/"+B.row+"/"+B.col,F={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:E+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:F,tileOptions:B})},identify:function(B,E){null==E&&(E=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var F=(B.x-this.tileInfo.origin.x)/
this.tileInfo.lods[E].resolution/this.tileInfo.cols;B=(this.tileInfo.origin.y-B.y)/this.tileInfo.lods[E].resolution/this.tileInfo.rows;var A=Math.floor(F),C=Math.floor(B),G=Math.floor((F-A)*this.tileInfo.cols);G=Math.min(G,this.tileInfo.cols-1);var H=Math.floor((B-C)*this.tileInfo.rows);H=Math.min(H,this.tileInfo.rows-1);var N=new n;this.read({level:E,row:C,col:A}).then(function(M){var R=H*M.width+G;M&&M.pixels&&0<M.pixels.length?(M=M.mask?M.mask[R]?M.pixels.map(function(S){return S[R]}):null:M.pixels.map(function(S){return S[R]}),
N.resolve(M)):N.reject("no valid data")},function(M){N.reject(M)});return N.promise},setFetchParameters:function(B,E){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var B=this.url,E=new n(t._dfdCanceller);E._pendingDfd=e({url:B,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});E._pendingDfd.then(function(F){E.callback(F)},function(F){E.errback(F)});return E},_parseRasterInfo:function(B){var E=
new x;E.extent=new h(B.fullExtent);E.spatialReference=new v(B.spatialReference);this.tileType=B.cacheType||"Map";switch(this.tileType){case "Map":E.bandCount=3;E.pixelType="U8";this.dataType="Processed";break;case "Elevation":E.bandCount=1;E.pixelType=B.pixelType||"F32";this.dataType="Elevation";break;case "Raster":E.bandCount=null,E.pixelType=null,this.dataType=B.serviceDataType&&B.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var F=B.tileInfo;E.width=Math.floor((B.fullExtent.xmax-
B.fullExtent.xmin)/F.lods[F.lods.length-1].resolution+.5);E.height=Math.floor((B.fullExtent.ymax-B.fullExtent.ymin)/F.lods[F.lods.length-1].resolution+.5);E.cellSize=new p({x:F.lods[F.lods.length-1].resolution,y:F.lods[F.lods.length-1].resolution,spatialReference:B.spatialReference});this.tileInfo=new y(F);this.tileInfo.tileType=this.tileType;return E}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.TileServiceRaster",I,k);return I})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z){I=g([z],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(B){this._cloudBlobStorage=B&&B._cloudBlobStorage},open:function(){var B=new n,E=this.datasetInfo||this._getDatasetInfo(null),F=r.hitch(this,function(C){this.datasetInfo=C;this.rasterInfo=C=this._parseRasterInfo(C);this.tileType="Cache/LERC"===C.format?"Elevation":"Cache/MIXED"===C.format||"Cache/JPEG"===C.format||"Cache/PNG"===
C.format?"Map":"Raster";this.tileInfo=C.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=C.packetSize*C.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();B.resolve(this)}),A=r.hitch(this,function(C){this.loaded=
!0;this._getRasterIdentifier();B.reject(C)});l(E,F,A);return B.promise},read:function(B){var E=new n,F=B.level,A=B.row,C=B.col,G=this._buildCacheFilePath(this.url,F,A,C),H=this._getIndexRecordFromBundle(F,A,C);e({url:G,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(r.hitch(this,function(N,M){if(!E.isCanceled()){console.log("time in ms request "+(new Date-R));var R=new Date;N=new Uint8Array(N);N=this._getTileEndAndContentType(N,H);M={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:G+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+N.position.toString()+"-"+(N.position+N.recordSize).toString()},decodeParams:M,tileOptions:B}).then(function(S){E.isCanceled()||E.resolve(S)},function(S){E.isCanceled()||E.reject(S)})}}));return E.promise},identify:function(){return null},
setFetchParameters:function(B,E){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return e({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(B){var E=new x;switch(B.pixelType){case 1:var F="U1";break;case 1:F="U2";break;case 2:F="U4";break;case 3:F="U8";break;case 4:F="S8";break;
case 5:F="U16";break;case 6:F="S16";break;case 7:F="U32";break;case 8:F="S32";break;case 9:F="F32";break;default:F="F32"}var A,C=[],G=B.LODInfos;for(A=0;A<G.levels.length;A++)C.push({level:G.levels[A],resolution:G.resolutions[A],scale:96/.0254*G.resolutions[A]});A=new v(B.extent.spatialReference||B.geodataXform.spatialReference);C=new y({rows:B.blockHeight,cols:B.blockWidth,dpi:96,format:B.format,compressionQuality:0,origin:B.origin,spatialReference:A,lods:C});E.pixelType=F;E.bandCount=B.bandCount;
E.spatialReference=A;E.extent=new h({xmin:B.extent.xmin,ymin:B.extent.ymin,xmax:B.extent.xmax,ymax:B.extent.ymax,spatialReference:A});E.cellSize=new p({x:B.pixelSizeX,y:B.pixelSizeY,spatialReference:A});E.width=Math.floor((E.extent.xmax-E.extent.xmin)/E.cellSize.x+.5);E.height=Math.floor((E.extent.ymax-E.extent.ymin)/E.cellSize.y+.5);E.statistics=B.statistics.map(function(H){Object.keys(H).forEach(function(N){isNaN(H[N])&&(H[N]=null)});return H});E.histograms=B.histograms;E.geodataXform=B.geodataXform;
E.packetSize=B.packetSize;E.format=B.format;E.compressionQuality=B.compressionQuality;E.tileInfo=C;return E},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(B,E,F,A){var C=this.rasterInfo.packetSize;A=Math.floor(A/C)*C;F="R"+this._toHexString4(Math.floor(F/C)*C)+"C"+this._toHexString4(A);C="L";C=10<=E?C+E.toString():C+("0"+E.toString());return this._cloudBlobStorage?B+"/_alllayers/"+
C+"/"+F+".bundle":B+"/"+C+"_"+F+"/bundle"},_getIndexRecordFromBundle:function(B,E,F){B=this.rasterInfo.packetSize;E=E%B*B+F%B;if(0>E)throw"Invalid level / row / col";return E*this._RECORD_SIZE+64},_getTileEndAndContentType:function(B,E){B=B.subarray(E,E+8);E=0;var F;for(F=0;5>F;F++)E|=(B[F]&255)<<8*F;var A=E&0xffffffffff;E=0;for(F=5;8>F;F++)E|=(B[F]&255)<<8*(F-5);return{position:A,recordSize:E&0xffffffffff}},_toHexString4:function(B){B=B.toString(16);if(4!=B.length)for(var E=4-B.length;0<E--;)B="0"+
B;return B}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.TileRaster",I,k);return I})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z){I=g([x],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(B){B&&B.rasterFx&&this._init(B.rasterFx,B.rasterFxArgs)},open:function(){var B=this.getMemberRasters().map(function(F){return F.open()});this.identifiers=this.getMemberRasters().map(function(F){return F._rasterId});var E=new n;(new c(B,null,null,!0)).then(function(F){F.some(function(A){return!A[0]})?E.reject(F):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=F[0][1].tileInfo,E.resolve(this))}.bind(this));return E.promise},getProjectedFullExtent:function(B){var E=new n;this.getMemberRasters()[0].getProjectedFullExtent(B).then(r.hitch(this,function(F){this.projectedFullExtent=F;E.resolve(F)}));return E.promise},setProcessingContext:function(B){var E=B;B.layer&&(B=B.layer,
E={id:B.id,rawRasterInfo:B.raster.rasterInfo,glSetting:B._glSetting,xformSetting:B.tileManager&&B.tileManager.xformSetting,useWebGL:B.useWebGL,resampling:B.tileMode&&B.tileManager&&B.tileManager.xformSetting.requireProjection&&!B._hasTilingEffects&&"Thematic"!==B.raster.dataType?1:0,tileMode:B.tileMode});this.rasterFunction.setProcessingContext(E);this._layerOptions=E},alterDefinition:function(B){if(B=B||this.rasterFunction)1===this.memberRasters.length&&!B._bindComplete&&(this.rasterFunction=z.create(B,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(B,E){var F=this.getMemberRasters();
F&&1===F.length&&F[0].setFetchParameters(B,E)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(B){var E=new n(h._dfdCanceller);if(B.src){var F=this.rasterFunction.read(B);E.resolve(F);return E.promise}var A=this.getMemberRasters().map(function(N){return N.read(B)});A=new c(A);var C,G,H=this.identifiers;E._pendingDfd=A;A.then(r.hitch(this,function(N){if(C=
N.some(function(M){return M[0]}))G={},N.forEach(function(M,R){G[H[R]]=M[0]?M[1]:null});F=G?this.rasterFunction.read({extent:B.extent,src:G}):null;F.srcData=G;E.resolve(F)}));return E},_init:function(B,E){if(this.rasterFunction=z.create(B,E))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(B,E){var F=Object.keys(B),A,C,G;for(A=0;A<F.length;A++)if(G=B[F[A]]){var H=G instanceof Array?G:[G];for(C=0;C<H.length;C++)(G=
H[C])&&("function"===typeof G||"object"===typeof G)&&G.read&&(G.functionArguments?this._getMemberRasters(G.functionArguments,E):G.sourceType&&"Function"!==G.sourceType&&(G._identifier=G._getRasterIdentifier(),E.some(function(N){return N._identifier===G._identifier})||E.push(G)))}return E}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.FunctionRaster",I,k);return I})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(I){return function(g,r,n,m,d){this.list=
g;r=new I(g,r,n,m,d);var b=r.resolve.bind(r),a=r.cancel.bind(r);r.cancel=function(){g&&g.forEach(function(c){c.cancel&&c.cancel()});a.apply(this,arguments)}.bind(r);r.resolve=function(){this.isFulfilled()||b.apply(this,arguments)}.bind(r);return r}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(I,g,r,n,m,d,b,a,c,l,k){var f=function(e,h){var p;for(p=0;p<e.length;p++)if(h(e[p]))return p;return-1};return I(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(e){this.tiles=[];this.xformSetting={};this.mapSpatialReference=e&&e.mapSR;this.layer=e&&e.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(h){return h._rasterId}):[this.layer.raster._rasterId];(e=e&&e.tileInfo)&&this.setTileInfo(e)},setTileInfo:function(e){this.tileInfo=e;this.virtual=e.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=k.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=k.getHalfWorldWidth(e.spatialReference)},updateResolution:function(e,h){if(!(this.mapResolution&&e&&this._resolutionEqual(this.mapResolution.x,e.x)&&this._resolutionEqual(this.mapResolution.y,e.y))){this.resetTiles();var p=this.xformSetting.requireProjection;this.mapResolution=this.resolution=e;p&&(this.resolution=k.projectResolution(e,this.tileInfo.spatialReference,this.layer.projectedFullExtent||h));this._resolution=
this.resolution;e=this.resolution;if(!this.tileInfo.virtual){p=.75*Math.min(e.x,e.y)+.25*Math.max(e.x,e.y);if(p>=this.tileInfo.lods[0].resolution){var v=this.tileInfo.lods[0];this.ooe=!0}else{if(p<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)v=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(e=0;e<this.tileInfo.lods.length-1;e++)if(v=this.tileInfo.lods[e],h=this.tileInfo.lods[e+1],v.resolution>=p&&h.resolution<=p){v.resolution-p>p-h.resolution&&(v=h);break}this.ooe=!1}this.level=
v&&v.level;e=this.resolution=new a({x:v.resolution,y:v.resolution,spatialReference:this.tileInfo.spatialReference})}p=this.layer.raster.rasterInfo.extent;v=this.tileInfo.origin;h=this.tileInfo.cols;var t=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((v.y-p.ymax)/e.y/t),rowEnd:Math.floor((v.y-p.ymin-e.y)/e.y/t),colStart:Math.floor((p.xmin-v.x)/e.x/h),colEnd:Math.floor((p.xmax-v.x-e.x)/e.x/h)};if(p=this.halfWorldWidth){t=Math.ceil(p/e.x/(h/2));var q=this.tileInfo.applyGCS360Transform?360:
p,w=Math.round(h-(q-v.x)/e.x%h);w===h&&(w=0);this.fullBoundary.colRange=t;this.fullBoundary.paddingRight=w;this.fullBoundary.paddingLeft=Math.round((t*h*e.x+v.x-q-(this.tileInfo.applyGCS360Transform?0:v.x+p))/e.x)}this.hasNewData=!0}},getXformGrid:function(){var e=this.mapExtent,h=this.layer._hasTilingEffects?this.extent:this.fullExtent,p=this.layer.getCurrentResolution(),v=JSON.stringify(e.toJson())+JSON.stringify(h.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=k.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,e.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===v||(this._cachedExtentString=v,this._xformGrid=e=k.getProjectionOffsetGrid(e,h,p,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));e=this._xformGrid;this.xformSetting.meshSize=e&&e.size;return e},getWrapTimes:function(e){var h=k.getHalfWorldWidth(e.spatialReference);if(!h)return 0;var p=
2*h;h=this.tileInfo.applyGCS360Transform?0:-h;return Math.floor((e.xmax-h)/p)-Math.floor((e.xmin-h)/p)},normalizeCoordinate:function(e,h){if(!h)return 0;var p=2*h;if(0<e){for(;e>h;)e-=p;return e}for(;e<-h;)e+=p;return e},resetTiles:function(){this.tiles.forEach(g.hitch(this,function(e){e.fetch&&!e.fetch.isCanceled()&&e.fetch.cancel();e.update&&!e.update.isCanceled()&&e.update.cancel()}));this.tiles.length=0},updateExtent:function(e,h){this.mapExtent=this.extent=e;var p=this.xformSetting.requireProjection;
if(p){this.extent=k.project(e,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new b(this.extent.spatialReference.toJson())}else if(e.spatialReference.isWebMercator()||4326===e.spatialReference.wkid){var v=4326===e.spatialReference.wkid?180:this.halfWorldWidth,t=e.xmin;if(t<-v||t>v){for(var q=e.xmax,w=2*v;t<-v;)t+=w,q+=w;for(;t>v;)t-=w,q-=w;this.mapExtent=this.extent=e=new d(t,e.ymin,q,e.ymax,e.spatialReference)}}this.updateResolution(h,
e);v=this.extent;t=this.tileInfo;q=t.cols;w=t.rows;h=this.resolution;var u=v;p=p?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(u=this._getIntersect(v,p));var y=Math.floor((u.xmin-t.origin.x)/h.x/q)-this.prefetchBufferSize,x=Math.floor((u.xmax-t.origin.x)/h.x/q)+this.prefetchBufferSize,z=null,B=this.getWrapTimes(e),E=this.fullBoundary&&this.fullBoundary.colRange;B&&this.halfWorldWidth&&(x===y&&(z=y),x+=B*E);if(e=this.halfWorldWidth&&this.tiles.length&&(B!==this.wrapTimes||
z!==this._circlularColId))this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1;this.wrapTimes=B;this._circlularColId=z;var F=Math.floor((t.origin.y-u.ymax)/h.y/w)-this.prefetchBufferSize;z=Math.floor((t.origin.y-u.ymin)/h.y/w)+this.prefetchBufferSize;this.tileBoundary={rowStart:F,rowEnd:z,colStart:y,colEnd:x};var A,C;((u=(z-F+1)*(x-y+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<B||e)&&this.resetTiles();if(!(u||2<B)){u=this.tiles;e=!1;
for(A=u.length-1;0<=A;A--){var G=u[A].row;var H=u[A].wrapCol;if(G<F||G>z||H<y||H>x)u[A].fetch&&!u[A].fetch.isCanceled()&&u[A].fetch.cancel(),u[A].update&&!u[A].update.isCanceled()&&u[A].update.cancel(),u.splice(A,1),e=!0}for(A=F;A<=z;A++)for(C=y;C<=x;C++){F=new d(t.origin.x+h.x*q*C,t.origin.y-h.y*w*(A+1),t.origin.x+h.x*q*(C+1),t.origin.y-h.y*w*A,v.spatialReference);var N=B&&E?0<=C?C%E:E- -C%E:C;G=f(u,function(M){return M.row===A&&M.col===N&&M.wrapCol===C});H=p.xmax>=F.xmax?q:Math.round((p.xmax-F.xmin)/
h.x);-1===G&&(u.push({row:A,col:N,wrapCol:C,cellsizeX:h.x,cellsizeY:h.y,width:q,height:w,actualWidth:H,extent:F,normalizedExtent:this._wrapExtent(F,N),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),e=!0)}e&&this._sortTiles();h=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=h;this.count=u.length;h=Math.min.apply(null,u.map(function(M){return M.extent.xmin}));
t=Math.max.apply(null,u.map(function(M){return M.extent.xmax}));q=Math.min.apply(null,u.map(function(M){return M.extent.ymin}));w=Math.max.apply(null,u.map(function(M){return M.extent.ymax}));h=this.fullExtent=new d(h,q,t,w,v.spatialReference);if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(e&&(this._tilesChanged=!0),this.xformSetting.offset=[(v.xmin-h.xmin)/(h.xmax-h.xmin),-(h.ymin-v.ymin)/(h.ymax-h.ymin)],this.xformSetting.scale=
[(v.xmax-v.xmin)/(h.xmax-h.xmin),(v.ymax-v.ymin)/(h.ymax-h.ymin)])}},fetchTiles:function(e){(this._tilesChanged||e)&&this._fetchTiles(e)},_fetchTiles:function(e){this._fetchCounter=0;var h=this.extent;this.fetchAllCompleted=e?new r:null;(this._tilesChanged||e&&this.layer._hasTilingEffects)&&this.tiles.forEach(g.hitch(this,function(v){v.updateCompleted=!1}));var p={};!this.layer.roaming&&this.layer._hasTilingEffects&&e?(this.identifiers.forEach(function(v,t){p[v]={extent:this.extent,pixelBlock:new c({width:this.layer._map.width,
height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:p,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(v,t){p[v]={extent:this.fullExtent,pixelBlock:new c({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:p,isEmpty:!0});this.tiles.forEach(g.hitch(this,function(v){if(v.fetch)v.update||(v.update=this.updateTile(v));
else{if(this._isTileOutSide(v,h)){v.updateCompleted=!0;return}this._requestTile(v)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(v):v.src&&e&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&(this._fillPixelData(v),this.layer._hasTilingEffects&&(v.updateCompleted=!0),v.processedPixelBlock=null,v.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;e&&this._updateFetchStatus()},updateTile:function(e,h){var p=new r;if(!e.src&&!e.fetch)return p.resolve(e),
p.promise;n(e.src||e._fetched||e.fetch,g.hitch(this,function(){var v=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),t=this.layer._drawTile,q=this._validateRawPixelBlocks(e);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(t=t&&(this._progressiveGlobal||h));if((h||!h&&q)&&(v||t||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return p.cancel(),
p.promise;this._processTile(e,h).then(g.hitch(this,function(w){p.isCanceled()||this._renderTile(w,h).then(g.hitch(this,function(u){this.hasNewData=!1;p.isCanceled()||p.resolve(u)}))}))}else h||q||(e.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?p.resolve(this.originalPixelData):p.resolve()}));return p.promise},setLayer:function(e){this.layer=e},fillupTiles:function(){this.tiles.forEach(g.hitch(this,function(e){e.update&&e.updateCompleted&&!e.filled&&(e.updateCompleted=!1,this._fillPixelData(e),
e.updateCompleted=!0)}))},_validateRawPixelBlocks:function(e){return e&&e.src&&!this.identifiers.some(function(h){return!(e.src[h].pixelBlock&&0!==e.src[h].pixelBlock.validPixelCount&&e.src[h].pixelBlock.pixels&&0<e.src[h].pixelBlock.pixels.length)})},_wrapExtent:function(e,h){if(e){if(this.tileInfo.applyGCS360Transform){var p=this.normalizeCoordinate(e.xmin,180);0>p&&(p+=360);return new d({xmin:p,ymin:e.ymin,xmax:e.xmax-e.xmin+p,ymax:e.ymax,spatialReference:e.spatialReference})}if(this.halfWorldWidth){p=
null!=h?new d({xmin:this.tileInfo.origin.x+this.tileInfo.cols*h*this.resolution.x,ymin:e.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(h+1)*this.resolution.x,ymax:e.ymax,spatialReference:e.spatialReference}):new d({xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax,spatialReference:e.spatialReference});h=this.normalizeCoordinate(p.xmin,this.halfWorldWidth);var v=h-p.xmin;.01<Math.abs(v)&&(p.xmin=h,p.xmax+=v)}return p||e}},_getIntersect:function(e,h){return new d(Math.max(e.xmin,h.xmin),Math.max(e.ymin,
h.ymin),Math.min(e.xmax,h.xmax),Math.min(e.ymax,h.ymax),e.spatialReference)},_isTileOutSide:function(e,h){var p=!1;if(e.virtual){var v=e.normalizedExtent;if(h=h||(this.xformSetting.requireProjection?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){e=v.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;p=v.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var t=v.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;v=v.ymax+this.prefetchBufferSize*
this.tileInfo.rows*this.resolution.y;p=t<=h.xmin||e>=h.xmax||v<=h.ymin||p>=h.ymax}else p=!1}else p=0>e.level||e.row<this.fullBoundary.rowStart||e.row>this.fullBoundary.rowEnd||e.col<this.fullBoundary.colStart||e.col>this.fullBoundary.colEnd;return p},_resolutionEqual:function(e,h){return e===h||e&&h&&Math.abs(e-h)<Math.abs(h/1E4)?!0:!1},_requestTile:function(e){var h=this.identifiers,p;if(this._isTileOutSide(e)){var v=new r;e.updateCompleted=!0;v.resolve(null);v=v.promise}else v=this.layer.raster.rasterFunction?
new m(this.layer.raster.getMemberRasters().map(function(t){return t.read(e)})):new m([this.layer.raster.read(e)]);e.fetch=v;this._fetchCounter++;n(e.src||e._fetched||v,g.hitch(this,function(t){if(p=t&&t.some(function(w){return w[0]})){var q={};t.forEach(function(w,u){q[h[u]]=w[0]&&w[1]?{extent:w[1].extent,pixelBlock:w[1].pixelBlock,width:w[1].width,height:w[1].height}:null});e.src=q}else e.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);e._fetched=!0;this._updateFetchStatus()}),
g.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);e._fetched=!0;this._updateFetchStatus()}));e.update=this.updateTile(e)},_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(e){return!e._fetched})&&(this.tiles.forEach(g.hitch(this,function(e){this._fillPixelData(e)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(e,h){if(e&&!e.updateCompleted)if(Math.abs(e.cellsizeX-
this.resolution.x)>e.cellsizeX/10)e.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(e))e.updateCompleted=!0;else{var p=e.extent;if(this.layer.roaming||this.layer.useWebGL&&!this.layer._hasTilingEffects){var v=this.fullExtent;var t=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var q=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);h?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:t,
height:q,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(g.hitch(this,function(u){this.originalPixelData.src[u].pixelBlock.width=t;this.originalPixelData.src[u].pixelBlock.height=q}))}else v=this.extent,t=this.layer._map.width,q=this.layer._map.height,h?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:t,height:q,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(g.hitch(this,function(u){this.originalPixelData.src[u].pixelBlock.width=
t;this.originalPixelData.src[u].pixelBlock.height=q}));if(v.xmax<=p.xmin||v.xmin>=p.xmax||v.ymax<=p.ymin||v.ymin>=p.ymax)return null;var w=this.originalPixelData.isEmpty=!1;this.identifiers.forEach(g.hitch(this,function(u){e.src&&(this._fillPixelBlock(e.src[u],this.originalPixelData.src[u],{extent:v,width:t,height:q,normalizedExtent:e.normalizedExtent},!1),w=!0)}));e.filled=w;this.hasNewData=!0}},_fillPixelBlock:function(e,h,p,v){var t=e.extent,q=p.extent;v=p.width;var w=p.height;if(e.pixelBlock&&
e.pixelBlock.pixels&&e.pixelBlock.pixels[0]){var u=(t.xmax-t.xmin)/e.width,y=Math.max(t.xmin,q.xmin),x=Math.min(t.ymax,q.ymax),z=Math.round((y-t.xmin)/u),B=e.width-Math.round(Math.abs(t.xmax-Math.min(t.xmax,q.xmax))/u),E=Math.round(Math.abs(t.ymax-x)/u),F=e.height-Math.round((Math.max(t.ymin,q.ymin)-t.ymin)/u),A=this.halfWorldWidth;y=Math.round((y-q.xmin)/u);p=p.normalizedExtent;if(!(this.wrapTimes&&A&&t.xmin<-A)){if(this.wrapTimes&&A){if(this.tileInfo.applyGCS360Transform)360<t.xmin&&(y-=this.fullBoundary.paddingLeft);
else if(t.xmin>A){y-=this.fullBoundary.paddingLeft;var C=this.normalizeCoordinate(t.xmin,A);var G=this.normalizeCoordinate(t.xmax,A)}else C=t.xmin,G=t.xmax;this.tileInfo.applyGCS360Transform?p&&360>p.xmin&&360<p.xmax&&(B-=this.fullBoundary.paddingRight):p&&p.xmin<A&&p.xmax>A?B-=this.fullBoundary.paddingRight:C<A&&G>A&&(B-=this.fullBoundary.paddingRight)}C=Math.round(Math.abs(q.ymax-x)/u);G=e.pixelBlock.pixels.length;h=h.pixelBlock;p=e.width;t=h.mask||new Uint8Array(v*w);var H=e.pixelBlock,N=H.mask,
M=0;for(u=0;u<G;u++){x=H.pixels[u];A=h.pixels[u]||new x.constructor(v*w);for(e=E;e<F;e++)for(M=(C+e-E)*v+y,q=z;q<B;q++)A[M+q-z]=x[e*p+q];h.pixels[u]=A}if(N)for(e=E;e<F;e++)for(M=(C+e-E)*v+y,q=z;q<B;q++)t[M+q-z]=N[e*p+q];else for(e=E;e<F;e++)for(M=(C+e-E)*v+y,q=z;q<B;q++)t[M+q-z]=1;h.pixelType=h.pixelType||H.pixelType;h.mask=t;if(!(h.statistics&&0<h.statistics.length))for(h.statistics=[],e=0;e<H.statistics.length;e++)h.statistics[e]={minValue:H.statistics[e].minValue,maxValue:H.statistics[e].maxValue};
else if(H.statistics&&h.statistics)for(e=0;e<h.statistics.length;e++)h.statistics[e].minValue=Math.min(H.statistics[e].minValue,h.statistics[e].minValue),h.statistics[e].maxValue=Math.max(H.statistics[e].maxValue,h.statistics[e].maxValue)}}},_processTile:function(e,h){var p=new r,v=this.layer._hasTilingEffects,t=this.layer.useWebGL,q=v||t,w=this.layer.raster.rasterFunction&&e&&(v||t||!e.processedPixelBlock);if(h)var u=e;else this._fillPixelData(e),u=q?this.originalPixelData:e;this.xformSetting.hasNewTexture=
this.hasNewData;var y;w?(this.identifiers.forEach(function(x){if(0===u.src[x].pixelBlock.pixels.length||0===u.src[x].pixelBlock.pixels[0].length)y=!0}),y?p.resolve({extent:u.extent,processedPixelBlock:u.src[this.identifiers[0]],pixelBlock:u.src[this.identifiers[0]]}):t?(this.processedPixelData=this.layer.raster.rasterFunction.read(u),p.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:u.extent,src:u.src}).then(function(x){v?(this.processedPixelData=
x,p.resolve(this.processedPixelData)):(e.processedPixelBlock=x.pixelBlock,p.resolve(e))}):(h=this.layer.raster.rasterFunction.read(e),e.processedPixelBlock=h.pixelBlock,p.resolve(e))):q?p.resolve(u.src[this.identifiers[0]]):(e.pixelBlock=u.src[this.identifiers[0]]&&u.src[this.identifiers[0]].pixelBlock,p.resolve(e));return p.promise},_renderTile:function(e){var h=new r,p=this.layer._hasTilingEffects,v=this.layer.useWebGL,t=Math.abs((e.extent.xmax-e.extent.xmin)/e.width-this.layer.getCurrentResolution().x)>
this.resolution.x/10;t=this.layer.useWebGL&&(t||this._isTileOutSide(e,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&e&&(e.texture||e.src||e.pixelBlock||e.processedPixelBlock)?(this.layer._rasterRenderer.interpolation=this.layer.interpolation,v&&!t?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(e),h.resolve(e)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:e.extent,
pixelBlock:e.processedPixelBlock||e.pixelBlock}).then(function(q){p?(q.renderedPixelBlock=q.pixelBlock,h.resolve(q)):(e.renderedPixelBlock=q.pixelBlock,h.resolve(e))}.bind(this)):(e.renderedPixelBlock=this.layer._rasterRenderer.draw(e).pixelBlock,h.resolve(e))):(e.renderedPixelBlock=e.processedPixelBlock||e.pixelBlock,h.resolve(e));return h.promise},_sortTiles:function(){this.tiles.sort(function(e,h){return e.row<h.row||e.row==h.row&&e.col<h.col?-1:1})}})})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),
function(I,g,r,n,m,d,b){I=I(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,c){a=a||{};a.layers||a.itemId||console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=c},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=
d({url:(a||m.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:r.hitch(this,function(c,l){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),a.addCallback(r.hitch(this,function(c,l){if(c.baseMap)return this.layers=[],g.forEach(c.baseMap.baseMapLayers,function(k){this.layers.push(new b(k))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");
else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});n("extend-esri")&&r.setObject("dijit.Basemap",I,m);return I})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(I,g,r,n){I=I(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(m){m=m||{};m.url||m.type||console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=m.url;this.type=
m.type;this.isReference=!0===m.isReference?!0:!1;this.opacity=m.opacity;this.visibleLayers=m.visibleLayers;this.displayLevels=m.displayLevels;this.exclusionAreas=m.exclusionAreas;this.bandIds=m.bandIds;this.renderingRule=m.renderingRule;this.templateUrl=m.templateUrl;this.copyright=m.copyright;this.subDomains=m.subDomains;this.fullExtent=m.fullExtent;this.initialExtent=m.initialExtent;this.tileInfo=m.tileInfo;this.tileServers=m.tileServers;this.wmtsInfo=m.wmtsInfo;this.styleUrl=m.styleUrl}});r("extend-esri")&&
g.setObject("dijit.BasemapLayer",I,n);return I})},"widgets/GridOverlay/setting/utils":function(){define("dojo/_base/lang dojo/Deferred dojo/json dojo/_base/array dojo/promise/all esri/SpatialReference jimu/portalUtils jimu/shared/basePortalUrlUtils esri/request dojo/text!./esri_tileinfo.json".split(" "),function(I,g,r,n,m,d,b,a,c,l){function k(t){if(!t)return null;var q=t.indexOf("?");return 0===t.search(/http|\/\//)&&-1!==q?t.slice(0,q).replace(/\/*$/g,""):t}function f(t){return t?a.removeProtocol(k(t)):
""}function e(t){var q=new g;b.getPortalSelfInfo(t).then(I.hitch(this,function(w){var u=w.basemapGalleryGroupQuery;!0===w.useVectorBasemaps&&w.vectorBasemapGalleryGroupQuery&&(u=w.vectorBasemapGalleryGroupQuery);p.getBasemapGalleryGroup(t,u).then(I.hitch(this,function(y){y.queryItems({start:1,num:100,f:"json",q:b.webMapQueryStr}).then(I.hitch(this,function(x){q.resolve(x)}),I.hitch(this,function(){q.reject()}))}),I.hitch(this,function(){q.reject()}))}));return q}function h(t){return c({url:t,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(function(q){return q},function(){return null})}var p={},v=r.parse(l);p._loadPortalBaseMaps=function(t,q){var w=new g,u=[];e(t).then(function(y){n.forEach(y.results,function(x){var z=new g,B=f(x.thumbnailUrl);u.push(z);x.getItemData().then(function(E){p._getBasemapSpatialReference(x,E).then(I.hitch(this,function(F){var A=E.baseMap.baseMapLayers;p.isBasemapCompatibleWithMap(F,A,q).then(I.hitch(this,function(C){C?z.resolve({layers:A,title:x.title||
E.baseMap.title,thumbnailUrl:B,spatialReference:F}):z.resolve({})}))}))})});m(u).then(function(x){x=n.filter(x,function(z){return z&&z.title?!0:!1},this);w.resolve(x)})},function(y){w.reject(y)});return w};p.isBasemapCompatibleWithMap=function(t,q,w){var u=new g,y=w.spatialReference,x=w.width>w.height?w.width:w.height;if(!y||!q||0>=q.length||!t||!y.equals(new d(+t.wkid)))return u.resolve(!1),u;0===w.getNumLevels()?"OpenStreetMap"===q[0].layerType||q[0].layerType&&-1<q[0].layerType.indexOf("BingMaps")||
"WebTiledLayer"===q[0].layerType||"VectorTileLayer"===q[0].layerType||"ArcGISImageServiceVectorLayer"===q[0].layerType||"ArcGISTiledImageServiceLayer"===q[0].layerType?u.resolve(!1):u.resolve(!0):q[0].layerType&&0===q[0].layerType.indexOf("ArcGIS")&&q[0].url?h(q[0].url).then(function(z){(q[0].serviceInfoResponse=z)&&z.tileInfo?u.resolve(p.tilingSchemeCompatible(w.__tileInfo,z.tileInfo,x)):z&&z.capabilities&&(0<=z.capabilities.indexOf("Map")||z.capabilities.indexOf("Image"))?u.resolve(!0):u.resolve(!1)}):
"WMS"===q[0].layerType?u.resolve(!0):p.isNoUrlLayerMap(q)||"VectorTileLayer"===q[0].layerType?u.resolve(p.tilingSchemeCompatible(w.__tileInfo,v,x)):u.resolve(p.tilingSchemeCompatible(w.__tileInfo,q[0].tileInfo,x));return u};p.tilingSchemeCompatible=function(t,q,w){if(t&&q){var u=!1,y=!1,x,z;for(x=0;x<t.lods.length;x++){var B=t.lods[x].scale;t.dpi!==q.dpi&&(B=t.lods[x].scale/t.dpi);for(z=0;z<q.lods.length;z++){var E=q.lods[z].scale;t.dpi!==q.dpi&&(E=q.lods[z].scale/q.dpi);if(Math.abs(E-B)/E<1/w)if(u){y=
!0;break}else u=!0;if(E<B)break}if(y)break}t=y?!0:!u||1!==t.lods.length&&1!==q.lods.length?!1:!0;return t}return!0};p.isSameBasemapLayer=function(t,q){if(t.layerType&&q.layerType){if(t.layerType!==q.layerType)return!1;if("ArcGISImageServiceVectorLayer"===t.layerType||"ArcGISTiledImageServiceLayer"===t.layerType||"ArcGISTiledMapServiceLayer"===t.layerType||"ArcGISMapServiceLayer"===t.layerType||"ArcGISImageServiceLayer"===t.layerType)return t=f(t.url||""),q=f(q.url||""),t.toLowerCase()===q.toLowerCase();
if("BingMapsAerial"===t.layerType||"BingMapsRoad"===t.layerType||"BingMapsHybrid"===t.layerType||"OpenStreetMap"===t.layerType)return!0;if("VectorTileLayer"===t.layerType)return t=f(t.styleUrl||""),q=f(q.styleUrl||""),t.toLowerCase()===q.toLowerCase();if("WMS"===t.layerType)return t=f(t.mapUrl||""),q=f(q.mapUrl||""),t.toLowerCase()===q.toLowerCase();if("WebTiledLayer"===t.layerType){if(t.templateUrl&&q.templateUrl)return t=f(t.templateUrl||""),q=f(q.templateUrl||""),t.toLowerCase()===q.toLowerCase();
if(t.wmtsInfo&&q.wmtsInfo)return t=f(t.wmtsInfo.url||""),q=f(q.wmtsInfo.url||""),t.toLowerCase()===q.toLowerCase()}}else return t=f(t.url||""),q=f(q.url||""),t.toLowerCase()===q.toLowerCase();return!1};p.compareSameBasemapByOrder=function(t,q){t=t.layers;q=q.layers;if(t.length!==q.length)return!1;for(var w=0;w<t.length;w++)if(!p.isSameBasemapLayer(t[w],q[w]))return!1;return!0};p.isBingMap=function(t){if(!t||!t.layers)return!1;for(var q=0;q<t.layers.length;q++)if("BingMapsAerial"===t.layers[q].type||
"BingMapsRoad"===t.layers[q].type||"BingMapsHybrid"===t.layers[q].type)return!0;return!1};p.isNoUrlLayerMap=function(t){for(var q=0;q<t.length;q++)if("BingMapsAerial"===t[q].type||"BingMapsRoad"===t[q].type||"BingMapsHybrid"===t[q].type||"OpenStreetMap"===t[q].type)return!0;return!1};p.getToken=function(t){t=b.getPortal(t);t.updateCredential();return t.credential?"?token\x3d"+t.credential.token:""};p.removeUrlQuery=function(t){return k(t)};p.getStanderdUrl=function(t){return f(t)};p.getUniqueTitle=
function(t,q){if(!q||0===q.length)return t;q=n.filter(q,function(w){return w===t?!0:0===w.indexOf(t)?(w=w.substr(t.length+1),!isNaN(+w)):!1});if(0===q.length)return t;q=n.map(q,function(w){return w===t?0:+w.substr(t.length+1)});q=q.sort();return t+" "+(q[q.length-1]+1)};p.getBasemapInfo=function(t,q){var w,u;return b.getPortal(t).getItemById(q).then(function(y){w=y;return y.getItemData()}).then(function(y){u=y;return p._getBasemapSpatialReference(w,y)}).then(function(y){return{thumbnailUrl:w.thumbnailUrl,
title:w.title||u.baseMap.title,layers:u.baseMap.baseMapLayers,spatialReference:new d(y)}})};p.getBasemapGalleryGroup=function(t,q){var w=new g;t=b.getPortal(t);var u=q.indexOf("esri_");if(0<=u){u=q.slice(u,u+7);var y="esri_"+dojoConfig.locale.slice(0,2);q=q.replace(u,y)}t.queryGroups({f:"json",q:q}).then(I.hitch(this,function(x){0<x.results.length?w.resolve(x.results[0]):w.reject()}),I.hitch(this,function(){w.reject()}));return w};p._getBasemapSpatialReference=function(t,q){var w=null,u=!1,y=new g;
if(t.owner&&0===t.owner.indexOf("esri_")||p.isNoUrlLayerMap(q.baseMap.baseMapLayers))w={wkid:"102100"};else if(q.spatialReference||t.spatialReference)w=q.spatialReference||t.spatialReference;else if(q.baseMap.baseMapLayers&&q.baseMap.baseMapLayers[0])if(t=q.baseMap.baseMapLayers[0],t.url&&0<t.url.indexOf("rest/services"))u=!0,h(q.baseMap.baseMapLayers[0].url).then(I.hitch(this,function(x){x&&x.spatialReference&&(w=x.spatialReference);y.resolve(w)}),function(x){console.error(x);y.resolve(null)});else if("VectorTileLayer"===
t.layerType)w={wkid:"102100"};else if(q=t.fullExtent||t.initialExtent)w=q.spatialReference;u||y.resolve(w);return y};return p})},"dijit/TitlePane":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/fx dojo/has dojo/_base/kernel dojo/keys ./_CssStateMixin ./_TemplatedMixin ./layout/ContentPane dojo/text!./templates/TitlePane.html ./_base/manager ./a11yclick".split(" "),function(I,g,r,n,m,d,b,a,c,l,k,f,e,h,p){g=g("dijit.TitlePane",[e,
f,k],{title:"",_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!0,toggleable:!0,tabIndex:"0",duration:p.defaultDuration,baseClass:"dijitTitlePane",templateString:h,doLayout:!1,_setTooltipAttr:{node:"focusNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);r.setSelectable(this.titleNode,!1)},postCreate:function(){this.inherited(arguments);this.toggleable&&this._trackMouseState(this.titleBarNode,this.baseClass+"Title");var v=this.hideNode,t=this.wipeNode;
this._wipeIn=b.wipeIn({node:t,duration:this.duration,beforeBegin:function(){v.style.display=""}});this._wipeOut=b.wipeOut({node:t,duration:this.duration,onEnd:function(){v.style.display="none"}})},_setOpenAttr:function(v,t){I.forEach([this._wipeIn,this._wipeOut],function(q){q&&"playing"==q.status()&&q.stop()});t?this[v?"_wipeIn":"_wipeOut"].play():this.hideNode.style.display=this.wipeNode.style.display=v?"":"none";if(this._started)if(v)this._onShow();else this.onHide();this.containerNode.setAttribute("aria-hidden",
v?"false":"true");this.focusNode.setAttribute("aria-pressed",v?"true":"false");this._set("open",v);this._setCss()},_setToggleableAttr:function(v){this.focusNode.setAttribute("role",v?"button":"heading");v?(this.focusNode.setAttribute("aria-controls",this.id+"_pane"),this.focusNode.setAttribute("tabIndex",this.tabIndex),this.focusNode.setAttribute("aria-pressed",this.open)):(n.remove(this.focusNode,"aria-controls"),n.remove(this.focusNode,"tabIndex"),n.remove(this.focusNode,"aria-pressed"));this._set("toggleable",
v);this._setCss()},_setContentAttr:function(v){this.open&&this._wipeOut&&"playing"!=this._wipeOut.status()?(this._wipeIn&&"playing"==this._wipeIn.status()&&this._wipeIn.stop(),d.setMarginBox(this.wipeNode,{h:d.getMarginBox(this.wipeNode).h}),this.inherited(arguments),this._wipeIn?this._wipeIn.play():this.hideNode.style.display=""):this.inherited(arguments)},toggle:function(){this._setOpenAttr(!this.open,!0)},_setCss:function(){var v=this.titleBarNode||this.focusNode,t=this._titleBarClass;this._titleBarClass=
this.baseClass+"Title"+(this.toggleable?"":"Fixed")+(this.open?"Open":"Closed");m.replace(v,this._titleBarClass,t||"");m.replace(v,this._titleBarClass.replace("TitlePaneTitle",""),(t||"").replace("TitlePaneTitle",""));this.arrowNodeInner.innerHTML=this.open?"-":"+"},_onTitleKey:function(v){v.keyCode==l.DOWN_ARROW&&this.open&&(this.containerNode.focus(),v.preventDefault())},_onTitleClick:function(){this.toggleable&&this.toggle()},setTitle:function(v){c.deprecated("dijit.TitlePane.setTitle() is deprecated.  Use set('title', ...) instead.",
"","2.0");this.set("title",v)}});a("dojo-bidi")&&g.extend({_setTitleAttr:function(v){this._set("title",v);this.titleNode.innerHTML=v;this.applyTextDir(this.titleNode)},_setTooltipAttr:function(v){this._set("tooltip",v);this.textDir&&(v=this.enforceTextDirWithUcc(null,v));n.set(this.focusNode,"title",v)},_setTextDirAttr:function(v){this._created&&this.textDir!=v&&(this._set("textDir",v),this.set("title",this.title),this.set("tooltip",this.tooltip))}});return g})},"widgets/GridOverlay/setting/_build-generate_module":function(){define(["dojo/text!./Setting.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/GridOverlay/setting/esri_tileinfo.json":'{\r\n  "rows": 256,\r\n  "cols": 256,\r\n  "dpi": 96,\r\n  "compressionQuality": 75,\r\n  "origin": {\r\n   "x": -2.0037508342787E7,\r\n   "y": 2.0037508342787E7\r\n  },\r\n  "spatialReference": {\r\n   "wkid": 102100,\r\n   "latestWkid": 3857\r\n  },\r\n  "lods": [\r\n   {\r\n    "level": 0,\r\n    "resolution": 156543.03392800014,\r\n    "scale": 5.91657527591555E8\r\n   },\r\n   {\r\n    "level": 1,\r\n    "resolution": 78271.51696399994,\r\n    "scale": 2.95828763795777E8\r\n   },\r\n   {\r\n    "level": 2,\r\n    "resolution": 39135.75848200009,\r\n    "scale": 1.47914381897889E8\r\n   },\r\n   {\r\n    "level": 3,\r\n    "resolution": 19567.87924099992,\r\n    "scale": 7.3957190948944E7\r\n   },\r\n   {\r\n    "level": 4,\r\n    "resolution": 9783.93962049996,\r\n    "scale": 3.6978595474472E7\r\n   },\r\n   {\r\n    "level": 5,\r\n    "resolution": 4891.96981024998,\r\n    "scale": 1.8489297737236E7\r\n   },\r\n   {\r\n    "level": 6,\r\n    "resolution": 2445.98490512499,\r\n    "scale": 9244648.868618\r\n   },\r\n   {\r\n    "level": 7,\r\n    "resolution": 1222.992452562495,\r\n    "scale": 4622324.434309\r\n   },\r\n   {\r\n    "level": 8,\r\n    "resolution": 611.4962262813797,\r\n    "scale": 2311162.217155\r\n   },\r\n   {\r\n    "level": 9,\r\n    "resolution": 305.74811314055756,\r\n    "scale": 1155581.108577\r\n   },\r\n   {\r\n    "level": 10,\r\n    "resolution": 152.87405657041106,\r\n    "scale": 577790.554289\r\n   },\r\n   {\r\n    "level": 11,\r\n    "resolution": 76.43702828507324,\r\n    "scale": 288895.277144\r\n   },\r\n   {\r\n    "level": 12,\r\n    "resolution": 38.21851414253662,\r\n    "scale": 144447.638572\r\n   },\r\n   {\r\n    "level": 13,\r\n    "resolution": 19.10925707126831,\r\n    "scale": 72223.819286\r\n   },\r\n   {\r\n    "level": 14,\r\n    "resolution": 9.554628535634155,\r\n    "scale": 36111.909643\r\n   },\r\n   {\r\n    "level": 15,\r\n    "resolution": 4.77731426794937,\r\n    "scale": 18055.954822\r\n   },\r\n   {\r\n    "level": 16,\r\n    "resolution": 2.388657133974685,\r\n    "scale": 9027.977411\r\n   },\r\n   {\r\n    "level": 17,\r\n    "resolution": 1.1943285668550503,\r\n    "scale": 4513.988705\r\n   },\r\n   {\r\n    "level": 18,\r\n    "resolution": 0.5971642835598172,\r\n    "scale": 2256.994353\r\n   },\r\n   {\r\n    "level": 19,\r\n    "resolution": 0.29858214164761665,\r\n    "scale": 1128.497176\r\n   },\r\n   {\r\n    "level": 20,\r\n    "resolution": 0.14929107082380833,\r\n    "scale": 564.248588\r\n   },\r\n   {\r\n    "level": 21,\r\n    "resolution": 0.07464553541190416,\r\n    "scale": 282.124294\r\n   },\r\n   {\r\n    "level": 22,\r\n    "resolution": 0.03732276770595208,\r\n    "scale": 141.062147\r\n   },\r\n   {\r\n    "level": 23,\r\n    "resolution": 0.01866138385297604,\r\n    "scale": 70.5310735\r\n   }\r\n  ]\r\n }',
"url:dijit/templates/TitlePane.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onTitleClick, onkeydown:_onTitleKey"\r\n\t\t\tclass\x3d"dijitTitlePaneTitle" data-dojo-attach-point\x3d"titleBarNode" id\x3d"${id}_titleBarNode"\x3e\r\n\t\t\x3cdiv class\x3d"dijitTitlePaneTitleFocus" data-dojo-attach-point\x3d"focusNode"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"arrowNode" class\x3d"dijitInline dijitArrowNode" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"arrowNodeInner" class\x3d"dijitArrowNodeInner"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitTitlePaneTextNode"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTitlePaneContentOuter" data-dojo-attach-point\x3d"hideNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitReset" data-dojo-attach-point\x3d"wipeNode" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv class\x3d"dijitTitlePaneContentInner" data-dojo-attach-point\x3d"containerNode" role\x3d"region" id\x3d"${id}_pane" aria-labelledby\x3d"${id}_titleBarNode"\x3e\r\n\t\t\t\t\x3c!-- nested divs because wipeIn()/wipeOut() doesn\'t work right on node w/padding etc.  Put padding on inner div. --\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/GridOverlay/setting/Setting.html":'\x3cdiv style\x3d"width:100%;height:100%;overflow:hidden;" class\x3d"nihilo"\x3e\r\n  \x3cdiv class\x3d\'neo\'\x3e\r\n    \x3ctable class\x3d"settings-section"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d\'sectionTitle\' colspan\x3d"2"\x3e${nls.minIntSpacingLabel}\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv class\x3d\'grid-overlay-setting-slider\' data-dojo-attach-point\x3d"minIntervalSpacing"\r\n              data-dojo-type\x3d"dijit/form/HorizontalSlider"\r\n              data-dojo-props\x3d"value:100, minimum: 50, maximum:250, discreteValues:41, intermediateChanges:true, showButtons:false"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv class\x3d"grid-overlay-setting-slider-value"\x3e\x3cspan class\x3d\'sliderValue\'\r\n                data-dojo-attach-point\x3d"minIntervalSpacingVal"\x3epx\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d\'sectionTitle\' colspan\x3d"2"\x3e${nls.lineOpacityLabel}\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv class\x3d\'grid-overlay-setting-slider\' data-dojo-attach-point\x3d"lineOpacity"\r\n              data-dojo-type\x3d"dijit/form/HorizontalSlider"\r\n              data-dojo-props\x3d"value:100, minimum: 0.05, maximum:1, discreteValues:20, intermediateChanges:true, showButtons:false"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv class\x3d"grid-overlay-setting-slider-value"\x3e\x3cspan class\x3d\'sliderValue\'\r\n                data-dojo-attach-point\x3d"lineOpacityVal"\x3e%\x3c/span\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d\'sectionTitle\'\x3e${nls.labelOpacityLabel}\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv class\x3d\'grid-overlay-setting-slider\' data-dojo-attach-point\x3d"labelOpacity"\r\n              data-dojo-type\x3d"dijit/form/HorizontalSlider"\r\n              data-dojo-props\x3d"value:100, minimum: 0.05, maximum:1, discreteValues:20, intermediateChanges:true, showButtons:false"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3cdiv class\x3d"grid-overlay-setting-slider-value"\x3e\x3cspan class\x3d\'sliderValue\'\r\n                data-dojo-attach-point\x3d"labelOpacityVal"\x3e%\x3c/span\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d\'sectionTitle\'\x3e${nls.verticalLineLabels}\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d\'verticalLineSection\'\x3e\r\n            \x3cdiv class\x3d\'image-labels horizontalLabel\' title\x3d\'${nls.horizontalLabel}\'\r\n              data-dojo-attach-point\x3d"horizontalLabels"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d\'image-labels verticalLabel\' title\x3d\'${nls.verticalLabel}\'\r\n              data-dojo-attach-point\x3d"verticalLabels"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n    \x3cdiv class\x3d"grid-overlay-setting-style"\x3e\r\n      \x3cdiv class\x3d\'sectionTitle\'\x3e${nls.styleHeaderLabel}\x3c/div\x3e\r\n      \x3cdiv style\x3d"clear: both;" class\x3d"esriCTFullWidth esriCTPaddingRight"\x3e\r\n        \x3c!-- 1. --\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth esriCTBorder"\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTTitle"\x3e${nls.gzd}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.colorHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.fontSizeHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.lineWidthHeaderLabel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"colorPicker0" class\x3d"grid-overlay-setting-color-picker"\r\n                  data-dojo-type\x3d"jimu/dijit/ColorPicker"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"fontSize0" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:5,max:72}, value:15"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"lineSize0" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:1,max:10}, value:2"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n\r\n        \x3c!-- 2. --\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth esriCTBorder"\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTTitle" data-dojo-attach-point\x3d"gsidNode"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.colorHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.fontSizeHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.lineWidthHeaderLabel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"colorPicker1" class\x3d"grid-overlay-setting-color-picker"\r\n                  data-dojo-type\x3d"jimu/dijit/ColorPicker"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"fontSize1" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:5,max:72}, value:15"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"lineSize1" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:1,max:10}, value:2"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n\r\n        \x3c!-- 3. --\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth esriCTBorder"\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTTitle" data-dojo-attach-point\x3d"grid10kNode"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.colorHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.fontSizeHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.lineWidthHeaderLabel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"colorPicker2" class\x3d"grid-overlay-setting-color-picker"\r\n                  data-dojo-type\x3d"jimu/dijit/ColorPicker"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"fontSize2" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:5,max:72}, value:15"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"lineSize2" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:1,max:10}, value:2"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n\r\n        \x3c!-- 4. --\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth esriCTBorder"\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTTitle" data-dojo-attach-point\x3d"grid1kNode"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.colorHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.fontSizeHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.lineWidthHeaderLabel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"colorPicker3" class\x3d"grid-overlay-setting-color-picker"\r\n                  data-dojo-type\x3d"jimu/dijit/ColorPicker"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"fontSize3" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:5,max:72}, value:15"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"lineSize3" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:1,max:10}, value:2"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n\r\n        \x3c!-- 5. --\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth esriCTBorder"\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTTitle"\x3e${nls.grid100m}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.colorHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.fontSizeHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.lineWidthHeaderLabel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"colorPicker4" class\x3d"grid-overlay-setting-color-picker"\r\n                  data-dojo-type\x3d"jimu/dijit/ColorPicker"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"fontSize4" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:5,max:72}, value:15"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"lineSize4" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:1,max:10}, value:2"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n\r\n        \x3c!-- 6. --\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth esriCTBorder"\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTTitle"\x3e${nls.grid10m}\x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.colorHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.fontSizeHeaderLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width esriCTColumnTitle"\x3e${nls.lineWidthHeaderLabel}\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTFullWidth esriCTPadding"\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"colorPicker5" class\x3d"grid-overlay-setting-color-picker"\r\n                  data-dojo-type\x3d"jimu/dijit/ColorPicker"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"fontSize5" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:5,max:72}, value:15"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCT33Width"\x3e\r\n              \x3cdiv\x3e\r\n                \x3cdiv class\x3d"font-size" data-dojo-attach-point\x3d"lineSize5" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n                  data-dojo-props\x3d"intermediateChanges:true, constraints:{min:1,max:10}, value:2"\x3e\x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"sampleMap" class\x3d"grid-overlay-setting-style-map"\x3e\r\n    \x3cdiv class\x3d"basemapButton"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"switchBasemapBtn" data-dojo-type\x3d"dijit/TitlePane" data-dojo-props\x3d"open:false"\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"width:400px; height:280px; overflow:auto;"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"basemapGalleryWidget"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/GridOverlay/setting/css/style.css":'.grid-overlay-setting .grid-overlay-setting-style {padding-top: 10px;}.grid-overlay-setting .grid-overlay-setting-style table {color: #333333; width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 13px;}.grid-overlay-setting .esriCTColumnTitle {font-size: 13.5px; color: #000000; word-break: break-all; padding: 0 2px 2px 2px;}.grid-overlay-setting .grid-overlay-setting-style tr {background-color: #ffffff;}.grid-overlay-setting .grid-overlay-setting-style td {padding: 5px;}.grid-overlay-setting .settings-section {padding-bottom: 0px;}.grid-overlay-setting .label-section {padding-bottom: 0px;}.grid-overlay-setting .labelHeaderGridCompCol {width: 40%;}.grid-overlay-setting .labelHeaderColorCol {width: 20%;}.grid-overlay-setting .labelHeaderFontSizeCol {width: 20%;}.grid-overlay-setting .labelHeaderLineWidthCol {width: 20%;}.grid-overlay-setting .settings-section tr {vertical-align: middle;}.grid-overlay-setting .settings-section\x3etbody\x3etr\x3etd:first-child {width: 100%;}.grid-overlay-setting .settings-section\x3etbody\x3etr:nth-child(2n) {padding-left: 5px; font-size: 12px; letter-spacing: 0.33px;}.grid-overlay-setting .settings-section\x3etbody\x3etr:nth-child(2n+1) {width: 100px; font-size: 14px; letter-spacing: 0.39px;}.grid-overlay-setting .font-size,.line-size {width: 70%; font-style: normal;}.grid-overlay-setting .grid-overlay-setting-color-picker {width: 70%; height: 30px;}.grid-overlay-setting .grid-overlay-setting-color-picker-text {text-align: center; position: relative; top: 50%; transform: translateY(-50%); font-size: 14px;}.grid-overlay-setting .grid-overlay-setting-interval-width {border-color: #000; border-style: hidden solid solid solid; border-width: 1px; height: 10px; margin: auto;}.grid-overlay-setting .grid-overlay-setting-style-map {width: 60%; height: 100%; float: left; padding: 0 5px;}.jimu-rtl .grid-overlay-setting .grid-overlay-setting-style-map {float: right; width: 60%;}.grid-overlay-setting .grid-overlay-setting-slider {width: 100%;}.grid-overlay-setting .grid-overlay-setting-slider-value {width: 50px;}.grid-overlay-setting .neo {float: left; height: 100%; overflow: hidden;}.jimu-rtl .grid-overlay-setting .neo {float: right;}.grid-overlay-setting .sectionTitle {color: #353535; letter-spacing: 0.39px; padding-bottom: 7px; font-size: 14px;}.grid-overlay-setting .sliderValue {font-size: 13px; color: #353535; letter-spacing: 0.39px;}.grid-overlay-setting .gridPlacementSection {width: 80%; margin: auto; display: inline-flex;}.grid-overlay-setting .verticalLineSection {width: 80%; margin: auto; display: inline-flex;}.grid-overlay-setting .image-labels {background-repeat: no-repeat; background-color: transparent; width: 24px; height: 24px; margin-right: 10px; border: 1px solid #CCCCCC;}.grid-overlay-setting .horizontalLabel {background: url("../../images/Horizontal.png");}.grid-overlay-setting .horizontalLabelClicked {background: url("../../images/Horizontal_selected.png"); border: 1px solid #008B9C;}.grid-overlay-setting .horizontalLabel:hover {background: url("../../images/Horizontal_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .verticalLabel {background: url("../../images/Vertical.png");}.grid-overlay-setting .verticalLabelClicked {background: url("../../images/Vertical_selected.png"); border: 1px solid #008B9C;}.grid-overlay-setting .verticalLabel:hover {background: url("../../images/Vertical_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .upperLeftLabel {background: url("../../images/Upper_Left.png");}.grid-overlay-setting .upperLeftLabelClicked,.upperLeftLabel:hover {background: url("../../images/Upper_Left_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .upperRightLabel {background: url("../../images/Upper_Right.png");}.grid-overlay-setting .upperRightLabelClicked,.upperRightLabel:hover {background: url("../../images/Upper_Right_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .lowerLeftLabel {background: url("../../images/Lower_Left.png");}.grid-overlay-setting .lowerLeftLabelClicked,.lowerLeftLabel:hover {background: url("../../images/Lower_Left_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .lowerRightLabel {background: url("../../images/Lower_Right.png");}.grid-overlay-setting .lowerRightLabelClicked,.lowerRightLabel:hover {background: url("../../images/Lower_Right_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .centerLabel {background: url("../../images/Center.png");}.grid-overlay-setting .centerLabelClicked,.centerLabel:hover {background: url("../../images/Center_selected.png"); border: 1px solid #008B9C; cursor: pointer;}.grid-overlay-setting .table-options ul {list-style-type: none; padding: 0;}.grid-overlay-setting .jimu-checkbox {margin-right: 20px; width: 100%;}.grid-overlay-setting .switch-toggle-group {padding: 5px;}.grid-overlay-setting .switch-toggle-group .checkbox-inline {padding-left: 36px; vertical-align: top;}.grid-overlay-setting .switch-toggle-group .switch-toggle.dijitCheckBox {margin-left: -36px;}.grid-overlay-setting .switch-toggle.dijitCheckBox {height: 16px; width: 28px; border: 0 none; background: #adadad; position: relative; display: inline-block; cursor: pointer; -moz-border-radius: 10px; -webkit-border-radius: 10px; border-radius: 10px; margin-left: 2px;}.grid-overlay-setting .switch-toggle.dijitCheckBox:before {content: ""; background: #f8f8f8; position: absolute; padding: 0; height: 12px; width: 12px; left: auto; right: 14px; top: 2px; z-index: 1; -webkit-transition: right 0.3s; -moz-transition: right 0.3s; -o-transition: right 0.3s; transition: right 0.3s; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;}.grid-overlay-setting .switch-toggle.dijitCheckBox input {width: 100%; height: 100%; position: absolute; left: 0; z-index: 2;}.grid-overlay-setting .switch-toggle.dijitCheckBox.dijitCheckBoxChecked {background: #50ad4e;}.grid-overlay-setting .switch-toggle.dijitCheckBox.dijitCheckBoxChecked:before {right: 2px;}.grid-overlay-setting .basemapButton {position: absolute; right: 22px; top: 2px; z-Index: 999;}.jimu-rtl .grid-overlay-setting .basemapButton {left: 10px; right: auto;}.grid-overlay-setting .mapContentPane {width: 400px; height: 280px; overflow: auto;}.grid-overlay-setting .esriCTFullWidth {width: 100%; overflow: hidden;}.grid-overlay-setting .esriCT33Width {width: 33.33%; float: left;}.jimu-rtl .esriCT33Width {float: right;}.grid-overlay-setting .esriCTBorder {border: 1px solid black; padding: 10px; margin-bottom: 10px;}.grid-overlay-setting .esriCTTitle {margin-bottom: 10px; text-align: center;}.grid-overlay-setting .esriCTPadding {padding-left: 20px;}.jimu-rtl .grid-overlay-setting .esriCTPadding {padding-right: 20px; padding-left: 0px; padding-top: 3px;}.jimu-rtl .grid-overlay-setting .esriCTPaddingRight {padding-left: 10px;} .grid-overlay-setting .esriCTPaddingRight {padding-right: 10px;}.grid-overlay-setting .neo {width: 40%;}.grid-overlay-setting img.esriBasemapGalleryThumbnail {margin: 0px !important;}',
"*now":function(I){I(['dojo/i18n!*preload*widgets/GridOverlay/setting/nls/Setting*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/query dojo/_base/array dojo/promise/all dojo/Deferred jimu/BaseWidgetSetting dojo/_base/lang dijit/_WidgetsInTemplateMixin dijit/registry dojo/_base/Color ../lib/GridOverlay esri/map esri/dijit/BasemapGallery esri/dijit/BasemapLayer esri/dijit/Basemap jimu/dijit/Message jimu/portalUtils jimu/portalUrlUtils jimu/utils ./utils dojo/string dojo/dom-attr dijit/form/HorizontalSlider dijit/ColorPalette dijit/form/NumberSpinner jimu/dijit/ColorPicker dijit/TitlePane dijit/layout/ContentPane".split(" "),function(I,
g,r,n,m,d,b,a,c,l,k,f,e,h,p,v,t,q,w,u,y,x,z,B){var E=function(C,G){G instanceof f||(G=new f(G));var H=G.toHex();G=128<.2126*G.r+.7152*G.g+.0722*G.b?new f([0,0,0]):new f([255,255,255]);C.innerHTML=y.sanitizeHTML("\x3cdiv class\x3d'grid-overlay-setting-color-picker-text' style\x3d'color:"+(G+";'\x3e")+H+"\x3c/div\x3e")},F=function(C,G,H,N){isNaN(N)?(C.value=5,C.setDisplayedValue(5)):4<N&&73>N&&G.setFontSize(H,N)},A=function(C,G,H,N){isNaN(N)?(C.value=1,C.setDisplayedValue(1)):0<N&&11>N&&G.setLineWidth(H,
N)};return I([a,l],{baseClass:"grid-overlay-setting",verticalLabelsClicked:!1,horizontalLabelsClicked:!1,basemapDict:null,sampmap:null,postCreate:function(){this.setConfig(this.config);this.switchBasemapBtn.set("title",this.nls.switchBasemap);this.sampmap=new h(this.sampleMap,{center:this.map.extent.getCenter(),basemap:"topo",zoom:this.map.getLevel()});this._getBasemapsConfig().then(c.hitch(this,function(H){H.map=this.sampmap;H=new p(H,this.basemapGalleryWidget);H.startup();H.on("selection-change",
c.hitch(this,this._basemapGalleryOnSelectionChanged))}));var C=this,G=new e(c.mixin({map:this.sampmap,enabled:!0},this.config));this.sampleGrid=G;this.minIntervalSpacing.onChange=c.hitch(this,function(H){this.minIntervalSpacingVal.innerHTML=y.sanitizeHTML(window.isRTL?"px"+H:H+"px");G.setMinIntervalSpacing(H)});this.lineOpacity.onChange=c.hitch(this,function(H){this.lineOpacityVal.innerHTML=window.isRTL?y.sanitizeHTML("%"+Math.round(100*H)):y.sanitizeHTML(Math.round(100*H)+"%");G.setLineOpacity(H)});
this.labelOpacity.onChange=c.hitch(this,function(H){this.labelOpacityVal.innerHTML=window.isRTL?y.sanitizeHTML("%"+Math.round(100*H)):y.sanitizeHTML(Math.round(100*H)+"%");G.setLabelOpacity(H)});this.colorPicker0.onChange=function(H){E(this.domNode,H);G.setColor(0,H.toHex())};this.colorPicker1.onChange=function(H){E(this.domNode,H);G.setColor(1,H.toHex())};this.colorPicker2.onChange=function(H){E(this.domNode,H);G.setColor(2,H.toHex())};this.colorPicker3.onChange=function(H){E(this.domNode,H);G.setColor(3,
H.toHex())};this.colorPicker4.onChange=function(H){E(this.domNode,H);G.setColor(4,H.toHex())};this.colorPicker5.onChange=function(H){E(this.domNode,H);G.setColor(5,H.toHex())};this.fontSize0.onChange=function(H){F(this,G,0,H)};this.fontSize1.onChange=function(H){F(this,G,1,H)};this.fontSize2.onChange=function(H){F(this,G,2,H)};this.fontSize3.onChange=function(H){F(this,G,3,H)};this.fontSize4.onChange=function(H){F(this,G,4,H)};this.fontSize5.onChange=function(H){F(this,G,5,H)};this.lineSize0.onChange=
function(H){A(this,G,0,H)};this.lineSize1.onChange=function(H){A(this,G,1,H)};this.lineSize2.onChange=function(H){A(this,G,2,H)};this.lineSize3.onChange=function(H){A(this,G,3,H)};this.lineSize4.onChange=function(H){A(this,G,4,H)};this.lineSize5.onChange=function(H){A(this,G,5,H)};this.verticalLabels.onclick=function(){C.verticalLabelsClicked=!0;C.horizontalLabelsClicked=!1;C._toggleHorzVertOptions(!1);G.setVerticalLabels(C.verticalLabelsClicked)};this.horizontalLabels.onclick=function(){C.verticalLabelsClicked=
!1;C.horizontalLabelsClicked=!0;C._toggleHorzVertOptions(!0);G.setVerticalLabels(!C.horizontalLabelsClicked)};this._addOverflow();this._formatNumberTolocale(1E5,this.nls.gsid,this.gsidNode);this._formatNumberTolocale(1E4,this.nls.grid10k,this.grid10kNode);this._formatNumberTolocale(1E3,this.nls.grid1k,this.grid1kNode)},setConfig:function(){this.minIntervalSpacing.set("value",this.config.minIntervalSpacing);this.minIntervalSpacingVal.innerHTML=window.isRTL?y.sanitizeHTML("px"+this.config.minIntervalSpacing):
y.sanitizeHTML(this.config.minIntervalSpacing+"px");this.lineOpacity.set("value",this.config.lineOpacity);this.lineOpacityVal.innerHTML=window.isRTL?y.sanitizeHTML("%"+Math.round(100*this.config.lineOpacity)):y.sanitizeHTML(Math.round(100*this.config.lineOpacity)+"%");this.labelOpacity.set("value",this.config.labelOpacity);this.labelOpacityVal.innerHTML=window.isRTL?y.sanitizeHTML("%"+Math.round(100*this.config.labelOpacity)):y.sanitizeHTML(Math.round(100*this.config.labelOpacity)+"%");for(var C=
0;6>C;C++)this["colorPicker"+C].setColor(new f(this.config.colors[C])),this["colorPicker"+C].picker.setColor(this.config.colors[C]),E(this["colorPicker"+C].domNode,this.config.colors[C]);this.fontSize0.setValue(this.config.fontSizes[0]);this.fontSize1.setValue(this.config.fontSizes[1]);this.fontSize2.setValue(this.config.fontSizes[2]);this.fontSize3.setValue(this.config.fontSizes[3]);this.fontSize4.setValue(this.config.fontSizes[4]);this.fontSize5.setValue(this.config.fontSizes[5]);this.lineSize0.setValue(this.config.lineWidths[0]);
this.lineSize1.setValue(this.config.lineWidths[1]);this.lineSize2.setValue(this.config.lineWidths[2]);this.lineSize3.setValue(this.config.lineWidths[3]);this.lineSize4.setValue(this.config.lineWidths[4]);this.lineSize5.setValue(this.config.lineWidths[5]);this._toggleHorzVertOptions(!this.config.verticalLabels)},getConfig:function(){if(this._checkValidValues())return new q({message:this.nls.errorMessage}),!1;this.config=this.sampleGrid.getSettings();window.localStorage.setItem("storedGridSettings",
JSON.stringify(this.config));return this.config},_addOverflow:function(){var C=n(".neo",this.domNode);C&&m.forEach(C,function(G){r.set(G,"overflow-y","scroll")},this)},_checkValidValues:function(){return m.some([this.fontSize0,this.fontSize1,this.fontSize2,this.fontSize3,this.fontSize4,this.fontSize5,this.lineSize0,this.lineSize1,this.lineSize2,this.lineSize3,this.lineSize4,this.lineSize5],function(C){if((C=k.byId(C))&&(C.value<C.constraints.min||C.value>C.constraints.max))return!0},this)},_toggleHorzVertOptions:function(C){C?
(g.remove(this.horizontalLabels,"image-labels horizontalLabel"),g.add(this.horizontalLabels,"image-labels horizontalLabelClicked"),g.remove(this.verticalLabels,"image-labels verticalLabelClicked"),g.add(this.verticalLabels,"image-labels verticalLabel")):(g.remove(this.horizontalLabels,"image-labels horizontalLabelClicked"),g.add(this.horizontalLabels,"image-labels horizontalLabel"),g.remove(this.verticalLabels,"image-labels verticalLabel"),g.add(this.verticalLabels,"image-labels verticalLabelClicked"))},
_toggleLabelPlacement:function(C,G){if(C){var H=C.className.replace("image-labels","").trim();G?(g.remove(C,"image-labels "+H),g.add(C,"image-labels "+H+"Clicked")):(G=H.substring(0,H.indexOf("Clicked")),g.remove(C,"image-labels "+H),g.add(C,"image-labels "+G))}},_basemapGalleryOnSelectionChanged:function(C){C=C.target._selectedBasemap.layers[0].initialExtent;void 0!==C&&this.sampmap.centerAt(C.getCenter())},_getWebmapBasemap:function(){var C=this.map.itemInfo.item.thumbnail?u.getItemUrl(this.appConfig.portalUrl,
this.map.itemInfo.item.id)+"/info/"+this.map.itemInfo.item.thumbnail:null;return{title:this.map.itemInfo.itemData.baseMap.title,thumbnailUrl:C,layers:this.map.itemInfo.itemData.baseMap.baseMapLayers,spatialReference:this.map.spatialReference}},_getBasemapsConfig:function(){var C=new b,G=x._loadPortalBaseMaps(this.appConfig.portalUrl,this.map),H=w.getPortal(this.appConfig.portalUrl).loadSelfInfo();d({portalSelf:H,basemaps:G}).then(c.hitch(this,function(N){var M=N.basemaps,R=[],S=0,U=this._getWebmapBasemap();
M=m.filter(M,function(J){if(!J||!J.title)return!1;var O=x.isBingMap(J)?N.portalSelf.bingKey?!0:!1:!0;return J.title&&O},this);for(S=0;S<M.length&&!x.compareSameBasemapByOrder(M[S],U);S++);S===M.length&&M.push(U);for(S=0;S<M.length;S++){"OpenStreetMap"===M[S].title&&(M[S].title="Open Street Map");U=M[S].layers.length;for(var Y=[],Z=0;Z<U;Z++)Y.push(new v(M[S].layers[Z]));M[S].layers=Y;M[S].thumbnailUrl?/^(https?:)?\/\//.test(M[S].thumbnailUrl)?M[S].thumbnailUrl+=x.getToken(this.appConfig.portalUrl):
M[S].thumbnailUrl=y.processUrlInWidgetConfig(M[S].thumbnailUrl,this.folderUrl):M[S].thumbnailUrl=this.folderUrl+"images/default.jpg";R.push(new t(M[S]))}C.resolve({portalUrl:this.appConfig.portalUrl?this.appConfig.portalUrl:"",basemaps:R,showArcGISBasemaps:!1,bingMapsKey:N.portalSelf.bingKey})}));return C.promise},_formatNumberTolocale:function(C,G,H){C=z.substitute(G,{number:y.localizeNumber(C)});B.set(H,"innerHTML",C)}})});