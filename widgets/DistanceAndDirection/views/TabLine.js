// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DistanceAndDirection/templates/TabLine.html":'\x3cdiv class\x3d"tabPanel" data-dojo-attach-point\x3d"lineContainer"\x3e\r\n  \x3cdiv class\x3d"controls"\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel\x3e${nls.fromLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem"\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"lineTypeDD" style\x3d"width:100%" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          aria-label\x3d"${nls.fromLabel}" class\x3d"esriCTDropdownObj"\x3e\r\n          \x3coption value\x3d"DistAndBearing"\x3e${nls.distanceBearingLabel}\x3c/option\x3e\r\n          \x3coption selected\x3d"selected" value\x3d"Points"\x3e${nls.pointsLabel}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup" data-dojo-attach-point\x3d"startDiv"\x3e\r\n      \x3clabel data-dojo-attach-point\x3d"lineStartPointLabel"\x3e${nls.startPointLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem"\x3e\r\n        \x3cdiv class\x3d"jimu-input coordInput" data-dojo-attach-point\x3d"startPointCoordsLine"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"controlItem paddedLeft" data-dojo-attach-point\x3d"addPointBtnStartDiv"\x3e\r\n          \x3cdiv class\x3d\'add-with-icon\'\x3e\r\n            \x3cspan title\x3d"${nls.formatInputLabel}" class\x3d"jimu-icon settingBtn safariOnly"\r\n              data-dojo-attach-point\x3d"coordinateFormatButtonStart" tabindex\x3d"0" aria-label\x3d"${nls.formatInputLabel}"\r\n              role\x3d"button"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d\'add-with-icon\'\x3e\r\n            \x3cdiv title\x3d"${nls.addPointLabel}" class\x3d"drawPointBtn" data-dojo-attach-point\x3d"addPointBtnStart"\r\n              tabindex\x3d"0" aria-label\x3d"${nls.addPointLabel}" role\x3d"button"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cinput aria-label\x3d"${nls.createLineInteractively}" class\x3d"interactive-checkbox esriCTCheckboxObj" type\x3d"checkbox"\r\n        data-dojo-attach-point\x3d"interactiveLine" /\x3e\r\n      \x3clabel data-dojo-attach-point\x3d"interactiveLabel"\x3e${nls.createLineInteractively}\x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup endPt"\x3e\r\n      \x3clabel data-dojo-attach-point\x3d"lineEndPointLabel"\x3e${nls.endPointLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem"\x3e\r\n        \x3cdiv class\x3d"jimu-input coordInput" data-dojo-attach-point\x3d"endPointCoordsLine"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"controlItem paddedLeft" data-dojo-attach-point\x3d"addPointBtnEndDiv"\x3e\r\n          \x3cdiv class\x3d\'add-with-icon\'\x3e\r\n            \x3cspan title\x3d"${nls.formatInputLabel}" class\x3d"jimu-icon settingBtn safariOnly"\r\n              data-dojo-attach-point\x3d"coordinateFormatButtonEnd" tabindex\x3d"0" aria-label\x3d"${nls.formatInputLabel}"\r\n              role\x3d"button"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d\'add-with-icon\'\x3e\r\n            \x3cdiv title\x3d"${nls.addPointLabel}" class\x3d"drawPointBtn" data-dojo-attach-point\x3d"addPointBtnEnd" tabindex\x3d"0"\r\n              aria-label\x3d"${nls.addPointLabel}" role\x3d"button"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel\x3e${nls.lengthLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem" data-dojo-attach-point\x3d"lengthInputDiv"\x3e\r\n        \x3cinput aria-label\x3d"${nls.lengthLabel}" style\x3d"width: calc(100% - 108px);"\r\n          data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"1000"\r\n          data-dojo-props\x3d"constraints: {min: 1, max: 40030000}" data-dojo-attach-point\x3d"lengthInput"\r\n          data-dojo-attach-event\x3d"keyup: checkValidInputs"\x3e\r\n        \x3c/input\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"lengthUnitDD" aria-label\x3d"${nls.lengthLabel}"\x3e\r\n          \x3coption value\x3d"feet"\x3e${nls.units.feet}\x3c/option\x3e\r\n          \x3coption value\x3d"kilometers"\x3e${nls.units.kilometers}\x3c/option\x3e\r\n          \x3coption value\x3d"miles"\x3e${nls.units.miles}\x3c/option\x3e\r\n          \x3coption value\x3d"meters" selected\x3d"selected"\x3e${nls.units.meters}\x3c/option\x3e\r\n          \x3coption value\x3d"nautical-miles"\x3e${nls.units.nauticalMiles}\x3c/option\x3e\r\n          \x3coption value\x3d"yards"\x3e${nls.units.yards}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel\x3e${nls.angleLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem" data-dojo-attach-point\x3d"angleInputDiv"\x3e\r\n        \x3cinput aria-label\x3d"${nls.angleLabel}" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n          style\x3d"width: calc(100% - 108px);" required\x3d"true" value\x3d"0" data-dojo-props\x3d"constraints: {min: 0, max: 360}"\r\n          data-dojo-attach-point\x3d"angleInput" data-dojo-attach-event\x3d"onChange: checkValidInputs"\x3e\r\n        \x3c/input\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"angleUnitDD" tabindex\x3d"0" aria-label\x3d"${nls.angleLabel}"\x3e\r\n          \x3coption value\x3d"degrees"\x3e${nls.degreesLabel}\x3c/option\x3e\r\n          \x3coption value\x3d"mils"\x3e${nls.milsLabel}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"controlGroup" data-dojo-attach-point\x3d\'symbologyControlDiv\'\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d\'symbolControl\' title\x3d"${nls.symbolAndLabelSettingsLabel}"\r\n        data-dojo-type\x3d"dijit/TitlePane" data-dojo-props\x3d"open: false"\x3e\r\n        \x3cdiv class\x3d"controlGroup" style\x3d"margin-top: 0px;"\x3e\r\n    \r\n          \x3cdiv class\x3d"controlItem esriCTPaddingBottom10"\x3e\r\n            \x3cdiv class\x3d"esriCTLabel"\x3e${nls.symbologyPreviewLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTSymbolNode" tabindex\x3d"0" data-dojo-attach-point\x3d"lineSymbolNode"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n    \r\n          \x3cdiv class\x3d"controlItem esriCTPaddingBottom10 esriCTLabelSettings"\x3e\r\n            \x3cdiv class\x3d"esriCTLabel"\x3e${nls.ColorAndSizeLabel}\x3c/div\x3e\r\n            \x3cdiv style\x3d"margin-right:10px;" tabindex\x3d"0" aria-label\x3d"${nls.colorPickerLabel}"\r\n              data-dojo-attach-point\x3d"labelColorPickerNode"\x3e\x3c/div\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"labelTextSizeSpinner" aria-label\x3d"${nls.ColorAndSizeLabel}"\r\n              data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n              data-dojo-props\x3d\'value:12,smallDelta:1,constraints:{min:1, max:36, places: 0}\' type\x3d"text"\r\n              style\x3d"width: calc(100% - 185px)" required\x3d"true" /\x3e\r\n          \x3c/div\x3e\r\n    \r\n          \x3cdiv class\x3d"esriCTHintCheck"\x3e${nls.editSymbologyHint}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"buttonContainer"\x3e\r\n      \x3cdiv class\x3d\'jimu-btn jimu-state-disabled\' data-dojo-attach-point\x3d\'okButton\' style\x3d"width: 49%;"\r\n        data-dojo-attach-event\x3d"onclick: okButtonClicked" tabindex\x3d"-1" aria-label\x3d"${nls.common.ok}" role\x3d"button"\x3e\r\n        ${nls.common.ok}\x3c/div\x3e\r\n      \x3cdiv class\x3d\'jimu-btn\' tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearGraphicsLabel}" style\x3d"width: 49%;"\r\n        data-dojo-attach-point\x3d\'clearGraphicsButton\' data-dojo-attach-event\x3d"onclick: clearGraphics"\x3e\r\n        ${nls.clearGraphicsLabel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/on dojo/topic dojo/has dojo/touch dojo/dom-class dojo/string dojo/mouse dojo/number dojo/keys dojo/dom-attr dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/TooltipDialog dijit/popup jimu/dijit/Message jimu/LayerInfos/LayerInfos jimu/utils esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/layers/LabelClass esri/tasks/FeatureSet esri/geometry/geometryEngine esri/geometry/Polyline esri/geometry/Circle esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/graphic ../models/LineFeedback ../models/ShapeModel ../views/CoordinateInput ../views/EditOutputCoordinate ../models/DirectionalLineSymbol dojo/text!../templates/TabLine.html dijit/focus dojo/_base/event dojo/aspect esri/symbols/jsonUtils dojo/dom-construct jimu/symbolUtils ../SymbolChooserPopup ../setting/js/ColorPickerEditor dojo/_base/Color esri/symbols/SimpleLineSymbol dijit/form/NumberSpinner dijit/form/NumberTextBox jimu/dijit/formSelect jimu/dijit/CheckBox dijit/TitlePane".split(" "),
function(B,c,C,f,t,O,P,m,u,D,E,e,p,Q,R,S,F,h,G,H,q,T,U,I,V,w,x,W,X,Y,y,v,Z,J,K,fa,aa,g,k,L,z,A,ba,ca,da,ea,M){return B([Q,R,S],{templateString:aa,baseClass:"jimu-widget-TabLine",_restrictFocusOnAddStartPointBtn:!1,_restrictFocusOnEndStartPointBtn:!1,_startPointInputKeyPressed:!1,_endPointInputKeyPressed:!1,_gl:null,_tsGL:null,constructor:function(a){B.safeMixin(this,a);this._tsGL=this._gl=null},destroy:function(){this.dtStart&&this.dtStart.clearPoints(!0);this.dtEnd&&this.dtEnd.clearPoints(!0);this._gl&&
this.map.removeLayer(this._gl);this._tsGL&&this.map.removeLayer(this._tsGL);this.tabSwitched()},postCreate:function(){this._endPointInputKeyPressed=this._startPointInputKeyPressed=this._restrictFocusOnEndStartPointBtn=this._restrictFocusOnAddStartPointBtn=!1;this.currentLengthUnit=this.lengthUnitDD.get("value");this.currentAngleUnit=this.angleUnitDD.get("value");this._lineSym=new M(this.lineSymbol);this._ptSym=new X(this.pointSymbol);this._labelSym=new Y(this.labelSymbol);this._tsGL=new T;this.map.addLayer(this._tsGL);
this.map.addLayer(this.getLayer());if(this._gl.loaded){var a=H.getInstanceSync().getLayerInfoById("Distance \x26 Direction - Line Graphics");a.showLabels();a.enablePopup()}else this._gl.on("load",c.hitch(this,function(){var b=H.getInstanceSync().getLayerInfoById("Distance \x26 Direction - Line Graphics");b.showLabels();b.enablePopup()}));this.coordToolStart=new J({appConfig:this.appConfig,nls:this.nls,"aria-label":this.nls.startPointLabel},this.startPointCoordsLine);this.coordToolStart.inputCoordinate.formatType=
"DD";this.coordToolEnd=new J({appConfig:this.appConfig,nls:this.nls,"aria-label":this.nls.endPointLabel},this.endPointCoordsLine);this.coordToolEnd.inputCoordinate.formatTyp="DD";this.coordinateFormatStart=new F({content:new K({nls:this.nls}),style:"width: 400px"});L.after(this.coordinateFormatStart,"onClose",c.hitch(this,function(){g.focus(this.coordinateFormatButtonStart);if(this._restrictFocusOnAddStartPointBtn){var b=this.coordToolStart.getValue();if(""===b||null===b||void 0===b)this._restrictFocusOnAddStartPointBtn=
!1}}));"DartTheme"===this.appConfig.theme.name&&m.add(this.coordinateFormatStart.domNode,"dartThemeClaroDijitTooltipContainerOverride");this.coordinateFormatEnd=new F({content:new K({nls:this.nls}),style:"width: 400px"});L.after(this.coordinateFormatEnd,"onClose",c.hitch(this,function(){g.focus(this.coordinateFormatButtonEnd);if(this._restrictFocusOnEndStartPointBtn){var b=this.coordToolEnd.getValue();if(""===b||null===b||void 0===b)this._restrictFocusOnEndStartPointBtn=!1}}));"DartTheme"===this.appConfig.theme.name&&
m.add(this.coordinateFormatEnd.domNode,"dartThemeClaroDijitTooltipContainerOverride");this.dtStart=new v({appConfig:this.appConfig,map:this.map,coordTool:this.coordToolStart.inputCoordinate.util,nls:this.nls});this.dtEnd=new v({appConfig:this.appConfig,map:this.map,coordTool:this.coordToolStart.inputCoordinate.util,nls:this.nls});this.dtStart.setLineSymbol(this._lineSym);this._createSymbolPicker(this.lineSymbolNode,"lineSymbol","esriGeometryPolyline",this.nls.lineSymbologyPopupTittle);this.labelColorPicker=
this._createColorPicker(this.labelColorPickerNode);this._setColorPicker(this.labelSymbol.color);this.labelTextSizeSpinner.set("value",this.labelSymbol.font.size);this.lineTypeDDDidChange();this.syncEvents();this.lengthInput.invalidMessage=this.nls.numericInvalidMessage;this.lengthInput.rangeMessage=this.nls.lineLengthErrorMessage;this.angleInput.invalidMessage=this.nls.numericInvalidMessage;this.angleInput.rangeMessage=this.nls.orientationErrorMessage},getLayer:function(){if(!this._gl){var a={labelExpressionInfo:{value:this.nls.lengthLabel+
": {GeoLength}"}};a=new I(a);a.labelPlacement="above-along";a.where="GeoLength \x3e 0";a.symbol=this._labelSym.setOffset(0,10);a={labelExpressionInfo:{value:this.nls.angleLabel+": {LineAngle}"}};a=new I(a);a.labelPlacement="below-along";a.where="LineAngle \x3e 0";a.symbol=c.clone(this._labelSym).setOffset(0,-10);a={layerDefinition:{geometryType:"esriGeometryPolyline",objectIdField:"ObjectID",fields:[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:"GeoLength",type:"esriFieldTypeString",
alias:"Length"},{name:"LineAngle",type:"esriFieldTypeString",alias:"Angle"}]},featureSet:new V};this._gl=new U(a,{id:"Distance \x26 Direction - Line Graphics",outFields:["*"],showLabels:!0});this.own(f(this._gl,"visibility-change",c.hitch(this,function(b){this._tsGL.setVisibility(b.visible)})));return this._gl}},syncEvents:function(){t.subscribe("TAB_SWITCHED",c.hitch(this,this.tabSwitched));t.subscribe("DD-WIDGET-CLOSED",c.hitch(this,this._closeDijit));t.subscribe(v.drawnLineLengthDidChange,c.hitch(this,
this.lineLengthDidChange));t.subscribe(v.drawnLineAngleDidChange,c.hitch(this,this.lineAngleDidChange));this.dtStart.watch("startPoint",c.hitch(this,function(a,b,d){this.dtStart.addStartGraphic(d,this._ptSym)}));this.dtStart.watch("startPointDD",c.hitch(this,function(a,b,d){this.coordToolStart.inputCoordinate.set("coordinateEsriGeometry",d);this.coordToolStart.inputCoordinate.set("inputType",this.coordToolStart.inputCoordinate.formatType)}));this.dtStart.watch("endPointDD",c.hitch(this,function(a,
b,d){this.coordToolEnd.inputCoordinate.set("coordinateEsriGeometry",d);this.coordToolEnd.inputCoordinate.set("inputType",this.coordToolEnd.inputCoordinate.formatType)}));this.dtStart.on("draw-complete",c.hitch(this,this.feedbackDidCompleteStart));this.coordToolStart.inputCoordinate.watch("outputString",c.hitch(this,function(a,b,d){this.coordToolStart.manualInput||(this.currentLine=null,this.coordToolStart.set("value",d),this._restrictFocusOnAddStartPointBtn?this._restrictFocusOnAddStartPointBtn=!1:
this._startPointInputKeyPressed?this._startPointInputKeyPressed=!1:g.focus(this.addPointBtnStart))}));this.coordToolStart.on("keydown",c.hitch(this,this.coordToolStartKeyWasPressed));this.dtEnd.watch("startPoint",c.hitch(this,function(a,b,d){this.dtEnd.addStartGraphic(d,this._ptSym)}));this.dtEnd.watch("endPoint",c.hitch(this,function(a,b,d){this.dtEnd.addStartGraphic(d,this._ptSym)}));this.dtEnd.watch("startPointDD",c.hitch(this,function(a,b,d){this.coordToolEnd.inputCoordinate.set("coordinateEsriGeometry",
d);this.coordToolEnd.inputCoordinate.set("inputType",this.coordToolEnd.inputCoordinate.formatType)}));this.dtEnd.watch("endPointDD",c.hitch(this,function(a,b,d){this.coordToolEnd.inputCoordinate.set("coordinateEsriGeometry",d);this.coordToolEnd.inputCoordinate.set("inputType",this.coordToolEnd.inputCoordinate.formatType)}));this.dtEnd.on("draw-complete",c.hitch(this,this.feedbackDidCompleteEnd));this.coordToolEnd.inputCoordinate.watch("outputString",c.hitch(this,function(a,b,d){this.coordToolEnd.manualInput||
(this.coordToolEnd.set("value",d),this.currentLine&&this.currentLine.graphic&&this.currentLine.graphic.attributes&&""===this.currentLine.graphic.attributes.EndPoint&&(this.currentLine.graphic.attributes.EndPoint=this.coordToolEnd.getValue()),this._restrictFocusOnEndStartPointBtn?this._restrictFocusOnEndStartPointBtn=!1:this._endPointInputKeyPressed?this._endPointInputKeyPressed=!1:g.focus(this.addPointBtnEnd))}));this.coordToolEnd.on("keydown",c.hitch(this,this.coordToolEndKeyWasPressed));this.lengthUnitDD.on("change",
c.hitch(this,this.lengthUnitDDDidChange));this.angleUnitDD.on("change",c.hitch(this,this.angleUnitDDDidChange));this.lineTypeDD.on("change",c.hitch(this,this.lineTypeDDDidChange));this.own(f(this.coordinateFormatButtonStart,"click",c.hitch(this,this.coordinateFormatButtonStartClicked)),f(this.coordinateFormatButtonStart,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),this.coordinateFormatButtonStartClicked()})),f(this.coordinateFormatStart.content.applyButton,
"click",c.hitch(this,function(){this._restrictFocusOnAddStartPointBtn=!0;var a=this.coordinateFormatStart.content.formats[this.coordinateFormatStart.content.ct],b=a.defaultFormat,d=this.coordinateFormatStart.content.frmtSelect.get("value");a.useCustom&&(b=a.customFormat);this.coordToolStart.inputCoordinate.set("formatPrefix",this.coordinateFormatStart.content.addSignChkBox.checked);this.coordToolStart.inputCoordinate.set("formatString",b);this.coordToolStart.inputCoordinate.set("formatType",d);this.setCoordLabelStart(d);
h.close(this.coordinateFormatStart);g.focus(this.coordinateFormatButtonStart)})),f(this.coordinateFormatStart.content.applyButton,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE){k.stop(a);this._restrictFocusOnAddStartPointBtn=!0;var b=this.coordinateFormatStart.content.formats[this.coordinateFormatStart.content.ct],d=b.defaultFormat,l=this.coordinateFormatStart.content.frmtSelect.get("value");b.useCustom&&(d=b.customFormat);this.coordToolStart.inputCoordinate.set("formatPrefix",
this.coordinateFormatStart.content.addSignChkBox.checked);this.coordToolStart.inputCoordinate.set("formatString",d);this.coordToolStart.inputCoordinate.set("formatType",l);this.setCoordLabelStart(l);h.close(this.coordinateFormatStart);g.focus(this.coordinateFormatButtonStart)}a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatStart),g.focus(this.coordinateFormatButtonStart))})),f(this.coordinateFormatStart.content.cancelButton,"click",c.hitch(this,function(){h.close(this.coordinateFormatStart)})),
f(this.coordinateFormatStart.content.cancelButton,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),h.close(this.coordinateFormatStart),g.focus(this.coordinateFormatButtonStart);a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatStart),g.focus(this.coordinateFormatButtonStart))})),f(this.coordinateFormatButtonEnd,"click",c.hitch(this,this.coordinateFormatButtonEndClicked)),f(this.coordinateFormatButtonEnd,"keydown",c.hitch(this,function(a){if(a.keyCode===
e.ENTER||a.keyCode===e.SPACE)k.stop(a),this.coordinateFormatButtonEndClicked()})),f(this.coordinateFormatEnd.content.applyButton,"click",c.hitch(this,function(){this._restrictFocusOnEndStartPointBtn=!0;var a=this.coordinateFormatEnd.content.formats[this.coordinateFormatEnd.content.ct],b=a.defaultFormat,d=this.coordinateFormatEnd.content.frmtSelect.get("value");a.useCustom&&(b=a.customFormat);this.coordToolEnd.inputCoordinate.set("formatPrefix",this.coordinateFormatEnd.content.addSignChkBox.checked);
this.coordToolEnd.inputCoordinate.set("formatString",b);this.coordToolEnd.inputCoordinate.set("formatType",d);this.setCoordLabelEnd(d);h.close(this.coordinateFormatEnd);g.focus(this.coordinateFormatButtonEnd)})),f(this.coordinateFormatEnd.content.applyButton,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE){k.stop(a);this._restrictFocusOnEndStartPointBtn=!0;var b=this.coordinateFormatEnd.content.formats[this.coordinateFormatEnd.content.ct],d=b.defaultFormat,l=this.coordinateFormatEnd.content.frmtSelect.get("value");
b.useCustom&&(d=b.customFormat);this.coordToolEnd.inputCoordinate.set("formatPrefix",this.coordinateFormatEnd.content.addSignChkBox.checked);this.coordToolEnd.inputCoordinate.set("formatString",d);this.coordToolEnd.inputCoordinate.set("formatType",l);this.setCoordLabelEnd(l);h.close(this.coordinateFormatEnd);g.focus(this.coordinateFormatButtonEnd)}a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatEnd),g.focus(this.coordinateFormatButtonEnd))})),f(this.coordinateFormatEnd.content.cancelButton,
"click",c.hitch(this,function(){h.close(this.coordinateFormatEnd)})),f(this.coordinateFormatEnd.content.cancelButton,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),h.close(this.coordinateFormatEnd),g.focus(this.coordinateFormatButtonEnd);a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatEnd),g.focus(this.coordinateFormatButtonEnd))})),f(this.addPointBtnStart,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),
this.addStartPointButtonClicked()})),f(this.addPointBtnEnd,"click",c.hitch(this,this.addEndPointButtonClicked)),f(this.addPointBtnEnd,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),this.addEndPointButtonClicked()})),f(this.interactiveLine,"change",c.hitch(this,this.interactiveCheckBoxChanged)),f(this.interactiveLine,"keydown",c.hitch(this,function(a){a.keyCode===e.ENTER&&(this.interactiveLine.checked=this.interactiveLine.checked?!1:!0,this.interactiveCheckBoxChanged())})),
f(this.okButton,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),this.okButtonClicked()})),f(this.clearGraphicsButton,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)k.stop(a),this.clearGraphics()})),f(this.coordinateFormatStart.content.frmtSelect,"keydown",c.hitch(this,function(a){a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatStart),g.focus(this.coordinateFormatButtonStart))})),f(this.coordinateFormatStart.content.frmtVal,
"keydown",c.hitch(this,function(a){a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatStart),g.focus(this.coordinateFormatButtonStart))})),f(this.coordinateFormatStart.content.addSignChkBox,"keydown",c.hitch(this,function(a){a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatStart),g.focus(this.coordinateFormatButtonStart));a.keyCode===e.ENTER&&(k.stop(a),this.coordinateFormatStart.content.addSignChkBox.checked=this.coordinateFormatStart.content.addSignChkBox.checked?!1:!0)})),
f(this.coordinateFormatEnd.content.frmtSelect,"keydown",c.hitch(this,function(a){a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatEnd),g.focus(this.coordinateFormatButtonEnd))})),f(this.coordinateFormatEnd.content.frmtVal,"keydown",c.hitch(this,function(a){a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatEnd),g.focus(this.coordinateFormatButtonEnd))})),f(this.coordinateFormatEnd.content.addSignChkBox,"keydown",c.hitch(this,function(a){a.keyCode===e.ESCAPE&&(k.stop(a),h.close(this.coordinateFormatEnd),
g.focus(this.coordinateFormatButtonEnd));a.keyCode===e.ENTER&&(k.stop(a),this.coordinateFormatEnd.content.addSignChkBox.checked=this.coordinateFormatEnd.content.addSignChkBox.checked?!1:!0)})),f(this.lengthInputDiv,D.leave,c.hitch(this,this.checkValidInputs)),f(this.angleInputDiv,D.leave,c.hitch(this,this.checkValidInputs)));O("esri-touch")?this.own(f(this.addPointBtnStart,P.press,c.hitch(this,this.addStartPointButtonClicked))):this.own(f(this.addPointBtnStart,"click",c.hitch(this,this.addStartPointButtonClicked)));
this.own(f(this.labelColorPicker,"colorChanged",c.hitch(this,function(a){"line"===a&&(this._labelSym.color=this._getColorPicker())})));this.own(f(this.labelTextSizeSpinner,"change",c.hitch(this,function(){this._labelSym.font.size=this.labelTextSizeSpinner.getValue()})));this.own(f(this.labelColorPickerNode,"keydown",c.hitch(this,function(a){a.keyCode!==e.ENTER&&a.keyCode!==e.SPACE||this.labelColorPicker.colorPicker.domNode.click()})));this.own(f(this.labelTextSizeSpinner,"blur",c.hitch(this,function(){this.labelTextSizeSpinner.isValid()||
this.labelTextSizeSpinner.set("value",this.labelSymbol.font.size)})))},lineLengthDidChange:function(a){a=E.format(a,{places:2,locale:C.locale});this.lengthInput.set("value",a)},lineAngleDidChange:function(a){a=E.format(a,{places:2,locale:C.locale});this.angleInput.set("value",a)},interactiveCheckBoxChanged:function(){this.tabSwitched();this.coordToolEnd.set("disabled",this.interactiveLine.checked);this.interactiveLine.checked?(m.add(this.addPointBtnEndDiv,"controlGroupHidden"),this.addPointBtnStart.title=
this.nls.drawLineLabel,this.addPointBtnEnd.hidden=!0):(this.coordToolEnd.clear(),this.addPointBtnStart.title=this.nls.addPointLabel,m.remove(this.addPointBtnEndDiv,"controlGroupHidden"),this.addPointBtnEnd.hidden=!1);this.checkValidInputs()},lineTypeDDDidChange:function(){"Points"===this.lineTypeDD.get("value")?(this.addPointBtnStart.title=this.nls.addPointLabel,this.coordToolEnd.set("disabled",!1),this.angleInput.set("disabled",!0),this.lengthInput.set("disabled",!0),this.interactiveLine.disabled=
!1,m.remove(this.addPointBtnEndDiv,"controlGroupHidden"),m.remove(this.interactiveLabel,"disabledLabel"),this.addPointBtnEnd.hidden=!1):(this.addPointBtnStart.title=this.nls.addPointLabel,this.interactiveLine.disabled=!0,this.interactiveLine.checked&&(this.interactiveLine.checked=!1),this.coordToolEnd.set("value",""),this.coordToolEnd.set("disabled",!0),this.angleInput.set("disabled",!1),this.lengthInput.set("disabled",!1),m.add(this.addPointBtnEndDiv,"controlGroupHidden"),m.add(this.interactiveLabel,
"disabledLabel"),this.addPointBtnEnd.hidden=!0);this.checkValidInputs()},coordinateFormatButtonStartClicked:function(){this.coordinateFormatStart.content.set("ct",this.coordToolStart.inputCoordinate.formatType);h.open({popup:this.coordinateFormatStart,around:this.coordinateFormatButtonStart});g.focus(this.coordinateFormatStart.content.frmtSelect.focusNode)},_closeDijit:function(){this.coordinateFormatStart&&this.coordinateFormatStart.domNode.offsetParent&&h.close(this.coordinateFormatStart);this.coordinateFormatEnd&&
this.coordinateFormatEnd.domNode.offsetParent&&h.close(this.coordinateFormatEnd)},coordinateFormatButtonEndClicked:function(){this.coordinateFormatEnd.content.set("ct",this.coordToolEnd.inputCoordinate.formatType);h.open({popup:this.coordinateFormatEnd,around:this.coordinateFormatButtonEnd});g.focus(this.coordinateFormatEnd.content.frmtSelect.focusNode)},coordToolStartKeyWasPressed:function(a){this.dtStart.removeStartGraphic();a.keyCode===e.ENTER&&(this._startPointInputKeyPressed=this._restrictFocusOnAddStartPointBtn=
!0,this.currentLine=null,this.coordToolStart.inputCoordinate.getInputType().then(c.hitch(this,function(b){"UNKNOWN"===b.inputType?(new G({message:this.nls.invalidCoordinateTypeMessage}),this.coordToolStart.inputCoordinate.coordinateEsriGeometry=null,this.checkValidInputs()):this.dtStart.getProjectedGeometry(b.coordinateEsriGeometry,this.map.spatialReference).then(c.hitch(this,c.hitch(this,function(d){this.dtStart.onLineStartManualInputHandler(d);this.setCoordLabelStart(b.inputType);this.coordToolStart.inputCoordinate.set("formatString",
this.coordinateFormatStart.content.formats[b.inputType].defaultFormat);this.coordToolStart.inputCoordinate.set("formatType",b.inputType);this.dtStart.addStartGraphic(d,this._ptSym);this.checkValidInputs()})))})))},coordToolEndKeyWasPressed:function(a){this.dtEnd.removeStartGraphic();a.keyCode===e.ENTER&&(this._endPointInputKeyPressed=this._restrictFocusOnEndStartPointBtn=!0,this.currentLine=null,this.coordToolEnd.inputCoordinate.getInputType().then(c.hitch(this,function(b){"UNKNOWN"===b.inputType?
(new G({message:this.nls.invalidCoordinateTypeMessage}),this.coordToolEnd.inputCoordinate.coordinateEsriGeometry=null,this.checkValidInputs()):this.dtEnd.getProjectedGeometry(b.coordinateEsriGeometry,this.map.spatialReference).then(c.hitch(this,c.hitch(this,function(d){this.dtEnd.onLineStartManualInputHandler(d);this.setCoordLabelEnd(b.inputType);this.coordToolEnd.inputCoordinate.set("formatString",this.coordinateFormatEnd.content.formats[b.inputType].defaultFormat);this.coordToolEnd.inputCoordinate.set("formatType",
b.inputType);this.dtEnd.addStartGraphic(d,this._ptSym);this.checkValidInputs()})))})))},setCoordLabelStart:function(a){a=q.sanitizeHTML(u.substitute(this.nls.startPointLabel+" (${crdType})",{crdType:a}));this.lineStartPointLabel.innerHTML=a;p.set(this.coordToolStart.textbox,"aria-label",a)},setCoordLabelEnd:function(a){a=q.sanitizeHTML(u.substitute(this.nls.endPointLabel+" (${crdType})",{crdType:a}));this.lineEndPointLabel.innerHTML=a;p.set(this.coordToolEnd.textbox,"aria-label",a)},checkValidInputs:function(){m.add(this.okButton,
"jimu-state-disabled");p.set(this.okButton,"tabindex",-1);"DistAndBearing"===this.lineTypeDD.get("value")?null!==this.coordToolStart.inputCoordinate.coordinateEsriGeometry&&this.lengthInput.isValid()&&this.angleInput.isValid()&&(m.remove(this.okButton,"jimu-state-disabled"),p.set(this.okButton,"tabindex",0)):null!==this.coordToolStart.inputCoordinate.coordinateEsriGeometry&&null!==this.coordToolEnd.inputCoordinate.coordinateEsriGeometry&&(m.remove(this.okButton,"jimu-state-disabled"),p.set(this.okButton,
"tabindex",0));this.okButton.innerHTML=this.interactiveLine.checked?this.nls.publishDDBtn:this.nls.common.ok},addStartPointButtonClicked:function(){m.contains(this.addPointBtnStart,"drawPointBtn-active")?(this.dtStart.deactivate(),this._setMapNavigation(!0)):(this.tabSwitched(),this.coordToolStart.manualInput=!1,this.coordToolEnd.manualInput=!1,this._setMapNavigation(!1),"Points"===this.lineTypeDD.get("value")&&this.interactiveLine.checked?this.dtStart.activate("polyline"):this.dtStart.activate("point"));
m.toggle(this.addPointBtnStart,"drawPointBtn-active")},addEndPointButtonClicked:function(){m.contains(this.addPointBtnEnd,"drawPointBtn-active")?(this.dtEnd.deactivate(),this._setMapNavigation(!0)):(this.tabSwitched(),this.coordToolStart.manualInput=!1,this.coordToolEnd.manualInput=!1,this._setMapNavigation(!1),this.dtEnd.activate("point"));m.toggle(this.addPointBtnEnd,"drawPointBtn-active")},lengthUnitDDDidChange:function(){this.currentLengthUnit=this.lengthUnitDD.get("value");this.dtStart.set("lengthUnit",
this.currentLengthUnit)},angleUnitDDDidChange:function(){this.currentAngleUnit=this.angleUnitDD.get("value");this.dtStart.set("angleUnit",this.currentAngleUnit);"degrees"===this.currentAngleUnit?(this.angleInput.constraints.max=360,this.angleInput.rangeMessage=this.nls.degreesRangeMessage):(this.angleInput.constraints.max=6400,this.angleInput.rangeMessage=this.nls.millsRangeMessage)},feedbackDidCompleteStart:function(a){if("polyline"===a.geometry.type){if(this.interactiveLine.checked&&(a=a.geometry.result),
void 0!==this.lengthInput.get("value")||void 0!==this.angleInput.get("value")){this.currentLine=new Z(a);var b=null;b=new x({paths:4326===this.map.spatialReference.wkid?this.currentLine.geographicGeometry.paths:this.currentLine.geometry.paths,spatialReference:this.map.spatialReference});if(4326===this.map.spatialReference.wkid||102100===this.map.spatialReference.wkid)b=w.geodesicDensify(b,1E4);this.currentLine.graphic=new y(b,this._lineSym,{ObjectID:this._gl.graphics.length+1,GeoLength:this.lengthInput.get("displayedValue").toString()+
" "+this.lengthUnitDD.get("displayedValue"),LineAngle:this.angleInput.get("displayedValue").toString()+" "+this.angleUnitDD.get("displayedValue"),Distance:parseFloat(this.lengthInput.get("value")),Unit:this.currentLengthUnit,Angle:parseFloat(this.angleInput.get("value")),StartPoint:this.coordToolStart.getValue(),EndPoint:this.coordToolEnd.getValue(),AngleUnit:this.angleUnitDD.get("value")});var d=a.geometry.getExtent().getCenter();a=w.nearestCoordinate(a.geometry,d);d={lengthLabel:this.nls.lengthLabel,
spacerLabel:" ",lengthInputValue:this.lengthInput.get("displayedValue").toString(),abbrevLengthLabel:this._getLengthAbbrevation(this.lengthUnitDD.get("value")),angleLabel:this.nls.angleLabel,angleValue:this.angleInput.get("displayedValue").toString(),abbrevAngleLabel:this._getDegreeAbbreviation(this.angleUnitDD.get("value"))};var l=u.substitute(window.isRTL?"${spacerLabel}${lengthInputValue}${spacerLabel}${abbrevLengthLabel}${spacerLabel}${lengthLabel}":"${lengthLabel}${spacerLabel}${lengthInputValue}${spacerLabel}${abbrevLengthLabel}",
d);this._tsGL.add(new y(a.coordinate,c.clone(this._labelSym).setOffset(0,30).setText(l)));l=u.substitute(window.isRTL?"${spacerLabel}${angleValue}${spacerLabel}${abbrevAngleLabel}${spacerLabel}${angleLabel}":"${angleLabel}${spacerLabel}${angleValue}${spacerLabel}${abbrevAngleLabel}",d);this._tsGL.add(new y(a.coordinate,c.clone(this._labelSym).setText(l)));this._gl.add(this.currentLine.graphic);this._gl.refresh();this.dtStart.removeStartGraphic();this.dtEnd.removeStartGraphic();b=b.getExtent().expand(3);
this.map.setExtent(b);this.interactiveLine.checked&&m.toggle(this.addPointBtnStart,"drawPointBtn-active")}}else m.toggle(this.addPointBtnStart,"drawPointBtn-active");this.checkValidInputs();this._setMapNavigation(!0);this.dtStart.deactivate()},feedbackDidCompleteEnd:function(a){this.checkValidInputs();this._setMapNavigation(!0);this.dtEnd.deactivate();m.toggle(this.addPointBtnEnd,"drawPointBtn-active");"Points"===this.lineTypeDD.get("value")&&!this.interactiveLine.checked&&this.coordToolStart.inputCoordinate.coordinateEsriGeometry&&
this.coordToolEnd.inputCoordinate.coordinateEsriGeometry&&this.createManualGraphic()},createManualGraphic:function(a){var b=this.coordToolStart.inputCoordinate.coordinateEsriGeometry,d=this.coordToolEnd.inputCoordinate.coordinateEsriGeometry,l=new x(this.coordToolStart.inputCoordinate.coordinateEsriGeometry.spatialReference);l.addPath([b,d]);var n=w.geodesicLength(l,9001);this.dtStart.getProjectedGeometry(l,this.map.spatialReference).then(c.hitch(this,function(r){this.lengthInput.set("value",this.dtStart.coordTool.convertMetersToUnits(n,
this.lengthUnitDD.get("value")));this.lineAngleDidChange(this.dtStart.getAngle(this.dtStart.startPoint,this.dtEnd.startPoint));this.map.setExtent(r.getExtent().expand(3));this.feedbackDidCompleteStart({geometry:r,geographicGeometry:l});this.dtStart.clearPoints();this.dtEnd.clearPoints();a&&this.emit("show-publish",this._gl)}))},okButtonClicked:function(a){if(!m.contains(this.okButton,"jimu-state-disabled"))if(this._restrictFocusOnAddStartPointBtn=!0,this.currentLine)this.emit("show-publish",this._gl);
else if("Points"===this.lineTypeDD.get("value"))this.createManualGraphic(!0);else{a=this.coordToolStart.inputCoordinate.coordinateEsriGeometry;var b=this.coordToolStart.inputCoordinate.util.convertToMeters(this.lengthInput.get("value"),this.lengthUnitDD.get("value"));b=new W(a,{geodesic:!0,radius:b,numberOfPoints:64E3});var d=this.angleInput.get("value");d="degrees"===this.currentAngleUnit?parseInt(177.77777778*d,10):parseInt(10*d,10);b=b.getPoint(0,d);var l=new x;l.addPath([a,b]);this.dtStart.getProjectedGeometry(l,
this.map.spatialReference).then(c.hitch(this,function(n){this.feedbackDidCompleteStart({geometry:n,geographicGeometry:l});this.emit("show-publish",this._gl)}));this.coordToolEnd.inputCoordinate.set("coordinateEsriGeometry",b)}},clearGraphics:function(){this._gl&&(this._gl.clear(),this._tsGL.clear(),this.dtStart.removeStartGraphic(),this.dtEnd.removeStartGraphic(),this.coordToolStart.clear(),this.coordToolEnd.clear(),this.tabSwitched());this.currentLine=null;this.checkValidInputs();for(var a=0;a<this.map.graphicsLayerIds.length;a++)this.map.getLayer(this.map.graphicsLayerIds[a]).refresh()},
setGraphicsHidden:function(){this._gl&&this._gl.hide()},setGraphicsShown:function(){this._gl&&this._gl.show()},tabSwitched:function(){this.dtStart&&this.dtStart.deactivate();this.dtEnd&&this.dtEnd.deactivate();this._setMapNavigation(!0);this.addPointBtnStart&&m.remove(this.addPointBtnStart,"drawPointBtn-active");this.addPointBtnEnd&&m.remove(this.addPointBtnEnd,"drawPointBtn-active");this.coordinateFormat&&h.close(this.coordinateFormat)},_setMapNavigation:function(a){a?this.map.enableMapNavigation():
(this.map.disableMapNavigation(),this.map.enableScrollWheelZoom())},_getLengthAbbrevation:function(a){var b=null;if(a)switch(a){case "feet":b=this.nls.abbrevFeetLabel;break;case "kilometers":b=this.nls.abbrevKmLabel;break;case "miles":b=this.nls.abbrevMilesLabel;break;case "meters":b=this.nls.abbrevMetersLabel;break;case "nautical-miles":b=this.nls.abbrevNauticalMilesLabel;break;case "yards":b=this.nls.abbrevYardsLabel;break;default:b=a}return b},_getDegreeAbbreviation:function(a){var b=null;if(a)switch(a){case "degrees":b=
this.nls.abbrevDegreesLabel;break;case "mils":b=this.nls.abbrevMilsLabel;break;default:b=a}return b},setFirstFocusNode:function(){q.initFirstFocusNode(this.domNodeObj,this.lineTypeDD.focusNode)},focusFirstNodeOfSelectedTab:function(){g.focus(this.lineTypeDD.focusNode)},setLastFocusNode:function(){q.initLastFocusNode(this.domNodeObj,this.clearGraphicsButton)},_createSymbolPicker:function(a,b,d,l){if(d){var n={};n.type=q.getSymbolTypeByGeometryType(d);this.hasOwnProperty("lineSymbol")&&(n.symbol=z.fromJson(this.lineSymbol));
var r={symbolChooserTitle:l,symbolParams:n,nls:this.nls,symbolType:b};this._showSelectedSymbol(a,n.symbol,b);this.own(f(a,"click",c.hitch(this,function(){n.symbol=z.fromJson(this.lineSymbol);this._initSymbolChooserPopup(r,a);g.focus(this.lineSymbolNode)})));this.own(f(a,"keydown",c.hitch(this,function(N){if(N.keyCode===e.ENTER||N.keyCode===e.SPACE)n.symbol=z.fromJson(this.lineSymbol),this._initSymbolChooserPopup(r,a),g.focus(this.lineSymbolNode)})))}},_initSymbolChooserPopup:function(a,b){var d=new ca(a);
d.onOkClick=c.hitch(this,function(){var l=d.symbolChooser.getSymbol();this._showSelectedSymbol(b,l,a.symbolType);d.popup.close()})},_showSelectedSymbol:function(a,b,d){A.empty(a);b&&((d=ba.createSymbolNode(b))||(d=A.create("div")),A.place(d,a),this.lineSymbol=b.toJson(),this._lineSym=new M(this.lineSymbol),this.dtStart.setLineSymbol(this._lineSym))},_createColorPicker:function(a){var b=new da({nls:this.nls,tab:"line"});b.placeAt(a);b.startup();return b},_getColorPicker:function(){return this.labelColorPicker.getValues()},
_setColorPicker:function(a){this.labelColorPicker.setValues({color:new ea(a)})}})});