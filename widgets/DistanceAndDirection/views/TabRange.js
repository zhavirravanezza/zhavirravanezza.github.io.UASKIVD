// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DistanceAndDirection/templates/TabRange.html":'\x3cdiv class\x3d"tabPanel" data-dojo-attach-point\x3d"rangeContainer"\x3e\r\n  \x3cdiv class\x3d"controls"\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel\x3e${nls.lineTypeLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem"\x3e\r\n        \x3cselect aria-label\x3d"${nls.lineTypeLabel}" data-dojo-attach-point\x3d"rangeType" style\x3d"width: 100%;"\r\n          data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"esriCTDropdownObj"\x3e\r\n          \x3coption selected\x3d"selected" value\x3d"Interactive"\x3e${nls.interactiveLabel}\x3c/option\x3e\r\n          \x3coption value\x3d"Fixed"\x3e${nls.fixedLabel}\x3c/option\x3e\r\n          \x3coption value\x3d"Origin"\x3e${nls.originLabel}\x3c/option\x3e\r\n          \x3coption value\x3d"Cumulative"\x3e${nls.cumulativeLabel}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel data-dojo-attach-point\x3d\'rangeCenterLabel\'\x3e${nls.centerPointLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem"\x3e\r\n        \x3cdiv class\x3d"jimu-input coordInput" placeholder\x3d"${nls.startPointPlaceHolderLabel}"\r\n          data-dojo-attach-point\x3d"rangeCenter"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"controlItem paddedLeft"\x3e\r\n          \x3cdiv class\x3d\'add-with-icon\'\x3e\r\n            \x3cspan title\x3d"${nls.formatInputLabel}" class\x3d"jimu-icon settingBtn safariOnly"\r\n              data-dojo-attach-point\x3d"coordinateFormatButton" tabindex\x3d"0" role\x3d"button"\r\n              aria-label\x3d"${nls.formatInputLabel}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d\'add-with-icon\'\x3e\r\n            \x3cdiv title\x3d"${nls.addPointLabel}" class\x3d"drawPointBtn" data-dojo-attach-point\x3d"addPointBtn" tabindex\x3d"0"\r\n              role\x3d"button" aria-label\x3d"${nls.addPointLabel}"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup controlGroupHidden" data-dojo-attach-point\x3d"numRingsContainer"\x3e\r\n      \x3clabel\x3e${nls.numberOfRingsLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem" data-dojo-attach-point\x3d"numRingsDiv"\x3e\r\n        \x3cinput aria-label\x3d"${nls.numberOfRingsLabel}" data-dojo-attach-point\x3d"numRingsInput" type\x3d"text"\r\n          data-dojo-type\x3d"dijit/form/NumberTextBox" name\x3d"numRings" required\x3d"true" , value\x3d"5"\r\n          data-dojo-props\x3d"constraints:{min:1, max: 100, places: 0}" /\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup controlGroupHidden" data-dojo-attach-point\x3d"distancebetweenRingsContainer"\x3e\r\n      \x3clabel\x3e${nls.distanceBetweenRingsLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem" data-dojo-attach-point\x3d"ringIntervalDiv"\x3e\r\n        \x3cinput aria-label\x3d"${nls.distanceBetweenRingsLabel}" style\x3d"width: calc(100% - 108px);"\r\n          data-dojo-type\x3d"dijit/form/NumberTextBox" required\x3d"true" value\x3d"1000" data-dojo-props\x3d"constraints:{places: 2}"\r\n          data-dojo-attach-point\x3d"ringIntervalInput" /\x3e\r\n        \x3cselect aria-label\x3d"${nls.distanceBetweenRingsLabel}" data-dojo-attach-point\x3d"ringIntervalUnitsDD"\r\n          style\x3d"width: 100px;" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\r\n          \x3coption value\x3d"feet"\x3e${nls.units.feet}\x3c/option\x3e\r\n          \x3coption value\x3d"kilometers"\x3e${nls.units.kilometers}\x3c/option\x3e\r\n          \x3coption value\x3d"miles"\x3e${nls.units.miles}\x3c/option\x3e\r\n          \x3coption value\x3d"meters" selected\x3d"selected"\x3e${nls.units.meters}\x3c/option\x3e\r\n          \x3coption value\x3d"nautical-miles"\x3e${nls.units.nauticalMiles}\x3c/option\x3e\r\n          \x3coption value\x3d"yards"\x3e${nls.units.yards}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup" data-dojo-attach-point\x3d"distanceUnitsContainer"\x3e\r\n      \x3clabel\x3e${nls.distanceUnitsLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem"\x3e\r\n        \x3cselect aria-label\x3d"${nls.distanceUnitsLabel}" data-dojo-attach-point\x3d"distanceUnitsDD" style\x3d"width: 100%;"\r\n          data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\r\n          \x3coption value\x3d"feet"\x3e${nls.units.feet}\x3c/option\x3e\r\n          \x3coption value\x3d"kilometers"\x3e${nls.units.kilometers}\x3c/option\x3e\r\n          \x3coption value\x3d"miles"\x3e${nls.units.miles}\x3c/option\x3e\r\n          \x3coption value\x3d"meters" selected\x3d"selected"\x3e${nls.units.meters}\x3c/option\x3e\r\n          \x3coption value\x3d"nautical-miles"\x3e${nls.units.nauticalMiles}\x3c/option\x3e\r\n          \x3coption value\x3d"yards"\x3e${nls.units.yards}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup controlGroupHidden" data-dojo-attach-point\x3d"distanceTableContainer"\x3e\r\n      \x3cdiv class\x3d"add-with-icon" data-dojo-attach-point\x3d"btnAddDistance" tabindex\x3d"0" role\x3d"button"\r\n        aria-label\x3d"${nls.distancesLabel}"\x3e\r\n        \x3cspan class\x3d"jimu-icon jimu-icon-add" data-dojo-attach-point\x3d"btnAirframeIcon"\x3e\x3c/span\x3e\r\n        \x3cspan class\x3d"add-label"\x3e${nls.distancesLabel}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"distanceTable" style\x3d"width: 100%;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup" data-dojo-attach-point\x3d"numRadialsContainer"\x3e\r\n      \x3clabel\x3e${nls.numberOfRadialsLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"controlItem" data-dojo-attach-point\x3d"numRadialsInputDiv"\x3e\r\n        \x3cinput aria-label\x3d"${nls.numberOfRadialsLabel}" data-dojo-type\x3d"dijit/form/NumberTextBox" required\x3d"false"\r\n          value\x3d"3" data-dojo-props\x3d"constraints:{min: 0, max: 360, places: 0}" style\x3d"width: 100%;"\r\n          data-dojo-attach-point\x3d"numRadialsInput" /\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"controlGroup" data-dojo-attach-point\x3d\'symbologyControlDiv\'\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d\'symbolControl\' title\x3d"${nls.symbolAndLabelSettingsLabel}"\r\n        data-dojo-type\x3d"dijit/TitlePane" data-dojo-props\x3d"open: false"\x3e\r\n        \x3cdiv class\x3d"controlGroup" style\x3d"margin-top: 0px;"\x3e\r\n    \r\n          \x3cdiv class\x3d"controlItem esriCTPaddingBottom10"\x3e\r\n            \x3cdiv class\x3d"esriCTLabel"\x3e${nls.symbologyPreviewLabel}\x3c/div\x3e\r\n            \x3cdiv tabindex\x3d"0" class\x3d"esriCTSymbolNode" data-dojo-attach-point\x3d"ringSymbolNode"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n    \r\n          \x3cdiv class\x3d"controlItem esriCTPaddingBottom10 esriCTLabelSettings"\x3e\r\n            \x3cdiv class\x3d"esriCTLabel"\x3e${nls.ColorAndSizeLabel}\x3c/div\x3e\r\n            \x3cdiv style\x3d"margin-right:10px;" tabindex\x3d"0" aria-label\x3d"${nls.colorPickerLabel}"\r\n              data-dojo-attach-point\x3d"labelColorPickerNode"\x3e\x3c/div\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"labelTextSizeSpinner" aria-label\x3d"${nls.ColorAndSizeLabel}"\r\n              data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n              data-dojo-props\x3d\'value:12,smallDelta:1,constraints:{min:1, max:36, places: 0}\' type\x3d"text"\r\n              style\x3d"width: calc(100% - 185px)" required\x3d"true" /\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTHintCheck"\x3e${nls.editSymbologyHint}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"buttonContainer" data-dojo-attach-point\x3d"buttonContainer"\x3e\r\n      \x3cdiv class\x3d\'jimu-btn jimu-state-disabled\' data-dojo-attach-point\x3d\'okButton\' style\x3d"width: 49%;"\r\n        data-dojo-attach-event\x3d"onclick: okButtonClicked" aria-label\x3d"${nls.common.ok}" role\x3d"button"\x3e${nls.common.ok}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d\'jimu-btn\' tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearGraphicsLabel}" style\x3d"width: 49%;"\r\n        data-dojo-attach-point\x3d\'clearGraphicsButton\'\x3e${nls.clearGraphicsLabel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/dom-construct dojo/on dojo/dom-class dojo/topic dojo/has dojo/touch dojo/string dojo/mouse dojo/keys dojo/number dojo/dom-attr dijit/registry dijit/_WidgetBase dijit/_TemplatedMixin dijit/TooltipDialog dijit/popup dijit/form/NumberTextBox jimu/dijit/Message jimu/dijit/SimpleTable jimu/LayerInfos/LayerInfos jimu/utils dijit/_WidgetsInTemplateMixin dojo/text!../templates/TabRange.html esri/geometry/Circle esri/geometry/Polyline esri/geometry/Point esri/geometry/geometryEngine esri/graphic esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/layers/LabelClass esri/tasks/FeatureSet esri/symbols/TextSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol ../views/CoordinateInput ../views/EditOutputCoordinate ../models/RangeRingFeedback dijit/focus dojo/_base/event dojo/aspect dojo/DeferredList jimu/symbolUtils ../SymbolChooserPopup ../setting/js/ColorPickerEditor dojo/_base/Color jimu/dijit/formSelect jimu/dijit/CheckBox dijit/TitlePane".split(" "),
function(F,c,t,N,x,f,k,y,O,P,Q,A,h,B,C,G,R,S,T,p,U,H,V,I,z,W,X,u,v,Y,J,D,Z,aa,ba,ca,da,ea,K,fa,ha,ia,ja,l,m,ka,L,la,ma,na,oa){return F([R,S,W],{templateString:X,baseClass:"jimu-widget-TabRange",startPoint:null,firstDistance:!0,_restrictFocusOnAddCenterPointBtn:!1,_centerPointInputKeyPressed:!1,_gl:null,_tsGL:null,_setStartPointAttr:function(){this._set("startPoint")},_getStartPointAttr:function(){return this.startPoint},constructor:function(a){F.safeMixin(this,a);this._tsGL=this._gl=null},destroy:function(){this._gl&&
this.map.removeLayer(this._gl);this._tsGL&&this.map.removeLayer(this._tsGL);this.tabSwitched()},postCreate:function(){this._centerPointInputKeyPressed=this._restrictFocusOnAddCenterPointBtn=!1;this._ptSym=new fa(this.pointSymbol);this._circleSym=new ea(this.circleSymbol);this._lineSym=new K(this.lineSymbol);this._labelSym=new da(this.labelSymbol);this._tsGL=new Z;this.map.addLayer(this._tsGL);this.map.addLayer(this.getLayer());this._initDistanceTable();if(this._gl.loaded){var a=I.getInstanceSync().getLayerInfoById("Distance \x26 Direction - Range Graphics");
a.showLabels();a.enablePopup()}else this._gl.on("load",c.hitch(this,function(){var b=I.getInstanceSync().getLayerInfoById("Distance \x26 Direction - Range Graphics");b.showLabels();b.enablePopup()}));this.coordTool=new ha({appConfig:this.appConfig,nls:this.nls,"aria-label":this.nls.centerPointLabel},this.rangeCenter);this.coordTool.inputCoordinate.formatType="DD";this.coordinateFormat=new T({content:new ia({nls:this.nls}),style:"width: 400px"});ka.after(this.coordinateFormat,"onClose",c.hitch(this,
function(){l.focus(this.coordinateFormatButton);if(this._restrictFocusOnAddCenterPointBtn){var b=this.coordTool.getValue();if(""===b||null===b||void 0===b)this._restrictFocusOnAddCenterPointBtn=!1}}));"DartTheme"===this.appConfig.theme.name&&k.add(this.coordinateFormat.domNode,"dartThemeClaroDijitTooltipContainerOverride");this.dt=new ja({appConfig:this.appConfig,map:this.map,coordTool:this.coordTool.inputCoordinate.util,nls:this.nls,parentWidget:this});this.dt.setFillSymbol(this._circleSym);this.dt.set("lengthLayer",
this._lengthLayer);this._createSymbolPicker(this.ringSymbolNode,"rangeRingSymbol","esriGeometryPolyline",this.nls.ringSymbologyPopupTittle);this.labelColorPicker=this._createColorPicker(this.labelColorPickerNode);this._setColorPicker(this.labelSymbol.color);this.labelTextSizeSpinner.set("value",this.labelSymbol.font.size);this.syncEvents();this._distanceTable.addRow({});this.checkValidInputs();this.numRingsInput.invalidMessage=this.nls.ringsErrorMessage;this.numRingsInput.rangeMessage=this.nls.ringsErrorMessage;
this.numRadialsInput.invalidMessage=this.nls.radialsInvalidMessage;this.numRadialsInput.rangeMessage=this.nls.radialsErrorMessage;this.ringIntervalInput.set("invalidMessage",this.nls.ringsDecimalErrorMessage)},_initDistanceTable:function(){var a=[{name:"Value",title:this.nls.valueLabel,type:"extension","class":"label",create:c.hitch(this,this._createValueField),getValue:c.hitch(this,this._getValueFieldValue)},{name:"actions",title:this.nls.actionLabel,width:"65px",type:"actions",actions:["up","down",
"delete"],"class":"label"}];this._distanceTable=new V({fields:a,autoHeight:!0});this._distanceTable.placeAt(this.distanceTable);this._distanceTable.startup()},_createValueField:function(a){var b=new U({style:"height: 24px;",id:G.getUniqueId("ntb"),required:"true",placeHolder:this.nls.valueText,invalidMessage:this.nls.numericInvalidMessage,value:this.firstDistance?"":0,constraints:{places:2},"class":"numberTextBox","aria-label":this.nls.valueLabel});x.place(b.domNode,a);this.own(f(b,"focus",c.hitch(this,
function(){0===b.get("value")&&b.set("value","")})),f(b,"blur",c.hitch(this,function(){var d=this._distanceTable.getRows();t.forEach(d,c.hitch(this,function(e){!this._distanceTable.getRowData(e).Value.valid&&1<d.length&&this._distanceTable.deleteRow(e)}))})));b.focus();this.firstDistance=!1},_getValueFieldValue:function(a){a=G.byNode(a.childNodes[0]);return{value:a.get("value"),valid:a.isValid()}},getLayer:function(){if(!this._gl){var a=new ba({labelExpressionInfo:{value:"{Interval}"}});a.labelPlacement=
"center-end";a.symbol=this._labelSym;a={layerDefinition:{geometryType:"esriGeometryPolyline",extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,latestWkid:102100}},objectIdField:"ObjectID",fields:[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:"Interval",type:"esriFieldTypeString",alias:"Interval"}]},featureSet:new ca};this._gl=new aa(a,{id:"Distance \x26 Direction - Range Graphics",showLabels:!0});this.own(f(this._gl,"visibility-change",c.hitch(this,function(b){this._tsGL.setVisibility(b.visible)})))}return this._gl},
syncEvents:function(){y.subscribe("TAB_SWITCHED",c.hitch(this,this.tabSwitched));y.subscribe("DD-WIDGET-CLOSED",c.hitch(this,this._closeDijit));this.dt.watch("startPoint",c.hitch(this,function(a,b,d){this.dt.addStartGraphic(d,this._ptSym)}));this.dt.watch("startPointDD",c.hitch(this,function(a,b,d){this.coordTool.inputCoordinate.set("coordinateEsriGeometry",d)}));this.coordTool.inputCoordinate.watch("outputString",c.hitch(this,function(a,b,d){this.coordTool.manualInput||(this.coordTool.set("value",
d),this.currentRing=null,this._restrictFocusOnAddCenterPointBtn?this._restrictFocusOnAddCenterPointBtn=!1:this._centerPointInputKeyPressed?this._centerPointInputKeyPressed=!1:l.focus(this.addPointBtn))}));this.own(f(this.coordTool,"keydown",c.hitch(this,this.coordToolKeyWasPressed)),this.dt.on("draw-complete",c.hitch(this,this.feedbackDidComplete)),f(this.rangeType,"change",c.hitch(this,this.rangeTypeDropDownChanged)),f(this.ringIntervalUnitsDD,"change",c.hitch(this,this.ringIntervalUnitsDidChange)),
f(this.coordinateFormatButton,"click",c.hitch(this,this.coordinateFormatButtonWasClicked)),f(this.coordinateFormatButton,"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)m.stop(a),this.coordinateFormatButtonWasClicked()})),f(this.addPointBtn,"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)m.stop(a),this.pointButtonWasClicked()})),f(this.coordinateFormat.content.applyButton,"click",c.hitch(this,function(){this._restrictFocusOnAddCenterPointBtn=
!0;var a=this.coordinateFormat.content.formats[this.coordinateFormat.content.ct],b=a.defaultFormat,d=this.coordinateFormat.content.frmtSelect.get("value");a.useCustom&&(b=a.customFormat);this.coordTool.inputCoordinate.set("formatPrefix",this.coordinateFormat.content.addSignChkBox.checked);this.coordTool.inputCoordinate.set("formatString",b);this.coordTool.inputCoordinate.set("formatType",d);this.setCoordLabel(d);p.close(this.coordinateFormat);l.focus(this.coordinateFormatButton)})),f(this.coordinateFormat.content.applyButton,
"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE){m.stop(a);this._restrictFocusOnAddCenterPointBtn=!0;var b=this.coordinateFormat.content.formats[this.coordinateFormat.content.ct],d=b.defaultFormat,e=this.coordinateFormat.content.frmtSelect.get("value");b.useCustom&&(d=b.customFormat);this.coordTool.inputCoordinate.set("formatPrefix",this.coordinateFormat.content.addSignChkBox.checked);this.coordTool.inputCoordinate.set("formatString",d);this.coordTool.inputCoordinate.set("formatType",
e);this.setCoordLabel(e);p.close(this.coordinateFormat);l.focus(this.coordinateFormatButton)}a.keyCode===h.ESCAPE&&(m.stop(a),p.close(this.coordinateFormat),l.focus(this.coordinateFormatButton))})),f(this.coordinateFormat.content.cancelButton,"click",c.hitch(this,function(){p.close(this.coordinateFormat)})),f(this.coordinateFormat.content.cancelButton,"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)m.stop(a),p.close(this.coordinateFormat),l.focus(this.coordinateFormatButton);
a.keyCode===h.ESCAPE&&(m.stop(a),p.close(this.coordinateFormat),l.focus(this.coordinateFormatButton))})),f(this.clearGraphicsButton,"click",c.hitch(this,this.clearGraphics)),f(this.clearGraphicsButton,"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)m.stop(a),this.clearGraphics()})),f(this.numRingsDiv,A.leave,c.hitch(this,this.checkValidInputs)),f(this.ringIntervalDiv,A.leave,c.hitch(this,this.checkValidInputs)),f(this.numRadialsInputDiv,A.leave,c.hitch(this,this.checkValidInputs)),
f(this.btnAddDistance,"click",c.hitch(this,function(){var a=this._distanceTable.getRows(),b=!1;t.forEach(a,c.hitch(this,function(d){this._distanceTable.getRowData(d).Value.valid&&(b=!0)}));(b||0===a.length)&&this._distanceTable.addRow({})})),f(this.btnAddDistance,"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE){m.stop(a);a=this._distanceTable.getRows();var b=!1;t.forEach(a,c.hitch(this,function(d){this._distanceTable.getRowData(d).Value.valid&&(b=!0)}));b&&this._distanceTable.addRow({})}})),
f(this._distanceTable.tbody,"keyup",c.hitch(this,function(a){a.keyCode===h.ENTER&&this._distanceTable.addRow({})})),f(this.coordinateFormat.content.frmtSelect,"keydown",c.hitch(this,function(a){a.keyCode===h.ESCAPE&&(m.stop(a),p.close(this.coordinateFormat),l.focus(this.coordinateFormatButton))})),f(this.coordinateFormat.content.frmtVal,"keydown",c.hitch(this,function(a){a.keyCode===h.ESCAPE&&(m.stop(a),p.close(this.coordinateFormat),l.focus(this.coordinateFormatButton))})),f(this.coordinateFormat.content.addSignChkBox,
"keydown",c.hitch(this,function(a){a.keyCode===h.ESCAPE&&(m.stop(a),p.close(this.coordinateFormat),l.focus(this.coordinateFormatButton));a.keyCode===h.ENTER&&(m.stop(a),this.coordinateFormat.content.addSignChkBox.checked=this.coordinateFormat.content.addSignChkBox.checked?!1:!0)})),f(this.okButton,"keydown",c.hitch(this,function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)m.stop(a),this.okButtonClicked()})));O("esri-touch")?this.own(f(this.addPointBtn,P.press,c.hitch(this,this.pointButtonWasClicked))):
this.own(f(this.addPointBtn,"click",c.hitch(this,this.pointButtonWasClicked)));this.own(f(this.labelColorPicker,"colorChanged",c.hitch(this,function(a){"ring"===a&&(this._labelSym.color=this._getColorPicker())})));this.own(f(this.labelTextSizeSpinner,"change",c.hitch(this,function(){this._labelSym.font.size=this.labelTextSizeSpinner.getValue()})));this.own(f(this.labelColorPickerNode,"keydown",c.hitch(this,function(a){a.keyCode!==h.ENTER&&a.keyCode!==h.SPACE||this.labelColorPicker.colorPicker.domNode.click()})));
this.own(f(this.labelTextSizeSpinner,"blur",c.hitch(this,function(){this.labelTextSizeSpinner.isValid()||this.labelTextSizeSpinner.set("value",this.labelSymbol.font.size)})))},setCoordLabel:function(a){a=z.sanitizeHTML(Q.substitute(this.nls.centerPointLabel+" (${crdType})",{crdType:a}));this.rangeCenterLabel.innerHTML=a;C.set(this.coordTool.textbox,"aria-label",a)},rangeTypeDropDownChanged:function(){this.tabSwitched();switch(this.rangeType.get("value")){case "Interactive":k.add(this.numRingsContainer,
"controlGroupHidden");k.add(this.distancebetweenRingsContainer,"controlGroupHidden");k.add(this.distanceTableContainer,"controlGroupHidden");k.remove(this.distanceUnitsContainer,"controlGroupHidden");break;case "Fixed":k.remove(this.numRingsContainer,"controlGroupHidden");k.remove(this.distancebetweenRingsContainer,"controlGroupHidden");k.add(this.distanceUnitsContainer,"controlGroupHidden");k.add(this.distanceTableContainer,"controlGroupHidden");break;case "Origin":case "Cumulative":k.add(this.numRingsContainer,
"controlGroupHidden"),k.add(this.distancebetweenRingsContainer,"controlGroupHidden"),k.remove(this.distanceUnitsContainer,"controlGroupHidden"),k.remove(this.distanceTableContainer,"controlGroupHidden")}this.checkValidInputs()},coordToolKeyWasPressed:function(a){this.dt.removeStartGraphic();a.keyCode===h.ENTER&&(this._centerPointInputKeyPressed=this._restrictFocusOnAddCenterPointBtn=!0,this.coordTool.inputCoordinate.getInputType().then(c.hitch(this,function(b){"UNKNOWN"===b.inputType?(new H({message:this.nls.invalidCoordinateTypeMessage}),
this.coordTool.inputCoordinate.coordinateEsriGeometry=null,this.checkValidInputs()):this.dt.getProjectedGeometry(b.coordinateEsriGeometry,this.map.spatialReference).then(c.hitch(this,c.hitch(this,function(d){y.publish("manual-rangering-center-point-input",d);this.setCoordLabel(b.inputType);this.coordTool.inputCoordinate.set("formatString",this.coordinateFormat.content.formats[b.inputType].defaultFormat);this.coordTool.inputCoordinate.set("formatType",b.inputType);this.dt.addStartGraphic(d,this._ptSym);
this.checkValidInputs()})))})))},coordinateFormatButtonWasClicked:function(){this.coordinateFormat.content.set("ct",this.coordTool.inputCoordinate.formatType);p.open({popup:this.coordinateFormat,around:this.coordinateFormatButton});l.focus(this.coordinateFormat.content.frmtSelect.focusNode)},_closeDijit:function(){this.coordinateFormat&&this.coordinateFormat.domNode.offsetParent&&p.close(this.coordinateFormat)},pointButtonWasClicked:function(){k.contains(this.addPointBtn,"drawPointBtn-active")?(this.dt.deactivate(),
this._setMapNavigation(!0)):(this.coordTool.manualInput=!1,y.publish("clear-points"),this._setMapNavigation(!1),"Interactive"===this.rangeType.get("value")?this.dt.activate("polyline"):this.dt.activate("point"));k.toggle(this.addPointBtn,"drawPointBtn-active")},ringIntervalUnitsDidChange:function(){this.ringIntervalUnit=this.ringIntervalUnitsDD.get("value")},okButtonClicked:function(){if(!k.contains(this.okButton,"jimu-state-disabled")){if(!this.currentRing){this._restrictFocusOnAddCenterPointBtn=
!0;switch(this.rangeType.get("value")){case "Fixed":var a=this.ringIntervalInput.get("value");var b=this.numRingsInput.get("value");var d=this.ringIntervalUnitsDD.get("value");break;case "Origin":case "Cumulative":if(d=this.distanceUnitsDD.get("value"),this.checkTableValues())if(a=this._distanceTable.getRows(),"Origin"===this.rangeType.get("value"))a=t.map(a,c.hitch(this,function(g){return this._distanceTable.getRowData(g).Value.value}));else{var e=0;a=t.map(a,c.hitch(this,function(g){g=this._distanceTable.getRowData(g);
return e+=g.Value.value}))}else{new H({message:this.nls.distanceTableErrorMessage});return}}"Interactive"!==this.rangeType.get("value")&&(b={centerPoint:this.coordTool.inputCoordinate.coordinateEsriGeometry,numRings:b,numRadials:this.numRadialsInput.get("value"),radius:0,circle:null,circles:[],lastCircle:null,r:0,c:0,radials:0,ringInterval:a,ringIntervalUnitsDD:d,circleSym:this._circleSym},this.createRangeRings(b))}this.emit("show-publish",this._gl)}},checkTableValues:function(){return 0<this._distanceTable.getRows().length},
createRangeRings:function(a){if(a.centerPoint){if(a.ringInterval&&a.ringIntervalUnitsDD)if(a.ringInterval.constructor===Array)for(var b=0;b<a.ringInterval.length;b++)a.ringInterval[b]=this.coordTool.inputCoordinate.util.convertToMeters(parseFloat(a.ringInterval[b]),a.ringIntervalUnitsDD);else a.ringDistance=this.coordTool.inputCoordinate.util.convertToMeters(parseFloat(a.ringInterval),a.ringIntervalUnitsDD);this.dt.removeStartGraphic();if(0===a.circles.length)if(a.ringInterval&&a.ringInterval.constructor===
Array)for(b=0;b<a.ringInterval.length;b++)a.radius+=a.ringDistance,a.circle=new u({center:a.centerPoint,geodesic:!0,radius:a.ringInterval[b],numberOfPoints:360}),a.circles.push(a.circle);else for(a.r=0;a.r<a.numRings;a.r++)a.radius+=a.ringDistance,a.circle=new u({center:a.centerPoint,geodesic:!0,radius:a.radius,numberOfPoints:360}),a.circles.push(a.circle);var d=[];for(a.c=0;a.c<a.circles.length;a.c++)d.push(this.dt.getProjectedGeometry(new v({paths:[a.circles[a.c].rings[0]],spatialReference:a.centerPoint.spatialReference}),
this.map.spatialReference));(new L(d)).then(c.hitch(this,function(e){for(var g=a.ringIntervalUnitsDD,n=0;n<e.length;n++){var q=new v(e[n][1]),w=B.format(B.round(this.coordTool.inputCoordinate.util.convertMetersToUnits(a.circles[n].radius,g),2),{places:2,locale:N.locale});w=window.isRTL?this._getLengthAbbrevation(this.distanceUnitsDD.get("value"))+" "+w:w+" "+this._getLengthAbbrevation(this.distanceUnitsDD.get("value"));var M=new D(q,this._lineSym,{ObjectID:this._gl.graphics.length+1,Interval:w,CenterPoint:this.coordTool.get("value"),
Rings:parseFloat(a.circles.length),Radials:parseFloat(this.numRadialsInput.get("value")),RadiusDistance:parseFloat(B.round(this.coordTool.inputCoordinate.util.convertMetersToUnits(a.circles[n].radius,g),2)),RadiusUnit:"Fixed"===this.rangeType.get("value")?this.ringIntervalUnitsDD.get("value"):this.distanceUnitsDD.get("value")});this._gl.add(M);this._currentRangeGraphic=M;q=new Y(q.paths[0][0][0],q.paths[0][0][1],this.map.spatialReference);this._tsGL.add(new D(q,c.clone(this._labelSym).setText(w).setOffset(0,
10)))}for(e=a.largestRadius=0;e<a.circles.length;e++)a.circles[e].radius>a.largestRadius&&(a.largestRadius=a.circles[e].radius);d=[];if(0!==a.numRadials){e=new u({center:a.centerPoint,geodesic:!0,radius:a.largestRadius,numberOfPoints:a.numRadials});for(g=0;g<e.rings[0].length-1;g++)n=new v(a.centerPoint.spatialReference),n.addPath([c.clone(a.centerPoint),e.getPoint(0,g)]),n=new v(J.geodesicDensify(n,1E4),a.centerPoint.spatialReference),d.push(this.dt.getProjectedGeometry(n,this.map.spatialReference));
0<d.length&&(new L(d)).then(c.hitch(this,function(r){for(var E=0;E<r.length;E++)this._gl.add(new D(r[E][1],this._lineSym,{ObjectID:this._gl.graphics.length+1,Interval:"",CenterPoint:this.coordTool.get("value")}));this._gl.redraw()}),function(r){console.log(r)});this.currentRing=e=new u({center:a.centerPoint,geodesic:!0,radius:a.largestRadius,numberOfPoints:60});this.dt.getProjectedGeometry(e.getExtent(),this.map.spatialReference).then(c.hitch(this,function(r){this.checkValidInputs();this.map.setExtent(r.expand(3))}))}}))}},
feedbackDidComplete:function(a){var b=null;if(a.geometry.hasOwnProperty("circlePoints")){b=a.geometry.circlePoints[0];var d={centerPoint:b,numRadials:this.numRadialsInput.get("value"),circles:[],circleSym:this._circleSym,r:0,c:0,radials:0,ringIntervalUnitsDD:this.distanceUnitsDD.get("value"),intervalUnits:this.distanceUnitsDD.get("value")};if(a.geometry.circlePoints&&1<a.geometry.circlePoints.length){var e=a.geometry.circlePoints.length;var g=a.geometry.circlePoints;g[e-1].x===g[e-2].x&&g[e-1].y===
g[e-2].y&&g.splice(e-1,1)}for(e=1;e<a.geometry.circlePoints.length;e++)g=new v(a.geometry.spatialReference),g.addPath([b,a.geometry.circlePoints[e]]),g=J.geodesicLength(g,9001),g=new u({center:b,geodesic:!0,radius:g,numberOfPoints:360}),d.circles.push(g);this.createRangeRings(d)}else b=a.geometry,this.checkValidInputs();k.remove(this.addPointBtn,"drawPointBtn-active");this.dt.deactivate();this._setMapNavigation(!0)},clearGraphics:function(){this._gl&&(this._tsGL.clear(),this._gl.clear(),this._gl.refresh(),
this.dt.removeStartGraphic(),this.coordTool.clear());this.tabSwitched();this.checkValidInputs();for(var a=0;a<this.map.graphicsLayerIds.length;a++)this.map.getLayer(this.map.graphicsLayerIds[a]).refresh()},setGraphicsHidden:function(){this._gl&&this._gl.hide()},setGraphicsShown:function(){this._gl&&this._gl.show()},checkValidInputs:function(){k.add(this.okButton,"jimu-state-disabled");C.set(this.okButton,"tabindex",-1);null!==this.coordTool.inputCoordinate.coordinateEsriGeometry&&this.numRingsInput.isValid()&&
this.ringIntervalInput.isValid()&&this.numRadialsInput.isValid()&&(k.remove(this.okButton,"jimu-state-disabled"),C.set(this.okButton,"tabindex",0));this.okButton.innerHTML="Interactive"===this.rangeType.getValue()?this.nls.publishDDBtn:this.nls.common.ok},tabSwitched:function(){this.dt&&(this.dt.deactivate(),this.dt.cleanup(),this.dt.disconnectOnMouseMoveHandlers());this._setMapNavigation(!0);this.dt&&this.dt.removeStartGraphic();this.addPointBtn&&k.remove(this.addPointBtn,"drawPointBtn-active");
this.coordinateFormat&&p.close(this.coordinateFormat)},_setMapNavigation:function(a){a?this.map.enableMapNavigation():(this.map.disableMapNavigation(),this.map.enableScrollWheelZoom())},_getLengthAbbrevation:function(a){var b=null;if(a)switch(a){case "feet":b=this.nls.abbrevFeetLabel;break;case "kilometers":b=this.nls.abbrevKmLabel;break;case "miles":b=this.nls.abbrevMilesLabel;break;case "meters":b=this.nls.abbrevMetersLabel;break;case "nautical-miles":b=this.nls.abbrevNauticalMilesLabel;break;case "yards":b=
this.nls.abbrevYardsLabel;break;default:b=a}return b},_getDegreeAbbreviation:function(a){var b=null;if(a)switch(a){case "degrees":b=this.nls.abbrevDegreesLabel;break;case "mils":b=this.nls.abbrevMilsLabel;break;default:b=a}return b},setFirstFocusNode:function(){z.initFirstFocusNode(this.domNodeObj,this.rangeType.domNode)},focusFirstNodeOfSelectedTab:function(){l.focus(this.rangeType.focusNode)},setLastFocusNode:function(){z.initLastFocusNode(this.domNodeObj,this.clearGraphicsButton)},_createSymbolPicker:function(a,
b,d,e){if(d){var g={};g.type=z.getSymbolTypeByGeometryType(d);this.hasOwnProperty("_lineSym")&&(g.symbol=this._lineSym);var n={symbolChooserTitle:e,symbolParams:g,nls:this.nls,symbolType:b};this._showSelectedSymbol(a,g.symbol);this.own(f(a,"click",c.hitch(this,function(){g.symbol=this._lineSym;this._initSymbolChooserPopup(n,a);l.focus(this.ringSymbolNode)})));this.own(f(a,"keydown",c.hitch(this,function(q){if(q.keyCode===h.ENTER||q.keyCode===h.SPACE)g.symbol=this._lineSym,this._initSymbolChooserPopup(n,
a),l.focus(this.ringSymbolNode)})))}},_initSymbolChooserPopup:function(a,b){var d=new ma(a);d.onOkClick=c.hitch(this,function(){var e=d.symbolChooser.getSymbol();this._showSelectedSymbol(b,e);d.popup.close()})},_showSelectedSymbol:function(a,b){x.empty(a);if(b){var d=la.createSymbolNode(b);d||(d=x.create("div"));x.place(d,a);this._lineSym=new K(b.toJson())}},_createColorPicker:function(a){var b=new na({nls:this.nls,tab:"ring"});b.placeAt(a);b.startup();return b},_getColorPicker:function(){return this.labelColorPicker.getValues()},
_setColorPicker:function(a){this.labelColorPicker.setValues({color:new oa(a)})}})});