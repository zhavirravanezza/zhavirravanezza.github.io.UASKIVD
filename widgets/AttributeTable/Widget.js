// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(F,p,G,K,D){return p("dijit.layout.TabContainer",G,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(M){var t=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?F.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":t,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},M)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?K:D)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(F,p,G,K,D,M,t,E){return F("dijit.layout._TabContainerBase",[D,t],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:E,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&K.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
p.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(p.add(this.domNode,"dijitTabContainerNested"),p.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),p.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),p.add(this.containerNode,"dijitTabPaneWrapperNested")):p.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(J){p.add(J.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(J){p.remove(J.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var J=this.selectedChildWidget;if(this.doLayout){var L=this.tabPosition.replace(/-h/,"");this.tablist.region=L;L=[this.tablist,{domNode:this.tablistSpacer,region:L},{domNode:this.containerNode,region:"center"}];M.layoutChildren(this.domNode,this._contentBox,L);this._containerContentBox=M.marginBox2contentBox(this.containerNode,L[2]);J&&
J.resize&&J.resize(this._containerContentBox)}else{if(this.tablist.resize){L=this.tablist.domNode.style;L.width="0";var R=G.getContentBox(this.domNode).w;L.width="";this.tablist.resize({w:R})}J&&J.resize&&J.resize()}}},destroy:function(J){this.tablist&&this.tablist.destroy(J);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(F,p,G,K,D,M,t,E,J,L,R,g,d,q){M("dijit-legacy-requires")&&J(0,function(){require(["dijit/layout/StackController"])});G=G("dijit.layout.StackContainer",q,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);K.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(E(this.domNode,"keydown",t.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var b=this.getChildren();F.forEach(b,this._setupChild,
this);this.persist?this.selectedChildWidget=g.byId(p(this.id+"_selectedChild")):F.some(b,function(e){e.selected&&(this.selectedChildWidget=e);return e.selected},this);var k=this.selectedChildWidget;!k&&b[0]&&(k=this.selectedChildWidget=b[0],k.selected=!0);L.publish(this.id+"-startup",{children:b,selected:k,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var b=this.selectedChildWidget;b&&this._showChild(b)}this.inherited(arguments)},
_setupChild:function(b){var k=b.domNode,e=D.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",b.domNode,"replace"),m=b["aria-label"]||b.title||b.label;m&&e.setAttribute("aria-label",m);D.place(k,e);b._wrapper=e;this.inherited(arguments);"none"==k.style.display&&(k.style.display="block");b.domNode.removeAttribute("title")},addChild:function(b,k){this.inherited(arguments);this._started&&(L.publish(this.id+"-addChild",b,k),this.layout(),this.selectedChildWidget||
this.selectChild(b))},removeChild:function(b){var k=F.indexOf(this.getChildren(),b);this.inherited(arguments);D.destroy(b._wrapper);delete b._wrapper;this._started&&L.publish(this.id+"-removeChild",b);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===b&&(this.selectedChildWidget=void 0,this._started)){var e=this.getChildren();e.length&&this.selectChild(e[Math.max(k-1,0)])}this._started&&this.layout()}},selectChild:function(b,k){b=g.byId(b);if(this.selectedChildWidget!=b){var e=this._transition(b,
this.selectedChildWidget,k);this._set("selectedChildWidget",b);L.publish(this.id+"-selectChild",b,this._focused);this.persist&&p(this.id+"_selectedChild",this.selectedChildWidget.id)}return R(e||!0)},_transition:function(b,k){k&&this._hideChild(k);k=this._showChild(b);b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize());return k},_adjacent:function(b){var k=this.getChildren(),e=F.indexOf(k,this.selectedChildWidget);e+=b?1:k.length-1;return k[e%k.length]},forward:function(){return this.selectChild(this._adjacent(!0),
!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(b){L.publish(this.id+"-containerKeyDown",{e:b,page:this})},layout:function(){var b=this.selectedChildWidget;b&&b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize())},_showChild:function(b){var k=this.getChildren();b.isFirstChild=b==k[0];b.isLastChild=b==k[k.length-1];b._set("selected",!0);b._wrapper&&K.replace(b._wrapper,"dijitVisible","dijitHidden");return b._onShow&&b._onShow()||
!0},_hideChild:function(b){b._set("selected",!1);b._wrapper&&K.replace(b._wrapper,"dijitHidden","dijitVisible");b.onHide&&b.onHide()},closeChild:function(b){if(!b.onClose||b.onClose(this,b))this.removeChild(b),b.destroyRecursive()},destroyDescendants:function(b){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;F.forEach(this.getChildren(),function(k){b||this.removeChild(k);k.destroyRecursive(b)},this);this._descendantsBeingDestroyed=!1}});G.ChildWidgetProperties={selected:!1,disabled:!1,
closable:!1,iconClass:"dijitNoIcon",showTitle:!0};t.extend(d,G.ChildWidgetProperties);return G})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(F,p,G,K,D,M,t,E,J,L,R,g){g=F("dijit.layout._TabButton"+(D("dojo-bidi")?"_NoBidi":""),E.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},
templateString:g,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);p.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var d=this.domNode;this.defer(function(){d.className=d.className},1)},_setCloseButtonAttr:function(d){this._set("closeButton",d);K.toggle(this.domNode,"dijitClosable",d);this.closeNode.style.display=d?"":"none";d&&(d=M.getLocalization("dijit","common"),this.closeNode&&G.set(this.closeNode,"title",d.itemClose))},
_setDisabledAttr:function(d){this.inherited(arguments);if(this.closeNode)if(d)G.remove(this.closeNode,"title");else{var q=M.getLocalization("dijit","common");G.set(this.closeNode,"title",q.itemClose)}},_setLabelAttr:function(d){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=t.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});D("dojo-bidi")&&(g=F("dijit.layout._TabButton",g,{_setLabelAttr:function(d){this.inherited(arguments);this.applyTextDir(this.iconNode,
this.iconNode.alt)}}));F=F("dijit.layout.TabController",E,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:g,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var d=new L({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(k){return K.contains(k,
"dijitClosable")&&!K.contains(k,"dijitTabDisabled")}});this.own(d);var q=M.getLocalization("dijit","common"),b=this;d.addChild(new R({label:q.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(k){k=J.byNode(this.getParent().currentTarget);b.onCloseButtonClick(k.page)}}))}});F.TabButton=g;return F})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(F,p,G,K,D,M,t,E,J,L,R,g,d,q){K=p("dijit.layout._StackButton",q,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(b){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});p=p("dijit.layout.StackController",[R,g,d],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:K,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(b){return L.byId(this.id+
"_"+b)},postCreate:function(){this.inherited(arguments);this.own(E.subscribe(this.containerId+"-startup",M.hitch(this,"onStartup")),E.subscribe(this.containerId+"-addChild",M.hitch(this,"onAddChild")),E.subscribe(this.containerId+"-removeChild",M.hitch(this,"onRemoveChild")),E.subscribe(this.containerId+"-selectChild",M.hitch(this,"onSelectChild")),E.subscribe(this.containerId+"-containerKeyDown",M.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(t(this.containerNode,"click",
M.hitch(this,function(b){var k=L.getEnclosingWidget(b.target);if(k!=this.containerNode&&!k.disabled&&k.page)for(b=b.target;b!==this.containerNode;b=b.parentNode)if(G.contains(b,this.buttonWidgetCloseClass)){this.onCloseButtonClick(k.page);break}else if(b==k.domNode){this.onButtonClick(k.page);break}})))},onStartup:function(b){this.textDir=b.textDir;F.forEach(b.children,this.onAddChild,this);if(b.selected)this.onSelectChild(b.selected);var k=L.byId(this.containerId).containerNode,e=M.hitch(this,"pane2button");
b={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var m=function(n,h){return t(k,"attrmodified-"+n,function(y){var B=e(y.detail&&y.detail.widget&&y.detail.widget.id);B&&B.set(h,y.detail.newValue)})},x;for(x in b)this.own(m(x,b[x]))},destroy:function(b){this.destroyDescendants(b);this.inherited(arguments)},onAddChild:function(b,k){var e=new (M.isString(this.buttonWidget)?M.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+b.id,name:this.id+"_"+b.id,label:b.title,disabled:b.disabled,ownerDocument:this.ownerDocument,dir:b.dir,lang:b.lang,textDir:b.textDir||this.textDir,showLabel:b.showTitle,iconClass:b.iconClass,closeButton:b.closable,title:b.tooltip,page:b});this.addChild(e,k);b.controlButton=e;if(!this._currentChild)this.onSelectChild(b);k=b._wrapper.getAttribute("aria-labelledby")?b._wrapper.getAttribute("aria-labelledby")+" "+e.id:e.id;b._wrapper.removeAttribute("aria-label");b._wrapper.setAttribute("aria-labelledby",
k)},onRemoveChild:function(b){this._currentChild===b&&(this._currentChild=null);var k=this.pane2button(b.id);k&&(this.removeChild(k),k.destroy());delete b.controlButton},onSelectChild:function(b){if(b){if(this._currentChild){var k=this.pane2button(this._currentChild.id);k.set("checked",!1);k.focusNode.setAttribute("tabIndex","-1")}k=this.pane2button(b.id);k.set("checked",!0);this._currentChild=b;k.focusNode.setAttribute("tabIndex","0");L.byId(this.containerId)}},onButtonClick:function(b){var k=this.pane2button(b.id);
J.focus(k.focusNode);this._currentChild&&this._currentChild.id===b.id&&k.set("checked",!0);L.byId(this.containerId).selectChild(b)},onCloseButtonClick:function(b){L.byId(this.containerId).closeChild(b);this._currentChild&&(b=this.pane2button(this._currentChild.id))&&J.focus(b.focusNode||b.domNode)},adjacent:function(b){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(b=!b);var k=this.getChildren(),e=F.indexOf(k,this.pane2button(this._currentChild.id)),m=k[e];do{e=(e+
(b?1:k.length-1))%k.length;var x=k[e]}while(x.disabled&&x!=m);return x},onkeydown:function(b,k){if(!this.disabled&&!b.altKey&&(k=null,b.ctrlKey||!b._djpage)){switch(b.keyCode){case D.LEFT_ARROW:case D.UP_ARROW:b._djpage||(k=!1);break;case D.PAGE_UP:b.ctrlKey&&(k=!1);break;case D.RIGHT_ARROW:case D.DOWN_ARROW:b._djpage||(k=!0);break;case D.PAGE_DOWN:b.ctrlKey&&(k=!0);break;case D.HOME:for(var e=this.getChildren(),m=0;m<e.length;m++){var x=e[m];if(!x.disabled){this.onButtonClick(x.page);break}}b.stopPropagation();
b.preventDefault();break;case D.END:e=this.getChildren();for(m=e.length-1;0<=m;m--)if(x=e[m],!x.disabled){this.onButtonClick(x.page);break}b.stopPropagation();b.preventDefault();break;case D.DELETE:case 87:this._currentChild.closable&&(b.keyCode==D.DELETE||b.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),b.stopPropagation(),b.preventDefault());break;case D.TAB:b.ctrlKey&&(this.onButtonClick(this.adjacent(!b.shiftKey).page),b.stopPropagation(),b.preventDefault())}null!==k&&(this.onButtonClick(this.adjacent(k).page),
b.stopPropagation(),b.preventDefault())}},onContainerKeyDown:function(b){b.e._djpage=b.page;this.onkeydown(b.e)}});p.StackButton=K;return p})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(F,p,G,K,D,M,t,E,J,L,R,g,d,q,b,k,e,m,x,n){g=p("dijit.layout.ScrollingTabController",[q,k],{baseClass:"dijitTabController dijitScrollingTabController",templateString:g,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var h=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",G.add(h,"tabStrip-disabled"));G.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);D.set(this.domNode,"visibility","");this._postStartup=!0;this.own(E(this.containerNode,"attrmodified-label, attrmodified-iconclass",t.hitch(this,function(h){this._dim&&this.resize(this._dim)})))},onAddChild:function(h,y){this.inherited(arguments);D.set(this.containerNode,"width",D.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(h,y){var B=this.pane2button(h.id);this._selectedTab===B.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=J("\x3e .tabStripButton",this.domNode).filter(function(h){if(this.useMenu&&h==this._menuBtn.domNode||this.useSlider&&(h==this._rightBtn.domNode||h==this._leftBtn.domNode))return this._btnWidth+=K.getMarginSize(h).w,!0;D.set(h,"display","none");return!1},this)},_getTabsWidth:function(){var h=this.getChildren();
if(h.length){var y=h[this.isLeftToRight()?0:h.length-1].domNode;h=h[this.isLeftToRight()?h.length-1:0].domNode;return h.offsetLeft+h.offsetWidth-y.offsetLeft}return 0},_enableBtn:function(h){var y=this._getTabsWidth();h=h||D.get(this.scrollNode,"width");return 0<y&&h<y},resize:function(h){this._dim=h;this.scrollNode.style.height="auto";var y=this._contentBox=b.marginBox2contentBox(this.domNode,{h:0,w:h.w});y.h=this.scrollNode.offsetHeight;K.setContentSize(this.domNode,y);y=this._enableBtn(this._contentBox.w);
this._buttons.style("display",y?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";b.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:h.w}},_getScroll:function(){return this.isLeftToRight()||8>L("ie")||L("trident")&&L("quirks")||L("webkit")?this.scrollNode.scrollLeft:D.get(this.containerNode,"width")-D.get(this.scrollNode,"width")+(L("trident")||L("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(h){if(this.isLeftToRight()||8>L("ie")||L("trident")&&L("quirks")||L("webkit"))return h;var y=D.get(this.containerNode,"width")-D.get(this.scrollNode,"width");return(L("trident")||
L("edge")?-1:1)*(h-y)},onSelectChild:function(h,y){var B=this.pane2button(h.id);if(B){var O=B.domNode;if(O!=this._selectedTab&&(this._selectedTab=O,this._postResize)){var a=this._getScroll();a>O.offsetLeft||a+D.get(this.scrollNode,"width")<O.offsetLeft+D.get(O,"width")?(O=this.createSmoothScroll(),y&&(O.onEnd=function(){B.focus()}),O.play()):y&&B.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var h=this.getChildren(),y=D.get(this.scrollNode,"width"),B=D.get(this.containerNode,"width")-
y,O=this._getTabsWidth();if(h.length&&O>y)return{min:this.isLeftToRight()?0:h[h.length-1].domNode.offsetLeft,max:this.isLeftToRight()?h[h.length-1].domNode.offsetLeft+h[h.length-1].domNode.offsetWidth-y:B};h=this.isLeftToRight()?0:B;return{min:h,max:h}},_getScrollForSelectedTab:function(){var h=this._selectedTab,y=D.get(this.scrollNode,"width"),B=this._getScrollBounds();h=h.offsetLeft+D.get(h,"width")/2-y/2;return h=Math.min(Math.max(h,B.min),B.max)},createSmoothScroll:function(h){if(0<arguments.length){var y=
this._getScrollBounds();h=Math.min(Math.max(h,y.min),y.max)}else h=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var B=this,O=this.scrollNode,a=new M.Animation({beforeBegin:function(){this.curve&&delete this.curve;var r=O.scrollLeft,v=B._convertToScrollLeft(h);a.curve=new M._Line(r,v)},onAnimate:function(r){O.scrollLeft=r}});this._anim=a;this._setButtonClass(h);return a},_getBtnNode:function(h){for(h=h.target;h&&!G.contains(h,"tabStripButton");)h=h.parentNode;
return h},doSlideRight:function(h){this.doSlide(1,this._getBtnNode(h))},doSlideLeft:function(h){this.doSlide(-1,this._getBtnNode(h))},doSlide:function(h,y){y&&G.contains(y,"dijitTabDisabled")||(h*=.75*D.get(this.scrollNode,"width"),h=this._getScroll()+h,this._setButtonClass(h),this.createSmoothScroll(h).play())},_setButtonClass:function(h){var y=this._getScrollBounds();this._leftBtn.set("disabled",h<=y.min);this._rightBtn.set("disabled",h>=y.max)}});d=p("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:d,tabIndex:"",isFocusable:function(){return!1}});p("dijit.layout._ScrollingTabControllerButton",[x,d]);p("dijit.layout._ScrollingTabControllerMenuButton",[x,n,d],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(h){this.dropDown=new e({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var y=R.byId(this.containerId);F.forEach(y.getChildren(),function(B){var O=
new m({id:B.id+"_stcMi",label:B.title,iconClass:B.iconClass,disabled:B.disabled,ownerDocument:this.ownerDocument,dir:B.dir,lang:B.lang,textDir:B.textDir||y.textDir,onClick:function(){y.selectChild(B)}});this.dropDown.addChild(O)},this);h()},closeDropDown:function(h){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return g})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable jimu/utils ./utils jimu/LayerInfos/LayerInfos".split(" "),
function(F,p,G,K,D,M,t,E,J,L,R){return F(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,parent:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,relationshipInfoMapping:{},constructor:function(g){this.widgetId=g&&g.widgetId;this.map=g&&g.map;this.nls=g&&g.nls;this.parent=g&&g.parent;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet=
{};this.relationshipTableSet={};this.currentRelationshipKey=null;this.relationshipInfoMapping={}},setConfig:function(g){this.config=p.clone(g||{})},setMap:function(g){this.map=g},updateLayerInfoResources:function(g){var d=new K;L.readConfigLayerInfosFromMap(this.map,!1,!0).then(p.hitch(this,function(q){this._layerInfosFromMap=q;this._processDelayedLayerInfos();g&&(0===this.config.layerInfos.length?(q=L.getConfigInfosFromLayerInfos(q),this.config.layerInfos=G.filter(q,function(b){return b.show})):
this.config.layerInfos=G.filter(p.delegate(this.config.layerInfos),p.hitch(this,function(b){var k=this._getLayerInfoById(b.id),e=this.config.syncWithLayers?k.isVisible():b.show;e&&k&&(b.name=k.name||k.title,b.show=e);return e&&k})));d.resolve()}),function(q){d.reject(q)});return d},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return p.clone(this.config.layerInfos)},addLayerInfo:function(g){0===this._layerInfosFromMap.length?
this._delayedLayerInfos.push(g):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(g.id)&&this._layerInfosFromMap.push(g)},addConfigInfo:function(g){this._getConfigInfoById(g.id)||(g=L.getConfigInfoFromLayerInfo(g),this.config.layerInfos.push({id:g.id,name:g.name,layer:{url:g.layer.url,fields:g.layer.fields}}))},removeLayerInfo:function(g){g=this._getLayerInfoById(g);g=this._layerInfosFromMap.indexOf(g);this._layerInfosFromMap.splice(g,1)},removeConfigInfo:function(g){if(p.getObject("config.layerInfos",
!1,this))for(var d=this.config.layerInfos.length,q=0;q<d;q++)if(this.config.layerInfos[q].id===g){this.featureTableSet[g]&&(this.featureTableSet[g].destroy(),delete this.featureTableSet[g]);this.config.layerInfos.splice(q,1);break}},getQueryTable:function(g,d,q,b){var k=new K;this._activeLayerInfoId=g;this.featureTableSet[g]?k.resolve({isSupportQuery:!0,table:this.featureTableSet[g]}):this._getQueryTableInfo(g).then(p.hitch(this,function(e){if(e){var m=e.layerInfo,x=e.layerObject;e=e.tableInfo;if(this.featureTableSet[g])k.resolve({isSupportQuery:e.isSupportQuery,
table:this.featureTableSet[g]});else if(p.getObject("isSupportQuery",!1,e)){var n=this._getConfigInfoById(g);n||(this.addConfigInfo(m),n=this._getConfigInfoById(g));var h=p.getObject("layer.fields",!1,n);x=x&&x.fields;x=L.arcade.appendArcadeExpressionsToFields(x,m);n.layer.fields=this._clipValidFields(h,x);m=new E({widgetId:this.widgetId,map:this.map,matchingMap:d,hideExportButton:q,allowTextSelection:b,layerInfo:m,configedInfo:n,nls:this.nls,parent:this.parent});m.onFeatureSelectionChange=p.hitch(this,
function(){var y={},B;for(B in this.featureTableSet)this.featureTableSet[B]&&(y[B]=this.featureTableSet[B].selectionRows||[]);this.onFeatureSelectionChange(y)});this.featureTableSet[g]=m;k.resolve({isSupportQuery:e.isSupportQuery,table:m})}else k.resolve({isSupportQuery:!1})}else k.resolve(null)}),function(e){k.reject(e)});return k},getRelationTable:function(g,d,q,b,k){var e=new K,m=this.relationshipsSet[d];this._activeRelationshipKey=d;if(m){var x=this._getLayerInfoById(g);g=this.getRelationShipInfo(m);
this.getQueryTable(g.id,q,b,k).then(p.hitch(this,function(n){if(n&&n.table){var h=n.table;J.isEqual(h.relationship,m)||(h.set("prevRelationship",h.relationship),h.set("relationship",m));h.set("relatedOriginalInfo",x)}e.resolve(n)}),p.hitch(function(){e.resolve(null)}))}else e.resolve(null);return e},removeRelationTable:function(g){this.relationshipTableSet[g]&&(this.relationshipTableSet[g].destroy(),this.relationshipTableSet[g]=null)},getCurrentTable:function(g){return this.featureTableSet[g]||this.relationshipTableSet[g]},
collectRelationShips:function(g,d){this._collectRelationShips(g,g.layerObject,d)},getConfigInfoById:function(g){return this._getConfigInfoById(g)},getLayerInfoById:function(g){return this._getLayerInfoById(g)},getVisivleLayerInfoIndexById:function(g){return this._getVisivleLayerInfoIndexById(g)},getRelationshipsByInfoId:function(g){var d=[],q;for(q in this.relationshipsSet){var b=this.relationshipsSet[q];b._layerInfoId===g&&d.push(b)}return d},getRelationShipInfo:function(g){var d;if(g)for(var q in this.relationshipInfoMapping)g._relKey===
q&&(d=this.relationshipInfoMapping[q]);return d},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var g in this.relationshipsSet)this._removeRelationShipInfo(this.relationshipsSet[g]);this.relationshipsSet={};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(G.forEach(this._delayedLayerInfos,p.hitch(this,function(g){!this._getLayerInfoById(g&&
g.id)&&this.map&&this.map.getLayer(g.id)&&this._layerInfosFromMap.push(g)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(g){for(var d=0,q=this._layerInfosFromMap.length;d<q;d++)if(this._layerInfosFromMap[d]&&this._layerInfosFromMap[d].id===g)return this._layerInfosFromMap[d]},_getVisivleLayerInfoIndexById:function(g){for(var d=-1,q=0,b=this._layerInfosFromMap.length;q<b;q++)if(this._layerInfosFromMap[q]&&this._layerInfosFromMap[q].isShowInMap()&&(d++,this._layerInfosFromMap[q].id===g))return d},
_getConfigInfoById:function(g){if(!p.getObject("layerInfos.length",!1,this.config))return null;for(var d=0,q=this.config.layerInfos.length;d<q;d++){var b=this.config.layerInfos[d];if(b&&b.id===g)return b}return null},_getQueryTableInfo:function(g){var d=new K,q=this._getLayerInfoById(g);if(q){var b=[],k=q.getUrl();b.push(q.getLayerObject());b.push(q.getSupportTableInfo());k&&b.push(q.getRelatedTableInfoArray());D(b).then(p.hitch(this,function(e){if(this._activeLayerInfoId===g&&e){var m=e[0],x=e[1];
e=k?e[2]:[];M.isDefined(e)&&M.isDefined(m)&&0<e.length&&this._collectRelationShips(q,m,e);d.resolve({layerInfo:q,layerObject:m,tableInfo:x})}else d.resolve(null)}),function(e){d.reject(e)})}else console.error("no activeLayerInfo!"),d.reject(Error());return d},_collectRelationShips:function(g,d,q){var b=d.relationships;if(b&&0<b.length&&d&&d.url){var k=d.url.split("/");G.forEach(b,p.hitch(this,function(e){k[k.length-1]=e.relatedTableId;var m=k.join("/"),x=G.filter(q,p.hitch(this,function(h){h=h.getUrl();
return M.isDefined(h)&&M.isDefined(m)&&t.removeProtocol(h.toString().toLowerCase())===t.removeProtocol(m.toString().toLowerCase())})),n=g.id+"_"+e.name+"_"+e.id;e._relKey=n;e._layerInfoId=g.id;x&&0<x.length&&this._setRelationShipInfo(e,x[0]);this.relationshipsSet[n]||(this.relationshipsSet[n]=e,this.relationshipsSet[n].objectIdField=d.objectIdField)}))}},_setRelationShipInfo:function(g,d){g&&"_relKey"in g&&(this.relationshipInfoMapping[g._relKey]=d)},_removeRelationShipInfo:function(g){if(g&&"_relKey"in
g)for(var d in this.relationshipInfoMapping)g._relKey===d&&delete this.relationshipInfoMapping[d]},_getLayerInfoLabel:function(g){return g.name||g.title},_getLayerInfoId:function(g){return g&&g.id||""},_clipValidFields:function(g,d){if(!g||!g.length)return d||[];if(!d||!d.length)return g;for(var q=[],b=[],k=0,e=d.length;k<e;k++){for(var m=d[k],x=0,n=g.length;x<n;x++){var h=g[x];if(h.name===m.name)break}x===n&&b.push(m)}k=0;for(e=g.length;k<e;k++)for(h=g[k],x=0,n=d.length;x<n;x++)if(m=d[x],m.name===
h.name){q.push(h);break}q=q.concat(b);0===q.length&&0<g.length&&(g=p.clone(d),G.forEach(g,p.hitch(this,function(y){"esriFieldTypeGeometry"!==y.type&&(y.show=!0,q.push(y))})));return q}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dgrid/Keyboard dijit/Menu dijit/MenuItem dijit/PopupMenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/dijit/Popup jimu/dijit/CheckBox jimu/SelectionManager jimu/CSVUtils jimu/utils jimu/ArcadeUtils ../utils dojo/query dojo/string dojo/topic dojo/keys dojo/has".split(" "),
function(F,p,G,K,D,M,t,E,J,L,R,g,d,q,b,k,e,m,x,n,h,y,B,O,a,r,v,C,I,T,Q,P,U,V,Z,ca,ha,z,Y,ta,W,qa,ra,fa,ea,ia,da,ja,ma,ka,sa,wa,va,oa,ua){return F([G,y],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",parent:null,map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,
_dblClickResult:null,actived:!1,showSelected:!1,tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,_normalizedExtent:null,GRID_FAR_OFF_REMOVAL:{DEFAULT:2E3,RESELECTION:Infinity,INFINITY:Infinity},constructor:function(c){c=c||{};this.set("parent",c.parent||null);this.set("map",c.map||null);this.set("matchingMap",!!c.matchingMap);this.set("layerInfo",c.layerInfo||null);this.set("layer",c.layer||null);this.set("configedInfo",c.configedInfo||null);this.set("relatedOriginalInfo",
c.relatedOriginalInfo||null);this.set("relationship",c.relationship||null);this.set("prevRelationship",null);this.set("syncSelection",!!c.syncSelection||!0)},postCreate:function(){this.inherited(arguments);this._relatedQueryIds=[];this.createToolbar();this.loading=new qa;this.loading.placeAt(this.domNode);this.selectionManager=ia.getInstance();this._selectionResults=[];this.selectionRows=[];this._normalizedExtent=null;p.setAttr(this.domNode,"data-layerinfoid",z.getObject("layerInfo.id",!1,this));
this.get("map")&&(this.own(Y(this.map.root,B.release,z.hitch(this,function(){this._clickMap=!0}))),this.own(Y(this.map,"extent-change",z.hitch(this,"_onExtentChange"))));this.own(Y(window,"resize",z.hitch(this,this._resize)));this.layerInfo&&this.own(Y(this.layerInfo,"filterChanged",z.hitch(this,this._handleFilterChange)))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(p.getStyle(this.toolbar.domNode,"height"),10)||0},setLayerDefinition:function(c){this._layerDefinition=
c},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var c=z.clone(this._layerDefinition);return this._getFilterableFields(c.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},setFilterObj:function(c){this._filterObj=c},showRefreshing:function(c){c?this._toggleLoading(!0):this._toggleLoading(!1)},active:function(){this.actived=!0},deactive:function(){this.actived=
!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var c=new b({},p.create("div")),f=new e;this.showSelectedRecordsMenuItem=new d({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:z.hitch(this,this.toggleSelectedRecords)});f.addChild(this.showSelectedRecordsMenuItem);
var l=this.layerInfo&&this.layerInfo.layerObject&&this.layerInfo.layerObject.relationships,u=new g;this.showRelatedRecordsMenuItem=new q({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",popup:u});if(l&&0<l.length){var w=W.map(l,z.hitch(this,function(A){return this.parent&&this.parent.getRelationShipInfo(A)}));W.forEach(l,z.hitch(this,function(A){var N=this.parent&&this.parent.getRelationShipInfo(A),S=0;N&&(W.some(w,function(H){H&&H.name===N.name&&S++;if(1<S)return!1}),
u.addChild(new d({label:N.name+(1<S?A&&'\x3cbr\x3e\x3cspan style\x3d"opacity: 0.4"\x3e\x26lpar;'+A.name+"\x26rpar;\x3c/span\x3e":""),onClick:z.hitch(this,this.onShowRelatedRecordsClick,A)})))}))}f.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new d({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:z.hitch(this,this.onFilterMenuItemClick)});f.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new d({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",
onClick:z.hitch(this,this.onToggleColumnsClick)});f.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new d({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:z.hitch(this,this.onExportCSVClick)}),f.addChild(this.exportCSVMenuItem));this.selectionMenu=new x({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:f});c.addChild(this.selectionMenu);this.matchingCheckBox=new m({checked:this.matchingMap?!0:!1,
showLabel:!0,label:this.nls.filterByExtent,onChange:z.hitch(this,function(A){this.set("matchingMap",A);this._onMatchingCheckBoxChange(A)})});c.addChild(this.matchingCheckBox);this.zoomButton=new k({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:z.hitch(this,this.zoomTo)});c.addChild(this.zoomButton);this.clearSelectionButton=new k({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:z.hitch(this,this.clearSelection,!0,!0)});c.addChild(this.clearSelectionButton);
this.refreshButton=new k({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:z.hitch(this,this.refresh)});c.addChild(this.refreshButton);p.place(c.domNode,this.domNode);this.toolbar=c;this.own(Y(this,"data-loaded,row-click,clear-selection",z.hitch(this,"changeToolbarStatus")));this.parent&&va.publish(this.parent.id+"_toolbar_created",{toolbar:this.toolbar,context:this})},startQuery:function(c){this.cancelThread();this._requestStatus="processing";this._toggleLoading();
c&&c.length?this.queryByStoreObjectIds=c:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=this._getLayerObject();this._currentDef.then(z.hitch(this,function(f){this.domNode&&(this.layer=f,(f=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&f.spatialReference&&f.spatialReference.isWebMercator()?(this._currentDef=ca.normalizeCentralMeridian([f],null,z.hitch(this,function(l){return l[0]}))).then(z.hitch(this,function(l){this._doQuery(l,
c);this._normalizedExtent=l}),z.hitch(this,function(l){l&&"Request canceled"!==l.message&&console.error(l);this.changeToolbarStatus();this._toggleLoading(!1)})):this._doQuery(f,c))}),z.hitch(this,function(f){console.error(f);this.changeToolbarStatus();this._toggleLoading(!1)}))},queryRecordsByRelationship:function(c){var f=c&&c.layer,l=c&&c.selectedIds;c&&c.relationship&&(this.set("prevRelationship",this.relationship),this.set("relationship",c.relationship));c&&c.relatedOriginalInfo&&this.set("relatedOriginalInfo",
c.relatedOriginalInfo);var u=this.relationship;c=this.prevRelationship;f&&u&&l&&0<l.length&&(!ja.isEqual(this._relatedQueryIds,l)||!ja.isEqual(u,c))&&z.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this._toggleLoading(!0),this._requestStatus="processing",this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(z.hitch(this,function(w){if(this.domNode){this.layer=w;var A=[],N=this.layer;W.forEach(N.fields,
function(S){r.isDefined(S.show)&&!0!==S.show&&!("esriFieldTypeOID"===S.type||r.isDefined(N.objectIdField)&&S.name===N.objectIdField)||ka.arcade.isArcadeExpressionField(S)||A.push(S.name)});w=new I;w.objectIds=l;w.outFields=A.length?A:["*"];w.relationshipId=u.id;w.returnGeometry="esriGeometryPoint"===this.layer.geometryType;(this._currentDef=f.queryRelatedFeatures(w,function(S){return S})).then(z.hitch(this,function(S){if(this.domNode){var H={displayFieldName:u.objectIdField,fields:N.fields,features:[],
fieldAliases:null},X={},ba=function(na){var pa=na.attributes[this.layer.objectIdField];X[pa]||(X[pa]=!0,H.features.push(na))},aa;for(aa in S){var la=S[aa];W.forEach(la&&la.features,ba,this)}p.destroy(this.tipNode);0<H.features.length?(this.grid||(this._removeTable(),p.place(this.loading.domNode,this.domNode)),S=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(S,H.features.length,!1,H)):(this.tipNode=p.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),
p.place(this.tipNode,this.domNode),p.place(this.loading.domNode,this.domNode));this._relatedQueryIds=l;this.emit("data-loaded");this._toggleLoading(!1)}}),z.hitch(this,function(S){S&&"Request canceled"!==S.message&&console.error(S);p.destroy(this.tipNode);this.tipNode=p.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");this._removeTable();p.place(this.tipNode,this.domNode);p.place(this.loading.domNode,this.domNode);this._toggleLoading(!1);this.changeToolbarStatus()}))}}),z.hitch(this,
function(w){console.error(w);this._toggleLoading(!1);this.changeToolbarStatus()}))):this._toggleLoading(!1)},getSelectedRows:function(){return this.tableCreated?this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",
this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},
onShowRelatedRecordsClick:function(c){var f=this.getSelectedRows();0<f.length?this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:f,relationshipObj:c}):this._getFeatureIds(this.layer&&this.layer.objectIdField,this.matchingMap&&this._normalizedExtent).then(z.hitch(this,function(l){console.log(l);this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:l,relationshipObj:c})}))},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(z.hitch(this,
function(c){if(this.domNode){c=z.clone(c);var f=this.getFilterableFields();c.fields=f;var l=new D({widgetId:this.widgetId,noFilterTip:this.nls.noFilterTip,style:"width:100%;",featureLayerId:this.layerInfo.id,runtime:!0});f=this._getFilterPopupSize();this._filterPopup=new fa({titleLabel:this.nls.filter,width:f.w,height:f.h,content:l,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:z.hitch(this,function(){var u=l.toJson();u&&u.expr?(this.setFilterObj(u),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),
this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:u.expr})):new K({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});l.startup();p.addClass(this._filterPopup.domNode,"widget-at-filter-popup");f=this.getFilterObj();l.build({url:this.layer.url,partsObj:f,layerDefinition:this.layer||c,featureLayerId:this.layer.id})}}),z.hitch(this,function(c){this.domNode&&console.error(c)})).always(z.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",
{layerInfoId:this.layerInfo.id})},_getFilterPopupSize:function(){var c={w:720,h:485};window.appInfo.isRunInMobile&&(c={w:window.innerWidth,h:window.innerHeight});return c},_resize:function(){if(this._filterPopup){var c=this._getFilterPopupSize();this._filterPopup.resize(c)}},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var c=this._getRichTextFields(),f=this._getExportCSVPopupMessage(c),l=new K({"class":this.baseClass+
"-popup",message:f,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:z.hitch(this,function(){var u=f._check;l.domNode&&(l.domNode.className+=" is-loading",(new qa).placeAt(l.domNode));this.exportToCSV(null,"undefined"===typeof u||u.checked?null:c).then(function(){l.close()},function(w){console.error("Error exporting CSV for Attribute Table");l.close()})})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},_getExportCSVPopupMessage:function(c){var f=
document.createElement("div");f.className="message-wrapper";f.appendChild(document.createTextNode(this.nls.exportMessage));if(c.length){var l=document.createElement("div");l.className="input-row";var u=new ea({label:this.nls.keepRichTextLabel,checked:!0}),w=document.createElement("a");w.className="hint-button";w.href="#";w.role="button";w.appendChild(document.createTextNode(this.nls.whatsThis));l.appendChild(u.domNode);l.appendChild(w);f.appendChild(l);f._check=u;this.own(Y(w,"click",z.hitch(this,
function(A){A.preventDefault();A={"class":this.baseClass+"-popup",message:this._getRichTextMessage(c)};window.appInfo.isRunInMobile||(A.width=500);new K(A)})))}return f},_getRichTextMessage:function(c){if(!c||c.hasOwnProperty("length")&&!c.length)return"";for(var f=document.createElement("div"),l="",u=0,w=c.length;u<w;u++)l+="\x3cmark\x3e"+c[u].fieldName+"\x3c/mark\x3e";c="\x3cp\x3e"+wa.substitute(this.nls.richTextMessage.explanatoryText.line1,{layerName:"\x3cstrong\x3e"+this.layer.name+"\x3c/strong\x3e"})+
"\x3c/p\x3e";c=c+('\x3cdiv class\x3d"tags"\x3e'+l+"\x3c/div\x3e\x3cp\x3e")+(this.nls.richTextMessage.explanatoryText.line2+"\x3c/p\x3e\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line3+"\x3c/p\x3e\x3ch3\x3e"+this.nls.richTextMessage.example.label+'\x3c/h3\x3e\x3cdiv class\x3d"example-block"\x3e\x3cpre\x3e\x3cu\x3eArcGIS\x3c/u\x3e \x3cfont color\x3d"#31aacd"\x3eWeb AppBuilder\x3c/font\x3e\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.first+'\x3cpre\x3e\x26ltu\x26gtArcGIS\x26lt/u\x26gt \x26ltfont color\x3d"#31aacd"\x26gtWeb AppBuilder\x26lt/font\x26gt\x3c/pre\x3e'+
this.nls.richTextMessage.example.scenarios.second+"\x3cpre\x3eArcGIS Web AppBuilder\x3c/pre\x3e\x3c/div\x3e");f.innerHTML=c;return f},_getRichTextFields:function(){var c=this.layerInfo&&this.layerInfo.getPopupInfo&&this.layerInfo.getPopupInfo();c=c&&c.fieldInfos;var f=[];if(c)for(var l=0,u=c.length;l<u;l++){var w=c[l];w.stringFieldOption&&"richtext"===w.stringFieldOption&&f.push(w)}return f},onSelectionComplete:function(){var c=this.layer&&this.layer.getSelectedFeatures();c&&(0===c.length?this.clearSelection(!1,
0<this._selectionResults.length):this._selectBySelf(c)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(c)))},onSelectionClear:function(){this.clearSelection(!1,!0);this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.DEFAULT)},changeToolbarStatus:function(){if(this.tableCreated){var c=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords);this.tableCreated&&c&&
0<c.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&c&&0===c.length&&this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",!0);if(this.layerInfo&&this.isSupportQueryToServer()&&
this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var f=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=f;f.then(z.hitch(this,function(l){this.domNode&&this.tableCreated&&l&&0<l.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}))}this.tableCreated&&this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",!0);this.matchingCheckBox.set("disabled",
!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(c&&0<c.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",!0));this.layerInfo.isShowInMap()?this.tableCreated&&c&&0<c.length?this.zoomButton.set("disabled",!1):this.zoomButton.set("disabled",!0):
this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",!0),this.toggleColumnsMenuItem.set("disabled",
!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var c=this.layer.objectIdField,f=this.getSelectedRows();0<f.length&&this.grid&&(this.grid.store instanceof O?this.grid.set("query",z.hitch(this,function(l){return"number"===typeof l&&-1<f.indexOf(l)||-1<f.indexOf(l[c])?!0:!1})):this.grid.set("query",function(){return f}))}},showAllSelectedRecords:function(){if(this.tableCreated&&this.showSelected){this.grid.set("query",
{});var c=this.getSelectedRows();this._updateSelectRowsByIds(c)}},clearSelection:function(c,f){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],c&&this.grid.set("query",{}),f&&(this._selectionResults=[],this.layer&&0<this.layer.getSelectedFeatures().length&&this.selectionManager.clearSelection(this.layer)),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},refresh:function(){this.grid&&this.grid.clearSelection();this._relatedQuery||
this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(c,f){if(!this.layerInfo||!this.layer||!this.tableCreated){var l=new n;l.reject();return l}return this.getSelectedRowsData().then(z.hitch(this,function(u){var w=this.layer.objectIdField,A=[],N=this.layer.fullExtent.spatialReference.equals(this.map.extent.spatialReference),S=this._hasArcadeExpressionFields(),H=ka.getSortbyFields(this.grid,this.layer);if(N||!this.layer.url){var X=W.map(this._getTableSelectedIds(),
z.hitch(this,function(na){for(var pa=0,xa=u.length;pa<xa;pa++)if(u[pa]&&u[pa][w]===na)return u[pa];return{}}))||[];0===X.length&&this.isSelectionMode()&&X.push({});A=X;0===X.length&&this.grid.store instanceof O&&(A={},H&&H instanceof Array&&(A.sort=W.map(H,function(na){na=na.split(/ +/);return{attribute:na[0],descending:"DESC"===na[1]}})),A=z.clone(this.grid.store.query({},A)));A.length&&this._appendXY(A)}var ba=this._getTableSelectedIds(),aa=this.parent&&this.parent.tabContainer.selectedChildWidget.params.viewInTableFlag;
X=[];if(ba=!A.length&&aa&&!ba.length)X=z.clone(this.grid.store.data),!N&&this.layer.url||!X.length||this._appendXY(X);aa={};var la=this.getOutFields(!!A.length);aa.datas=ba?X:A;aa.fromClient=!1;aa.withGeometry="esriGeometryPoint"===this.layer.geometryType;aa.outFields=la;aa.formatNumber=!1;aa.formatDate=!0;aa.formatCodedValue=!0;aa.popupInfo=this.layerInfo.getPopupInfo();aa.objectIds=!N&&0<this.getSelectedRows().length&&this._getExportObjectIds();aa.outSpatialReference=!N&&z.clone(this.layer.fullExtent.spatialReference);
aa.richTextFieldsToClear=f;S&&(aa.arcadeExpressions={expressionInfos:this.layerInfo.getPopupInfo().expressionInfos,layerDefinition:ja.getFeatureLayerDefinition(this.layer)});aa.orderByFields=H;if(!aa.objectIds||aa.objectIds instanceof Array&&0===aa.objectIds.length)this.matchingMap&&this.layerInfo&&!this.layerInfo.isTable&&(aa.geometry=this._currentExtent),aa.start=0,aa.num=this.layer.maxRecordCount||1E3,aa.filterExpression=this.layerInfo.getFilter&&this.layerInfo.getFilter();return da.exportCSVFromFeatureLayer(c||
this.configedInfo.name,this.layer,aa)}))},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(c){this.grid&&0<=c-this.toolbarHeight-this.footerHeight&&p.setStyle(this.grid.domNode,"height",c-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var c=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,f=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&
!c&&!f},isSupportQueryOnClient:function(){var c=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,f=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||c||f},destroy:function(){this._destroyed||(this.layer=this.configedInfo=this.layerInfo=null,this._selectionHandles&&W.forEach(this._selectionHandles,function(c){c&&c.remove&&c.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),
this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.prevRelationship=this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),this.inherited(arguments))},_selectBySelf:function(c){c=c||[];if(c.length!==this._selectionResults.length)return!1;var f=this.layer.objectIdField;return W.every(this._selectionResults,
function(l){return c.some(function(u){return l.attributes[f]===u.attributes[f]})})},_updateSelectRowsByFeatures:function(c){var f=W.map(c,z.hitch(this,function(l){return l.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(f);this._selectionResults=c},_updateSelectRowsByIds:function(c){this.grid&&this.tableCreated&&(this.selectionRows=c,W.forEach(c,z.hitch(this,function(f){this.grid.select(f)})),this.setSelectedNumber(),this.changeToolbarStatus())},_removeTable:function(){this.grid&&
this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(p.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(c){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&this.tableCreated&&this._relatedQuery)if(c)this.queryByStoreObjectIds=W.map(this.grid.store.data,z.hitch(this,function(l){return l[this.layer.objectIdField]})),
this.startQuery(this.queryByStoreObjectIds);else{var f=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:f})}c||(this._currentExtent=null)},_closePopup:function(){var c=this.map.infoWindow.getSelectedFeature(),f=c&&this._dblClickResult&&c===this._dblClickResult;c=c&&c._layer===this.layer;this.domNode&&(f||c)&&(this.map.infoWindow.hide(),this._dblClickResult=null)},_getLayerObject:function(){function c(f){this._selectionHandles&&
W.forEach(this._selectionHandles,function(l){l&&l.remove&&l.remove()});this._selectionHandles=[];this._selectionHandles.push(Y(f,"selection-complete",z.hitch(this,"onSelectionComplete")));this._selectionHandles.push(Y(f,"selection-clear",z.hitch(this,"onSelectionClear")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(z.hitch(this,function(f){var l=new n;"esri.layers.ArcGISImageServiceLayer"===f.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===f.declaredClass?(f=new T(f.url),
this.own(Y(f,"load",z.hitch(this,function(u){z.hitch(this,c)(u.layer);l.resolve(u.layer)})))):(z.hitch(this,c)(f),l.resolve(f));return l}))},_getLayerDifinition:function(){return this._layerDefinition?h(z.clone(this._layerDefinition)):v({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(z.hitch(this,function(c){this.setLayerDefinition(c);return this.getLayerDefinition()}))},_getFilterableFields:function(c,f){return W.filter(c,function(l){return W.some(f,function(u){return l.name===
u.name&&(u.show||!r.isDefined(u.show))&&z.mixin(l,u)})})},_getExportObjectIds:function(){var c=this._getTableSelectedIds()||[];if(0===c.length&&this.grid.store instanceof O){var f=this.layer.objectIdField;this.grid.store.query(function(l){c.push(l[f])})}return c},_doQuery:function(c,f){if(this.layer){var l=this.layer.objectIdField;this.isSupportQueryToServer()?this._queryToServer(c,l,f):this.isSupportQueryOnClient()&&this._queryOnClient(c,l,f)}},_queryOnClient:function(c,f,l){var u={};u.features=
"esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():W.filter(this.layer.graphics,z.hitch(this,function(H){return!H.wabIsTemp}));l&&0<l.length&&(u.features=W.filter(u.features,function(H){return-1<l.indexOf(H.attributes[this.layer.objectIdField])},this));var w=this.layer.fields,A=this.configedInfo.layer.fields;u.fields=A?W.filter(A,z.hitch(this,function(H){r.isDefined(H.show)||(H.show=!0);H.name!==f||"esriFieldTypeOID"!==H.type&&"esriFieldTypeInteger"!==H.type||
(H._pk=!0);for(var X=0,ba=w.length;X<ba;X++)w[X].name!==H.name||H.type||(H.type=w[X].type);return H.show||H._pk})):W.filter(w,z.hitch(this,function(H){r.isDefined(H.show)||(H.show=!0);H.name!==f||"esriFieldTypeOID"!==H.type&&"esriFieldTypeInteger"!==H.type||(H._pk=!0);return H.show||H._pk}));A=[];for(var N=u.features.length,S=0;S<N;S++)u&&u.features&&u.features[S]&&u.features[S].geometry&&A.push(u.features[S].geometry);c&&a.defaults.geometryService&&0<A.length?c.spatialReference.equals(A[0].spatialReference)?
(u.features=W.filter(u.features,z.hitch(this,function(H){if(H&&H.geometry)return Z.intersects(c,H.geometry)})),this.queryExecute(u.fields,u.features.length,!1,u,c)):(N=new C,N.geometries1=A,N.geometries2=[c],N.relation=C.SPATIAL_REL_INTERSECTION,(this._currentDef=a.defaults.geometryService.relation(N,z.hitch(this,function(H){return H}))).then(z.hitch(this,function(H,X){for(var ba=X.length,aa=[],la=0;la<ba;la++)aa.push(H.features[X[la].geometry1Index]);H.features=aa;this.queryExecute(H.fields,H.features.length,
!1,H,c)},u),z.hitch(this,function(H){H&&"Request canceled"!==H.message&&console.error(H);this.changeToolbarStatus();this._toggleLoading(!1)}))):this.queryExecute(u.fields,u.features.length,!1,u,c)},_queryToServer:function(c,f,l){this._getFeatureCount(c,l).then(z.hitch(this,function(u){if(this.domNode)if(l)this._queryFeatureLayer(c,f,u,!1,l);else{var w=this.layer,A=r.isDefined(w.maxRecordCount)?w.maxRecordCount:1E3;this._batchCount=Math.min(A,this._defaultBatchCount);if(u<=A||!this.layer.objectIdField)this._queryFeatureLayer(c,
f,u,!1);else{var N=this._getOutFieldsFromLayerInfos(f),S={fields:this.layer.fields};this.layer._recordCounts=u;w.advancedQueryCapabilities&&w.advancedQueryCapabilities.supportsPagination?this.queryExecute(N,u,!0,S,c):this._getFeatureIds(f,c).then(z.hitch(this,function(H){this.domNode&&(this.layer._objectIds=H,this.queryExecute(N,u,!0,S,c))}),z.hitch(this,function(H){console.error(H);this.changeToolbarStatus()}))}}}),z.hitch(this,function(u){console.error(u);this.changeToolbarStatus()}))},_getFeatureCount:function(c,
f){var l=new n,u=new Q(this.configedInfo.layer.url),w=new P;w.returnGeometry=!1;w.where=this._getLayerFilterExpression();f&&(w.where+=" AND "+this.layer.objectIdField+" IN ("+f.join()+")");c&&(w.geometry=c);(this._currentDef=u.executeForCount(w,z.hitch(this,function(A){return A}))).then(z.hitch(this,function(A){l.resolve(A)}),z.hitch(this,function(A){A&&"Request canceled"!==A.message&&(console.error(A),console.log("Could not get feature count."));this._toggleLoading(!1);l.reject(A)}));return l},_queryFeatureLayer:function(c,
f,l,u,w){var A=new Q(this.configedInfo.layer.url),N=new P;N.where=this._getLayerFilterExpression();w&&f&&(N.where+=" AND "+f+" IN ("+w.join()+")");var S=this._getOutFieldsFromLayerInfos(f),H=(w=this._hasArcadeExpressionFields())&&this._hasArcadeExpressionWithGeometry();if(0<S.length&&!w){var X=[];W.forEach(S,function(ba){X.push(ba.name)});N.outFields=X}else N.outFields=["*"];c&&(N.geometry=c,N.spatialRelationship=P.SPATIAL_REL_INTERSECTS);N.outSpatialReference=z.clone(this.map.spatialReference);N.returnGeometry=
"esriGeometryPoint"===this.layer.geometryType||H;f&&(N.orderByFields=[f+" ASC"]);(this._currentDef=A.execute(N,z.hitch(this,function(ba){return ba}))).then(z.hitch(this,function(ba){this.queryExecute(S,l,u,ba,c)}),z.hitch(this,function(ba){ba&&"Request canceled"!==ba.message&&console.error(ba);this.changeToolbarStatus();this._toggleLoading(!1)}))},_getFeatureIds:function(c,f){var l=new n,u=new Q(this.configedInfo.layer.url),w=new P;w.returnGeometry=!1;w.returnIdsOnly=!0;w.where=this._getLayerFilterExpression();
if(this.layer._orderByFields||c)w.orderByFields=this.layer._orderByFields||[c+" ASC"];f&&(w.geometry=f);(this._currentDef=u.executeForIds(w,z.hitch(this,function(A){return A}))).then(z.hitch(this,function(A){l.resolve(A)}),z.hitch(this,function(A){A&&"Request canceled"!==A.message&&(console.error(A),console.log("Could not get feature Ids"));l.resolve([])}));return l},queryExecute:function(c,f,l,u,w){var A=[];A=null;var N={};if(this.domNode){u.fields=this._processExecuteFields(this.layer.fields,c);
l?A=ka.generateCacheStore(this.layer,f,this._batchCount,this._getLayerFilterExpression(),w):(A=W.map(u.features,z.hitch(this,function(aa){var la=z.clone(aa.attributes);return z.mixin(la,{geometry:aa.geometry})})),A=ka.generateMemoryStore(A,this.layer.objectIdField));c=this.layer.typeIdField;N=this.layer.types;var S=z.getObject("advancedQueryCapabilities.supportsOrderBy",!1,this.layer),H=z.getObject("advancedQueryCapabilities.supportsPagination",!1,this.layer),X=z.getObject("advancedQueryCapabilities.supportsStatistics",
!1,this.layer),ba=ka.arcade.getExpressionInfosFromLayerInfo(this.layerInfo);ba=ma.compileExpressions(ba);N=ka.generateColumnsFromFields(this.grid&&this.grid.columns,this.map,this.layerInfo,ba,u.fields,c,N,S&&H||!l,X,this.layer);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(N.attachmentsColumn=this.formatAttachmentsColumn());l=20+100*u.fields.length<p.getMarginBox(this.domNode).w;this.createTable(N,A,f,l);f=this.grid.domNode.querySelectorAll(".dgrid-header .dgrid-column-selectionHandle");
0<f.length&&f[0].setAttribute("role","presentation");this._currentExtent=w;w=this.layer.getSelectedFeatures();this.selectionRows&&0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):w&&0<w.length?this._updateSelectRowsByFeatures(w):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var c={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,
statistics:!1}};c.renderCell=z.hitch(this,function(f,l,u){var w=f[this.layer.objectIdField];this.layer.queryAttachmentInfos(w,z.hitch(this,function(A){var N=W.map(A,z.hitch(this,function(H){var X=H.name&&/\.(png|jpg|jpeg|gif)$/gi.test(H.name)?"image-type":"file-type",ba=ha.findCredential(this.layer.url);return'\x3cli class\x3d"'+X+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+w+"/attachments/"+H.id+(ba?"?token\x3d"+ba.token:""))+'"\x3e'+H.name+"\x3c/a\x3e\x3c/li\x3e"})),
S="";0<A.length&&(S=" "+this.nls.files);S='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+A.length+S+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+N.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+N.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";
S=p.toDom(S);0<A.length&&(A=sa(".show-attachments-div",S)[0],p.addClass(A,"has-attachments"));u.appendChild(S);this.own(Y(u,"click",z.hitch(this,function(H){H=H&&H.target;if(p.hasClass(H,"show-attachments-div")||p.hasClass(H,"show-attachments")||p.hasClass(H,"close")){H=this._visibleAttachmentPopup;var X=sa(".attachment-popup",u)[0];X&&0<N.length&&p.toggleClass(X,"show");p.hasClass(X,"show")?this._visibleAttachmentPopup=X:this._visibleAttachmentPopup=null;H&&H!==X&&p.toggleClass(H,"show")}})))}),
z.hitch(this,function(A){console.error(A)}))});return c},createTable:function(c,f,l,u){if(this.grid)this.grid.set("store",f),this.grid.set("columns",c),this.grid.refresh();else{var w={},A=new qa;p.setStyle(A.domNode,"max-width","100vw");w.columns=c;w.store=f;w.keepScrollPosition=!0;w.farOffRemoval=this.GRID_FAR_OFF_REMOVAL.DEFAULT;ua("chrome")||(w.pagingDelay=1E3);w.allowTextSelection=this.allowTextSelection;w.deselectOnRefresh=!1;w.loadingMessage=A.domNode&&A.domNode.outerHTML;this.layer.objectIdField||
(w.minRowsPerPage=this.layer.maxRecordCount||1E3,w.maxRowsPerPage=this.layer.maxRecordCount||1E3,w.selectionMode="none");this.grid=new (F([M,t,E,J,L,R]))(w,p.create("div"));p.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&p.destroy(this.tipNode);this.own(Y(this.ownerDocument,"keydown",z.hitch(this,function(N){this.allowTextSelection&&this.grid&&this.grid.allowTextSelection&&N.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(Y(this.ownerDocument,"keyup",z.hitch(this,
function(){this.allowTextSelection&&this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.own(Y(this.ownerDocument,"keydown",z.hitch(this,function(N){this.tableCreated&&(N.keyCode===oa.SHIFT||(ua("mac")?N.keyCode===oa.META:N.keyCode===oa.CTRL)&&this.isSelectionMode())&&(this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.INFINITY),Y.once(this.ownerDocument,"keyup",z.hitch(this,function(S){!this.tableCreated||S.keyCode!==oa.SHIFT&&(ua("mac")?S.keyCode!==oa.META:S.keyCode!==
oa.CTRL)||(this.isSelectionMode()?this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.RESELECTION):this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.DEFAULT))})))})));this.layer.objectIdField&&(this.own(Y(this.grid,".dgrid-header .dgrid-cell:click",z.hitch(this,this._onHeaderClick))),this.own(Y(this.grid,"dgrid-columnstatechange",z.hitch(this,this._onColumnStateChange))),this.own(Y(this.grid,".selection-handle-column:click",z.hitch(this,this._onSelectionHandleClick)),Y(this.grid,".selection-handle-column:keydown",
z.hitch(this,function(N){N.keyCode!==oa.ENTER&&N.keyCode!==oa.SPACE||this._onSelectionHandleClick()}))),this.own(Y(this.grid,".dgrid-row:dblclick",z.hitch(this,this._onDblclickRow)),Y(this.grid,"dgrid-sort",z.hitch(this,function(N){this.emit("sort",N)})),Y(this.grid,"dgrid-refresh-complete",z.hitch(this,function(N){this.parent&&va.publish(this.parent.id+"_table_created",{grid:N.grid,context:this})}))),c=this.map.getLayer(this.layer.id),this.syncSelection&&c&&this.own(Y(c,"click",z.hitch(this,this._onFeaturelayerClick))))}this.grid.get("sort")[0]||
(this.configedInfo&&this.configedInfo.sortField?this.grid.set("sort",this.configedInfo.sortField,this.configedInfo.isDescending):this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1));this.getParent()&&(c=sa(".dgrid-scroller",this.grid.domNode)[0],w=sa(".dgrid-header",this.grid.domNode)[0],f=p.getComputedStyle(c),w=p.getMarginBox(w),f=parseInt(f.marginTop,10),isFinite(f)&&w&&f<w.h&&p.setStyle(c,"marginTop",w.h+"px"));u?p.addClass(this.domNode,"auto-width"):p.removeClass(this.domNode,
"auto-width");this.footer?p.empty(this.footer):this.footer=p.create("div",{id:this.parent.id+"_"+this.id+"_footer","class":this.parent.baseClass+"-feature-table-footer",tabindex:"-1"},this.domNode);l=p.create("div",{"class":"dgrid-status self-footer",innerHTML:l+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=p.create("div",{"class":"dgrid-status self-footer",id:this.id+"_Selected_Rows_Label",innerHTML:"0\x26nbsp;"+this.nls.selected+
"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},l,"after");l=p.getStyle(this.domNode,"height");this.changeHeight(l);this._requestStatus="fulfilled";this.tableCreated=!0;p.place(this.loading.domNode,this.grid.domNode);this._toggleLoading(!1)},getSelectedRowsData:function(){var c=new n,f=this._getTableSelectedIds()||[];if(!this.grid||!f.length)return c.resolve(null),c;this.grid.store instanceof O?(f=z.clone(this.grid.store.data),c.resolve(f)):this.grid.store.query(f,{_export_count:f.length}).then(z.hitch(this,
function(l){l=l&&z.clone(this.grid.store._entityData||this.grid.store.data);c.resolve(l)}));return c},_appendXY:function(c){c&&"esriGeometryPoint"===this.layer.geometryType&&W.forEach(c,function(f){var l=f.geometry;l&&"point"===l.type&&("x"in f?f._x=l.x:f.x=l.x,"y"in f?f._y=l.y:f.y=l.y);delete f.geometry})},getOutFields:function(c){var f=null;f=this._getOutFieldsFromLayerInfos(this.layer.objectIdField);f=this._processExecuteFields(this.layer.fields,f);f=this._getVisibleFields(f);f=z.clone(f);c&&(c=
"",c=-1!==f.indexOf("x")?"_x":"x",f.push({name:c,alias:c,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),c=-1!==f.indexOf("y")?"_y":"y",f.push({name:c,alias:c,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));return f},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var c=this.getSelectedRows(),f=0;if(this.grid.store instanceof O){var l=W.map(this.grid.store.data,function(u){return u[this.layer.objectIdField]},this);W.forEach(c,function(u){-1<
l.indexOf(u)&&f++})}else f=c.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+f+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},_setSelection:function(c){this._selectionResults=c=c||[];this.selectionManager.setSelection(this.layer,c)},_zoomToExtentByFeatures:function(c){return this.getExtent(c).then(z.hitch(this,function(f){if(f&&this.domNode){var l=null;if("point"===f.type){var u=this.map.getNumLevels(),w=this.map.getLevel();l=this.map.getMaxZoom();0<u?(w===l?u=w:(u=w+4,u>l&&(u=l)),l=this.map.centerAndZoom(f,
u)):l=this.map.centerAndZoom(f,1/Math.pow(2,4)*2)}else l=this.map.setExtent(f.expand(2));return l.then(function(){return f})}}))},_showMapInfoWindowByFeatures:function(c,f){if(f&&0!==f.length&&this.domNode){var l=this.map.infoWindow,u=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(l&&l.setFeatures&&1===f.length&&u){W.forEach(f,z.hitch(this,function(A){A._layer=this.layerInfo.layerObject;A.setInfoTemplate(u)}));l.setFeatures(f);var w=null;w="point"===c.type?f[0].geometry:c.getCenter();
l.show(w,{closetFirst:!0});this._dblClickResult=f[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(c,f){if(f&&0<f.length){if("rowclick"===c||"selectall"===c)this._setSelection(f);else if("zoom"===c||"row-dblclick"===c){var l=ja.graphicsExtent(f),u=ja.toFeatureSet(f),w=Y(this.map,"zoom-end, pan-end",z.hitch(this,function(){w.remove();"row-dblclick"===c&&this.domNode&&this._showMapInfoWindowByFeatures(l,f)}));ja.zoomToFeatureSet(this.map,u).then(null,function(A){A&&(console.error(A.message),
w&&w.remove())})}this.setSelectedNumber();this.onFeatureSelectionChange()}else this.onFeatureSelectionChange(),this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(c){var f=this.map.infoWindow,l=z.isArray(c)?c:[c];Y.once(f,"hide",z.hitch(this,function(){u&&u.remove&&(u.remove(),u=null)}));var u=ta.after(f,"show",z.hitch(this,function(){var w=f.getSelectedFeature();w=w&&l[0]===w;var A=-1;f.features&&(A=f.features.indexOf(l[0]));!w&&-1<A?f.select(A):this.domNode&&!w&&u&&u.remove&&
(u.remove(),u=null)}))},getGraphicsFromLocalFeatureLayer:function(c){for(var f=[],l,u,w=c.length,A=this.layer.graphics.length,N=this.layer.objectIdField,S=0;S<w;S++)for(var H=0;H<A;H++)if(l=this.layer.graphics[H].attributes[N]+"",u=c[S]+"",l===u){f.push(this.layer.graphics[H]);break}return f},getExtent:function(c){var f=new n,l,u=c.length;if(1===u&&c[0].geometry&&"point"===c[0].geometry.type)var w=c[0].geometry;else if(1!==u||c[0].geometry)for(var A=0;A<u;A++)c[A].geometry?"point"===c[A].geometry.type?
(l||(l=new V(c[A].geometry.spatialReference)),l.addPoint(c[A].geometry),A===u-1&&(w=l.getExtent())):w=w?w.union(c[A].geometry.getExtent()):c[A].geometry.getExtent():console.error("unable to get geometry of the reocord: ",c[A]);else return f.reject(Error("AttributeTable.getExtent:: extent was not projected.")),f;if(!w||!w.spatialReference)return f.reject(Error("AttributeTable.getExtent:: extent was not projected.")),f;c=this.map.spatialReference;w.spatialReference.equals(c)?f.resolve(w):(l=new U,l.geometries=
[w],l.outSR=c,a.defaults.geometryService.project(l,z.hitch(this,function(N){this.domNode&&(N&&N.length?f.resolve(N[0]):f.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),z.hitch(this,function(N){N||(N=Error("AttributeTable.getExtent:: extent was not projected."));f.reject(N)})));return f},_onFeaturelayerClick:function(c,f){if(this.actived){var l=z.getObject("graphic",!1,c),u=z.getObject("graphic.attributes",!1,c);u&&l&&l._layer===this.layer&&((l=this.map.infoWindow.getSelectedFeature())&&
l._layer===this.layer&&!f&&this.map.infoWindow.hide(),f=u[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(f).then(z.hitch(this,function(w){-1!==w&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*w}),this.map.infoWindow.features&&(w=this.map.infoWindow.features.indexOf(c.graphic),this.map.infoWindow.select(w)),Y.once(this.map.infoWindow,"selection-change",z.hitch(this,function(){var A=this.map.infoWindow.getSelectedFeature(),N=z.getObject("_layer",
!1,A);A!==c.graphic&&N===this.layer&&this._onFeaturelayerClick({graphic:A},!0)})),this.syncWithMapInfowindow(c.graphic))})))}},_getIndexOfIdInGrid:function(c){var f=new n,l=-1,u=z.getObject("store.objectIds",!1,this.grid);l=null;l=this.grid.get("sort")[0];if(this._relatedQuery)return f.resolve(-1),f;if(this.grid.store instanceof O)c=this.grid.store.get(c),u=this.grid.store.data,c?l&&l.attribute&&r.isDefined(l.descending)?(u=z.clone(u),l=function(w,A){return function(N,S){return N[w]===S[w]?0:N[w]<
S[w]?A?1:-1:A?-1:1}}(l.attribute,l.descending),u.sort(l),u=W.map(u,function(w){return w[this.layer.objectIdField]},this),l=u.indexOf(c[this.layer.objectIdField])):l=u.indexOf(c):l=-1,f.resolve(l);else if(u&&0<u.length)l=u.indexOf(c),f.resolve(l);else{u=new P;u.returnGeometry=!1;u.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+" \x3c "+c;if(l&&(l.attribute!==this.layer.objectIdField||l.descending))return f.resolve(-1),f;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&
(u.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(u)).then(z.hitch(this,function(w){f.resolve(w)}),z.hitch(this,function(w){f.reject(w)}))}return f},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var c=this.getSelectedRows();this._goToFeatures(c,"zoom")}},_goToFeatures:function(c,f){if(0!==c.length){var l=this.getGraphicsFromLocalFeatureLayer(c);this.isSupportQueryToServer()&&c.length!==l.length?this._queryFeaturesByIds(c,f):this.selectFeatures(f,l)}},_onDblclickRow:function(c){this.layerInfo&&
this.layerInfo.isShowInMap()&&(c=[this.grid.row(c).id],this._goToFeatures(c,"row-dblclick"))},_queryFeaturesByIds:function(c,f){var l=new P;l.objectIds=c;l.returnGeometry=!0;l.outSpatialReference=z.clone(this.map.spatialReference);l.outFields=["*"];c=this.layer;var u="esri.layers.CSVLayer"===c.declaredClass;c.url&&!u?(new Q(c.url)).execute(l,z.hitch(this,function(w){this.selectFeatures(f,w.features)}),z.hitch(this,this._errorSelectFeatures)):c.selectFeatures(l,T.SELECTION_NEW,z.hitch(this,this.selectFeatures,
f),z.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(c){var f=this.grid.cell(c),l=f.column,u=f.element.getBoundingClientRect();this._showColumnMenu(l,f,c.target,{x:c.pageX||u.x+.5*u.width,y:c.pageY||u.y+u.height})},_showColumnMenu:function(c,f,l,u){var w=z.getObject("_cache",!1,c);if(w&&(w.sortable||w.statistics)){var A=new g({});p.addClass(A.domNode,"jimu-widget-attributetable-feature-menu");var N=this;if(w.sortable){var S=["iconSortAscending","iconSortDescending"];W.forEach([this.nls.sortAsc,
this.nls.sortDes],function(H,X){H=new d({label:H,iconClass:S[X],baseClass:"menuItemClass",onClick:function(){0===X?N.grid.set("sort",c.field,!1):1===X&&N.grid.set("sort",c.field,!0)}});A.addChild(H)})}w.statistics&&(w=new d({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:z.hitch(this,function(){var H={layer:this.layer,filterExpression:this._getLayerFilterExpression(),fieldNames:[c.field]};this.matchingMap&&(H.geometry=this._currentExtent);if(this.showSelected){var X=
this._getSelectedIds();H.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+X.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&(H.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new ra;this.fieldStatistics.showContentAsPopup(H)})}),A.addChild(w));w=A.getChildren();A.startup();A._openMyself({target:l,delegatedTarget:f,iframe:null,coords:u});this.own(Y(A,"Close",z.hitch(this,function(){var H=
this.get("columnMenu");H&&(H.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",A);1>w.length&&Y.emit(A,"Close")}},_onColumnStateChange:function(c){if(c&&c.grid&&c.grid.columns){var f=0,l;for(l in c.grid.columns)c.grid.columns[l].hidden||f++;20+100*f-1<p.getMarginBox(this.domNode).w?p.addClass(this.domNode,"auto-width"):p.removeClass(this.domNode,"auto-width")}},_onSelectionHandleClick:function(){var c=this._getSelectedIds();this.selectionRows=c;this._closePopup();this.layerInfo.isTable||
(0<c.length?this._goToFeatures(c,"rowclick"):(this.onFeatureSelectionChange(),this._setSelection([])));this.setSelectedNumber();1===this.getSelectedRows().length&&this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.RESELECTION);this.emit("row-click",{table:this,selectedIds:c})},_onExtentChange:function(c){var f=z.getObject("delta.x",!1,c),l=z.getObject("delta.y",!1,c);c=this._clickMap&&!c.levelChange?isFinite(f)&&isFinite(l)&&(0<Math.abs(f)||0<Math.abs(l)):!0;this._clickMap=!1;c&&this.matchingMap&&this.actived&&
this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var c=this.layerInfo.getFilter();return c?c:"1\x3d1"},_getOutFieldsFromLayerInfos:function(c){var f=this.configedInfo.layer.fields,l=this.layerInfo.getPopupInfo(),u=l&&l.fieldInfos,w=[];f&&W.forEach(f,z.hitch(this,function(A){if(!r.isDefined(A.show)&&(A.show=!0,u))for(var N=0,S=u.length;N<S;N++){var H=u[N];H.fieldName===A.name&&(A.show=H.visible)}A.name!==c||"esriFieldTypeOID"!==
A.type&&"esriFieldTypeInteger"!==A.type&&A.type||(A._pk=!0);(A.show||A._pk)&&w.push(A)}));return w},_processExecuteFields:function(c,f){if(c&&0<c.length){var l=[];if(!f.length)return c;for(var u=0,w=f.length;u<w;u++)for(var A=0;A<c.length;A++)f[u].name!==c[A].name||f[u].type!==c[A].type&&f[u].type||(c[A]=z.mixin(c[A],f[u]),l.push(c[A]));return l}return f},_getVisibleFields:function(c){var f=[];if(this.grid&&this.grid.columns){for(var l in this.grid.columns){var u=this.grid.columns[l];u&&u.hidden&&
f.push(u.field)}return W.filter(c,function(w){if(0>f.indexOf(w.name))return w})}return c},_getSelectedIds:function(){var c=[],f=this.grid.selection,l;for(l in f)f[l]&&(isFinite(l)?c.push(parseInt(l,10)):c.push(l));return c},_getTableSelectedIds:function(){var c=[],f=this.getSelectedRows();if(this.grid)if(this.grid.store instanceof O){var l=W.map(this.grid.store.data,function(u){return u[this.layer.objectIdField]},this);W.forEach(f,function(u){-1<l.indexOf(u)&&c.push(parseInt(u,10))})}else c=f;return c},
isSelectionMode:function(){var c=this.getSelectedRows();return this.tableCreated&&c&&0<c.length&&this.layer&&this.layer.objectIdField?!0:!1},_errorSelectFeatures:function(c){console.error(c)},_popupMessage:function(c){var f=new K({message:c,buttons:[{label:this.nls.ok,onClick:z.hitch(this,function(){f.close()})}]});this._toggleLoading(!1)},_hasArcadeExpressionFields:function(){return this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos&&W.some(this.configedInfo.layer.fields,
function(c){return ka.arcade.isArcadeExpressionField(c)})},_hasArcadeExpressionWithGeometry:function(){var c=this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos,f=ka.arcade.parseArcadeExpressions(c);return f?W.some(Object.keys(f),function(l){return f[l].usesGeometry}):!1},_toggleLoading:function(c){void 0===c?this.loading.hidden?this.loading.show():this.loading.hide():c?this.loading.show():this.loading.hide()},_setFarOffRemoval:function(c){this.tableCreated&&!isNaN(c)&&this.grid.set("farOffRemoval",
c)},_handleFilterChange:function(){var c=this.layer.getSelectedFeatures(),f=this.layer.objectIdField;if(c&&0<c.length){var l=W.map(c,function(w){return w.attributes[f]}),u=new P;u.where=f+" in ("+l.join(",")+") AND "+this.layerInfo.getFilter();(new Q(this.layer.url)).executeForIds(u).then(z.hitch(this,function(w){W.forEach(c,function(A){w&&0<=w.indexOf(A.attributes[f])?A.show():A.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.layer)&&this.selectionManager._updateDisplayLayer(this.layer,
c,T.SELECTION_NEW)}),z.hitch(this,function(w){console.error(w)}))}}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(F,p,G,K,D,M,t,E,J){function L(e,m){m=e.unselectable=m?"on":"";e=e.getElementsByTagName("*");for(var x=e.length;--x;)"INPUT"!==e[x].tagName&&"TEXTAREA"!==e[x].tagName&&(e[x].unselectable=
m)}function R(e,m){var x=e.bodyNode,n=m?"text":21>D("ff")?"-moz-none":"none";d&&"msUserSelect"!==d?x.style[d]=n:D("dom-selectstart")?m||e._selectstartHandle?m&&e._selectstartHandle&&(e._selectstartHandle.remove(),delete e._selectstartHandle):e._selectstartHandle=K(x,"selectstart",function(h){var y=h.target&&h.target.tagName;"INPUT"!==y&&"TEXTAREA"!==y&&h.preventDefault()}):(L(x,!m),m||e._unselectableHandle)?m&&e._unselectableHandle&&(e._unselectableHandle.remove(),delete e._unselectableHandle):e._unselectableHandle=
M.after(e,"renderRow",function(h){L(h,!0);return h})}D.add("dom-comparedocumentposition",function(e,m,x){return!!x.compareDocumentPosition});D.add("pointer",function(e){return"PointerEvent"in e?"pointer":"MSPointerEvent"in e?"MSPointer":!1});D.add("css-user-select",function(e,m,x){e=x.style;m=["Khtml","O","ms","Moz","Webkit"];x=m.length;var n="userSelect";do if("undefined"!==typeof e[n])return n;while(x--&&(n=m[x]+"UserSelect"));return!1});D.add("dom-selectstart","undefined"!==typeof document.onselectstart);
var g=D("mac")?"metaKey":"ctrlKey",d=D("css-user-select"),q=(t=D("pointer"))&&"MS"===t.slice(0,2),b=t?t+(q?"Down":"down"):"mousedown",k=t?t+(q?"Up":"up"):"mouseup";"WebkitUserSelect"===d&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(d=!1);return p("dgrid.Selection",null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",selectionEvents:b+","+k+",dgrid-cellfocusin",selectionTouchEvents:D("touch")?E.tap:
null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var e=this.selectionMode;this.selectionMode="";this._setSelectionMode(e)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();
this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(e){e!=this.selectionMode&&(this.clearSelection(),this.selectionMode=e,this._selectionHandlerName="_"+e+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(e){F.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",e)},_setAllowTextSelection:function(e){"undefined"!==typeof e?R(this,e):R(this,"none"===this.selectionMode);
this.allowTextSelection=e},_handleSelect:function(e,m){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(m))&&("dgrid-cellfocusin"!==e.type||"mousedown"!==e.parentType)&&(e.type!==k||m==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=e;if(!e.keyCode||!e.ctrlKey||32==e.keyCode)if(!e.shiftKey&&e.type===b&&this.isSelected(m))this._waitForMouseUp=m;else this[this._selectionHandlerName](e,m);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(e,
m){e=e.keyCode?e.ctrlKey:e[g];this._lastSelected===m?this.select(m,null,!e||!this.isSelected(m)):(this.clearSelection(),this.select(m),this._lastSelected=m)},_multipleSelectionHandler:function(e,m){var x=this._lastSelected,n=e.keyCode?e.ctrlKey:e[g];if(!e.shiftKey){var h=n?null:!0;x=null}this.select(m,x,h);x||(this._lastSelected=m)},_extendedSelectionHandler:function(e,m){(2===e.button?this.isSelected(m):e.keyCode?e.ctrlKey:e[g])||this.clearSelection(null,!0);this._multipleSelectionHandler(e,m)},
_toggleSelectionHandler:function(e,m){this.select(m,null,null)},_initSelectionEvents:function(){var e=this,m=this.contentNode,x=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};D("touch")&&!D("pointer")&&this.selectionTouchEvents?(K(m,E.selector(x,this.selectionTouchEvents),function(n){e._handleSelect(n,this);e._ignoreMouseSelect=this}),K(m,K.selector(x,this.selectionEvents),function(n){e._ignoreMouseSelect!==this?e._handleSelect(n,this):n.type===k&&(e._ignoreMouseSelect=
null)})):K(m,K.selector(x,this.selectionEvents),function(n){e._handleSelect(n,this)});this.addKeyHandler&&this.addKeyHandler(32,function(n){e._handleSelect(n,n.target)});if(this.allowSelectAll)this.on("keydown",function(n){n[g]&&65==n.keyCode&&!/\bdgrid-input\b/.test(n.target.className)&&(n.preventDefault(),e[e.allSelected?"clearSelection":"selectAll"]())});this._setStore&&M.after(this,"_setStore",function(){e._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function e(y,
B,O){y=B||y&&y[m.idProperty||"id"];if(null!=y&&(B=(y=m.row(y))&&m.selection[y.id]))m[O](y,null,B)}var m=this,x=this.store;this._removeDeselectSignals&&this._removeDeselectSignals();if(x&&x.notify){var n=M.before(x,"notify",function(y,B){y||e(y,B,"deselect")});var h=M.after(x,"notify",function(y,B){e(y,B,"select")},!0);this._removeDeselectSignals=function(){n.remove();h.remove()}}else n=M.before(this,"removeRow",function(y,B){B||(y=this.row(y))&&y.id in this.selection&&this.deselect(y)}),this._removeDeselectSignals=
function(){n.remove()}},allowSelect:function(e){return!0},_fireSelectionEvent:function(e){var m=this._selectionEventQueues[e],x=this._selectionTriggerEvent;var n={bubbles:!0,grid:this};x&&(n.parentType=x.type);n[this._selectionTargetType]=m;this._selectionEventQueues[e]=[];K.emit(this.contentNode,"dgrid-"+e,n)},_fireSelectionEvents:function(){var e=this._selectionEventQueues,m;for(m in e)e[m].length&&this._fireSelectionEvent(m)},_select:function(e,m,x){"undefined"===typeof x&&(x=!0);e.element||(e=
this.row(e));if(!1===x||this.allowSelect(e)){var n=this.selection;var h=!!n[e.id];null===x&&(x=!h);var y=e.element;x||this.allSelected?n[e.id]=x:delete this.selection[e.id];y&&(x?J(y,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):J(y,"!dgrid-selected!ui-state-active"));x!==h&&y&&this._selectionEventQueues[(x?"":"de")+"select"].push(e);if(m)if(m.element||(m=this.row(m)),m){if(m=m.element)for(n=this._determineSelectionDirection(y,m),n||(m=document.getElementById(m.id),n=this._determineSelectionDirection(y,
m));e.element!=m&&(e=this[n](e));)this._select(e,null,x)}else this._lastSelected=y,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},_determineSelectionDirection:D("dom-comparedocumentposition")?function(e,m){e=m.compareDocumentPosition(e);return e&1?!1:2===e?"down":"up"}:function(e,
m){return 1>m.sourceIndex?!1:m.sourceIndex>e.sourceIndex?"down":"up"},select:function(e,m,x){this._select(e,m,x);this._fireSelectionEvents()},deselect:function(e,m){this.select(e,m,!1)},clearSelection:function(e,m){this.allSelected=!1;for(var x in this.selection)e!==x&&this._select(x,null,!1);m||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var e in this._rowIdToObject){var m=this.row(this._rowIdToObject[e]);this._select(m.id,
null,!0)}this._fireSelectionEvents()},isSelected:function(e){if("undefined"===typeof e||null===e)return!1;e.element||(e=this.row(e));return e.id in this.selection?!!this.selection[e.id]:this.allSelected&&(!e.data||this.allowSelect(e))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var e=this,m=this.inherited(arguments);G.when(m,function(x){var n=e.selection,h,y;for(h=0;h<x.length;h++){var B=e.row(x[h]);
(y=B.id in n?n[B.id]:e.allSelected)&&e._select(B,null,y)}e._fireSelectionEvents()});return m}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(F,p,G,K,D,M){var t,E,J=p("ie"),L=J&&p("quirks"),R=8>J||L?"htmlFor":"for";return F("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:M,_hiderMenuOpened:!1,
_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var g=this.subRows,d=!0,q,b;delete this._columnHiderFirstCheckbox;var k=0;for(q=g.length;k<q;k++){var e=0;for(b=g[k].length;e<b;e++)this._renderHiderMenuEntry(g[k][e]),d&&(d=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[g[k][e].id])}},_renderHiderMenuEntry:function(g){var d=g.id,q=K.escapeCssIdentifier(d,"-");g.hidden&&(g.hidden=!1,this._hideColumn(d),g.hidden=!0);if(!g.unhidable){var b=D("div.dgrid-hider-menu-row");
var k=this.domNode.id+"-hider-menu-check-"+q;d=this._columnHiderCheckboxes[d]=D(b,"input.dgrid-hider-menu-check.hider-menu-check-"+q+"[type\x3dcheckbox]");d.id=k;D(b,"label.dgrid-hider-menu-label.hider-menu-label-"+q+"["+R+"\x3d"+k+"]",g.label||g.field||"");D(this.hiderMenuNode,b);g.hidden||(d.checked=!0)}},renderHeader:function(){function g(e){e.stopPropagation()}var d=this,q=this.hiderMenuNode,b=this.hiderToggleNode,k;this.inherited(arguments);if(q){for(k in this._columnHiderRules)this._columnHiderRules[k].remove();
q.innerHTML=""}else b=this.hiderToggleNode=D(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(G(b,"click",function(e){d._toggleColumnHiderMenu(e)})),q=this.hiderMenuNode=D("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+"]"),q.id=this.id+"-hider-menu",this._listeners.push(G(q,"keyup",function(e){27===(e.charCode||e.keyCode)&&(d._toggleColumnHiderMenu(e),b.focus())})),
q.style.display="none",D(this.domNode,q),this._listeners.push(G(q,".dgrid-hider-menu-check:"+(9>J||L?"click":"change"),function(e){d._updateColumnHiddenState(e.target.id.substr(d.id.length+18),!e.target.checked)})),this._listeners.push(G(q,"mousedown",g),G(b,"mousedown",g)),E||(E=G.pausable(document,"mousedown",function(e){t&&t._toggleColumnHiderMenu(e)}),E.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);
for(var g in this._columnHiderRules)this._columnHiderRules[g].remove()},left:function(g,d){return this.right(g,-d)},right:function(g,d){g.element||(g=this.cell(g));for(var q=this.inherited(arguments),b=g;q.column.hidden;){q=this.inherited(arguments,[q,0<d?1:-1]);if(b.element===q.element)return g;b=q}return q},isColumnHidden:function(g){return!!this._columnHiderRules[g]},_toggleColumnHiderMenu:function(){var g=this._hiderMenuOpened,d=this.hiderMenuNode,q=this.domNode,b;d.style.display=g?"none":"";
g?d.style.height="":(d.offsetHeight>q.offsetHeight-12&&(d.style.height=q.offsetHeight-12+"px"),(b=this._columnHiderFirstCheckbox)&&b.focus());E[g?"pause":"resume"]();t=g?null:this;this._hiderMenuOpened=!g},_hideColumn:function(g){var d=this,q="#"+K.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-";if(!(this._columnHiderRules[g]||(this._columnHiderRules[g]=K.addCssRule(q+K.escapeCssIdentifier(g,"-"),"display: none;"),8!==p("ie")&&10!==p("ie")||p("quirks")))){var b=K.addCssRule(".dgrid-row-table",
"display: inline-table;");window.setTimeout(function(){b.remove();d.resize()},0)}},_showColumn:function(g){this._columnHiderRules[g]&&(this._columnHiderRules[g].remove(),delete this._columnHiderRules[g])},_updateColumnHiddenState:function(g,d){this[d?"_hideColumn":"_showColumn"](g);this.columns[g].hidden=d;G.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[g],hidden:d,bubbles:!0});this.resize()},toggleColumnHiddenState:function(g,d){"undefined"===typeof d&&(d=!this._columnHiderRules[g]);
this._updateColumnHiddenState(g,d);this._columnHiderCheckboxes[g].checked=!d}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(F,p,G,K,D,M,t,E,J){function L(b){for(var k=b.length,e=k,m=b[0].length,x=Array(k);k--;)x[k]=Array(m);var n={};for(k=0;k<e;k++)for(var h=x[k],y=b[k],B=0,O=0;B<m;B++){var a=
y[O];if("undefined"==typeof h[B]){h[B]=a.id;if(a.rowSpan&&1<a.rowSpan){var r=x;for(var v=a.rowSpan,C=k,I=B,T=a.id,Q=1;Q<v;Q++)r[C+Q][I]=T}if(0<k&&a.colSpan&&1<a.colSpan)for(r=1;r<a.colSpan;r++)if(h[++B]=a.id,a.rowSpan&&1<a.rowSpan){v=x;C=a.rowSpan;I=k;T=B;Q=a.id;for(var P=1;P<C;P++)v[I+P][T]=Q}n[a.id]=b[0][B].id;O++}}return n}function R(b,k,e,m,x){if(!(0>=e)){var n=b.columns[k];if(n){var h={grid:b,columnId:k,width:e,bubbles:!0,cancelable:!0};m&&(h.parentType=m);if(!b._resizedColumns||p.emit(b.headerNode,
"dgrid-columnresize",h))return"auto"===e?delete n.width:(n.width=e,e+="px"),(m=b._columnSizes[k])?m.set("width",e):m=E.addCssRule("#"+E.escapeCssIdentifier(b.domNode.id)+" .dgrid-column-"+E.escapeCssIdentifier(k,"-"),"width: "+e+";"),b._columnSizes[k]=m,!1!==x&&b.resize(),!0}}}var g,d=0,q={create:function(){g=J("div.dgrid-column-resizer")},destroy:function(){J(g,"!");g=null},show:function(b){b=M.position(b.domNode,!0);g.style.top=b.y+"px";g.style.height=b.h+"px";J(document.body,g)},move:function(b){g.style.left=
b+"px"},hide:function(){g.parentNode.removeChild(g)}};return F("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);d++||q.create()},destroy:function(){this.inherited(arguments);for(var b in this._columnSizes)this._columnSizes[b].remove();--d||q.destroy()},resizeColumnWidth:function(b,k){return R(this,b,k)},configStructure:function(){var b=this._oldColumnSizes=K.mixin({},this._columnSizes),k;this._resizedColumns=
!1;this._columnSizes={};this.inherited(arguments);for(k in b)k in this._columnSizes||b[k].remove();delete this._oldColumnSizes},_configColumn:function(b){this.inherited(arguments);var k=b.id,e;"width"in b&&((e=this._oldColumnSizes[k])?e.set("width",b.width+"px"):e=E.addCssRule("#"+E.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+E.escapeCssIdentifier(k,"-"),"width: "+b.width+"px;"),this._columnSizes[k]=e)},renderHeader:function(){this.inherited(arguments);var b=this;if(this.columnSets&&this.columnSets.length)for(var k=
this.columnSets.length;k--;)var e=K.mixin(e||{},L(this.columnSets[k]));else this.subRows&&1<this.subRows.length&&(e=L(this.subRows));k=G(".dgrid-cell",b.headerNode);for(var m=k.length;m--;){var x=k[m],n=x.columnId,h=b.columns[n],y=x.childNodes;if(h&&!1!==h.resizable){h=J("div.dgrid-resize-header-container");for(x.contents=h;0<y.length;)J(h,y[0]);J(x,h,"div.dgrid-resize-handle.resizeNode-"+E.escapeCssIdentifier(n,"-")).columnId=e&&e[n]||n}}b.mouseMoveListen||(p(b.headerNode,".dgrid-resize-handle:mousedown"+
(t("touch")?",.dgrid-resize-handle:touchstart":""),function(B){b._resizeMouseDown(B,this);b.mouseMoveListen.resume();b.mouseUpListen.resume()}),b._listeners.push(b.mouseMoveListen=p.pausable(document,"mousemove"+(t("touch")?",touchmove":""),E.throttleDelayed(function(B){b._updateResizerPosition(B)}))),b._listeners.push(b.mouseUpListen=p.pausable(document,"mouseup"+(t("touch")?",touchend":""),function(B){b._resizeMouseUp(B);b.mouseMoveListen.pause();b.mouseUpListen.pause()})),b.mouseMoveListen.pause(),
b.mouseUpListen.pause())},_resizeMouseDown:function(b,k){b.preventDefault();D.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(b);this._targetCell=G(".dgrid-column-"+E.escapeCssIdentifier(k.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(b);q.show(this)},_resizeMouseUp:function(b){var k=this._columnSizes,e;this.adjustLastColumn&&(e=this.headerNode.clientWidth-1);if(!this._resizedColumns){var m=G(".dgrid-cell",this.headerNode);this.columnSets&&this.columnSets.length?
m=m.filter(function(a){return"0"==a.columnId.split("-")[0]&&!(a.columnId in k)}):this.subRows&&1<this.subRows.length&&(m=m.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in k)}));var x=m.map(function(a){return a.offsetWidth});m.forEach(function(a,r){R(this,a.columnId,x[r],null,!1)},this);this._resizedColumns=!0}D.setSelectable(this.domNode,!0);m=this._targetCell;var n=this._getResizeMouseLocation(b)-this._startX,h=m.offsetWidth+n,y=this._getResizedColumnWidths(),B=y.totalWidth;y=
y.lastColId;var O=G(".dgrid-column-"+E.escapeCssIdentifier(y,"-"),this.headerNode)[0].offsetWidth;h<this.minWidth&&(h=this.minWidth);R(this,m.columnId,h,b.type)&&m.columnId!=y&&this.adjustLastColumn&&(B+n<e?R(this,y,"auto",b.type):O-n<=this.minWidth&&R(this,y,this.minWidth,b.type));q.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(b){if(this._targetCell){b=this._getResizeMouseLocation(b);var k=this._targetCell.offsetWidth,e=b;k+(b-this._startX)<this.minWidth&&(e=
this._startX-(k-this.minWidth));q.move(e)}},_getResizeMouseLocation:function(b){var k=0;b.pageX?k=b.pageX:b.clientX&&(k=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return k},_getResizedColumnWidths:function(){var b=0,k=G((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),e=k.length;if(!e)return{};for(var m=k[e-1].columnId;e--;)b+=k[e].offsetWidth;return{totalWidth:b,lastColId:m}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),
function(F,p,G,K,D,M,t){function E(g,d){var q=d[2];g=g[q?"columnSets":"subRows"][d[1]];return q?g[d[2]]:g}function J(g,d,q){d[2]?g.columnSets[d[1]][d[2]]=q:g.subRows[d[1]]=q}function L(g,d){return d.slice(("dgrid-"+g+"-").length)}var R=/(\d+)(?:-(\d+))?$/;F=p(M,{copyState:function(){return!1},checkAcceptance:function(g,d){return g==this},_legalMouseDown:function(g){return-1<g.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(g){var d=this.grid,q=
R.exec(L(d.id,g[0].getAttribute("dndType"))),b=q[2]?"columnSets":"subRows",k=E(d,q),e=d.columns;this.inherited(arguments);q&&setTimeout(function(){var m=G.map(g[0].parentNode.childNodes,function(x){return e[x.columnId]});J(d,q,m);m={grid:d,subRow:m,column:e[g[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};m[b]=d[b];K.emit(d.domNode,"dgrid-columnreorder",m)?d.set(b,d[b]):(J(d,q,k),d.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});p=p("dgrid.extensions.ColumnReorder",
null,{columnDndConstructor:F,_initSubRowDnd:function(g,d){var q;var b=0;for(q=g.length;b<q;b++){var k=g[b];if(!1!==k.reorderable&&(k=k.headerNode,"TH"!=k.tagName&&(k=k.parentNode),t(k,".dojoDndItem[dndType\x3d"+d+"]"),!e))var e=k.parentNode}e&&this._columnDndSources.push(new this.columnDndConstructor(e,{horizontal:!0,grid:this}))},renderHeader:function(){var g="dgrid-"+this.id+"-",d;this.inherited(arguments);this._columnDndSources&&G.forEach(this._columnDndSources,function(b){b.destroy()});this._columnDndSources=
[];if(this.columnSets){var q=0;for(d=this.columnSets.length;q<d;q++)G.forEach(this.columnSets[q],function(b,k){this._initSubRowDnd(b,g+q+"-"+k)},this)}else G.forEach(this.subRows,function(b,k){this._initSubRowDnd(b,g+k)},this)},_destroyColumns:function(){this._columnDndSources&&G.forEach(this._columnDndSources,function(g){g.destroy()});this.inherited(arguments)}});p.ColumnDndSource=F;return p})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),
function(F,p,G,K,D,M,t,E){function J(a){a.preventDefault()}var L={checkbox:1,radio:1,button:1},R=/\bdgrid-cell\b/,g=/\bdgrid-row\b/,d=F("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=K.mixin({},d.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=K.mixin({},d.defaultHeaderKeyMap))},postCreate:function(){function a(C){var I=C.target;return I.type&&(!L[I.type]||32==C.keyCode)}function r(C){function I(){v._focusedHeaderNode&&
(v._focusedHeaderNode.tabIndex=-1);if(v.showHeader){if(T)for(var V=0,Z,ca=v.headerNode.getElementsByTagName("th");Z=ca[V];++V){if(Q.test(Z.className)){v._focusedHeaderNode=U=Z;break}}else v._focusedHeaderNode=U=v.headerNode;U&&(U.tabIndex=v.tabIndex)}}var T=v.cellNavigation,Q=T?R:g,P=C===v.headerNode,U=C;P?(I(),p.after(v,"renderHeader",I,!0)):p.after(v,"renderArray",function(V){return E.when(V,function(Z){var ca=v._focusedNode||U;if(Q.test(ca.className)&&t.contains(C,ca))return Z;for(var ha=0,z=C.getElementsByTagName("*"),
Y;Y=z[ha];++ha)if(Q.test(Y.className)){ca=v._focusedNode=Y;break}ca.tabIndex=v.tabIndex;return Z})});v._listeners.push(G(C,"mousedown",function(V){a(V)||v._focusOnNode(V.target,P,V)}));v._listeners.push(G(C,"keydown",function(V){if(!V.metaKey&&!V.altKey){var Z=v[P?"headerKeyMap":"keyMap"][V.keyCode];Z&&!a(V)&&Z.call(v,V)}}))}this.inherited(arguments);var v=this;this.tabableHeader&&(r(this.headerNode),this._listeners.push(G(this.headerNode,"dgrid-cellfocusin",function(){v.scrollTo({x:this.scrollLeft})})));
r(this.contentNode);this._debouncedEnsureScroll=t.debounce(this._ensureScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var r=this,v=document.activeElement===this._focusedNode,C=this[this.cellNavigation?"cell":"row"](this._focusedNode),I=C.row||C,T;a=a.element||a;a===I.element&&((T=this.down(I,!0))&&T.element!==a||(T=this.up(I,!0)),this._removedFocus={active:v,rowId:I.id,columnId:C.column&&C.column.id,siblingId:T&&T.element!==a?T.id:void 0},setTimeout(function(){r._removedFocus&&
r._restoreFocus(I.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(a){var r=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(r);return r},_restoreFocus:function(a){var r=this._removedFocus,v;if((a=(a=a&&this.row(a))&&a.element&&a.id===r.rowId?a:"undefined"!==typeof r.siblingId&&this.row(r.siblingId))&&a.element){if(!a.element.parentNode.parentNode){r.wait=!0;return}"undefined"!==typeof r.columnId&&(v=this.cell(a,r.columnId))&&
v.element&&(a=v);r.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(M(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=a.element)}delete this._removedFocus},addKeyHandler:function(a,r,v){return p.after(this[v?"headerKeyMap":"keyMap"],a,r,!0)},_ensureRowScroll:function(a){var r=this.getScrollPosition().y;r>a.offsetTop?this.scrollTo({y:a.offsetTop}):r+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+
a.offsetHeight})},_ensureColumnScroll:function(a){var r=this.getScrollPosition().x,v=a.offsetLeft;if(r>v)this.scrollTo({x:v});else{var C=this.bodyNode.clientWidth;a=a.offsetWidth;var I=v+a;r+C<I&&this.scrollTo({x:C>a?I-C:v})}},_ensureScroll:function(a,r){this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!r&&this._ensureRowScroll(a.row.element);this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(a.element)},_focusOnNode:function(a,r,v){var C="_focused"+(r?
"Header":"")+"Node",I=this[C],T=this.cellNavigation?"cell":"row",Q=this[T](a),P;if(a=Q&&Q.element){if(this.cellNavigation){var U=a.getElementsByTagName("input");var V=0;for(P=U.length;V<P;V++){var Z=U[V];if((-1!=Z.tabIndex||"_dgridLastValue"in Z)&&!Z.disabled){8>D("ie")&&(Z.style.position="relative");Z.focus();8>D("ie")&&(Z.style.position="");var ca=!0;break}}}null!==v&&(v=K.mixin({grid:this},v),v.type&&(v.parentType=v.type),v.bubbles||(v.bubbles=!0));I&&(M(I,"!dgrid-focus[!tabIndex]"),8>D("ie")&&
(I.style.position=""),v&&(v[T]=this[T](I),G.emit(I,"dgrid-cellfocusout",v)));I=this[C]=a;v&&(v[T]=Q);C=this.cellNavigation?R:g;!ca&&C.test(a.className)&&(8>D("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,a.focus());M(a,".dgrid-focus");v&&G.emit(I,"dgrid-cellfocusin",v);this._debouncedEnsureScroll(Q,r)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,!0)},focus:function(a){(a=a||this._focusedNode)?this._focusOnNode(a,!1):this.contentNode.focus()}}),q=d.moveFocusVertical=
function(a,r){if(this._focusOnNode&&a.target!==this.contentNode){var v=this.cellNavigation,C=this[v?"cell":"row"](a);C=v&&C.column.id;r=this.down(this._focusedNode,r,!0);v&&(r=this.cell(r,C));this._focusOnNode(r,!1,a);a.preventDefault()}};F=d.moveFocusUp=function(a){q.call(this,a,-1)};var b=d.moveFocusDown=function(a){q.call(this,a,1)},k=d.moveFocusPageUp=function(a){q.call(this,a,-this.pageSkip)},e=d.moveFocusPageDown=function(a){q.call(this,a,this.pageSkip)},m=d.moveFocusHorizontal=function(a,r){if(this.cellNavigation&&
a.target!==this.contentNode){var v=!this.row(a);this._focusOnNode(this.right(this["_focused"+(v?"Header":"")+"Node"],r),v,a);a.preventDefault()}},x=d.moveFocusLeft=function(a){m.call(this,a,-1)},n=d.moveFocusRight=function(a){m.call(this,a,1)},h=d.moveHeaderFocusEnd=function(a,r){if(this.cellNavigation){var v=this.headerNode.getElementsByTagName("th");this._focusOnNode(v[r?0:v.length-1],!0,a)}a.preventDefault()},y=d.moveHeaderFocusHome=function(a){h.call(this,a,!0)},B=d.moveFocusEnd=function(a,r){var v=
this,C=this.cellNavigation,I=this.contentNode,T=I.scrollTop+(r?0:I.scrollHeight);I=I[r?"firstChild":"lastChild"];var Q=-1<I.className.indexOf("dgrid-preload"),P=Q?I[(r?"next":"previous")+"Sibling"]:I,U=P.offsetTop+(r?0:P.offsetHeight);if(Q){for(;P&&0>P.className.indexOf("dgrid-row");)P=P[(r?"next":"previous")+"Sibling"];if(!P)return}if(!Q||1>I.offsetHeight)C&&(P=this.cell(P,this.cell(a).column.id)),this._focusOnNode(P,!1,a);else{D("dom-addeventlistener")||(a=K.mixin({},a));var V=p.after(this,"renderArray",
function(Z){V.remove();return E.when(Z,function(ca){ca=ca[r?0:ca.length-1];C&&(ca=v.cell(ca,v.cell(a).column.id));v._focusOnNode(ca,!1,a)})})}T===U&&a.preventDefault()},O=d.moveFocusHome=function(a){B.call(this,a,!0)};d.defaultKeyMap={32:J,33:k,34:e,35:B,36:O,37:x,38:F,39:n,40:b};d.defaultHeaderKeyMap={32:J,35:h,36:y,37:x,39:n};return d})},"dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/lang dojo/query ./popup ./registry ./MenuItem ./hccss".split(" "),function(F,
p,G,K,D,M,t){return F("dijit.PopupMenuItem",t,{baseClass:"dijitMenuItem dijitPopupMenuItem",_fillContent:function(){if(this.srcNodeRef){var E=K("*",this.srcNodeRef);this.inherited(arguments,[E[0]]);this.dropDownContainer=this.srcNodeRef}},_openPopup:function(E,J){var L=this.popup;D.open(G.delegate(E,{popup:this.popup,around:this.domNode}));J&&L.focus&&L.focus()},_closePopup:function(){D.close(this.popup);this.popup.parentMenu=null},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var E=
K("[widgetId]",this.dropDownContainer)[0];this.popup=M.byNode(E)}this.ownerDocumentBody.appendChild(this.popup.domNode);this.popup.domNode.setAttribute("aria-labelledby",this.containerNode.id);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&p.set(this.arrowWrapper,"visibility","");this.focusNode.setAttribute("aria-haspopup","true")}},destroyDescendants:function(E){this.popup&&(this.popup._destroyed||this.popup.destroyRecursive(E),delete this.popup);this.inherited(arguments)}})})},
"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(F,p,G,K,D,M,t,E){G("dijit-legacy-requires")&&D(0,function(){F(["dijit/ToolbarSeparator"])});return p("dijit.Toolbar",[M,E,t],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},
"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(F,p,G,K,D,M,t){F=F(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var E=G.map(this.geometries1,function(g){return g.toJson()}),J=G.map(this.geometries2,function(g){return g.toJson()}),L={},R=this.geometries1;R&&0<R.length&&(L.geometries1=
K.toJson({geometryType:t.getJsonType(R[0]),geometries:E}),E=this.geometries1[0].spatialReference,L.sr=E.wkid?E.wkid:K.toJson(E.toJson()));(E=this.geometries2)&&0<E.length&&(L.geometries2=K.toJson({geometryType:t.getJsonType(E[0]),geometries:J}));this.relation&&(L.relation=this.relation);this.relationParam&&(L.relationParam=this.relationParam);return L}});p.mixin(F,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",
SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});
D("extend-esri")&&p.setObject("tasks.RelationParameters",F,M);return F})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all dojo/on exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils esri/ArcadeExpression esri/arcadeProfiles/popupProfile jimu/utils esri/graphic dojo/i18n!./nls/strings".split(" "),function(F,p,G,K,D,M,t,E,J,L,R,g,d,q,b,k,
e,m){function x(n,h){if(!n||!n.length)return h||[];if(!h||!h.length)return n;for(var y=[],B=0,O=n.length;B<O;B++)for(var a=n[B],r=0,v=h.length;r<v;r++){var C=h[r];if(C.name===a.name){C.alias!==a.alias&&(a.alias=C.alias);y.push(a);break}}return y}t.readLayerInfosObj=function(n){return G.getInstance(n,n.itemInfo)};t.readLayerInfosFromMap=function(n,h,y){var B=new K;G.getInstance(n,n.itemInfo).then(F.hitch(this,function(O){var a=[];h?O.traversalLayerInfosOfWebmap(function(C){a.push(C)}):O.traversal(function(C){a.push(C)});
if(y){var r=[],v=O.getMapNotesLayerInfoArray();p.forEach(v,function(C){r.push(C.id);C.traversal(function(I){r.push(I.id)})});a=p.filter(a,function(C){return-1===r.indexOf(C.id)})}O=O.getTableInfoArray();a=a.concat(O);B.resolve(a)}),F.hitch(this,function(O){console.error(O);B.reject(O)}));return B.promise};t.generateColumnsFromFields=function(n,h,y,B,O,a,r,v,C,I){function T(U){var V=U.name;if(Q&&R.isDefined(Q.fieldInfos))for(var Z=0,ca=Q.fieldInfos.length;Z<ca;Z++){var ha=Q.fieldInfos[Z];if(ha.fieldName===
V&&ha.format)return ha.format}return(U=k.getDefaultPortalFieldInfo(U))&&U.format?U.format:null}var Q=y.getPopupInfo()||y.getPopupInfoFromLayerObject&&y.getPopupInfoFromLayerObject(),P={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,field:null,sortable:!1,_cache:{sortable:!1,statistics:!1},renderCell:function(U,V,Z){Z.setAttribute("role","button");Z.setAttribute("title",m.selectionHandleLabel)}}};p.forEach(O,F.hitch(t,function(U,V,Z){V="field"+V;var ca=!!U.domain,
ha="esriFieldTypeDate"===U.type,z=a&&U.name===a,Y="esriFieldTypeDouble"===U.type||"esriFieldTypeSingle"===U.type||"esriFieldTypeInteger"===U.type||"esriFieldTypeSmallInteger"===U.type,ta="esriFieldTypeString"===U.type,W=0===U.name.indexOf("expression/"),qa=U.alias||U.name;var ra=1===Z.length?!1:n&&n[V]?n[V].hidden:U?!U.show&&R.isDefined(U.show):!1;P[V]={label:qa,className:V,hidden:ra,unhidable:1===Z.length?!1:!U.show&&R.isDefined(U.show)&&U._pk,field:U.name,sortable:!1,_cache:{sortable:!!v,statistics:C&&
!ca&&Y}};W?P[V].formatter=F.hitch(t,t.urlFormatter):ta?P[V].formatter=F.hitch(t,t.urlFormatter):ha?P[V].formatter=F.hitch(t,t.dateFormatter,T(U)):Y&&(P[V].formatter=F.hitch(t,t.numberFormatter,T(U)));ca?P[V].get="range"===(U.domain&&U.domain.type)?F.hitch(t,function(fa,ea,ia){return this.getRangeDomainValue(ea.name,ia)},I,U):F.hitch(t,function(fa,ea,ia){return this.getCodeValue(fa,ea.name,ia)},I,U):z?P[V].get=F.hitch(t,function(fa,ea,ia){return this.getTypeName(ia[fa.name],ea)},U,r):W?(Z=k.getFeatureLayerDefinition(I),
P[V]._cache.sortable=!1,ca=d.isAsync(U.name,B),ha=U.name.split("expression/")[1],z={},z[ha]=B[ha],ca?P[V].renderCell=F.hitch(this,function(fa,ea,ia){var da=document.createElement("span");da.innerText=jimuNls.common.show;da.style="cursor: pointer; text-decoration: underline; color: #518dca;";var ja=M(da,"click",F.hitch(this,function(){this.arcade.getAttributes(ia,fa,I,h)[ea.name].then(function(ma){da.style="cursor: inherit; text-decoration: inherit; color: inherit;";da.innerText=ma||""});F.hitch(this,
function(ma){def.reject(ma);da.style="cursor: inherit; text-decoration: inherit; color: inherit;";da.innerText=""});ja.remove()}));return da},z,U):P[V].get=F.hitch(t,function(fa,ea,ia,da){return this.arcade.getAttributes(da,fa,ia,h)[ea.name]||""},z,U,Z)):ca||ha||z||W||(P[V].get=F.hitch(t,function(fa,ea,ia,da,ja){var ma=null;ia&&da&&0<da.length&&(da=(da=p.filter(da,F.hitch(t,function(ka){return ka.id===ja[ia]})))&&da[0]||null)&&da.domains&&da.domains[ea.name]&&da.domains[ea.name].codedValues&&(ma=
this.getCodeValue(fa,ea.name,ja));return(fa=null!==ma?ma:ja[ea.name])||isFinite(fa)?fa:""},I,U,a,r))}));return P};t.getTypeName=function(n,h){return k.fieldFormatter.getTypeName(n,h)};t.getCodeValue=function(n,h,y){return(n=k.getDisplayValueForCodedValueOrSubtype(n,h,y))&&n.isCodedValueOrSubtype?n.displayValue||y[h]||"":y[h]||""};t.getRangeDomainValue=function(n,h){return(n=h[n])?n:""};t.urlFormatter=function(n){return k.fieldFormatter.getFormattedUrl(n)};t.dateFormatter=function(n,h){return k.fieldFormatter.getFormattedDate(h,
n)};t.numberFormatter=function(n,h){return k.fieldFormatter.getFormattedNumber(h,n)};t.readLayerObjectsFromMap=function(n,h,y){var B=new K,O=[];this.readLayerInfosFromMap(n,h,y).then(F.hitch(this,function(a){p.forEach(a,F.hitch(this,function(r){O.push(r.getLayerObject())}));D(O).then(F.hitch(this,function(r){B.resolve(r)}),F.hitch(this,function(r){B.reject(r);console.error(r)}))}),F.hitch(this,function(a){B.reject(a)}));return B.promise};t.readSupportTableInfoFromLayerInfos=function(n){var h=new K,
y=[];p.forEach(n,F.hitch(this,function(B){y.push(B.getSupportTableInfo())}));D(y).then(F.hitch(this,function(B){B=F.clone(B);p.forEach(B,function(O,a){O.id=n[a].id});h.resolve(B)}),function(B){h.reject(B)});return h.promise};t.readConfigLayerInfosFromMap=function(n,h,y){var B=new K,O=[];this.readLayerInfosFromMap(n,h,y).then(F.hitch(this,function(a){var r=[];p.forEach(a,function(v){O.push(v.getSupportTableInfo())});D(O).then(F.hitch(this,function(v){p.forEach(v,F.hitch(this,function(C,I){C.isSupportedLayer&&
(a[I].name=a[I].title,r.push(a[I]))}));B.resolve(r)}),F.hitch(this,function(v){B.reject(v)}))}),F.hitch(this,function(a){B.reject(a)}));return B.promise};t.getConfigInfosFromLayerInfos=function(n){return p.map(n,function(h){return t.getConfigInfoFromLayerInfo(h)})};t.getConfigInfoFromLayerInfo=function(n){var h={};h.name=n.name||n.title;h.id=n.id;h.show=n.isShowInMap();h.layer={url:n.getUrl()};var y=n.getPopupInfo();y&&!y.description&&(h.layer.fields=p.map(y.fieldInfos,function(B){return{name:B.fieldName,
alias:B.label,show:B.visible,format:B.format}}),n=F.getObject("layerObject.fields",!1,n),h.layer.fields=x(h.layer.fields,n),p.some(h.layer.fields,function(B){return B.show})||(h.layer.fields&&0<h.layer.fields.length?h.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return h};t.generateCacheStore=function(n,h,y,B,O){n=new g({layer:n,objectIds:n._objectIds||null,totalCount:h,batchCount:y,where:B||"1\x3d1",spatialFilter:O});h=new L;return new J(n,h,{})};t.generateMemoryStore=function(n,
h){return new E(new L({data:n||[],idProperty:h}))};t.merge=function(n,h,y,B){for(var O=p.map(h,function(C){return C[y]}),a=0,r=n.length;a<r;a++){var v=O.indexOf(n[a][y]);-1<v&&B(n[a],h[v])}};t.syncOrderWith=function(n,h,y){function B(I,T){return p.map(I,function(Q){return Q[T]})}if(!F.isArray(h)||!y)return n;for(var O=B(n,y),a=[],r=0,v=h.length;r<v;r++){var C=O.indexOf(h[r][y]);-1<C&&(a=a.concat(n.splice(C,1)),O=B(n,y))}return a.concat(n)};t.arcade={};t.arcade.getExpressionInfosFromLayer=function(n,
h){n=d.readExprInfo.getArcadeProfilesByType(n,h,"infoTemplate");return 0<n.length&&n[0].expressionInfos?n[0].expressionInfos:[]};t.arcade.getExpressionInfosFromLayerInfo=function(n){return(n=n&&n.getPopupInfo())&&n.expressionInfos||[]};t.arcade.getAttributes=function(n,h,y,B){n=new e(n.geometry,null,n);return d.customExpr.getAsynAttributesFromCustomArcadeExpr(h,n,y,B)};t.arcade.appendArcadeExpressionsToFields=function(n,h){if(n){h=t.arcade.getExpressionInfosFromLayerInfo(h);if(0<h.length){var y=RegExp("^expression/");
p.forEach(h,function(B){p.some(n,function(O){if(y.test(O.name))return O=O.name.substr(11),B.name===O})||n.push({name:"expression/"+B.name,alias:B.title,show:!0})})}return n}};t.arcade.isArcadeExpressionField=function(n){return n&&"string"===typeof n.name&&0===n.name.indexOf("expression/")};t.arcade.parseArcadeExpressions=function(n){return d.InfoTemplate._parseArcadeExpressions(n)};t.getSortbyFields=function(n,h){n=n&&n.get("sort")||[];h=h&&h.objectIdField;0<n.length?n=p.map(n,function(y){return y.attribute+
" "+(y.descending?"DESC":"ASC")}):h&&n.push(h+" ASC");return n}})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(F,p){var G=function(K,D,M){M=M||{};return F.delegate(K,{query:function(t,E){t=K.query(t,E);t.forEach(function(J){M.isLoaded&&!M.isLoaded(J)||D.put(J)});return t},queryEngine:K.queryEngine||D.queryEngine,get:function(t,E){return p(D.get(t),function(J){return J||p(K.get(t,E),function(L){L&&D.put(L,{id:t});return L})})},add:function(t,E){return p(K.add(t,E),function(J){D.add(J&&
"object"==typeof J?J:t,E);return J})},put:function(t,E){D.remove(E&&E.id||this.getIdentity(t));return p(K.put(t,E),function(J){D.put(J&&"object"==typeof J?J:t,E);return J})},remove:function(t,E){return p(K.remove(t,E),function(J){return D.remove(t,E)})},evict:function(t){return D.remove(t)}})};F.setObject("dojo.store.Cache",G);return G})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),
function(F,p,G,K,D,M){return F(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(t){F.safeMixin(this,t);this.data=[];this._entityData=[];this.layer=t.layer;this.objectIds=t.objectIds;this.where=t.where;this.orderByFields=t.orderByFields;this.totalCount=t.totalCount;this.batchCount=t.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=t.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new D(this.layer.url))},get:function(t){return this.data[t]},
getIdentity:function(t){return t[this.idProperty]},query:function(t,E){var J=new K,L=E&&E.start||0,R=E._export_count||this.batchCount,g=null;"function"===typeof t?g=t(this._entityData):"[object Array]"===Object.prototype.toString.call(t)&&(g=t);this.objectIds?(g=g?g:this.objectIds,J.objectIds=g.length>=L+this.batchCount?g.slice(L,L+R):g.slice(L)):(g&&0<g.length?J.objectIds=g.length>=L+this.batchCount?g.slice(L,L+R):g.slice(L):(J.start=L,J.num=R,J.where=this.where,J.geometry=this.spatialFilter,J.spatialRelationship=
K.SPATIAL_REL_INTERSECTS),(t=E.sort)&&0<t.length&&(t=G.map(t,function(q){return q.attribute+" "+(q.descending?"DESC":"ASC")}),J.orderByFields=t));J.returnGeometry="esriGeometryPoint"===this.layer.geometryType;J.outFields=["*"];var d=this.totalCount;t=null;t=!J.where;if(!(J.objectIds&&0<J.objectIds.length)&&t)return new M([]);t=this.queryTask?this.queryTask.execute(J):this.layer.queryFeatures(J);t.total=t.then(p.hitch(this,function(q){var b=0,k=this.layer.objectIdField;if(this.objectIds){if(!k)for(b=
0;b<q.fields.length;b++)if("esriFieldTypeOID"===q.fields[b].type){k=q.fields[b].name;break}var e={};for(b=0;b<q.features.length;b++)e[q.features[b].attributes[k]]=q.features[b];q.features=G.map(J.objectIds,function(x){return e[x]})}for(b=0;b<q.features.length;b++)if(q.features[b]){var m=q.features[b];q.features[b]=p.mixin(p.clone(m.attributes),{geometry:m.geometry});this.data[q.features[b][k]]=q.features[b];this._entityData.push(q.features[b])}q=q.features;return d}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");
return 0});return new M(t)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(F,p,G,K){var D=function(M){function t(E){M[E]||(M[E]=function(){var J=arguments;return K.when(M,function(L){Array.prototype.unshift.call(J,L.features||L);return D(G[E].apply(G,J))})})}if(!M)return M;M.then&&(M=p.delegate(M));M.total||(M.total=K.when(M,function(E){return F._isDefined(E.total)?
E.total:E.length||0}));t("forEach");t("filter");t("map");t("some");t("every");return M};return D})},"widgets/AttributeTable/a11y/WidgetMixin":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/on dojo/aspect dojo/keys dijit/focus dojo/topic dojo/string jimu/utils jimu/LayoutManager".split(" "),function(F,p,G,K,D,M,t,E,J,L,R,g){return F(null,{_layoutManager:null,_focusedTab:null,focusToDisplay:!1,hasBeenActivated:!1,postCreate:function(){this.inherited(arguments);
this._layoutManager=g.getInstance();this.focusToDisplay=!0;this.hasBeenActivated=this.config.initiallyExpand;this.own(D(this.domNode,"keydown",G.hitch(this,function(d){K.hasClass(d.target,this.baseClass)&&d.keyCode===t.ENTER&&(this.focusToDisplay=!1,this.hasBeenActivated=!0,this.showing||(this.widgetManager.activateWidget(this),this._switchTable()))})));this.own(D(this.domNode,"focus",G.hitch(this,function(){R.isInNavMode()&&this.focusToDisplay&&!this.showing&&(this.widgetManager.activateWidget(this),
this._switchTable())})));this.own(D(this.domNode,"blur",G.hitch(this,function(){R.isInNavMode()&&this.focusToDisplay&&this.showing&&(this.hasBeenActivated||this._switchTable());this.focusToDisplay=!0;this.showing||(this.hasBeenActivated=!1)})));this.own(J.subscribe(this.id+"_table_created",G.hitch(this,function(d){this._applyA11y2Grid(d&&d.grid,d&&d.context)})),J.subscribe(this.id+"_toolbar_created",G.hitch(this,function(d){this._applyA11y2Toolbar(d&&d.toolbar,d&&d.context)})))},applyA11y:function(){this._isOnlyTable()&&
K.removeAttr(this.domNode,"tabindex");this.switchBtn&&this.own(D(this.switchBtn,"keydown",G.hitch(this,function(d){if(d.keyCode===t.SPACE||d.keyCode===t.ENTER)this._switchTable(),this.focusToDisplay=this.showing,this.__focus2WidgetNode()})));this.tabContainer&&this.tabContainer.hasChildren()?this._applyA11y2TabContainer(this.tabContainer):this.NoTableMessageDiv&&(K.setAttr(this.NoTableMessageDiv,{tabindex:"0"}),R.initFirstFocusNode(this.domNode,this.NoTableMessageDiv),R.initLastFocusNode(this.domNode,
this.NoTableMessageDiv),this.own(D(this.NoTableMessageDiv,"keydown",G.hitch(this,function(d){d.keyCode===t.ESCAPE&&this.__escape2WidgetSwitch(d)}))),this._isOnlyTable()&&E.focus(this.NoTableMessageDiv))},_applyA11y2TabContainer:function(d){if(d){var q=this,b=function(m){m&&(p.forEach(d.tablist.getChildren(),function(x){!x.active&&x.closeButton&&x.id!==m.id&&K.setAttr(x.closeNode,"tabindex",-1)}),K.setAttr(m.closeNode,"tabindex",0))},k=d.tablist.onkeydown;d.tablist.onkeydown=function(m,x){var n=null,
h=!1;switch(m.keyCode){case t.LEFT_ARROW:case t.UP_ARROW:m._djpage||(n=!1);break;case t.PAGE_UP:m.ctrlKey&&(n=!1);break;case t.RIGHT_ARROW:case t.DOWN_ARROW:m._djpage||(n=!0);break;case t.PAGE_DOWN:m.ctrlKey&&(n=!0);break;case t.HOME:for(var y=this.getChildren(),B=0;B<y.length;B++){var O=y[B];if(!O.disabled){E.focus(O.focusNode);q._focusedTab=O;break}}m.stopPropagation();m.preventDefault();break;case t.END:y=this.getChildren();for(B=y.length-1;0<=B;B--)if(O=y[B],!O.disabled){E.focus(O.focusNode);
q._focusedTab=O;break}m.stopPropagation();m.preventDefault();break;case t.DELETE:case 87:this._currentChild.closable&&(m.keyCode==t.DELETE||m.ctrlKey)&&(m.stopPropagation(),m.preventDefault());break;case t.ENTER:case t.SPACE:q.tabForwardStep=0;break;case t.ESCAPE:"Close"===m.target.title?q._focusedTab&&E.focus(q._focusedTab.focusNode):q.__escape2WidgetSwitch(m);m.stopPropagation();m.preventDefault();break;case t.TAB:if(q.isLoading()){m.stopPropagation();m.preventDefault();return}break;default:h=!0}if(null!==
n){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(n=!n);y=this.getChildren();B=p.indexOf(y,this.pane2button(q._focusedTab?q._focusedTab.page&&q._focusedTab.page.id:this._currentChild.id));O=y[B];do{B=(B+(n?1:y.length-1))%y.length;var a=y[B]}while(a.disabled&&a!==O);q._focusedTab=a;E.focus(q._focusedTab.focusNode);m.stopPropagation();m.preventDefault()}h&&k.apply(this,arguments)};if(d.hasChildren()){p.forEach(d.getChildren(),G.hitch(this,function(m){m.controlButton.checked||
K.setAttr(m.controlButton.focusNode,"aria-selected","false");m.closable&&K.setAttr(m.controlButton.closeNode,"role","button")}));var e=d.tablist.getChildren()[0];this._focusedTab=e;R.initFirstFocusNode(this.domNode,e.focusNode);e.closeNode&&b(e);!this._isOnlyTable()||"LaunchpadTheme"!==this.appConfig.theme.name&&"BillboardTheme"!==this.appConfig.theme.name||E.focus(e.focusNode)}this.own(M.after(d,"selectChild",function(){var m=G.getObject("controlButton",!1,this.selectedChildWidget);m&&(R.initFirstFocusNode(q.domNode,
m.focusNode),m.closeNode&&b(m));q._focusedTab=m}),D(d.tablist,"blur",G.hitch(this,function(){this._focusedTab=null})))}},_applyA11y2Toolbar:function(d,q){d&&(G.mixin(d,{_onLeftArrow:function(){},_onRightArrow:function(){}}),this.own(D(d,"keydown",G.hitch(this,function(b){if(b.keyCode===t.TAB){if(b.shiftKey){if(b.target.id===d._getFirstFocusableChild().id)return}else if(b.target.id===d._getLastFocusableChild().id)return;b.shiftKey?d.focusPrev():d.focusNext();b.stopPropagation();b.preventDefault()}else b.keyCode===
t.ESCAPE&&this.__escape2ActiveTab(b)}))),q&&q.toggleColumnsMenuItem&&this.own(D(q.toggleColumnsMenuItem,"click",G.hitch(this,function(b){R.isInNavMode()&&this.__applyA11y2GridHiderMenu(this._activeTable&&this._activeTable.grid)}))))},_applyA11y2Grid:function(d,q){if(d&&d.hiderToggleNode&&d.hiderMenuNode){var b=d.hiderToggleNode,k=d.hiderMenuNode;R.initLastFocusNode(this.domNode,b);if(!d._customEvtHandlersInitialized){var e=q.id+"_ScreenReader_Node",m=K.create("div",{"class":"sr-only","aria-live":"assertive",
id:e},q.footer,"after");this.own(D(q,"row-click",function(x){R.isInNavMode()&&(m.textContent=x.selectedIds.length+" "+this.nls.selected)}),D(q,"clear-selection",function(){R.isInNavMode()&&(m.textContent="")}),D(d,"keydown",G.hitch(this,function(x){R.isInNavMode()&&x.keyCode===t.ESCAPE&&(m.textContent="",this.__escape2ActiveTab(x))})),E.watch("curNode",G.hitch(this,function(x,n,h){R.isInNavMode()&&h&&h.classList&&h.classList.contains("dgrid-column-selectionHandle")&&(x=-1,d.selection&&0===Object.keys(d.selection).length&&
(x=this.__IndexOfGridRowHandle(h,d),-1<x&&(m.textContent="Row "+x+", Selection Handle.",h.setAttribute("aria-labelledby",e))))})),D(d,"dgrid-select",G.hitch(this,function(x){x=E.curNode;if(R.isInNavMode()&&x&&x.classList&&x.classList.contains("dgrid-column-selectionHandle")){var n=(d.selection&&Object.keys(d.selection)).length,h=-1;0<n&&x&&(h=this.__IndexOfGridRowHandle(x,d),-1<h&&(m.textContent=1===n?L.substitute(this.nls.rowHeaderColumnTitle,{rowId:h}):L.substitute(this.nls.rowHeaderColumnTitleMultiple,
{rowId:h,rowCount:n}),x.setAttribute("aria-labelledby",e)))}})),D(b,"keydown",G.hitch(this,function(x){if(x.keyCode===t.SPACE||x.keyCode===t.ENTER)d._toggleColumnHiderMenu(),this.__applyA11y2GridHiderMenu(d),x.stopPropagation(),x.preventDefault()})),D(k,"keydown",G.hitch(this,function(x){x.keyCode===t.ESCAPE&&(b.focus(),d._hiderMenuOpened&&d._toggleColumnHiderMenu(x),x.stopPropagation(),x.preventDefault())})),D(d,".dgrid-header .dgrid-cell:keydown",G.hitch(this,function(x){x.keyCode===t.ENTER&&this._activeTable&&
this._activeTable._onHeaderClick(x)})));d._customEvtHandlersInitialized=!0}this._focusedTab&&this._focusedTab.checked&&q&&K.setAttr(this._focusedTab.focusNode,"aria-labelledby",this._focusedTab.focusNode.id+" "+this.id+"_"+q.id+"_footer")}},__escape2WidgetSwitch:function(d){this.switchBtn?this.switchBtn.focus():R.isDomFocusable(this.domNode)?this.__focus2WidgetNode():this._controllerDiv&&this._controllerDiv.focus();if(this.closeable&&this._isOnlyTable()&&this.widgetManager){var q;p.some(this._layoutManager&&
this._layoutManager.layoutManager&&this._layoutManager.layoutManager.onScreenWidgetIcons,G.hitch(this,function(b){if(b&&b.widgetConfig&&b.widgetConfig.id===this.id)return q=b,!0}));q?q.domNode.focus():this.widgetManager.closeWidget(this)}d&&(d.stopPropagation(),d.preventDefault())},__focus2WidgetNode:function(){this.domNode.focus()},__escape2ActiveTab:function(d){R.focusFirstFocusNode(this.domNode);d&&(d.stopPropagation(),d.preventDefault())},__applyA11y2GridHiderMenu:function(d){if(d&&d._hiderMenuOpened&&
(d=d.hiderMenuNode,d.children&&0<d.children.length)){var q=d.children[0],b=d.children[d.children.length-1],k=q.querySelector("input");R.initFirstFocusNode(d,q.querySelector("input"));R.initLastFocusNode(d,b.querySelector("input"));k&&k.focus()}},__focusOnActiveTab:function(){setTimeout(G.hitch(this,function(){R.focusFirstFocusNode(this.domNode)}),600)},__IndexOfGridRowHandle:function(d,q){var b;q=q.domNode.querySelectorAll(".dgrid-column-selectionHandle");p.some(q,function(k,e){if(k.isEqualNode(d))return console.log(e),
b=e,!0});return b}})})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; right: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.has-webkit.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {left: 6px;}.dj_edge.jimu-rtl .jimu-widget-attributetable .dgrid-header-row {left: 16px; right: 0;}.dj_edge.jimu-rtl .dgrid-header-scroll,.dj_edge.jimu-rtl .dgrid-hider-toggle {right: auto; left: 0;}.dj_edge.jimu-rtl .dgrid-hider-menu {left: 17px; right: auto;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-header.dgrid-scrollbar-width {min-width: 16px;}.jimu-widget-attributetable .dgrid-hider-toggle {z-index: 10000;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-right-color: transparent;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child .dgrid-resize-handle {display: none;}.jimu-rtl .jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-left-color: transparent;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}.widget-at-filter-popup .content-absolute{left: 0; right: 0;}.jimu-widget-attributetable-feature-table-popup p {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup strong {font-family: "Avenir Medium";}.jimu-widget-attributetable-feature-table-popup mark {display: inline-block; color: #596679; background: #f1f1f1; border-bottom: 1px solid #ddd; margin: 5px; padding: 5px; font-size: 12px;}.jimu-widget-attributetable-feature-table-popup pre {padding: 5px; white-space: normal; font-size: 13px; color: #595959; background-color: #f8f8f8; border: 1px solid #efefef; margin: 10px 0 15px;}.jimu-widget-attributetable-feature-table-popup .tags {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup .example-block {margin-top: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row {margin: 20px auto; color: #596679;}.jimu-widget-attributetable-feature-table-popup .input-row \x3e * {vertical-align: top;}.jimu-widget-attributetable-feature-table-popup .input-row a {color: #485566; cursor: pointer; line-height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-attributetable-feature-table-popup .input-row a {margin-left: auto; margin-right: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button {font-size: 12px; color: #999;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button:hover {color: #595959;}.jimu-widget-attributetable-feature-table-popup.is-loading \x3e *:not(.jimu-loading-indicator) {opacity: .35;}.jimu-widget-attributetable-notable {color: #999; line-height: 1.5; position: absolute; top: 50%; left: 50%; text-align: center; max-width: 400px; transform: translate(-50%, -50%);}.jimu-widget-attributetable-notable.hidden {display: none;}.closed .jimu-widget-attributetable-notable {display: none;}.sr-only {position: absolute; width: 1px; height: 1px; padding: 0; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;}',
"*now":function(F){F(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils ./a11y/WidgetMixin".split(" "),function(F,p,G,K,D,M,t,E,J,L,R,g,d,q,b,k,e,m,x,n,h,y,B,O){F=F([K,G,O],{name:"AttributeTable",
baseClass:"jimu-widget-attributetable",normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);t.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.NoTableMessageDiv=this.AttributeTableDiv=this._loadInfoDef=null;this._delayedLayerInfos=
[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=h.getInstance();this._createUtilitiesUI();this._resourceManager=new y({widgetId:this.id,map:this.map,nls:this.nls,parent:this});this._resourceManager.setConfig(this.config);
this._resourceManager.onFeatureSelectionChange=d.hitch(this,function(a){this.publishData({selectionInfo:a})});this.own(k.subscribe("changeMapPosition",d.hitch(this,this._onMapPositionChange)));B.readLayerInfosObj(this.map).then(d.hitch(this,function(a){this.domNode&&a&&(this.own(q(a,"layerInfosIsShowInMapChanged",d.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(a.on("layerInfosChanged",d.hitch(this,this.onLayerInfosChanged))),this.own(a.on("layerInfosFilterChanged",d.hitch(this,this.onLayerInfosFilterChanged))))}))},
_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=p.create("div");p.addClass(this.arrowDiv,"jimu-widget-attributetable-move");p.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);p.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var a=p.getMarginBox(this.arrowDiv);this.arrowDivHeight=a&&a.h?a.h:7}this.own(q(this.arrowDiv,"mousedown",d.hitch(this,this._onDragStart)));this.own(q(this.arrowDiv,b.press,d.hitch(this,
this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||(this.switchBtn=p.create("div",{className:"jimu-widget-attributetable-switch",tabindex:"0",role:"button"},this.domNode),this.own(q(this.switchBtn,"click",d.hitch(this,function(){this._switchTable();this.hasBeenActivated=this.showing;this.focusToDisplay=!this.showing}))))},_processOpenBarUI:function(){this._isOnlyTable()||(p.removeClass(this.switchBtn,"close"),p.addClass(this.switchBtn,
"open"),p.setAttr(this.switchBtn,"title",this.nls.closeTableTip),p.setAttr(this.switchBtn,"aria-label",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(p.removeClass(this.switchBtn,"open"),p.addClass(this.switchBtn,"close"),p.setAttr(this.switchBtn,"title",this.nls.openTableTip),p.setAttr(this.switchBtn,"aria-label",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():this._openTable()},_openTable:function(){p.removeClass(this.domNode,"closed");
this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):(this._loadInfoDef=new J,this.own(this._loadInfoDef),this.loading||(this.loading=new n),this.loading.placeAt(this.domNode),this._toggleLoading(!0),this._resourceManager.updateLayerInfoResources(!0).then(d.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),d.hitch(this,
function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){p.addClass(this.domNode,"closed");this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();
this.showing=!1;p.setStyle(this.arrowDiv,"display","none");p.setStyle(this.domNode,"overflow","hidden");setTimeout(d.hitch(this,function(){this.domNode&&(p.setStyle(this.domNode,"overflow","visible"),p.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(q(window.document,"mouseup",d.hitch(this,this._onDragEnd)));this.own(q(window.document,"mousemove",d.hitch(this,this._onDraging)));this.own(q(window.document,
b.move,d.hitch(this,this._onDraging)));this.own(q(window.document,b.release,d.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(m.forEach(this._delayedLayerInfos,d.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(a){this._activeTable&&this._activeTable.changeToolbarStatus();this.config.syncWithLayers&&m.forEach(a,d.hitch(this,function(r){if(!r.getSubLayers().length){var v=
r.isShowInMap(),C=B.getConfigInfoFromLayerInfo(r),I=this.getExistLayerTabPage(C.id);if(v)if(I)I.closable&&I.set("closable",!1);else{var T=this._resourceManager.getVisivleLayerInfoIndexById(r.id);v=this._resourceManager.getLayerInfoById(r.id);var Q={layer:r,closeable:!1,isActive:!1,index:T};v?this._addLayerToTable(Q):this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){T=this._resourceManager.getVisivleLayerInfoIndexById(r.id);Q.index=T;this._addLayerToTable(Q)}))}else I&&
this.layerTabPageClose(C.id,!0)}}))},onLayerInfosChanged:function(a,r,v){v&&a&&("added"===r?v.getSupportTableInfo().then(d.hitch(this,function(C){C.isSupportedLayer&&this._resourceManager.addLayerInfo(v)})):"removed"===r&&(a=v.id,this.getExistLayerTabPage(a)&&this.layerTabPageClose(a,!0),this._resourceManager.getLayerInfoById(a)&&this._resourceManager.removeLayerInfo(a),this._resourceManager.getConfigInfoById(a)&&this._resourceManager.removeConfigInfo(a)))},onLayerInfosFilterChanged:function(a){m.some(a,
d.hitch(this,function(r){if(this._activeTable&&r.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},destroy:function(){if(!this._destroyed){var a;if(this.layerTabPages&&0<this.layerTabPages.length){var r=this.layerTabPages.length;for(a=0;a<r;a++){var v=this.layerTabPages[a].paneId,C=d.getObject("_resourceManager.featureTableSet."+v,!1,this);C&&(C=C.getFilterObj())&&g.isDefined(C.expr)&&this.filterManager.applyWidgetFilter(v,this.id,"");
this.layerTabPages[a].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},onOpen:function(){!this.showing&&this._isOnlyTable()&&(this._openTable(),this.hasBeenActivated=!0)},onClose:function(){this.showing&&(this._closeTable(),this.hasBeenActivated=!1)},_changeHeight:function(a){p.setStyle(this.domNode,
"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&p.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(a-this.noGridHeight);k.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&
(window.isRTL?p.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):p.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===typeof a.right&&(window.isRTL?p.setStyle(this.domNode,"left",parseFloat(a.right)+"px"):p.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},setPosition:function(a){this.position=a;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in a?parseInt(a.bottom,10):0;this.domNode.parentNode&&
this.domNode.parentNode.id===window.jimuConfig.layoutId||(p.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(a),this.showRefreshing(!1));p.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||setTimeout(d.hitch(this,function(){var r=this._getGridTopSectionHeight(),v=p.getStyle(this.domNode,"height");0<r&&(this.noGridHeight=r);0<v&&this._changeHeight(v)}),20)},_startQueryOnLayerTab:function(a,r){var v=this._resourceManager.getLayerInfoById(a),
C=this.getExistLayerTabPage(a);v&&C&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(a,this.config.filterByMapExtent,this.config.hideExportButton,this.config.allowTextSelection).then(d.hitch(this,function(I){this._activeLayerInfoId===a&&I&&(C=this.getExistLayerTabPage(a),I.isSupportQuery?(I=I.table,I.getParent()!==C&&I.placeAt(C),this.setActiveTable(I,{h:this.openHeight-this.noGridHeight,featureSet:r})):(I=p.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),C.set("content",
I),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),d.hitch(this,function(I){new E({message:I.message||I});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(a,r,v,C){var I=this._resourceManager.getLayerInfoById(C),T=this.getExistLayerTabPage(a);I&&I.layerObject&&T&&this._resourceManager.getRelationTable(C,r,!1,this.config.hideExportButton,this.config.allowTextSelection).then(d.hitch(this,function(Q){this._activeLayerInfoId===a&&Q&&(T=this.getExistLayerTabPage(a),
Q.isSupportQuery?(Q=Q.table,Q.getParent()!==T&&Q.placeAt(T),this.setActiveTable(Q,{h:this.openHeight-this.noGridHeight,layer:I.layerObject,selectedIds:v})):(Q=p.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),T.set("content",Q),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},tabChanged:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=
this.tabContainer.selectedChildWidget.params,r=a.layerType,v=a.paneId,C=a.relKey;r===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==v||a.oids||a.featureSet)?(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=v,this._startQueryOnLayerTab(v,a.featureSet)):r===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),r=a.oids,a=a.originalInfoId,this._activeLayerInfoId=v,this._startQueryOnRelationTab(v,C,r,a))}},showRefreshing:function(a){this.loading&&this._toggleLoading(a)},
_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=p.getStyle(this.domNode,"height");p.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([q(this.ownerDocument,"dragstart",function(r){r.stopPropagation();r.preventDefault()}),q(this.ownerDocumentBody,"selectstart",function(r){r.stopPropagation();r.preventDefault()})])},_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},
_onDragEnd:function(){this.moveMode=!1;p.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=document.body.clientHeight;return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){var a=p.getStyle(this.domNode,"left"),r=p.getStyle(this.domNode,"right");a||p.setStyle(this.domNode,"left","0px");r||p.setStyle(this.domNode,"right","0px");p.setStyle(this.domNode,"top","auto");p.setStyle(this.domNode,
"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&(a._activeTableHandles.push(q(a._activeTable,"show-related-records",function(r){a._showRelatedRecordsByRelationship(r.layerInfoId,r.objectIds,r.relationshipObj)})),a._activeTableHandles.push(q(a._activeTable,"show-all-records",function(r){a.getExistLayerTabPage(r.layerInfoId).params.layerType=a._layerTypes.FEATURELAYER})),
a._activeTableHandles.push(q(a._activeTable,"refresh",function(r){delete a.getExistLayerTabPage(r.layerInfoId).params.featureSet})),a._activeTableHandles.push(q(a._activeTable,"apply-filter",function(r){a.filterManager.applyWidgetFilter(r.layerInfoId,a.id,r.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var r=a.pop();r&&r.remove&&r.remove()}},setActiveTable:function(a,r){this._activeTable&&(this._activeTable.cancelThread(),
this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(a){this._activeTable=a;this._activeTable.active();this._activeTable.changeHeight(r.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||this._activeTable.tableCreated&&!this._activeTable.matchingMap&&r.featureSet||r.layer&&r.selectedIds)if(a=d.getObject("featureSet.features.length",!1,r),r.layer&&r.selectedIds)this._activeTable.queryRecordsByRelationship(r);else if(a){var v=
r.featureSet.displayFieldName;r=m.map(r.featureSet.features,function(C){return C.attributes[v]});this._activeTable.startQuery(r)}else this._activeTable.startQuery();this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=p.create("div",{},this.domNode);p.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var a=p.create("div");p.place(a,this.AttributeTableDiv);this.tabContainer=new D({style:"width: 100%;"},a);p.setStyle(this.tabContainer.domNode,
"height",this.normalHeight+"px");this.tabContainer.startup();a=this._resourceManager.getConfigInfos();for(var r=a.length,v=0;v<r;v++){var C=a[v];if(C.show){C=d.clone(C);var I={};I.paneId=C.id;I.title=C.name;I.name=C.name;I.layerType=this._layerTypes.FEATURELAYER;I.style="height: 100%; width: 100%; overflow: visible;";C=new M(I);this.layerTabPages[v]=C;this.tabContainer.addChild(C)}}0<r?this.noGridHeight=this._getGridTopSectionHeight()+5:this._toggleNoTableMessage(!0);t.setVerticalCenter(this.tabContainer.domNode);
this.tabChanged();this.own(e.after(this.tabContainer,"selectChild",d.hitch(this,this.tabChanged)));this.applyA11y&&this.applyA11y()},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=x(".dijitTabPaneWrapper",this.domNode)[0];if(a){var r=p.position(this.domNode).y;return p.position(a).y-r}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var r=m.filter(this.config.layerInfos,function(v){return v.id===a});
return r&&0<r.length&&r[0]},_showRelatedRecordsByRelationship:function(a,r,v){var C=this._activeTable;C&&(C=C.layerInfo)&&C.id===a&&C.layerObject&&m.some(C.layerObject.relationships,function(I){return t.isEqual(I,v)})&&this.addNewRelationTab(r,v,C.id,!0,!0)},addNewLayerTab:function(a,r,v,C,I,T){var Q=this._resourceManager.getLayerInfoById(a);if(Q){a=this.getExistLayerTabPage(a);var P={};P.title=this.getLayerInfoLabel(Q);P.name=P.title;P.paneId=this.getLayerInfoId(Q);P.closable=v;P.layerType=this._layerTypes.FEATURELAYER;
P.featureSet=r;P.viewInTableFlag=T;a?(d.mixin(a.params,P),this.onOpen()):(this._resourceManager.getConfigInfoById(Q.id)||this._resourceManager.addConfigInfo(Q),this._resourceManager.getLayerInfoById(Q.id)||this._resourceManager.addLayerInfo(Q),this.onOpen(),P.style="height: 100%; width: 100%; overflow: visible",a=new M(P),this.layerTabPages.push(a),a.set("title",P.name),this.own(q(a,"close",d.hitch(this,this.layerTabPageClose,P.paneId,!0))),this.tabContainer.addChild(a,I));C&&(this.tabContainer.selectChild(a),
this.__focusOnActiveTab());1===this.layerTabPages.length&&this._toggleNoTableMessage(!1)}},addNewRelationTab:function(a,r,v,C,I){var T=this._resourceManager.getRelationShipInfo(r),Q=r&&T;if(Q){T=this.getExistLayerTabPage(T.id);var P={};P.oids=a;P.title=Q.title||Q.name||r.name;P.name=P.title;P.paneId=Q.id;P.relKey=r._relKey;P.originalInfoId=v;P.closable=C;P.layerType=this._layerTypes.RELATIONSHIPTABLE;P.viewInTableFlag=!0;T?d.mixin(T.params,P):(this._resourceManager.getConfigInfoById(Q.id)||this._resourceManager.addConfigInfo(Q),
this._resourceManager.getLayerInfoById(Q.id)||this._resourceManager.addLayerInfo(Q),P.style="height: 100%; width: 100%; overflow: visible",T=new M(P),this.layerTabPages.push(T),T.set("title",P.name),this.own(q(T,"close",d.hitch(this,this.layerTabPageClose,P.paneId,!0))),this.tabContainer.addChild(T));I&&this.tabContainer.selectChild(T)}},onReceiveData:function(a,r,v){v&&"AttributeTable"===v.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(v.layer=v.layer||
v.layerInfo,v.closeable=!0,v.isActive=!0,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){this._addLayerToTable(v)})):this._openTable().then(d.hitch(this,function(){this._resourceManager.getLayerInfoById(v.layer.id)?this._addLayerToTable(v):this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){this._addLayerToTable(v)}))}))))},_addLayerToTable:function(a){var r=null;if(d.getObject("layer.id",!1,a)||d.getObject("layerInfo.id",!1,
a)){var v=this._resourceManager.getLayerInfoById(a.layerInfo&&a.layerInfo.id||a.layer&&a.layer.id);v.getLayerObject().then(d.hitch(this,function(C){C?(C.id=a.layer.id,C.loaded?this.addNewLayerTab(v.id,a.featureSet,!!a.closeable,!!a.isActive,a.index,a.viewInTableFlag):this.own(q(C,"load",d.hitch(this,this.addNewLayerTab,v.id,a.featureSet,!!a.closeable,!!a.isActive,a.index,a.viewInTableFlag)))):a.url&&(r=new R(a.url),this.own(q(r,"load",d.hitch(this,this.addNewLayerTab,v.id,a.featureSet,!!a.closeable,
!!a.isActive,a.index,a.viewInTableFlag))))}),d.hitch(this,function(C){new E({message:C.message||C})}))}},getExistLayerTabPage:function(a){for(var r=this.layerTabPages.length,v=0;v<r;v++)if(this.layerTabPages[v]&&this.layerTabPages[v].get("paneId")===a)return this.layerTabPages[v];return null},layerTabPageClose:function(a,r){var v=this.layerTabPages.length;d.getObject("_activeTable.layerInfo.id",!1,this)===a&&this.setActiveTable(null);for(var C=0;C<v;C++)if(this.layerTabPages[C]&&this.layerTabPages[C].paneId===
a){var I=d.getObject("_resourceManager.featureTableSet."+a,!1,this);I&&(I=I.getFilterObj())&&g.isDefined(I.expr)&&this.filterManager.applyWidgetFilter(a,this.id,"");!0===r&&(this.tabContainer.removeChild(this.layerTabPages[C]),this.layerTabPages[C].destroyRecursive());this.layerTabPages&&this.layerTabPages[C]&&this.layerTabPages.splice(C,1);this._resourceManager.removeConfigInfo(a);this._resourceManager.removeLayerInfo(a);if(1===v){this._activeLayerInfoId=null;this.onClose();this._toggleNoTableMessage(!0);
break}else a===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[v-2]);break}},_processRelatedRecordsFromPopup:function(a,r){if(a){var v=[];v.push(a.getLayerObject());v.push(a.getRelatedTableInfoArray());L(v).then(d.hitch(this,function(C){if(C){var I=C[0];this._resourceManager.collectRelationShips(a,C[1]);C=I.relationships;I=0;for(var T=C.length;I<T;I++)this.addNewRelationTab(r,C[I],a.id,!0,!0)}}))}},showRelatedRecordsFromPopup:function(a,r){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,
function(){this._processRelatedRecordsFromPopup(a,r)})):this._openTable().then(d.hitch(this,function(){this._resourceManager.getLayerInfoById(a.id)?this._processRelatedRecordsFromPopup(a,r):this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){this._processRelatedRecordsFromPopup(a,r)}))}))},getRelationShipInfo:function(a){return this._resourceManager&&this._resourceManager.getRelationShipInfo(a)},_toggleNoTableMessage:function(a){if(!this.NoTableMessageDiv){var r=this.AttributeTableDiv||
this.domNode;this.NoTableMessageDiv=p.create("div",{innerHTML:this.nls.noTablesAvailable+"\x3cbr/\x3e\x3cbr/\x3e"+(this.config.syncWithLayers?this.nls.checkLayerListToSelectLayers:this.nls.checkConfigutationToSelectLayers),className:"jimu-widget-attributetable-notable hidden"});p.place(this.NoTableMessageDiv,r)}p[a?"removeClass":"addClass"](this.NoTableMessageDiv,"hidden")},_toggleLoading:function(a){void 0===a?this.loading.hidden?this.loading.show():this.loading.hide():a?this.loading.show():this.loading.hide()},
isLoading:function(){return this.loading&&!this.loading.hidden||this._activeTable&&this._activeTable.loading&&!this._activeTable.loading.hidden}});F.inPanel=!1;F.hasUIFile=!1;return F});