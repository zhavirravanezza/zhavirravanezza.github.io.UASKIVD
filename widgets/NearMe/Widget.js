// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/NearMe/utils":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/_base/array","dojo/_base/lang"],function(V,W,u,O){return V([W],{map:null,postCreate:function(){},getLayerDetailsFromMap:function(X,N,y){var r={},d;this.map&&this.map.webMapResponse&&this.map.webMapResponse.itemInfo&&this.map.webMapResponse.itemInfo.itemData&&this.map.webMapResponse.itemInfo.itemData.operationalLayers&&u.forEach(this.map.webMapResponse.itemInfo.itemData.operationalLayers,O.hitch(this,
function(e){e.layerObject&&("ArcGISMapServiceLayer"===e.layerType||"ArcGISTiledMapServiceLayer"===e.layerType?(d=y&&y.substring(0,y.lastIndexOf("_")),d&&e.id!==d||(r.isMapServer=!0,r.id=e.id+"_"+N,e.visibility&&0<=e.layerObject.visibleLayers.indexOf(parseInt(N,10))?r.visibility=!0:r.visibility=!1,X.substring(0,X.length-1).replace(/.*?:\/\//g,"")===e.url.replace(/.*?:\/\//g,"")&&(u.forEach(e.resourceInfo.layers,O.hitch(this,function(l){l.id===parseInt(N,10)&&(r.title=l.name)})),u.forEach(e.layers,
O.hitch(this,function(l){l.id===parseInt(N,10)&&(l.name&&(r.title=l.name),r.popupInfo=l.popupInfo,l.layerDefinition&&(l.layerDefinition.definitionExpression&&(r.definitionExpression=l.layerDefinition.definitionExpression),l.layerDefinition.drawingInfo&&l.layerDefinition.drawingInfo.renderer&&(r.renderer=l.layerDefinition.drawingInfo.renderer)))}))))):y&&e.id!==y||e.url.replace(/.*?:\/\//g,"")!==(X+N).replace(/.*?:\/\//g,"")||y&&e.id!==y||(r.isMapServer=!1,r.title=e.title,r.visibility=e.visibility,
r.popupInfo=e.popupInfo,r.id=e.id,e.layerDefinition&&(e.layerDefinition.definitionExpression&&(r.definitionExpression=e.layerDefinition.definitionExpression),e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer&&(r.renderer=e.layerDefinition.drawingInfo.renderer))))}));return r}})})},"widgets/NearMe/search":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/Evented dojo/_base/lang dojo/_base/array esri/dijit/Search esri/tasks/locator esri/layers/FeatureLayer esri/dijit/PopupTemplate jimu/utils dojo/dom-construct jimu/LayerInfos/LayerInfos ./searchSourceUtils dojo/when dojo/Deferred dojo/promise/all dojo/on dojo/keys".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w){return V([W,u],{config:null,map:null,searchOptions:null,layerInfosObj:null,_urlParams:{},constructor:function(G){O.mixin(this,G)},postCreate:function(){this._urlParams={}},startup:function(){this.inherited(arguments);m.getInstance(this.map,this.map.itemInfo).then(O.hitch(this,function(G){this.layerInfosObj=G;this.own(this.layerInfosObj.on("layerInfosFilterChanged",O.hitch(this,this.onLayerInfosFilterChanged)));n.setMap(this.map);n.setLayerInfosObj(this.layerInfosObj);
n.setAppConfig(this.appConfig);h(n.getConfigInfo(this.config.searchSourceSettings)).then(O.hitch(this,function(Q){this.config.searchSourceSettings||(this.config.searchSourceSettings=Q);return F(this._convertConfig(Q)).then(function(S){return X.filter(S,function(M){return M})})})).then(O.hitch(this,function(Q){this.domNode&&this._init(Q)}))}))},_convertConfig:function(G){return X.map(G.sources,O.hitch(this,function(Q){var S=new x;if(Q&&Q.url&&"locator"===Q.type){var M={locator:new y(Q.url||""),outFields:["*"],
singleLineFieldName:Q.singleLineFieldName||"",name:e.stripHTML(Q.name||""),placeholder:e.stripHTML(Q.placeholder||""),countryCode:Q.countryCode||"",maxSuggestions:Q.maxSuggestions,maxResults:Q.maxResults||6,zoomScale:Q.zoomScale||5E4,useMapExtent:!!Q.searchInCurrentMapExtent};Q.enableLocalSearch&&(M.localSearchOptions={minScale:Q.localSearchMinScale,distance:Q.localSearchDistance});S.resolve(M)}else Q&&Q.url&&"query"===Q.type?(M=new r(Q.url||null,{outFields:["*"]}),this.own(H(M,"load",O.hitch(this,
function(R){var C=R.layer;var a=null;Q.searchFields&&0<Q.searchFields.length?a=Q.searchFields:(a=[],X.forEach(C.fields,function(fa){"esriFieldTypeOID"!==fa.type&&fa.name!==C.objectIdField&&"esriFieldTypeGeometry"!==fa.type&&a.push(fa.name)}));var B={featureLayer:C,outFields:["*"],searchFields:a,displayField:Q.displayField||"",exactMatch:!!Q.exactMatch,name:e.stripHTML(Q.name||""),placeholder:e.stripHTML(Q.placeholder||""),maxSuggestions:Q.maxSuggestions||6,maxResults:Q.maxResults||6,zoomScale:Q.zoomScale||
5E4,infoTemplate:void 0,useMapExtent:!!Q.searchInCurrentMapExtent,_featureLayerId:Q.layerId};this._getInfoTemplate(C,Q).then(O.hitch(this,function(fa){B.infoTemplate=fa;S.resolve(B)}),O.hitch(this,function(){S.resolve(B)}));B._featureLayerId&&(R=this.layerInfosObj.getLayerInfoById(B._featureLayerId),C.setDefinitionExpression(R.getFilter()));S.resolve(B)}))),this.own(H(M,"error",function(){S.resolve(null)}))):S.resolve(null);return S}))},_getInfoTemplate:function(G,Q){var S=new x,M=this.layerInfosObj.getLayerInfoById(Q.layerId),
R;if(M)S=M.loadInfoTemplate();else{var C=[];X.filter(G.fields,function(a){var B=a.name.toLowerCase();0>B.indexOf("shape")&&0>B.indexOf("objectid")&&0>B.indexOf("globalid")&&0>B.indexOf("perimeter")&&C.push(a.name)});(G=e.getDefaultPopupInfo(G,Q.name+": {"+Q.displayField+"}",C))&&(R=new d(G));S.resolve(R)}return S},_init:function(G){var Q=1===G.length?0:"all";G={map:this.map,addLayersFromMap:!1,autoNavigate:!1,autoComplete:!0,minCharacters:0,searchDelay:100,enableInfoWindow:!0,enableHighlight:this.config.searchSourceSettings.showInfoWindowOnSelect,
showInfoWindowOnSelect:this.config.searchSourceSettings.showInfoWindowOnSelect,allPlaceholder:e.stripHTML(this.config.searchSourceSettings.allPlaceholder),sources:G,activeSourceIndex:Q};O.mixin(G,this.searchOptions);this._urlParams=this._getUrlParams();this.search=new N(G,l.create("div",{"class":"searchControl"}));l.place(this.search.domNode,this.domNode);this.own(this.search.on("load",O.hitch(this,this._load)));this.own(this.search.on("select-result",O.hitch(this,this._selectResult)));this.own(this.search.on("clear-search",
O.hitch(this,this._clear)));this.own(this.search.on("search-results",O.hitch(this,this._results)));this.own(this.search.on("suggest-results",O.hitch(this,this._results)));this.own(H(this.search.inputNode,"keyup",O.hitch(this,function(S){S.keyCode===w.ENTER&&this.emit("init-attribute-search")})));this.own(H(this.search.submitNode,"click",O.hitch(this,function(){this.emit("init-attribute-search")})));this.search.startup()},_getUrlParams:function(){var G=e.urlToObject(document.location.href);G.query=
G.query||{};return G.query},setSearchText:function(G){this.search.set("value",G)},getSearchText:function(){return this.search.get("value")},getActiveSource:function(){return this.search.activeSource},clearSearchText:function(){this.search&&this.search.clear()},_setSearchString:function(){this._urlParams.find&&(this.search.set("value",this._urlParams.find),setTimeout(O.hitch(this,function(){this.search.search()}),1E3))},onLayerInfosFilterChanged:function(G){X.some(G,O.hitch(this,function(Q){this.search&&
this.search.sources&&0<this.search.sources.length&&X.forEach(this.search.sources,function(S){S._featureLayerId===Q.id&&S.featureLayer.setDefinitionExpression(Q.getFilter())})}))},_load:function(G){this.emit("search-loaded",G);this._setSearchString()},_results:function(G){this.emit("search-results",G)},_clear:function(G){this.emit("clear-search",G)},_showPopupByFeatures:function(G,Q,S){G=null;this.config.showInfoWindowOnSelect?(this.map.infoWindow.setFeatures(Q),G="point"===Q[0].geometry.type?Q[0].geometry:
(G=Q[0].geometry&&Q[0].geometry.getExtent())&&G.getCenter(),G&&this.map.infoWindow.show(G,{closetFirst:!0})):(this.map.infoWindow.setFeatures(Q),this.map.infoWindow.updateHighlight(this.map,Q[0]),this.map.infoWindow.showHighlight());S.source._panToScale?e.featureAction.panTo(this.map,Q):S.source._zoomScaleOfConfigSource?this._zoomToScale(S.source.zoomScale,Q):(Q=e.toFeatureSet(Q),e.zoomToFeatureSet(this.map,Q))},_loadInfoTemplateAndShowPopup:function(G,Q,S){if(G){var M=this.map.getLayer(G.id);G.isPopupEnabled()&&
M&&this._showPopupByFeatures(G,[Q],S)}},_selectResult:function(G){var Q=G.result.feature,S=function(R,C){return X.filter(R.graphics,function(a){return a.attributes[R.objectIdField]===C})},M=this.layerInfosObj.getLayerInfoById(G.source._featureLayerId);M&&M.getLayerObject().then(O.hitch(this,function(R){(R=S(R,Q.attributes[R.objectIdField]))&&0<R.length&&this._loadInfoTemplateAndShowPopup(M,R[0],G)}));this.search.blur();this.emit("select-result",G)}})})},"esri/dijit/Search":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/Deferred dojo/keys dojo/on dojo/query dojo/uacss dojo/regexp dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/date/locale dojo/i18n!../nls/jsapi dojo/text!./Search/templates/Search.html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_FocusMixin dijit/a11yclick dijit/focus ../lang ../InfoTemplate ../kernel ../SpatialReference ../graphic ../promiseList ../symbols/PictureMarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/TextSymbol ../symbols/Font ../geometry/Point ../geometry/Extent ../geometry/normalizeUtils ../geometry/scaleUtils ../tasks/locator ../tasks/query ../Color ../styles/basic".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R,C,a,B,fa,ka,la,oa,P,na,ma,J,z,I,da,ra,qa,wa,Ca,b,f,D){function t(g,L){return O.map(O.filter(g.trim().split(" "),function(U){return!!U.trim()}),function(U){return{onFields:L,searchTerm:U,searchType:"prefix"}})}function Z(g,L){g=g&&g.indexes;if(!g||!L||!L.length)return!1;g=O.filter(g,function(U){return"FullText"===U.indexType});return O.some(g,function(U){var Y=U.fields&&O.map(U.fields.split(","),function(ha){return ha.trim().toLowerCase()})||[];
return O.every(L,function(ha){return Y.includes(ha.toLowerCase())})})}function ca(g){return!!(g&&g.advancedQueryCapabilities&&g.advancedQueryCapabilities.supportsFullTextSearch)}function ta(g,L){g&&L&&(g._layer=L,g._sourceLayer=L)}W=W([Q,S,M,X],{declaredClass:"esri.dijit.Search",templateString:G,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,constructor:function(g,L){this.css={searchGroup:"searchGroup",searchInput:"searchInput",searchInputGroup:"searchInputGroup",searchBtn:"searchBtn",searchSubmit:"searchSubmit",
searchIcon:"searchIcon esri-icon-search",searchButtonText:"searchButtonText",searchToggle:"searchToggle",searchToggleIcon:"searchIcon esri-icon-down-arrow",searchMenu:"searchMenu",searchMenuHeader:"menuHeader",searchClear:"searchClear",searchClearIcon:"searchIcon esri-icon-close searchClose",searchSpinner:"searchIcon esri-icon-loading-indicator searchSpinner",searchSourceName:"sourceName",suggestionsMenu:"suggestionsMenu",sourcesMenu:"sourcesMenu",activeSource:"active",hasValue:"hasValue",hasButtonMode:"hasButtonMode",
hasMultipleSources:"hasMultipleSources",showSuggestions:"showSuggestions",showSources:"showSources",showNoResults:"showNoResults",searchLoading:"searchLoading",latLonHeader:"searchLatLongHeader",searchMoreResults:"moreResults",searchMoreResultsList:"resultsList",searchMoreResultsHeader:"moreHeader",searchMoreResultsItem:"moreItem",searchMoreResultsListHeader:"popupHeader",searchShowMoreResults:"showMoreResults",searchNoResultsMenu:"noResultsMenu",searchNoResultsBody:"noResultsBody",searchNoResultsHeader:"noResultsHeader",
searchNoValueIcon:"noValueIcon esri-icon-notice-triangle",searchNoValueText:"noValueText",searchNoResultsText:"noResultsText",searchExpandContainer:"searchExpandContainer",searchAnimateContainer:"searchAnimate",searchExpanded:"searchExpanded",searchCollapsed:"searchCollapsed",searchClearFloat:"searchClearFloat"};this._allIndex="all";this._objectIdIdentifier="_objectId";this._deferreds=[];this._sourceNames=[];this.defaultSource={locator:new Ca("//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),
singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],name:w.widgets.Search.main.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:w.widgets.Search.main.placeholder,highlightSymbol:(new P(V.toUrl("./Search/images/search-pointer.png"),36,36)).setOffset(9,18)};this.options={map:null,theme:"arcgisSearch",visible:!0,value:"",allPlaceholder:"",sources:[this.defaultSource],activeSourceIndex:0,suggestionDelay:350,enableSourcesMenu:!0,enableSuggestionsMenu:!0,
enableInfoWindow:!0,showInfoWindowOnSelect:!0,enableSuggestions:!0,enableButtonMode:!1,autoNavigate:!0,autoSelect:!0,addLayersFromMap:!1,zoomScale:1E3,graphicsLayer:null,enableHighlight:!0,highlightGraphic:null,enableLabel:!1,labelSymbol:(new z).setColor(new f([181,56,46,.9])).setFont(new I("14px",I.STYLE_NORMAL,I.VARIANT_NORMAL,I.WEIGHT_BOLD,"Arial")),labelGraphic:null,infoTemplate:new B(w.widgets.Search.main.searchResult,'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'),
searchResults:null,suggestResults:null,selectedResult:null,magicKey:null,selectedFeatureId:null,expanded:!1,maxLength:128,maxResults:6,maxSuggestions:6,locationToAddressDistance:1500,minCharacters:3,enableSearchingAll:!0};g=u.mixin({},this.options,g);this.set(g);this._updateActiveSource();this._i18n=w;this._defaultSR=new ka(4326);this.domNode=L},startup:function(){this.inherited(arguments);this.sources||(this.sources=[]);this._mapLoaded().then(u.hitch(this,this._init))},postCreate:function(){var g=
this;this.inherited(arguments);this._moreResultsId=this.id+"_more_results";this.own(r(this.submitNode,R,u.hitch(this,this._searchButton)));this.own(r(this.sourcesBtnNode,R,u.hitch(this,this._toggleSourcesMenu)));this.own(r(this.inputNode,R,u.hitch(this,this._inputClick)));this.own(r(this.clearNode,R,u.hitch(this,this._clearButton)));this.own(r(this.formNode,"submit",u.hitch(this,function(L){L.preventDefault();this._cancelSuggest();this.search()})));this.own(r(this.inputNode,"keyup",u.hitch(this,function(L){this._inputKey(L)})));
this.own(r(this.sourcesBtnNode,"keyup",u.hitch(this,function(L){this._sourceBtnKey(L)})));this.own(r(this.suggestionsNode,"li:click, li:keyup",function(L){g._suggestionsEvent(L,this)}));this.own(r(this.sourcesNode,"li:click, li:keyup",function(L){g._sourcesEvent(L,this)}));this.own(r(this.inputNode,"input, paste",u.hitch(this,function(){this._suggestDelay()})));this.map&&this.map.infoWindow&&this.map.infoWindow.domNode&&this.enableInfoWindow&&(this.own(r(this.map.infoWindow.domNode,"#"+this._moreResultsId+
"_show:click",u.hitch(this,function(L){this._showMoreResultsClick(L)}))),this.own(r(this.map.infoWindow.domNode,"#"+this._moreResultsId+"_list li a:click",u.hitch(this,function(L){this._moreResultsClick(L)}))),this.own(r(this.map.infoWindow.domNode,"#"+this._moreResultsId+" [data-switch-coordinates]:click",u.hitch(this,function(L){this._switchCoordinatesClick(L)}))));this.value&&this._checkStatus();this._hideMenus();this._updateVisible();this._insertSources(this.sources);this._setPlaceholder(this.activeSourceIndex);
this._updateButtonMode(this.enableButtonMode);this.toggle(this.expanded)},destroy:function(){this.clear();F.empty(this.domNode);this.inherited(arguments)},clear:function(){this.clearGraphics();n.get(this.inputNode,"value")&&n.set(this.inputNode,"value","");this._changeAttrValue("value","");this.set("searchResults",null);this.set("suggestResults",null);this.set("selectedResult",null);this.set("magicKey",null);this.set("selectedFeatureId",null);h.remove(this.containerNode,this.css.hasValue);n.set(this.clearNode,
"title","");this._hideMenus();this._closePopup();this._hideLoading();this.emit("clear-search")},show:function(){x.set(this.domNode,"display","block")},hide:function(){x.set(this.domNode,"display","none")},expand:function(){this.enableButtonMode&&(h.add(this.containerNode,this.css.searchExpanded),h.remove(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!0))},collapse:function(){this.enableButtonMode&&(h.remove(this.containerNode,this.css.searchExpanded),h.add(this.containerNode,
this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!1))},toggle:function(g){this.enableButtonMode&&("undefined"===typeof g&&(g=!this.expanded),g?this.expand():this.collapse())},search:function(g){var L=new N;this._mapLoaded().then(u.hitch(this,function(){this._searchDeferred(g).then(u.hitch(this,function(U){var Y=U.results;this.set("searchResults",Y);0===U.numResults&&(this._noResults(U.value),this._showNoResultsMenu());this._hideLoading();this.emit("search-results",U);this._selectFirstResult(Y,
U.activeSourceIndex);L.resolve(Y)}),u.hitch(this,function(U){L.reject(U)}))}));return L.promise},suggest:function(g){var L=new N;this._mapLoaded().then(u.hitch(this,function(){this._suggestDeferred(g).then(u.hitch(this,function(U){if(U){var Y=U.results;this.set("suggestResults",Y);this._insertSuggestions(Y,U.value);this.emit("suggest-results",U);L.resolve(Y)}}),u.hitch(this,function(U){L.reject(U)}))}));return L.promise},select:function(g){var L=this._getDefaultSymbol(g),U=this.labelSymbol,Y=this.sources,
ha=this.activeSourceIndex,va=this.enableHighlight,Aa=this.enableLabel,q=this.autoNavigate,E=this.showInfoWindowOnSelect,T=this.enableInfoWindow,ba=this.infoTemplate,pa=g.feature?new la(g.feature.toJson()):null,xa=pa?g.feature._sourceLayer:null;ta(pa,xa);if(ha===this._allIndex){var Ba=this._getSourceIndexOfResult(g);if(null!==Ba){var Da=Y[Ba];ha=Ba}}else Da=Y[ha];Da&&(Da.hasOwnProperty("highlightSymbol")&&(L=Da.highlightSymbol),Da.hasOwnProperty("labelSymbol")&&(U=Da.labelSymbol),Da.hasOwnProperty("enableHighlight")&&
(va=Da.enableHighlight),Da.hasOwnProperty("enableLabel")&&(Aa=Da.enableLabel),Da.hasOwnProperty("autoNavigate")&&(q=Da.autoNavigate),Da.hasOwnProperty("showInfoWindowOnSelect")&&(E=Da.showInfoWindowOnSelect),Da.hasOwnProperty("enableInfoWindow")&&(T=Da.enableInfoWindow),Da.hasOwnProperty("infoTemplate")?ba=Da.infoTemplate:Da.featureLayer&&Da.featureLayer.infoTemplate&&(ba=Da.featureLayer.infoTemplate));this._hideMenus();this._hideLoading();if(pa){Y=this.highlightGraphic;var Ka=this.graphicsLayer;
Ba=this.labelGraphic;var Na=u.mixin({},pa.attributes,{searchTheme:this.theme,searchResult:this._searchResultHTML(g),searchMoreResults:this.css.searchMoreResults,searchMoreResultsItem:this.css.searchMoreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._moreResultsHTML(g)}),Ta=null;T&&(Ta=ba);Ba?(Ba.setGeometry(pa.geometry),Ba.setAttributes(Na),Ba.setSymbol(U),U&&"textsymbol"===U.type&&Ba.symbol.setText(g.name)):(Ba=new la(pa.geometry,U,Na),ta(Ba,xa),U&&"textsymbol"===
U.type&&Ba.symbol.setText(g.name),Aa&&(Ka?Ka.add(Ba):this.map&&this.map.graphics&&this.map.graphics.add(Ba)));Y?(Y.setGeometry(pa.geometry),Y.setAttributes(Na),Y.setInfoTemplate(Ta),Y.setSymbol(L)):(Y=new la(pa.geometry,L,Na,Ta),ta(Y,xa),va&&(Ka?Ka.add(Y):this.map&&this.map.graphics&&this.map.graphics.add(Y)));Y&&Y.symbol&&"textsymbol"===Y.symbol.type&&Y.symbol.setText(g.name);this.map&&this.map.infoWindow&&T&&E&&(this.map.infoWindow.setFeatures([Y]),L=this._getPointFromGeometry(Y.geometry),this.map.infoWindow.show(L));
this.map&&q&&g&&g.hasOwnProperty("extent")&&"function"===typeof this.map.setExtent&&this.map.setExtent(g.extent,!0);this.set("highlightGraphic",Y);this.set("labelGraphic",Ba)}this.set("selectedResult",g);this.emit("select-result",{result:g,source:Da,sourceIndex:ha})},focus:function(){C.focus(this.inputNode)},blur:function(){this.inputNode.blur();C.curNode&&C.curNode.blur()},clearGraphics:function(){var g=this.highlightGraphic,L=this.graphicsLayer,U=this.labelGraphic;g&&(L?L.remove(g):this.map&&this.map.graphics&&
this.map.graphics.remove(g));U&&(L?L.remove(U):this.map&&this.map.graphics&&this.map.graphics.remove(U));this.set("labelGraphic",null);this.set("highlightGraphic",null)},_mapLoaded:function(){var g=new N;if(this.map)if(this.map.loaded)g.resolve();else r.once(this.map,"load",u.hitch(this,function(){g.resolve()}));else g.resolve();return g.promise},_init:function(){this._getMapLayers().then(u.hitch(this,function(){this.set("loaded",!0);this.emit("load")}))},_clearButton:function(){this.clear();C.focus(this.inputNode)},
_error:function(g){return Error(this.declaredClass+" "+g)},_searchDeferred:function(g){var L=new N,U=this.value,Y=this.activeSourceIndex;g&&g.hasOwnProperty("index")&&(Y=g.index);this._showLoading();this._hideMenus();this._closePopup();this.clearGraphics();var ha={magicKey:this.magicKey,text:U};g?"string"===typeof g?(ha.text=g,g=this._searchQueries(ha)):g="object"===typeof g&&g.hasOwnProperty("magicKey")?this._searchQueries(g):"object"===typeof g&&g.hasOwnProperty("geometry")?this._searchQueries({geometry:g}):
"object"===typeof g&&g.hasOwnProperty(this._objectIdIdentifier)?this._searchQueries(g):"object"===typeof g&&"point"===g.type?this._searchQueries({point:g}):g instanceof Array&&2===g.length?this._searchQueries({latlon:g}):this._searchQueries(ha):g=this._searchQueries(ha);g.always(u.hitch(this,function(va){va=this._formatResults(va,Y,U);L.resolve(va)}));return L.promise},_suggestDeferred:function(g){var L=new N;this._deferreds.push(L);g||(g=this.value);var U=this.activeSourceIndex;this._suggestQueries({text:g}).always(u.hitch(this,
function(Y){var ha;if(Y)for(var va=0;va<Y.length;va++)Y[va]&&(ha=!0);ha?(Y=this._formatResults(Y,U,g),L.resolve(Y)):L.resolve()}));return L.promise},_getDefaultSymbol:function(g){var L;this.map&&(L=this.map.getBasemap());L||(L="topo");if(g&&g.feature&&g.feature.geometry)var U=g.feature.geometry.type;"polyline"===U?U="line":"circle"===U||"extent"===U?U="polygon":"multipoint"===U&&(U="point");if(U){if(g=D.getSchemes({theme:"default",basemap:L,geometryType:U}))var Y=g.primaryScheme;if(Y){Y.color&&Y.hasOwnProperty("opacity")&&
(Y.color.a=Y.opacity);var ha=Y;g=Y.color;Y=Y.size;switch(U){case "point":var va=new na;va.setColor(g);va.setSize(null!==Y?Y:ha.size);U=new ma;U.setColor(ha.outline.color);U.setWidth(ha.outline.width);va.setOutline(U);break;case "line":va=new ma;va.setColor(g);va.setWidth(null!==Y?Y:ha.width);break;case "polygon":va=new J,va.setColor(g),U=new ma,U.setColor(ha.outline.color),U.setWidth(ha.outline.width),va.setOutline(U)}ha=va}}return ha},_selectFirstResult:function(g,L){if(this.autoSelect&&g){var U;
L===this._allIndex?U=this._getFirstResult(g):g[L]&&g[L][0]&&(U=g[L][0]);U&&this.select(U)}},_getSourceIndexOfResult:function(g){var L=this.searchResults;if(L)for(var U in L)if(L[U]&&L[U].length)for(var Y=0;Y<L[U].length;Y++)if(L[U][Y]===g)return parseInt(U,10);return null},_getFirstResult:function(g){if(g)for(var L in g)if(g[L]&&g[L][0])return g[L][0];return!1},_onFocus:function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");
this.inherited(arguments)},_onBlur:function(){this._hideMenus();this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.enableButtonMode&&this.loaded&&this.collapse();this.emit("blur");this.inherited(arguments)},_getMapLayers:function(){var g=new N;if(this.addLayersFromMap&&this.map){var L=[],U=this.map.graphicsLayerIds;if(U&&U.length){for(var Y=0;Y<U.length;Y++){var ha=this.map.getLayer(U[Y]);ha&&L.push(this._featureLayerLoaded(ha))}oa(L).always(u.hitch(this,
function(va){for(var Aa,q=this.sources,E=0;E<va.length;E++)va[E]&&va[E].loaded&&"Feature Layer"===va[E].type&&(q.push({featureLayer:va[E],enableSuggestions:!0}),Aa=!0);Aa&&this.set("sources",q);g.resolve()}))}else g.resolve()}else g.resolve();return g.promise},_switchCoordinatesClick:function(g){g.preventDefault();if(g=n.get(g.target,"data-switch-coordinates"))this._cancelSuggest(),this.set("value",g),this.search()},_moreResultsClick:function(g){g.preventDefault();var L=g.target;g=parseInt(n.get(L,
"data-source-index"),10);L=parseInt(n.get(L,"data-index"),10);var U=this.searchResults;U&&U[g]&&(g=U[g][L])&&this.select(g)},_showMoreResultsClick:function(g){g.preventDefault();if(g=m.byId(this._moreResultsId)){h.toggle(g,this.css.searchShowMoreResults);var L=m.byId(this._moreResultsId+"_show");L&&(h.contains(g,this.css.searchShowMoreResults)?n.set(L,"textContent",w.widgets.Search.main.hideMoreResults):n.set(L,"textContent",w.widgets.Search.main.showMoreResults))}},_featureLayerLoaded:function(g){var L=
new N;if(g.loaded)L.resolve(g);else if(g.loadError)L.reject(this._error("Layer failed to load."));else{var U=r.once(g,"load",u.hitch(this,function(){Y.remove();L.resolve(g)}));var Y=r.once(g,"error",u.hitch(this,function(){U.remove();L.reject(this._error("Layer could not be loaded."))}))}return L.promise},_getObjectSize:function(g){var L=0,U;for(U in g)g.hasOwnProperty(U)&&L++;return L},_sourcesEvent:function(g,L){var U=n.get(L,"data-index"),Y=d("li",this.sourcesNode);L=O.indexOf(Y,L);U!==this._allIndex&&
(U=parseInt(U,10));"click"===g.type||g.keyCode===y.ENTER?(this.set("activeSourceIndex",U),C.focus(this.inputNode),this._hideSourcesMenu()):g.keyCode===y.UP_ARROW?(g.stopPropagation(),g.preventDefault(),g=L-1,0>g?C.focus(this.sourcesBtnNode):C.focus(Y[g])):g.keyCode===y.DOWN_ARROW?(g.stopPropagation(),g.preventDefault(),g=L+1,g>=Y.length?C.focus(this.sourcesBtnNode):C.focus(Y[g])):g.keyCode===y.ESCAPE&&(this._hideSourcesMenu(),C.focus(this.inputNode))},_suggestionsEvent:function(g,L){var U=n.get(L,
"data-source-index"),Y=parseInt(n.get(L,"data-index"),10),ha=d("li",this.suggestionsNode),va=this.sources;L=O.indexOf(ha,L);U!==this._allIndex&&(U=parseInt(U,10));var Aa;this._clearQueryTimeout();"click"===g.type||g.keyCode===y.ENTER?((ha=this.suggestResults)&&ha[U]&&ha[U][Y]&&(Aa=ha[U][Y]),Aa&&(Aa.index=U,va[U].featureLayer?(U=va[U].featureLayer.objectIdField,Aa[this._objectIdIdentifier]=Aa.feature.attributes[U],this.set("value",this._getSuggestionName(Aa)),this.set("selectedFeatureId",Aa.feature.attributes[U])):
Aa.magicKey&&Aa.text&&(this.set("value",Aa.text),this.set("magicKey",Aa.magicKey)),this.search(Aa),C.focus(this.inputNode))):g.keyCode===y.BACKSPACE||g.keyCode===y.DELETE?C.focus(this.inputNode):g.keyCode===y.UP_ARROW?(g.stopPropagation(),g.preventDefault(),Aa=L-1,0>Aa?C.focus(this.inputNode):C.focus(ha[Aa])):g.keyCode===y.DOWN_ARROW?(g.stopPropagation(),g.preventDefault(),Aa=L+1,Aa>=ha.length?C.focus(this.inputNode):C.focus(ha[Aa])):g.keyCode===y.ESCAPE&&(this._hideMenus(),C.focus(this.inputNode))},
_getResultName:function(g){var L;g.hasOwnProperty("name")&&null!==g.name&&(L=g.name.toString());L||(L=w.widgets.Search.main.untitledResult);return L},_getSuggestionName:function(g){var L;g.hasOwnProperty("name")&&null!==g.name&&(L=g.name.toString());g=g.text||L;g||(g=w.widgets.Search.main.untitledResult);return g},_searchResultHTML:function(g){var L="";if(g.feature&&g.feature.attributes&&g.feature.attributes.Addr_type&&"LatLong"===g.feature.attributes.Addr_type){var U=g.name.split(" ");if(2===U.length){var Y=
U[0];var ha=U[1]}ha&&Y?(g=parseFloat(Y),ha=parseFloat(ha),U=ha+", "+g,L+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e',L+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+w.widgets.Search.main.lonlat+"\x3c/div\x3e",L=L+(g+", "+ha)+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsItem+'"\x3e'),g===ha||90<g||-90>g||180<ha||-180>ha||(L+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+w.widgets.Search.main.reverseLonLatHeader+"\x3c/div\x3e",L+='\x3ca data-switch-coordinates\x3d"'+
U+'" tabindex\x3d"0" href\x3d"#"\x3e'+U+"\x3c/a\x3e\x3c/div\x3e")):L=g.name}else L=g.name;return L},_moreResultsHTML:function(g){var L="",U="",Y=this.searchResults,ha=this.sources,va=0;if(Y){U+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e';U+='\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+w.widgets.Search.main.showMoreResults+"\x3c/a\x3e";U=U+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsList+'"\x3e');U+='\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e';
for(var Aa in Y)if(Y[Aa]){var q=Y[Aa].length;if(q){var E=1===q&&Y[Aa][0]===g;if(1<this._getObjectSize(Y)&&!E){var T=this._getSourceName(Aa);U+='\x3cdiv class\x3d"'+this.css.searchMoreResultsListHeader+'"\x3e'+T+"\x3c/div\x3e"}if(q&&!E){U+="\x3cul\x3e";T=ha[Aa].maxResults||this.maxResults;for(E=0;E<q&&E<T;++E)if(Y[Aa][E]!==g){var ba=this._getResultName(Y[Aa][E]);U+='\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+E+'" data-source-index\x3d"'+Aa+'" href\x3d"#"\x3e'+ba+"\x3c/a\x3e\x3c/li\x3e";va++}U+=
"\x3c/ul\x3e"}}}U+="\x3c/div\x3e\x3c/div\x3e"}va&&(L+=U);return L},_validField:function(g,L){return g.getField(L)},_validFields:function(g,L){if(g&&L&&L.length){for(var U=0;U<L.length;U++)if(!this._validField(g,L[U]))return!1;return!0}return!1},_getCodedName:function(g,L){if(g&&g.length)for(var U=0,Y=g.length;U<Y;U++){var ha=g[U];if(ha.code===L)return ha.name}},_getCodedValue:function(g,L,U){if(g&&g.length)for(var Y=0,ha=g.length;Y<ha;Y++){var va=g[Y],Aa=va.name,q=L;U||(Aa=Aa.toLowerCase(),q=q.toLowerCase());
if(Aa===q)return va.code}return!1},_whereClause:function(g,L,U,Y,ha){var va=null;if(g){var Aa="",q=this.reHostedFS.test(L.url);q&&this._containsNonLatinCharacter(g)&&(Aa="N");if(U&&U.length)for(var E=0,T=U.length;E<T;E++){var ba="";ba=g.replace(/'/g,"''");var pa=U[E],xa=L.getField(pa),Ba=L.getDomain(pa);Ba&&"codedValue"===Ba.type&&(ba=this._getCodedValue(Ba.codedValues,ba,Y));!1!==ba&&(xa=xa.type,"esriFieldTypeString"===xa||"esriFieldTypeDate"===xa?Y&&"search"===ha?ba=pa+" \x3d "+Aa+"'"+ba+"'":(pa=
q?pa:"LOWER("+pa+")",ba=(q?ba:ba.toLowerCase())+"%",ba=pa+" LIKE "+Aa+"'"+ba+"'"):"esriFieldTypeOID"===xa||"esriFieldTypeSmallInteger"===xa||"esriFieldTypeInteger"===xa||"esriFieldTypeSingle"===xa||"esriFieldTypeDouble"===xa?(ba=parseFloat(ba),ba=isNaN(ba)?!1:pa+" \x3d "+ba):ba=pa+" \x3d "+ba,ba&&(va=va?va+" or ":"",va+=ba))}}return va},_suggest:function(g){g||(g={index:this.activeSourceIndex,text:this.value});var L=new N,U=g.index,Y=this.sources[U],ha=this.enableSuggestions;Y.hasOwnProperty("enableSuggestions")&&
(ha=Y.enableSuggestions);var va=0;if(g.hasOwnProperty("text")&&g.text){var Aa=u.trim(g.text);va=g.text.length}g=Y.minCharacters||this.minCharacters;if(ha&&Aa&&va>=g&&this._supportsPagination(Y)){var q="";Y.prefix&&(q+=Y.prefix);q+=Aa;Y.suffix&&(q+=Y.suffix);var E=this._defaultSR;this.map&&(E=this.map.spatialReference);ha={};Y.locator?(Y.categories&&(ha.categories=Y.categories),Y.locator.outSpatialReference=E,this.map&&Y.localSearchOptions&&Y.localSearchOptions.hasOwnProperty("distance")&&Y.localSearchOptions.hasOwnProperty("minScale")&&
(va=this._getScale(),!Y.localSearchOptions.minScale||va&&va<=parseFloat(Y.localSearchOptions.minScale))&&(ha.location=this.map.extent.getCenter(),ha.distance=Y.localSearchOptions.distance),ha.text=q,Y.useMapExtent&&this.map&&this.map.extent&&(ha.searchExtent=this.map.extent),Y.searchExtent&&(ha.searchExtent=Y.searchExtent),ha.maxSuggestions=Y.maxSuggestions||this.maxSuggestions,Y.sourceCountry&&(ha.countryCode=Y.sourceCountry),Y.countryCode&&(ha.countryCode=Y.countryCode),Y.locator.suggestLocations(ha).then(u.hitch(this,
function(T){L.resolve(T)}),u.hitch(this,function(T){T||(T=this._error("Locator suggestLocations could not be performed."));L.reject(T)}))):Y.featureLayer?this._featureLayerLoaded(Y.featureLayer).then(u.hitch(this,function(){var T=this._getDisplayField(Y),ba=Y.searchFields||[T],pa=[];Y.suggestionTemplate?Y.suggestionTemplate.replace(/(?:\$\{([^}]+)\})/g,function(Ka,Na){pa.push(Na)}):pa=[T];-1===O.indexOf(pa,Y.featureLayer.objectIdField)&&pa.push(Y.featureLayer.objectIdField);T=this._validField(Y.featureLayer,
T);var xa=this._validFields(Y.featureLayer,pa),Ba=this._validFields(Y.featureLayer,ba);if(T&&xa&&Ba){T=new b;Y.hasOwnProperty("suggestQueryParams")&&u.mixin(T,Y.suggestQueryParams);T.outSpatialReference=E;T.returnGeometry=!1;T.num=Y.maxSuggestions||this.maxSuggestions;T.outFields=pa;Y.useMapExtent&&this.map&&this.map.extent&&(T.geometry=this.map.extent);Y.searchExtent&&(T.geometry=Y.searchExtent);ca(Y.featureLayer)&&Z(Y.featureLayer,ba)&&!Y.exactMatch&&q?T.fullText=t(q,ba):T.where=this._whereClause(q,
Y.featureLayer,ba,Y.exactMatch,"suggest");if(T.fullText||T.where)var Da=!0;Da?Y.featureLayer.queryFeatures(T,u.hitch(this,function(Ka){var Na;(Ka=Ka.features)&&(Na=this._hydrateResults(Ka,U,!0));L.resolve(Na)}),u.hitch(this,function(Ka){Ka||(Ka=this._error("FeatureLayer queryFeatures errored with suggestions"));L.reject(Ka)})):L.resolve()}else L.reject(this._error("Invalid FeatureLayer field"))})):L.reject(this._error("Invalid source"))}else L.resolve();return L.promise},_supportsPagination:function(g){var L;
g.locator?L=!0:g.featureLayer&&g.featureLayer.advancedQueryCapabilities&&g.featureLayer.advancedQueryCapabilities.supportsPagination&&(L=!0);return L},_suggestQueries:function(g){var L=this.sources,U=this.activeSourceIndex,Y=[];if(U===this._allIndex)for(U=0;U<L.length;U++){var ha=g;ha.index=U;ha=this._suggest(ha);Y.push(ha)}else g.index=U,ha=this._suggest(g),Y.push(ha);return oa(Y)},_getPointFromGeometry:function(g){switch(g.type){case "extent":var L=g.getCenter();break;case "multipoint":L=g.getPoint(0);
break;case "point":L=g;break;case "polygon":L=g.getCentroid();break;case "polyline":L=g.getPoint(0,0)}return L},_searchQueries:function(g){g.hasOwnProperty("index")||(g.index=this.activeSourceIndex);var L=[];if(g.index===this._allIndex)for(var U=this.sources,Y=0;Y<U.length;Y++){var ha=g;ha.index=Y;ha=this._search(ha);L.push(ha)}else g=this._search(g),L.push(g);return oa(L)},_searchButton:function(){this.enableButtonMode&&!this.expanded?(this.expand(),C.focus(this.inputNode)):(this._cancelSuggest(),
this.search())},_search:function(g){g||(g={text:this.value,magicKey:null,geometry:null,point:null,index:this.activeSourceIndex,latlon:null});this.selectedFeatureId&&(g.text=null,g[this._objectIdIdentifier]=this.selectedFeatureId);var L,U=new N,Y=g.index,ha=this.sources[Y],va;g.hasOwnProperty("text")&&g.text&&(va=u.trim(g.text));if(ha){var Aa="";ha.prefix&&!g.magicKey&&(Aa+=ha.prefix);Aa+=va;ha.suffix&&!g.magicKey&&(Aa+=ha.suffix);var q=this._defaultSR;this.map&&(q=this.map.spatialReference);if(ha.locator)if(g.hasOwnProperty("text")&&
va){var E={};ha.categories&&(E.categories=ha.categories);ha.locationType&&(E.locationType=ha.locationType);q&&(ha.locator.outSpatialReference=q);if(this.map&&ha.localSearchOptions&&ha.localSearchOptions.hasOwnProperty("distance")&&ha.localSearchOptions.hasOwnProperty("minScale")){var T=this._getScale();if(!ha.localSearchOptions.minScale||T&&T<=parseFloat(ha.localSearchOptions.minScale))E.location=this.map.extent.getCenter(),E.distance=ha.localSearchOptions.distance}E.address={};E.maxLocations=ha.maxResults||
this.maxResults;ha.useMapExtent&&this.map&&this.map.extent&&(E.searchExtent=this.map.extent);ha.searchExtent&&(E.searchExtent=ha.searchExtent);ha.sourceCountry&&(E.countryCode=ha.sourceCountry);ha.countryCode&&(E.countryCode=ha.countryCode);g.magicKey&&(E.magicKey=g.magicKey);ha.singleLineFieldName?E.address[ha.singleLineFieldName]=Aa:E.address["Single Line Input"]=Aa;ha.outFields&&(E.outFields=ha.outFields);ha.locator.addressToLocations(E).then(u.hitch(this,function(ba){ba=this._hydrateResults(ba,
Y,!1);U.resolve(ba)}),u.hitch(this,function(ba){ba||(ba=this._error("Locator addressToLocations could not be performed"));U.reject(ba)}))}else g.geometry?(L=this._getPointFromGeometry(g.geometry.geometry))?this._reverseGeocodePoint(Y,L).then(function(ba){U.resolve(ba)},function(ba){U.reject(ba)}):U.reject(this._error("Invalid point to reverse geocode")):g.point?this._reverseGeocodePoint(Y,g.point).then(function(ba){U.resolve(ba)},function(ba){U.reject(ba)}):g.latlon?(E=new da(g.latlon,this._defaultSR),
this._reverseGeocodePoint(Y,E).then(function(ba){U.resolve(ba)},function(ba){U.reject(ba)})):g.hasOwnProperty("text")&&!va?U.resolve([]):U.reject(this._error("Invalid query type for Locator"));else ha.featureLayer?this._featureLayerLoaded(ha.featureLayer).then(u.hitch(this,function(){var ba=this._getDisplayField(ha),pa=ha.searchFields||[ba];ba=this._validField(ha.featureLayer,ba);var xa=this._validFields(ha.featureLayer,pa);if(ba&&xa){ba=new b;ha.hasOwnProperty("searchQueryParams")&&u.mixin(ba,ha.searchQueryParams);
q&&(ba.outSpatialReference=q,xa=this.map&&this.map.getMaxResolution()||1/wa.getUnitValueForSR(q))&&(ba.maxAllowableOffset=xa);ba.returnGeometry=!0;ha.outFields&&(ba.outFields=ha.outFields);if(!g.hasOwnProperty(this._objectIdIdentifier)){this._supportsPagination(ha)&&(ba.num=ha.maxResults||this.maxResults);ha.useMapExtent&&this.map&&this.map.extent&&(ba.geometry=this.map.extent);ha.searchExtent&&(ba.geometry=ha.searchExtent);var Ba=ha.exactMatch}g.hasOwnProperty("text")&&va?(ca(ha.featureLayer)&&Z(ha.featureLayer,
pa)&&!Ba&&Aa?ba.fullText=t(Aa,pa):ba.where=this._whereClause(Aa,ha.featureLayer,pa,Ba,"search"),pa=ba.fullText||ba.where?!0:!1):g.hasOwnProperty(this._objectIdIdentifier)?(ba.objectIds=[g[this._objectIdIdentifier]],pa=!0):g.geometry?(ba.geometry=g.geometry,pa=!0):g.point?(ba.geometry=g.point,pa=!0):g.latlon?(L=new da(g.latlon,this._defaultSR),ba.geometry=L,pa=!0):(g.hasOwnProperty("text")&&!va?U.resolve([]):U.reject(this._error("Invalid query type for FeatureLayer")),pa=!1);pa?ha.featureLayer.queryFeatures(ba,
u.hitch(this,function(Da){Da=Da.features;var Ka;Da&&(Ka=this._hydrateResults(Da,Y,!1));U.resolve(Ka)}),u.hitch(this,function(Da){Da||(Da=this._error("FeatureLayer queryFeatures could not be performed"));U.reject(Da)})):U.resolve()}else U.reject(this._error("Invalid FeatureLayer field"))})):U.reject(this._error("Invalid source"))}else U.reject(this._error("Source is undefined"));return U.promise},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_formatResults:function(g,
L,U){U={activeSourceIndex:L,value:U,numResults:0,numErrors:0,errors:null,results:null};var Y={},ha={};if(g)if(L===this._allIndex)for(L=0;L<g.length;L++)g[L]&&(g[L]instanceof Error?(Y[L]=g[L],U.numErrors++):(ha[L]=g[L],U.numResults+=g[L].length));else g[0]&&(g[0]instanceof Error?(Y[L]=g[0],U.numErrors++):(ha[L]=g[0],U.numResults+=g[0].length));U.numErrors&&(U.errors=Y);U.numResults&&(U.results=ha);return U},_reverseGeocodePoint:function(g,L){var U=new N,Y=this.sources[g];if(L&&Y){var ha=Y.locationToAddressDistance||
this.locationToAddressDistance;Y.locator.outSpatialReference=this._defaultSR;this.map&&(Y.locator.outSpatialReference=this.map.spatialReference);Y.locator.locationToAddress(L,ha,u.hitch(this,function(va){va=this._hydrateResults([va],g,!1);U.resolve(va)}),u.hitch(this,function(va){va||(va=this._error("Locator locationToAddress could not be performed"));U.reject(va)}))}else U.reject(this._error("No point or source defined for reverse geocoding"));return U.promise},_cancelDeferreds:function(){if(this._deferreds&&
this._deferreds.length)for(var g=0;g<this._deferreds.length;g++)this._deferreds[g].cancel(this.declaredClass+" cancelling request");this._deferreds=[]},_sourceBtnKey:function(g){if(g){var L=d("li",this.sourcesNode);g.keyCode===y.UP_ARROW?(g.stopPropagation(),g.preventDefault(),this._showSourcesMenu(),(g=L.length)&&C.focus(L[g-1])):g.keyCode===y.DOWN_ARROW&&(g.stopPropagation(),g.preventDefault(),this._showSourcesMenu(),L[0]&&C.focus(L[0]))}},_inputKey:function(g){if(g){var L=d("li",this.suggestionsNode),
U=this.suggestResults;if(g.keyCode===y.TAB||g.keyCode===y.ESCAPE)this._cancelSuggest(),this._hideMenus();else if(g.keyCode===y.UP_ARROW)g.stopPropagation(),g.preventDefault(),this._cancelSuggest(),U&&this._showSuggestionsMenu(),(g=L.length)&&C.focus(L[g-1]);else if(g.keyCode===y.DOWN_ARROW)g.stopPropagation(),g.preventDefault(),this._cancelSuggest(),U&&this._showSuggestionsMenu(),L[0]&&C.focus(L[0]);else{if(g.ctrlKey||g.metaKey||g.keyCode===y.copyKey||g.keyCode===y.LEFT_ARROW||g.keyCode===y.RIGHT_ARROW||
g.keyCode===y.ENTER)return g;this._suggestDelay()}}},_cancelSuggest:function(){this._cancelDeferreds();this._clearQueryTimeout()},_suggestDelay:function(){this._cancelSuggest();this._changeValue();this._queryTimer=setTimeout(u.hitch(this,function(){this.suggest()}),this.suggestionDelay)},_changeValue:function(){this.set("magicKey",null);this.set("selectedFeatureId",null);this._changeAttrValue("value",this.inputNode.value);this._checkStatus()},_inputClick:function(){this._hideSourcesMenu();this._hideNoResultsMenu()},
_getSourceName:function(g){return this._sourceNames[g]},_loadSources:function(g){g=O.filter(g,function(L){return!!L.featureLayer});g=O.map(g,function(L){return this._featureLayerLoaded(L.featureLayer)},this);return oa(g)},_createSourceNameMap:function(g){return this._loadSources(g).then(u.hitch(this,function(){var L=O.map(g,function(U){return U.name||U.featureLayer&&U.featureLayer.name||w.widgets.Search.main.untitledSource});this._preventDuplicateSourceNames(g,L);return L}))},_getDuplicateSourceNameIndexes:function(g){var L=
{},U=[];O.forEach(g,function(Y,ha){L.hasOwnProperty(Y)?(-1===U.indexOf(L[Y])&&U.push(L[Y]),U.push(ha)):g.lastIndexOf(Y)!==ha&&(L[Y]=ha)});return U},_preventDuplicateSourceNames:function(g,L){if(L&&1<L.length){var U=this._getDuplicateSourceNameIndexes(L);O.forEach(U,function(Y){L[Y]+=this._getFieldsString(g[Y])},this)}},_getFieldsString:function(g){var L="",U=g.featureLayer;if(U){g=g.searchFields||[this._getDisplayField(g)];for(var Y=0;Y<g.length;Y++){L=0===Y?L+": ":L+", ";var ha=g[Y],va=U.getFieldLabel(ha);
L+=va||ha}}return L},_splitResult:function(g,L){L=l.escapeString(L);return g.replace(new RegExp("(^|)("+L+")(|$)","ig"),"$1|$2|$3").split("|")},_insertSuggestions:function(g,L){if(this.enableSuggestionsMenu&&this.suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var U=this.sources;if(g){var Y=F.create("div");for(var ha in g)if(g[ha]&&g[ha].length){var va=this._getSourceName(ha);1<U.length&&this.activeSourceIndex===this._allIndex&&F.create("div",{className:this.css.searchMenuHeader,
textContent:va},Y);va=F.create("ul",{role:"menu"},Y);for(var Aa=U[ha].maxSuggestions||this.maxSuggestions,q=0;q<g[ha].length&&q<Aa;++q){var E=F.create("li",{"data-index":q,"data-source-index":ha,role:"menuitem",tabindex:0},va),T=this._getSuggestionName(g[ha][q]);T=this._splitResult(T,L);for(var ba=T.length,pa=0;pa<ba;pa++){var xa=T[pa];xa.toLowerCase()===L.toLowerCase()?F.create("strong",{textContent:xa},E):(xa=document.createTextNode(xa),F.place(xa,E))}}}}Y?(F.place(Y,this.suggestionsNode,"only"),
this._showSuggestionsMenu()):(F.empty(this.suggestionsNode),this._hideSuggestionsMenu())}},_insertSources:function(g){if(this.enableSourcesMenu&&g&&1<g.length){var L,U=this.activeSourceIndex,Y=F.create("ul",{role:"menu"});if(this.enableSearchingAll){var ha="";U===this._allIndex&&(ha="active");F.create("li",{"data-index":this._allIndex,role:"menuitem",className:ha,tabIndex:0,textContent:w.widgets.Search.main.all},Y)}for(L=0;L<g.length;L++){ha="";L===U&&(ha=this.css.activeSource);var va=this._getSourceName(L);
F.create("li",{"data-index":L,role:"menuitem",className:ha,tabIndex:0,textContent:va},Y)}h.add(this.containerNode,this.css.hasMultipleSources);F.place(Y,this.sourcesNode,"only")}else h.remove(this.containerNode,this.css.hasMultipleSources),F.empty(this.sourcesNode)},_showLoading:function(){h.add(this.containerNode,this.css.searchLoading)},_hideLoading:function(){h.remove(this.containerNode,this.css.searchLoading)},_checkStatus:function(){this.value?(h.add(this.containerNode,this.css.hasValue),n.set(this.clearNode,
"title",w.widgets.Search.main.clearButtonTitle)):this.clear()},_closePopup:function(){this.enableInfoWindow&&this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_noResults:function(g){var L;g&&(L=u.trim(g));var U=F.create("div",{className:this.css.searchNoResultsBody});g&&L?(F.create("div",{className:this.css.searchNoResultsHeader,textContent:w.widgets.Search.main.noResults},U),F.create("div",{className:this.css.searchNoResultsText,textContent:a.substitute({value:'"'+g+'"'},w.widgets.Search.main.noResultsFound)},
U)):(g=F.create("div",{},U),F.create("span",{"aria-hidden":"true",className:this.css.searchNoValueIcon},g),F.create("span",{className:this.css.searchNoValueText,textContent:w.widgets.Search.main.emptyValue},g));F.place(U,this.noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){h.remove(this.containerNode,this.css.showNoResults)},_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();
h.add(this.containerNode,this.css.showNoResults)},_hideSourcesMenu:function(){h.remove(this.containerNode,this.css.showSources)},_hideSuggestionsMenu:function(){h.remove(this.containerNode,this.css.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();h.add(this.containerNode,this.css.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();this._hideNoResultsMenu();h.add(this.containerNode,this.css.showSuggestions)},_toggleSourcesMenu:function(){this._hideSuggestionsMenu();
this._hideNoResultsMenu();h.toggle(this.containerNode,this.css.showSources)},_getFirstStringField:function(g){if(g&&(g=g.fields)&&g.length)for(var L=0;L<g.length;L++){var U=g[L];if("esriFieldTypeString"===U.type)return U.name}return""},_getDisplayField:function(g){return g.displayField||g.featureLayer.displayField||this._getFirstStringField(g.featureLayer)},_validLocation:function(g){return g&&"number"===typeof g.x&&"number"===typeof g.y},_validExtent:function(g){return g&&"number"===typeof g.xmin&&
"number"===typeof g.ymin&&"number"===typeof g.xmax&&"number"===typeof g.ymax},_hydrateResult:function(g,L,U){var Y={},ha=this._defaultSR;L=this.sources[L];this.map&&(ha=this.map.spatialReference);if(g.hasOwnProperty("text")&&g.hasOwnProperty("magicKey"))return g;if(g.hasOwnProperty("geometry")){var va=new la(g.toJson());Y.feature=va;(va=Y.feature.geometry)&&va.setSpatialReference(ha)}else if(g.hasOwnProperty("location")&&this._validLocation(g.location)){var Aa=new da(g.location.x,g.location.y,ha);
va={};g.hasOwnProperty("attributes")&&(va=g.attributes);g.hasOwnProperty("address")&&"object"===typeof g.address&&u.mixin(va,g.address);g.hasOwnProperty("score")&&(va.score=g.score);Y.feature=new la(Aa,null,va,null)}!Y.feature&&U&&(va={},g.hasOwnProperty("attributes")&&(va=g.attributes),g.hasOwnProperty("score")&&(va.score=g.score),Y.feature=new la(null,null,va,null));if(Y.feature){if(g.hasOwnProperty("extent")&&this._validExtent(g.extent))Y.extent=new ra(g.extent),Y.extent.setSpatialReference(ha);
else if(Y.feature&&Y.feature.geometry)switch(Y.feature.geometry.type){case "extent":Y.extent=Y.feature.geometry;break;case "multipoint":Y.extent=qa.getDenormalizedExtent(Y.feature.geometry);break;case "polygon":Y.extent=qa.getDenormalizedExtent(Y.feature.geometry);break;case "polyline":Y.extent=qa.getDenormalizedExtent(Y.feature.geometry);break;case "point":this.map?(ha=this.zoomScale,L&&L.zoomScale&&(ha=L.zoomScale),this._getScale()>ha?Y.extent=wa.getExtentForScale(this.map,ha).centerAt(Y.feature.geometry):
Y.extent=this.map.extent.centerAt(Y.feature.geometry)):Y.extent=new ra({xmin:Y.feature.geometry.x-.25,ymin:Y.feature.geometry.y-.25,xmax:Y.feature.geometry.x+.25,ymax:Y.feature.geometry.y+.25,spatialReference:this._defaultSR})}else Y.extent=null;Y.name="";L.featureLayer?L.suggestionTemplate&&U?Y.name=a.substitute(g.attributes,L.suggestionTemplate):L.searchTemplate?Y.name=a.substitute(g.attributes,L.searchTemplate):(va=this._getDisplayField(L),U=L.featureLayer.getField(va),ha=L.featureLayer.getDomain(va),
va&&g.hasOwnProperty("attributes")&&g.attributes.hasOwnProperty(va)&&(g=g.attributes[va],ha&&"codedValue"===ha.type?Y.name=this._getCodedName(ha.codedValues,g):U&&"esriFieldTypeDate"===U.type&&!isNaN(g)?Y.name=H.format(new Date(g)):Y.name=g)):g.address&&L.searchTemplate?Y.name=a.substitute(g.address,L.searchTemplate):g.hasOwnProperty("name")?Y.name=g.name:g.hasOwnProperty("attributes")&&"object"===typeof g.attributes&&g.attributes.LongLabel?Y.name=g.attributes.LongLabel:g.hasOwnProperty("attributes")&&
"object"===typeof g.attributes&&g.attributes.Match_addr?(Y.name=g.attributes.Match_addr,g.attributes.Addr_type&&"POI"===g.attributes.Addr_type&&g.attributes.StAddr&&g.attributes.City?Y.name+=" - "+g.attributes.StAddr+", "+g.attributes.City:g.attributes.Addr_type&&"POI"===g.attributes.Addr_type&&g.attributes.City&&(Y.name+=" - "+g.attributes.City)):g.hasOwnProperty("address")&&"string"===typeof g.address?Y.name=g.address:g.hasOwnProperty("address")&&"object"===typeof g.address&&g.address.hasOwnProperty("Address")?
g.address.hasOwnProperty("Match_addr")?Y.name=g.address.Match_addr:g.address.hasOwnProperty("Address")&&(Y.name=g.address.Address):Y.feature&&Y.feature.geometry&&(Y.name=Y.feature.geometry.x+","+Y.feature.geometry.y);L.featureLayer&&Y.feature&&ta(Y.feature,L.featureLayer);return Y}},_getScale:function(){var g;this.map&&"function"===typeof this.map.getScale&&(g=this.map.getScale());return g},_hydrateResults:function(g,L,U){var Y=[],ha=0;if(g&&g.length)for(ha;ha<g.length;ha++){var va=this._hydrateResult(g[ha],
L,U);va&&Y.push(va)}return Y},_containsNonLatinCharacter:function(g){for(var L=0;L<g.length;L++)if(255<g.charCodeAt(L))return!0;return!1},_setPlaceholder:function(g){var L="",U=this.sources[g];g===this._allIndex?L=this.allPlaceholder||w.widgets.Search.main.allPlaceholder:U&&U.placeholder&&(L=U.placeholder);var Y=w.widgets.Search.main.all;U&&(Y=this._getSourceName(g));n.set(this.sourceNameNode,"textContent",Y);n.set(this.inputNode,"placeholder",L);n.set(this.inputNode,"title",L)},_updateActiveSource:function(){var g=
this.sources,L=this.activeSourceIndex,U;g&&g[L]&&(U=g[L]);U?this.set("activeSource",U):this.set("activeSource",null)},_updateVisible:function(){this.visible?this.show():this.hide()},_updateButtonMode:function(g){g?(h.toggle(this.containerNode,this.css.searchExpanded,this.expanded),h.toggle(this.containerNode,this.css.searchCollapsed,!this.expanded),h.add(this.containerNode,this.css.hasButtonMode)):(h.remove(this.containerNode,this.css.searchExpanded),h.remove(this.containerNode,this.css.searchCollapsed),
h.remove(this.containerNode,this.css.hasButtonMode))},_setDefaultActiveSourceIndex:function(g){g&&1===g.length||!this.enableSearchingAll?this.set("activeSourceIndex",0):this.set("activeSourceIndex",this._allIndex)},_setEnableSourcesMenuAttr:function(g){this._set("enableSourcesMenu",g);this._created&&this._insertSources(this.sources)},_setEnableSearchingAllAttr:function(g){this._set("enableSearchingAll",g);this._created&&(this._setDefaultActiveSourceIndex(this.sources),this._hideMenus(),this._insertSources(this.sources))},
_setSourcesAttr:function(g){this._createSourceNameMap(g).then(u.hitch(this,function(L){this._sourceNames=L;this._created&&(this._setDefaultActiveSourceIndex(g),this._hideMenus(),this._insertSources(g))}));this._set("sources",g)},_setAllPlaceholderAttr:function(g){this._set("allPlaceholder",g);this._created&&this._setPlaceholder(this.activeSourceIndex)},_setActiveSourceIndexAttr:function(g){this._set("activeSourceIndex",g);this._updateActiveSource();this._created&&(this._setPlaceholder(g),this._hideMenus(),
this._insertSources(this.sources))},_setMaxLengthAttr:function(g){this._set("maxLength",g);this._created&&n.set(this.inputNode,"maxLength",g)},_setValueAttr:function(g){this.set("magicKey",null);this.set("selectedFeatureId",null);this._set("value",g);this._created&&(n.set(this.inputNode,"value",g),this._checkStatus())},_setVisibleAttr:function(g){this._set("visible",g);this._created&&this._updateVisible()},_setEnableButtonModeAttr:function(g){this._set("enableButtonMode",g);this._created&&this._updateButtonMode(g)},
_setThemeAttr:function(g){this._created&&(h.remove(this.domNode,this.theme),h.add(this.domNode,g));this._set("theme",g)}});e("extend-esri")&&u.setObject("dijit.Search",W,fa);return W})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(V,W,u,O,X,N,y,r,d,e,l){V=V(e,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],
"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(m){this._geocodeHandler=W.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=W.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=W.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(m){this.outSpatialReference=m},_geocodeHandler:function(m,
n,h,x,F){try{var H=m.candidates;n=[];var w,G=H.length,Q=m.spatialReference,S;for(w=0;w<G;w++){var M=H[w];if(S=M.location)S.spatialReference=Q;n[w]=new l(M)}this._successHandler([n],"onAddressToLocationsComplete",h,F)}catch(R){this._errorHandler(R,x,F)}},_geocodeAddressesHandler:function(m,n,h,x,F){try{var H=m.locations;n=[];var w,G=H.length,Q=m.spatialReference,S;for(w=0;w<G;w++){if(S=H[w].location)S.spatialReference=Q;n[w]=new l(H[w])}this._successHandler([n],"onAddressesToLocationsComplete",h,F)}catch(M){this._errorHandler(M,
x,F)}},addressToLocations:function(m,n,h,x,F){var H;if(m.address){x=h;h=n;n=m.outFields;F=m.searchExtent;var w=m.countryCode;var G=m.magicKey;var Q=m.distance;var S=m.categories;m.location&&this.normalization&&(H=m.location.normalize());var M=m.locationType;var R=m.maxLocations;var C=m.forStorage;m=m.address}F&&(F=F.shiftCentralMeridian());var a=this.outSpatialReference;m=this._encode(W.mixin({},this._url.query,m,{f:"json",outSR:a&&X.toJson(a.toJson()),outFields:n&&n.join(",")||null,searchExtent:F&&
X.toJson(F.toJson()),category:S&&S.join(",")||null,countryCode:w||null,magicKey:G||null,distance:Q||null,location:H||null,locationType:M||null,maxLocations:R||null,forStorage:C||null}));var B=this._geocodeHandler,fa=this._errorHandler,ka=new O(d._dfdCanceller);ka._pendingDfd=r({url:this._url.path+"/findAddressCandidates",content:m,callbackParamName:"callback",load:function(la,oa){B(la,oa,h,x,ka)},error:function(la){fa(la,x,ka)}});return ka},suggestLocations:function(m){var n=new O(d._dfdCanceller);
m.hasOwnProperty("location")&&this.normalization&&(m.location=m.location.normalize());m.searchExtent&&(m.searchExtent=m.searchExtent.shiftCentralMeridian());m=this._encode(W.mixin({},this._url.query,{f:"json",text:m.text,maxSuggestions:m.maxSuggestions,searchExtent:m.searchExtent&&X.toJson(m.searchExtent.toJson()),category:m.categories&&m.categories.join(",")||null,countryCode:m.countryCode||null,location:m.location||null,distance:m.distance||null},{f:"json"}));m=r({url:this._url.path+"/suggest",
content:m,callbackParamName:"callback"});n._pendingDfd=m;m.then(W.hitch(this,function(h){h=h.suggestions||[];this.onSuggestLocationsComplete(h);n.resolve(h)}),W.hitch(this,function(h){this._errorHandler(h);n.reject(h)}));return n},addressesToLocations:function(m,n,h){var x=this.outSpatialReference,F=[],H=m.categories,w=m.locationType,G=m.countryCode;u.forEach(m.addresses,function(R,C){F.push({attributes:R})});m=this._encode(W.mixin({},this._url.query,{category:H&&H.join(",")||null,locationType:w||
null,sourceCountry:G||null},{addresses:X.toJson({records:F})},{f:"json",outSR:x&&X.toJson(x.toJson())}));var Q=this._geocodeAddressesHandler,S=this._errorHandler,M=new O(d._dfdCanceller);M._pendingDfd=r({url:this._url.path+"/geocodeAddresses",content:m,callbackParamName:"callback",load:function(R,C){Q(R,C,n,h,M)},error:function(R){S(R,h,M)}});return M},_reverseGeocodeHandler:function(m,n,h,x,F){try{var H=new l({address:m.address,location:m.location,score:100});this._successHandler([H],"onLocationToAddressComplete",
h,F)}catch(w){this._errorHandler(w,x,F)}},locationToAddress:function(m,n,h,x){m&&this.normalization&&(m=m.normalize());var F=this.outSpatialReference;m=this._encode(W.mixin({},this._url.query,{outSR:F&&X.toJson(F.toJson()),location:m&&X.toJson(m.toJson()),distance:n,f:"json"}));var H=this._reverseGeocodeHandler,w=this._errorHandler,G=new O(d._dfdCanceller);G._pendingDfd=r({url:this._url.path+"/reverseGeocode",content:m,callbackParamName:"callback",load:function(Q,S){H(Q,S,h,x,G)},error:function(Q){w(Q,
x,G)}});return G},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});N("extend-esri")&&W.setObject("tasks.Locator",V,y);return V})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(V,W,u,O,X){V=V(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(N){W.mixin(this,N);this.location=
new X(this.location)}});u("extend-esri")&&W.setObject("tasks.AddressCandidate",V,O);return V})},"esri/styles/basic":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/has","../kernel","../Color"],function(V,W,u,O,X){function N(l,m){if(l){var n={};n.color=new X(l.color);n.opacity=l.opacity||1;switch(m){case "point":n.outline={color:new X(l.outline.color),width:l.outline.width};n.size=l.size;break;case "line":n.width=l.width;break;case "polygon":n.outline={color:new X(l.outline.color),width:l.outline.width}}}return n}
function y(l){if("esriGeometryPoint"===l||"esriGeometryMultipoint"===l)l="point";else if("esriGeometryPolyline"===l)l="line";else if("esriGeometryPolygon"===l||"esriGeometryMultiPatch"===l)l="polygon";return l}var r={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},
{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},secondary:[{color:[128,128,128,1],outline:{color:[255,255,255,.25],width:1},
opacity:.8},{color:[255,255,255,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]},dark:{primary:{color:[227,139,79,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},secondary:[{color:[178,178,178,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},{color:[26,26,26,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]}}}},d={};(function(){var l,m,n;for(l in r){var h=r[l];var x=h.basemapGroups;var F=d[l]={basemaps:[].concat(x.light).concat(x.dark),point:{},line:{},polygon:{}};for(m in x){var H=
x[m];for(n=0;n<H.length;n++){var w=H[n];h.pointSchemes&&(F.point[w]=h.pointSchemes[m]);h.lineSchemes&&(F.line[w]=h.lineSchemes[m]);h.polygonSchemes&&(F.polygon[w]=h.polygonSchemes[m])}}}})();var e={getAvailableThemes:function(l){var m=[],n;for(n in r){var h=r[n];var x=d[n];l&&-1===V.indexOf(x.basemaps,l)||m.push({name:h.name,label:h.label,description:h.description,basemaps:x.basemaps.slice(0)})}return m},getSchemes:function(l){var m=l.theme,n=l.basemap,h=y(l.geometryType);l=d[m];var x;(l=(l=l&&l[h])&&
l[n])&&(x={primaryScheme:N(l.primary,h),secondarySchemes:V.map(l.secondary,function(F){return N(F,h)})});return x},cloneScheme:function(l){if(l){var m=W.mixin({},l);m.color&&(m.color=new X(m.color));m.outline&&(m.outline={color:m.outline.color&&new X(m.outline.color),width:m.outline.width})}return m}};u("extend-esri")&&W.setObject("styles.basic",e,O);return e})},"widgets/NearMe/searchSourceUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/when dojo/promise/all jimu/portalUtils esri/lang esri/request".split(" "),
function(V,W,u,O,X,N,y,r){return{map:null,layerInfosObj:null,appConfig:null,_esriLocatorRegExp:/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,setMap:function(d){this.map=d},setLayerInfosObj:function(d){this.layerInfosObj=d},setAppConfig:function(d){this.appConfig=d},getConfigInfo:function(d){if(d&&d.sources&&0<d.sources.length){var e=null;return this.searchLayer(this.map)&&d.upgradeFromGeocoder?(e=this.map.itemInfo.itemData.applicationProperties.viewing.search,e=W.map(e.layers,
V.hitch(this,function(l,m){m.hintText=l;return this._getQueryTypeGeocoder(m)},e.hintText)),X(e).then(V.hitch(this,function(l){d.sources=[].concat(l).concat(d.sources);return d}))):d}return O(this._getSoucesFromPortalAndWebmap()).then(V.hitch(this,function(l){return{allPlaceholder:"",showInfoWindowOnSelect:!0,sources:l}}))},_getSoucesFromPortalAndWebmap:function(){var d=[],e=null;this.searchLayer(this.map)&&(e=this.map.itemInfo.itemData.applicationProperties.viewing.search,W.forEach(e.layers,V.hitch(this,
function(l,m){m.hintText=l;d.push(this._getQueryTypeGeocoder(m))},e.hintText)));return N.getPortalSelfInfo(this.appConfig.portalUrl).then(V.hitch(this,function(l){if((l=l.helperServices&&l.helperServices.geocode)&&0<l.length)for(var m=0,n=l.length;m<n;m++){var h=l[m];h&&d.push(this._processSingleLine(h))}return X(d).then(V.hitch(this,function(x){for(var F=[],H=0;H<x.length;H++){var w=x[H];w&&(w&&"query"===w.type?F.push(w):(w={name:w.name||this._getGeocodeName(w.url),url:w.url,singleLineFieldName:w.singleLineFieldName,
placeholder:w.placeholder||window.jimuNls.common.findAddressOrPlace||w.name||this._getGeocodeName(w.url),maxResults:6,searchInCurrentMapExtent:!1,type:"locator"},w.enableLocalSearch=this._isEsriLocator(w.url),w.localSearchMinScale=3E5,w.localSearchDistance=5E4,F.push(w)))}return F}))}))},_getQueryTypeGeocoder:function(d){var e=this.map.getLayer(d.id),l=null,m=null,n=null;n=y.isDefined(d.subLayer)?d.id+"_"+d.subLayer:d.id;l=this.layerInfosObj.traversal(function(h){return h.id===n?(m=h,!0):!1});return e&&
l&&m?(l=y.isDefined(d.subLayer)?m.url||e.url+"/"+d.subLayer:m.url||e.url,{name:m.title,layerId:n,url:l,placeholder:d.hintText||window.jimuNls.common.findAddressOrPlace,searchFields:[d.field.name],displayField:d.field.name,exactMatch:d.field.exactMatch||!1,maxResults:6,searchInCurrentMapExtent:!1,type:"query"}):null},_isEsriLocator:function(d){this._esriLocatorRegExp.lastIndex=0;return this._esriLocatorRegExp.test(d)},_processSingleLine:function(d){if(d.singleLineFieldName)return d;if(this._isEsriLocator(d.url))return d.singleLineFieldName=
"SingleLine",d;var e=new u;r({url:d.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(V.hitch(this,function(l){l.singleLineAddressField&&l.singleLineAddressField.name?(d.singleLineFieldName=l.singleLineAddressField.name,e.resolve(d)):(console.warn(d.url+"has no singleLineFieldName"),e.resolve(null))}),V.hitch(this,function(l){console.error(l);e.resolve(null)}));return e.promise},_getGeocodeName:function(d){if("string"!==typeof d)return"geocoder";d=d.split("/");return d[d.length-
2]||"geocoder"},getGeocoderName:function(d){return this._getGeocodeName(d)},hasAppSearchInfo:function(d){return d.itemInfo&&d.itemInfo.itemData&&d.itemInfo.itemData.applicationProperties&&d.itemInfo.itemData.applicationProperties.viewing&&d.itemInfo.itemData.applicationProperties.viewing.search},searchLayer:function(d){if(!this.hasAppSearchInfo(d))return!1;d=d.itemInfo.itemData.applicationProperties.viewing.search;return d.enabled&&d.layers&&0!==d.layers.length?!0:!1}}})},"widgets/NearMe/item-list":function(){define("require dojo/_base/declare dijit/_WidgetBase dojo/dom-construct dojo/query dojo/_base/array jimu/utils dojo/_base/lang dijit/layout/ContentPane dojo/dom-attr dojo/dom-style dojo/dom-class dojo/on dojo/Deferred dojo/Evented dojo/promise/all jimu/dijit/Message jimu/dijit/TabContainer dojo/text!./item-list.html esri/Color esri/dijit/Directions esri/dijit/PopupTemplate esri/graphic esri/geometry/Point esri/geometry/Polyline esri/geometry/Polygon esri/SpatialReference esri/geometry/geometryEngine esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/symbols/jsonUtils esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/tasks/query esri/tasks/RelationshipQuery esri/units dojo/_base/fx dojo/number jimu/LayerInfos/LayerInfos jimu/FilterManager esri/geometry/webMercatorUtils dijit/registry jimu/dijit/EditorXssFilter esri/renderers/jsonUtils jimu/symbolUtils esri/geometry/Multipoint dojo/keys dijit/focus dojo/string esri/geometry/scaleUtils ./libs/swiper dojo/text!./swiperLayout.html dojo/_base/event ./closestGeodesicDistanceUtils".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R,C,a,B,fa,ka,la,oa,P,na,ma,J,z,I,da,ra,qa,wa,Ca,b,f,D,t,Z,ca,ta,g,L,U,Y,ha,va,Aa){return W([u,x],{_itemListTemplate:G,_serviceArea:null,_operationalLayers:null,_selectedPoint:null,_panels:{},_currentPanel:null,map:null,config:null,folderUrl:null,loading:null,nls:null,parentDiv:null,outerContainer:null,_featureListContent:null,_featureInfoPanel:null,_directionInfoPanel:null,_tabContainer:null,_isNoFeature:null,_isSlide:!0,_loadAttachmentTimer:null,
_failedLayers:[],_routeCalculated:!1,_selectedLayer:null,_selectedItem:null,_selectedFeature:null,_selectedFeatureItem:null,_featureGraphicsLayer:null,_directionsWidget:null,_layerCount:null,_tables:[],_searchedFeatures:{},_attributeSearchList:null,_filterIcon:null,_proximityIcon:null,_gallerySwiper:[],_mediaRefreshTimers:null,_allContentPanes:[],_allLayersAreHidden:!1,postCreate:function(){this._allLayersAreHidden=!1;this._proximityIcon=this._filterIcon=null;this._gallerySwiper=[];this._allContentPanes=
[];this._tables=[];this._panels={};this._failedLayers=[];this._operationalLayers=null;this._searchedFeatures={};this._attributeSearchList=null;this._tablesLayer={};this.domNode=O.create("div",{"class":"esriCTItemListMainContainer"},this.outerContainer);this.updateListHeight();this.filterManager=Ca.getInstance();this._getUpdatedLayerFilters();this._createPanels();this._loadFeatureLayers();this._featureGraphicsLayer=new oa;this.map.addLayer(this._featureGraphicsLayer);this.editorXssFilter=D.getInstance()},
updateListHeight:function(){var q=l.get(this.searchOuterContainer,"height");q+=23;l.set(this.filterListMainDiv,"height","calc(100% - "+q+"px)");l.set(this.domNode,"height","calc(100% - "+q+"px)")},_createPanels:function(){this._panels.layerListPanel=O.create("div",{"class":"esriCTLayerList"},this.domNode);this._panels.featureListPanel=O.create("div",{"class":"esriCTFeatureList"},this.domNode);var q=O.toDom(this._itemListTemplate).childNodes[0];e.set(q,"tabindex",0);m.add(q,"esriCTPanelHeader");this._panels.featureListPanel.appendChild(q);
this._featureListContent=O.create("div",{"class":"esriCTFeatureListContent"},null);l.set(this._featureListContent,"color",this.config.fontColor);this._panels.featureListPanel.appendChild(this._featureListContent);this._attachEventOnBackButton(this._panels.featureListPanel);this._panels.infoPanel=O.create("div",{"class":"esriCTDirectionInfoPanel"},this.domNode);q=O.toDom(this._itemListTemplate).childNodes[0];e.set(q,"tabindex",0);m.add(q,"esriCTPanelHeader");this._panels.infoPanel.appendChild(q);this._attachEventOnBackButton(this._panels.infoPanel);
this._featureInfoPanel=new d({},null);this._featureInfoPanel.startup();this.config.enableDirection?(this._directionInfoPanel=new d({},null),this._directionInfoPanel.startup(),this._tabContainer=new w({tabs:[{title:this.nls.informationTabTitle,content:this._featureInfoPanel},{title:this.nls.directionTabTitle,content:this._directionInfoPanel}]},O.create("div",{"class":"esriCTTabContainer"},this._panels.infoPanel)),this._tabContainer.startup(),e.set(this._featureInfoPanel.domNode,"tabindex",0),e.set(this._featureInfoPanel.domNode,
"role","document"),m.add(this._featureInfoPanel.domNode,"esriCTInfoPanelFocus"),q={"class":"esriCTProximityParent"},void 0===this.config.enableProximitySearch||this.config.enableProximitySearch||(q.style="display: none"),q=O.create("div",q,this._panels.infoPanel),this.own(this._tabContainer.on("tabChanged",r.hitch(this,function(E){this.emit("tab-change",E);E===this.nls.directionTabTitle?this._routeCalculated?"block"===l.get(this.proximityButton.parentElement,"display")?y.initLastFocusNode(this.domNodeObj,
this.proximityButton):this.emit("setLastNodeInFeatureInfo",y.getFocusNodesInDom(this._directionsWidget.domNode).reverse()[0]):this._initializeDirectionWidget():this._getFeatureInfoLastNode();this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()})))):(this._panels.infoPanel.appendChild(this._featureInfoPanel.domNode),m.add(this._featureInfoPanel.domNode,"esriCTFeatureInfo"),e.set(this._featureInfoPanel.domNode,"tabindex",0),e.set(this._featureInfoPanel.domNode,
"role","document"),(q=X(".esriCTItemListMainContainer .esriCTDirectionInfoPanel .esriCTPanelHeader"))&&m.add(q[0],"esriCTBorderBottom"),q={"class":"esriCTProximityParent",style:"bottom: 0px"},void 0===this.config.enableProximitySearch||this.config.enableProximitySearch||(q.style="display: none"),q=O.create("div",q,this._panels.infoPanel));this.proximityButton=O.create("div",{"class":"esriCTProximityIconContainer",title:this.nls.proximityButtonTooltip,"aria-label":this.nls.proximityButtonTooltip,tabindex:"0",
role:"button"},q);this._proximityIcon=O.create("div",{"class":"esriCTProximityIcon",style:{"background-color":this.selectedThemeColor}},this.proximityButton);this.own(n(this.proximityButton,"click",r.hitch(this,function(){this._selectedFeature&&this._selectedFeature.geometry&&this.emit("init-proximity",new R(this._selectedFeature.geometry))})));this.own(n(this.proximityButton,"keydown",r.hitch(this,function(E){(E.keyCode===ta.ENTER||E.keyCode===ta.SPACE)&&this._selectedFeature&&this._selectedFeature.geometry&&
this.emit("init-proximity",new R(this._selectedFeature.geometry))})));this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();this._attachEventToTab()},_attachEventOnBackButton:function(q){var E=X(".esriCTItemlList",q)[0];var T=X(".esriCTBackButton",q)[0];E&&T&&this.own(n(E,"click, keypress",r.hitch(this,function(ba){if("keypress"===ba.type){var pa=ba.charCode||ba.keyCode;if(pa!==ta.ENTER&&pa!==ta.SPACE)return}ba.stopPropagation();"none"!==l.get(T,
"display")&&this._isSlide&&(this._isSlide=!1,this._selectedItem=null,this._clearGrahics(),this._clearDirections(),this._clearMediaRefreshTimers(),this._isFeatureList?(this._isFeatureList=!1,this._showPanel("featureListPanel",!0),g.focus(X(".esriCTItemlList[tabindex\x3d'0']",this._featureListContent)[0])):(this.loading.hide(),this._clearContent(this._featureListContent),this.config.selectedSearchLayerOnly&&this.showLayersOnBackToLayerList(),this._selectedLayer=null,this._isFeatureList=!1,this._showPanel("layerListPanel",
!0),g.focus(X(".esriCTItemlList[tabindex\x3d'0']",this._panels.layerListPanel)[0])))})))},_loadFeatureLayers:function(){var q;this._operationalLayers=[];this._tables=this.map.webMapResponse.itemInfo.itemData.tables;for(q=0;q<this.config.searchLayers.length;q++)this.config.searchLayers[q].popupInfo||this.config.searchLayers.splice(q,1);for(q=0;q<this.config.searchLayers.length;q++)if(this.config.searchLayers[q].popupInfo){var E=new la(this.config.searchLayers[q].url,{infoTemplate:new M(this.config.searchLayers[q].popupInfo)});
E.id=this.config.searchLayers[q].id?this.config.searchLayers[q].id:"FL_"+this.config.searchLayers[q].title+q;E.title=this.config.searchLayers[q].title;this.config.searchLayers[q].definitionExpression&&E.setDefinitionExpression(this.config.searchLayers[q].definitionExpression);this.config.searchLayers[q].renderer&&E.setRenderer(t.fromJson(this.config.searchLayers[q].renderer));E.index=q;E.layerIndex=this._operationalLayers.length;E.isMapServer=this.config.searchLayers[q].isMapServer;E.baseURL=this.config.searchLayers[q].baseURL;
E.showAttachments=this.config.searchLayers[q].popupInfo.showAttachments;this._operationalLayers.push(E);this._onLayerLoad(E)}},_onLayerLoad:function(q){q.loaded?q.tableInfos=this._getRelatedTableInfo(q.index):this.own(q.on("load",r.hitch(this,function(){q.tableInfos=this._getRelatedTableInfo(q.index)})))},_getRelatedTableInfo:function(q){var E,T=[];(E=this._operationalLayers[q])&&N.forEach(E.relationships,r.hitch(this,function(ba){N.forEach(this._tables,r.hitch(this,function(pa,xa){pa.url.replace(/.*?:\/\//g,
"")===(E.baseURL+ba.relatedTableId).replace(/.*?:\/\//g,"")&&pa.popupInfo&&(pa.relationshipIds||(pa.relationshipIds={}),pa.relationshipIds[E.id]=ba.id,T.push(xa),this._tablesLayer[pa.id]=new la(pa.url),this._tablesLayer[pa.id].showAttachments=!0)}))}));return T},hasValidLayers:function(){return this._operationalLayers&&0<this._operationalLayers.length?!0:!1},_clearContent:function(q){q&&O.empty(q)},displayLayerList:function(q,E,T){var ba=[];this.loading.hide();this._layerCount=0;this._isSlide=this._isNoFeature=
!0;this._attributeSearchList=null;T?(this._attributeSearchList=T,this._tabContainer&&this._tabContainer.controlNode&&(l.set(this._tabContainer.controlNode,"display","none"),m.add(this._tabContainer.containerNode,"esriCTTopBorder"))):this._tabContainer&&this._tabContainer.controlNode&&(l.set(this._tabContainer.controlNode,"display","block"),m.remove(this._tabContainer.containerNode,"esriCTTopBorder"));this.clearResultPanel();this._getUpdatedLayerFilters();this._searchedFeatures={};this.config.showAllLayers&&
this.showAllLayers();this._setSearchedLocation(q);this._setServiceArea(E);this._failedLayers=[];this._filterConfiguredLayer(ba);F(ba).then(r.hitch(this,function(){var pa=X(".esriCTItemlList[tabindex\x3d'0']",this._panels.layerListPanel);pa&&0<pa.length&&(this._currentPanelName="layerListPanel",m.add(pa[pa.length-1],"esriCTLastLayerFocusNode"));this._onFeatureCountComplete();this.emit("setLastNode","layerListPanel")}))},_getUpdatedLayerFilters:function(){wa.getInstance(this.map,this.map.webMapResponse.itemInfo).then(r.hitch(this,
function(q){N.forEach(this.config.searchLayers,r.hitch(this,function(E){var T=q.getLayerInfoById(E.id);T&&(E.definitionExpression=T.getFilter())}))}))},_filterConfiguredLayer:function(q){this._currentPanel=this._panels.layerListPanel;l.set(this._currentPanel,"display","block");l.set(this._currentPanel,"left","0px");this._allLayersAreHidden=!0;for(var E=0;E<this._operationalLayers.length;E++)this._resetFilter(this._operationalLayers[E].layerIndex),this._createItemTemplate(this._operationalLayers[E],
q);1===this._operationalLayers.length&&this._getOperationalLayersVisibility(this._operationalLayers[0].url,this._operationalLayers[0].id)&&(l.set(this._panels.layerListPanel,"display","none"),this._onSingleLayerFound(null,this._operationalLayers[0]))},_onSingleLayerFound:function(q,E){if(q){var T=new h;q.push(T)}(q=X(".esriCTBackButton",this._panels.featureListPanel)[0])&&l.set(q,"display","none");this._currentPanel=this._panels.featureListPanel;l.set(this._currentPanel,"display","block");l.set(this._currentPanel,
"left","0px");E&&this._displayFeatureList(E,T)},_onSingleFeatureFound:function(q){this._displayFilteredFeatures(q.attributes[this._selectedLayer.objectIdField]);this._showFeatureDetails(null,q);if(q=X(".esriCTBackButton",this._panels.infoPanel)[0])l.set(q,"display","block"),1===this._layerCount&&l.set(this._panels.featureListPanel,"display","none")},_createItemTemplate:function(q,E){var T=O.toDom(this._itemListTemplate).childNodes[0];m.add(T,"esriCTDisabled");l.set(T,"color",this.config.fontColor);
this._currentPanel.appendChild(T);this._setItemName(T,q.title);this._queryForCountOnly(T,q,E);this._attachClickEvent(T,q,!0)},_setItemName:function(q,E,T){T&&(q=X(T,q)[0]);if(T=X(".esriCTItemName",q)[0])e.set(T,"innerHTML",E),e.set(q,"aria-label",y.stripHTML(E||"")),e.set(q,"title",y.stripHTML(E||""))},_attachClickEvent:function(q,E){this.own(n(q,"click, keypress",r.hitch(this,function(T){if("keypress"===T.type){var ba=T.charCode||T.keyCode;if(ba!==ta.ENTER&&ba!==ta.SPACE)return}!m.contains(q,"esriCTDisabled")&&
this._isSlide&&(T.stopPropagation(),this._isSlide=!1,this._selectedItem=q,(T=X(".esriCTBackButton",this._panels.featureListPanel)[0])&&l.set(T,"display","block"),this._displayFeatureList(E,null))})))},_displayFeatureList:function(q,E){this._clearContent(this._featureListContent);this._selectedLayer=q;if(this.config.enableDirection){var T=X(".jimu-tab",this._panels.infoPanel);var ba=X(".jimu-tab .control",this._panels.infoPanel);var pa=X(".esriCTItemListMainContainer .esriCTDirectionInfoPanel .esriCTPanelHeader");
ba&&ba[0]&&T&&T[0]&&pa&&pa[0]&&("esriGeometryPolygon"===q.geometryType&&this.config.intersectSearchedLocation?(m.add(T[0],"esriCTOverrideHeight"),m.add(ba[0],"esriCTHidden"),m.add(pa[0],"esriCTBorderBottom")):(m.remove(T[0],"esriCTOverrideHeight"),m.remove(ba[0],"esriCTHidden"),m.remove(pa[0],"esriCTBorderBottom")))}this._setItemName(this._panels.featureListPanel,this._selectedLayer.title,".esriCTPanelHeader");this._queryForFeatureList(E)},_getQueryParams:function(q){var E=new z;E.spatialRelationship=
"esriSpatialRelIntersects";E.outSpatialReference=this.map.spatialReference;E.outFields=["*"];if(this._attributeSearchList)this._attributeSearchList[q.id]&&0<this._attributeSearchList[q.id].length?E.objectIds=this._attributeSearchList[q.id]:E.where="1\x3d2";else if(this._serviceArea||this._selectedPoint)E.geometry=this._serviceArea||this._selectedPoint.geometry;return E},_queryForCountOnly:function(q,E,T){var ba;var pa=this._getQueryParams(E);if(ba=this._getOperationalLayersVisibility(E.url,E.id))this._allLayersAreHidden=
!1;this.config.intersectSearchedLocation&&"esriGeometryPolygon"===E.geometryType&&this._selectedPoint&&(pa.geometry=this._selectedPoint.geometry);var xa=new h;pa.where&&"1\x3d2"===pa.where||!ba?(l.set(q,"display","none"),e.set(q,"tabindex","-1"),g.focus(X(".esriCTItemlList[tabindex\x3d'0']",q.parentElement)[0]),this.config.selectedSearchLayerOnly&&this._showHideOperationalLayer(E.url,E.id,!1),xa.resolve()):E.queryFeatures(pa,r.hitch(this,function(Ba){0<Ba.features.length&&ba?(this._selectedLayer=
E,this._layerCount++,this._searchedFeatures[E.id]=Ba.features,this._setItemCount(q,Ba.features.length,!0),this._showFilteredFeaturesOnLoad(Ba.features,E.id)):(l.set(q,"display","none"),e.set(q,"tabindex","-1"),g.focus(X(".esriCTItemlList[tabindex\x3d'0']",q.parentElement)[0]),this.config.selectedSearchLayerOnly&&this._showHideOperationalLayer(E.url,E.id,!1));xa.resolve()}),r.hitch(this,function(){q&&(l.set(q,"display","none"),e.set(q,"tabindex","-1"),g.focus(X(".esriCTItemlList[tabindex\x3d'0']",
q.parentElement)[0]),this.config.selectedSearchLayerOnly&&this._showHideOperationalLayer(E.url,E.id,!1));this._failedLayers.push(E.title);xa.resolve()}));T.push(xa)},_getFeatureLayerDetailsFormArray:function(q){var E;if(this._operationalLayers&&0<this._operationalLayers.length){var T=this._operationalLayers.length;for(E=0;E<T;E++)if(this._operationalLayers[E].id===q)return this._operationalLayers[E]}return null},_showFilteredFeaturesOnLoad:function(q,E){var T,ba="",pa;E=this._getFeatureLayerDetailsFormArray(E);
if(this.config.selectedSearchLayerOnly&&(1<q.length&&(q=this._getSortedFeatureList(q)),pa=this._getMaxResultCountValue(q.length,E.maxRecordCount))){for(T=0;T<pa;T++)ba&&(ba+=","),ba+=q[T].attributes[this._selectedLayer.objectIdField];q=this._selectedLayer.objectIdField+" in ("+ba+")";this._setFilterOnMapLayer(q,E.id,E.url,E.isMapServer)}},_onFeatureCountComplete:function(){if(this._isNoFeature){this.clearResultPanel();l.set(this._panels.layerListPanel,"display","block");l.set(this._panels.layerListPanel,
"left","0px");var q=this.editorXssFilter.sanitize(this.config.noFeatureFoundMessage);q=q?q:this.editorXssFilter.sanitize(this.nls.noFeatureFoundText);if(this._attributeSearchList||this._allLayersAreHidden)q=this.editorXssFilter.sanitize(this.nls.errorInAttributeSearch);O.create("div",{"class":"esriCTNoFeatureFound","aria-label":q,innerHTML:q},this._panels.layerListPanel);this.emit("noFeatureFound")}else 1===this._layerCount&&1!==this._operationalLayers.length&&(l.set(this._panels.layerListPanel,"display",
"none"),this._onSingleLayerFound(null,this._selectedLayer));this._failedLayers.length&&(q=this.nls.unableToFetchResults+"\n\x3c/t\x3e\x3cul\x3e\x3cli\x3e"+this._failedLayers.join("\n \x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e",this._showMessage(q));this.loading.hide();this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()},_queryForFeatureList:function(q){this.loading.show();if(this._searchedFeatures[this._selectedLayer.id])this.config.selectedSearchLayerOnly&&
this._hideAllLayers(),0<this._searchedFeatures[this._selectedLayer.id].length&&this._creatFeatureList(this._searchedFeatures[this._selectedLayer.id]),this.loading.hide(),q&&q.resolve();else{var E=this._getQueryParams(this._selectedLayer);this.config.intersectSearchedLocation&&this._selectedLayer&&"esriGeometryPolygon"===this._selectedLayer.geometryType&&this._selectedPoint&&(E.geometry=this._selectedPoint.geometry);this._selectedLayer.queryFeatures(E,r.hitch(this,function(T){this.config.selectedSearchLayerOnly?
(this._hideAllLayers(),0<T.features.length&&(this._showFilteredFeaturesOnLoad(T.features,this._selectedLayer.id),this._creatFeatureList(T.features))):0<T.features.length&&this._getOperationalLayersVisibility(this._selectedLayer.url,this._selectedLayer.id)&&(this._showFilteredFeaturesOnLoad(T.features,this._selectedLayer.id),this._creatFeatureList(T.features));this.loading.hide();q&&q.resolve()}),r.hitch(this,function(){this.loading.hide();this._failedLayers.push(this._selectedLayer.title);q&&q.resolve()}))}},
resetAllFilters:function(){for(var q=0;q<this._operationalLayers.length;q++)this._resetFilter(this._operationalLayers[q].layerIndex)},_setItemCount:function(q,E,T){var ba=X(".esriCTItemCount",q)[0];X(".esriCTItemName",q);ba&&(m.remove(ba,"esriCTLoadingIcon"),T?(E=this._getMaxResultCountValue(E,this._selectedLayer.maxRecordCount),this.config.showFeaturesCount&&(e.set(ba,"innerHTML","("+qa.format(E)+")"),ba=e.get(q,"title")+" "+qa.format(E),e.set(q,"title",ba),e.set(q,"aria-label",ba)),E&&(this._isNoFeature=
!1,m.remove(q,"esriCTDisabled"),e.set(q,"tabindex","0"),e.set(q,"role","button"),g.focus(X(".esriCTItemlList[tabindex\x3d'0']",q.parentElement)[0]))):(E=qa.format(E.toFixed(2))+" "+this.nls.units[this.config.bufferDistanceUnit.value].acronym,e.set(ba,"innerHTML",E),q&&(ba=e.get(q,"title")+" "+E,e.set(q,"title",ba),e.set(q,"aria-label",ba))))},_getMaxResultCountValue:function(q,E){E||(E=1E3);return!this._attributeSearchList&&this.config.maxResultCount&&this.config.maxResultCount<=E?q<this.config.maxResultCount?
q:this.config.maxResultCount:q<E?q:E},_creatFeatureList:function(q){var E="",T;var ba=X(".esriCTPanelHeader",this._panels.featureListPanel)[0];this._isNoFeature=!1;0<q.length&&(q=this._getSortedFeatureList(q),ba&&this._setItemCount(ba,q.length,!0));var pa=this._getMaxResultCountValue(q.length,this._selectedLayer.maxRecordCount);if(1===pa)this._onSingleFeatureFound(q[0]);else{for(ba=0;ba<pa;ba++){E&&(E+=",");E+=q[ba].attributes[this._selectedLayer.objectIdField];var xa=O.toDom(this._itemListTemplate).childNodes[0];
m.add(xa,"esriCTFeatureListItem");ba===pa-1&&m.add(xa,"esriCTLastFeatureFocusNode");e.set(xa,"tabindex","0");e.set(xa,"role","button");e.set(xa,"aria-label",q[ba].getTitle());this._featureListContent.appendChild(xa);this._setItemName(xa,q[ba].getTitle()||"");this._attributeSearchList||!q[ba].geometry||q[ba].geometry&&"polygon"===q[ba].geometry.type&&this.config.intersectSearchedLocation?(T=X(".esriCTItemCount",xa)[0])&&m.remove(T,"esriCTLoadingIcon"):q[ba].hasOwnProperty("distanceToLocation")&&this._setItemCount(xa,
q[ba].distanceToLocation,!1);this._attachEventOnFeatureDiv(xa,q[ba])}this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();this._displayFilteredFeatures(E);this._showPanel("featureListPanel");g.focus(X(".esriCTItemlList[tabindex\x3d'0']",this._featureListContent)[0]);this.loading.hide();1===pa&&xa.click()}},_displayFilteredFeatures:function(q){this.config.selectedSearchLayerOnly&&(this._showHideOperationalLayer(this._selectedLayer.url,this._selectedLayer.id,
!0),this._selectedLayer.setDefinitionExpression(this._selectedLayer.objectIdField+" in ("+q+")"))},_setFilterOnMapLayer:function(q,E,T,ba){E&&(ba?(E=E.substring(0,E.lastIndexOf("_")),(T=this.map.getLayer(E))&&this.filterManager.applyWidgetFilter(E,this.id,q)):(T=this.map.getLayer(E))&&this.filterManager.applyWidgetFilter(E,this.id,q))},_resetFilter:function(q){var E=this._operationalLayers[q].isMapServer?this._operationalLayers[q].id.substring(0,this._operationalLayers[q].id.lastIndexOf("_")):this._operationalLayers[q].id;
this.filterManager.getWidgetFilter(E,this.id)?(this._setFilterOnMapLayer("",this._operationalLayers[q].id,this._operationalLayers[q].url,this._operationalLayers[q].isMapServer),wa.getInstance(this.map,this.map.webMapResponse.itemInfo).then(r.hitch(this,function(T){var ba;if(ba=T.getLayerInfoById(E)){var pa=ba.getFilter();!pa&&this._operationalLayers[q].isMapServer&&(ba=T.getLayerInfoById(this._operationalLayers[q].id))&&(pa=ba.getFilter());this.config.searchLayers[q].definitionExpression=pa;this._operationalLayers[q].setDefinitionExpression(pa)}}))):
this._operationalLayers[q]&&this.config.searchLayers[q]&&this._operationalLayers[q].setDefinitionExpression(this.config.searchLayers[q].definitionExpression)},_getSortedFeatureList:function(q){var E;var T=this._canGetGeodesicDistance();for(E=0;E<q.length;E++)q[E].distanceToLocation=this._attributeSearchList?q[E].getTitle().toLowerCase():T&&q[E].geometry?this._getGeodesicDistances(q[E].geometry):this._selectedPoint&&q[E].geometry?ka.distance(this._selectedPoint.geometry,q[E].geometry,this.config.bufferDistanceUnit.distanceUnit):
0;q.sort(function(ba,pa){return ba.distanceToLocation<pa.distanceToLocation?-1:ba.distanceToLocation>pa.distanceToLocation?1:0});return q},_canGetGeodesicDistance:function(){var q=new fa(4326);return this.config.isGeodesic&&this._selectedPoint&&b.canProject(this._selectedPoint.geometry,q)?!0:!1},_getGeodesicDistances:function(q){return this._selectedPoint&&this._selectedPoint.geometry&&q?Aa.getGeodesicDistance(this._selectedPoint.geometry,q,this.config.bufferDistanceUnit.distanceUnit):0},_attachEventOnFeatureDiv:function(q,
E){this.own(n(q,"click, keypress",r.hitch(this,function(T){if("keypress"===T.type&&(T=T.charCode||T.keyCode,T!==ta.ENTER&&T!==ta.SPACE))return;this._isFeatureList=!0;(T=X(".esriCTBackButton",this._panels.infoPanel)[0])&&l.set(T,"display","block");this._showFeatureDetails(q,E)})))},_showFeatureDetails:function(q,E){this._setItemName(this._panels.infoPanel,this._selectedLayer.title,".esriCTPanelHeader");this._showPanel("infoPanel");var T=X(".esriCTProximityParent",this.domNode);T&&0<T.length&&(T=T[0],
E.geometry?m.remove(T,"esriCTHidden"):m.add(T,"esriCTHidden"));this._tabContainer&&(this._tabContainer.selectTab(this.nls.informationTabTitle),!E.geometry||this._attributeSearchList?(l.set(this._tabContainer.controlNode,"display","none"),m.add(this._tabContainer.containerNode,"esriCTTopBorder")):(l.set(this._tabContainer.controlNode,"display","block"),m.remove(this._tabContainer.containerNode,"esriCTTopBorder")));this._selectedFeatureItem=q;this._selectedFeature=E;this._clearDirections();this._highlightFeatureOnMap();
this._displayFeatureInfo(E);this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()},_zoomToSelectedPointFeature:function(q){var E;this.config.searchSourceSettings&&this.config.searchSourceSettings.sources&&0<this.config.searchSourceSettings.sources.length&&N.some(this.config.searchSourceSettings.sources,r.hitch(this,function(T){if(T&&T.layerId&&this._selectedLayer.id&&T.layerId===this._selectedLayer.id)return E=U.getExtentForScale(this.map,T.zoomScale).centerAt(q.geometry),
!0}));E?this.map.setExtent(E):this.map.centerAndZoom(q.geometry,this.map.getMaxZoom()-1)},_displayFeatureInfo:function(q){var E;this._loadAttachmentTimer&&clearTimeout(this._loadAttachmentTimer);this._featureInfoPanel&&(this._featureInfoPanel.set("content",""),this._gallerySwiper=[],this._allContentPanes=[],this._attributeSearchList||!q.geometry||q.geometry&&"polygon"===q.geometry.type&&this.config.intersectSearchedLocation||this._addDistanceToLocationInDetailsPanel(q),this._showPopupInfo(q,q._layer),
this.config.attributeSymbology&&(E=this._getConfiguredSymbologyForLayer(this._selectedLayer.id))&&0<E.length&&this._checkAttributeSymbology(q,E));if(this.config.zoomToFeature)if(q.geometry&&"point"===q.geometry.type)if(E=q.geometry,this._selectedPoint){var T=this._getPointFromGeometry(this._selectedPoint.geometry);E={paths:[[[E.x,E.y],[T.x,T.y]]],spatialReference:this.map.spatialReference};E=new a(E);this.map.setExtent(E.getExtent().expand(1.5))}else this._zoomToSelectedPointFeature(q);else q.geometry&&
this.map.setExtent(q.geometry.getExtent().expand(1.5));this._getRelatedRecords(q)},_addDistanceToLocationInDetailsPanel:function(q){if(q.hasOwnProperty("distanceToLocation")){q=qa.format(q.distanceToLocation.toFixed(2))+" "+this.nls.units[this.config.bufferDistanceUnit.value].acronym;q=O.create("div",{innerHTML:L.substitute(this.nls.approximateDistanceTitle,{DistanceToLocation:q}),"class":"esriCTDistanceToLocation"});var E=new d({style:{padding:"0px"}});E.set("content",q);this._featureInfoPanel.addChild(E)}},
_getRelatedRecords:function(q){N.forEach(this._selectedLayer.tableInfos,r.hitch(this,function(E){this._queryRelatedRecords(this._tables[E],q.attributes[this._selectedLayer.objectIdField])}))},_queryRelatedRecords:function(q,E){if(this._selectedLayer&&q){var T=new I;T.objectIds=[parseInt(E,10)];T.outFields=["*"];T.relationshipId=q.relationshipIds[this._selectedLayer.id];q.layerDefinition&&q.layerDefinition.definitionExpression&&(T.definitionExpression=q.layerDefinition.definitionExpression);this._selectedLayer.queryRelatedFeatures(T,
r.hitch(this,function(ba){ba=ba[E];N.forEach(ba?ba.features:[],r.hitch(this,function(pa){pa.setInfoTemplate(new M(q.popupInfo));this._showPopupInfo(pa,this._tablesLayer[q.id])}));this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()}))}},_showPopupInfo:function(q,E){if(this._featureInfoPanel&&q){q._layer||(q._layer=E);q._layer._map||(q._layer._map=this.map);var T=new d({"class":"esriCTPopupInfo"});var ba=q.getContent();var pa=f.byId(ba.id);
T.set("content",ba);this.own(n(pa,"content-update",r.hitch(this,function(){this._getFeatureInfoLastNode();g.focus(this._featureInfoPanel.domNode)})));this._allContentPanes.push(T);this._featureInfoPanel.addChild(T);this._checkAttachments(pa,q,E)}},_checkAttachments:function(q,E,T){m.add(X(".mediaSection",q.domNode)[0],"esriCTHidden");var ba=X(".attachmentsSection",q.domNode)[0];O.empty(ba);m.remove(ba,"hidden");T.hasAttachments&&T.showAttachments?(this.loading.show(),this._loadAttachmentTimer=setTimeout(r.hitch(this,
function(){this._showAttachments(E,ba,T,q)}),500)):this._createGallery(T,ba,[],q)},_showAttachments:function(q,E,T,ba){this.config.showImageGallery?(q=q.attributes[T.objectIdField],O.empty(E),T.queryAttachmentInfos(q,r.hitch(this,function(pa){this.loading.hide();this._createGallery(T,E,pa,ba);this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize()}))):(this.loading.hide(),m.add(E,"esriCTHidden"),this._getFeatureInfoLastNode())},resetGallery:function(){"infoPanel"===
this._currentPanelName&&(!this._tabContainer||this._tabContainer&&this._tabContainer.selected===this.nls.informationTabTitle)&&this._gallerySwiper&&(N.forEach(this._gallerySwiper,function(q){q&&(q.update(),q.slideReset())},this),this._getFeatureInfoLastNode())},_createGallery:function(q,E,T,ba){var pa;this._clearMediaRefreshTimers();this.config.showImageGallery&&(T=this._checkForHyperlinks(T,this._selectedFeature));var xa=T.length,Ba=[];if(T&&0<T.length||q&&q.infoTemplate&&q.infoTemplate.info&&q.infoTemplate.info.mediaInfos&&
0<q.infoTemplate.info.mediaInfos.length){q.infoTemplate&&q.infoTemplate.info&&q.infoTemplate.info.mediaInfos&&(xa+=q.infoTemplate.info.mediaInfos.length);this.loading.show();q=O.create("div",{"class":"esriCTThumbnailContainer"},E);O.create("div",{style:{clear:"both"}},q);var Da=O.toDom(ha);var Ka=X(".swiper-wrapper",Da)[0];var Na=!1;if(T&&0<T.length)for(q=0;q<T.length;q++)if(0>Ba.indexOf(T[q].url))if(Ba.push(T[q].url),-1!==T[q].contentType.indexOf("image")&&T[q].contentType.match(/(\/tiff)/)&&(T[q].contentType=
"application/tiff"),T[q].contentType&&-1<T[q].contentType.indexOf("image")){var Ta=O.create("div",{"class":"swiper-slide"},Ka);var Ya=O.create("img",{alt:T[q].name,"class":"esriCTAttachmentImg",src:T[q].url},Ta);this._attachEventOnImage(Ya,null);Na=!0}else T[q].contentType&&-1<T[q].contentType.toLowerCase().indexOf("video/mp4")?(Ta=O.create("div",{"class":"swiper-slide"},Ka),Ya=O.toDom('\x3cvideo class\x3d"esriCTVideoElement" src\x3d"'+T[q].url+'" height\x3d"auto" width\x3d"100%" controls\x3e\x3csource src\x3d"'+
T[q].url+'" type\x3d"'+T[q].contentType+'" poster\x3d"'+T[q].url+'"\x3e\x3c/video\x3e'),O.place(Ya,Ta),Na=!0):(Ta=O.create("div",{"class":"esriCTNonImageAttachmentContainer",tabindex:"0","aria-label":T[q].name,role:"button",src:T[q].url},E),Ya=this.folderUrl+"images/no-attachment.png",Ya=O.create("img",{alt:"","class":"esriCTNonImageAttachmentImg esriCTAutoHeight",src:Ya},Ta),Ya=O.create("div",{"class":"esriCTImageFormatDiv"},Ta),this._fetchDocumentContentType(T[q],Ya),this._attachEventOnImage(Ta,
null));this._charts=[];this._checkMediaInfos(Ka,ba,Ba).then(r.hitch(this,function(ab){if(Na||ab)O.place(Da,E),pa=new Y(Da,{height:"250px",pagination:".swiper-pagination",nextButton:".swiper-button-next",prevButton:".swiper-button-prev",slidesPerView:1,paginationClickable:!0,spaceBetween:30,loop:!0,a11y:!0}),this.own(n(pa,"onSlideChangeStart",r.hitch(this,function(){N.forEach(X(".esriCTVideoElement",Ka),r.hitch(this,function(Za){Za.pause()}))}))),this.own(n(pa,"imagesReady",r.hitch(this,function(){N.forEach(X(".swiper-slide-duplicate",
Ka),r.hitch(this,function(Za){var Xa;(Xa=X(".esriCTAttachmentImg",Za))&&0<Xa.length&&(Xa=Xa[0],Za=e.get(Xa,"refreshInterval"),this._attachEventOnImage(Xa,Za))}))}))),N.forEach(this._charts,r.hitch(this,function(Za){Za.resize(200,200)})),1===xa&&(pa.nextButton&&0<pa.nextButton.length&&m.add(pa.nextButton[0],"esriCTHidden"),pa.prevButton&&0<pa.prevButton.length&&m.add(pa.prevButton[0],"esriCTHidden"),pa.lockSwipes());this.loading.hide();this._gallerySwiper.push(pa);this._getFeatureInfoLastNode();ba._clearImageHandles&&
ba._clearImageHandles()}))}else this._gallerySwiper.push(null),this._getFeatureInfoLastNode(),ba._clearImageHandles&&ba._clearImageHandles()},_getFeatureInfoLastNode:function(){var q;if("block"===l.get(this.proximityButton.parentElement,"display"))var E=this.proximityButton;if(!E)for(var T=this._allContentPanes.length-1;0<=T&&((q=X(".swiper-pagination-bullet",this._allContentPanes[T].domNode))&&0<q.length?E=q.reverse()[0]:(q=y.getFocusNodesInDom(this._allContentPanes[T].domNode))&&0<q.length&&(E=
q.reverse()[0]),!E);T--);!E&&this._featureInfoPanel&&this._featureInfoPanel.domNode&&(E=this._featureInfoPanel.domNode);if(!E&&(E=this._getInformationTabAsLastFocusNode()))return;E||(E=X(".esriCTItemListMainContainer .esriCTDirectionInfoPanel .esriCTPanelHeader",this.domNode.parentElement)[0]);this.emit("setLastNodeInFeatureInfo",E)},_checkForHyperlinks:function(q,E){var T;var ba=[];ba=E.attributes;for(T in ba)ba.hasOwnProperty(T)&&ba[T]&&String(ba[T]).match(/^(http(s?):)/)&&(String(ba[T]).match(/\.(png|jpg|jpeg|gif|bmp)(\/|$)/i)?
(E={},E.contentType="image/"+String(ba[T]).match(/\.(png|jpg|jpeg|gif|bmp)(\/|$)/i)[1],E.url=ba[T],q.push(E)):String(ba[T]).match(/\.(mp4)(\/?)/i)&&(E={contentType:"video/mp4"},E.url=ba[T],q.push(E)));return q},_checkMediaInfos:function(q,E,T){var ba,pa;var xa=new h;var Ba=[];if(E._mediaInfos&&0<E._mediaInfos.length)var Da=E._mediaInfos;else E&&E.template.info&&E.template.info.mediaInfos&&0<E.template.info.mediaInfos.length&&(Da=E.template.info.mediaInfos);Da&&E._mediaInfos&&0<E._mediaInfos.length?
setTimeout(r.hitch(this,function(){for(var Ka=0;Ka<Da.length;Ka++){var Na=Da[Ka],Ta=0;("image"===Na.type||"image"!==Na.type&&Na.value.fields&&0<Na.value.fields.length)&&0>T.indexOf(Na.value.sourceURL)&&(T.push(Na.value.sourceURL),ba=O.create("div",{"class":"swiper-slide"},q),"image"===Na.type?(Na.hasOwnProperty("refreshInterval")&&(Ta=Na.refreshInterval),pa=O.create("img",{alt:Na.value.sourceURL,"class":"esriCTAttachmentImg",src:Na.value.sourceURL,refreshInterval:Ta},ba),Ta&&e.set("refreshInterval",
Ta),this._attachEventOnImage(pa,Ta)):Ba.push(this._loadMediaCharts(E,Na,ba)))}0<Ba.length?F(Ba).then(r.hitch(this,function(){xa.resolve(!0)})):xa.resolve(!0)}),1E3):xa.resolve(!1);return xa.promise},_loadMediaCharts:function(q,E,T){var ba=new h,pa=this,xa=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];q=E.value.theme||q.chartTheme;r.isString(q)&&(q=q.replace(/\./gi,"/"),-1===q.indexOf("/")&&(q="dojox/charting/themes/"+q));q||(q="esri/dijit/Rainbow");xa.push(q);try{V(xa,function(Ba,Da,
Ka){pa._createChart(T,E,Ba,Da,Ka).then(r.hitch(this,function(){ba.resolve()}))})}catch(Ba){ba.resolve()}return ba.promise},_createChart:function(q,E,T,ba,pa){var xa=E.type;var Ba=E.value;E=new h;T=new T(O.create("div",{"class":"chart"},q));pa&&T.setTheme(pa);switch(xa){case "piechart":T.addPlot("default",{type:"Pie",labels:!1});T.addSeries("Series A",Ba.fields);break;case "linechart":T.addPlot("default",{type:"Markers"});T.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});
T.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});N.forEach(Ba.fields,function(Da,Ka){Da.x=Ka+1});T.addSeries("Series A",Ba.fields);break;case "columnchart":T.addPlot("default",{type:"Columns",gap:3});T.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});T.addSeries("Series A",Ba.fields);break;case "barchart":T.addPlot("default",{type:"Bars",gap:3}),T.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),T.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,
minorLabels:!1}),T.addSeries("Series A",Ba.fields)}new ba(T);T.render();this._charts.push(T);E.resolve();return E.promise},_fetchDocumentContentType:function(q,E){q=(q=/(?:\.([^.]+))?$/.exec(q.name))&&q[1]?"."+q[1].toUpperCase():this.nls.unknownAttachmentExt;e.set(E,"innerHTML",q)},updateImageData:function(q){fetch(q.alt,{cache:"no-cache"}).then(function(E){URL.revokeObjectURL(q.src);E.blob().then(function(T){q.setAttribute("src",URL.createObjectURL(T))})})},_attachEventOnImage:function(q,E){this.own(n(q,
"click",r.hitch(this,function(){this._displayImageAttachments(q,!1)})));this.own(n(q,"keydown",r.hitch(this,function(T){this._displayImageAttachments(q,!0,T)})));E&&(E*=6E4)&&0<E&&(E=setInterval(r.hitch(this,function(){this.updateImageData(q)}),E),this._mediaRefreshTimers.push(E))},_clearMediaRefreshTimers:function(){this._mediaRefreshTimers&&N.forEach(this._mediaRefreshTimers,function(q){clearInterval(q)});this._mediaRefreshTimers=[]},_displayImageAttachments:function(q,E,T){E&&T.keyCode!==ta.ENTER&&
T.keyCode!==ta.SPACE||window.open(e.get(q,"src"))},_onImageLoad:function(q){m.remove(q.target.parentNode,"esriCTImageLoader");this._setImageDimensions(q.target)},_setImageDimensions:function(q){var E=q.parentElement;if(q&&0<q.offsetHeight){e.set(q,"originalHeight",q.offsetHeight);l.set(q,"maxHeight",q.offsetHeight+"px");l.set(q,"maxWidth",q.offsetWidth+"px");var T=parseFloat(e.get(q,"originalHeight"));if(E.offsetHeight<q.offsetHeight||T>E.offsetHeight)T=q.offsetWidth/q.offsetHeight,E=E.offsetHeight-
2,T=Math.floor(E*T),m.remove(q,"esriCTAutoHeight"),l.set(q,"width",T+"px"),l.set(q,"height",E+"px")}},_onError:function(q){m.remove(q.target.parentNode,"esriCTImageLoader")},_setSearchedLocation:function(q){this._selectedPoint=q},_setServiceArea:function(q){this._serviceArea=q},clearResultPanel:function(){this._isFeatureList=!1;this._clearContent(this._panels.layerListPanel);l.set(this._panels.layerListPanel,"display","none");l.set(this._panels.featureListPanel,"display","none");l.set(this._panels.infoPanel,
"display","none");this._clearContent(this._featureListContent);this._clearDirections();this._clearGrahics()},removeGraphicsLayer:function(){this._featureGraphicsLayer&&(this.map.removeLayer(this._featureGraphicsLayer),this._featureGraphicsLayer=null)},_clearGrahics:function(){this._featureGraphicsLayer&&this._featureGraphicsLayer.clear()},_showPanel:function(q,E){l.set(this._panels[q],{display:"block",left:"-100%"});E?(this._slide(this._panels[q],-100,0),this._slide(this._currentPanel,0,100)):(this._slide(this._currentPanel,
0,-100),this._slide(this._panels[q],100,0));this._currentPanelName=q;this._currentPanel=this._panels[q];this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();setTimeout(r.hitch(this,function(){this.emit("setLastNode",q)}),400)},_slide:function(q,E,T){l.set(q,"display","block");l.set(q,"left",E+"%");ra.animateProperty({node:q,properties:{left:{start:E,end:T,units:"%"}},duration:300,onEnd:r.hitch(this,function(){l.set(q,"left",T);0===T?l.set(q,
"display","block"):l.set(q,"display","none");this._isSlide=!0})}).play()},_showMessage:function(q){(new H({message:q})).message=q},_initializeDirectionWidget:function(){if(!this._directionsWidget){f.byId("directionDijit"+this.id)&&f.byId("directionDijit"+this.id).destroy();var q={id:"directionDijit"+this.id,map:this.map,directionsLengthUnits:da[this.config.directionLengthUnit.routeUnit],showTrafficOption:!1,dragging:!1,routeTaskUrl:this.config.routeService,routeSymbol:new ma(this.config.symbols.routeSymbol)};
this.config.helperServices&&this.config.helperServices.printTask&&this.config.helperServices.printTask.url&&(q.printTaskUrl=this.config.helperServices.printTask.url);this._directionsWidget=new S(q,O.create("div",{},null));this._directionsWidget.startup();this.own(this._directionsWidget.on("directions-finish",r.hitch(this,function(){this._directionsWidget.zoomToFullRoute();this.parentDivId&&f.byId(this.parentDivId)&&f.byId(this.parentDivId).resize&&f.byId(this.parentDivId).resize();this.loading.hide();
"block"===l.get(this.proximityButton.parentElement,"display")?y.initLastFocusNode(this.domNodeObj,this.proximityButton):this.emit("setLastNodeInFeatureInfo",y.getFocusNodesInDom(this._directionsWidget.domNode).reverse()[0])})));this._directionInfoPanel.set("content",this._directionsWidget.domNode)}this._routeSelectedLocations()},_clearDirections:function(){this._directionsWidget&&this._routeCalculated&&this._directionsWidget.clearDirections();this._routeCalculated=!1},_getPointFromGeometry:function(q){switch(q.type){case "extent":var E=
q.getCenter();break;case "multipoint":E=q.getPoint(0);break;case "point":E=q;break;case "polygon":E=q.getCentroid();break;case "polyline":E=q.getPoint(0,0)}return E},_routeSelectedLocations:function(){var q=[];this._clearDirections();this._selectedPoint&&this._selectedFeature&&this._selectedFeature.geometry&&(this.loading.show(),q.push(this._getPointFromGeometry(this._selectedPoint.geometry)),q.push(this._getPointFromGeometry(this._selectedFeature.geometry)),this._directionsWidget.updateStops(q).then(r.hitch(this,
function(){this._directionsWidget.getDirections();this._routeCalculated=!0}),r.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.failedToGenerateRouteMsg)})))},_highlightFeatureOnMap:function(){var q;this._clearGrahics();this._selectedFeature&&this._selectedFeature.geometry&&(q=this._getHighLightSymbol(this._selectedFeature,this._selectedLayer))&&q.geometry&&this._featureGraphicsLayer.add(q)},_getHighLightSymbol:function(q,E){switch(q.geometry.type){case "point":case "multipoint":return this._getPointSymbol(q,
E);case "polyline":return this._getPolyLineSymbol(q,E);case "polygon":return this._getPolygonSymbol(q)}},_getHighLightSymbolColor:function(){var q=new Q([0,255,255,1]);this.config.highlightColor&&(q=new Q(this.config.highlightColor),this.config.hasOwnProperty("showSelectionColor")||(this.config.showSelectionColor=!0),q.a=this.config.showSelectionColor?1:0);return q},_getPointSymbol:function(q,E){var T,ba;var pa=!1;var xa=this._getHighLightSymbolColor();xa=new J(J.STYLE_SQUARE,null,new ma(ma.STYLE_SOLID,
xa,3));xa.setColor(null);xa.size=30;if(E&&E.renderer)if(E.renderer.symbol)pa=!0,xa=this._updatePointSymbolProperties(xa,E.renderer.symbol);else if(E.renderer.infos&&0<E.renderer.infos.length){for(ba=0;ba<E.renderer.infos.length;ba++){E.typeIdField?T=q.attributes[E.typeIdField]:E.renderer.attributeField&&(T=q.attributes[E.renderer.attributeField]);var Ba=E.renderer.infos[ba].value;void 0!==T&&null!==T&&""!==T&&void 0!==Ba&&null!==Ba&&""!==Ba&&T.toString()===Ba.toString()&&(pa=!0,xa=this._updatePointSymbolProperties(xa,
E.renderer.infos[ba].symbol))}!pa&&E.renderer.defaultSymbol&&(pa=!0,xa=this._updatePointSymbolProperties(xa,E.renderer.defaultSymbol))}if(q.geometry&&"point"===q.geometry.type)var Da=new C(q.geometry.x,q.geometry.y,new fa({wkid:q.geometry.spatialReference.wkid}));else q.geometry&&"multipoint"===q.geometry.type&&(Da=new ca(new fa({wkid:q.geometry.spatialReference.wkid})),q.geometry.points&&N.forEach(q.geometry.points,function(Ka){Da.addPoint(Ka)}));return new R(Da,xa,q.attributes)},_updatePointSymbolProperties:function(q,
E){if(E.hasOwnProperty("height")&&E.hasOwnProperty("width")){var T=E.height;var ba=E.width;T=(T>ba?T:ba)+10;q.size=T}E.hasOwnProperty("size")&&(!T||T<E.size)&&(q.size=E.size+10);E.hasOwnProperty("xoffset")&&(q.xoffset=E.xoffset);E.hasOwnProperty("yoffset")&&(q.yoffset=E.yoffset);return q},_getPolyLineSymbol:function(q,E){var T,ba;var pa=5;var xa=this._getHighLightSymbolColor();if(E&&E.renderer)if(E.renderer.symbol&&E.renderer.symbol.hasOwnProperty("width"))pa=E.renderer.symbol.width;else if(E.renderer.infos&&
0<E.renderer.infos.length)for(ba=0;ba<E.renderer.infos.length;ba++){E.typeIdField?T=q.attributes[E.typeIdField]:E.renderer.attributeField&&(T=q.attributes[E.renderer.attributeField]);var Ba=E.renderer.infos[ba].value;void 0!==T&&null!==T&&""!==T&&void 0!==Ba&&null!==Ba&&""!==Ba&&T.toString()===Ba.toString()&&E.renderer.infos[ba].symbol.hasOwnProperty("width")&&(pa=E.renderer.infos[ba].symbol.width)}else E.renderer.defaultSymbol&&E.renderer.defaultSymbol.hasOwnProperty("width")&&(pa=E.renderer.defaultSymbol.width);
E=new ma(ma.STYLE_SOLID,xa,pa);var Da=new a(new fa({wkid:q.geometry.spatialReference.wkid}));q.geometry.paths&&0<q.geometry.paths.length&&N.forEach(q.geometry.paths,r.hitch(this,function(Ka){Da.addPath(Ka)}));return new R(Da,E,q.attributes)},_getPolygonSymbol:function(q){var E=this._getHighLightSymbolColor();E=new na(na.STYLE_SOLID,new ma(ma.STYLE_SOLID,E,4),new Q([0,0,0,0]));var T=new B(new fa({wkid:q.geometry.spatialReference.wkid}));q.geometry.rings&&(T.rings=r.clone(q.geometry.rings));return new R(T,
E,q.attributes)},_hideAllLayers:function(){if(this.config.selectedSearchLayerOnly){var q;for(q=0;q<this.config.searchLayers.length;q++)this._showHideOperationalLayer(this.config.searchLayers[q].url,this.config.searchLayers[q].id,!1)}},showAllLayers:function(q){var E;for(E=0;E<this.config.searchLayers.length;E++){var T=q?this.config.searchLayers[E].visibility:!0;this.config.selectedSearchLayerOnly&&this._searchedFeatures[this.config.searchLayers[E].id]&&1>this._searchedFeatures[this.config.searchLayers[E].id].length&&
(T=!1);this._showHideOperationalLayer(this.config.searchLayers[E].url,this.config.searchLayers[E].id,T)}},showLayersOnBackToLayerList:function(){var q;for(q=0;q<this.config.searchLayers.length;q++)if(this.config.selectedSearchLayerOnly){var E=this._searchedFeatures[this.config.searchLayers[q].id]&&0<this._searchedFeatures[this.config.searchLayers[q].id].length?!0:!1;this._showHideOperationalLayer(this.config.searchLayers[q].url,this.config.searchLayers[q].id,E)}},_showHideOperationalLayer:function(q,
E,T){var ba;var pa=q.split("/");pa=pa[pa.length-1];for(ba in this.map._layers)if(this.map._layers.hasOwnProperty(ba))if(E&&this.map._layers[ba].url===q&&this.map._layers[ba].id===E)this.map._layers[ba].setVisibility(T);else if(this.map._layers[ba].visibleLayers&&E&&this.map._layers[ba].id===E.substring(0,E.lastIndexOf("_"))){var xa=this.map._layers[ba].url[this.map._layers[ba].url.length-1];xa="/"===xa?this.map._layers[ba].url+pa:this.map._layers[ba].url+"/"+pa;if(xa===q){xa=this.map._layers[ba].visibleLayers;
var Ba=N.indexOf(xa,parseInt(pa,10));T?-1===Ba&&xa.push(parseInt(pa,10)):-1!==Ba&&xa.splice(Ba,1);this.map._layers[ba].setVisibleLayers?this.map._layers[ba].setVisibleLayers(xa):(this.map._layers[ba].visibleLayers=xa,this.map._layers[ba].setVisibility(T))}}},_getOperationalLayersVisibility:function(q,E){var T;var ba=q.split("/");ba=ba[ba.length-1];for(T in this.map._layers)if(this.map._layers.hasOwnProperty(T)){if(E&&this.map._layers[T].url===q&&this.map._layers[T].id===E)return this.map._layers[T].visible;
if(this.map._layers[T].visibleLayers&&E&&this.map._layers[T].id===E.substring(0,E.lastIndexOf("_"))){var pa=this.map._layers[T].url[this.map._layers[T].url.length-1];pa="/"===pa?this.map._layers[T].url+ba:this.map._layers[T].url+"/"+ba;if(pa===q&&(pa=this.map._layers[T].visibleLayers,pa=N.indexOf(pa,parseInt(ba,10)),-1!==pa))return this.map._layers[T].visible}}return!1},_getConfiguredSymbologyForLayer:function(q){var E=[];if(this.config.attributeSymbology&&this.config.attributeSymbology.hasOwnProperty(q))return this.config.attributeSymbology[q];
this.config.attributeSymbology&&this.config.attributeSymbology.length&&0<this.config.attributeSymbology.length&&N.forEach(this.config.attributeSymbology,r.hitch(this,function(T){T.hasOwnProperty("layerId")&&T.layerId===q&&E.push(T)}));return E},_checkAttributeSymbology:function(q,E){var T;if(T=X(".attachmentsSection",this._featureInfoPanel.domNode)[0]){var ba=O.create("div",{"class":"esriCTAttributeSymbolWrapper"},null);O.place(ba,T,"before")}N.forEach(E,r.hitch(this,function(pa){q.attributes.hasOwnProperty(pa.fieldName)&&
q.attributes[pa.fieldName]===pa.fieldValue&&this._createAttributeSymbol(pa,ba)}))},_createAttributeSymbol:function(q,E){var T=P.fromJson(q.symbol);q=this._selectedLayer.getField(q.fieldName);E=O.create("div",{"class":"esriCTAttributeSymbolContainer",title:q&&q.alias?q.alias:""},E);T=Z.createSymbolNode(T);O.place(T,E)},resetIconColors:function(){this._filterIcon&&l.set(this._filterIcon,"background-color",this.selectedThemeColor);this._proximityIcon&&l.set(this._proximityIcon,"background-color",this.selectedThemeColor)},
_attachEventToTab:function(){""!==this._tabContainer&&null!==this._tabContainer&&void 0!==this._tabContainer&&this._tabContainer.controlNodes&&1<this._tabContainer.controlNodes.length&&this.own(n(this._tabContainer.controlNodes[1],"keydown",r.hitch(this,function(q){q.keyCode===ta.TAB&&!q.shiftKey&&this._tabContainer.viewStack&&this._tabContainer.viewStack.getSelectedLabel()===this.nls.informationTabTitle&&(this.config.enableProximitySearch?(va.stop(q),g.focus(this.proximityButton)):(va.stop(q),this.emit("setFocusOnFirstFocusableNode")))})))},
_getInformationTabAsLastFocusNode:function(){if(""!==this._tabContainer&&null!==this._tabContainer&&void 0!==this._tabContainer&&this._tabContainer.viewStack&&this._tabContainer.viewStack.getSelectedLabel()===this.nls.informationTabTitle&&this._tabContainer.controlNodes&&0<this._tabContainer.controlNodes.length){var q=this._tabContainer.controlNodes[0];if(!this.config.enableProximitySearch)return y.initLastFocusNode(this.domNodeObj,q),!0}return!1}})})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json dojox/html/entities ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R,C,a,B,fa,ka,la,oa,P,na,ma,J,z,I,da,ra,qa,wa,Ca,b,f,D,t,Z,ca,ta,g,L,U,Y,ha,va,Aa,q,E,T,ba,pa,xa,Ba,Da,Ka,Na,Ta,Ya,ab,Za){var Xa=I.getProtocolForWebResource(),db=ka.createSubclass({_setSourcesAttr:function(c){c&&(c=c.map(function(k){k.locator&&null==k.locationType&&(k=u.mixin({locationType:"street"},k));return k}));this.inherited(arguments,[c])}});W=W("esri.dijit.Directions",[E,r],{templateString:fa,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(c,k){if(!c.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!k)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=B;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",
activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Xa+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Xa+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Xa+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new wa(B.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new wa(B.widgets.directions.maneuver,B.widgets.directions.waypoint),segmentInfoTemplate:new wa(B.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new q("11px",q.STYLE_NORMAL,q.VARIANT_NORMAL,q.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new N([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new Y({url:V.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new Y({url:V.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new Y({url:V.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new Y({url:V.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new Y({url:V.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new Y({url:V.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new Y({url:V.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new Y({url:V.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new U({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new U({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],width:1,
type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new ha).setColor(new N([20,89,127,.75])).setWidth(10).setCap(ha.CAP_ROUND).setJoin(ha.JOIN_ROUND),segmentSymbol:(new ha).setColor(new N([255,255,255,1])).setWidth(6).setCap(ha.CAP_ROUND).setJoin(ha.JOIN_ROUND),barrierRenderer:new Aa({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new Aa({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new Aa({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=c;this.defaults=u.mixin({},this.options,c,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(c=2;c<this.defaults.minStops;c++)this.defaults.stops.splice(0,0,"");this.domNode=k},postCreate:function(){this.inherited(arguments);this.own(H(this._activateButtonNode,y,u.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(H(this._lineBarrierButtonNode,y,u.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(H(this._addDestinationNode,
y,u.hitch(this,this._addStopButton)));this.own(H(this._optionsButtonNode,y,u.hitch(this,this._toggleOptionsMenu)));this.own(H(this._saveMenuButton,y,u.hitch(this,this._toggleSaveMenu)));this.own(H(this._saveButton,y,u.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(H(this._saveAsButton,y,u.hitch(this,function(){u.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(H(this._findOptimalOrderNode,y,u.hitch(this,this._toggleCheckbox)));
this.own(H(this._returnToStartNode,y,u.hitch(this,this._toggleCheckbox)));this.own(H(this._useTrafficNode,y,u.hitch(this,this._toggleCheckbox)));this.own(H(this._useMilesNode,y,u.hitch(this,this._toggleUnits)));this.own(H(this._useKilometersNode,y,u.hitch(this,this._toggleUnits)));this.own(H(this._getDirectionsButtonNode,y,u.hitch(this,this.getDirections)));this.own(H(this._clearDirectionsButtonNode,y,u.hitch(this,function(){this.clearDirections()})));var c=u.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(u.hitch(this,function(){S.set(this._startTimeMenu,"display","none")}),100)});this.own(H(this._startTimeButtonNode,y,u.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===S.get(this._startTimeMenu,"display")?S.set(this._startTimeMenu,"display","none"):(S.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(H(this._startTimeMenuLeaveNow,
"blur",c));this.own(H(this._startTimeMenuDepartAt,"blur",c));this.own(H(this._startTimeMenuNone,"blur",c));this.own(H(this._startTimeMenuLeaveNow,"mousedown",u.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(H(this._startTimeMenuDepartAt,"mousedown",u.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(H(this._startTimeMenuNone,"mousedown",u.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new ha).setColor(new N([0,255,0,0])).setWidth(20).setCap(ha.CAP_ROUND);this._stopLayer=new f({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new f({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new f({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new f({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new f({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new f({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var k=new da(null,this.waypointSymbol,{});c=u.hitch(this,function(){this._moveInProgress||this._solveInProgress||!k._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(k),clearTimeout(k._solveTimeout),k._solveTimeout=null,k.attributes.isWaypoint=!0,k._isStopIcon&&this.stopGraphics[k._index]&&(this._stopLayer.add(this.stopGraphics[k._index]),this._stopLayer.add(this.textGraphics[k._index])));k._showTooltip()});this._handle=u.mixin(k,{_isHandle:!0,_tooltip:la.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:c},this.map.container),_showTooltip:u.hitch(this,function(v){k._tooltip.style.display=!v||v instanceof MouseEvent?
"none":"inline";v&&(v="string"===typeof v?v:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(v)+"\x3c/table\x3e",k._tooltip.innerHTML!==v&&(k._tooltip.innerHTML=v))}),_isShown:u.hitch(this,function(){return-1<X.indexOf(this._stopLayer.graphics,k)}),_remove:c});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();la.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(u.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(u.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(c,k){return this._enqueue(function(){return this._modifyStopSequence(c,
k)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(c,k,v){return this._enqueue(function(){this.clearMessages();return this._removeStop(c,k,v)})},updateStops:function(c){return this._enqueue(function(){return this._updateStops(c)})},addStops:function(c,k){return this._enqueue(function(){return this._addStops(c,k)}).then(u.hitch(this,this.zoomToFullRoute))},addStop:function(c,
k){return this._enqueue(function(){return this._addStop(c,k)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(c,k,v){return this._enqueue(function(){return this._updateStop(c,k,v)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(c){this.routeParams.barriers=c;return this._getDirections().then(u.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(c){this.routeParams.polylineBarriers=c;return this._getDirections().then(u.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(c){this.routeParams.polygonBarriers=c;return this._getDirections().then(u.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(c){return this._enqueue(function(){return this._getDirections().then(u.hitch(this,function(){!0!==c&&this.zoomToFullRoute()}))})},selectSegment:function(c){if(!(!this.directions||!this.directions.features||
0>c||c>=this.directions.features.length))for(var k=C("[data-segment]",this._resultsNode),v=0;v<k.length;v++){var K=parseInt(R.get(k[v],"data-segment"),10);if(c===K&&k[v]!==this._focusedDirectionsItem){this._focusedDirectionsItem=k[v];this.centerAtSegmentStart(c);this.onSegmentSelect(this.directions.features[c]);k[v].focus();break}}},unhighlightSegment:function(c){var k=this._segmentGraphics;if(k&&(!this._focusedDirectionsItem||c)){for(c=0;c<k.length;c++)this._routeLayer.remove(k[c]);this._segmentGraphics=
[]}},highlightSegment:function(c,k){if(!(this._focusedDirectionsItem&&!k||c>=this.directions.features.length)){c=c||0;var v=u.hitch(this,function(Fa){var Ea=this.map.toMap({x:0,y:0});return this.map.toScreen(Ea.offset(Fa,0)).x}),K=u.hitch(this,function(Fa){for(var Ea=0,Ia=0;Ia<Fa.length;Ia++)for(var Oa=1;Oa<Fa[Ia].length;Oa++){var Va=Fa[Ia][Oa-1],Qa=Fa[Ia][Oa];Ea+=v(Math.sqrt((Va[0]-Qa[0])*(Va[0]-Qa[0])+(Va[1]-Qa[1])*(Va[1]-Qa[1])))}return Ea}),A=u.hitch(this,function(Fa){var Ea=this.map.toMap({x:0,
y:0});return this.map.toMap({x:Fa,y:0}).x-Ea.x}),aa=function(Fa,Ea,Ia){Ea=Math.max(1,Ea);for(var Oa=Ia?Fa[0].length-1:0,Va=0,Qa,Pa,Ma,Ha=[[Fa[0][Ia?Oa:0]]];Ia&&0<Oa||!Ia&&Oa<Fa[0].length-1;){Pa=Fa[0][Ia?Oa-1:Oa];Ma=Fa[0][Ia?Oa:Oa+1];if(Qa=v(Math.sqrt((Pa[0]-Ma[0])*(Pa[0]-Ma[0])+(Pa[1]-Ma[1])*(Pa[1]-Ma[1]))))if(Va+Qa<Ea)Ia?Ha[0].splice(0,0,Pa):Ha[0].push(Ma),Va+=Qa;else{Ea=(Ea-Va)/Qa;Ia?Ha[0].splice(0,0,[Ma[0]-(Ma[0]-Pa[0])*Ea,Ma[1]-(Ma[1]-Pa[1])*Ea]):Ha[0].push([Pa[0]+(Ma[0]-Pa[0])*Ea,Pa[1]+(Ma[1]-
Pa[1])*Ea]);break}Oa+=Ia?-1:1}return 0<Va+Qa?Ha:Fa};k=this.get("directions").features[c];var ea=new g(k.geometry),ia=40*Math.PI/180;u.mixin(k.attributes,{_index:c});if(c){var ja=aa(this.get("directions").features[c-1].geometry.paths,25,!0),ua="esriDMTStop"!==k.attributes.maneuverType?aa(ea.paths,25,!1):ja;ja=ua!==ja?[ja[0].concat(ua[0])]:ua;var sa=(new g(ua)).getExtent();if(1<ua[0].length&&15<=v(Math.max(sa.getWidth(),sa.getHeight()))){aa=15*Math.cos(ia/2);K=15*Math.sin(ia/2);var ya=ua[0].length-
2;ia=ua[0][ya+1];for(sa=0;0<=ya&&!sa;){var za=ua[0][ya];sa=v(Math.sqrt((za[0]-ia[0])*(za[0]-ia[0])+(za[1]-ia[1])*(za[1]-ia[1])));ya--}22>sa&&(ua=sa+(22-sa)/3,ya=sa+2*(22-sa)/3,ya=[za[0]+ya/sa*(ia[0]-za[0]),za[1]+ya/sa*(ia[1]-za[1])],za=[ia[0]-ua/sa*(ia[0]-za[0]),ia[1]-ua/sa*(ia[1]-za[1])],ia=ya,sa=22);aa/=sa;ua=[ia[0]-(ia[0]-za[0])*aa,ia[1]-(ia[1]-za[1])*aa];za[1]!==ia[1]?(aa=(ia[0]-za[0])/(ia[1]-za[1]),za=A(K/Math.sqrt(1+aa*aa)),A=aa*za):(za=0,A=A(K));Infinity===Math.abs(za)||Infinity===Math.abs(A)||
isNaN(za)||isNaN(A)||(ja[0].push(ia),ja[0].push([ua[0]-za,ua[1]+A]),ja[0].push([ua[0]+za,ua[1]-A]),ja[0].push(ia))}else ja=aa(ja,2*K(ua),!0);ea.paths=ja}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);A=u.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new N([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new da(k.geometry,A,k.attributes,this.get("segmentInfoTemplate")),
new da(ea,this.routeSymbol,k.attributes,this.get("segmentInfoTemplate")),new da(ea,this.segmentSymbol,k.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));k=u.hitch(this,function(Fa){if(0<Fa&&Fa<this.directions.features.length){Fa=this.directions.features[Fa]._associatedFeaturesWithWaypoints;for(var Ea=0;Ea<Fa.length;Ea++)Fa[Ea]._associatedSnapFeature&&
Fa[Ea]._associatedSnapFeature.getDojoShape()&&Fa[Ea]._associatedSnapFeature.getDojoShape().moveToFront()}});k(c-1);k(c);this.onSegmentHighlight(this.directions.features[c])}},zoomToSegment:function(c){var k=new P;if(this.directions&&this.directions.features){var v=Math.max(0,Math.min(this.directions.features.length-1,c||0));this.map.setExtent(this.get("directions").features[v].geometry.getExtent(),!0).promise.always(u.hitch(this,function(){this.highlightSegment(v);k.resolve()}))}else k.reject(Error("No directions."));
return k.promise},centerAtSegmentStart:function(c){var k=new P;if(this.directions&&this.directions.features){var v=Math.max(0,Math.min(this.directions.features.length-1,c||0));var K=this.directions.features[v];this.map.centerAt(K.geometry.getPoint(0,0)).promise.always(u.hitch(this,function(){this.highlightSegment(v,!0);this._showSegmentPopup(K,v);k.resolve()}))}else k.reject(Error("No directions."));return k.promise},zoomToFullRoute:function(){var c=new P;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(c.resolve)):c.resolve();return c.promise},setListIcons:function(){var c,k=this._dnd.getAllNodes();for(c=0;c<k.length;c++){var v=C("."+this._css.stopIconClass,k[c])[0];v&&(v.innerHTML=this._getLetter(c));M.remove(k[c],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);v=this._getStopSymbol(this.stops[c]);
v===this.fromSymbol?M.add(k[c],this._css.stopOriginClass):v===this.toSymbol?M.add(k[c],this._css.stopDestinationClass):v===this.unreachedSymbol&&M.add(k[c],this._css.stopUnreachedClass)}c=C("[data-reverse-td]",this._dndNode)[0];la.destroy(c);this.get("showReverseStopsButton")&&la.create("td",{"data-reverse-td":"true",rowspan:k.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
B.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(K){K.stopPropagation()},onmouseout:function(K){K.stopPropagation()}},k[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var c=0;c<this.stopGraphics.length;c++)if(this.stopGraphics[c]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==c)){this._stopLayer.add(this.stopGraphics[c]);var k=this.stopGraphics[c].getDojoShape();k&&k.moveToFront();this._stopLayer.add(this.textGraphics[c]);
(k=this.textGraphics[c].getDojoShape())&&k.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var c=this.stops,k=0;k<c.length;k++){var v=c[k];if(v&&v.feature){var K=v.feature.attributes,A=K?K.Status:void 0,aa=null;this._isStopAWaypoint(v)||(aa=new va(this._getLetter(k),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&
aa.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));aa=new da(v.feature.geometry,aa,{address:v.name},this.get("stopsInfoTemplate"));aa._isStopLabel=!0;aa._index=k;var ea=v.feature.geometry,ia=this._getStopSymbol(v),ja=u,ua=ja.mixin;A={address:v.name,Status:void 0===A?0:A,CurbApproach:K&&K.CurbApproach?K.CurbApproach:null,TimeWindowStart:K&&K.TimeWindowStart?K.TimeWindowStart:null,TimeWindowEnd:K&&K.TimeWindowEnd?K.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(v)};var sa=
void 0,ya={};for(sa in K)K.hasOwnProperty(sa)&&0===sa.indexOf("Attr_")&&(ya[sa]=K[sa]);v=new da(ea,ia,ua.call(ja,A,ya),this.get(this._isStopAWaypoint(v)?"waypointInfoTemplate":"stopsInfoTemplate"));v._isStopIcon=!0;v._index=k;this.stopGraphics[k]=v;this.textGraphics[k]=aa}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(c){return this._enqueue(function(){this.clearMessages();
this._travelModeSelector.setValue(c);return this._setTravelMode(c)})},getSupportedTravelModeNames:function(){var c=[],k=this.serviceDescription;if(k&&k.supportedTravelModes&&k.supportedTravelModes.length){k=k.supportedTravelModes;for(var v=0;v<k.length;v++)c.push(k[v].name)}return c},setDirectionsLengthUnits:function(){var c=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(c)})},setDirectionsLanguage:function(){var c=
1===arguments.length?arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(c)})},useMyCurrentLocation:function(c){this.clearMessages();return this._createLocateButton(this.geocoders[c],!0,!0)},loadRoute:function(c){return this._enqueue(u.hitch(this,function(){return this._loadRoute(c)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var c=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(u.hitch(this,function(){this.mapClickActive=!c;this.set("mapClickActive",c);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var c=this.get("mapClickActive"),k=u.hitch(this,function(v){for(var K=v?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],A=0;A<K.length;A++)for(var aa=K[A],ea=0;ea<aa.length;ea++){var ia=aa[ea].getDojoShape();ia&&ia[v?"moveToBack":"moveToFront"].call(ia)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),M.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();c?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=H(this.map,"click",u.hitch(this,function(v){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new da(v.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),M.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
M.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());k(!c);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(Ya.FREEHAND_POLYLINE),M.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),M.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var c=this.get("map"),k=c.graphicsLayerIds.length-1;c.reorderLayer(this._routeLayer,k);c.reorderLayer(this._polygonBarriersLayer,k);c.reorderLayer(this._polylineBarriersLayer,k);c.reorderLayer(this._barriersLayer,k);c.reorderLayer(this._waypointsEventLayer,k);
c.reorderLayer(this._stopLayer,k)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(c){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var c=this._clearDirections(!0),k;if(this._watchEvents&&this._watchEvents.length)for(k=0;k<this._watchEvents.length;k++)this._watchEvents[k].unwatch();if(this._onEvents&&this._onEvents.length)for(k=0;k<this._onEvents.length;k++)this._onEvents[k].remove();
if(this._geocoderEvents)for(k=0;k<this._geocoderEvents.length;k++)this._geocoderEvents[k].value.unwatch(),this._geocoderEvents[k].blur.remove(),this._geocoderEvents[k].select.remove(),this._geocoderEvents[k].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return c},_getDirections:function(){var c=new P;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(u.hitch(this,function(k){this.stops=k;this._setStops();this._configureRoute().always(u.hitch(this,function(v){c.resolve(v)}))}),u.hitch(this,function(k){this.set("directions",null);this._clearRouteGraphics();c.reject(k);this.onDirectionsFinish(k)}))):this._clearDirections(!0).always(u.hitch(this,function(){this.createRouteSymbols();c.resolve()}));return c.promise},
_clearDirections:function(){var c=new P;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),c.resolve()):arguments.length?c.resolve():this._reset().then(c.resolve,c.reject):c.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return c.promise},_setTravelMode:function(c){var k=new P,v=this.serviceDescription,K=function(){k.resolve(c)};if(v&&v.supportedTravelModes&&v.supportedTravelModes.length){var A=v.supportedTravelModes,aa=!1;for(v=0;v<A.length;v++)if(A[v].name===c){aa=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==c?(this.routeParams.travelMode=A[v].impedanceAttributeName?A[v]:A[v].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(K)):K();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=A[v].description);break}aa||k.reject(c)}else k.reject(c);return k.promise},_setDirectionsLengthUnits:function(c){this._clearDisplayBeforeSolve();var k=new P;M.remove(this._useMilesNode,this._css.stopsPressedButtonClass);M.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);c===ra.KILOMETERS?M.add(this._useKilometersNode,this._css.stopsPressedButtonClass):c===ra.MILES&&M.add(this._useMilesNode,this._css.stopsPressedButtonClass);
c===ra.KILOMETERS||c===ra.METERS||c===ra.MILES||c===ra.FEET||c===ra.YARDS||c===ra.NAUTICAL_MILES?(this.directionsLengthUnits=c,k.resolve(c)):k.reject(c);return k.promise},_setDirectionsLanguage:function(c){this._clearDisplayBeforeSolve();var k=new P;c=this._setDirectionsLanguageByLocale(c);this._solveAndZoom().always(function(){k.resolve(c)},k.reject);return k.promise},_showLoadingSpinner:function(c){void 0===c&&(c=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);
c?(M.add(this._widgetContainer,this._css.resultsLoadingClass),M.add(this._resultsNode,"esriRoutesContainerBusy")):(M.remove(this._widgetContainer,this._css.resultsLoadingClass),M.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(c,k){var v=new P;this._requestQueueTail||(this._requestQueueTail=new P,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(u.hitch(this,function(){try{u.mixin(this,{_incrementalSolveStopRange:null},k);var K=c.call(this);K&&"object"===
typeof K&&K.hasOwnProperty("isFulfilled")?K.then(u.hitch(this,function(A){v.resolve(A);this._showLoadingSpinner()}),u.hitch(this,function(A){v.reject(A);this._showLoadingSpinner()})):(v.resolve(K),this._showLoadingSpinner())}catch(A){v.reject(A),this._showLoadingSpinner()}}));this._requestQueueTail=v;this._showLoadingSpinner();return v.promise},_createDnD:function(){this._dnd=new na(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){la.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),
this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=B.widgets.directions.trafficLabelLive,M.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var c=this,k=function(){this._keepDirections||c._clearDisplayBeforeSolve();this._keepDirections=!1},v=u.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),K=u.hitch(this,function(){this.map&&
this.map.enableKeyboardNavigation()});this._departAtTime=new m({required:!0,value:new Date,onChange:k,onFocus:v,onBlur:K},this._departAtTimeContainer);this._departAtDate=new l({required:!0,value:new Date,onChange:k,onFocus:v,onBlur:K,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(c,k,v){if(isNaN(v))this.startTime="now"===v?v:"none";else{k=v instanceof Date?v:new Date(v);v=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;
var K=6E4*-k.getTimezoneOffset();k=new Date(k-K+(v&&v.arriveTimeUTC?v.ETA-v.arriveTimeUTC:K));this._departAtTime._keepDirections=!c;this._departAtDate._keepDirections=!c;this._departAtTime.setValue(k);this._departAtDate.setValue(k)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var c=this._getImpedanceAttribute();c=this._isTimeUnits(c?c.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!c;M[c?"remove":"add"].apply(this,
[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);M[c?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);c||this.set("startTime","now")},_usingAGOL:function(c){c||(c=this.routeTaskUrl);return-1<c.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var c={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,
enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=u.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,c)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var c="EN-US"===O.locale.toUpperCase()?ra.MILES:ra.KILOMETERS;this.defaults.directionsLengthUnits?c=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(c=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",
c)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new b(Xa+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&
!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(c,k){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);k||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(c,k){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);k||this.canModifyStops||
!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,M.remove(this._startTimeButtonNodeContainer,"departAtButton"),M.remove(this._departAtContainer,"departAtContainerVisible")):(M.add(this._startTimeButtonNodeContainer,"departAtButton"),M.add(this._departAtContainer,
"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=u.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(c){var k=new P;c?this.get("loaded")?this._reset().then(u.hitch(this,
function(){this._addStops(c).then(k.resolve,k.reject)}),k.reject):this._addStops(c).then(k.resolve,k.reject):k.reject();return k.promise},_removeStop:function(c,k,v,K){var A=new P,aa=u.hitch(this,function(ia){this.stops.splice(ia,1);var ja=this._dnd.getAllNodes()[ia],ua=this.get("geocoders");this._geocoderEvents[ja.id]&&(this._geocoderEvents[ja.id].blur.remove(),this._geocoderEvents[ja.id].select.remove(),this._geocoderEvents[ja.id].suggest.remove(),this._geocoderEvents[ja.id].value.unwatch());ua[ia].destroy();
ua.splice(ia,1);this.set("geocoders",ua);la.destroy(ja);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>c||c>=this.stops.length||void 0===c)c=this.stops.length-1;var ea=!1;for(K=this.stopGraphics[c]&&this._isStopAWaypoint(this.stops[c])||K;!ea;)aa(c),K?ea=!0:(c-=0>=c||c<this.stops.length&&this._isStopAWaypoint(this.stops[c])?0:1,ea=!this._isStopAWaypoint(this.stops[c]));for(;this.stops.length-this._getWaypointCount()<
this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();v?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),A.resolve()):this._solveAndZoom(k).then(A.resolve,A.reject);return A.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(c,k){var v=new P,K=[],A=this.autoSolve;this.autoSolve=!1;void 0===k&&(k=this._getStopCount());
for(var aa=0;aa<Math.min(c.length,this.maxStops-this._getStopCount());aa++){var ea=new P;this._addStop(c[aa],k+aa,!0).always(ea.resolve);K.push(ea)}oa(K).always(u.hitch(this,function(){this.autoSolve=A;this._getDirections().always(function(){v.resolve(c)})}));return v.promise},_addStop:function(c,k,v){var K=new P;this._checkMaxStops();this.maxStopsReached?(this._showMessage(B.widgets.directions.error.maximumStops),K.reject(Error(B.widgets.directions.error.maximumStops))):(void 0===c&&void 0===k&&
(k=this.stops.length),c instanceof da&&c.attributes&&c.attributes.isWaypoint&&(!k||k===this.stops.length||2>this._getStopCount())&&!v?(this._showMessage(B.widgets.directions.error.waypointShouldBeInBetweenStops),K.reject(Error(B.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(c).then(u.hitch(this,function(A){this._isStopAWaypoint(A)&&A&&A.feature&&(A.feature.attributes=u.mixin({},A.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(A,k);this.autoSolve&&
""!==A.name?this._getDirections().always(function(){K.resolve(A,k)}):K.resolve(A,k)}),u.hitch(this,function(A){K.reject(A)})));return K.promise},_removeEmptyStops:function(){for(var c=0,k=this.stops.length-this._getWaypointCount()-this.minStops;c<this.stops.length&&0<k;)this.stops[c]&&this.stops[c].name?c++:(this._removeStop(c,!0,!0,!0),k--,this._moveInProgress&&this._handle._index>=c&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(c,k,v){if(c.feature.geometry&&-1<v){var K=
{address:c.name};this.stopGraphics[v]&&(u.mixin(this.stopGraphics[v].attributes,K),this.stopGraphics[v].setGeometry(k));this.textGraphics[v]&&(u.mixin(this.textGraphics[v].attributes,K),this.textGraphics[v].setGeometry(k));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(K=this.geocoders[v])&&K.inputNode&&(K.value=c.name,K.inputNode.value=c.name);u.mixin(c.feature.attributes,this.stops[v].feature.attributes);this.stops[v]=c;this.stops[v].feature.setGeometry(k);
this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(c,k){var v;if(void 0===k)for(v=0;v<this.geocoders.length;v++){if(!this.geocoders[v].get("value")){var K=this.geocoders[v];break}}else v=k,this.geocoders[v]&&!this.geocoders[v].get("value")&&(K=this.geocoders[v]);!K||void 0!==k&&k!==v||this._isStopAWaypoint(c)?(void 0===k&&(k=this.geocoders.length),this.stops.splice(k,0,c),this._createGeocoder(c,k)):(this.stops[v]=c,K.set("value",c.name),K._stopReference=
c);this._optionsMenu()},_createGeocoder:function(c,k){var v=this._dnd.getAllNodes(),K=!1,A=!1,aa=v.length;v[k]?(A=v[k],K=!0):K=A=!1;var ea=u.hitch(this,function(sa,ya){var za=ya?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,Fa=ya?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;M.replace(sa.children[0],za,Fa);2<this.geocoders.length&&(za=ya?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,Fa=ya?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,
M.replace(sa.children[3].children[0],za,Fa))}),ia=la.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(c)?"display:none;":"",onmouseover:function(){ea(this,!0)},onmouseout:function(){ea(this,!1)}});la.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},ia);v=la.create("td",{className:this._css.stopIconColumnClass},ia);la.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(aa),"data-center-at":"true"},v);aa=la.create("td",
{className:this._css.esriStopGeocoderColumnClass},ia);aa=la.create("div",{},aa);v=la.create("td",{className:this._css.stopIconRemoveColumnClass},ia);la.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},v);this._dnd.insertNodes(!1,[ia],K,A);K=u.mixin({},this.get("searchOptions"),{value:c.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ja=new db(K,aa),ua=u.hitch(this,function(sa,ya){this._enqueue(function(){if(ya!==sa&&ja._stopReference&&
ja._stopReference.name!==ya){var za=X.indexOf(this.stops,ja._stopReference);this.stops[za]={name:ya};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(za));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ja._tr=ia;ja._stopReference=c;ja.startup();this.geocoders.splice(k,0,ja);this._geocoderEvents[ia.id]={blur:ja.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&
this.search()}),select:ja.on("select-result",u.hitch(this,function(sa){var ya=!0;if(sa&&(sa.results||sa.result)){var za=this._dnd.getAllNodes();za=X.indexOf(za,ia);var Fa=ja.value,Ea=sa.results&&sa.results.results&&sa.results.results.length?sa.results.results[0]:sa.result;Ea?(Ea.name=Fa,this.stops[za]=this._toPointGeometry(Ea),this.geocoders[za]._stopReference=this.stops[za],ua("",Fa)):(this.removeStop(za),this.set("directions",null),this._showMessage(B.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
sa.target.get("value"))),this._clearRouteGraphics(),ya=!1);ya&&this.getDirections()}})),suggest:ja.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var sa=C("LI[role\x3d'menuitem']",this.suggestionsNode),ya=0;ya<sa.length;ya++)R.set(sa[ya],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ja.watch("value",function(sa,ya,za){ua(ya,za)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var c=
0;c<this.geocoders.length;c++)if(this.geocoders[c].inputNode===document.activeElement){this.geocoders[c]._hideSuggestionsMenu();this.geocoders[c].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(c){c&&", , "===c.name&&(c.name=c.feature&&c.feature.attributes&&c.feature.attributes.Match_addr?c.feature.attributes.Match_addr+("POI"===c.feature.attributes.Addr_type&&c.feature.attributes.City&&-1===c.feature.attributes.Match_addr.indexOf(c.feature.attributes.City)?
", "+c.feature.attributes.City:""):"");return c},_toPointGeometry:function(c){var k=c.feature.geometry;k&&(k.getCentroid?c.feature.geometry=k.getCentroid():k.getExtent&&(k=k.getExtent())&&(c.feature.geometry=k.getCenter()));return c},_removeLocateButtonVisibilityEvents:function(){for(var c=0;c<this.geocoders.length;c++){var k=this.geocoders[c];k._onMouseEnter&&k._onMouseEnter.remove();k._onMouseOut&&k._onMouseOut.remove();k._onKeyPress&&k._onKeyPress.remove();k._locateButton&&(k._locateButton._onMouseEnter&&
k._locateButton._onMouseEnter.remove(),k._locateButton._onMouseOut&&k._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var c=this,k=function(ja){ja instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;c._createLocateButton(this._geocoder,!0)},v=function(ja){ja instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=
setTimeout(u.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||c._destroyLocateButton(this._locateButton)}),400)},K=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(u.hitch(this,function(){""===this.value?c._createLocateButton(this._geocoder,!0):c._destroyLocateButton(this._locateButton)}),400)},A=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},aa=function(){this._geocoder._lbShown_lb=
!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(u.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||c._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},ea=0;ea<this.geocoders.length;ea++){var ia=this.geocoders[ea];ia&&ia.inputNode&&(ia.inputNode._geocoder=ia,ia._onMouseEnter=H(ia.inputNode,w.enter,k),ia._onMouseOut=H(ia.inputNode,[w.leave,"blur"],v),ia._onKeyPress=H(ia.inputNode,"keydown",K),ia.inputNode._locateButton&&
(ia=ia.inputNode._locateButton,ia._onMouseEnter=H(ia.domNode,w.enter,A),ia._onMouseOut=H(ia.domNode,w.leave,aa)))}},_createLocateButton:function(c,k,v){var K=new P;c.inputNode._locateButton&&c.inputNode._locateButton._locating?K.resolve():V(["./LocateButton"],u.hitch(this,function(A){this._destroyLocateButton(c.inputNode._locateButton);if(c&&!this._solveInProgress){var aa=la.create("div",{},c.domNode);M.add(c.domNode,this._css.stopsInnerGeocoderClass);var ea=new A({map:this.map,highlightLocation:!1,
centerAt:!1,setScale:!1,useTracking:!1},aa);ea.startup();c.inputNode._locateButton=ea;ea.domNode._geocoder=c;this._setLocateButtonVisibilityEvents();A=u.hitch(this,function(){ea._locating=!0;c.set("value","");c.inputNode.placeholder=B.widgets.directions.retrievingMyLocation.toUpperCase()});ea._onBeforeLocate=H(ea._locateNode,y,A);ea._onLocate=H(ea,"locate",u.hitch(this,function(ia){ea._locating=!1;ia.graphic?(k&&this._destroyLocateButton(c.inputNode._locateButton),this.updateStop(new da(ia.graphic.geometry),
X.indexOf(this.geocoders,c)).then(u.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){K.resolve(ia)}):K.resolve(ia)}))):(c.set("value",""),c.inputNode.placeholder=B.widgets.directions.myLocationError.toUpperCase(),console.error(ia.error),K.reject(ia.error))}));v?(A(),ea.locate().then(null,K.reject)):K.resolve()}else K.resolve()}));return K.promise},_destroyLocateButton:function(c){if(c){var k=c.domNode._geocoder;clearTimeout(k._destroyTimeout);c._locating?k._destroyTimeout=
setTimeout(u.hitch(this,function(){k._lbShown_lb||k._lbShown_f||this._destroyLocateButton(c)}),100):(c.clear(),c._onBeforeLocate.remove(),c._onLocate.remove(),c._onMouseEnter&&c._onMouseEnter.remove(),c._onMouseOut&&c._onMouseOut.remove(),c.destroy(),k.inputNode&&(k.inputNode._locateButton=null,k._setPlaceholder(k.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(u.hitch(this,function(c,k){for(var v,K,A=0;A<this.get("geocoders").length;A++)this.geocoders[A]._stopReference===
c?v=A:this.geocoders[A]._stopReference===k&&(K=A);return v>K?1:K>v?-1:0})),this._setStops())},_getCandidate:function(c){var k=new P,v=typeof c;c?"object"===v&&c.hasOwnProperty("feature")&&c.hasOwnProperty("name")?(c.feature.attributes&&void 0!==c.feature.attributes.displayName&&!this._isStopAWaypoint(c)&&(c.name=c.feature.attributes.displayName,c.feature.attributes.Name=this._userDefinedStopName),c.name=this._isStopAWaypoint(c)?this._waypointName:String(c.name),"point"!==c.feature.geometry.type&&
(c.feature.geometry=new ca([c.feature.geometry.x,c.feature.geometry.y],this.map.spatialReference)),k.resolve(c)):"object"===v&&c.hasOwnProperty("address")&&c.hasOwnProperty("location")?(c=this._globalGeocoder._hydrateResult(c),k.resolve(c)):"object"!==v||!c.hasOwnProperty("name")||null!==c.name&&""!==c.name?c instanceof da&&c.attributes&&(void 0!==c.attributes.Name||c.attributes.isWaypoint)?(v=this._addStopWrapperToGraphic(c,c.attributes.isWaypoint?this._waypointName:String(c.attributes.Name)),String(c.attributes.Name)&&
(v.feature.attributes.Name=this._userDefinedStopName),k.resolve(v)):("object"===v&&c.hasOwnProperty("name")&&(c=String(c.name)),this._reverseGeocode(c).then(k.resolve,k.reject)):k.resolve(u.clone(this._emptyStop)):k.resolve(u.clone(this._emptyStop));return k.promise},_reverseGeocode:function(c){var k=new P,v,K=c.geometry?c.geometry:c;if(this._globalGeocoder){var A=u.hitch(this,function(ja){var ua=new P,sa=500;if(this.map){var ya=this.map.toScreen(K);ya.x+=Z._calculateClickTolerance([ja]);this.map.spatialReference.isWebMercator()?
(sa=Math.abs(this.map.toMap(ya).x-K.x),ua.resolve(sa)):4326===this.map.spatialReference.wkid?(sa=Math.abs(D.geographicToWebMercator(this.map.toMap(ya)).x-D.geographicToWebMercator(K).x),ua.resolve(sa)):this._geometryService&&(ja=new Ba,ja.distanceUnit=xa.UNIT_METER,ja.geometry1=K,ja.geometry2=this.map.toMap(ya),this._geometryService.distance(ja,function(za){sa=za;ua.resolve(sa)},function(){ua.resolve(sa)}))}return ua.promise}),aa=[],ea=this._globalGeocoder.sources,ia=function(){ea[v].featureLayer&&
aa.push(A(ea[v].featureLayer).then(u.hitch(ea[v],function(ja){this.searchQueryParams=u.mixin(this.searchQueryParams,{distance:ja})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(v=0;v<ea.length;v++)ia();else v=this._globalGeocoder.activeSourceIndex,ia();oa(aa).always(u.hitch(this,function(){this._globalGeocoder.search(K).then(u.hitch(this,function(ja){var ua=!1;if(ja){var sa=null;for(v=0;v<this._globalGeocoder.sources.length;v++)if(ja[v]&&ja[v].length){var ya=ja[v];break}if(ya.length&&
(ua=!0,sa=ya[0],this._globalGeocoder.sources[v].featureLayer))for(ja=Number.POSITIVE_INFINITY,v=0;v<ya.length;v++){ya[v]=this._toPointGeometry(ya[v]);var za=t.geodesicLengths([new g({paths:[[D.xyToLngLat(K.x,K.y),D.xyToLngLat(ya[v].feature.geometry.x,ya[v].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ja>za&&(ja=za,sa=ya[v])}(sa=this._decorateEmptyAGOLGeocoderResponse(sa))&&""!==sa.name&&null!==sa.name&&void 0!==sa.name?(sa.name=String(sa.name),isNaN(K.x)||
isNaN(K.y)||this.map.spatialReference.wkid!==K.spatialReference.wkid?!sa.feature.geometry||isNaN(sa.feature.geometry.x)||isNaN(sa.feature.geometry.y)?(this._showMessage(B.widgets.directions.error.locator),k.reject(Error(B.widgets.directions.error.locator))):k.resolve(sa):(sa.feature.geometry=K,k.resolve(sa))):ua=!1}ua||(c instanceof ca?c=new da(c):c instanceof Array&&(c=new da(new ca(c[0],c[1]))),c instanceof da?this._decorateUngeocodedStop(c).then(k.resolve,k.reject):(this._showMessage(B.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
J.encode(c.toString()))),k.reject(Error(B.widgets.directions.error.unknownStop.replace("\x3cname\x3e",c.toString())))))}))}))}else this._showMessage(B.widgets.directions.error.locatorUndefined),k.reject(Error(B.widgets.directions.error.locatorUndefined));return k.promise},_updateStop:function(c,k,v){var K=new P;this.stops&&this.stops[k]?c instanceof da&&c.attributes&&c.attributes.isWaypoint&&(!k||k===this.stops.length-1||2>this._getStopCount())?(this._showMessage(B.widgets.directions.error.waypointShouldBeInBetweenStops),
K.reject(Error(B.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(c).then(u.hitch(this,function(A){var aa=A.feature;aa=aa?aa.geometry:null;var ea=this.stops[k].feature;ea=ea?ea.geometry:null;aa=aa&&ea&&(aa.x!==ea.x||aa.y!==ea.y)||!aa&&ea;this.stops[k]=A;this.geocoders[k]||this._createGeocoder(A,k);ea=this.geocoders[k];ea._stopReference=A;ea._tr.style.display=this._isStopAWaypoint(A)?"none":"";ea.value=A.name;ea.inputNode&&(ea.inputNode.value=A.name);aa&&this.autoSolve&&
1<this._getStopCount()+this._getWaypointCount()||v?this._getDirections().then(K.resolve,K.reject):(this._setStops(),K.resolve(A))}),u.hitch(this,function(A){K.reject(A)})):(this._showMessage(B.widgets.directions.error.couldNotUpdateStop),K.reject(Error(B.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return K.promise},_renderDirections:function(){var c=this.get("directions");if(this._resultsNode){var k='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';k+=this._renderDirectionsSummary(c);
k+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';k+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';k+=this._renderDirectionsTable(c);k+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=k);this._disconnectResults();(c=C("[data-segment]",this._resultsNode))&&c.length&&X.forEach(c,u.hitch(this,function(v){this._resultEvents.push(H(v,w.enter,u.hitch(this,function(){if(!this._focusedDirectionsItem){var K=parseInt(R.get(v,"data-segment"),10);this.highlightSegment(K)}})));
this._resultEvents.push(H(v,"focusout",u.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(H(v,w.leave,this.unhighlightSegment));this._resultEvents.push(H(v,"click, keydown",u.hitch(this,function(K){K&&("click"===K.type||"keydown"===K.type&&K.keyCode===x.ENTER)&&(this._focusedDirectionsItem!==v?this.selectSegment(parseInt(R.get(v,"data-segment"),10)):(v.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},
_renderDirectionsSummary:function(c){var k="",v=u.hitch(this,function(){for(var ea={},ia=this._getDirectionsTimeAttribute()||{},ja=this._getTimeNeutralAttribute()||{},ua=0,sa=0,ya=this.get("stops"),za=ya.length-1;0<=za;za--)if(null!==ya[za].feature.attributes.ArriveCurbApproach){ea=ya[za].feature.attributes;break}for(var Fa in ea)ea.hasOwnProperty(Fa)&&(Fa==="Cumul_"+ia.name&&(ua=ea[Fa]),Fa==="Cumul_"+ja.name&&(sa=ea[Fa]));ea="esriTrafficLabelHidden";ya=B.widgets.directions.noTraffic;za=c.totalTime-
c.totalDriveTime;za=(sa-this._convertCostValue(za,ia.units,ja.units))/(ua-za||1);0<za&&.8>za?(ea="esriTrafficLabelHeavy",ya=B.widgets.directions.heavyTraffic):1===za?(ea="esriTrafficLabelNone",ya=B.widgets.directions.noTraffic):1.25<za&&(ea="esriTrafficLabelLight",ya=B.widgets.directions.ligthTraffic);ja=this._formatTime(sa,!1,ja.units);return{label:ya,labelClass:ea,ratio:za,noTrafficCostStr:1!==za&&ja?ja+" "+B.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:ua,noTrafficCost:sa,timeAtt:ia}});
if(c.totalLength||c.totalTime){v=v();var K=this._getImpedanceAttribute();k+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(K.units))k+=this._formatTime(v.trafficCost,!0,v.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+B.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+B.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+
(v.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+v.labelClass+"'\x3e"+v.label+"\x3c/div\x3e"+v.noTrafficCostStr:"")+this._formatDistance(c.totalLength);else{K=(K=B.widgets.directions.units[this.directionsLengthUnits])?K.name:"";var A=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,aa=this.directions.features[0].attributes;k+=a.format(c.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+K+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+
(v.noTrafficCost&&A?"\x3cdiv class\x3d'esriTrafficLabel "+v.labelClass+"'\x3e"+v.label+"\x3c/div\x3e"+v.noTrafficCostStr:"")+this._formatTime(c.totalTime)+" "+("none"!==this.startTime&&v.noTrafficCost&&A?B.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(aa.arriveTimeUTC,aa.ETA):"")}k+="\x3c/div\x3e\x3c/div\x3e"}return k},_renderDirectionsTable:function(c){for(var k=0,v=0,K=0,A='\x3ctable summary\x3d"'+c.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',aa=0;aa<c.features.length;aa++){var ea=
c.features[aa].attributes;"esriDMTDepart"===ea.maneuverType&&(v=K=0);K+=ea.length;v+=ea.time;k+=ea.time;A+=this._renderDirectionsItemTR(c.features[aa],K,v,k)}return A+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(c,k,v,K){var A=this.directions,aa=A?X.indexOf(A.features,c):-1;K="";var ea=this._css.routeClass,ia=c._associatedStopWithReturnToStart&&c._associatedStopWithReturnToStart.attributes,ja=c.attributes;if(-1<aa){ja&&(ja.step=aa+1);ja.maneuverType&&(ea+=" "+ja.maneuverType);
ia&&null===ia.ArriveCurbApproach&&null!==ia.DepartCurbApproach?ea+=" "+this._css.routeOriginClass:ia&&null!==ia.ArriveCurbApproach&&null===ia.DepartCurbApproach&&(ea+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);K+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ea+" "+this._css.routeZoomClass+'" data-segment\x3d"'+aa+'"\x3e';K+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';K+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';K+=this._getLetter(c._associatedStop);
K=K+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');K+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';K+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';c=(A.strings[aa]||[]).slice();if("esriDMTDepart"===ja.maneuverType||"esriDMTStop"===ja.maneuverType)for(A=0;A<this.stops.length;A++)this.stops[A]&&this.stops[A].name&&c.push({string:this.stops[A].name});if(c){ea=ja.text;for(A=0;A<c.length;A++)ea=this._boldText(ea,c[A].string);ja.formattedText=ea}else ja.formattedText=
ja.text;if("esriDMTStop"===ja.maneuverType&&(k||v)||"esriDMTDepart"===ja.maneuverType&&0===aa)k=this._formatDistance(k-ja.length,!0),v=this._formatTime(v-ja.time),aa=this._formatTime(ja.time),c=this._formatDistance(ja.length,!0),ja.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+k+(k&&v?" \x26middot; ":"")+v+(k||v?"\x3cbr\x3e":"")+(aa?B.widgets.directions.serviceTime+":\x26nbsp;"+aa:"")+(aa&&c?"\x3cbr\x3e":"")+(c?B.widgets.directions.serviceDistance+":\x26nbsp;"+c:"")+"\x3c/div\x3e";
K+="\x3cstrong\x3e"+a.format(ja.step)+".\x3c/strong\x3e "+ja.formattedText;K+="\x3c/div\x3e";k=this._formatDistance(ja.length,!0);v=this._formatTime(ja.time);"esriDMTStop"!==ja.maneuverType&&"esriDMTDepart"!==ja.maneuverType||!this.routeParams.startTime||-22091616E5===ja.ETA?k&&(K+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',K+=k,v&&(K+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+v),K+="\x3c/div\x3e"):K+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ja.arriveTimeUTC,
ja.ETA)+"\x3c/div\x3e";K+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return K},_toSpatiallyLocalTimeString:function(c,k){var v=new Date(k),K=new Date(v.getTime()+6E4*v.getTimezoneOffset());K=O.date.locale.format(K,{selector:"time"});var A="";c?(k=(k-c)/1E3/60/60,c=Math.floor(k),k=60*(k-c),c=B.widgets.directions.GMT+(0>c?"":"+")+a.format(c,{pattern:"00"})+a.format(k,{pattern:"00"}),A=K+" "+c):A="now"===this.startTime?O.date.locale.format(v,{selector:"time"}):K;return A},_addStopWrapperToGraphic:function(c,
k){return{extent:new ta({xmin:c.geometry.x-.25,ymin:c.geometry.y-.25,xmax:c.geometry.x+.25,ymax:c.geometry.y+.25,spatialReference:c.geometry.spatialReference}),feature:c,name:k}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var c=this.routeParams,k=c.polylineBarriers&&c.polylineBarriers.features||[],v=c.polygonBarriers&&c.polygonBarriers.features||[];X.forEach(c.barriers&&
c.barriers.features||[],u.hitch(this,function(K){this._barriersLayer.add(K)}));X.forEach(k,u.hitch(this,function(K){this._polylineBarriersLayer.add(K)}));X.forEach(v,u.hitch(this,function(K){this._polygonBarriersLayer.add(K)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(c){this._clearDisplayAfterSolve();var k=c.routeResults[0].directions,v=new P;if(k){this.set("solveResult",c);this.set("directions",k);var K=c.routeResults[0].stops,
A,aa;if(K&&K.length){var ea=[];for(A=0;A<K.length;A++){var ia=K[A];ia.attributes.isWaypoint=ia.attributes.Name===this._waypointName||ia.attributes.isWaypoint;ia=this._addStopWrapperToGraphic(ia,ia.attributes.Name);this.stops[A]&&this.stops[A].feature&&this.stops[A].feature.attributes&&this.stops[A].feature.attributes.Name===this._userDefinedStopName&&(ia.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===A?this._returnToStartStop=
ia:ea.push(ia)}if(this.stops.length>ea.length)for(A=0;A<this.stops.length;A++)this.stops[A].feature||""!==this.stops[A].name||ea.splice(A,0,this._emptyStop);this.stops=ea;for(A=0;A<this.stops.length;A++)this._updateStop(this.stops[A],A);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new da(k.mergedGeometry,this.get("routeSymbol")));K=[];ea=[];for(A=ia=0;A<k.featuresWithWaypoints.length;A++){var ja=k.featuresWithWaypoints[A];if("esriDMTDepart"===ja.attributes.maneuverType)for(aa=
0;aa<this.stops.length;aa++)if(this.stops[aa].feature===ja._associatedStop){ia=aa+1;break}ja.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ja);K.push(ja);(aa=ja.getDojoShape())&&aa.moveToBack();aa=new da(ja.geometry,this._symbolEventPaddingDirections,ja.attributes);aa._nextStopIndex=ia-.5;aa._isSnapFeature=!0;ja._associatedSnapFeature=aa;this._waypointsEventLayer.add(aa);"esriDMTDepart"!==ja.attributes.maneuverType&&(aa=ja.geometry.getPoint(0,0))&&(aa=new da(aa,this.maneuverSymbol),aa._directionsFeature=
ja._associatedFeatureNoWaypoints,ea.push(aa),this._waypointsEventLayer.add(ea[ea.length-1]))}this.set("displayedRouteGraphics",K);this.set("displayedManeuverPointGraphics",ea);this._renderDirections();for(A=0;A<this.stops.length;A++)if(this._isStopAWaypoint(this.stops[A])&&this._modifiedWaypointIndex===A){for(aa=0;aa<k.featuresWithWaypoints.length;aa++)if(K=k.featuresWithWaypoints[aa],K._associatedStop===this.stops[A].feature){if("esriDMTStop"===K.attributes.maneuverType||"esriDMTDepart"===K.attributes.maneuverType)this.stops[A].feature.geometry.x=
K.geometry.paths[0][0][0],this.stops[A].feature.geometry.y=K.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}S.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(c)}else c=c.routeResults[0].route,c.setSymbol(this.routeSymbol),this._routeLayer.add(c),this._incrementalRouteSegment=c;v.resolve();this._moveLayersToFront();this.createRouteSymbols();return v.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var c=0;c<this.geocoders.length;c++)this.geocoders[c]&&
this.stops[c]&&(this.geocoders[c]._stopReference=this.stops[c])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(c){var k=[];if(c&&c.length){for(var v=0;v<c.length;v++)k.push(this._getCandidate(c[v]));return oa(k)}c=new P;c.resolve([]);return c.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";S.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(c){if(c&&
this.get("showSegmentPopup")&&this.get("map").infoWindow){var k=c.geometry.getPoint(0,0);c=new da(k,null,c.attributes,this.get("segmentInfoTemplate"));var v=this.get("map").infoWindow;v.setFeatures([c]);v.show(k)}},_addStopButton:function(){this.addStop().then(u.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var c=this._dnd.getAllNodes();this.geocoders.sort(u.hitch(this,function(v,K){return v.domNode&&v.domNode.parentNode&&
v.domNode.parentNode.parentNode&&K.domNode&&K.domNode.parentNode&&K.domNode.parentNode.parentNode?X.indexOf(c,v.domNode.parentNode.parentNode)>X.indexOf(c,K.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var k=0;k<this.geocoders.length;k++)this.geocoders[k]&&this.geocoders[k].inputNode&&(this.geocoders[k].inputNode.title=B.widgets.directions.stopNoTitle+(k+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&
this._resultEvents.length)for(var c=0;c<this._resultEvents.length;c++)this._resultEvents[c]&&this._resultEvents[c].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(c){var k="",v;for(v in c)if(0===v.indexOf("Total_")&&c.hasOwnProperty(v)){var K=this._getCostAttribute(v.substr(6));K&&(k+=this._isTimeUnits(K.units)?this._formatTime(c[v],!1,K.units):this._formatDistance(c[v],!0,K.units),k+=k?" \x26middot; ":"")}k&&(k=B.widgets.directions.toNearbyStops+": \x3cb\x3e"+k.substr(0,
k.length-10)+"\x3c/b\x3e");return k},_formatTime:function(c,k,v){v||(v=(this._getDirectionsTimeAttribute()||{}).units);var K="";v=Math.round(this._convertCostValue(c,v,"esriNAUMinutes"));c=Math.floor(v/60);v=Math.floor(v%60);k?K=a.format(c,{pattern:100>c?"00":"000"})+":"+a.format(v,{pattern:"00"}):(c&&(K+=c+" "+B.widgets.directions.time.hr+" "),K+=c||v?v+" "+B.widgets.directions.time.min:"");return K},_formatDistance:function(c,k,v){v||(v=this.directionsLengthUnits);var K=this.directionsLengthUnits,
A=B.widgets.directions.units[K],aa=K.replace("esri","").toLowerCase();c=this._convertCostValue(c,v,K);A&&(aa=k?A.abbr:A.name);return c?a.format(c,{locale:"root",places:2})+" "+aa:""},_projectToGeographic:function(c){var k=new P;if(!c)return k.reject("Directions:: 'geometry' is not defined.",{geometry:c}),k.promise;if(4326==c.spatialReference.wkid)return k.resolve(c),k.promise;if(!this._geometryService)return k.reject("Directions:: Geometry service is not defined."),k.promise;var v=new Za;v.outSR=
new Ca(4326);v.geometries=[c];this._geometryService.project(v).then(function(K){k.resolve(K&&K[0])},k.reject);return k.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Ta(this.map));this.drawToolbar||(this.drawToolbar=new Ya(this.map),B.toolbars.draw.freehand=B.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=u.hitch(this,function(c){var k=new da(c.geometry,null,{BarrierType:0});this._projectToGeographic(c.geographicGeometry||c.geometry).then(u.hitch(this,
function(v){1<t.geodesicLengths([v],ra.METERS)[0]&&(this._polylineBarriersLayer.add(k),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new T),this.routeParams.polylineBarriers.features.push(k),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var c=new P;this._globalGeocoder=new db(this.get("searchOptions"));H.once(this._globalGeocoder,
"load",c.resolve,c.reject);this._globalGeocoder.startup();return c.promise},_init:function(){var c=new P;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);S.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(c.resolve);else H.once(this.get("map"),"load",u.hitch(this,function(){this._configure().always(c.resolve)}));return c.promise},_setDefaultStops:function(){var c=new P;this.defaults.stops&&this.defaults.stops.length?
this._updateStops(this.defaults.stops).then(u.hitch(this,function(){this._removeEmptyStops();c.resolve()}),c.reject):c.resolve();return c.promise},_configure:function(){var c=new P;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(u.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();
this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var k=[this._createRouteTask(),this._setDefaultStops()];oa(k).then(u.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var v=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||O.locale.toLowerCase();this._setDirectionsLanguageByLocale(v);this._setupTravelModes().then(u.hitch(this,function(){this.set("loaded",
!0);this.onLoad();c.resolve(!0)}),function(K){c.reject(K)})}),function(v){c.reject(v)})}),function(k){c.reject(k)});this._naRouteSharing=null;return c.promise},_setDirectionsLanguageByLocale:function(c){var k=this.serviceDescription.directionsSupportedLanguages,v=function(A){if(k)for(var aa=0;aa<k.length;aa++)if(k[aa].toLowerCase().substr(0,2)===A)return k[aa];return null},K=v(c);K||(c=c.substr(0,2),K=v(c));this.directionsLanguage=K;return this.routeParams.directionsLanguage=K},_getStopSymbol:function(c,
k){var v=c&&(c.feature&&c.feature.attributes||c.attributes),K=this.stopSymbol;v&&(K=this._isStopAWaypoint(c)?this.waypointSymbol:void 0===v.Status||0===v.Status||6===v.Status?null===v.ArriveCurbApproach&&null!==v.DepartCurbApproach?this.get(k?"fromSymbolDrag":"fromSymbol"):null!==v.ArriveCurbApproach&&null===v.DepartCurbApproach?this.get(k?"toSymbolDrag":"toSymbol"):this.get(k?"stopSymbolDrag":"stopSymbol"):this.get(k?"unreachedSymbolDrag":"unreachedSymbol"));return K},_addTrafficLayer:function(){this.trafficLayer&&
!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(c){c.target===this._useMilesNode?this.setDirectionsLengthUnits(ra.MILES):c.target===this._useKilometersNode&&this.setDirectionsLengthUnits(ra.KILOMETERS)},_toggleCheckbox:function(c){var k=R.get(c.target,"checked");c.target===this._findOptimalOrderNode?this.set("optimalRoute",k):c.target===this._useTrafficNode?this.set("traffic",k):c.target===this._returnToStartNode&&
this.set("returnToStart",k)},_isStopLocated:function(c){return c&&c.feature&&c.feature.attributes&&(!c.feature.attributes.Status||6===c.feature.attributes.Status)},_configureRouteOptions:function(){var c=this.get("routeParams"),k;this.get("directionsLengthUnits")?c.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",c.directionsLengthUnits);c.findBestSequence=this.get("optimalRoute");if(c.findBestSequence)for(c.preserveFirstStop=this._isStopLocated(this.stops[0]),
c.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),k=0;k<this.stops.length;)this._isStopAWaypoint(this.stops[k])?this._removeStop(k,!0,!0):k++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(k=this.stops.length-1;0<k;)this._isStopAWaypoint(this.stops[k])&&this._removeStop(k,!0,!0),k--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&
10.6<=this.serviceDescription.currentVersion)if(c.useTimeWindows=!0,"now"===this.startTime)c.timeWindowsAreUTC=!0,c.startTimeIsUTC=!0,c.startTime=new Date;else if("none"===this.startTime)c.startTime=null;else{c.timeWindowsAreUTC=!1;c.startTimeIsUTC=!1;var v=this._departAtTime,K=6E4*v.getValue().getTimezoneOffset();v=new Date(v.getValue().getTime()+this._departAtDate.getValue().getTime()-K);v=new Date(v.getTime()-6E4*v.getTimezoneOffset());c.startTime=v}else c.startTime=null,c.useTimeWindows=!1;v=
this._getImpedanceAttribute();K=this._getTimeNeutralAttribute();var A=this._getDirectionsTimeAttribute();k=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;K&&-1===X.indexOf(k,K.name)&&k.push(K.name);!this._isTimeUnits(v.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&A&&-1===X.indexOf(k,A.name)&&k.push(A.name);this.routeParams.accumulateAttributes=k;c.returnStops=!0;A=[];for(k=0;k<this.stopGraphics.length;k++)if(this.stopGraphics[k]&&
(A.push(new da(this.stopGraphics[k].toJson())),k)){var aa=A[0].attributes,ea=A[k].attributes;for(ia in ea)ea.hasOwnProperty(ia)&&!aa.hasOwnProperty(ia)&&(aa[ia]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var ia=new da(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(ia,ia.attributes.Name);A.push(ia)}else this._returnToStartStop=null;c.stops.features=A;if(K)for(k=0;k<A.length;k++)A[k].attributes["Attr_"+K.name]=
this._convertCostValue(A[k].attributes["Attr_"+v.name],v.units,K.units);this.set("routeParams",c)},_configureRoute:function(){var c=new P;c.promise.always(u.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var k=this._incrementalSolveStopRange;k.start<k.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(k.start,k.end+1):k.start>k.end&&(this.routeParams.stops.features=
this.routeParams.stops.features.slice(k.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,k.end+1)))}else this._incrementalSolveStopRange=null;var v={},K=this.routeParams.stops.features;for(k=0;k<K.length;k++){var A=K[k].attributes.address;var aa=(k===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:A)+"_"+this._stopSequence++;K[k].attributes.Name=aa;v[aa]=A;delete K[k].attributes.address;delete K[k].attributes.isWaypoint;
delete K[k].attributes.Status}this._solveInProgress=!0;var ea={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,u.hitch(this,function(ia){this._solveResultProcessing(ia,v,ea).then(c.resolve,c.reject)}),u.hitch(this,function(ia){u.mixin(this,ea);this._solveInProgress=!1;for(var ja=0;ja<this.stops.length;ja++)this.stops[ja].feature&&(this.stops[ja].feature.attributes=u.mixin(this.stops[ja].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();
this.createRouteSymbols();this._routeTaskError(ia);c.reject(ia)}));return c.promise},_solveResultProcessing:function(c,k,v){var K=new P;u.mixin(this,v);this._solveInProgress=!1;v=c.routeResults[0];var A=v.directions;v=v.stops;if(A){this._solverMessages=c.messages;var aa=function(sa){for(var ya in k)if(sa&&0===A.routeName.indexOf(ya)||!sa&&0<A.routeName.indexOf(ya))return k[ya];return""};var ea=aa(!0);aa=aa(!1);A.routeName=(ea!==this._waypointName?ea:B.widgets.directions.waypoint)+" \u2014 "+(aa!==
this._waypointName?aa:B.widgets.directions.waypoint);for(ea=0;ea<A.features.length;ea++)if(aa=A.features[ea].attributes,"esriDMTDepart"===aa.maneuverType||"esriDMTStop"===aa.maneuverType)for(var ia in k)if(k.hasOwnProperty(ia)&&-1<aa.text.indexOf(ia)){aa.text=aa.text.replace(ia,k[ia]);for(var ja=0;ja<v.length;ja++){var ua=v[ja].attributes;if(ua.Name===ia){u.mixin(A.features[ea],{_associatedStop:v[this.returnToStart&&ja===v.length-1?0:ja],_associatedStopWithReturnToStart:v[ja]});if(!ua.ArriveTime&&
!ua.ArriveTimeUTC&&aa.ETA&&aa.arriveTimeUTC){ua.ArriveTime=aa.ETA;ua.ArriveTimeUTC=aa.arriveTimeUTC;ja=0;if(0==ea&&"esriDMTDepart"===aa.maneuverType||0<ea&&"esriDMTStop"===aa.maneuverType)ja=this._convertCostValue(aa.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ua.DepartTime=ua.ArriveTime+ja;ua.DepartTimeUTC=ua.ArriveTimeUTC+ja}break}}}for(ea=0;ea<v.length;ea++)this._returnToStartStop&&v[ea].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=
ea),v[ea].attributes.Name=k[v[ea].attributes.Name];this._directionsPostprocessing(A);this.traffic&&this._updateMapTimeExtent()}this._showRoute(c).always(u.hitch(this,function(){this._incrementalSolveStopRange=null;K.resolve(c)}));return K.promise},_directionsPostprocessing:function(c){var k,v=function(aa,ea){var ia=c.features[aa]._associatedFeaturesWithWaypoints||[];ia.push(c.featuresWithWaypoints[ea]);c.features[aa]._associatedFeaturesWithWaypoints=ia;c.featuresWithWaypoints[ea]._associatedFeatureNoWaypoints=
c.features[aa]};var K=u.hitch(this,function(aa){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(aa._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});c.featuresWithWaypoints=[];for(k=0;k<c.features.length;k++){var A=new da(c.features[k].toJson());A.setInfoTemplate(new wa({title:this._i18n.widgets.directions.maneuver,content:K}));c.featuresWithWaypoints.push(A);c.featuresWithWaypoints[k]._associatedStop=c.features[k]._associatedStop;
c.featuresWithWaypoints[k]._associatedStopWithReturnToStart=c.features[k]._associatedStopWithReturnToStart}c.stringsWithWaypoints=u.mixin([],c.strings);c.eventsWithWaypoints=u.mixin([],c.events);for(K=k=0;k<c.features.length;)c.features[k]._associatedStop&&c.features[k]._associatedStop.attributes.Name===this._waypointName?(c.features.splice(k,k?2:1),c.strings.splice(k,k?2:1),c.events.splice(k,k?2:1),k&&c.features[k]&&"esriDMTStraight"===c.features[k].attributes.maneuverType?(A=c.features.splice(k,
1)[0],c.strings[k-1]=(c.strings[k-1]||[]).concat(c.strings.splice(k,1)[0]||[]),c.strings[k-1].length||(c.strings[k-1]=void 0),c.events[k-1]=(c.events[k-1]||[]).concat(c.events.splice(k,1)[0]||[]),c.events[k-1].length||(c.events[k-1]=void 0),c.features[k-1].attributes.length+=A.attributes.length,c.features[k-1].attributes.time+=A.attributes.time,c.features[k-1].geometry.paths[0]=c.features[k-1].geometry.paths[0].concat(A.geometry.paths[0]),v(k-1,K++),v(k-1,K++),v(k-1,K++)):(k&&v(k-1,K++),k<c.features.length&&
v(k,K++))):(v(k,K++),k++)},_boldText:function(c,k){try{var v=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+k.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");c=(" "+c+" ").replace(v,"\x3cstrong\x3e\x26nbsp;"+k+"\x26nbsp;\x3c/strong\x3e");c=c.trim()}catch(K){}return c},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var c=0;c<this.stopGraphics.length;c++)this._stopLayer.remove(this.stopGraphics[c]),this._stopLayer.remove(this.textGraphics[c]);
this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var c=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},k=(new Date).getTime();k="none"==this.startTime?k:c.arriveTimeUTC||k;this._useTrafficItemNode.title="none"!==this.startTime&&c.arriveTimeUTC?B.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(c.arriveTimeUTC,c.ETA):"";this._myTimeExtentUpdate=!0;c=new Date(k);this.map.setTimeExtent(new qa(c,
c))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var c=this.displayedRouteGraphics,k=this.displayedManeuverPointGraphics,v=this._routeLayer,K=this._waypointsEventLayer,A=0,aa=0,ea=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};c&&aa<c.length;){if(c[aa]._associatedStop)for(var ia=0;ia<this.stops.length;ia++)if(this.stops[ia].feature===
c[aa]._associatedStop){A=ia;break}A>=ea.start&&A<ea.end||ea.start>=ea.end&&(A>=ea.start||A<ea.end)?(v.remove(c[aa]),c.splice(aa,1)):aa++}v.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",c?c:[]);k&&k.length&&X.forEach(k,function(ja){K.remove(ja)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var c=this.get("map").infoWindow;c&&(c.hide(),c.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);
this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(c){var k=this.alphabet,v="",K=function(ea){var ia="";"0123456789"===k||"1234567890"===k?ia=String(ea+1):(ea=ea||0,ea>=k.length&&(ia=K(Math.floor(ea/k.length)-1),ea%=k.length),ia+=k[ea]);return ia},A=c instanceof da?u.hitch(this,function(){for(var ea=this.get("returnToStart")?0:-1,ia=0;ia<this.stops.length;ia++)if(this.stops[ia].feature===
c){ea=ia;break}return ea})():c;if(-1<A&&k&&k.length){k instanceof Array&&(k=k.toString().replace(/,/g,""));v=-1;for(var aa=0;aa<=A;aa++)v+=this._isStopAWaypoint(this.stops[aa])?0:1;v=K(v)}return v},_solveAndZoom:function(c){if(this.autoSolve)return this._getDirections().then(u.hitch(this,function(){c||this.zoomToFullRoute()}));var k=new P;k.resolve();return k.promise},_setupEvents:function(){this._onEvents.push(H(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(H(this._dndNode,
"[data-reverse-stops]:click, [data-reverse-stops]:keydown",u.hitch(this,function(A){A&&("click"===A.type||"keydown"===A.type&&A.keyCode===x.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(H(this._printButton,"click, keydown",u.hitch(this,function(A){A&&("click"===A.type||"keydown"===A.type&&A.keyCode===x.ENTER)&&this._printDirections()})));this._onEvents.push(H(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",u.hitch(this,function(A){A&&("click"===A.type||"keydown"===
A.type&&A.keyCode===x.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(H(this._dndNode,"[data-remove]:click, [data-remove]:keydown",u.hitch(this,function(A){if(A&&("click"===A.type||"keydown"===A.type&&A.keyCode===x.ENTER)){var aa=C("[data-remove]",this._dndNode);A=X.indexOf(aa,A.target);this.removeStop(A)}})));this._onEvents.push(H(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",u.hitch(this,function(A){if(A&&("click"===A.type||"keydown"===A.type&&A.keyCode===x.ENTER)){var aa=
C("[data-center-at]",this._dndNode);A=X.indexOf(aa,A.target);this.stops[A]&&this.stops[A].feature&&this.stops[A].feature.geometry&&this.map.centerAndZoom(this.stops[A].feature.geometry)}})));this._onEvents.push(H(this.map,"zoom-end",u.hitch(this,function(){var A=this._segmentGraphics;A&&A[0]&&void 0!==A[0].attributes._index&&this.highlightSegment(A[0].attributes._index,!0)})));this._onEvents.push(H(this._dnd,"Drop",u.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var A,aa=!1,ea=
[],ia=this._dnd.getAllNodes();for(A=0;A<this.geocoders.length;A++){var ja=X.indexOf(ia,this.geocoders[A]._tr);if(-1<ja&&A!==ja&&A!==ja-1){for(;0<ja&&this._isStopAWaypoint(this.stops[ja]);)ja--;aa=!0;break}}aa&&(ea=this._markWPsForRemovalAfterUserChangedStopSequence(A,ja));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ea);this.stops[ja].name&&this.getDirections()})));this._onEvents.push(H(this._dnd,"DndStart",u.hitch(this,function(){var A=C("body")[0];M.add(A,this._css.dndDragBodyClass);
this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(H(this._dnd,"DndDrop, DndCancel",u.hitch(this,function(){var A=C("body")[0];M.remove(A,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var c=this._handle,k=u.hitch(this,function(A){var aa=u.hitch(this,function(ia,ja,ua,sa,ya){var za=c._isShown();c.setGeometry(ia);c._tooltip.style.left=A.screenPoint.x+"px";c._tooltip.style.top=A.screenPoint.y+"px";!za||c._index===ua&&c.attributes.isWaypoint===sa||(c._remove(),
za=!1);c.setSymbol(ja);c._index=ua;c._isStopIcon=c._index===Math.floor(c._index);c.attributes.isWaypoint=sa;c._isStopIcon&&(c.attributes.address=this.stopGraphics[ua].attributes.address,c.setInfoTemplate(this.stopGraphics[ua].infoTemplate));if(this.canModifyWaypoints||c._isStopIcon)za||(this._stopLayer.add(c),(ia=c.getDojoShape())&&ia[sa?"moveToBack":"moveToFront"].call(ia)),this.editToolbar.activate(Ta.MOVE,c);sa=sa?c._isStopIcon?B.widgets.directions.dragWaypoint:this.canModifyWaypoints?B.widgets.directions.dragRoute:
"":B.widgets.directions.dragStop;c._showTooltip(ya||sa)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!c._solveTimeout)if(clearTimeout(c._removeTimeout),(A.graphic._isStopIcon||A.graphic._isStopLabel)&&!A.graphic.attributes.isWaypoint&&this.canModifyStops||A.graphic._isStopIcon&&A.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ea=A.graphic._isStopLabel?this.stopGraphics[A.graphic._index]:A.graphic;aa(ea.geometry,this._getStopSymbol(this.stops[ea._index],
!0),ea._index,!0===ea.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ea._index]);this._stopLayer.remove(this.textGraphics[ea._index])}else if(A.graphic._isSnapFeature||A.graphic._isHandle&&!A.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(A.screenPoint).then(u.hitch(this,function(ia){if(!this.maxStopsReached&&!this._moveInProgress&&ia){for(var ja=this.displayedManeuverPointGraphics,ua=null,sa=0;sa<
ja.length;sa++)if(ja[sa].geometry.x===ia.x&&ja[sa].geometry.y===ia.y){ua=ja[sa]._directionsFeature;ja=X.indexOf(this.directions.features,ua);-1<ja&&this.highlightSegment(ja);break}aa(ia,A.graphic._isHandle?c.symbol:this.waypointSymbol,A.graphic._isHandle?c._index:A.graphic._nextStopIndex,A.graphic._isHandle?c.attributes.isWaypoint:!0,ua)}}))}),v=u.hitch(this,function(){clearTimeout(c._removeTimeout);c._removeTimeout=setTimeout(c._remove,100);this.unhighlightSegment()}),K=u.hitch(this,function(A){if(this.barrierToolActive){A=
A.graphic;var aa=this.routeParams,ea=aa.barriers?X.indexOf(aa.barriers.features,A):-1,ia=aa.polygonBarriers?X.indexOf(aa.polygonBarriers.features,A):-1,ja=aa.polylineBarriers?X.indexOf(aa.polylineBarriers.features,A):-1;-1<ea&&aa.barriers.features.splice(ea,1);-1<ia&&aa.polygonBarriers.features.splice(ia,1);-1<ja&&aa.polylineBarriers.features.splice(ja,1);this._barriersLayer.remove(A);this._polygonBarriersLayer.remove(A);this._polylineBarriersLayer.remove(A);this._clearStopsStatusAttr();this.getDirections(!0)}});
this._onEvents.push(this._waypointsEventLayer.on("mouse-move",k));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",v));this._onEvents.push(this._stopLayer.on("mouse-move",k));this._onEvents.push(this._stopLayer.on("mouse-out",v));this._onEvents.push(this._barriersLayer.on("click",K));this._onEvents.push(this._polylineBarriersLayer.on("click",K));this._onEvents.push(this._polygonBarriersLayer.on("click",K));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));
this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",
this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",u.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",u.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",u.hitch(this,function(){this._createGeometryTask()})));
this._watchEvents.push(this.watch("routeParams",u.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",u.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var A=this.get("searchOptions").sources;if(A)for(var aa=0;aa<this.geocoders.length;aa++)this.geocoders[aa].set("sources",A)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",
this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",
this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){S.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){S.set(this._saveMenuButton,"display",
this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var c=u.hitch(this,function(v){var K="";if((v=v.routeResults?v.routeResults[0]:null)&&v.route){v=v.route.attributes;var A=this.routeParams.travelMode;if(A){K+="\x3cb\x3e"+A.name+"\x3c/b\x3e "+B.widgets.directions.toNearbyStops+": ";var aa=void 0!==v["Total_"+A.timeAttributeName]?this._formatTime(v["Total_"+A.timeAttributeName],!1,(this._getCostAttribute(A.timeAttributeName)||{}).units):"";K+=(void 0!==
v["Total_"+A.distanceAttributeName]?this._formatDistance(v["Total_"+A.distanceAttributeName],!0,(this._getCostAttribute(A.distanceAttributeName)||{}).units):"")+(aa?" \x26middot; "+aa:"")}else K=this._formatArbitraryCostsForRouteTooltip(v)}this._handle._showTooltip(K)}),k=u.hitch(this,function(v,K){var A=new P,aa=this._handle,ea=this.map.toScreen(aa._origPoint).offset(v.transform.dx+aa.symbol.xoffset,v.transform.dy+aa.symbol.yoffset);v.origMapPoint||(v.origMapPoint=this.map.toMap(ea));S.set(aa._tooltip,
"left",ea.x+"px");S.set(aa._tooltip,"top",ea.y+"px");clearTimeout(aa._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())aa._solveTimeout=setTimeout(function(){k(v,K).always(A.resolve)},100);else if(aa._isStopIcon){ea=v.graphic._index;var ia=this.stops[ea];(ia=ia?{name:ia.name,extent:ia.extent,feature:new da(ia.feature.toJson())}:null)?(ia.feature.setGeometry(v.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ea])?ea:null,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+ea-1)%this.stops.length:Math.max(0,ea-1),end:this.returnToStart?(ea+1)%this.stops.length:Math.min(this.stops.length-1,ea+1)},this.updateStop(ia,ea,K).always(u.hitch(this,function(ja){aa._solveTimeout=null;ja.routeResults&&c(ja);A.resolve()}))):A.resolve()}else A.resolve();return A.promise});this._onEvents.push(H(this.editToolbar,"graphic-click",u.hitch(this,function(v){if(v.graphic.attributes.isWaypoint)!v.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||
(this._handle._remove(),this._moveInProgress=!0,this.removeStop(v.graphic._index,!0).always(u.hitch(this,function(){this._moveInProgress=!1})));else{var K=this.get("map").infoWindow;K&&(K.setFeatures([v.graphic]),K.show(v.graphic.geometry))}})));this._onEvents.push(H(this.editToolbar,"graphic-move-start",u.hitch(this,function(v){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;v=v.graphic;v._origPoint=new ca(v.geometry.toJson());
v._maxDeviation=0;v._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(H(this.editToolbar,"graphic-move-stop",u.hitch(this,function(v){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)k(v,!0).always(u.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));
else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var K=this.stops[v.graphic._index],A=(K&&K.feature&&K.feature.attributes&&K.feature.attributes.Name)===this._userDefinedStopName,aa=K&&K.name;this._reverseGeocode(new da(v.graphic.toJson())).then(u.hitch(this,function(ea){A&&(ea.name=aa,ea.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ea,ea.feature.geometry,v.graphic._index).always(u.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();
this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(H(this.editToolbar,"graphic-move",u.hitch(this,function(v){var K=this._handle,A=v.transform;A.dx&&A.dy&&(v.graphic._maxDeviation=Math.max(K._maxDeviation,Math.sqrt(A.dx*A.dx+A.dy*A.dy)));10<K._maxDeviation&&(K._solveHasHappened=!0,v.graphic===K&&K.attributes.isWaypoint&&!K._isStopIcon?(this.set("optimalRoute",!1),K._index+=.5,K._isStopIcon=!0,v.graphic._stopIndex=K._index,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+K._index-1)%this.stops.length:Math.max(0,K._index-1),end:this.returnToStart?(K._index+1)%(this.stops.length+1):Math.min(this.stops.length,K._index+1)},this.addStop({name:this._waypointName,feature:new da(K.geometry,K.symbol,{isWaypoint:!0,CurbApproach:3})},v.graphic._stopIndex)):((K=v.graphic.getDojoShape())&&K.moveToFront(),k(v)))})))},_isStopAWaypoint:function(c){return c&&c.feature&&c.feature.attributes&&c.feature.attributes.isWaypoint},_getStopCount:function(){var c=
0,k;for(k=0;k<this.stops.length;k++)c+=!this._isStopAWaypoint(this.stops[k])&&this.stops[k].name?1:0;return c},_getWaypointCount:function(){var c=0,k;for(k=0;k<this.stops.length;k++)c+=this._isStopAWaypoint(this.stops[k])?1:0;return c},_decorateUngeocodedStop:function(c){var k=new P,v=function(A,aa){k.resolve({name:void 0===A?B.widgets.directions.unlocatedStop:A.toFixed(6)+" "+aa.toFixed(6),feature:c})};if(c.geometry)if(c.geometry.spatialReference&&4326!==c.geometry.spatialReference.wkid)if(this.map&&
this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var K=D.xyToLngLat(c.geometry.x,c.geometry.y);v(K[0],K[1])}else this._geometryService?(K=new Za,K.outSR=new Ca(4326),K.geometries=[c.geometry],this._geometryService.project(K).then(u.hitch(this,function(A){A&&A.length?v(A[0].x,A[0].y):v(c.geometry.x,c.geometry.y)}),u.hitch(this,function(){v()}))):v(c.geometry.x,c.geometry.y);else v(c.geometry.x,c.geometry.y);else v();return k.promise},_trafficLayerUpdate:function(c,k,v){c=this.get("map");
k&&this._trafficLayerAdded&&(c.removeLayer(k),this._trafficLayerAdded=!1);v&&this.get("traffic")&&!this._trafficLayerAdded&&(c.addLayer(v),v.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(c){var k=B.widgets.directions.error.routeTask,v=c.details,K=function(A){return(res=A.match(/(\d+)/))?": "+res[0]:"."};v&&1===v.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===v[0]?k=B.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===
v[0]?k=B.widgets.directions.error.nonNAmTruckingMode:0===v[0].indexOf("The number of input locations loaded into Barriers")?k=B.widgets.directions.error.tooManyBarriers+K(v[0]):0===v[0].indexOf("The number of input locations loaded into PolygonBarriers")?k=B.widgets.directions.error.tooManyPolygonBarriers+K(v[0]):0===v[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(k=B.widgets.directions.error.tooManyPolylineBarriers+K(v[0])));this._showMessage(k);this.onDirectionsFinish(c)},
_showMessage:function(c,k){var v="";this.messages.push({msg:c,error:!k});if(this.messages.length){v+="\x3cul\x3e";for(var K=0;K<this.messages.length;K++)v+='\x3cli class\x3d"'+(this.messages[K].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[K].msg+"\x3c/li\x3e";v+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=v);if(!k)this.onError(c)},_isTimeUnits:function(c){return"milliseconds"===c||"esriNAUSeconds"===c||"esriNAUMinutes"===c||"esriNAUHours"===c||"esriNAUDays"===
c},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var c=
(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(c)},_getCostAttribute:function(c){for(var k=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],v,K=0;K<k.length;K++)if(k[K].name===c&&"esriNAUTCost"===k[K].usageType){v=k[K];break}return v},_convertCostValue:function(c,k,v){var K=this._isTimeUnits(k),A=this._isTimeUnits(v);k=K?this._toMinutes(c,k):this._toMeters(c,k);return K===A?A?this._fromMinutes(k,v):this._fromMeters(k,
v):c},_toMinutes:function(c,k,v){c=c||0;switch(k){case "milliseconds":c/=Math.pow(6E4,v?-1:1);break;case "esriNAUSeconds":c/=Math.pow(60,v?-1:1);break;case "esriNAUHours":c*=Math.pow(60,v?-1:1);break;case "esriNAUDays":c*=Math.pow(1440,v?-1:1)}return c},_fromMinutes:function(c,k){return this._toMinutes(c,k,!0)},_toMeters:function(c,k,v){c=c||0;switch((k||"").replace("esriNAU","esri")){case "esriInches":c*=Math.pow(.0254,v?-1:1);break;case "esriFeet":c*=Math.pow(.3048,v?-1:1);break;case "esriYards":c*=
Math.pow(.9144,v?-1:1);break;case "esriMiles":c*=Math.pow(1609.344,v?-1:1);break;case "esriNauticalMiles":c*=Math.pow(1851.995396854,v?-1:1);break;case "esriMillimeters":c/=Math.pow(1E3,v?-1:1);break;case "esriCentimeters":c/=Math.pow(100,v?-1:1);break;case "esriKilometers":c*=Math.pow(1E3,v?-1:1);break;case "esriDecimeters":c/=Math.pow(10,v?-1:1)}return c},_fromMeters:function(c,k){return this._toMeters(c,k,!0)},_createRouteTask:function(){var c=new P;this.set("routeTask",new ba(this.get("routeTaskUrl")));
this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(u.hitch(this,function(k){k.networkDataset?(this.set("serviceDescription",k),this.set("maxStops",parseInt(this.userOptions.maxStops||k.serviceLimits&&k.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,c.resolve()):this.routeTask.getOwningSystemUrl().then(u.hitch(this,function(v){this.owningSystemUrl=
v;c.resolve()}),c.reject)):(this._showMessage(B.widgets.directions.error.cantFindRouteServiceDescription),c.reject(Error(B.widgets.directions.error.cantFindRouteServiceDescription)))}),u.hitch(this,function(){this._showMessage(B.widgets.directions.error.cantFindRouteServiceDescription);c.reject(Error(B.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));return c.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&
1<this._globalGeocoder.sources.length){var c=u.hitch(this,function(K){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",K);for(var A=0;A<this.geocoders.length;A++)this.geocoders[A].set("activeSourceIndex",K);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var k=[{value:"all",label:B.widgets.Search.main.all,selected:!0}],v=0;v<this._globalGeocoder.sources.length;v++)k.push({value:String(v),label:this._globalGeocoder.sources[v].name});
this._searchSourceSelector=new d({className:"esriSearchSourcesDDL",style:"width:100%;",options:k},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",c);this._searchSourceSelector.domNode.style.width=""}c("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new d({className:"esriTravelModesDDL",style:"width:100%;"},
this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",u.hitch(this,function(c){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(c).always(u.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var c=this.get("serviceDescription"),k=c.supportedTravelModes,v=new P;if(k&&k.length&&
this._travelModeSelector){for(var K=k[0].name,A=[],aa=0;aa<k.length;aa++){for(var ea="AUTOMOBILE"===k[aa].type?"Driving":"TRUCK"===k[aa].type?"Trucking":"WALK"===k[aa].type?"Walking":"Other",ia="",ja=c.networkDataset.networkAttributes,ua=0;ua<ja.length;ua++){var sa=ja[ua];if(sa.name===k[aa].impedanceAttributeName){if("esriNAUCentimeters"===sa.units||"esriNAUDecimalDegrees"===sa.units||"esriNAUDecimeters"===sa.units||"esriNAUFeet"===sa.units||"esriNAUInches"===sa.units||"esriNAUKilometers"===sa.units||
"esriNAUMeters"===sa.units||"esriNAUMiles"===sa.units||"esriNAUMillimeters"===sa.units||"esriNAUNauticalMiles"===sa.units||"esriNAUYards"===sa.units)ia="Distance";else if("esriNAUDays"===sa.units||"esriNAUHours"===sa.units||"esriNAUMinutes"===sa.units||"esriNAUSeconds"===sa.units)ia="Time";break}}A.push({id:k[aa].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ea+ia+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+k[aa].description+
'"\x3e'+k[aa].name+"\x3c/div\x3e"});!c.defaultTravelMode||k[aa].id!==c.defaultTravelMode&&k[aa].itemId!==c.defaultTravelMode||(K=k[aa].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new h({objectStore:new n({data:A})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(K);this._setTravelMode(K).always(v.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),v.resolve();return v.promise},_createPrintTask:function(){this._printService=
(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new Da(this.printTaskUrl,{async:!1}):null;var c=new Na;c.exportOptions={width:670,height:750,dpi:96};c.format="PNG32";c.layout="MAP_ONLY";c.preserveScale=!1;c.showAttribution=!1;var k=new Ka;k.map=this.map;k.outSpatialReference=this.map.spatialReference;k.template=c;this._printParams=k},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new xa(this.geometryTaskUrl):this.geometryTaskUrl=
(this._geometryService=this.defaults.geometryTaskUrl?new xa(this.defaults.geometryTaskUrl):ab.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var c=this.get("serviceDescription");S.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&c&&c.supportedTravelModes&&c.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){S.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){S.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){S.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){S.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var c=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new T,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var k=new pa;this.routeParams=u.mixin(k,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),c)},
_markWPsForRemovalAfterUserChangedStopSequence:function(c,k){for(var v=c-1,K=[];0<=v&&this._isStopAWaypoint(this.stops[v]);)K.push(this.stops[v]),v--;for(v=c+1;v<this.stops.length&&this._isStopAWaypoint(this.stops[v]);)K.push(this.stops[v]),v++;if(k>c)for(v=k+1;v<this.stops.length&&this._isStopAWaypoint(this.stops[v]);)K.push(this.stops[v]),v++;else if(void 0!==k)for(v=k-1;0<=v&&this._isStopAWaypoint(this.stops[v]);)K.push(this.stops[v]),v--;else if(this.returnToStart&&0===c)for(v=this.stops.length-
1;0<=v&&this._isStopAWaypoint(this.stops[v]);)K.push(this.stops[v]),v--;return K},_removeSomeWaypoints:function(c){for(var k=new P,v=[],K=0;K<c.length;K++){var A=X.indexOf(this.stops,c[K]);-1<A&&v.push(this._removeStop(A,!0,!0))}oa(v).always(k.resolve);return k.promise},_modifyStopSequence:function(c,k){var v=this._dnd.getAllNodes(),K=new P,A,aa=[];if(v.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==c)if(0<=c&&0<=k&&c<this.stops.length&&k<this.stops.length&&c!==k){v=
this._markWPsForRemovalAfterUserChangedStopSequence(c,k);var ea=this.stops.splice(c,1);this.stops.splice(k,0,ea[0]);for(A=0;A<this.stops.length;A++)aa.push(this._updateStop(this.stops[A],A));aa.push(this._removeSomeWaypoints(v));oa(aa).always(u.hitch(this,function(){this._solveAndZoom().always(K.resolve)}))}else K.reject("Invalid From and To values.");else{for(A=0;A<this.stops.length;)this._isStopAWaypoint(this.stops[A])?aa.push(this._removeStop(A,!0,!0)):A++;oa(aa).always(u.hitch(this,function(){aa=
[];this.stops.reverse();for(A=0;A<this.stops.length;A++)aa.push(this._updateStop(this.stops[A],A));oa(aa).always(u.hitch(this,function(){this._solveAndZoom().always(K.resolve)}))}))}else K.resolve();return K.promise},_setMenuNodeValues:function(c){"traffic"!==c&&this._clearDisplayBeforeSolve();c=this.get("optimalRoute");this._findOptimalOrderNode&&R.set(this._findOptimalOrderNode,"checked",c);this._returnToStartNode&&(c=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||
this._isStopLocated(this.stops[0])),R.set(this._returnToStartNode,"checked",c),this.set("returnToStart",c),this.maxStopsReached&&this.returnToStart&&this._showMessage(B.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,c=this.stops.length;0<c--&&this._isStopAWaypoint(this.stops[c]);)this._removeSomeWaypoints([this.stops[c]]);
this._useTrafficNode&&(R.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case ra.KILOMETERS:R.set(this._useKilometersNode,"checked",!0);R.set(this._useMilesNode,"checked",!1);break;case ra.MILES:R.set(this._useKilometersNode,"checked",!1),R.set(this._useMilesNode,"checked",!0)}S.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");S.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&S.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&S.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&S.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?M.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(M.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===S.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?M.add(this._widgetContainer,this._css.stopsRemovableClass):
M.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(c,k,v){M.remove(this.domNode,k);M.add(this.domNode,v)},_toggleOptionsMenu:function(){"block"===S.get(this._optionsMenuNode,"display")?(S.set(this._optionsMenuNode,"display","none"),M.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
B.widgets.directions.showOptions):(S.set(this._optionsMenuNode,"display","block"),M.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=B.widgets.directions.hideOptions)},_toggleSaveMenu:function(c){"block"===S.get(this._saveMenuNode,"display")||!1===c?(S.set(this._saveMenuNode,"display","none"),M.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),S.set(this._saveMenuNode,"display","block"),M.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(u.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var k=this._folderSelector.store.objectStore.data,v=0;v<k.length;v++)if(k[v].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==k[v].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(k[v].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){M[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(la,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(c){c=V.toUrl(c);return/^https?:/i.test(c)?c:/^\/\//i.test(c)?Xa+c:/^\//i.test(c)?Xa+"//"+window.location.host+c:c},_getManeuverImage:function(c){return c?"esriDMTStop"===c||"esriDMTDepart"===c?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+c+".png"):""},_loadPrintDirections:function(c){var k=this.get("printTemplate"),v=new P;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(v.resolve,
v.reject):v.resolve();v.then(u.hitch(this,function(){if(!k&&this.directions){var K=this._getAbsoluteUrl("./css/Directions.css"),A=this._getAbsoluteUrl("./css/DirectionsPrint.css"),aa=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ea=Q.isBodyLtr()?"ltr":"rtl";k="";k+="\x3c!DOCTYPE HTML\x3e";k+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ea+'"\x3e';k+="\x3chead\x3e";k+='\x3cmeta charset\x3d"utf-8"\x3e';k+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
k+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";k+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+K+'" /\x3e';k+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+A+'" /\x3e';k+="\x3c/head\x3e";k+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';k+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';k+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+B.common.close+'" onclick\x3d"window.close();"\x3e'+
B.common.close+"\x3c/div\x3e";k+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+B.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+B.widgets.directions.print+"\x3c/div\x3e";k+="\x3c/div\x3e";k+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';k+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';k+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+aa+'" /\x3e';k+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";k+=this._renderDirectionsSummary(this.directions);c&&(k+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',k+='\x3chr class\x3d"esriNoPrint"/\x3e');k+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';k+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+B.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
k+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';k+="\x3c/div\x3e";k+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';k+=this._renderDirectionsTable(this.directions);k+="\x3c/div\x3e";k+="\x3c/div\x3e";k+="\x3c/div\x3e";k+="\x3c/body\x3e";k+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(k);this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var c=
this._searchSourceSelector;if(this._searchSourceSelector){var k=c.containerNode.firstChild;S.set(k,"width","");c.domNode.clientWidth>this.domNode.clientWidth&&S.set(k,"width",this._searchSourceContainerNode.clientWidth-20+"px")}},_printDirections:function(){if(this.directions){var c=screen.width/2,k=screen.height/1.5;c="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+c+", height\x3d"+k+", top\x3d"+(screen.height/2-k/2)+
", left\x3d"+(screen.width/2-c/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",c,!0)):(this._printWindow=window.open("","directions_widget_print",c,!0),this._loadPrintDirections(!!this._printService),this._printService&&V(["dojo/_base/window"],u.hitch(this,function(v){this.zoomToFullRoute().then(u.hitch(this,function(){this._printService.execute(this._printParams,u.hitch(this,function(K){v.withDoc(this._printWindow.document,
function(){var A=G.byId("divMap");A&&(M.remove(A,"esriPrintWait"),M.add(A,"esriPageBreak"),la.create("img",{src:K.url,"class":"esriPrintMapImg"},A))})}),u.hitch(this,function(K){v.withDoc(this._printWindow.document,function(){var A=G.byId("divMap");A&&M.remove(A,"esriPrintWait")});console.error("Error while calling print service:\n "+K)}))}))})))}},_enableButton:function(c,k){k=k||void 0===k;M[k?"remove":"add"].apply(this,[c,"esriDisabledDirectionsButton"]);c._enabled=k},_clearStopsStatusAttr:function(){for(var c=
0;c<this.stops.length;c++)this.stops[c].feature&&this.stops[c].feature.attributes&&(this.stops[c].feature.attributes.Status=void 0)},_enableSharing:function(){var c=new P;!this._naRouteSharing&&this.owningSystemUrl?V(["../tasks/NARouteSharing"],u.hitch(this,function(k){this._naRouteSharing=new k(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new d({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:u.hitch(this,
function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new e({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:u.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:u.hitch(this,function(){this.map&&
this.map.disableKeyboardNavigation()}),onBlur:u.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(u.hitch(this,function(v){for(var K=[],A=0;A<v.length;A++)K.push({id:v[A].url,folderId:v[A].id,label:v[A].title});this._folderSelector.setStore(new h({objectStore:new n({data:K})}));this._naRouteSharing.canCreateItem().then(u.hitch(this,function(aa){this._folderSelector.set("disabled",!aa);
this._userCanCreatePortalItem=aa}));this._enableButton(this._saveButton);c.resolve()}),u.hitch(this,function(v){console.log(v);this._naRouteSharing=null;this._toggleSaveMenu(!1);c.reject(v)}))})):this.owningSystemUrl?c.resolve():(c.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return c.promise},_storeRouteUI:function(){var c=new P;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),
this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(c.resolve,c.reject):(this._outputLayer&&this._outputLayer.focus(),c.reject(Error("Need result layer name specified.")));return c.promise},_storeRoute:function(c,k,v){var K=new P,A=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),K.reject(Error("Not ready to store route.")),K.promise;this.clearMessages();K.then(null,u.hitch(this,function(Ga){console.log("ERR",
Ga);this._showMessage(B.widgets.directions.error.cantSaveRoute)}));K.promise.always(u.hitch(this,function(){this._enableButton(this._saveButton);S.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(A&&A.features&&A.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(c&&k){var aa=u.hitch(this,function(Ga){return this._naRouteSharing.getAttributeUnits(Ga,
this.serviceDescription)});var ea=this.routeParams.travelMode.timeAttributeName;var ia=this.routeParams.travelMode.distanceAttributeName,ja=aa(ea),ua=aa(ia),sa=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,ya=this._naRouteSharing.toMeters,za=this._naRouteSharing.toMinutes,Fa=function(Ga,La,Ra){var Sa;for(Sa in Ga)if(Ga.hasOwnProperty(Sa)&&0===Sa.indexOf(La)&&-1===X.indexOf(Ra,Sa.substr(La.length))){var bb=bb||{};bb[Sa.substr(La.length)]=Ga[Sa]}return bb},Ea=
[],Ia=[],Oa=[];if(ea&&ja&&ia&&ua){var Va=[],Qa=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],Pa=this.serviceDescription.networkDataset.networkAttributes;for(aa=0;aa<Pa.length;aa++)"esriNAUTCost"===Pa[aa].usageType&&-1===X.indexOf(Qa,Pa[aa].name)&&Pa[aa].name!==ea&&Pa[aa].name!==ia&&Va.push(Pa[aa].name);Qa=this.get("stops");var Ma={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(aa=0;aa<Qa.length;aa++)if(Qa[aa].feature&&Qa[aa].feature.toJson){Pa=
Qa[aa].feature.toJson();var Ha=Pa.attributes;var Ja=Pa.geometry,Ua=this._naRouteSharing.getUTCOffset(Ha.ArriveTime,Ha.ArriveTimeUTC),Wa=this._naRouteSharing.getUTCOffset(Ha.DepartTime,Ha.DepartTimeUTC);u.mixin(Ma,{xmin:Ma.xmin>Ja.x?Ja.x:Ma.xmin,ymin:Ma.ymin>Ja.y?Ja.y:Ma.ymin,xmax:Ma.xmax<Ja.x?Ja.x:Ma.xmax,ymax:Ma.ymax<Ja.y?Ja.y:Ma.ymax});Pa.attributes={__OBJECTID:aa+1,CurbApproach:Ha.CurbApproach,ArrivalCurbApproach:Ha.ArriveCurbApproach,DepartureCurbApproach:Ha.DepartCurbApproach,Name:Ha.Name===
this._waypointName?B.widgets.directions.waypoint:Ha.Name===this._userDefinedStopName?Qa[aa].name:Ha.Name,RouteName:A.routeName,Sequence:Ha.Sequence,Status:Ha.Status,LocationType:Ha.isWaypoint?1:0,TimeWindowStart:Ha.TimeWindowStart,TimeWindowEnd:Ha.TimeWindowEnd,TimeWindowStartUTCOffset:Ua,TimeWindowEndUTCOffset:Ua,ServiceMinutes:za(Ha["Attr_"+ea],ja),ServiceMeters:ya(Ha["Attr_"+ia],ua),ServiceCosts:ma.stringify(Fa(Ha,"Attr_",Va)),CumulativeMinutes:za(Ha["Cumul_"+ea],ja),CumulativeMeters:ya(Ha["Cumul_"+
ia],ua),CumulativeCosts:ma.stringify(Fa(Ha,"Cumul_",Va)),LateMinutes:za(Ha["Violation_"+ea],ja),WaitMinutes:za(Ha["Wait_"+ea],ja),ArrivalTime:this._naRouteSharing.toUTCTime(Ha.ArriveTime,Ua),DepartureTime:this._naRouteSharing.toUTCTime(Ha.DepartTime,Wa),ArrivalUTCOffset:Ua,DepartureUTCOffset:Wa};Ea.push(Pa)}ia=0;ua=function(Ga){try{Ga.strings=ma.parse(Ga.strings)}catch(Ra){cb.strings=void 0}if(Ga.strings&&Ga.strings.length)for(var La=0;La<Ga.strings.length;La++)if("esriDSTGeneral"===Ga.strings[La].stringType)return Ga.strings[La].string};
Qa=function(Ga,La){for(var Ra=[],Sa=0;Sa<(Ga||[]).length;Sa++)Ga[Sa].stringType!==La&&La||Ra.push(Ga[Sa].string);return Ra.length?Ra.toString():void 0};Pa=function(Ga){switch(Ga){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";
case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";
case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";
case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(aa=0;aa<A.featuresWithWaypoints.length;aa++){var $a=A.featuresWithWaypoints[aa];Ja=$a.toJson();Ua=Ja.attributes;Wa=Ja.geometry&&Ja.geometry.paths&&Ja.geometry.paths[0]||[];var eb=Ja.geometry.hasM||Wa[0]&&3===Wa[0].length;Ha=this._naRouteSharing.getUTCOffset(Ua.ETA,Ua.arriveTimeUTC);Ja.attributes={__OBJECTID:aa+1,Sequence:++ia,StopID:function(){var Ga=void 0,La=$a._associatedStopWithReturnToStart&&
$a._associatedStopWithReturnToStart.attributes.Sequence;if(La)for(var Ra=0;Ra<Ea.length;Ra++)if(Ea[Ra].attributes.Sequence===La){Ga=Ea[Ra].attributes.__OBJECTID;break}return Ga}(),DirectionPointType:Pa(Ua.maneuverType),DisplayText:$a._associatedStopWithReturnToStart&&$a._associatedStopWithReturnToStart.attributes.isWaypoint?Ua.text.replace(this._waypointName,B.widgets.directions.waypoint):Ua.text,ArrivalTime:this._naRouteSharing.toUTCTime(Ua.ETA,Ha),ArrivalUTCOffset:Ha,Azimuth:void 0,Name:Qa(A.stringsWithWaypoints[aa],
"esriDSTStreetName"),AlternateName:Qa(A.stringsWithWaypoints[aa],"esriDSTAltName"),ExitName:Qa(A.stringsWithWaypoints[aa],"esriDSTExit"),IntersectingName:Qa(A.stringsWithWaypoints[aa],"esriDSTCrossStreet"),BranchName:Qa(A.stringsWithWaypoints[aa],"esriDSTBranch"),TowardName:Qa(A.stringsWithWaypoints[aa],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete Ja.symbol;delete Ja.infoTemplate;Wa.length?(Ja.geometry={x:Wa[0][0],y:Wa[0][1],spatialReference:Ja.geometry.spatialReference},
eb&&u.mixin(Ja.geometry,{m:Wa[0][2]})):delete Ja.geometry;Ia.push(Ja);Ja=$a.toJson();Ua=Ja.attributes;Wa=Ja.geometry&&Ja.geometry.paths&&Ja.geometry.paths[0]||[];Ha=!0;for(ea=0;ea<Wa.length-1;ea++)if(Wa[ea][0]!==Wa[ea+1][0]||Wa[ea][1]!==Wa[ea+1][1]){Ha=!1;break}Ha||(Ja.attributes={DirectionPointID:aa+1,DirectionLineType:"esriDLTSegment",Meters:ya(Ua.length,sa),Minutes:za(Ua.time,ja),FromLevel:void 0,ToLevel:void 0},Ja.geometry.hasM=eb,delete Ja.symbol,delete Ja.infoTemplate,Oa.push(Ja));var cb=A.eventsWithWaypoints[Ja.attributes.Sequence]||
[];for(ea=0;ea<cb.length;ea++)Ja=cb[ea].toJson(),Ua=Ja.attributes,Ha=this._naRouteSharing.getUTCOffset(Ua.ETA,Ua.arriveTimeUTC),Ja.attributes={Sequence:++ia,DirectionPointType:"esriDPTEvent",DisplayText:ua(Ua),ArrivalTime:this._naRouteSharing.toUTCTime(Ua.ETA,Ha),ArrivalUTCOffset:Ha,Name:Ua.strings},Ia.push(Ja)}ea=this.routeParams.barriers&&this.routeParams.barriers.features||[];var fb=[];for(aa=0;aa<ea.length;aa++)ia=ea[aa].toJson(),ua=ia.attributes,ia.attributes={BarrierType:ua.BarrierType||0,FullEdge:ua.FullEdge||
!1,AddedCost:ua["Attr_"+this._getImpedanceAttribute().name]||0,Costs:ma.stringify(Fa(ua,"Attr_",Va)),CurbApproach:ua.CurbApproach||0,Name:ua.Name},fb.push(ia);ea=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var gb=[];for(aa=0;aa<ea.length;aa++)ia=ea[aa].toJson(),ua=ia.attributes,ia.attributes={BarrierType:ua.BarrierType||0,ScaleFactor:ua["Attr_"+this._getImpedanceAttribute().name]||1,Costs:ma.stringify(Fa(ua,"Attr_",Va)),Name:ua.Name},gb.push(ia);ea=this.routeParams.polygonBarriers&&
this.routeParams.polygonBarriers.features||[];var hb=[];for(aa=0;aa<ea.length;aa++)ia=ea[aa].toJson(),ua=ia.attributes,ia.attributes={BarrierType:ua.BarrierType||0,ScaleFactor:ua["Attr_"+this._getImpedanceAttribute().name]||1,Costs:ma.stringify(Fa(ua,"Attr_",Va)),Name:ua.Name},hb.push(ia);var ib={geometry:A.mergedGeometry,attributes:{RouteName:A.routeName,TotalMinutes:za(A.totalTime,ja),TotalMeters:ya(A.totalLength,sa),TotalLateMinutes:function(){for(var Ga=0,La=0;La<Ea.length;La++)Ga+=Ea[La].attributes.LateMinutes||
0;return Ga}(),TotalWaitMinutes:function(){for(var Ga=0,La=0;La<Ea.length;La++)Ga+=Ea[La].attributes.WaitMinutes||0;return Ga}(),TotalCosts:Ea[Ea.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?Ea[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?Ea[Ea.length-1].attributes.DepartureTime:null,StartUTCOffset:Ea[0].attributes.ArrivalUTCOffset,EndUTCOffset:Ea[Ea.length-1].attributes.DepartureUTCOffset,Messages:ma.stringify(this._solverMessages),AnalysisSettings:ma.stringify({travelMode:u.hitch(this,
function(){var Ga=u.clone(this.routeParams.travelMode);"\x26lt;"===Ga.name.substr(0,4)&&"\x26gt;"===Ga.name.substr(Ga.name.length-4,4)&&(Ga.name=Ga.name.substr(4,Ga.name.length-8));return Ga})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,
accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);u.hitch(this,function(){var Ga=new P;this._printService?this.zoomToFullRoute().then(u.hitch(this,function(){var La=this._printParams.template,Ra=La.exportOptions;La.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Sa){La.exportOptions=Ra;Ga.resolve(Sa.url)},
function(Sa){La.exportOptions=Ra;console.error("Error while calling print service:\n "+Sa);Ga.resolve()})})):Ga.resolve();return Ga.promise})().then(u.hitch(this,function(Ga){var La={folder:k,name:c,stops:Ea,directionPoints:Ia,directionLines:Oa,barriers:fb,polylineBarriers:gb,polygonBarriers:hb,extent:u.mixin(u.clone(A.extent),{xmin:Ma.xmin>A.extent.xmin?A.extent.xmin:Ma.xmin,ymin:Ma.ymin>A.extent.ymin?A.extent.ymin:Ma.ymin,xmax:Ma.xmax<A.extent.xmax?A.extent.xmax:Ma.xmax,ymax:Ma.ymax<A.extent.ymax?
A.extent.ymax:Ma.ymax}),routeInfo:ib,thumbnail:Ga};this._userCanCreatePortalItem?this._naRouteSharing.store(La,this.routeLayer.itemId,"1.0.0").then(u.hitch(this,function(Ra){if(Ra.success){var Sa=this._naRouteSharing.portal;Sa="//"+(Sa.isPortal?Sa.portalHostname:Sa.urlKey+"."+Sa.customBaseUrl);this._toggleSaveMenu();this._showMessage(B.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Sa+"/home/item.html?id\x3d"+Ra.id+"'\x3e"+B.widgets.directions.share+
"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ra.id);else this.onRouteItemCreated(Ra.id);u.mixin(this.routeLayer,{itemId:Ra.id,title:La.name,isItemOwner:!0,ownerFolder:v});K.resolve(Ra)}else K.reject(Ra)}),K.reject):this._naRouteSharing.createFeatureCollection(La,"1.0.0").then(u.hitch(this,function(Ra){K.resolve(Ra);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ra)}),K.reject)}))}else K.reject(Error("Cannot deduce the impedance used."))}else K.reject(Error("Missing required parameter: layerName, folder must be specified."));
else K.reject(Error("Shared route must be built using a Travel Mode."));else K.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else K.reject(Error("No route to share. Build a route first."));return K.promise},_loadRoute:function(c){var k=new P;k.promise.always(u.hitch(this,function(){this._showLoadingSpinner(!1);S.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":
"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));this._reset().then(u.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(u.hitch(this,function(){var v=u.clone(this.serviceDescription),K=u.hitch(this,function(ja){u.mixin(this.routeLayer,{itemId:c,title:ja.title,isItemOwner:ja.isItemOwner,ownerFolder:ja.ownerFolder})}),A,aa,ea,ia;v.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(c,v).then(u.hitch(this,function(ja){if(ja.routeParameters){u.mixin(this.routeParams,
ja.routeParameters);this.routeParams.accumulateAttributes=ja.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ua=ja.routeParameters.travelMode,sa=ua?this._getCostAttribute(ua.impedanceAttributeName):void 0;sa=sa?this._isTimeUnits(sa.units)?"Time":"Distance":"";ia=v.supportedTravelModes&&v.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():
[];if(canUseRouteLayerTM=1!==ja.successCode&&sa){var ya="AUTOMOBILE"===ua.type?"Driving":"TRUCK"===ua.type?"Trucking":"WALK"===ua.type?"Walking":"Other";ua.name="\x26lt;"+ua.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(v.supportedTravelModes||[]).concat(ua);ia.push({id:ua.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ya+sa+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ua.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new h({objectStore:new n({data:ia})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ua.name)}else{sa=!1;if(ua&&ua.name)for(ia=v.supportedTravelModes||[],A=0;A<ia.length;A++)if(ia[A].name===ua.name){sa=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ua.name);this.routeParams.travelMode=ia[A].impedanceAttributeName?ia[A]:ia[A].itemId;ja.loadMessages.push({message:B.widgets.directions.error.tmFromPortalSameName+" "+ua.name,messageType:"Warning"});break}if(!sa)if((ua=v.defaultTravelMode)&&
ia)for(A=0;A<ia.length;A++){if(ia[A].id===ua){this.routeParams.travelMode=ia[A].impedanceAttributeName?ia[A]:ia[A].itemId;ja.loadMessages.push({message:B.widgets.directions.error.tmFromPortalDefault+" "+(ia[A].name?ia[A].name:ia[A].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ja.solveResult&&ja.solveResult.routeResults){var za=Infinity,Fa=-Infinity;ua=ja.solveResult.routeResults[0].stops;var Ea=ja.solveResult.routeResults[0].directions.features;
sa={};for(A=0;A<ua.length;A++){var Ia=ua[A].attributes;if(Ia.isWaypoint)for(aa=0;aa<Ea.length;aa++)ya=Ea[aa].attributes,ya._stopSequence===Ia.Sequence&&(ya.text=ya.text.replace(Ia.Name,this._waypointName));ea=Ia.Name+"_"+this._stopSequence++;sa[ea]=Ia.isWaypoint?this._waypointName:Ia.Name;Ia.Name=ea;if(Ia.Sequence<za&&(null!==Ia.ArriveCurbApproach||null!==Ia.DepartCurbApproach)){var Oa=Ia.Name;za=Ia.Sequence}if(Ia.Sequence>Fa&&(null!==Ia.ArriveCurbApproach||null!==Ia.DepartCurbApproach)){var Va=Ia.Name;
Fa=Ia.Sequence}}ea=Oa+" - "+Va;ja.solveResult.routeResults[0].routeName=ea;ja.solveResult.routeResults[0].directions.routeName=ea;for(A=0;A<Ea.length;A++)if(ya=Ea[A].attributes,void 0!==ya._stopSequence)for(aa=0;aa<ua.length;aa++)if(ya._stopSequence===ua[aa].attributes.Sequence){ea=ua[aa].attributes.Name;ya.text=(ya.text||"").replace(sa[ea],ea);delete ya._stopSequence;break}Oa=ua[ua.length-1];ua[0].geometry.x===Oa.geometry.x&&ua[0].geometry.y===Oa.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new da(Oa.geometry,
null,Oa.attributes),sa[Oa.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ja.solveResult,sa).then(u.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);K(ja);this.zoomToFullRoute();k.resolve(ja)}),k.reject)}else{if(ja.routeParameters){Oa=ja.routeParameters.stops.features;this.stops=[];for(A=0;A<Oa.length;A++)this.stops.push(this._addStopWrapperToGraphic(Oa[A],Oa[A].attributes.Name)),this._updateStop(this.stops[A],A);this._setStops();ja.loadMessages.push({message:B.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else ja.loadMessages.push({message:B.widgets.directions.routeLayerEmpty,messageType:"Warning"});K(ja);k.resolve(ja)}for(A=0;A<ja.loadMessages.length;A++)this._showMessage(ja.loadMessages[A].message)}),u.hitch(this,function(ja){k.reject(ja);this._showMessage("GWM_0003"===ja.messageCode?B.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:B.widgets.directions.error.loadError)}))}),k.reject)}),k.reject);return k.promise}});F("extend-esri")&&
u.setObject("dijit.Directions",W,z);return W})},"dojo/data/ObjectStore":function(){define("../_base/lang ../Evented ../_base/declare ../_base/Deferred ../promise/all ../_base/array ../_base/connect ../regexp".split(" "),function(V,W,u,O,X,N,y,r){function d(e){return"*"==e?".*":"?"==e?".":e}return u("dojo.data.ObjectStore",[W],{objectStore:null,constructor:function(e){this._dirtyObjects=[];e.labelAttribute&&(e.labelProperty=e.labelAttribute);V.mixin(this,e)},labelProperty:"label",getValue:function(e,
l,m){return"function"===typeof e.get?e.get(l):l in e?e[l]:m},getValues:function(e,l){e=this.getValue(e,l);return e instanceof Array?e:void 0===e?[]:[e]},getAttributes:function(e){var l=[],m;for(m in e)!e.hasOwnProperty(m)||"_"==m.charAt(0)&&"_"==m.charAt(1)||l.push(m);return l},hasAttribute:function(e,l){return l in e},containsValue:function(e,l,m){return-1<N.indexOf(this.getValues(e,l),m)},isItem:function(e){return"object"==typeof e&&e&&!(e instanceof Date)},isItemLoaded:function(e){return e&&"function"!==
typeof e.load},loadItem:function(e){var l;"function"===typeof e.item.load?O.when(e.item.load(),function(m){l=m;var n=m instanceof Error?e.onError:e.onItem;n&&n.call(e.scope,m)}):e.onItem&&e.onItem.call(e.scope,e.item);return l},close:function(e){return e&&e.abort&&e.abort()},fetch:function(e){function l(w){e.onError&&e.onError.call(n,w,e)}e=V.delegate(e,e&&e.queryOptions);var m=this,n=e.scope||m,h=e.query;if("object"==typeof h){h=V.delegate(h);for(var x in h){var F=h[x];"string"==typeof F&&(h[x]=
RegExp("^"+r.escapeString(F,"*?\\").replace(/\\.|\*|\?/g,d)+"$",e.ignoreCase?"mi":"m"),h[x].toString=function(w){return function(){return w}}(F))}}var H=this.objectStore.query(h,e);O.when(H.total,function(w){O.when(H,function(G){e.onBegin&&e.onBegin.call(n,w||G.length,e);if(e.onItem)for(var Q=0;Q<G.length;Q++)e.onItem.call(n,G[Q],e);e.onComplete&&e.onComplete.call(n,e.onItem?null:G,e);return G},l)},l);e.abort=function(){H.cancel&&H.cancel()};H.observe&&(this.observing&&this.observing.cancel(),this.observing=
H.observe(function(w,G,Q){if(-1==N.indexOf(m._dirtyObjects,w))if(-1==G)m.onNew(w);else if(-1==Q)m.onDelete(w);else for(var S in w)if(S!=m.objectStore.idProperty)m.onSet(w,S,null,w[S])},!0));this.onFetch(H);e.store=this;return e},getFeatures:function(){return{"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":!0,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":!0}},getLabel:function(e){if(this.isItem(e))return this.getValue(e,this.labelProperty)},getLabelAttributes:function(e){return[this.labelProperty]},
getIdentity:function(e){return this.objectStore.getIdentity?this.objectStore.getIdentity(e):e[this.objectStore.idProperty||"id"]},getIdentityAttributes:function(e){return[this.objectStore.idProperty]},fetchItemByIdentity:function(e){var l;O.when(this.objectStore.get(e.identity),function(m){l=m;e.onItem.call(e.scope,m)},function(m){e.onError.call(e.scope,m)});return l},newItem:function(e,l){if(l){var m=this.getValue(l.parent,l.attribute,[]);m=m.concat([e]);e.__parent=m;this.setValue(l.parent,l.attribute,
m)}this._dirtyObjects.push({object:e,save:!0});this.onNew(e);return e},deleteItem:function(e){this.changing(e,!0);this.onDelete(e)},setValue:function(e,l,m){var n=e[l];this.changing(e);e[l]=m;this.onSet(e,l,n,m)},setValues:function(e,l,m){if(!V.isArray(m))throw Error("setValues expects to be passed an Array object as its value");this.setValue(e,l,m)},unsetAttribute:function(e,l){this.changing(e);var m=e[l];delete e[l];this.onSet(e,l,m,void 0)},changing:function(e,l){e.__isDirty=!0;for(var m=0;m<this._dirtyObjects.length;m++){var n=
this._dirtyObjects[m];if(e==n.object){l&&(n.object=!1,this._saveNotNeeded||(n.save=!0));return}}n=e instanceof Array?[]:{};for(m in e)e.hasOwnProperty(m)&&(n[m]=e[m]);this._dirtyObjects.push({object:!l&&e,old:n,save:!this._saveNotNeeded})},save:function(e){e=e||{};var l=[],m=[],n=this,h=this._dirtyObjects;try{y.connect(e,"onError",function(){if(!1!==e.revertOnError){var S=h;h=m;n.revert();n._dirtyObjects=S}else n._dirtyObjects=h.concat(m)});var x;this.objectStore.transaction&&(x=this.objectStore.transaction());
for(var F=0;F<h.length;F++){var H=h[F],w=H.object,G=H.old;delete w.__isDirty;if(w){var Q=this.objectStore.put(w,{overwrite:!!G});l.push(Q)}else"undefined"!=typeof G&&(Q=this.objectStore.remove(this.getIdentity(G)),l.push(Q));m.push(H);h.splice(F--,1)}X(l).then(function(S){e.onComplete&&e.onComplete.call(e.scope,S)},function(S){e.onError&&e.onError.call(e.scope,S)});x&&x.commit()}catch(S){e.onError.call(e.scope,value)}},revert:function(){for(var e=this._dirtyObjects,l=e.length;0<l;){l--;var m=e[l],
n=m.object;m=m.old;if(n&&m){for(var h in m)m.hasOwnProperty(h)&&n[h]!==m[h]&&(this.onSet(n,h,n[h],m[h]),n[h]=m[h]);for(h in n)m.hasOwnProperty(h)||(this.onSet(n,h,n[h]),delete n[h])}else if(m)this.onNew(m);else this.onDelete(n);delete (n||m).__isDirty;e.splice(l,1)}},isDirty:function(e){return e?e.__isDirty:!!this._dirtyObjects.length},onSet:function(){},onNew:function(){},onDelete:function(){},onFetch:function(e){}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m){V=V([d,m],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(n){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=W.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(n,h,x,F,H){try{var w=[],G=[],Q=n.directions||[],S=n.routes?n.routes.features:
[],M=n.stops?n.stops.features:[],R=n.barriers?n.barriers.features:[],C=n.polygonBarriers?n.polygonBarriers.features:[],a=n.polylineBarriers?n.polylineBarriers.features:[],B=n.messages,fa=u.forEach,ka=u.indexOf,la=!0,oa,P,na=n.routes&&n.routes.spatialReference||n.stops&&n.stops.spatialReference||n.barriers&&n.barriers.spatialReference||n.polygonBarriers&&n.polygonBarriers.spatialReference||n.polylineBarriers&&n.polylineBarriers.spatialReference;this._chk=n.checksum;fa(Q,function(z){w.push(oa=z.routeName);
G[oa]={directions:z}});fa(S,function(z){-1===ka(w,oa=z.attributes.Name)&&(w.push(oa),G[oa]={});G[oa].route=z});fa(M,function(z){P=z.attributes;-1===ka(w,oa=P.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(w.push(oa),G[oa]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==oa&&(la=!1);void 0===G[oa].stops&&(G[oa].stops=[]);G[oa].stops.push(z)});0<M.length&&!0===la&&(G[w[0]].stops=G["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete G["esri.tasks.RouteTask.NULL_ROUTE_NAME"],w.splice(u.indexOf(w,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),
1));var ma=[];fa(w,function(z,I){G[z].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===z?null:z;G[z].spatialReference=na;ma.push(new e(G[z]))});n=function(z){fa(z,function(I,da){I.geometry&&(I.geometry.spatialReference=na);z[da]=new N(I)});return z};fa(B,function(z,I){B[I]=new l(z)});var J={routeResults:ma,barriers:n(R),polygonBarriers:n(C),polylineBarriers:n(a),messages:B};this._successHandler([J],"onSolveComplete",x,H)}catch(z){this._errorHandler(z,F,H)}},solve:function(n,h,x,F){var H=F.assembly;
n=this._encode(W.mixin({},this._url.query,{f:"json"},n.toJson(H&&H[0]),this._chk?{checksum:this._chk}:{}));var w=this._handler,G=this._errorHandler;return y({url:this._url.path,timeout:25E4,content:n,callbackParamName:"callback",load:function(Q,S){w(Q,S,h,x,F.dfd)},error:function(Q){G(Q,x,F.dfd)}})},onSolveComplete:function(){}});r._createWrappers(V);O("extend-esri")&&W.setObject("tasks.RouteTask",V,X);return V})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(V,W,u,O,X,N,y){V=V(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(r){var d=r.spatialReference,e=r.route;if(r.directions){var l=[],m=[],n=[];u.forEach(r.directions.features,function(x,F){m[F]=x.compressedGeometry;l[F]=x.strings;n[F]=x.events});r.directions.strings=l;r.directions.events=n;this.directions=new y(r.directions,m)}this.routeName=r.routeName;e&&(e.geometry&&(e.geometry.spatialReference=d),this.route=new N(e));if(r.stops){var h=this.stops=[];u.forEach(r.stops,function(x,
F){x.geometry&&(x.geometry.spatialReference=d);h[x.attributes.Sequence-1]=new N(x)})}},routeName:null,directions:null,route:null,stops:null});O("extend-esri")&&W.setObject("tasks.RouteResult",V,X);return V})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(V,W,u,O,X,N,y,r,d,e,l){V=V(l,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(m,n){this.routeId=m.routeId;this.routeName=m.routeName;W.mixin(this,m.summary);this.extent=new y(this.envelope);var h=this._fromCompressedGeometry,x=this.features,F=this.extent.spatialReference,H=[];u.forEach(n,function(w,G){x[G].setGeometry(H[G]=w?h(w,F):x[G].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(H,F);this.geometryType="esriGeometryPolyline";u.forEach(m.events,function(w,G){u.forEach(w,function(Q,S){w[S]=new e(new d(Q.point.x,Q.point.y,F),null,{ETA:Q.ETA,
strings:X.stringify(Q.strings),arriveTimeUTC:Q.arriveTimeUTC})});m.events[G]=w});delete this.envelope},_fromCompressedGeometry:function(m,n){var h=0,x=0,F=0,H=0,w=[],G=0,Q=0,S=0;(m=m.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(m=[]);if(0===parseInt(m[G],32)){G=2;var M=parseInt(m[G],32);G++;var R=parseInt(m[G],32);G++;if(M&1){Q=u.indexOf(m,"|")+1;var C=parseInt(m[Q],32);Q++}if(M&2){S=u.indexOf(m,"|",Q)+1;var a=parseInt(m[S],32);S++}}else R=parseInt(m[G],32),G++;for(;G<m.length&&"|"!==m[G];){M=parseInt(m[G],
32)+h;G++;h=M;var B=parseInt(m[G],32)+x;G++;x=B;M=[M/R,B/R];Q&&(B=parseInt(m[Q],32)+F,Q++,F=B,M.push(B/C));S&&(B=parseInt(m[S],32)+H,S++,H=B,M.push(B/a));w.push(M)}h=new r({paths:[w],hasZ:0<Q,hasM:0<S});h.setSpatialReference(n);return h},_mergePolylinesToSinglePath:function(m,n){var h=[],x=!1;u.forEach(m,function(w){u.forEach(w.paths,function(G){x=x||w.hasM;h=h.concat(G)})});var F=[],H=[0,0];u.forEach(h,function(w){if(w[0]!==H[0]||w[1]!==H[1])F.push(w),H=w});return new r({paths:[F],spatialReference:n,
hasM:x})}});O("extend-esri")&&W.setObject("tasks.DirectionsFeatureSet",V,N);return V})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(X){W.mixin(this,X)}});W.mixin(V,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});u("extend-esri")&&W.setObject("tasks.NAMessage",
V,O);return V})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(V,W,u,O,X){return V(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(N,y){var r=new u;if(this._sd)r.resolve(this._sd);else if(this._url&&this._url.orig){var d=this._url.orig,e=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":
"ServiceAreas",l,m=function(n){X({url:n+("/"===n[n.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:e},callbackParamName:"callback"}).then(function(h){var x=[],F=null;if(h&&h.results&&h.results.length)for(var H=0;H<h.results.length;H++)if("supportedTravelModes"===h.results[H].paramName){if(h.results[H].value&&h.results[H].value.features)for(var w=0;w<h.results[H].value.features.length;w++)if(h.results[H].value.features[w].attributes){var G=W.parse(h.results[H].value.features[w].attributes.TravelMode);
x.push(G)}}else"defaultTravelMode"===h.results[H].paramName&&(F=h.results[H].value);l.supportedTravelModes=x;l.defaultTravelMode=F;r.resolve(l)},function(h){console.log("Could not read from the routingUtilities service.");r.reject(h)})};X({url:d,content:{f:"json"},callbackParamName:"callback"}).then(function(n){l=n;l.supportedTravelModes||(l.supportedTravelModes=[]);for(n=0;n<l.supportedTravelModes.length;n++)l.supportedTravelModes[n].id||(l.supportedTravelModes[n].id=l.supportedTravelModes[n].itemId);
y?r.resolve(l):N?m(N):10.4<=l.currentVersion?X({url:d+("/"===d[d.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(h){l.supportedTravelModes=h.supportedTravelModes;l.defaultTravelMode=h.defaultTravelMode;r.resolve(l)},function(h){console.log("Could not get to the NAServer's retrieveTravelModes.");r.reject(h)}):X({url:d.substring(0,d.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(h){h.owningSystemUrl?
(d=h.owningSystemUrl,X({url:d+("/"===d[d.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(x){x&&x.helperServices&&x.helperServices.routingUtilities&&x.helperServices.routingUtilities.url?m(x.helperServices.routingUtilities.url):(console.log("Portal does not have helperServices.routingUtilities defined."),r.resolve(l))},function(x){console.log("Could not get to the portal's self.");r.reject(x)})):r.resolve(l)},function(h){console.log("Could not get to the NAServer service description.");
r.reject(h)})},function(n){r.reject(n)})}else r.reject("NA Task has no URL specified.");r.then(O.hitch(this,function(n){this._sd=n}),O.hitch(this,function(){this._sd=null}));return r.promise},getOwningSystemUrl:function(){var N=new u;if(this._url&&this._url.orig){var y=this._url.orig;X({url:y.substring(0,y.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(r){N.resolve(r.owningSystemUrl)})}else N.resolve(void 0);return N.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),
function(V,W,u,O,X,N,y,r){V=V(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,
overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(d){var e={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,
returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&u.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||u.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,
preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,
useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:r.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,travelMode:"object"===typeof this.travelMode?u.toJson(this.travelMode):this.travelMode},l=this.stops;"esri.tasks.FeatureSet"===l.declaredClass&&0<
l.features.length?e.stops=u.toJson({type:"features",features:y._encodeGraphics(l.features,d&&d["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===l.declaredClass?e.stops=l:"esri.tasks.DataFile"===l.declaredClass&&(e.stops=u.toJson({type:"features",url:l.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":e.directionsOutputType=
"esriDOTComplete";break;case "complete-no-events":e.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":e.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":e.directionsOutputType="esriDOTStandard";break;case "summary-only":e.directionsOutputType="esriDOTSummaryOnly";break;default:e.directionsOutputType=this.directionsOutputType}l=function(m,n){return m?"esri.tasks.FeatureSet"===m.declaredClass?0<m.features.length?u.toJson({type:"features",features:y._encodeGraphics(m.features,
d&&d[n])}):null:"esri.tasks.DataLayer"===m.declaredClass?m:"esri.tasks.DataFile"===m.declaredClass?u.toJson({type:"features",url:m.url}):u.toJson(m):null};this.barriers&&(e.barriers=l(this.barriers,"barriers.features"));this.polygonBarriers&&(e.polygonBarriers=l(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(e.polylineBarriers=l(this.polylineBarriers,"polylineBarriers.features"));return N.filter(e,function(m){if(null!==m)return!0})}});O("extend-esri")&&W.setObject("tasks.RouteParameters",
V,X);return V})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(V,W,u){var O={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},X={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},N={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",
AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},y={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},r={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},d={LengthUnit:O,OutputLine:X,UTurn:N,OutputPolygon:y,TravelDirection:r};W("extend-esri")&&(V.setObject("tasks._NALengthUnit",O,u),V.setObject("tasks.NAOutputLine",
X,u),V.setObject("tasks.NAUTurn",N,u),V.setObject("tasks.NAOutputPolygon",y,u),V.setObject("tasks.NATravelDirection",r,u));return d})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(V,W,u,O,X,N){V=V(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var y={},r=this.geometry1;r&&(y.geometry1=u.toJson({geometryType:N.getJsonType(r),
geometry:r}));if(r=this.geometry2)y.geometry2=u.toJson({geometryType:N.getJsonType(r),geometry:r});y.sr=u.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(y.distanceUnit=this.distanceUnit);this.geodesic&&(y.geodesic=this.geodesic);return y}});O("extend-esri")&&W.setObject("tasks.DistanceParameters",V,X);return V})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R,C){V=V(G,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,B){this.url=a;this.printGp=new H(this.url);this._handler=W.hitch(this,this._handler);B&&B.async&&(this.async=!0);this._colorEvaluator=C("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(a,B,fa){if(!this._loadGpServerMetadata)return this._execute(a,B,fa);var ka=new X(e._dfdCanceller),la=this._url.path,oa=la.lastIndexOf("/GPServer/");
0<oa&&(la=la.slice(0,oa+9));ka._pendingDfd=m({url:la,callbackParamName:"callback",content:W.mixin({},this._url.query,{f:"json"})}).then(W.hitch(this,function(P){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===P.executionType;this._cimVersion=P.cimVersion;this._is11xService=!!this._cimVersion;ka._pendingDfd=this._execute(a);return ka._pendingDfd})).then(W.hitch(this,function(P){this._successHandler([P],null,B,ka)})).otherwise(function(P){fa&&fa(P);ka.errback(P)});return ka},
_handler:function(a,B,fa,ka,la){try{if(this.async)"esriJobSucceeded"===a.jobStatus?this.printGp.getResultData(a.jobId,"Output_File",W.hitch(this,function(P){oa=P.value;this._successHandler([oa],"onComplete",fa,la)})):this._errorHandler(Error(a.jobStatus),ka,la);else{var oa=a[0].value;this._successHandler([oa],"onComplete",fa,la)}}catch(P){this._errorHandler(P,ka,la)}},_execute:function(a,B,fa){var ka=this._handler,la=this._errorHandler,oa=a.template||new w;oa.hasOwnProperty("showLabels")||(oa.showLabels=
!0);var P=oa.exportOptions,na;P&&(na={outputSize:[P.width,P.height],dpi:P.dpi});P=oa.layoutOptions;var ma=[];if(P){this.legendAll=!1;P.legendLayers?u.forEach(P.legendLayers,function(D){var t={};t.id=D.layerId;D.subLayerIds&&(t.subLayerIds=D.subLayerIds);ma.push(t)}):this.legendAll=!0;if("Miles"===P.scalebarUnit||"Kilometers"===P.scalebarUnit){var J="esriKilometers";var z="esriMiles"}else if("Meters"===P.scalebarUnit||"Feet"===P.scalebarUnit)J="esriMeters",z="esriFeet";var I={esriMiles:"mi",esriKilometers:"km",
esriFeet:"ft",esriMeters:"m"};I={titleText:P.titleText,authorText:P.authorText,copyrightText:P.copyrightText,customTextElements:P.customTextElements,scaleBarOptions:{metricUnit:J,metricLabel:I[J],nonMetricUnit:z,nonMetricLabel:I[z]},legendOptions:{operationalLayers:ma}}}J=this._getPrintDefinition(a.map,oa);a.outSpatialReference&&(J.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&r.isDefined(a.template.showAttribution)&&(J.mapOptions.showAttribution=a.template.showAttribution);
W.mixin(J,{exportOptions:na,layoutOptions:I});this.allLayerslegend&&W.mixin(J.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(J.operationalLayers){na=J.operationalLayers;var da=function(D){return r.fixJson(W.mixin(D,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},ra=RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),qa=/[\u0600-\u06FF]/,wa=function(D){var t=D.text,Z=(D=D.font)&&D.family&&D.family.toLowerCase();
t&&D&&("arial"===Z||"arial unicode ms"===Z)&&(D.family=ra.test(t)?"Arial Unicode MS":"Arial","normal"!==D.style&&qa.test(t)&&(D.family="Arial Unicode MS"))};for(I=0;I<na.length;I++)if(na[I].featureCollection&&na[I].featureCollection.layers)for(z=0;z<na[I].featureCollection.layers.length;z++){var Ca=na[I].featureCollection.layers[z];if(Ca.layerDefinition&&Ca.layerDefinition.drawingInfo&&Ca.layerDefinition.drawingInfo.renderer&&Ca.layerDefinition.drawingInfo.renderer.symbol){var b=Ca.layerDefinition.drawingInfo.renderer;
"esriCLS"===b.symbol.type?b.symbol=da(b.symbol):"esriTS"===b.symbol.type?wa(b.symbol):b.symbol.outline&&"esriCLS"===b.symbol.outline.type&&(b.symbol.outline=da(b.symbol.outline))}if(Ca.featureSet&&Ca.featureSet.features)for(P=0;P<Ca.featureSet.features.length;P++)b=Ca.featureSet.features[P],b.symbol&&("esriCLS"===b.symbol.type?b.symbol=da(b.symbol):"esriTS"===b.symbol.type?wa(b.symbol):b.symbol.outline&&"esriCLS"===b.symbol.outline.type&&(b.symbol.outline=da(b.symbol.outline)))}}oa={Web_Map_as_JSON:O.toJson(r.fixJson(J)),
Format:oa.format,Layout_Template:oa.layout};a.extraParameters&&(oa=W.mixin(oa,a.extraParameters));var f=new X(e._dfdCanceller);a=function(D,t){ka(D,t,B,fa,f)};J=function(D){la(D,fa,f)};f._pendingDfd=this.async?this.printGp.submitJob(oa,a,null,J):this.printGp.execute(oa,a,J);return f},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",
features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=N("ie")||!a.path&&"image/svg+xml"!==a.contentType)){var B=R.createSurface(S.create("div"),1024,1024);var fa="image/svg+xml"===a.contentType?B.createObject(R.Image,{src:"data:image/svg+xml;base64,"+a.imageData,width:M.pt2px(a.width),height:M.pt2px(a.height),x:0,y:0}):B.createObject(R.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in B&&B._render(!0);var ka=
B.rawNode.getContext("2d"),la=Math.ceil(fa.getBoundingBox().width),oa=Math.ceil(fa.getBoundingBox().height);fa=ka.getImageData(fa.getBoundingBox().x,fa.getBoundingBox().y,la,oa);ka.canvas.width=la;ka.canvas.height=oa;ka.putImageData(fa,0,0);ka=ka.canvas.toDataURL("image/png");a={type:"esriPMS",imageData:ka.substr(22,ka.length),angle:a.angle,contentType:"image/png",height:a.size?a.size:M.px2pt(oa),width:a.size?la/oa*a.size:M.px2pt(la),xoffset:a.xoffset,yoffset:a.yoffset};B.destroy();return a}},_convertSvgRenderer:function(a){"simple"===
a.type&&a.symbol&&(a.symbol.path||"image/svg+xml"===a.symbol.contentType)?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===a.type?(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.uniqueValueInfos&&u.forEach(a.uniqueValueInfos,function(B){if(B.symbol.path||"image/svg+xml"===B.symbol.contentType)B.symbol=this._convertSvgSymbol(B.symbol)},this)):"classBreaks"===a.type&&(a.defaultSymbol&&(a.defaultSymbol.path||
"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&u.forEach(a.classBreakInfos,function(B){if(B.symbol.path||"image/svg+xml"===B.symbol.contentType)B.symbol=this._convertSvgSymbol(B.symbol)},this))},_createFeatureCollection:function(a,B,fa,ka){var la=this._createPolygonLayer(),oa=this._createPolylineLayer(),P=this._createPointLayer(),na=this._createMultipointLayer(),ma=this._createPointLayer();ma.layerDefinition.name="textLayer";
delete ma.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass)la.layerDefinition.name=oa.layerDefinition.name=P.layerDefinition.name=na.layerDefinition.name=W.getObject("arcgisProps.title",!1,a)||a.name||a.id;var J=a.renderer&&"esri.renderer.SimpleRenderer"===a.renderer.declaredClass;if(!a.renderer||a.renderer.valueExpression||W.isFunction(a.renderer.attributeField))delete la.layerDefinition.drawingInfo,delete oa.layerDefinition.drawingInfo,
delete P.layerDefinition.drawingInfo,delete na.layerDefinition.drawingInfo;else{var z=a.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===z.type){z={latestObservationRenderer:z.latestObservationRenderer,trackLinesRenderer:z.trackRenderer,observationAger:z.observationAger,renderer:z.observationRenderer};var I={};a._trackIdField&&(I.trackIdField=a._trackIdField);a._startTimeField&&(I.startTimeField=a._startTimeField);a._endTimeField&&(I.endTimeField=a._endTimeField);la.layerDefinition.drawingInfo=
z;la.layerDefinition.timeInfo=I;oa.layerDefinition.drawingInfo=z;oa.layerDefinition.timeInfo=I;P.layerDefinition.drawingInfo=z;P.layerDefinition.timeInfo=I;na.layerDefinition.drawingInfo=z;na.layerDefinition.timeInfo=I}else la.layerDefinition.drawingInfo.renderer=z,oa.layerDefinition.drawingInfo.renderer=z,P.layerDefinition.drawingInfo.renderer=z,na.layerDefinition.drawingInfo.renderer=z}z=a.fields;z||!a.renderer||a.renderer.valueExpression||W.isFunction(a.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===
a.renderer.declaredClass?(z=[{name:a.renderer.attributeField,type:"esriFieldTypeDouble"}],a.renderer.normalizationField&&z.push({name:a.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&(z=[{name:a.renderer.attributeField,type:"esriFieldTypeString"}],a.renderer.attributeField2&&z.push({name:a.renderer.attributeField2,type:"esriFieldTypeString"}),a.renderer.attributeField3&&z.push({name:a.renderer.attributeField3,type:"esriFieldTypeString"})));
z&&(la.layerDefinition.fields=z,oa.layerDefinition.fields=z,P.layerDefinition.fields=z,na.layerDefinition.fields=z);z=a.graphics;a.isFeatureReductionActive&&a.isFeatureReductionActive()&&(z=a.getSingleGraphics());I=z.length;var da;for(da=0;da<I;da++){var ra=z[da];if(!1!==ra.visible&&ra.geometry){var qa=ra.toJson();qa.symbol&&qa.symbol.outline&&qa.symbol.outline.color&&qa.symbol.outline.color[3]&&!this._is11xService&&(qa.symbol.outline.color[3]=255);if(a.renderer&&!qa.symbol&&(W.isFunction(a.renderer.attributeField)||
a.renderer.valueExpression||this._isFeatureCollectionRequired(a.renderer,a)||"esri.renderer.DotDensityRenderer"===a.renderer.declaredClass||fa)){fa=fa||a.renderer;var wa=null;try{wa=fa.getSymbol(ra)}catch(Ca){}if(!wa)continue;qa.symbol=wa.toJson();this._isFeatureCollectionRequired(fa,a)&&this._applyVisualVariables(qa.symbol,{renderer:fa,graphic:ra,symbol:wa,mapResolution:B&&B.getResolutionInMeters(),mapScale:B&&B.getScale()})}qa.symbol&&(qa.symbol.path||"image/svg+xml"===qa.symbol.contentType?qa.symbol=
this._convertSvgSymbol(qa.symbol):qa.symbol.text&&delete qa.attributes);switch(ra.geometry.type){case "polygon":la.featureSet.features.push(qa);break;case "polyline":oa.featureSet.features.push(qa);break;case "point":qa.symbol&&qa.symbol.text?ma.featureSet.features.push(qa):P.featureSet.features.push(qa);break;case "multipoint":na.featureSet.features.push(qa);break;case "extent":qa.geometry=h.fromExtent(ra.geometry).toJson(),la.featureSet.features.push(qa)}}}B=[];0<la.featureSet.features.length&&
B.push(la);0<oa.featureSet.features.length&&B.push(oa);0<na.featureSet.features.length&&B.push(na);0<P.featureSet.features.length&&B.push(P);0<ma.featureSet.features.length&&B.push(ma);if(!B.length)return null;u.forEach(B,function(Ca){var b=u.every(Ca.featureSet.features,function(f){return f.symbol});if(J||b)ka&&ka.forceFeatureAttributes||u.forEach(Ca.featureSet.features,function(f){delete f.attributes}),ka.forceFeatureAttributes||delete Ca.layerDefinition.fields;b&&delete Ca.layerDefinition.drawingInfo});
u.forEach(B,function(Ca){Ca.layerDefinition.drawingInfo&&Ca.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(Ca.layerDefinition.drawingInfo.renderer)},this);return{id:a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,featureCollection:{layers:B}}},_getPrintDefinition:function(a,B){var fa={operationalLayers:this._createOperationalLayers(a,B)},ka=this._vtlExtent||a.extent,la=a.spatialReference;this._vtlExtent=null;a.spatialReference._isWrappable()&&(ka=ka._normalize(!0),
la=ka.spatialReference);ka={mapOptions:{showAttribution:a.showAttribution,extent:ka.toJson(),spatialReference:la.toJson()}};B.preserveScale&&W.mixin(ka.mapOptions,{scale:B.outScale||a.getScale()});a.timeExtent&&W.mixin(ka.mapOptions,{time:[a.timeExtent.startTime.getTime(),a.timeExtent.endTime.getTime()]});a={};W.mixin(a,ka,fa);return a},_createOperationalLayers:function(a,B){var fa,ka=[],la=0;B.preserveScale&&(la=B.outScale||a.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=
null;var oa=u.map(a.layerIds,a.getLayer,a);a._mapImageLyr&&oa.push(a._mapImageLyr);for(fa=0;fa<oa.length;fa++){var P=oa[fa];if(P.loaded&&P.visible&&(!la||P.isVisibleAtScale(la))){var na=P.declaredClass;var ma={id:P.id,title:W.getObject("arcgisProps.title",!1,P)||P.id,opacity:P.opacity,minScale:P.minScale||0,maxScale:P.maxScale||0};ma=W.mixin(ma,this._getUrlAndToken(P));P.getNode()&&Q.get(P.getNode(),"data-reference")&&(ma._isRefLayer=!0);switch(na){case "esri.layers.ArcGISDynamicMapServiceLayer":var J=
[];na=!!P._params.layers;if(P._params.dynamicLayers)na=B.outScale?P._getDynLayerObjs(B.outScale):O.fromJson(P._params.dynamicLayers),u.forEach(na,function(qa){J.push({id:qa.id,name:qa.name,layerDefinition:qa});delete qa.id;delete qa.name;delete qa.maxScale;delete qa.minScale}),0===J.length&&(ma.visibleLayers=[-1]);else if(P.supportsDynamicLayers){if(na||P.layerDefinitions||P.layerTimeOptions){var z=P.createDynamicLayerInfosFromLayerInfos(),I=null;na&&(I=P.visibleLayers);I=d._getVisibleLayers(z,I);
var da=d._getLayersForScale(B.outScale||a.getScale(),z);u.forEach(z,function(qa){if(!qa.subLayerIds){var wa=qa.id;-1<u.indexOf(I,wa)&&-1<u.indexOf(da,wa)&&(qa={source:qa.source.toJson()},P.layerDefinitions&&P.layerDefinitions[wa]&&(qa.definitionExpression=P.layerDefinitions[wa]),P.layerTimeOptions&&P.layerTimeOptions[wa]&&(qa.layerTimeOptions=P.layerTimeOptions[wa].toJson()),J.push({id:wa,layerDefinition:qa}))}});0===J.length&&(ma.visibleLayers=[-1])}}else u.forEach(P.layerInfos,function(qa){var wa=
{id:qa.id,layerDefinition:{}};P.layerDefinitions&&P.layerDefinitions[qa.id]&&(wa.layerDefinition.definitionExpression=P.layerDefinitions[qa.id]);P.layerTimeOptions&&P.layerTimeOptions[qa.id]&&(wa.layerDefinition.layerTimeOptions=P.layerTimeOptions[qa.id].toJson());(wa.layerDefinition.definitionExpression||wa.layerDefinition.layerTimeOptions)&&J.push(wa)}),na&&(ma.visibleLayers=P.visibleLayers.length?P.visibleLayers:[-1]);J.length&&(ma.layers=J);ka.push(ma);this.allLayerslegend&&this.allLayerslegend.push({id:P.id,
subLayerIds:P.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":ma=W.mixin(ma,{url:P.url,bandIds:P.bandIds,compressionQuality:P.compressionQuality,format:P.format,interpolation:P.interpolation});P.mosaicRule&&W.mixin(ma,{mosaicRule:P.mosaicRule.toJson()});if(P.renderingRule||P.renderer)this._is11xService?(P.renderingRule&&(ma.renderingRule=P.renderingRule.toJson()),P.renderer&&(ma.layerDefinition=ma.layerDefinition||{},ma.layerDefinition.drawingInfo=ma.layerDefinition.drawingInfo||
{},ma.layerDefinition.drawingInfo.renderer=P.renderer.toJson())):(na=P.getExportImageRenderingRule())&&W.mixin(ma,{renderingRule:na.toJson()});ka.push(ma);this.allLayerslegend&&this.allLayerslegend.push({id:P.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(ma=W.mixin(ma,{url:P.url,bandIds:P.bandIds,interpolation:P.interpolation}),P.renderer&&(ma.layerDefinition=ma.layerDefinition||{},ma.layerDefinition.drawingInfo=ma.layerDefinition.drawingInfo||{},ma.layerDefinition.drawingInfo.renderer=
P.renderer.toJson()),ka.push(ma),this.allLayerslegend&&this.allLayerslegend.push({id:P.id}));break;case "esri.layers.WMSLayer":ma=W.mixin(ma,{url:P.url,title:P.title,type:"wms",version:P.version,transparentBackground:P.imageTransparency,visibleLayers:P.visibleLayers});ka.push(ma);this.allLayerslegend&&this.allLayerslegend.push({id:P.id,subLayerIds:P.visibleLayers});break;case "esri.virtualearth.VETiledLayer":na=P.mapStyle;"roadOnDemand"===na?na="Road":"aerialWithLabelsOnDemand"===na&&(na="Hybrid");
ma=W.mixin(ma,{visibility:P.visible,type:"BingMaps"+na,culture:P.culture,key:P.bingMapsKey});ka.push(ma);break;case "esri.layers.OpenStreetMapLayer":ma=W.mixin(ma,{credits:P.copyright,type:"OpenStreetMap",url:n.getAbsoluteUrl(P.tileServers[0])});ka.push(ma);break;case "esri.layers.WMTSLayer":ma=W.mixin(ma,{url:P.url,type:"wmts",layer:P._identifier,style:P._style,format:P.format,tileMatrixSet:P._tileMatrixSetId});ka.push(ma);break;case "esri.layers.MapImageLayer":na=P.getImages();u.forEach(na,function(qa,
wa){qa.visible&&qa.href&&(ma={id:P.id+"_image"+wa,type:"image",title:P.id,minScale:P.minScale||0,maxScale:P.maxScale||0,opacity:P.opacity*qa.opacity,extent:qa.extent.toJson()},"data:image/png;base64,"===qa.href.substr(0,22)?ma.imageData=qa.href.substr(22):ma.url=qa.href,ka.push(ma))});break;case "esri.layers.VectorTileLayer":delete ma.url;delete ma.token;if(this._is11xService&&P.currentStyleInfo.serviceUrl&&P.currentStyleInfo.styleUrl&&(na=y.id&&y.id.findCredential(P.currentStyleInfo.styleUrl),z=
y.id&&y.id.findCredential(P.currentStyleInfo.serviceUrl),!na&&!z||"2.1.0"!==this._cimVersion)){ma.type="VectorTileLayer";ma.styleUrl=P.currentStyleInfo.styleUrl;na&&(ma.token=na.token);z&&z.token!==ma.token&&(ma.additionalTokens=[{url:P.currentStyleInfo.serviceUrl,token:z.token}]);ka.push(ma);break}ma.type="image";na=this._vtlExtent||a.extent.offset(0,0);var ra=B.exportOptions&&B.exportOptions.dpi||96;z={format:"png",pixelRatio:ra/96};"MAP_ONLY"!==B.layout||!B.preserveScale||B.outScale&&B.outScale!==
a.getScale()||96!==ra||!B.exportOptions||B.exportOptions.width%2===a.width%2&&B.exportOptions.height%2===a.height%2||(z.area={x:0,y:0,width:a.width,height:a.height},B.exportOptions.width%2!==a.width%2&&--z.area.width,B.exportOptions.height%2!==a.height%2&&--z.area.height,this._vtlExtent||(ra=a.toMap({x:z.area.width,y:z.area.height}),na.update(na.xmin,ra.y,ra.x,na.ymax,na.spatialReference),this._vtlExtent=na));ma.extent=na._normalize(!0).toJson();na=P.takeScreenshot(z);na.isResolved()?na.then(function(qa){"data:image/png;base64,"===
qa.dataURL.substr(0,22)&&(ma.imageData=qa.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");ma.imageData&&ka.push(ma);break;case "esri.layers.WebTiledLayer":na=P.url.replace(/\$\{/g,"{");ma=W.mixin(ma,{type:"WebTiledLayer",urlTemplate:na,credits:P.copyright});P.subDomains&&0<P.subDomains.length&&(ma.subDomains=P.subDomains);P._wmtsInfo&&(ma.wmtsInfo=P._wmtsInfo);delete ma.url;ka.push(ma);break;default:if(P.getTileUrl||P.getImageUrl)ma=
W.mixin(ma,{url:P.url}),ka.push(ma)}}}oa=u.map(a.graphicsLayerIds,a.getLayer,a);for(fa=0;fa<oa.length;fa++)P=oa[fa],P.isFeatureReductionActive&&P.isFeatureReductionActive()&&(P.getSingleGraphics().length?oa.splice(++fa,0,P.getFeatureReductionLayer()):oa[fa]=P.getFeatureReductionLayer());for(fa=0;fa<oa.length;fa++)if(P=oa[fa],P.loaded&&P.visible&&(!la||P.isVisibleAtScale(la)))switch(na=P.declaredClass,na){case "esri.layers.CSVLayer":if(this._is11xService){ma={id:P.id,url:P.url,title:P.title,opacity:P.opacity,
minScale:P.minScale||0,maxScale:P.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:P.latitudeFieldName,longitudeFieldName:P.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:P.renderer&&P.renderer.toJson()}}};ka.push(ma);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===na&&!B.showLabels||P.renderer&&"esri.renderer.HeatmapRenderer"===P.renderer.declaredClass)continue;na=null;P.url&&P.renderer&&("esri.renderer.ScaleDependentRenderer"===
P.renderer.declaredClass?"scale"===P.renderer.rangeType?na=P.renderer.getRendererInfoByScale(a.getScale())&&P.renderer.getRendererInfoByScale(a.getScale()).renderer:"zoom"===P.renderer.rangeType&&(na=P.renderer.getRendererInfoByZoom(a.getZoom())&&P.renderer.getRendererInfoByZoom(a.getZoom()).renderer):na=P.renderer);z=na&&"esri.layers.CSVLayer"!==P.declaredClass&&!this._isFeatureCollectionRequired(na,P)&&!na.valueExpression;ra=P.isFeatureReductionActive&&P.isFeatureReductionActive();if(na&&!ra&&"esri.renderer.DotDensityRenderer"!==
na.declaredClass&&"esri.layers.StreamLayer"!==P.declaredClass&&(this._is11xService||z)&&("esri.renderer.SimpleRenderer"===na.declaredClass||"esri.renderer.TemporalRenderer"===na.declaredClass||null==na.attributeField||W.isString(na.attributeField)&&P._getField(na.attributeField,!0)))if(ma={id:P.id,title:W.getObject("arcgisProps.title",!1,P)||P.id,opacity:P.opacity,minScale:P.minScale||0,maxScale:P.maxScale||0,layerDefinition:{drawingInfo:{renderer:na.toJson({useLegacyRotationProperties:!this._is11xService})}}},
ma=W.mixin(ma,this._getUrlAndToken(P)),"esri.renderer.TemporalRenderer"===na.declaredClass&&(z=ma.layerDefinition.drawingInfo,z.latestObservationRenderer=z.renderer.latestObservationRenderer,z.trackLinesRenderer=z.renderer.trackRenderer,z.observationAger=z.renderer.observationAger,z.renderer=z.renderer.observationRenderer,P._trackIdField&&(ma.layerDefinition.timeInfo={trackIdField:P._trackIdField})),this._convertSvgRenderer(ma.layerDefinition.drawingInfo.renderer),this._is11xService||1>P.opacity||
"esri.renderer.TemporalRenderer"===na.declaredClass||this._updateLayerOpacity(ma))if(P._params.source&&(na=P._params.source.toJson(),W.mixin(ma.layerDefinition,{source:na})),P.getDefinitionExpression()&&W.mixin(ma.layerDefinition,{definitionExpression:P.getDefinitionExpression()}),2!==P.mode)0<P.getSelectedFeatures().length&&(na=u.map(P.getSelectedFeatures(),function(qa){return qa.attributes[P.objectIdField]}),0<na.length&&P.getSelectionSymbol()&&W.mixin(ma,{selectionObjectIds:na,selectionSymbol:P.getSelectionSymbol().toJson()}));
else{na=u.map(P.getSelectedFeatures(),function(qa){return qa.attributes[P.objectIdField]});if(0===na.length||!P._params.drawMode)break;W.mixin(ma.layerDefinition,{objectIds:na});na=null;P.getSelectionSymbol()&&(na=new x(P.getSelectionSymbol()));W.mixin(ma.layerDefinition.drawingInfo,{renderer:na&&na.toJson()})}else ma=this._createFeatureCollection(P,a,null,B);else ma=na&&(na.valueExpression||this._isFeatureCollectionRequired(na,P)||"esri.renderer.DotDensityRenderer"===na.declaredClass)?this._createFeatureCollection(P,
a,na,B):this._createFeatureCollection(P,a,null,B);if(!ma)continue;ka.push(ma);this.allLayerslegend&&this.allLayerslegend.push({id:P.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":ma=this._createFeatureCollection(P,a,null,B);if(!ma)continue;ka.push(ma);this.allLayerslegend&&this.allLayerslegend.push({id:P.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":ma={id:P.id,title:W.getObject("arcgisProps.title",!1,P)||P.id,opacity:P.opacity,
minScale:P.minScale||0,maxScale:P.maxScale||0,visibility:P.visible,symbolTileSize:P.symbolTileSize,layerDefinition:{drawingInfo:{renderer:P.renderer.toJson({useLegacyRotationProperties:!this._is11xService})}}},ma=W.mixin(ma,this._getUrlAndToken(P)),P.mosaicRule&&W.mixin(ma,{mosaicRule:P.mosaicRule.toJson()}),ka.push(ma),this.allLayerslegend&&this.allLayerslegend.push({id:P.id})}la&&u.forEach(ka,function(qa){qa.minScale=0;qa.maxScale=0});a.graphics&&0<a.graphics.graphics.length&&(ma=this._createFeatureCollection(a.graphics,
a,null,B))&&ka.push(ma);a._labels&&B.showLabels&&(ma=this._createFeatureCollection(a._labels,a,null,B))&&ka.push(ma);u.forEach(ka,function(qa,wa,Ca){qa._isRefLayer&&(delete qa._isRefLayer,Ca.splice(wa,1),Ca.push(qa))});return ka},_getUrlAndToken:function(a){return{token:a._getToken(),url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var B=this._colorEvaluator(a);B=u.filter(B,function(oa){return W.isArray(oa)&&4===oa.length});var fa=!0;if(B.length){var ka=B[0][3],la;for(la=1;la<B.length;la++)if(ka!==
B[la][3]){fa=!1;break}if(fa)for(a.opacity=ka/255,la=0;la<B.length;la++)B[la][3]=255}return fa},_isFeatureCollectionRequired:function(a,B){if(B&&B.isFeatureReductionActive&&B.isFeatureReductionActive())return!0;var fa=!1;if(B=this._getVariable(a,"rotationInfo",!1))fa=(fa=B.field)&&W.isFunction(fa)||B.valueExpression;return a.hasVisualVariables("sizeInfo")||a.hasVisualVariables("colorInfo")||a.hasVisualVariables("opacityInfo")||fa},_getVariable:function(a,B,fa){if(a)var ka=(a=a.getVisualVariablesForType(B,
fa))&&a[0];return ka},_applyVisualVariables:function(a,B){var fa=B.renderer,ka=B.graphic,la=B.symbol,oa=B.mapResolution,P=B.mapScale,na=la.type;if("textsymbol"!==na&&"shieldlabelsymbol"!==na){var ma=this._getVariable(fa,"sizeInfo",!1),J=this._getVariable(fa,"colorInfo",!1),z=this._getVariable(fa,"opacityInfo",!1);B=this._getVariable(fa,"rotationInfo",!1);la instanceof F&&(ma=this._getVariable(fa,"sizeInfo","outline")||ma);oa=ma?fa.getSize(ka,{sizeInfo:ma,shape:"simplemarkersymbol"===na?la.style:null,
resolution:oa,scale:P}):ka.size;null!=oa&&("simplemarkersymbol"===na?a.size=M.px2pt(oa):"picturemarkersymbol"===na?(P=la.width/la.height*oa,a.width=M.px2pt(P),a.height=M.px2pt(oa),0!==la.xoffset&&(a.xoffset=M.px2pt(la.xoffset/la.width*P)),0!==la.yoffset&&(a.yoffset=M.px2pt(la.yoffset/la.height*oa))):"simplelinesymbol"===na?a.width=M.px2pt(oa):a.outline&&(a.outline.width=M.px2pt(oa)));J&&(!(la=fa.getColor(ka,{colorInfo:J}))||"simplemarkersymbol"!==na&&"simplelinesymbol"!==na&&"simplefillsymbol"!==
na||(a.color=l.toJsonColor(la)));z&&(la=fa.getOpacity(ka,{opacityInfo:z}),null!=la&&a.color&&(a.color[3]=Math.round(255*la)));B&&(fa=fa.getRotationAngle(ka,{rotationInfo:B}))&&(a.angle=-fa)}}});N("extend-esri")&&W.setObject("tasks.PrintTask",V,y);return V})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R){V=V(m,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(C){this._jobUpdateHandler=W.hitch(this,this._jobUpdateHandler);this._getJobStatus=W.hitch(this,this._getJobStatus);this._getResultDataHandler=
W.hitch(this,this._getResultDataHandler);this._getResultImageHandler=W.hitch(this,this._getResultImageHandler);this._executeHandler=W.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(C){this.updateDelay=C},setProcessSpatialReference:function(C){this.processSpatialReference=C},setOutputSpatialReference:function(C){this._setOutSR(C)},setOutSpatialReference:function(C){this._setOutSR(C)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(C){this.outSpatialReference=this.outputSpatialReference=C},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(C,a,B){for(var fa in C){var ka=C[fa];W.isArray(ka)?C[fa]=X.toJson(u.map(ka,function(la){return this._gpEncode({item:la},!0).item},this)):ka instanceof Date&&(C[fa]=ka.getTime())}return this._encode(C,a,B)},_decode:function(C){var a=
C.dataType,B=new Q(C);if(-1!==u.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],a))return B;if("GPLinearUnit"===a)B.value=new F(B.value);else if("GPFeatureRecordSetLayer"===a||"GPRecordSet"===a)B.value=new n(B.value);else if("GPDataFile"===a)B.value=new H(B.value);else if("GPDate"===a)C=B.value,W.isString(C)?B.value=new G({date:C}):B.value=new Date(C);else if("GPRasterData"===a||"GPRasterDataLayer"===a)C=C.value.mapImage,B.value=C?new R(C):new w(B.value);else if(-1!==a.indexOf("GPMultiValue:")){var fa=
a.split(":")[1];C=B.value;B.value=u.map(C,function(ka){return this._decode({paramName:"_name",dataType:fa,value:ka}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+B.dataType),B=null;return B},submitJob:function(C,a,B,fa,ka){var la=this._getOutSR(),oa=ka.assembly;C=this._gpEncode(W.mixin({},this._url.query,{f:"json","env:outSR":la?la.wkid||X.toJson(la.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||X.toJson(this.processSpatialReference.toJson()):
null},C),null,oa&&oa[0]);var P=this._jobUpdateHandler,na=this._errorHandler;return d({url:this._url.path+"/submitJob",content:C,callbackParamName:"callback",load:function(ma,J){P(ma,J,!1,a,B,ka.dfd)},error:function(ma){na(ma,fa,ka.dfd)}})},_jobUpdateHandler:function(C,a,B,fa,ka,la){var oa=C.jobId;a=new h(C);this._successHandler([a],"onStatusUpdate",ka,B&&la);if(!B)switch(clearTimeout(this._updateTimers[oa]),this._updateTimers[oa]=null,la&&la.progress(a),C.jobStatus){case h.STATUS_SUBMITTED:case h.STATUS_EXECUTING:case h.STATUS_WAITING:case h.STATUS_NEW:var P=
this._getJobStatus;this._updateTimers[oa]=setTimeout(function(){P(oa,B,fa,ka,la)},this.updateDelay);break;default:this._successHandler([a],"onJobComplete",fa,la)}},_getJobStatus:function(C,a,B,fa,ka){var la=this._jobUpdateHandler;d({url:this._url.path+"/jobs/"+C,content:W.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(oa,P){la(oa,P,a,B,fa,ka)},error:this._errorHandler})},_getResultDataHandler:function(C,a,B,fa,ka){try{var la=this._decode(C);this._successHandler([la],
"onGetResultDataComplete",B,ka)}catch(oa){this._errorHandler(oa,fa,ka)}},getResultData:function(C,a,B,fa){var ka=this._getResultDataHandler,la=this._errorHandler,oa=new O(e._dfdCanceller);oa._pendingDfd=d({url:this._url.path+"/jobs/"+C+"/results/"+a,content:W.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(P,na){ka(P,na,B,fa,oa)},error:function(P){la(P,fa,oa)}});return oa},checkJobStatus:function(C,a,B){var fa=this._jobUpdateHandler,ka=this._errorHandler,
la=new O(e._dfdCanceller);la._pendingDfd=d({url:this._url.path+"/jobs/"+C,content:W.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(oa,P){fa(oa,P,!0,null,a,la)},error:function(oa){ka(oa,B,la)}});return la},cancelJob:function(C,a,B){var fa=this._errorHandler,ka=new O(e._dfdCanceller);ka._pendingDfd=d({url:this._url.path+"/jobs/"+C+"/cancel",content:W.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:W.hitch(this,function(la,oa){this._successHandler([la],
"onJobCancel",a,ka)}),error:function(la){fa(la,B,ka)}});return ka},execute:function(C,a,B,fa){var ka=this._getOutSR(),la=fa.assembly;C=this._gpEncode(W.mixin({},this._url.query,{f:"json","env:outSR":ka?ka.wkid||X.toJson(ka.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||X.toJson(this.processSpatialReference.toJson()):null},C),null,la&&la[0]);var oa=this._executeHandler,P=this._errorHandler;return d({url:this._url.path+"/execute",content:C,callbackParamName:"callback",
load:function(na,ma){oa(na,ma,a,B,fa.dfd)},error:function(na){P(na,B,fa.dfd)}})},_executeHandler:function(C,a,B,fa,ka){try{var la=C.results,oa,P=C.messages;var na=0;for(oa=la.length;na<oa;na++)la[na]=this._decode(la[na]);na=0;for(oa=P.length;na<oa;na++)P[na]=new x(P[na]);this._successHandler([la,P],"onExecuteComplete",B,ka)}catch(ma){this._errorHandler(ma,fa,ka)}},_getResultImageHandler:function(C,a,B,fa,ka){try{var la=this._decode(C);this._successHandler([la],"onGetResultImageComplete",B,ka)}catch(oa){this._errorHandler(oa,
fa,ka)}},getResultImage:function(C,a,B,fa,ka){var la=this._getResultImageHandler,oa=this._errorHandler;B=this._gpEncode(W.mixin({},this._url.query,{f:"json"},B.toJson()));var P=new O(e._dfdCanceller);P._pendingDfd=d({url:this._url.path+"/jobs/"+C+"/results/"+a,content:B,callbackParamName:"callback",load:function(na,ma){la(na,ma,fa,ka,P)},error:function(na){oa(na,ka,P)}});return P},cancelJobStatusUpdates:function(C){clearTimeout(this._updateTimers[C]);this._updateTimers[C]=null},getResultImageLayer:function(C,
a,B,fa){if(null==a){var ka=this._url.path.indexOf("/GPServer/");C=this._url.path.substring(0,ka)+"/MapServer/jobs/"+C}else C=this._url.path+"/jobs/"+C+"/results/"+a;this._url.query&&(C+="?"+y.objectToQuery(this._url.query));a=null==a?new M(C,{imageParameters:B}):new S(C,{imageParameters:B},!0);this.onGetResultImageLayerComplete(a);fa&&fa(a);return a},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},
onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});l._createWrappers(V);N("extend-esri")&&W.setObject("tasks.Geoprocessor",V,r);return V})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(V,W,u,O,X){V=V(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(N){this.messages=[];W.mixin(this,N);N=this.messages;var y,r=N.length;for(y=0;y<r;y++)N[y]=new X(N[y])},jobId:"",jobStatus:""});W.mixin(V,{STATUS_CANCELLED:"esriJobCancelled",
STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});u("extend-esri")&&W.setObject("tasks.JobInfo",V,O);return V})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],
function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(X){W.mixin(this,X)}});W.mixin(V,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});u("extend-esri")&&
W.setObject("tasks.GPMessage",V,O);return V})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(X){X&&W.mixin(this,X)},distance:0,units:null,toJson:function(){var X={};this.distance&&(X.distance=this.distance);this.units&&(X.units=this.units);return X}});u("extend-esri")&&W.setObject("tasks.LinearUnit",V,O);return V})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.DataFile",constructor:function(X){X&&W.mixin(this,X)},url:null,itemID:null,toJson:function(){var X={};this.url&&(X.url=this.url);this.itemID&&(X.itemID=this.itemID);return X}});u("extend-esri")&&W.setObject("tasks.DataFile",V,O);return V})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.RasterData",
constructor:function(X){X&&W.mixin(this,X)},url:null,format:null,itemID:null,toJson:function(){var X={};this.url&&(X.url=this.url);this.format&&(X.format=this.format);this.itemID&&(X.itemID=this.itemID);return X}});u("extend-esri")&&W.setObject("tasks.RasterData",V,O);return V})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(V,W,u,O,X){V=V(null,{declaredClass:"esri.tasks.Date",constructor:function(N){N&&(N.format&&(this.format=
N.format),this.date=u.parse(N.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:u.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});O("extend-esri")&&W.setObject("tasks.Date",V,X);return V})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(X){W.mixin(this,
X)}});u("extend-esri")&&W.setObject("tasks.ParameterValue",V,O);return V})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(V,W,u,O,X,N,y){V=V(y,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(r,d){d&&d.imageParameters&&d.imageParameters.extent&&(this.initialExtent=this.fullExtent=d.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);
this.getImageUrl=W.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(r,d,e,l){var m=r.spatialReference.wkid;l(this._url.path+"?"+X.objectToQuery(W.mixin(this._params,{f:"image",bbox:u.toJson(r.toJson()),bboxSR:m,imageSR:m,size:d+","+e})))}});O("extend-esri")&&W.setObject("tasks._GPResultImageLayer",V,N);return V})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.PrintTemplate",
label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});u("extend-esri")&&W.setObject("tasks.PrintTemplate",V,O);return V})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(V,W,u,O,X,N,y,
r,d,e,l,m,n){function h(J,z,I,da,ra,qa,wa,Ca,b,f){var D=z.length,t=0;if(f){var Z=f.l/ra;t=f.i}else Z=z[0]/ra;for(;qa<wa;){if(qa+Z>wa){var ca={l:(qa+Z-wa)*ra,i:t};Z=wa-qa}t%2||(J.beginPath(),J.arc(I,da,ra,qa,qa+Z,Ca),b&&J.stroke());qa+=Z;++t;Z=z[t%D]/ra}return ca}function x(J,z,I,da){var ra=0,qa=0,wa=0;if(da){var Ca=da.l;wa=da.i}else Ca=z[0];for(;1>qa;)qa=n.tAtLength(J,Ca),1==qa&&(ra=n.computeLength(J),ra={l:Ca-ra,i:wa}),J=n.splitBezierAtT(J,qa),wa%2||I.push(J[0]),J=J[1],++wa,Ca=z[wa%z.length];return ra}
function F(J,z,I,da){var ra=[z.last.x,z.last.y].concat(I),qa=!(J instanceof Array);I=4===I.length?"quadraticCurveTo":"bezierCurveTo";var wa=[];z=x(ra,z.canvasDash,wa,da);for(da=0;da<wa.length;++da)ra=wa[da],qa?(J.moveTo(ra[0],ra[1]),J[I].apply(J,ra.slice(2))):(J.push("moveTo",[ra[0],ra[1]]),J.push(I,ra.slice(2)));return z}function H(J,z,I,da,ra,qa,wa){var Ca=0,b=0,f=0,D=n.distance(I,da,ra,qa),t=0;z=z.canvasDash;var Z=I,ca=da,ta=!(J instanceof Array);wa?(f=wa.l,t=wa.i):f+=z[0];for(;.01<Math.abs(1-
b);){f>D&&(Ca={l:f-D,i:t},f=D);b=f/D;wa=I+(ra-I)*b;var g=da+(qa-da)*b;t++%2||(ta?(J.moveTo(Z,ca),J.lineTo(wa,g)):(J.push("moveTo",[Z,ca]),J.push("lineTo",[wa,g])));Z=wa;ca=g;f+=z[t%z.length]}return Ca}var w=V.canvas={},G=null,Q=l.multiplyPoint,S=Math.PI,M=2*S,R=S/2;m=W.extend;if(X.global.CanvasRenderingContext2D){X=X.doc.createElement("canvas").getContext("2d");var C="function"==typeof X.setLineDash,a="function"==typeof X.fillText}var B={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,
1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};w.Shape=O("dojox.gfx.canvas.Shape",r.Shape,{_render:function(J){J.save();this._renderTransform(J);this._renderClip(J);this._renderShape(J);this._renderFill(J,!0);this._renderStroke(J,!0);J.restore()},_renderClip:function(J){this.canvasClip&&(this.canvasClip.render(J),J.clip())},_renderTransform:function(J){if("canvasTransform"in this){var z=this.canvasTransform;
J.translate(z.dx,z.dy);J.rotate(z.angle2);J.scale(z.sx,z.sy);J.rotate(z.angle1)}},_renderShape:function(J){},_renderFill:function(J,z){if("canvasFill"in this){var I=this.fillStyle;if("canvasFillImage"in this){var da=I.width,ra=I.height,qa=this.canvasFillImage.width,wa=this.canvasFillImage.height,Ca=Math.min(da==qa?1:da/qa,ra==wa?1:ra/wa),b=(da-Ca*qa)/2,f=(ra-Ca*wa)/2;G.width=da;G.height=ra;var D=G.getContext("2d");D.clearRect(0,0,da,ra);D.drawImage(this.canvasFillImage,0,0,qa,wa,b,f,Ca*qa,Ca*wa);
this.canvasFill=J.createPattern(G,"repeat");delete this.canvasFillImage}J.fillStyle=this.canvasFill;z&&("pattern"!==I.type||0===I.x&&0===I.y||J.translate(I.x,I.y),J.fill())}else J.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(J,z){var I=this.strokeStyle;I?(J.strokeStyle=I.color.toString(),J.lineWidth=I.width,J.lineCap=I.cap,"number"==typeof I.join?(J.lineJoin="miter",J.miterLimit=I.join):J.lineJoin=I.join,this.canvasDash?C?(J.setLineDash(this.canvasDash),z&&J.stroke()):this._renderDashedStroke(J,
z):z&&J.stroke()):z||(J.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(J,z){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(J){this.inherited(arguments);var z=J?"width"in J?"rect":"cx"in J?"ellipse":"points"in J?"polyline":"d"in J?"path":null:null;if(J&&!z)return this;this.canvasClip=J?fa(z,J):null;this.parent&&this.parent._makeDirty();return this}});var fa=function(J,z){switch(J){case "ellipse":return{canvasEllipse:P({shape:z}),
render:function(I){return w.Ellipse.prototype._renderShape.call(this,I)}};case "rect":return{shape:W.delegate(z,{r:0}),render:function(I){return w.Rect.prototype._renderShape.call(this,I)}};case "path":return{canvasPath:ka(z),render:function(I){this.canvasPath._renderShape(I)}};case "polyline":return{canvasPolyline:z.points,render:function(I){return w.Polyline.prototype._renderShape.call(this,I)}}}return null},ka=function(J){var z=new dojox.gfx.canvas.Path;z.canvasPath=[];z._setPath(J.d);return z},
la=function(J,z,I){var da=J.prototype[z];J.prototype[z]=I?function(){this.parent&&this.parent._makeDirty();da.apply(this,arguments);I.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return da.apply(this,arguments)}};la(w.Shape,"setTransform",function(){this.matrix?this.canvasTransform=V.decompose(this.matrix):delete this.canvasTransform});la(w.Shape,"setFill",function(){var J=this.fillStyle;if(J){if("object"==typeof J&&"type"in J){var z=this.surface.rawNode.getContext("2d");
switch(J.type){case "linear":case "radial":var I="linear"==J.type?z.createLinearGradient(J.x1,J.y1,J.x2,J.y2):z.createRadialGradient(J.cx,J.cy,0,J.cx,J.cy,J.r);u.forEach(J.colors,function(da){I.addColorStop(da.offset,V.normalizeColor(da.color).toString())});break;case "pattern":G||(G=document.createElement("canvas")),z=new Image,this.surface.downloadImage(z,J.src),this.canvasFillImage=z}}else I=J.toString();this.canvasFill=I}else delete this.canvasFill});la(w.Shape,"setStroke",function(){var J=this.strokeStyle;
if(J){var z=this.strokeStyle.style.toLowerCase();z in B&&(z=B[z]);if(z instanceof Array){this.canvasDash=z=z.slice();var I;for(I=0;I<z.length;++I)z[I]*=J.width;if("butt"!=J.cap){for(I=0;I<z.length;I+=2)z[I]-=J.width,1>z[I]&&(z[I]=1);for(I=1;I<z.length;I+=2)z[I]+=J.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!C&&!!this.canvasDash});la(w.Shape,"setShape");w.Group=O("dojox.gfx.canvas.Group",w.Shape,{constructor:function(){r.Container._init.call(this)},_render:function(J){J.save();
this._renderTransform(J);this._renderClip(J);for(var z=0;z<this.children.length;++z)this.children[z]._render(J);J.restore()},destroy:function(){r.Container.clear.call(this,!0);w.Shape.prototype.destroy.apply(this,arguments)}});w.Rect=O("dojox.gfx.canvas.Rect",[w.Shape,r.Rect],{_renderShape:function(J){var z=this.shape,I=Math.min(z.r,z.height/2,z.width/2),da=z.x,ra=da+z.width,qa=z.y;z=qa+z.height;var wa=da+I,Ca=ra-I,b=qa+I,f=z-I;J.beginPath();J.moveTo(wa,qa);I?(J.arc(Ca,b,I,-R,0,!1),J.arc(Ca,f,I,0,
R,!1),J.arc(wa,f,I,R,S,!1),J.arc(wa,b,I,S,S+R,!1)):(J.lineTo(Ca,qa),J.lineTo(ra,f),J.lineTo(wa,z),J.lineTo(da,b));J.closePath()},_renderDashedStroke:function(J,z){var I=this.shape,da=Math.min(I.r,I.height/2,I.width/2),ra=I.x,qa=ra+I.width,wa=I.y,Ca=wa+I.height,b=ra+da,f=qa-da,D=wa+da,t=Ca-da;da?(J.beginPath(),I=H(J,this,b,wa,f,wa),z&&J.stroke(),I=h(J,this.canvasDash,f,D,da,-R,0,!1,z,I),J.beginPath(),I=H(J,this,qa,D,qa,t,I),z&&J.stroke(),I=h(J,this.canvasDash,f,t,da,0,R,!1,z,I),J.beginPath(),I=H(J,
this,f,Ca,b,Ca,I),z&&J.stroke(),I=h(J,this.canvasDash,b,t,da,R,S,!1,z,I),J.beginPath(),I=H(J,this,ra,t,ra,D,I),z&&J.stroke(),h(J,this.canvasDash,b,D,da,S,S+R,!1,z,I)):(J.beginPath(),I=H(J,this,b,wa,f,wa),I=H(J,this,f,wa,qa,t,I),I=H(J,this,qa,t,b,Ca,I),H(J,this,b,Ca,ra,D,I),z&&J.stroke())}});var oa=[];(function(){var J=e.curvePI4;oa.push(J.s,J.c1,J.c2,J.e);for(var z=45;360>z;z+=45){var I=l.rotateg(z);oa.push(Q(I,J.c1),Q(I,J.c2),Q(I,J.e))}})();var P=function(J){var z=[],I=J.shape,da=l.normalize([l.translate(I.cx,
I.cy),l.scale(I.rx,I.ry)]);var ra=Q(da,oa[0]);z.push([ra.x,ra.y]);for(I=1;I<oa.length;I+=3){var qa=Q(da,oa[I]);var wa=Q(da,oa[I+1]);ra=Q(da,oa[I+2]);z.push([qa.x,qa.y,wa.x,wa.y,ra.x,ra.y])}if(J._needsDash){ra=[];qa=z[0];for(I=1;I<z.length;++I)wa=[],x(qa.concat(z[I]),J.canvasDash,wa),qa=[z[I][4],z[I][5]],ra.push(wa);J._dashedPoints=ra}return z};w.Ellipse=O("dojox.gfx.canvas.Ellipse",[w.Shape,r.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=P(this);return this},setStroke:function(){this.inherited(arguments);
C||(this.canvasEllipse=P(this));return this},_renderShape:function(J){var z=this.canvasEllipse,I;J.beginPath();J.moveTo.apply(J,z[0]);for(I=1;I<z.length;++I)J.bezierCurveTo.apply(J,z[I]);J.closePath()},_renderDashedStroke:function(J,z){var I=this._dashedPoints;J.beginPath();for(var da=0;da<I.length;++da)for(var ra=I[da],qa=0;qa<ra.length;++qa){var wa=ra[qa];J.moveTo(wa[0],wa[1]);J.bezierCurveTo(wa[2],wa[3],wa[4],wa[5],wa[6],wa[7])}z&&J.stroke()}});w.Circle=O("dojox.gfx.canvas.Circle",[w.Shape,r.Circle],
{_renderShape:function(J){var z=this.shape;J.beginPath();J.arc(z.cx,z.cy,z.r,0,M,1)},_renderDashedStroke:function(J,z){var I=this.shape,da=0,ra=this.canvasDash.length;for(i=0;da<M;){var qa=this.canvasDash[i%ra]/I.r;i%2||(J.beginPath(),J.arc(I.cx,I.cy,I.r,da,da+qa,0),z&&J.stroke());da+=qa;++i}}});w.Line=O("dojox.gfx.canvas.Line",[w.Shape,r.Line],{_renderShape:function(J){var z=this.shape;J.beginPath();J.moveTo(z.x1,z.y1);J.lineTo(z.x2,z.y2)},_renderDashedStroke:function(J,z){var I=this.shape;J.beginPath();
H(J,this,I.x1,I.y1,I.x2,I.y2);z&&J.stroke()}});w.Polyline=O("dojox.gfx.canvas.Polyline",[w.Shape,r.Polyline],{setShape:function(){this.inherited(arguments);var J=this.shape.points,z=J[0],I;this.bbox=null;this._normalizePoints();if(J.length)if("number"==typeof z)z=J;else for(z=[],I=0;I<J.length;++I){var da=J[I];z.push(da.x,da.y)}else z=[];this.canvasPolyline=z;return this},_renderShape:function(J){var z=this.canvasPolyline;if(z.length){J.beginPath();J.moveTo(z[0],z[1]);for(var I=2;I<z.length;I+=2)J.lineTo(z[I],
z[I+1])}},_renderDashedStroke:function(J,z){var I=this.canvasPolyline,da=0;J.beginPath();for(var ra=0;ra<I.length;ra+=2)da=H(J,this,I[ra],I[ra+1],I[ra+2],I[ra+3],da);z&&J.stroke()}});w.Image=O("dojox.gfx.canvas.Image",[w.Shape,r.Image],{setShape:function(){this.inherited(arguments);var J=new Image;this.surface.downloadImage(J,this.shape.src);this.canvasImage=J;return this},_renderShape:function(J){var z=this.shape;J.drawImage(this.canvasImage,z.x,z.y,z.width,z.height)}});w.Text=O("dojox.gfx.canvas.Text",
[w.Shape,r.Text],{_setFont:function(){this.fontStyle?this.canvasFont=V.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var J=this.shape,z=0;if(J.text){var I=this.surface.rawNode.getContext("2d");I.save();this._renderTransform(I);this._renderFill(I,!1);this._renderStroke(I,!1);this.canvasFont&&(I.font=this.canvasFont);z=I.measureText(J.text).width;I.restore()}return z},_render:function(J){J.save();this._renderTransform(J);this._renderFill(J,!1);this._renderStroke(J,!1);
this._renderShape(J);J.restore()},_renderShape:function(J){var z=this.shape;z.text&&(J.textAlign="middle"===z.align?"center":z.align,this.canvasFont&&(J.font=this.canvasFont),this.canvasFill&&J.fillText(z.text,z.x,z.y),this.strokeStyle&&(J.beginPath(),J.strokeText(z.text,z.x,z.y),J.closePath()))}});la(w.Text,"setFont");a||w.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var na={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",
h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};w.Path=O("dojox.gfx.canvas.Path",[w.Shape,d.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);C||(this.segmented=!1,this._confirmSegmented());
return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(J){var z=W.clone(this.last);this[na[J.action]](this.canvasPath,J.action,J.args,this._needsDash?this._dashedPath:null);this.last=z;this.inherited(arguments)},_renderShape:function(J){var z=this.canvasPath;J.beginPath();for(var I=0;I<z.length;I+=2)J[z[I]].apply(J,z[I+1])},_renderDashedStroke:C?function(){}:function(J,z){var I=this._dashedPath;J.beginPath();for(var da=0;da<I.length;da+=2)J[I[da]].apply(J,
I[da+1]);z&&J.stroke()},_moveToA:function(J,z,I,da){J.push("moveTo",[I[0],I[1]]);da&&da.push("moveTo",[I[0],I[1]]);for(z=2;z<I.length;z+=2)J.push("lineTo",[I[z],I[z+1]]),da&&(this._dashResidue=H(da,this,I[z-2],I[z-1],I[z],I[z+1],this._dashResidue));this.last.x=I[I.length-2];this.last.y=I[I.length-1];this.lastControl={}},_moveToR:function(J,z,I,da){z="x"in this.last?[this.last.x+=I[0],this.last.y+=I[1]]:[this.last.x=I[0],this.last.y=I[1]];J.push("moveTo",z);da&&da.push("moveTo",z);for(z=2;z<I.length;z+=
2)J.push("lineTo",[this.last.x+=I[z],this.last.y+=I[z+1]]),da&&(this._dashResidue=H(da,this,da[da.length-1][0],da[da.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(J,z,I,da){for(z=0;z<I.length;z+=2)da&&(this._dashResidue=H(da,this,this.last.x,this.last.y,I[z],I[z+1],this._dashResidue)),J.push("lineTo",[I[z],I[z+1]]);this.last.x=I[I.length-2];this.last.y=I[I.length-1];this.lastControl={}},_lineToR:function(J,z,I,da){for(z=0;z<I.length;z+=2)J.push("lineTo",
[this.last.x+=I[z],this.last.y+=I[z+1]]),da&&(this._dashResidue=H(da,this,da[da.length-1][0],da[da.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(J,z,I,da){for(z=0;z<I.length;++z)J.push("lineTo",[I[z],this.last.y]),da&&(this._dashResidue=H(da,this,da[da.length-1][0],da[da.length-1][1],I[z],this.last.y,this._dashResidue));this.last.x=I[I.length-1];this.lastControl={}},_hLineToR:function(J,z,I,da){for(z=0;z<I.length;++z)J.push("lineTo",[this.last.x+=
I[z],this.last.y]),da&&(this._dashResidue=H(da,this,da[da.length-1][0],da[da.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(J,z,I,da){for(z=0;z<I.length;++z)J.push("lineTo",[this.last.x,I[z]]),da&&(this._dashResidue=H(da,this,da[da.length-1][0],da[da.length-1][1],this.last.x,I[z],this._dashResidue));this.last.y=I[I.length-1];this.lastControl={}},_vLineToR:function(J,z,I,da){for(z=0;z<I.length;++z)J.push("lineTo",[this.last.x,this.last.y+=I[z]]),da&&
(this._dashResidue=H(da,this,da[da.length-1][0],da[da.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(J,z,I,da){for(z=0;z<I.length;z+=6)J.push("bezierCurveTo",I.slice(z,z+6)),da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue));this.last.x=I[I.length-2];this.last.y=I[I.length-1];this.lastControl.x=I[I.length-4];this.lastControl.y=I[I.length-3];this.lastControl.type="C"},_curveToR:function(J,z,I,da){for(z=0;z<I.length;z+=6)J.push("bezierCurveTo",
[this.last.x+I[z],this.last.y+I[z+1],this.lastControl.x=this.last.x+I[z+2],this.lastControl.y=this.last.y+I[z+3],this.last.x+I[z+4],this.last.y+I[z+5]]),da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue)),this.last.x+=I[z+4],this.last.y+=I[z+5];this.lastControl.type="C"},_smoothCurveToA:function(J,z,I,da){for(z=0;z<I.length;z+=4){var ra="C"==this.lastControl.type;J.push("bezierCurveTo",[ra?2*this.last.x-this.lastControl.x:this.last.x,ra?2*this.last.y-this.lastControl.y:this.last.y,
I[z],I[z+1],I[z+2],I[z+3]]);da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue));this.lastControl.x=I[z];this.lastControl.y=I[z+1];this.lastControl.type="C"}this.last.x=I[I.length-2];this.last.y=I[I.length-1]},_smoothCurveToR:function(J,z,I,da){for(z=0;z<I.length;z+=4){var ra="C"==this.lastControl.type;J.push("bezierCurveTo",[ra?2*this.last.x-this.lastControl.x:this.last.x,ra?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+I[z],this.last.y+I[z+1],this.last.x+I[z+2],this.last.y+
I[z+3]]);da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue));this.lastControl.x=this.last.x+I[z];this.lastControl.y=this.last.y+I[z+1];this.lastControl.type="C";this.last.x+=I[z+2];this.last.y+=I[z+3]}},_qCurveToA:function(J,z,I,da){for(z=0;z<I.length;z+=4)J.push("quadraticCurveTo",I.slice(z,z+4));da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue));this.last.x=I[I.length-2];this.last.y=I[I.length-1];this.lastControl.x=I[I.length-4];this.lastControl.y=I[I.length-3];this.lastControl.type=
"Q"},_qCurveToR:function(J,z,I,da){for(z=0;z<I.length;z+=4)J.push("quadraticCurveTo",[this.lastControl.x=this.last.x+I[z],this.lastControl.y=this.last.y+I[z+1],this.last.x+I[z+2],this.last.y+I[z+3]]),da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue)),this.last.x+=I[z+2],this.last.y+=I[z+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(J,z,I,da){for(z=0;z<I.length;z+=2){var ra="Q"==this.lastControl.type;J.push("quadraticCurveTo",[this.lastControl.x=ra?2*this.last.x-this.lastControl.x:
this.last.x,this.lastControl.y=ra?2*this.last.y-this.lastControl.y:this.last.y,I[z],I[z+1]]);da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=I[I.length-2];this.last.y=I[I.length-1]},_qSmoothCurveToR:function(J,z,I,da){for(z=0;z<I.length;z+=2){var ra="Q"==this.lastControl.type;J.push("quadraticCurveTo",[this.lastControl.x=ra?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=ra?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+
I[z],this.last.y+I[z+1]]);da&&(this._dashResidue=F(da,this,J[J.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=I[z];this.last.y+=I[z+1]}},_arcTo:function(J,z,I,da){z="a"==z;for(var ra=0;ra<I.length;ra+=7){var qa=I[ra+5],wa=I[ra+6];z&&(qa+=this.last.x,wa+=this.last.y);var Ca=e.arcAsBezier(this.last,I[ra],I[ra+1],I[ra+2],I[ra+3]?1:0,I[ra+4]?1:0,qa,wa);u.forEach(Ca,function(b){J.push("bezierCurveTo",b)});da&&(this._dashResidue=F(da,this,p,this._dashResidue));this.last.x=qa;this.last.y=
wa}this.lastControl={}},_closePath:function(J,z,I,da){J.push("closePath",[]);da&&(this._dashResidue=H(da,this,this.last.x,this.last.y,da[1][0],da[1][1],this._dashResidue));this.lastControl={}}});u.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(J){la(w.Path,J)});w.TextPath=O("dojox.gfx.canvas.TextPath",[w.Shape,d.TextPath],{_renderShape:function(J){},_setText:function(){},_setFont:function(){}});w.Surface=O("dojox.gfx.canvas.Surface",
r.Surface,{constructor:function(){r.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){r.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(J,z){this.width=V.normalizedLength(J);this.height=V.normalizedLength(z);if(!this.rawNode)return this;J=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,J=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,J=!0);J&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?
{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(J){!this.rawNode||!J&&this.pendingImageCount||(J=this.rawNode.getContext("2d"),J.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(J),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(J){J.save();for(var z=0;z<this.children.length;++z)this.children[z]._render(J);J.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||
(this.pendingRender=setTimeout(W.hitch(this,this._render),0))},downloadImage:function(J,z){var I=W.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);J.onload=I;J.onerror=I;J.onabort=I;J.src=z},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});
w.createSurface=function(J,z,I){if(!z&&!I){var da=N.position(J);z=z||da.w;I=I||da.h}"number"==typeof z&&(z+="px");"number"==typeof I&&(I+="px");da=new w.Surface;J=y.byId(J);var ra=J.ownerDocument.createElement("canvas");ra.width=V.normalizedLength(z);ra.height=V.normalizedLength(I);J.appendChild(ra);da.rawNode=ra;da._parent=J;return da.surface=da};var ma=r.Container;O={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();
return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(J){this._makeDirty();return ma.add.apply(this,arguments)},remove:function(J,z){this._makeDirty();return ma.remove.apply(this,arguments)},clear:function(){this._makeDirty();return ma.clear.apply(this,arguments)},getBoundingBox:ma.getBoundingBox,_moveChildToFront:function(J){this._makeDirty();return ma._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(J){this._makeDirty();return ma._moveChildToBack.apply(this,
arguments)}};d={createObject:function(J,z){J=new J;J.surface=this.surface;J.setShape(z);this.add(J);return J}};m(w.Group,O);m(w.Group,r.Creator);m(w.Group,d);m(w.Surface,O);m(w.Surface,r.Creator);m(w.Surface,d);w.fixTarget=function(J,z){return!0};return w})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(V,W,u,O,X,N,y,r,d,e){function l(n,h){for(var x=
n.length-1;h<x;)n[h]=n[++h];n.length=x}var m=V.shape={};m.Shape=u("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(X("gfxRegistry")){var n=m.register(this);this.getUID=function(){return n}}},destroy:function(){X("gfxRegistry")&&m.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},
getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var n=this.getBoundingBox();if(!n)return null;var h=this._getRealMatrix();return[e.multiplyPoint(h,n.x,n.y),e.multiplyPoint(h,n.x+n.width,n.y),e.multiplyPoint(h,n.x+n.width,n.y+n.height),e.multiplyPoint(h,n.x,
n.y+n.height)]},getEventSource:function(){return this.rawNode},setClip:function(n){this.clip=n},getClip:function(){return this.clip},setShape:function(n){this.shape=V.makeParameters(this.shape,n);this.bbox=null;return this},setFill:function(n){if(!n)return this.fillStyle=null,this;var h=null;if("object"==typeof n&&"type"in n)switch(n.type){case "linear":h=V.makeParameters(V.defaultLinearGradient,n);break;case "radial":h=V.makeParameters(V.defaultRadialGradient,n);break;case "pattern":h=V.makeParameters(V.defaultPattern,
n)}else h=V.normalizeColor(n);this.fillStyle=h;return this},setStroke:function(n){if(!n)return this.strokeStyle=null,this;if("string"==typeof n||W.isArray(n)||n instanceof d)n={color:n};n=this.strokeStyle=V.makeParameters(V.defaultStroke,n);n.color=V.normalizeColor(n.color);return this},setTransform:function(n){this.matrix=e.clone(n?e.normalize(n):e.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var n=this.getParent();n&&(n._moveChildToFront(this),
this._moveToFront());return this},moveToBack:function(){var n=this.getParent();n&&(n._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(n){return n?this.setTransform([this.matrix,n]):this},applyLeftTransform:function(n){return n?this.setTransform([n,this.matrix]):this},applyTransform:function(n){return n?this.setTransform([this.matrix,n]):this},removeShape:function(n){this.parent&&this.parent.remove(this,n);return this},
_setParent:function(n,h){this.parent=n;return this._updateParentMatrix(h)},_updateParentMatrix:function(n){this.parentMatrix=n?e.clone(n):null;return this._applyTransform()},_getRealMatrix:function(){for(var n=this.matrix,h=this.parent;h;)h.matrix&&(n=e.multiply(h.matrix,n)),h=h.parent;return n}});m._eventsProcessing={on:function(n,h){return N(this.getEventSource(),n,m.fixCallback(this,V.fixTarget,h))},connect:function(n,h,x){"on"==n.substring(0,2)&&(n=n.substring(2));return this.on(n,x?W.hitch(h,
x):h)},disconnect:function(n){return n.remove()}};m.fixCallback=function(n,h,x,F){F||(F=x,x=null);if(W.isString(F)){x=x||O.global;if(!x[F])throw['dojox.gfx.shape.fixCallback: scope["',F,'"] is null (scope\x3d"',x,'")'].join("");return function(H){return h(H,n)?x[F].apply(x,arguments||[]):void 0}}return x?function(H){return h(H,n)?F.apply(x,arguments||[]):void 0}:function(H){return h(H,n)?F.apply(x,arguments):void 0}};W.extend(m.Shape,m._eventsProcessing);m.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(n){var h=n.getParent();h&&h.remove(n,!0);this.children.push(n);return n._setParent(this,this._getRealMatrix())},remove:function(n,h){for(var x=0;x<this.children.length;++x)if(this.children[x]==n){h||(n.parent=null,n.parentMatrix=null);l(this.children,x);break}return this},clear:function(n){for(var h,x=0;x<this.children.length;++x)h=this.children[x],h.parent=null,h.parentMatrix=null,n&&h.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var n=null;y.forEach(this.children,function(h){var x=h.getBoundingBox();x&&((h=h.getTransform())&&(x=e.multiplyRectangle(h,x)),n?(n.x=Math.min(n.x,x.x),n.y=Math.min(n.y,x.y),n.endX=Math.max(n.endX,x.x+x.width),n.endY=Math.max(n.endY,x.y+x.height)):n={x:x.x,y:x.y,endX:x.x+x.width,endY:x.y+x.height})});n&&(n.width=n.endX-n.x,n.height=n.endY-n.y);return n}return null},_moveChildToFront:function(n){for(var h=0;h<this.children.length;++h)if(this.children[h]==
n){l(this.children,h);this.children.push(n);break}return this},_moveChildToBack:function(n){for(var h=0;h<this.children.length;++h)if(this.children[h]==n){l(this.children,h);this.children.unshift(n);break}return this}};m.Surface=u("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){y.forEach(this._nodes,r.destroy);this._nodes=[];y.forEach(this._events,function(n){n&&n.remove()});this._events=[];this.rawNode=null;
if(X("ie"))for(;this._parent.lastChild;)r.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(n){},whenLoaded:function(n,h){var x=W.hitch(n,h);if(this.isLoaded)x(this);else N.once(this,"load",function(F){x(F)})}});W.extend(m.Surface,m._eventsProcessing);m.Rect=u("dojox.gfx.shape.Rect",m.Shape,{constructor:function(n){this.shape=V.getDefault("Rect");this.rawNode=
n},getBoundingBox:function(){return this.shape}});m.Ellipse=u("dojox.gfx.shape.Ellipse",m.Shape,{constructor:function(n){this.shape=V.getDefault("Ellipse");this.rawNode=n},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.rx,y:n.cy-n.ry,width:2*n.rx,height:2*n.ry}}return this.bbox}});m.Circle=u("dojox.gfx.shape.Circle",m.Shape,{constructor:function(n){this.shape=V.getDefault("Circle");this.rawNode=n},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-
n.r,y:n.cy-n.r,width:2*n.r,height:2*n.r}}return this.bbox}});m.Line=u("dojox.gfx.shape.Line",m.Shape,{constructor:function(n){this.shape=V.getDefault("Line");this.rawNode=n},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:Math.min(n.x1,n.x2),y:Math.min(n.y1,n.y2),width:Math.abs(n.x2-n.x1),height:Math.abs(n.y2-n.y1)}}return this.bbox}});m.Polyline=u("dojox.gfx.shape.Polyline",m.Shape,{constructor:function(n){this.shape=V.getDefault("Polyline");this.rawNode=n},setShape:function(n,
h){n&&n instanceof Array?(this.inherited(arguments,[{points:n}]),h&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[n]);return this},_normalizePoints:function(){var n=this.shape.points,h=n&&n.length;if(h&&"number"==typeof n[0]){for(var x=[],F=0;F<h;F+=2)x.push({x:n[F],y:n[F+1]});this.shape.points=x}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var n=this.shape.points,h=n.length,x=n[0],F=x.x,H=x.y,w=x.x,G=x.y,Q=1;Q<h;++Q)x=
n[Q],F>x.x&&(F=x.x),w<x.x&&(w=x.x),H>x.y&&(H=x.y),G<x.y&&(G=x.y);this.bbox={x:F,y:H,width:w-F,height:G-H}}return this.bbox}});m.Image=u("dojox.gfx.shape.Image",m.Shape,{constructor:function(n){this.shape=V.getDefault("Image");this.rawNode=n},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});m.Text=u(m.Shape,{constructor:function(n){this.fontStyle=null;this.shape=V.getDefault("Text");this.rawNode=n},getFont:function(){return this.fontStyle},
setFont:function(n){this.fontStyle="string"==typeof n?V.splitFontString(n):V.makeParameters(V.defaultFont,n);this._setFont();return this},getBoundingBox:function(){var n=null;this.getShape().text&&(n=V._base._computeTextBoundingBox(this));return n}});m.Creator={createShape:function(n){switch(n.type){case V.defaultPath.type:return this.createPath(n);case V.defaultRect.type:return this.createRect(n);case V.defaultCircle.type:return this.createCircle(n);case V.defaultEllipse.type:return this.createEllipse(n);
case V.defaultLine.type:return this.createLine(n);case V.defaultPolyline.type:return this.createPolyline(n);case V.defaultImage.type:return this.createImage(n);case V.defaultText.type:return this.createText(n);case V.defaultTextPath.type:return this.createTextPath(n)}return null},createGroup:function(){return this.createObject(V.Group)},createRect:function(n){return this.createObject(V.Rect,n)},createEllipse:function(n){return this.createObject(V.Ellipse,n)},createCircle:function(n){return this.createObject(V.Circle,
n)},createLine:function(n){return this.createObject(V.Line,n)},createPolyline:function(n){return this.createObject(V.Polyline,n)},createImage:function(n){return this.createObject(V.Image,n)},createText:function(n){return this.createObject(V.Text,n)},createPath:function(n){return this.createObject(V.Path,n)},createTextPath:function(n){return this.createObject(V.TextPath,{}).setText(n)},createObject:function(n,h){return null}};return m})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(V,W,u,O,X){X=u("dojox.gfx.path.Path",X.Shape,{constructor:function(N){this.shape=W.clone(V.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=N;this.segmented=!1},setAbsoluteMode:function(N){this._confirmSegmented();this.absolute="string"==typeof N?"absolute"==N:N;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var N=this.bbox,y=this._getRealMatrix();this.bbox=null;for(var r=0,d=this.segments.length;r<d;++r)this._updateWithSegment(this.segments[r],y);y=this.bbox;this.bbox=N;return this.tbbox=y?[{x:y.l,y:y.t},{x:y.r,y:y.t},{x:y.r,y:y.b},{x:y.l,y:y.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(N,y,r){r&&(y=O.multiplyPoint(r,N,y),N=y.x,y=y.y);this.bbox&&"l"in this.bbox?(this.bbox.l>N&&(this.bbox.l=N),this.bbox.r<N&&(this.bbox.r=N),this.bbox.t>y&&(this.bbox.t=y),this.bbox.b<y&&(this.bbox.b=y)):this.bbox={l:N,b:y,r:N,t:y}},_updateWithSegment:function(N,y){var r=N.args,d=r.length,e;switch(N.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(e=0;e<d;e+=2)this._updateBBox(r[e],
r[e+1],y);this.last.x=r[d-2];this.last.y=r[d-1];this.absolute=!0;break;case "H":for(e=0;e<d;++e)this._updateBBox(r[e],this.last.y,y);this.last.x=r[d-1];this.absolute=!0;break;case "V":for(e=0;e<d;++e)this._updateBBox(this.last.x,r[e],y);this.last.y=r[d-1];this.absolute=!0;break;case "m":e=0;"x"in this.last||(this._updateBBox(this.last.x=r[0],this.last.y=r[1],y),e=2);for(;e<d;e+=2)this._updateBBox(this.last.x+=r[e],this.last.y+=r[e+1],y);this.absolute=!1;break;case "l":case "t":for(e=0;e<d;e+=2)this._updateBBox(this.last.x+=
r[e],this.last.y+=r[e+1],y);this.absolute=!1;break;case "h":for(e=0;e<d;++e)this._updateBBox(this.last.x+=r[e],this.last.y,y);this.absolute=!1;break;case "v":for(e=0;e<d;++e)this._updateBBox(this.last.x,this.last.y+=r[e],y);this.absolute=!1;break;case "c":for(e=0;e<d;e+=6)this._updateBBox(this.last.x+r[e],this.last.y+r[e+1],y),this._updateBBox(this.last.x+r[e+2],this.last.y+r[e+3],y),this._updateBBox(this.last.x+=r[e+4],this.last.y+=r[e+5],y);this.absolute=!1;break;case "s":case "q":for(e=0;e<d;e+=
4)this._updateBBox(this.last.x+r[e],this.last.y+r[e+1],y),this._updateBBox(this.last.x+=r[e+2],this.last.y+=r[e+3],y);this.absolute=!1;break;case "A":for(e=0;e<d;e+=7)this._updateBBox(r[e+5],r[e+6],y);this.last.x=r[d-2];this.last.y=r[d-1];this.absolute=!0;break;case "a":for(e=0;e<d;e+=7)this._updateBBox(this.last.x+=r[e+5],this.last.y+=r[e+6],y);this.absolute=!1}N=[N.action];for(e=0;e<d;++e)N.push(V.formatNumber(r[e],!0));if("string"==typeof this.shape.path)this.shape.path+=N.join("");else for(e=
0,d=N.length;e<d;++e)this.shape.path.push(N[e])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(N,y){this.tbbox=null;var r=this._validSegments[N.toLowerCase()];"number"==typeof r&&(r?y.length>=r&&(N={action:N,args:y.slice(0,y.length-y.length%r)},this.segments.push(N),this._updateWithSegment(N)):(N={action:N,args:[]},this.segments.push(N),this._updateWithSegment(N)))},_collectArgs:function(N,y){for(var r=0;r<y.length;++r){var d=y[r];"boolean"==typeof d?N.push(d?1:0):
"number"==typeof d?N.push(d):d instanceof Array?this._collectArgs(N,d):"x"in d&&"y"in d&&N.push(d.x,d.y)}},moveTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"M":"m",N);return this},lineTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"L":"l",N);return this},hLineTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?
"H":"h",N);return this},vLineTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"V":"v",N);return this},curveTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"C":"c",N);return this},smoothCurveTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"S":"s",N);return this},qCurveTo:function(){this._confirmSegmented();var N=
[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"Q":"q",N);return this},qSmoothCurveTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"T":"t",N);return this},arcTo:function(){this._confirmSegmented();var N=[];this._collectArgs(N,arguments);this._pushSegment(this.absolute?"A":"a",N);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var N=
this.shape.path;this.shape.path=[];this._setPath(N);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(N){N=W.isArray(N)?N:N.match(V.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(N){for(var y="",r=[],d=N.length,e=0;e<d;++e){var l=N[e],m=parseFloat(l);isNaN(m)?(y&&this._pushSegment(y,r),r=[],y=l):r.push(m)}this._pushSegment(y,r)}},setShape:function(N){this.inherited(arguments,["string"==typeof N?{path:N}:N]);this.segmented=!1;this.segments=
[];V.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});u=u("dojox.gfx.path.TextPath",X,{constructor:function(N){"text"in this||(this.text=W.clone(V.defaultTextPath));"fontStyle"in this||(this.fontStyle=W.clone(V.defaultFont))},getText:function(){return this.text},setText:function(N){this.text=V.makeParameters(this.text,"string"==typeof N?{text:N}:N);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(N){this.fontStyle="string"==typeof N?
V.splitFontString(N):V.makeParameters(V.defaultFont,N);this._setFont();return this}});return V.path={Path:X,TextPath:u}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(V,W,u){function O(e){var l=Math.cos(e);e=Math.sin(e);var m={x:l+4/3*(1-l),y:e-4/3*l*(1-l)/e};return{s:{x:l,y:-e},c1:{x:m.x,y:-m.y},c2:m,e:{x:l,y:e}}}var X=2*Math.PI,N=Math.PI/4,y=Math.PI/8,r=N+y,d=O(y);return V.arc={unitArcAsBezier:O,curvePI4:d,arcAsBezier:function(e,l,m,n,h,x,F,H){h=!!h;x=!!x;
var w=u._degToRad(n);n=l*l;var G=m*m,Q=u.multiplyPoint(u.rotate(-w),{x:(e.x-F)/2,y:(e.y-H)/2}),S=Q.x*Q.x,M=Q.y*Q.y;n=Math.sqrt((n*G-n*M-G*S)/(n*M+G*S));isNaN(n)&&(n=0);n={x:n*l*Q.y/m,y:-n*m*Q.x/l};h==x&&(n={x:-n.x,y:-n.y});n=u.multiplyPoint([u.translate((e.x+F)/2,(e.y+H)/2),u.rotate(w)],n);l=u.normalize([u.translate(n.x,n.y),u.rotate(w),u.scale(l,m)]);n=u.invert(l);e=u.multiplyPoint(n,e);H=u.multiplyPoint(n,F,H);F=Math.atan2(e.y,e.x);n=F-Math.atan2(H.y,H.x);x&&(n=-n);0>n?n+=X:n>X&&(n-=X);m=y;H=d;
m=x?m:-m;e=[];for(h=n;0<h;h-=N)h<r&&(m=h/2,H=O(m),m=x?m:-m,h=0),Q=u.normalize([l,u.rotate(F+m)]),x?(n=u.multiplyPoint(Q,H.c1),w=u.multiplyPoint(Q,H.c2),Q=u.multiplyPoint(Q,H.e)):(n=u.multiplyPoint(Q,H.c2),w=u.multiplyPoint(Q,H.c1),Q=u.multiplyPoint(Q,H.s)),e.push([n.x,n.y,w.x,w.y,Q.x,Q.y]),F+=2*m;return e}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(V,W,u){function O(d,e){return Math.abs(d-e)<=1E-6*(Math.abs(d)+Math.abs(e))}function X(d,e,l,m){if(!isFinite(d))return l;
if(!isFinite(l))return d;e=Math.abs(e);m=Math.abs(m);return(e*d+m*l)/(e+m)}function N(d){d=u.normalize(d);var e=-d.xx-d.yy,l=d.xx*d.yy-d.xy*d.yx,m=Math.sqrt(e*e-4*l);e=-(e+(0>e?-m:m))/2;l/=e;m=d.xy/(e-d.xx);var n=1,h=d.xy/(l-d.xx),x=1;O(e,l)&&(m=1,h=n=0,x=1);isFinite(m)||(m=1,n=(e-d.xx)/d.xy,isFinite(n)||(m=(e-d.yy)/d.yx,n=1,isFinite(m)||(m=1,n=d.yx/(e-d.yy))));isFinite(h)||(h=1,x=(l-d.xx)/d.xy,isFinite(x)||(h=(l-d.yy)/d.yx,x=1,isFinite(h)||(h=1,x=d.yx/(l-d.yy))));d=Math.sqrt(m*m+n*n);var F=Math.sqrt(h*
h+x*x);isFinite(m/=d)||(m=0);isFinite(n/=d)||(n=0);isFinite(h/=F)||(h=0);isFinite(x/=F)||(x=0);return{value1:e,value2:l,vector1:{x:m,y:n},vector2:{x:h,y:x}}}function y(d,e){var l=0>d.xx*d.yy||0<d.xy*d.yx?-1:1,m=e.angle1=(Math.atan2(d.yx,d.yy)+Math.atan2(-l*d.xy,l*d.xx))/2;l=Math.cos(m);m=Math.sin(m);e.sx=X(d.xx/l,l,-d.xy/m,m);e.sy=X(d.yy/l,l,d.yx/m,m);return e}function r(d,e){var l=0>d.xx*d.yy||0<d.xy*d.yx?-1:1,m=e.angle2=(Math.atan2(l*d.yx,l*d.xx)+Math.atan2(-d.xy,d.yy))/2;l=Math.cos(m);m=Math.sin(m);
e.sx=X(d.xx/l,l,d.yx/m,m);e.sy=X(d.yy/l,l,-d.xy/m,m);return e}return V.decompose=function(d){var e=u.normalize(d);d={dx:e.dx,dy:e.dy,sx:1,sy:1,angle1:0,angle2:0};if(O(e.xy,0)&&O(e.yx,0))return W.mixin(d,{sx:e.xx,sy:e.yy});if(O(e.xx*e.yx,-e.xy*e.yy))return y(e,d);if(O(e.xx*e.xy,-e.yx*e.yy))return r(e,d);var l=new u.Matrix2D(e);var m=W.mixin(l,{dx:0,dy:0,xy:l.yx,yx:l.xy});l=N([e,m]);m=N([m,e]);l=new u.Matrix2D({xx:l.vector1.x,xy:l.vector2.x,yx:l.vector1.y,yy:l.vector2.y});m=new u.Matrix2D({xx:m.vector1.x,
xy:m.vector1.y,yx:m.vector2.x,yy:m.vector2.y});e=new u.Matrix2D([u.invert(l),e,u.invert(m)]);y(m,d);e.xx*=d.sx;e.yy*=d.sy;r(l,d);e.xx*=d.sx;e.yy*=d.sy;return W.mixin(d,{sx:e.xx,sy:e.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(V){V=V.bezierutils={};V.tAtLength=function(y,r){var d=0,e=6==y.length,l=0,m=0,n=e?O:N,h=function(x,F){for(var H=0,w=0;w<x.length-2;w+=2)H+=u(x[w],x[w+1],x[w+2],x[w+3]);w=e?u(y[0],y[1],y[4],y[5]):u(y[0],y[1],y[6],y[7]);H-w>F||l+H>r+F?(++m,x=n(x,.5),
h(x[0],F),Math.abs(l-r)<=F||h(x[1],F)):(l+=H,d+=1/(1<<m))};r&&h(y,.5);return d};var W=V.computeLength=function(y){for(var r=6==y.length,d=0,e=0;e<y.length-2;e+=2)d+=u(y[e],y[e+1],y[e+2],y[e+3]);e=r?u(y[0],y[1],y[4],y[5]):u(y[0],y[1],y[6],y[7]);return.1<d-e?(y=r?O(y,.5):X(y,.5),d=W(y[0],r),d+=W(y[1],r)):d},u=V.distance=function(y,r,d,e){return Math.sqrt((d-y)*(d-y)+(e-r)*(e-r))},O=function(y,r){var d=1-r,e=d*d,l=r*r,m=y[0],n=y[1],h=y[2],x=y[3],F=y[4];y=y[5];var H=e*m+2*d*r*h+l*F;e=e*n+2*d*r*x+l*y;
return[[m,n,d*m+r*h,d*n+r*x,H,e],[H,e,d*h+r*F,d*x+r*y,F,y]]},X=function(y,r){var d=1-r,e=d*d,l=e*d,m=r*r,n=m*r,h=y[0],x=y[1],F=y[2],H=y[3],w=y[4],G=y[5],Q=y[6];y=y[7];var S=l*h+3*e*r*F+3*d*m*w+n*Q;l=l*x+3*e*r*H+3*d*m*G+n*y;return[[h,x,d*h+r*F,d*x+r*H,e*h+2*d*r*F+m*w,e*x+2*d*r*H+m*G,S,l],[S,l,e*F+2*d*r*w+m*Q,e*H+2*d*r*G+m*y,d*w+r*Q,d*G+r*y,Q,y]]},N=V.splitBezierAtT=function(y,r){return 6==y.length?O(y,r):X(y,r)};return V})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(V,W,u){W.getObject("json",!0,u);u.json._slice=function(O,X,N,y){var r=O.length,d=[];N=N||r;X=0>X?Math.max(0,X+r):Math.min(r,X);for(N=0>N?Math.max(0,N+r):Math.min(r,N);X<N;X+=y)d.push(O[X]);return d};u.json._find=function(O,X){function N(d){X&&(!0!==X||d instanceof Array?d[X]&&y.push(d[X]):y.push(d));for(var e in d){var l=d[e];X?l&&"object"==typeof l&&N(l):y.push(l)}}var y=[];if(X instanceof Array){if(1==X.length)return O[X[0]];for(var r=0;r<X.length;r++)y.push(O[X[r]])}else N(O);
return y};u.json._distinctFilter=function(O,X){for(var N=[],y={},r=0,d=O.length;r<d;++r){var e=O[r];X(e,r,O)&&("object"==typeof e&&e?e.__included||(e.__included=!0,N.push(e)):y[e+typeof e]||(y[e+typeof e]=!0,N.push(e)))}r=0;for(d=N.length;r<d;++r)N[r]&&delete N[r].__included;return N};return u.json.query=function(O,X){function N(m,n,h,x,F,H,w,G){return r[G].match(/[\*\?]/)||"~"==w?"/^"+r[G].substring(1,r[G].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==w?"$/i":"$/")+".test("+n+")":m}var y=0,r=[];O=O.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(m){y+="["==m?1:"]"==m?-1:0;return"]"==m&&0<y?"`]":'"'==m.charAt(0)||"'"==m.charAt(0)?"`"+(r.push(m)-1):m});var d="";O.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});O=O.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(m){return"."==m.charAt(0)?m:"@"==m?"$obj":(m.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+m}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(m,n,h){return(n=m.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(h="",m.match(/^\./)&&(d="dojox.json._find("+d,h=",true)"),d=(n[1].match(/=/)?"dojo.map":n[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+d,h+",function($obj){return "+n[2]+"})"):(n=m.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+n[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(x,F,H){return"var av\x3d "+H.replace(/\$obj/,
"a")+",bv\x3d "+H.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==F?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==F?-1:1)+";}\n"})+"return 0;})":(n=m.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(d="dojox.json._slice("+d,","+(n[1]||0)+","+(n[2]||0)+","+(n[3]||1)+")"):m.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(d="dojox.json._find("+d,("."==m.charAt(1)?",'"+h+"'":m.match(/,/)?","+m:"")+")"):m}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
N).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(m,n,h,x,F,H,w,G){return N(m,x,F,H,w,G,h,n)});O=d+("$"==O.charAt(0)?"":"$")+O.replace(/`([0-9]+|\])/g,function(m,n){return"]"==n?"]":r[n]});for(var e=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+O+"}"),l=0;l<arguments.length-1;l++)arguments[l]=arguments[l+1];return X?e.apply(this,arguments):e}})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(V,W,u,O){V=V(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});u("extend-esri")&&W.setObject("tasks.PrintParameters",V,O);return V})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S){var M=W(n,{declaredClass:"esri.toolbars.Edit",constructor:function(R,C){this._map=R;this._tool=0;if(this._map.loaded)this._scratchGL=R.graphics;else var a=O.connect(this._map,"onLoad",this,function(){O.disconnect(a);a=null;this._scratchGL=this._map.graphics});R=y("esri-mobile");this._defaultOptions=u.mixin({vertexSymbol:new w(w.STYLE_CIRCLE,R?20:12,new G(G.STYLE_SOLID,new N([0,0,0,.5]),1),new N([128,128,128])),ghostVertexSymbol:new w(w.STYLE_CIRCLE,
R?18:10,new G(G.STYLE_SOLID,new N([0,0,0,.5]),1),new N([255,255,255,.75])),ghostLineSymbol:new G(G.STYLE_DOT,new N([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:R?24:16,boxLineSymbol:new G(G.STYLE_DASH,new N([64,64,64]),1),boxHandleSymbol:new w(w.STYLE_SQUARE,R?16:9,new G(G.STYLE_SOLID,new N([0,0,0,.5]),1),new N([255,255,255,.75])),textAnchorSymbol:new w(w.STYLE_CIRCLE,10,null,new N([255,0,0]))},C||{})},activate:function(R,C,a){this.deactivate();this._graphic=C;this._options=
u.mixin(u.mixin({},this._defaultOptions),a||{});var B=M.MOVE;a=M.EDIT_VERTICES;var fa=M.SCALE,ka=M.ROTATE,la=M.EDIT_TEXT,oa=!1,P=!1,na=!1,ma=this._map,J=ma.spatialReference,z=C.geometry.spatialReference;this._geo=!(!J||!z||J.equals(z)||!J.isWebMercator()||4326!==z.wkid);this._isTextPoint=this._prepareTextSymbolEditing(C,R);(R&B)===B&&(oa=this._enableMove(C));B=(R&fa)===fa;ka=(R&ka)===ka;if(B||ka)na=this._enableBoxEditing(C,B,ka);(R&a)===a&&(P=this._enableVertexEditing(C));(R&la)===la&&this._enableTextEditing(C);
if(!(oa||P||na))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=R)this._mapPanEndHandle=O.connect(ma,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=O.connect(ma,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,C);ma.snappingManager&&(oa||P)&&ma.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var R=this._tool,C=this._graphic;
if(R){var a=!!this._modified;this._clear();O.disconnect(this._mapPanEndHandle);O.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(R,C,{isModified:a});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(R,C){},onDeactivate:function(R,
C,a){},onGraphicMoveStart:function(R){},onGraphicFirstMove:function(R){this._modified=!0},onGraphicMove:function(R,C){},onGraphicMoveStop:function(R,C){},onGraphicClick:function(R,C){},onVertexMoveStart:function(R,C){},onVertexFirstMove:function(R,C){this._modified=!0},onVertexMove:function(R,C,a){},onVertexMoveStop:function(R,C,a){},onVertexAdd:function(R,C){this._modified=!0},onVertexClick:function(R,C){},onVertexMouseOver:function(R,C){},onVertexMouseOut:function(R,C){},onVertexDelete:function(R,
C){this._modified=!0},onTextEditStart:function(R,C){},onTextEditEnd:function(R){},onScaleStart:function(R){},onScaleFirstMove:function(R){this._modified=!0},onScale:function(R,C){},onScaleStop:function(R,C){},onRotateStart:function(R){},onRotateFirstMove:function(R){this._modified=!0},onRotate:function(R,C){},onRotateStop:function(R,C){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(R,C){if("point"===R.geometry.type||"multipoint"===R.geometry.type){var a=R.getLayer(),B=a.renderer;a=R.symbol||a._getSymbol(R);!a&&(B.hasVisualVariables("sizeInfo",!1)||B.hasVisualVariables("colorInfo",!1)||B.hasVisualVariables("opacityInfo",!1))&&B.addBreak&&
B.infos&&1===B.infos.length&&(a=B.infos[0].symbol||B.defaultSymbol);if(a&&"textsymbol"===a.type){if((C&M.SCALE)===M.SCALE||(C&M.ROTATE)===M.ROTATE||(C&M.EDIT_TEXT)===M.EDIT_TEXT){R.setSymbol(new Q(a.toJson()));var fa=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(R),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){fa._boxEditor&&fa._boxEditor.refresh()})):
V(["../dijit/SymbolEditor"],function(ka){if(!fa._textSymbolEditor){var la=fa._options.textSymbolEditorHolder?r.create("div",null,fa._options.textSymbolEditorHolder):r.create("div",null,fa._map.root);fa._textSymbolEditor=new ka({graphic:R},la);ka=fa._textSymbolEditor.domNode.parentNode.id;d.set(fa._textSymbolEditor.domNode,{position:"map_root"===ka?"absolute":"relative",left:"map_root"===ka?fa._map.width/2-100+"px":"5px",top:"20px","z-index":50});fa._textSymbolEditor.startup();fa._textSymbolEditor.createForm(R);
fa._textSymbolEditor.show();fa._textSymbolEditor.on("symbol-change",function(){fa._boxEditor&&fa._boxEditor.refresh()})}})}if((C&M.MOVE)===M.MOVE||(C&M.ROTATE)===M.ROTATE||(C&M.SCALE)===M.SCALE)this._textAnchor=new S(R.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(R){var C=this._map;switch(R.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new x(R,C,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(R){var C=
this._map;switch(R.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=F.create(R,C,this),!0}return!1},_enableBoxEditing:function(R,C,a){var B=this._map,fa=R.geometry.type;return"polyline"===fa||"polygon"===fa||this._isTextPoint?(this._boxEditor=new h(R,B,this,C,a,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(R){return this._isTextPoint?(this._textEditor=new H(R,this._map,this),O.connect(this._textEditor,"onEditStart",u.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var R=this._graphicMover;R&&(R.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var R=this._vertexEditor;R&&(R.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var R=this._boxEditor;R&&(R.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(R,C,a){a&&this._refreshMoveables()},_refreshMoveables:function(R){var C=X.filter([this._graphicMover,this._vertexEditor,this._boxEditor],l.isDefined);X.forEach(C,function(a){a.refresh(R)})},_beginOperation:function(R){X.forEach(this._getAffectedTools(R),function(C){C.suspend()})},_endOperation:function(R){X.forEach(this._getAffectedTools(R),function(C){C.resume()})},_getAffectedTools:function(R){var C=[];switch(R){case "MOVE":C=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":C=[this._boxEditor];break;case "BOX":C=[this._vertexEditor]}return C=X.filter(C,l.isDefined)}});u.mixin(M,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});y("extend-esri")&&u.setObject("toolbars.Edit",M,e);return M})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H){V=V(null,{declaredClass:"esri.toolbars._Box",constructor:function(w,G,Q,S,M,R,C){this._graphic=w;this._map=G;this._toolbar=Q;this._scale=S;this._rotate=M;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=R;w=Q._options;this._markerSymbol=w.boxHandleSymbol;this._lineSymbol=w.boxLineSymbol;this._moveStartHandler=W.hitch(this,this._moveStartHandler);this._firstMoveHandler=W.hitch(this,this._firstMoveHandler);
this._moveStopHandler=W.hitch(this,this._moveStopHandler);this._moveHandler=W.hitch(this,this._moveHandler);this._isTextPoint=C;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){u.forEach(this._getAllGraphics(),function(w){w.hide()})},resume:function(){u.forEach(this._getAllGraphics(),function(w){w.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
u.forEach(this._connects,O.disconnect);var w=this._toolbar._scratchGL;this._anchors&&u.forEach(this._anchors,function(G){w.remove(G.graphic);(G=G.moveable)&&G.destroy()});this._box&&w.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var w=this._map,G=this._toolbar._scratchGL,Q=this._getBoxCoords(),S=new n(w.spatialReference),M=W.clone(u.filter(Q,function(R,C){return 8!==C&&0===C%2}));M[0]&&M.push([M[0][0],M[0][1]]);S.addPath(M);this._rotate&&
S.addPath([Q[1],Q[8]]);this._box?this._box.setGeometry(S):(this._box=new H(S,this._lineSymbol),G.add(this._box));this._anchors?u.forEach(this._anchors,function(R,C){this._scale||(C=8);var a=new m(Q[C],w.spatialReference);R.graphic.setGeometry(a);a=R.moveable;var B=R.graphic.getDojoShape();B&&(a?B!==a.shape&&(a.destroy(),R.moveable=this._getMoveable(R.graphic,C)):R.moveable=this._getMoveable(R.graphic,C))},this):(this._anchors=[],this._connects=[],u.forEach(Q,function(R,C){!this._scale&&8>C||(R=new m(R,
w.spatialReference),R=new H(R,this._markerSymbol),this._isTextPoint&&1===C%2&&R.hide(),G.add(R),this._anchors.push({graphic:R,moveable:this._getMoveable(R,C)}))},this))}else this._cleanUp()},_getBoxCoords:function(w){var G=this._map,Q=[],S,M,R;if(this._isTextPoint){var C=this._graphic.getNode().getBoundingClientRect();var a=G.__container.getBoundingClientRect();C=[{x:C.left-a.left,y:C.top-a.top},{x:C.right-a.left,y:C.top-a.top},{x:C.right-a.left,y:C.bottom-a.top},{x:C.left-a.left,y:C.bottom-a.top}]}else C=
this._getTransformedBoundingBox(this._graphic);u.forEach(C,function(B,fa,ka){S=B;(M=ka[fa+1])||(M=ka[0]);R={x:(S.x+M.x)/2,y:(S.y+M.y)/2};w||(S=G.toMap(S),R=G.toMap(R));Q.push([S.x,S.y]);Q.push([R.x,R.y])});this._rotate&&(C=W.clone(Q[1]),C=w?{x:C[0],y:C[1]}:G.toScreen({x:C[0],y:C[1],spatialReference:G.spatialReference}),C.y-=this._toolbar._options.rotateHandleOffset,w||(C=G.toMap(C)),Q.push([C.x,C.y]));return Q},_getTransformedBoundingBox:function(w){var G=this._map,Q=w.geometry.getExtent(),S=w.geometry.spatialReference;
w=new m(Q.xmin,Q.ymax,S);Q=new m(Q.xmax,Q.ymin,S);w=G.toScreen(w);Q=G.toScreen(Q);return[{x:w.x,y:w.y},{x:Q.x,y:w.y},{x:Q.x,y:Q.y},{x:w.x,y:Q.y}]},_getAllGraphics:function(){var w=[this._box];this._anchors&&u.forEach(this._anchors,function(G){w.push(G.graphic)});return w=u.filter(w,l.isDefined)},_getMoveable:function(w,G){var Q=w.getDojoShape();if(Q)return w=new r(Q),w._index=G,this._connects.push(O.connect(w,"onMoveStart",this._moveStartHandler)),this._connects.push(O.connect(w,"onFirstMove",this._firstMoveHandler)),
this._connects.push(O.connect(w,"onMoveStop",this._moveStopHandler)),w.onMove=this._moveHandler,(Q=Q.getEventSource())&&y.set(Q,"cursor",this._toolbar._cursors["box"+G]),w},_moveStartHandler:function(w){this._toolbar["on"+(8===w.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(w){this._toolbar._deactivateScrollWheel();var G=w.host._index,Q=this._wrapOffset=w.host.shape._wrapOffsets[0]||0,S=this._graphic.getLayer().getNavigationTransform();w=u.map(this._getBoxCoords(!0),
function(R){return{x:R[0]+Q,y:R[1]}});var M=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:w[1].x,y:w[3].y};this._centerCoord=d.multiplyPoint(d.invert(S),M);if(8===G)M=d.multiplyPoint(d.invert(S),w[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,M)),this._startLine=[this._centerCoord,M],this._moveLine=W.clone(this._startLine);else if(M=d.multiplyPoint(d.invert(S),w[G]),S=d.multiplyPoint(d.invert(S),w[(G+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,M)),this._firstMoverToAnchor=Math.sqrt((M.x-this._centerCoord.x)*(M.x-this._centerCoord.x)+(M.y-this._centerCoord.y)*(M.y-this._centerCoord.y)),this._startBox=S,this._startBox.width=w[4].x-w[0].x,this._startBox.height=w[4].y-w[0].y,this._moveBox=W.clone(this._startBox),this._xfactor=M.x>S.x?1:-1,this._yfactor=M.y>S.y?1:-1,1===G||5===G)this._xfactor=0;else if(3===G||7===G)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===G?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(w,G){w=w.host._index;var Q=this._defaultEventArgs;Q.angle=0;Q.scaleX=1;Q.scaleY=1;if(8===w){var S=this._startLine;var M=this._moveLine;var R=M[1];R.x+=G.dx;R.y+=G.dy;G=this._getAngle(S,M);this._isTextPoint&&(G+=this._graphic.symbol.angle);M=d.rotategAt(G,S[0]);this._graphic.getDojoShape().setTransform(M);Q.transform=M;Q.angle=G;Q.around=S[0]}else{S=this._startBox;M=this._moveBox;M.width+=G.dx*this._xfactor;M.height+=G.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(S=M.x+this._xfactor*M.width,M=M.y+this._yfactor*M.height,S=Math.sqrt((S-this._centerCoord.x)*(S-this._centerCoord.x)+(M-this._centerCoord.y)*(M-this._centerCoord.y)),this._scaleRatio=G=R=S/this._firstMoverToAnchor,S=this._centerCoord):(G=M.width/S.width,R=M.height/S.height,S={x:S.x,y:S.y});if(isNaN(G)||Infinity===G||-Infinity===G)G=1;if(isNaN(R)||Infinity===R||-Infinity===R)R=1;M=d.scaleAt(G,R,S);if(this._isTextPoint){var C=d.rotategAt(this._graphic.symbol.angle,
S);this._graphic.getDojoShape().setTransform([C,M])}else this._graphic.getDojoShape().setTransform(M);Q.transform=M;Q.scaleX=G;Q.scaleY=R;Q.around=S}this._toolbar["on"+(8===w?this._rotateEvent:this._scaleEvent)](this._graphic,Q)},_moveStopHandler:function(w){this._toolbar._activateScrollWheel();var G=this._graphic,Q=this._toolbar,S=Q._geo?x.geographicToWebMercator(G.geometry):G.geometry,M=S.spatialReference,R=G.getDojoShape(),C=R.getTransform(),a=G.getLayer().getNavigationTransform();this._isTextPoint?
(G=this._graphic.symbol,8===w.host._index?G.angle+=this._getAngle(this._startLine,this._moveLine):G.font.setSize(Math.round(G.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(G)):(S=S.toJson(),this._updateSegments(S.paths||S.rings,C,a,M),R.setTransform(null),S=F.fromJson(S),G.setGeometry(Q._geo?x.webMercatorToGeographic(S,!0):S));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;Q._endOperation("BOX");this._defaultEventArgs.transform=
C;Q["on"+(8===w.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(w,G,Q,S){var M=this._map,R=this._wrapOffset||0;u.forEach(w,function(C){u.forEach(C,function(a){this._updatePoint(a,S,R,d,M,Q,G)},this)},this)},_updatePoint:function(w,G,Q,S,M,R,C){G=M.toScreen({x:w[0],y:w[1],spatialReference:G},!0);G.x+=Q;G=S.multiplyPoint([R,C,S.invert(R)],G);G.x-=Q;Q=M.toMap(G);w[0]=Q.x;w[1]=Q.y},_getAngle:function(w,G){return 180*Math.atan2(G[0].y-
G[1].y,G[0].x-G[1].x)/Math.PI-180*Math.atan2(w[0].y-w[1].y,w[0].x-w[1].x)/Math.PI},_deNormalizePoint:function(w,G){var Q=this._map._getFrameWidth();if(-1===Q)return w;for(w={x:w.x,y:w.y};Math.abs(w.x-G.x)>=Q;)w.x=w.x<G.x?w.x+Q:w.x-Q;var S=Math.abs(w.x-G.x);Math.abs(w.x-G.x+Q)<S?w.x+=Q:Math.abs(w.x-G.x-Q)<S&&(w.x-=Q);return w}});N("extend-esri")&&W.setObject("toolbars._Box",V,e);return V})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(V,W,u,O,X,N,y,r,d,e){return W("dojox.gfx.Moveable",null,{constructor:function(l,m){this.shape=l;this.delay=m&&0<m.delay?m.delay:0;this.mover=m&&m.mover?m.mover:d;this.leftButtonOnly=m&&m.leftButtonOnly;this.events=[this.shape.on(N.press,V.hitch(this,"onMouseDown"))]},destroy:function(){u.forEach(this.events,function(l){l.remove()});this.events=this.shape=null},onMouseDown:function(l){this.delay?(this.events.push(this.shape.on(N.move,V.hitch(this,"onMouseMove")),this.shape.on(N.release,V.hitch(this,
"onMouseUp"))),this._lastX=l.clientX,this._lastY=l.clientY):this.leftButtonOnly&&!e.isLeft(l)||new this.mover(this.shape,l,this);O.stop(l)},onMouseMove:function(l){var m=l.clientY;if(Math.abs(l.clientX-this._lastX)>this.delay||Math.abs(m-this._lastY)>this.delay)this.onMouseUp(l),new this.mover(this.shape,l,this);O.stop(l)},onMouseUp:function(l){this.events.pop().remove()},onMoveStart:function(l){X.publish("/gfx/move/start",l);y.add(r.body(),"dojoMove")},onMoveStop:function(l){X.publish("/gfx/move/stop",
l);y.remove(r.body(),"dojoMove")},onFirstMove:function(l){},onMove:function(l,m,n){this.onMoving(l,m,n);this.shape.applyLeftTransform(m);this.onMoved(l,m)},onMoving:function(l,m){},onMoved:function(l,m){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(V,W,u,O,X,N){return u("dojox.gfx.Mover",null,{constructor:function(y,r,d){this.shape=y;this.lastX=r.clientX;this.lastY=r.clientY;y=this.host=d;r=
document;d=O(r,X.move,V.hitch(this,"onFirstMove"));this.events=[O(r,X.move,V.hitch(this,"onMouseMove")),O(r,X.release,V.hitch(this,"destroy")),O(r,"dragstart",V.hitch(N,"stop")),O(r,"selectstart",V.hitch(N,"stop")),d];if(y&&y.onMoveStart)y.onMoveStart(this)},onMouseMove:function(y){var r=y.clientX,d=y.clientY;this.host.onMove(this,{dx:r-this.lastX,dy:d-this.lastY},y);this.lastX=r;this.lastY=d;N.stop(y)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){W.forEach(this.events,
function(r){r.remove()});var y=this.host;if(y&&y.onMoveStop)y.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(V,W,u,O,X,N,y,r,d,e,l,m,n,h){var x=V(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(F,H,w,G){this.graphic=F;this.map=H;this.toolbar=w;this.tempPt=G;this._enableGraphicMover();this._moved=!1},refresh:function(F){var H=this.graphic.getDojoShape();!H||!F&&H._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var F=this.graphic,H=F.getDojoShape();H&&(H._hostGraphic=F,this._moveable=new N(H,{mover:x.Mover}),this._moveStartHandle=
u.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=u.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=u.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=u.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(F=H.getEventSource())&&X.set(F,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var F=this._moveable;if(F){u.disconnect(this._moveStartHandle);u.disconnect(this._firstMoveHandle);
u.disconnect(this._movingHandle);u.disconnect(this._moveStopHandle);var H=F.shape;H&&(H._hostGraphic=null,(H=H.getEventSource())&&X.set(H,"cursor","inherit"));F.destroy()}this._moveable=null},_moveStartHandler:function(){var F=this.graphic,H=this.map;this._startTx=F.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&H.snappingManager&&H.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(F)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(F,H,w){F=F.shape.getTransform();H=this.map;var G;l("esri-pointer")?G=H.navigationManager.pointerEvents._processTouchEvent(w,w):w&&"pointermove"===w.type&&(G=e.prototype._processTouchEvent.call({map:H},w,w));G&&H.snappingManager&&H.snappingManager._onSnappingMouseMoveHandler(G);this.tempPt&&this.tempPt.getDojoShape().setTransform(F);this.toolbar.onGraphicMove(this.graphic,F)},_moveStopHandler:function(F){var H=this.graphic,w=this.toolbar,G=this.map,Q=w._geo?m.geographicToWebMercator(H.geometry):
H.geometry,S=Q.type,M=H.getDojoShape(),R=M.getTransform();if(O.toJson(R)!==O.toJson(this._startTx)){this._moved=!0;switch(S){case "point":S=[R,r.invert(this._startTx)];if(G.snappingManager)var C=G.snappingManager._snappingPoint;Q=C||G.toMap(r.multiplyPoint(S,G.toScreen(Q,!0)));G.snappingManager&&G.snappingManager._killOffSnapping();break;case "polyline":Q=this._updatePolyGeometry(Q,Q.paths,R);break;case "polygon":Q=this._updatePolyGeometry(Q,Q.rings,R)}M.setTransform(null);H.setGeometry(w._geo?m.webMercatorToGeographic(Q,
!0):Q);this.tempPt&&this.tempPt.setGeometry(new h(H.geometry.toJson()))}else this._moved=!1;w._endOperation("MOVE");w.onGraphicMoveStop(H,R);this._moved||(F=F.__e,G=this.map.position,F=new n(F.pageX-G.x,F.pageY-G.y),w.onGraphicClick(H,{screenPoint:F,mapPoint:this.map.toMap(F)}))},_updatePolyGeometry:function(F,H,w){var G=this.map,Q=F.getPoint(0,0);G=G.toMap(G.toScreen(Q).offset(w.dx,w.dy));w=G.x-Q.x;Q=G.y-Q.y;var S;for(G=0;G<H.length;G++){var M=H[G];for(S=0;S<M.length;S++){var R=F.getPoint(G,S);F.setPoint(G,
S,R.offset(w,Q))}}return F}});x.Mover=V(y,{declaredClass:"esri.toolbars._Mover",constructor:function(F,H,w){this.__e=H}});l("extend-esri")&&(W.setObject("toolbars._GraphicMover",x,d),W.setObject("toolbars._Mover",x.Mover,d));return x})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(V,
W,u,O,X,N,y,r,d,e,l,m){var n=V(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(h,x,F){this.graphic=h;this.map=x;this.toolbar=F;h=F._options;this._symbol1=h.vertexSymbol;this._symbol2=h.ghostVertexSymbol;x=h.ghostLineSymbol;this._lineStroke={style:x.style,width:x.width,color:x.color};this._canDel=h.allowDeleteVertices;this._canAdd=h.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(h){h?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=u.connect(d,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=u.connect(d,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var h=this._getGraphicsLayer();this._mouseOverHandle=u.connect(h,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=u.connect(h,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new N({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),h=this._ctxDelete=new y({label:m.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
u.connect(h,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(h),this._ctxMenu.startup())},_removeControllers:function(){u.disconnect(this._firstMoveHandle);u.disconnect(this._moveStopHandle);u.disconnect(this._mouseOverHandle);u.disconnect(this._mouseOutHandle);u.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(h,x,F){var H,w,G=this.graphic,Q=[];for(H=0;H<h.length;H++){var S=h[H],M=[];for(w=0;w<S.length;w++)M.push(new d(S[w],x,G,H,w,S.length,this,F));Q.push(M)}return Q},_remove:function(h){h&&O.forEach(h,function(x){O.forEach(x,function(F){F.destroy()})})},_refresh:function(h){h&&O.forEach(h,function(x){O.forEach(x,function(F){F.refresh()})})},_isNew:function(h){return-1===O.indexOf(this._vertexMovers[h.segIndex],h)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(h){h=this._selectedMover;this._updateRelatedGraphic(h,h.relatedGraphic,h.graphic.geometry,h.segIndex,h.ptIndex,h.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(h);this._deleteVertex(h);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(h){h=h.graphic;var x=this._findMover(h);x&&(this.toolbar.onVertexMouseOver(this.graphic,x._getInfo()),x._placeholder||(this._selectedMover=x,this._canDel&&this._bindCtxNode(h.getDojoShape().getNode())))},_mouseOutHandler:function(h){if(h=
this._findMover(h.graphic))this.toolbar.onVertexMouseOut(this.graphic,h._getInfo())},_bindCtxNode:function(h){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(h);this._bindNode=h},_unbindCtxNode:function(){var h=this._bindNode;h&&this._ctxMenu.unBindDomNode(h)},_findMover:function(h){var x=[];var F=this._mpVertexMovers;O.forEach(this._vertexMovers,function(w){x=x.concat(w)});F&&O.forEach(F,function(w){x=x.concat(w)});
for(F=0;F<x.length;F++){var H=x[F];if(H.graphic===h)return H}},_firstMoveHandler:function(h){!this._isNew(h)&&this._canAdd&&this._hideRelatedMidpoints(h);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(h,x){var F=this._isNew(h);x&&(x.dx||x.dy)?(this._updateRelatedGraphic(h,h.relatedGraphic,h.graphic.geometry,h.segIndex,h.ptIndex,h.segLength,F),this._canAdd&&(F?this._addMidpoints(h):(this._repositionRelatedMidpoints(h),this._showRelatedMidpoints(h))),this.toolbar._endOperation("VERTICES")):
!F&&this._canAdd&&this._showRelatedMidpoints(h)},_showRelatedMidpoints:function(h){var x=this._getAdjacentMidpoints(h.ptIndex,h.segLength),F=this._mpVertexMovers[h.segIndex];for(h=0;h<x.length;h++){var H=F[x[h]];H.graphic.show();H.refresh()}},_hideRelatedMidpoints:function(h){var x=this._getAdjacentMidpoints(h.ptIndex,h.segLength),F=this._mpVertexMovers[h.segIndex];for(h=0;h<x.length;h++)F[x[h]].graphic.hide()},_repositionRelatedMidpoints:function(h){var x,F=this._getAdjacentMidpoints(h.ptIndex,h.segLength),
H=this._mpVertexMovers[h.segIndex];for(x=0;x<F.length;x++){var w=this._getAdjacentVertices(F[x],h.segLength),G=h.relatedGraphic.geometry.getPoint(h.segIndex,w[0]);w=h.relatedGraphic.geometry.getPoint(h.segIndex,w[1]);G=new e({x:(G.x+w.x)/2,y:(G.y+w.y)/2,spatialReference:G.spatialReference.toJson()});H[F[x]].graphic.setGeometry(G)}},_addMidpoints:function(h){var x=h.segIndex,F=h.ptIndex,H=h.segLength,w=F+1,G,Q=H+1;this._mpVertexMovers[x].splice(F,1);var S=this._vertexMovers[x];for(G=0;G<w;G++)S[G].segLength+=
1;for(G=w;G<S.length;G++)S[G].ptIndex+=1,S[G].segLength+=1;h.ptIndex=w;h.segLength=S.length+1;S.splice(w,0,h);h.graphic.setSymbol(this._symbol1);S=this._mpVertexMovers[x];for(G=0;G<F;G++)S[G].segLength+=1;for(G=F;G<H-1;G++)S[G].ptIndex+=1,S[G].segLength+=1;w=this._getAdjacentVertices(F,Q);x=this._getAdjacentVertices(F+1,Q);H=h.relatedGraphic.geometry.getPoint(h.segIndex,w[0]);G=h.relatedGraphic.geometry.getPoint(h.segIndex,w[1]);w=new e({x:(H.x+G.x)/2,y:(H.y+G.y)/2,spatialReference:H.spatialReference.toJson()});
H=h.relatedGraphic.geometry.getPoint(h.segIndex,x[0]);G=h.relatedGraphic.geometry.getPoint(h.segIndex,x[1]);x=new e({x:(H.x+G.x)/2,y:(H.y+G.y)/2,spatialReference:H.spatialReference.toJson()});H=new d(w,this._symbol2,this.graphic,h.segIndex,F,Q,this,!0);h=new d(x,this._symbol2,this.graphic,h.segIndex,F+1,Q,this,!0);S.splice(F,0,H,h)},_deleteVertex:function(h){var x,F=h.ptIndex,H=this._vertexMovers[h.segIndex];for(x=0;x<F;x++)--H[x].segLength;for(x=F+1;x<H.length;x++){var w=H[x];--w.ptIndex;--w.segLength}H.splice(F,
1);x=h._getInfo();h.destroy();this.toolbar.onVertexDelete(this.graphic,x)}});W.mixin(n,{create:function(h,x,F){switch(h.geometry.type){case "multipoint":return new n.MultipointVertexEditor(h,x,F);case "polyline":return new n.PolylineVertexEditor(h,x,F);case "polygon":return new n.PolygonVertexEditor(h,x,F)}}});n.MultipointVertexEditor=V(n,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=u.connect(d,"onMoveStart",this,this._moveStartHandler);
u.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);u.disconnect(this._moveStartHandle)},_getSegments:function(h){var x=h.points,F=[],H=h.spatialReference;for(h=0;h<x.length;h++){var w=x[h];F.push(new e({x:w[0],y:w[1],spatialReference:H.toJson()}))}return[F]},_getMidpointSegments:function(h){return[]},_getControlPoints:function(h,x,F,H,w){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(h){var x=h.graphic;if(h=this._findMover(h))this.toolbar.onVertexMouseOver(x,
h._getInfo()),this._selectedMover=h,this._canDel&&this._bindCtxNode(h.graphic.getDojoShape().getNode())},_mouseOutHandler:function(h){var x=h.graphic;if(h=this._findMover(h))this.toolbar.onVertexMouseOut(x,h._getInfo())},_findMover:function(h){var x=[].concat(this._vertexMovers[0]),F=h.target;for(h=0;h<x.length;h++){var H=x[h];if(H.graphic.getDojoShape().getNode()===F)return H}},_moveStartHandler:function(h){var x=h.ptIndex,F=h.segLength-1,H=h.relatedGraphic.geometry.points;h=H.splice(x,1);H.push(h[0]);
H=this._vertexMovers[0];for(h=F;h>x;h--)--H[h].ptIndex;h=H.splice(x,1);H.push(h[0]);h[0].ptIndex=F},_moveStopHandler:function(h){this._updateRelatedGraphic(h,h.relatedGraphic,h.graphic.geometry,h.segIndex,h.ptIndex,h.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(h,x,F,H,w,G,Q,S){h=x.geometry;S?h.removePoint(w):h.setPoint(w,F);x.setGeometry(h)},_deleteMidpoints:function(h){}});n.PolylineVertexEditor=V(n,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(h){var x,F,H=h.paths,w=[];for(x=0;x<H.length;x++){var G=H[x],Q=[];for(F=0;F<G.length;F++)Q.push(h.getPoint(x,F));w.push(Q)}return w},_getMidpointSegments:function(h){var x,F,H=h.paths,w=[],G=h.spatialReference;for(x=0;x<H.length;x++){var Q=H[x],S=[];for(F=0;F<Q.length-1;F++){var M=h.getPoint(x,F),R=h.getPoint(x,F+1);M=new e({x:(M.x+R.x)/2,y:(M.y+R.y)/2,spatialReference:G.toJson()});S.push(M)}w.push(S)}return w},_getControlPoints:function(h,x,F,H,w){var G=this.map,Q,S;this._isNew(h)?
(h=H,H+=1,0<=h&&(Q=G.toScreen(x.getPoint(F,h))),H<=w&&(S=G.toScreen(x.getPoint(F,H)))):(h=H-1,H+=1,0<=h&&(Q=G.toScreen(x.getPoint(F,h))),H<w&&(S=G.toScreen(x.getPoint(F,H))));return[Q,S]},_getAdjacentMidpoints:function(h,x){var F=[],H=h-1;0<=H&&F.push(H);h<x-1&&F.push(h);return F},_getAdjacentVertices:function(h,x){return[h,h+1]},_deleteMidpoints:function(h){var x=this._mpVertexMovers[h.segIndex],F=x.length-1,H=this._getAdjacentMidpoints(h.ptIndex,h.segLength).sort(),w,G=H[0];for(w=0;w<G;w++)--x[w].segLength;
for(w=G+1;w<x.length;w++){var Q=x[w];--Q.ptIndex;--Q.segLength}if(1===H.length)x.splice(G,1)[0].destroy();else for(Q=this._getAdjacentVertices(G,F),w=h.relatedGraphic.geometry.getPoint(h.segIndex,Q[0]),Q=h.relatedGraphic.geometry.getPoint(h.segIndex,Q[1]),w=new e({x:(w.x+Q.x)/2,y:(w.y+Q.y)/2,spatialReference:w.spatialReference.toJson()}),h=new d(w,this._symbol2,this.graphic,h.segIndex,G,F,this,!0),x=x.splice(G,H.length,h),w=0;w<x.length;w++)x[w].destroy()},_updateRelatedGraphic:function(h,x,F,H,w,
G,Q,S){h=x.geometry;Q?h.insertPoint(H,w+1,l.fromJson(F.toJson())):S?h.removePoint(H,w):h.setPoint(H,w,l.fromJson(F.toJson()));x.setGeometry(h)}});n.PolygonVertexEditor=V(n,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(h){var x,F,H=h.rings,w=[];for(x=0;x<H.length;x++){var G=H[x],Q=[];for(F=0;F<G.length-1;F++)Q.push(h.getPoint(x,F));w.push(Q)}return w},_getMidpointSegments:function(h){var x,F,H=h.rings,w=[],G=h.spatialReference;for(x=0;x<H.length;x++){var Q=H[x],
S=[];for(F=0;F<Q.length-1;F++){var M=h.getPoint(x,F),R=h.getPoint(x,F+1);M=new e({x:(M.x+R.x)/2,y:(M.y+R.y)/2,spatialReference:G.toJson()});S.push(M)}w.push(S)}return w},_getControlPoints:function(h,x,F,H,w){var G=this.map;this._isNew(h)?h=H:(h=H-1,h=0>h?(w+h)%w:h);H=(H+1)%w;w=G.toScreen(x.getPoint(F,h));x=G.toScreen(x.getPoint(F,H));return[w,x]},_getAdjacentMidpoints:function(h,x){var F=h-1;return[0>F?(x+F)%x:F,h]},_getAdjacentVertices:function(h,x){return[h,(h+1)%x]},_deleteMidpoints:function(h){var x=
h.ptIndex,F=this._mpVertexMovers[h.segIndex],H=F.length-1,w=this._getAdjacentMidpoints(x,h.segLength).sort();var G=w[0];var Q=w[w.length-1];if(0===x){var S=this._getAdjacentVertices(H-1,H);x=h.relatedGraphic.geometry.getPoint(h.segIndex,S[0]);S=h.relatedGraphic.geometry.getPoint(h.segIndex,S[1]);x=new e({x:(x.x+S.x)/2,y:(x.y+S.y)/2,spatialReference:x.spatialReference.toJson()});h=new d(x,this._symbol2,this.graphic,h.segIndex,H-1,H,this,!0);F.splice(Q,1,h)[0].destroy();F.splice(G,1)[0].destroy();for(w=
0;w<F.length-1;w++)G=F[w],--G.ptIndex,--G.segLength}else{S=this._getAdjacentVertices(G,H);x=h.relatedGraphic.geometry.getPoint(h.segIndex,S[0]);S=h.relatedGraphic.geometry.getPoint(h.segIndex,S[1]);x=new e({x:(x.x+S.x)/2,y:(x.y+S.y)/2,spatialReference:x.spatialReference.toJson()});h=new d(x,this._symbol2,this.graphic,h.segIndex,G,H,this,!0);Q=F.splice(G,w.length,h);for(w=0;w<Q.length;w++)Q[w].destroy();for(w=0;w<G;w++)--F[w].segLength;for(w=G+1;w<F.length;w++)G=F[w],--G.ptIndex,--G.segLength}},_updateRelatedGraphic:function(h,
x,F,H,w,G,Q,S){h=x.geometry;Q?h.insertPoint(H,w+1,l.fromJson(F.toJson())):S?(h.removePoint(H,w),0===w&&h.setPoint(H,G-1,l.fromJson(h.getPoint(H,0).toJson()))):(h.setPoint(H,w,l.fromJson(F.toJson())),0===w&&h.setPoint(H,G,l.fromJson(F.toJson())));x.setGeometry(h)}});X("extend-esri")&&(W.setObject("toolbars._GraphicVertexEditor",n,r),W.setObject("toolbars._MultipointVertexEditor",n.MultipointVertexEditor,r),W.setObject("toolbars._PolylineVertexEditor",n.PolylineVertexEditor,r),W.setObject("toolbars._PolygonVertexEditor",
n.PolygonVertexEditor,r));return n})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(V,W,u,O,X,N,y,r,d,e,l,m,n){V=V(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(h,x,F,H,w,G,Q,S){this.point=h;this.symbol=x;this.relatedGraphic=F;this.segIndex=H;this.ptIndex=
w;this.segLength=G;this.editor=Q;this.map=Q.map;this._scratchGL=Q.toolbar._scratchGL;this._placeholder=S||!1;this._type=F.geometry.type;this._init();this._enable()},refresh:function(h){if(h||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var h=new l(this.point.toJson());
h=new m(h,this.symbol);switch(this._type){case "multipoint":h._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(h)}this.graphic=h},_enable:function(){var h=this.graphic.getDojoShape();h&&(h._hasMover=!0,this._moveable=this._getMoveable(h),(h=h.getEventSource())&&X.set(h,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var h=this._moveable;if(h){u.disconnect(this._startHandle);
u.disconnect(this._firstHandle);u.disconnect(this._movingHandle);u.disconnect(this._stopHandle);var x=h.shape;x&&(x=x.getEventSource())&&X.set(x,"cursor","inherit");h.destroy();this._moveable=null}},_needRefresh:function(){var h=this.graphic.getDojoShape(),x=!1;if(h)switch(this._type){case "multipoint":var F=this.relatedGraphic.getDojoShape();F&&(F=F.children[this.ptIndex],h!==F&&(this.graphic._shape=F,x=!0));break;case "polyline":case "polygon":x=!h._hasMover}return x},_getMoveable:function(h){h=
new N(h,O("mac")&&O("ff")&&!e("esri-touch")&&{leftButtonOnly:!0});this._startHandle=u.connect(h,"onMoveStart",this,this._moveStartHandler);this._firstHandle=u.connect(h,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=u.connect(h,"onMoving",this,this._movingHandler);this._stopHandle=u.connect(h,"onMoveStop",this,this._moveStopHandler);return h},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(h){var x=this.map;x.snappingManager&&x.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();h.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(h){var x=h.shape,F=this._getControlEdges(),H=this._scratchGL._div,w,G=[],Q=h.host.shape._wrapOffsets[0]||
0;for(w=0;w<F.length;w++){var S=F[w];S.x1+=Q;S.x2+=Q;G.push([H.createLine({x1:S.x1,y1:S.y1,x2:S.x2,y2:S.y2}).setStroke(this.editor._lineStroke),S.x1,S.y1,S.x2,S.y2])}x._lines=G;h.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(h,x,F){x=this.map;var H;e("esri-pointer")?H=x.navigationManager.pointerEvents._processTouchEvent(F,F):F&&"pointermove"===F.type&&(H=d.prototype._processTouchEvent.call({map:x},
F,F));H&&x.snappingManager&&x.snappingManager._onSnappingMouseMoveHandler(H);F=h.shape;h=F.getTransform();F=F._lines;for(H=0;H<F.length;H++)x=F[H],x[0].setShape({x1:x[1]+h.dx,y1:x[2]+h.dy,x2:x[3],y2:x[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),h)},_moveStopHandler:function(h){h=h.shape;var x=this.editor.toolbar,F=h.getTransform(),H=this.map,w=this.graphic,G=x._geo?n.geographicToWebMercator(w.geometry):w.geometry;x._activateScrollWheel();var Q,S=h._lines;if(S){for(Q=
0;Q<S.length;Q++)S[Q][0].removeShape();h._lines=null}Q=!1;S=!0;var M=this._getInfo();F&&(F.dx||F.dy)?this._placeholder&&(this._placeholder=!1,Q=!0):S=!1;if(H.snappingManager)var R=H.snappingManager._snappingPoint;var C=[F,y.invert(this._startTx)];R=R||H.toMap(y.multiplyPoint(C,H.toScreen(G,!0)));H.snappingManager&&H.snappingManager._killOffSnapping();h.setTransform(null);w.setGeometry(x._geo?n.webMercatorToGeographic(R,!0):R);this.constructor.onMoveStop(this,F);x.onVertexMoveStop(this.relatedGraphic,
M,F);if(!S)x.onVertexClick(this.relatedGraphic,M);if(Q)x.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var h=this.map,x=this.relatedGraphic.geometry,F=this.segIndex,H=this.ptIndex,w=this.segLength,G=this._scratchGL.getNavigationTransform(),Q=G.dx;G=G.dy;var S=h.toScreen(this.graphic.geometry);h=S.x-Q;S=S.y-G;var M=[];x=this.editor._getControlPoints(this,x,F,H,w);x[0]&&M.push({x1:h,y1:S,x2:x[0].x-Q,y2:x[0].y-G});x[1]&&M.push({x1:h,y1:S,x2:x[1].x-Q,y2:x[1].y-G});return M}});
e("extend-esri")&&W.setObject("toolbars.VertexMover",V,r);W.mixin(V,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return V})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(V,W,u,O,X,N,y,r,d,e){V=V(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(l,m,n){this._graphic=l;this._map=m;
this._toolbar=n;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(l){this._editBox?(u.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=u.connect(l.getLayer(),"onDblClick",this,function(m){this._map.navigationManager.setImmediateClick(!1);m.graphic==l&&(O.stop(m),u.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(l))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(u.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(l,m){if(!this._editBox){if(!l.symbol.text){l.symbol.text="Tempt text";l.setSymbol(l.symbol);var n=""}var h=this._createInputTextStyle(l,this._map);""!==n&&(n=m||l.symbol.text);this._editBox=N.create("input",{type:"text",value:n});
r.set(this._editBox,h);y.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=u.connect(this._editBox,"onkeyup",W.hitch(this,function(F){F.keyCode!=d.ENTER&&F.keyCode!==d.TAB||this._disable()}));this._editBoxBlurHandler=u.connect(this._editBox,"onblur",W.hitch(this,function(F){this._disable()}));l.symbol.text="";l.setSymbol(l.symbol);l.hide();var x=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
W.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(F){r.set(x,{left:this._editBoxLeft+F.delta.x+"px",top:this._editBoxTop+F.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(r.get(x,"left"));this._editBoxTop=parseFloat(r.get(x,"top"))});this.onEditStart(l,this._editBox);this._toolbar.onTextEditStart(l,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(u.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(u.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(l,
m){m=l.getDojoShape().getTransformedBoundingBox();var n=l.getLayer();n=n.hasLocalNavigationTransform()?{dx:0,dy:0}:n.getNavigationTransform();var h=l.symbol.font;return{"font-family":h.family,"font-size":h.size+"px","font-style":h.style,"font-variant":h.variant,"font-weight":h.weight,left:m[0].x+n.dx+"px",top:m[0].y+n.dy+"px",width:Math.abs(m[0].x-m[1].x)/Math.cos(l.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var l=this._graphic.symbol;
l.text=this._editBox.value;this._graphic.setSymbol(l)}else this._graphic.getLayer().remove(this._graphic)}});X("extend-esri")&&W.setObject("toolbars.TextEditor",V,e);return V})},"jimu/dijit/EditorXssFilter":function(){define("dojo/_base/declare dojo/_base/array dijit/_WidgetBase dojo/_base/lang dojo/Evented libs/arcgis-html-sanitizer/arcgis-html-sanitizer".split(" "),function(V,W,u,O,X,N){var y=null,r=V([u,X],{baseClass:"jimu-editor-xss-filter",declaredClass:"jimu.dijit.EditorXssFilter",sanitizer:null,
xss:null,whiteList:{},graphicsWhiteList:{},postCreate:function(){this.whiteList=this._getWhiteList();this.sanitizer=new N({whiteList:this.whiteList,safeAttrValue:O.hitch(this,function(d,e,l,m){return"style"===e?this.xss.friendlyAttrValue(l).replace(/"/g,"'"):"img"===d&&"src"===e?this.xss.escapeAttrValue(l):this.xss.safeAttrValue(d,e,l,m)}),onTag:O.hitch(this,function(d,e,l){if(l.isWhite&&this._isInWhiteList(d,this.graphicsWhiteList))return e}),onIgnoreTagAttr:O.hitch(this,function(d,e,l,m){if("data-"===
e.substr(0,5))return e+'\x3d"'+this.xss.escapeAttrValue(l)+'"'}),onIgnoreTag:O.hitch(this,function(d,e,l){if("o:"===d.substr(0,2)||"!--[if"===d||"!--[endif]--"===d)return e})},!0);this.xss=this.sanitizer.xss},sanitize:function(d){return this.sanitizer.sanitize(d)},_getWhiteList:function(){var d="title height width class style font-family id align text-align".split(" "),e={div:d,h1:d,h2:d,h3:d,h4:d,h5:d,h6:d,span:d,p:d,s:d,strong:d,em:d,u:d,ol:d,ul:d,li:d,a:["href","target"].concat(d),img:["src","alt",
"border"].concat(d),blockquote:d,font:["face","size","color"].concat(d),pre:d,code:d,b:d,i:d,wbr:d,video:"autoplay controls loop muted poster preload".split(" ").concat(d),audio:["autoplay","controls","loop","muted","preload"].concat(d),source:["media","src","type"].concat(d),table:["cellpadding","cellspacing","border"].concat(d),tbody:[].concat(d),tr:["valign"].concat(d),td:["valign","colspan","rowspan","nowrap"].concat(d),th:["valign","colspan","rowspan","nowrap"].concat(d),hr:d,html:d,title:d,
link:["rel","href"],style:["type"].concat(d),body:d};this.graphicsWhiteList={animate:[],animateMotion:[],animateTransform:[],circle:[],clipPath:[],"color-profile":[],defs:[],desc:[],discard:[],ellipse:[],feBlend:[],feColorMatrix:[],feComponentTransfer:[],feComposite:[],feConvolveMatrix:[],feDiffuseLighting:[],feDisplacementMap:[],feDistantLight:[],feDropShadow:[],feFlood:[],feFuncA:[],feFuncB:[],feFuncG:[],feFuncR:[],feGaussianBlur:[],feImage:[],feMerge:[],feMergeNode:[],feMorphology:[],feOffset:[],
fePointLight:[],feSpecularLighting:[],feSpotLight:[],feTile:[],feTurbulence:[],filter:[],foreignObject:[],g:[],hatch:[],hatchpath:[],line:[],linearGradient:[],marker:[],mask:[],mesh:[],meshgradient:[],meshpatch:[],meshrow:[],metadata:[],mpath:[],path:[],pattern:[],polygon:[],polyline:[],radialGradient:[],rect:[],set:[],solidcolor:[],stop:[],svg:[],switch:[],symbol:[],text:[],textPath:[],title:[],tspan:[],use:[],view:[],object:[],canvas:d};return this._extendObjectOfArrays([e,{a:["target","href","title"],
abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title",
"width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls loop preload src height width".split(" ")},this.graphicsWhiteList])},
_extendObjectOfArrays:function(d){var e={};W.forEach(d,function(l){var m=Object.keys(l);W.forEach(m,function(n){Array.isArray(l[n])&&Array.isArray(e[n])?e[n]=e[n].concat(l[n]):e[n]=l[n]},this)},this);return e},_isInWhiteList:function(d,e){e=Object.keys(e);var l=!1;W.forEach(e,function(m){d===m&&(l=!0)},this);return l}});r.getInstance=function(){null===y&&(y=new r);return y};return r})},"widgets/NearMe/libs/swiper":function(){(function(){function V(y){y.fn.swiper=function(r){var d;y(this).each(function(){var e=
new u(this,r);d||(d=e)});return d}}var W,u=function(y,r){function d(){var b=a.params.autoplay,f=a.slides.eq(a.activeIndex);f.attr("data-swiper-autoplay")&&(b=f.attr("data-swiper-autoplay")||a.params.autoplay);a.autoplayTimeoutId=setTimeout(function(){a.params.loop?(a.fixLoop(),a._slideNext(),a.emit("onAutoplay",a)):a.isEnd?r.autoplayStopOnLast?a.stopAutoplay():(a._slideTo(0),a.emit("onAutoplay",a)):(a._slideNext(),a.emit("onAutoplay",a))},b)}function e(b,f){b=W(b.target);if(!b.is(f))if("string"===
typeof f)b=b.parents(f);else if(f.nodeType){var D;b.parents().each(function(t,Z){Z===f&&(D=f)});if(D)return f;return}if(0!==b.length)return b[0]}function l(b,f){f=f||{};var D=new (window.MutationObserver||window.WebkitMutationObserver)(function(t){t.forEach(function(Z){a.onResize(!0);a.emit("onObserverUpdate",a,Z)})});D.observe(b,{attributes:"undefined"===typeof f.attributes?!0:f.attributes,childList:"undefined"===typeof f.childList?!0:f.childList,characterData:"undefined"===typeof f.characterData?
!0:f.characterData});a.observers.push(D)}function m(b){b.originalEvent&&(b=b.originalEvent);var f=b.keyCode||b.charCode;if(!a.params.allowSwipeToNext&&(a.isHorizontal()&&39===f||!a.isHorizontal()&&40===f)||!a.params.allowSwipeToPrev&&(a.isHorizontal()&&37===f||!a.isHorizontal()&&38===f))return!1;if(!(b.shiftKey||b.altKey||b.ctrlKey||b.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===
f||39===f||38===f||40===f){var D=!1;if(0<a.container.parents("."+a.params.slideClass).length&&0===a.container.parents("."+a.params.slideActiveClass).length)return;var t=window.pageXOffset,Z=window.pageYOffset,ca=window.innerWidth,ta=window.innerHeight,g=a.container.offset();a.rtl&&(g.left-=a.container[0].scrollLeft);g=[[g.left,g.top],[g.left+a.width,g.top],[g.left,g.top+a.height],[g.left+a.width,g.top+a.height]];for(var L=0;L<g.length;L++){var U=g[L];U[0]>=t&&U[0]<=t+ca&&U[1]>=Z&&U[1]<=Z+ta&&(D=!0)}if(!D)return}if(a.isHorizontal()){if(37===
f||39===f)b.preventDefault?b.preventDefault():b.returnValue=!1;(39===f&&!a.rtl||37===f&&a.rtl)&&a.slideNext();(37===f&&!a.rtl||39===f&&a.rtl)&&a.slidePrev()}else{if(38===f||40===f)b.preventDefault?b.preventDefault():b.returnValue=!1;40===f&&a.slideNext();38===f&&a.slidePrev()}a.emit("onKeyPress",a,f)}}function n(){var b="onwheel"in document;b||(b=document.createElement("div"),b.setAttribute("onwheel","return;"),b="function"===typeof b.onwheel);!b&&document.implementation&&document.implementation.hasFeature&&
!0!==document.implementation.hasFeature("","")&&(b=document.implementation.hasFeature("Events.wheel","3.0"));return b}function h(b){var f=0,D=0,t=0,Z=0;"detail"in b&&(D=b.detail);"wheelDelta"in b&&(D=-b.wheelDelta/120);"wheelDeltaY"in b&&(D=-b.wheelDeltaY/120);"wheelDeltaX"in b&&(f=-b.wheelDeltaX/120);"axis"in b&&b.axis===b.HORIZONTAL_AXIS&&(f=D,D=0);t=10*f;Z=10*D;"deltaY"in b&&(Z=b.deltaY);"deltaX"in b&&(t=b.deltaX);(t||Z)&&b.deltaMode&&(1===b.deltaMode?(t*=40,Z*=40):(t*=800,Z*=800));t&&!f&&(f=1>
t?-1:1);Z&&!D&&(D=1>Z?-1:1);return{spinX:f,spinY:D,pixelX:t,pixelY:Z}}function x(b){b.originalEvent&&(b=b.originalEvent);var f=0;f=a.rtl?-1:1;var D=h(b);if(a.params.mousewheelForceToAxis)if(a.isHorizontal())if(Math.abs(D.pixelX)>Math.abs(D.pixelY))f*=D.pixelX;else return;else if(Math.abs(D.pixelY)>Math.abs(D.pixelX))f=D.pixelY;else return;else f=Math.abs(D.pixelX)>Math.abs(D.pixelY)?-D.pixelX*f:-D.pixelY;if(0!==f){a.params.mousewheelInvert&&(f=-f);if(a.params.freeMode){f=a.getWrapperTranslate()+f*
a.params.mousewheelSensitivity;D=a.isBeginning;var t=a.isEnd;f>=a.minTranslate()&&(f=a.minTranslate());f<=a.maxTranslate()&&(f=a.maxTranslate());a.setWrapperTransition(0);a.setWrapperTranslate(f);a.updateProgress();a.updateActiveIndex();(!D&&a.isBeginning||!t&&a.isEnd)&&a.updateClasses();a.params.freeModeSticky?(clearTimeout(a.mousewheel.timeout),a.mousewheel.timeout=setTimeout(function(){a.slideReset()},300)):a.params.lazyLoading&&a.lazy&&a.lazy.load();a.emit("onScroll",a,b);a.params.autoplay&&a.params.autoplayDisableOnInteraction&&
a.stopAutoplay();if(0===f||f===a.maxTranslate())return}else{if(60<(new window.Date).getTime()-a.mousewheel.lastScrollTime)if(0>f)if((!a.isEnd||a.params.loop)&&!a.animating)a.slideNext(),a.emit("onScroll",a,b);else{if(a.params.mousewheelReleaseOnEdges)return!0}else if((!a.isBeginning||a.params.loop)&&!a.animating)a.slidePrev(),a.emit("onScroll",a,b);else if(a.params.mousewheelReleaseOnEdges)return!0;a.mousewheel.lastScrollTime=(new window.Date).getTime()}b.preventDefault?b.preventDefault():b.returnValue=
!1;return!1}}function F(b,f){b=W(b);var D=a.rtl?-1:1;var t=b.attr("data-swiper-parallax")||"0";var Z=b.attr("data-swiper-parallax-x");var ca=b.attr("data-swiper-parallax-y");Z||ca?(Z=Z||"0",ca=ca||"0"):a.isHorizontal()?(Z=t,ca="0"):(ca=t,Z="0");Z=0<=Z.indexOf("%")?parseInt(Z,10)*f*D+"%":Z*f*D+"px";ca=0<=ca.indexOf("%")?parseInt(ca,10)*f+"%":ca*f+"px";b.transform("translate3d("+Z+", "+ca+",0px)")}function H(b){0!==b.indexOf("on")&&(b=b[0]!==b[0].toUpperCase()?"on"+b[0].toUpperCase()+b.substring(1):
"on"+b);return b}if(!(this instanceof u))return new u(y,r);var w={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,
effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,zoom:!1,zoomMax:3,zoomMin:1,zoomToggle:!0,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,mousewheelEventsTarged:"container",
hashnav:!1,hashnavWatchState:!1,history:!1,replaceState:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,touchReleaseOnEdges:!1,uniqueNavElements:!0,pagination:null,paginationElement:"span",
paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,
loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",normalizeSlideIndex:!0,allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",
slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",
paginationClickableClass:"swiper-pagination-clickable",paginationModifierClass:"swiper-pagination-",lazyLoadingClass:"swiper-lazy",lazyStatusLoadingClass:"swiper-lazy-loading",lazyStatusLoadedClass:"swiper-lazy-loaded",lazyPreloaderClass:"swiper-lazy-preloader",notificationClass:"swiper-notification",preloaderClass:"preloader",zoomContainerClass:"swiper-zoom-container",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",
lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},G=r&&r.virtualTranslate;r=r||{};var Q={},S;for(S in r)if("object"!==typeof r[S]||null===r[S]||r[S].nodeType||r[S]===window||r[S]===document||"undefined"!==typeof O&&r[S]instanceof O||"undefined"!==typeof jQuery&&r[S]instanceof jQuery)Q[S]=r[S];else{Q[S]={};for(var M in r[S])Q[S][M]=r[S][M]}for(var R in w)if("undefined"===typeof r[R])r[R]=w[R];else if("object"===typeof r[R])for(var C in w[R])"undefined"===
typeof r[R][C]&&(r[R][C]=w[R][C]);var a=this;a.params=r;a.originalParams=Q;a.classNames=[];"undefined"!==typeof W&&"undefined"!==typeof O&&(W=O);if("undefined"===typeof W&&(W="undefined"===typeof O?window.Dom7||window.Zepto||window.jQuery:O,!W))return;a.$=W;a.currentBreakpoint=void 0;a.getActiveBreakpoint=function(){if(!a.params.breakpoints)return!1;var b=!1,f=[];for(t in a.params.breakpoints)a.params.breakpoints.hasOwnProperty(t)&&f.push(t);f.sort(function(Z,ca){return parseInt(Z,10)>parseInt(ca,
10)});for(var D=0;D<f.length;D++){var t=f[D];t>=window.innerWidth&&!b&&(b=t)}return b||"max"};a.setBreakpoint=function(){var b=a.getActiveBreakpoint();if(b&&a.currentBreakpoint!==b){var f=b in a.params.breakpoints?a.params.breakpoints[b]:a.originalParams,D=a.params.loop&&f.slidesPerView!==a.params.slidesPerView,t;for(t in f)a.params[t]=f[t];a.currentBreakpoint=b;D&&a.destroyLoop&&a.reLoop(!0)}};a.params.breakpoints&&a.setBreakpoint();a.container=W(y);if(0!==a.container.length){if(1<a.container.length){var B=
[];a.container.each(function(){B.push(new u(this,r))});return B}a.container[0].swiper=a;a.container.data("swiper",a);a.classNames.push(a.params.containerModifierClass+a.params.direction);a.params.freeMode&&a.classNames.push(a.params.containerModifierClass+"free-mode");a.support.flexbox||(a.classNames.push(a.params.containerModifierClass+"no-flexbox"),a.params.slidesPerColumn=1);a.params.autoHeight&&a.classNames.push(a.params.containerModifierClass+"autoheight");if(a.params.parallax||a.params.watchSlidesVisibility)a.params.watchSlidesProgress=
!0;a.params.touchReleaseOnEdges&&(a.params.resistanceRatio=0);0<=["cube","coverflow","flip"].indexOf(a.params.effect)&&(a.support.transforms3d?(a.params.watchSlidesProgress=!0,a.classNames.push(a.params.containerModifierClass+"3d")):a.params.effect="slide");"slide"!==a.params.effect&&a.classNames.push(a.params.containerModifierClass+a.params.effect);"cube"===a.params.effect&&(a.params.resistanceRatio=0,a.params.slidesPerView=1,a.params.slidesPerColumn=1,a.params.slidesPerGroup=1,a.params.centeredSlides=
!1,a.params.spaceBetween=0,a.params.virtualTranslate=!0);if("fade"===a.params.effect||"flip"===a.params.effect)a.params.slidesPerView=1,a.params.slidesPerColumn=1,a.params.slidesPerGroup=1,a.params.watchSlidesProgress=!0,a.params.spaceBetween=0,"undefined"===typeof G&&(a.params.virtualTranslate=!0);a.params.grabCursor&&a.support.touch&&(a.params.grabCursor=!1);a.wrapper=a.container.children("."+a.params.wrapperClass);a.params.pagination&&(a.paginationContainer=W(a.params.pagination),a.params.uniqueNavElements&&
"string"===typeof a.params.pagination&&1<a.paginationContainer.length&&1===a.container.find(a.params.pagination).length&&(a.paginationContainer=a.container.find(a.params.pagination)),"bullets"===a.params.paginationType&&a.params.paginationClickable?a.paginationContainer.addClass(a.params.paginationModifierClass+"clickable"):a.params.paginationClickable=!1,a.paginationContainer.addClass(a.params.paginationModifierClass+a.params.paginationType));if(a.params.nextButton||a.params.prevButton)a.params.nextButton&&
(a.nextButton=W(a.params.nextButton),a.params.uniqueNavElements&&"string"===typeof a.params.nextButton&&1<a.nextButton.length&&1===a.container.find(a.params.nextButton).length&&(a.nextButton=a.container.find(a.params.nextButton))),a.params.prevButton&&(a.prevButton=W(a.params.prevButton),a.params.uniqueNavElements&&"string"===typeof a.params.prevButton&&1<a.prevButton.length&&1===a.container.find(a.params.prevButton).length&&(a.prevButton=a.container.find(a.params.prevButton)));a.isHorizontal=function(){return"horizontal"===
a.params.direction};a.rtl=a.isHorizontal()&&("rtl"===a.container[0].dir.toLowerCase()||"rtl"===a.container.css("direction"));a.rtl&&a.classNames.push(a.params.containerModifierClass+"rtl");a.rtl&&(a.wrongRTL="-webkit-box"===a.wrapper.css("display"));1<a.params.slidesPerColumn&&a.classNames.push(a.params.containerModifierClass+"multirow");a.device.android&&a.classNames.push(a.params.containerModifierClass+"android");a.container.addClass(a.classNames.join(" "));a.translate=0;a.progress=0;a.velocity=
0;a.lockSwipeToNext=function(){a.params.allowSwipeToNext=!1;!1===a.params.allowSwipeToPrev&&a.params.grabCursor&&a.unsetGrabCursor()};a.lockSwipeToPrev=function(){a.params.allowSwipeToPrev=!1;!1===a.params.allowSwipeToNext&&a.params.grabCursor&&a.unsetGrabCursor()};a.lockSwipes=function(){a.params.allowSwipeToNext=a.params.allowSwipeToPrev=!1;a.params.grabCursor&&a.unsetGrabCursor()};a.unlockSwipeToNext=function(){a.params.allowSwipeToNext=!0;!0===a.params.allowSwipeToPrev&&a.params.grabCursor&&a.setGrabCursor()};
a.unlockSwipeToPrev=function(){a.params.allowSwipeToPrev=!0;!0===a.params.allowSwipeToNext&&a.params.grabCursor&&a.setGrabCursor()};a.unlockSwipes=function(){a.params.allowSwipeToNext=a.params.allowSwipeToPrev=!0;a.params.grabCursor&&a.setGrabCursor()};a.setGrabCursor=function(b){a.container[0].style.cursor="move";a.container[0].style.cursor=b?"-webkit-grabbing":"-webkit-grab";a.container[0].style.cursor=b?"-moz-grabbin":"-moz-grab";a.container[0].style.cursor=b?"grabbing":"grab"};a.unsetGrabCursor=
function(){a.container[0].style.cursor=""};a.params.grabCursor&&a.setGrabCursor();a.imagesToLoad=[];a.imagesLoaded=0;a.loadImage=function(b,f,D,t,Z,ca){function ta(){ca&&ca()}b.complete&&Z?ta():f?(b=new window.Image,b.onload=ta,b.onerror=ta,t&&(b.sizes=t),D&&(b.srcset=D),f&&(b.src=f)):ta()};a.preloadImages=function(){function b(){"undefined"!==typeof a&&null!==a&&a&&(void 0!==a.imagesLoaded&&a.imagesLoaded++,a.imagesLoaded===a.imagesToLoad.length&&(a.params.updateOnImagesReady&&a.update(),a.emit("onImagesReady",
a)))}a.imagesToLoad=a.container.find("img");for(var f=0;f<a.imagesToLoad.length;f++)a.loadImage(a.imagesToLoad[f],a.imagesToLoad[f].currentSrc||a.imagesToLoad[f].getAttribute("src"),a.imagesToLoad[f].srcset||a.imagesToLoad[f].getAttribute("srcset"),a.imagesToLoad[f].sizes||a.imagesToLoad[f].getAttribute("sizes"),!0,b)};a.autoplayTimeoutId=void 0;a.autoplaying=!1;a.autoplayPaused=!1;a.startAutoplay=function(){if("undefined"!==typeof a.autoplayTimeoutId||!a.params.autoplay||a.autoplaying)return!1;a.autoplaying=
!0;a.emit("onAutoplayStart",a);d()};a.stopAutoplay=function(b){a.autoplayTimeoutId&&(a.autoplayTimeoutId&&clearTimeout(a.autoplayTimeoutId),a.autoplaying=!1,a.autoplayTimeoutId=void 0,a.emit("onAutoplayStop",a))};a.pauseAutoplay=function(b){a.autoplayPaused||(a.autoplayTimeoutId&&clearTimeout(a.autoplayTimeoutId),a.autoplayPaused=!0,0===b?(a.autoplayPaused=!1,d()):a.wrapper.transitionEnd(function(){a&&(a.autoplayPaused=!1,a.autoplaying?d():a.stopAutoplay())}))};a.minTranslate=function(){return-a.snapGrid[0]};
a.maxTranslate=function(){return-a.snapGrid[a.snapGrid.length-1]};a.updateAutoHeight=function(){var b=[],f=0,D;if("auto"!==a.params.slidesPerView&&1<a.params.slidesPerView)for(D=0;D<Math.ceil(a.params.slidesPerView);D++){var t=a.activeIndex+D;if(t>a.slides.length)break;b.push(a.slides.eq(t)[0])}else b.push(a.slides.eq(a.activeIndex)[0]);for(D=0;D<b.length;D++)"undefined"!==typeof b[D]&&(t=b[D].offsetHeight,f=t>f?t:f);f&&a.wrapper.css("height",f+"px")};a.updateContainerSize=function(){var b="undefined"!==
typeof a.params.width?a.params.width:a.container[0].clientWidth;var f="undefined"!==typeof a.params.height?a.params.height:a.container[0].clientHeight;0===b&&a.isHorizontal()||0===f&&!a.isHorizontal()||(b=b-parseInt(a.container.css("padding-left"),10)-parseInt(a.container.css("padding-right"),10),f=f-parseInt(a.container.css("padding-top"),10)-parseInt(a.container.css("padding-bottom"),10),a.width=b,a.height=f,a.size=a.isHorizontal()?a.width:a.height)};a.updateSlidesSize=function(){a.slides=a.wrapper.children("."+
a.params.slideClass);a.snapGrid=[];a.slidesGrid=[];a.slidesSizesGrid=[];var b=a.params.spaceBetween,f=-a.params.slidesOffsetBefore,D,t=0,Z=0;if("undefined"!==typeof a.size){"string"===typeof b&&0<=b.indexOf("%")&&(b=parseFloat(b.replace("%",""))/100*a.size);a.virtualSize=-b;a.rtl?a.slides.css({marginLeft:"",marginTop:""}):a.slides.css({marginRight:"",marginBottom:""});if(1<a.params.slidesPerColumn){var ca=Math.floor(a.slides.length/a.params.slidesPerColumn)===a.slides.length/a.params.slidesPerColumn?
a.slides.length:Math.ceil(a.slides.length/a.params.slidesPerColumn)*a.params.slidesPerColumn;"auto"!==a.params.slidesPerView&&"row"===a.params.slidesPerColumnFill&&(ca=Math.max(ca,a.params.slidesPerView*a.params.slidesPerColumn))}var ta=a.params.slidesPerColumn,g=ca/ta,L=g-(a.params.slidesPerColumn*g-a.slides.length);for(D=0;D<a.slides.length;D++){var U=0;var Y=a.slides.eq(D);if(1<a.params.slidesPerColumn){if("column"===a.params.slidesPerColumnFill){var ha=Math.floor(D/ta);var va=D-ha*ta;(ha>L||ha===
L&&va===ta-1)&&++va>=ta&&(va=0,ha++);var Aa=ha+va*ca/ta;Y.css({"-webkit-box-ordinal-group":Aa,"-moz-box-ordinal-group":Aa,"-ms-flex-order":Aa,"-webkit-order":Aa,order:Aa})}else va=Math.floor(D/g),ha=D-va*g;Y.css("margin-"+(a.isHorizontal()?"top":"left"),0!==va&&a.params.spaceBetween&&a.params.spaceBetween+"px").attr("data-swiper-column",ha).attr("data-swiper-row",va)}"none"!==Y.css("display")&&("auto"===a.params.slidesPerView?(U=a.isHorizontal()?Y.outerWidth(!0):Y.outerHeight(!0),a.params.roundLengths&&
(U=Math.floor(U))):(U=(a.size-(a.params.slidesPerView-1)*b)/a.params.slidesPerView,a.params.roundLengths&&(U=Math.floor(U)),a.isHorizontal()?a.slides[D].style.width=U+"px":a.slides[D].style.height=U+"px"),a.slides[D].swiperSlideSize=U,a.slidesSizesGrid.push(U),a.params.centeredSlides?(f=f+U/2+t/2+b,0===t&&0!==D&&(f=f-a.size/2-b),0===D&&(f=f-a.size/2-b),.001>Math.abs(f)&&(f=0),0===Z%a.params.slidesPerGroup&&a.snapGrid.push(f),a.slidesGrid.push(f)):(0===Z%a.params.slidesPerGroup&&a.snapGrid.push(f),
a.slidesGrid.push(f),f=f+U+b),a.virtualSize+=U+b,t=U,Z++)}a.virtualSize=Math.max(a.virtualSize,a.size)+a.params.slidesOffsetAfter;a.rtl&&a.wrongRTL&&("slide"===a.params.effect||"coverflow"===a.params.effect)&&a.wrapper.css({width:a.virtualSize+a.params.spaceBetween+"px"});if(!a.support.flexbox||a.params.setWrapperSize)a.isHorizontal()?a.wrapper.css({width:a.virtualSize+a.params.spaceBetween+"px"}):a.wrapper.css({height:a.virtualSize+a.params.spaceBetween+"px"});if(1<a.params.slidesPerColumn&&(a.virtualSize=
(U+a.params.spaceBetween)*ca,a.virtualSize=Math.ceil(a.virtualSize/a.params.slidesPerColumn)-a.params.spaceBetween,a.isHorizontal()?a.wrapper.css({width:a.virtualSize+a.params.spaceBetween+"px"}):a.wrapper.css({height:a.virtualSize+a.params.spaceBetween+"px"}),a.params.centeredSlides)){f=[];for(D=0;D<a.snapGrid.length;D++)a.snapGrid[D]<a.virtualSize+a.snapGrid[0]&&f.push(a.snapGrid[D]);a.snapGrid=f}if(!a.params.centeredSlides){f=[];for(D=0;D<a.snapGrid.length;D++)a.snapGrid[D]<=a.virtualSize-a.size&&
f.push(a.snapGrid[D]);a.snapGrid=f;1<Math.floor(a.virtualSize-a.size)-Math.floor(a.snapGrid[a.snapGrid.length-1])&&a.snapGrid.push(a.virtualSize-a.size)}0===a.snapGrid.length&&(a.snapGrid=[0]);0!==a.params.spaceBetween&&(a.isHorizontal()?a.rtl?a.slides.css({marginLeft:b+"px"}):a.slides.css({marginRight:b+"px"}):a.slides.css({marginBottom:b+"px"}));a.params.watchSlidesProgress&&a.updateSlidesOffset()}};a.updateSlidesOffset=function(){for(var b=0;b<a.slides.length;b++)a.slides[b].swiperSlideOffset=
a.isHorizontal()?a.slides[b].offsetLeft:a.slides[b].offsetTop};a.currentSlidesPerView=function(){var b=1,f;if(a.params.centeredSlides){var D=a.slides[a.activeIndex].swiperSlideSize,t;for(f=a.activeIndex+1;f<a.slides.length;f++)a.slides[f]&&!t&&(D+=a.slides[f].swiperSlideSize,b++,D>a.size&&(t=!0));for(f=a.activeIndex-1;0<=f;f--)a.slides[f]&&!t&&(D+=a.slides[f].swiperSlideSize,b++,D>a.size&&(t=!0))}else for(f=a.activeIndex+1;f<a.slides.length;f++)a.slidesGrid[f]-a.slidesGrid[a.activeIndex]<a.size&&
b++;return b};a.updateSlidesProgress=function(b){"undefined"===typeof b&&(b=a.translate||0);if(0!==a.slides.length){"undefined"===typeof a.slides[0].swiperSlideOffset&&a.updateSlidesOffset();var f=-b;a.rtl&&(f=b);a.slides.removeClass(a.params.slideVisibleClass);for(b=0;b<a.slides.length;b++){var D=a.slides[b],t=(f+(a.params.centeredSlides?a.minTranslate():0)-D.swiperSlideOffset)/(D.swiperSlideSize+a.params.spaceBetween);if(a.params.watchSlidesVisibility){var Z=-(f-D.swiperSlideOffset),ca=Z+a.slidesSizesGrid[b];
(0<=Z&&Z<a.size||0<ca&&ca<=a.size||0>=Z&&ca>=a.size)&&a.slides.eq(b).addClass(a.params.slideVisibleClass)}D.progress=a.rtl?-t:t}}};a.updateProgress=function(b){"undefined"===typeof b&&(b=a.translate||0);var f=a.maxTranslate()-a.minTranslate(),D=a.isBeginning,t=a.isEnd;0===f?(a.progress=0,a.isBeginning=a.isEnd=!0):(a.progress=(b-a.minTranslate())/f,a.isBeginning=0>=a.progress,a.isEnd=1<=a.progress);a.isBeginning&&!D&&a.emit("onReachBeginning",a);a.isEnd&&!t&&a.emit("onReachEnd",a);a.params.watchSlidesProgress&&
a.updateSlidesProgress(b);a.emit("onProgress",a,a.progress)};a.updateActiveIndex=function(){var b=a.rtl?a.translate:-a.translate,f,D;for(D=0;D<a.slidesGrid.length;D++)"undefined"!==typeof a.slidesGrid[D+1]?b>=a.slidesGrid[D]&&b<a.slidesGrid[D+1]-(a.slidesGrid[D+1]-a.slidesGrid[D])/2?f=D:b>=a.slidesGrid[D]&&b<a.slidesGrid[D+1]&&(f=D+1):b>=a.slidesGrid[D]&&(f=D);a.params.normalizeSlideIndex&&(0>f||"undefined"===typeof f)&&(f=0);b=Math.floor(f/a.params.slidesPerGroup);b>=a.snapGrid.length&&(b=a.snapGrid.length-
1);f!==a.activeIndex&&(a.snapIndex=b,a.previousIndex=a.activeIndex,a.activeIndex=f,a.updateClasses(),a.updateRealIndex())};a.updateRealIndex=function(){a.realIndex=parseInt(a.slides.eq(a.activeIndex).attr("data-swiper-slide-index")||a.activeIndex,10)};a.updateClasses=function(){a.slides.removeClass(a.params.slideActiveClass+" "+a.params.slideNextClass+" "+a.params.slidePrevClass+" "+a.params.slideDuplicateActiveClass+" "+a.params.slideDuplicateNextClass+" "+a.params.slideDuplicatePrevClass);var b=
a.slides.eq(a.activeIndex);b.addClass(a.params.slideActiveClass);r.loop&&(b.hasClass(a.params.slideDuplicateClass)?a.wrapper.children("."+a.params.slideClass+":not(."+a.params.slideDuplicateClass+')[data-swiper-slide-index\x3d"'+a.realIndex+'"]').addClass(a.params.slideDuplicateActiveClass):a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+a.realIndex+'"]').addClass(a.params.slideDuplicateActiveClass));var f=b.next("."+a.params.slideClass).addClass(a.params.slideNextClass);
a.params.loop&&0===f.length&&(f=a.slides.eq(0),f.addClass(a.params.slideNextClass));b=b.prev("."+a.params.slideClass).addClass(a.params.slidePrevClass);a.params.loop&&0===b.length&&(b=a.slides.eq(-1),b.addClass(a.params.slidePrevClass));r.loop&&(f.hasClass(a.params.slideDuplicateClass)?a.wrapper.children("."+a.params.slideClass+":not(."+a.params.slideDuplicateClass+')[data-swiper-slide-index\x3d"'+f.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicateNextClass):a.wrapper.children("."+
a.params.slideClass+"."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+f.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicateNextClass),b.hasClass(a.params.slideDuplicateClass)?a.wrapper.children("."+a.params.slideClass+":not(."+a.params.slideDuplicateClass+')[data-swiper-slide-index\x3d"'+b.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicatePrevClass):a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+
b.attr("data-swiper-slide-index")+'"]').addClass(a.params.slideDuplicatePrevClass));if(a.paginationContainer&&0<a.paginationContainer.length){f=a.params.loop?Math.ceil((a.slides.length-2*a.loopedSlides)/a.params.slidesPerGroup):a.snapGrid.length;if(a.params.loop){var D=Math.ceil((a.activeIndex-a.loopedSlides)/a.params.slidesPerGroup);D>a.slides.length-1-2*a.loopedSlides&&(D-=a.slides.length-2*a.loopedSlides);D>f-1&&(D-=f);0>D&&"bullets"!==a.params.paginationType&&(D=f+D)}else D="undefined"!==typeof a.snapIndex?
a.snapIndex:a.activeIndex||0;"bullets"===a.params.paginationType&&a.bullets&&0<a.bullets.length&&(a.bullets.removeClass(a.params.bulletActiveClass),1<a.paginationContainer.length?a.bullets.each(function(){W(this).index()===D&&W(this).addClass(a.params.bulletActiveClass)}):a.bullets.eq(D).addClass(a.params.bulletActiveClass));"fraction"===a.params.paginationType&&(a.paginationContainer.find("."+a.params.paginationCurrentClass).text(D+1),a.paginationContainer.find("."+a.params.paginationTotalClass).text(f));
if("progress"===a.params.paginationType){var t=b=(D+1)/f,Z=1;a.isHorizontal()||(Z=b,t=1);a.paginationContainer.find("."+a.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+t+") scaleY("+Z+")").transition(a.params.speed)}"custom"===a.params.paginationType&&a.params.paginationCustomRender&&(a.paginationContainer.html(a.params.paginationCustomRender(a,D+1,f)),a.emit("onPaginationRendered",a,a.paginationContainer[0]))}a.params.loop||(a.params.prevButton&&a.prevButton&&0<a.prevButton.length&&
(a.isBeginning?(a.prevButton.addClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.disable(a.prevButton)):(a.prevButton.removeClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.enable(a.prevButton))),a.params.nextButton&&a.nextButton&&0<a.nextButton.length&&(a.isEnd?(a.nextButton.addClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.disable(a.nextButton)):(a.nextButton.removeClass(a.params.buttonDisabledClass),a.params.a11y&&a.a11y&&a.a11y.enable(a.nextButton))))};
a.updatePagination=function(){if(a.params.pagination&&a.paginationContainer&&0<a.paginationContainer.length){var b="";if("bullets"===a.params.paginationType){for(var f=a.params.loop?Math.ceil((a.slides.length-2*a.loopedSlides)/a.params.slidesPerGroup):a.snapGrid.length,D=0;D<f;D++)b=a.params.paginationBulletRender?b+a.params.paginationBulletRender(a,D,a.params.bulletClass):b+("\x3c"+a.params.paginationElement+' class\x3d"'+a.params.bulletClass+'"\x3e\x3c/'+a.params.paginationElement+"\x3e");a.paginationContainer.html(b);
a.bullets=a.paginationContainer.find("."+a.params.bulletClass);a.params.paginationClickable&&a.params.a11y&&a.a11y&&a.a11y.initPagination()}"fraction"===a.params.paginationType&&(b=a.params.paginationFractionRender?a.params.paginationFractionRender(a,a.params.paginationCurrentClass,a.params.paginationTotalClass):'\x3cspan class\x3d"'+a.params.paginationCurrentClass+'"\x3e\x3c/span\x3e / \x3cspan class\x3d"'+a.params.paginationTotalClass+'"\x3e\x3c/span\x3e',a.paginationContainer.html(b));"progress"===
a.params.paginationType&&(b=a.params.paginationProgressRender?a.params.paginationProgressRender(a,a.params.paginationProgressbarClass):'\x3cspan class\x3d"'+a.params.paginationProgressbarClass+'"\x3e\x3c/span\x3e',a.paginationContainer.html(b));"custom"!==a.params.paginationType&&a.emit("onPaginationRendered",a,a.paginationContainer[0])}};a.update=function(b){function f(){D=Math.min(Math.max(a.translate,a.maxTranslate()),a.minTranslate());a.setWrapperTranslate(D);a.updateActiveIndex();a.updateClasses()}
if(a){a.updateContainerSize();a.updateSlidesSize();a.updateProgress();a.updatePagination();a.updateClasses();a.params.scrollbar&&a.scrollbar&&a.scrollbar.set();var D;b?(a.controller&&a.controller.spline&&(a.controller.spline=void 0),a.params.freeMode?(f(),a.params.autoHeight&&a.updateAutoHeight()):(b=("auto"===a.params.slidesPerView||1<a.params.slidesPerView)&&a.isEnd&&!a.params.centeredSlides?a.slideTo(a.slides.length-1,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0))||f()):a.params.autoHeight&&a.updateAutoHeight()}};
a.onResize=function(b){if(a.params.onBeforeResize)a.params.onBeforeResize(a);a.params.breakpoints&&a.setBreakpoint();var f=a.params.allowSwipeToPrev,D=a.params.allowSwipeToNext;a.params.allowSwipeToPrev=a.params.allowSwipeToNext=!0;a.updateContainerSize();a.updateSlidesSize();("auto"===a.params.slidesPerView||a.params.freeMode||b)&&a.updatePagination();a.params.scrollbar&&a.scrollbar&&a.scrollbar.set();a.controller&&a.controller.spline&&(a.controller.spline=void 0);b=!1;if(a.params.freeMode){var t=
Math.min(Math.max(a.translate,a.maxTranslate()),a.minTranslate());a.setWrapperTranslate(t);a.updateActiveIndex();a.updateClasses();a.params.autoHeight&&a.updateAutoHeight()}else a.updateClasses(),b=("auto"===a.params.slidesPerView||1<a.params.slidesPerView)&&a.isEnd&&!a.params.centeredSlides?a.slideTo(a.slides.length-1,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0);a.params.lazyLoading&&!b&&a.lazy&&a.lazy.load();a.params.allowSwipeToPrev=f;a.params.allowSwipeToNext=D;if(a.params.onAfterResize)a.params.onAfterResize(a)};
a.touchEventsDesktop={start:"mousedown",move:"mousemove",end:"mouseup"};window.navigator.pointerEnabled?a.touchEventsDesktop={start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled&&(a.touchEventsDesktop={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"});a.touchEvents={start:a.support.touch||!a.params.simulateTouch?"touchstart":a.touchEventsDesktop.start,move:a.support.touch||!a.params.simulateTouch?"touchmove":a.touchEventsDesktop.move,end:a.support.touch||
!a.params.simulateTouch?"touchend":a.touchEventsDesktop.end};(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===a.params.touchEventsTarget?a.container:a.wrapper).addClass("swiper-wp8-"+a.params.direction);a.initEvents=function(b){var f=b?"off":"on";b=b?"removeEventListener":"addEventListener";var D="container"===a.params.touchEventsTarget?a.container[0]:a.wrapper[0],t=a.support.touch?D:document,Z=a.params.nested?!0:!1;if(a.browser.ie)D[b](a.touchEvents.start,a.onTouchStart,
!1),t[b](a.touchEvents.move,a.onTouchMove,Z),t[b](a.touchEvents.end,a.onTouchEnd,!1);else if(a.support.touch&&(t="touchstart"===a.touchEvents.start&&a.support.passiveListener&&a.params.passiveListeners?{passive:!0,capture:!1}:!1,D[b](a.touchEvents.start,a.onTouchStart,t),D[b](a.touchEvents.move,a.onTouchMove,Z),D[b](a.touchEvents.end,a.onTouchEnd,t)),r.simulateTouch&&!a.device.ios&&!a.device.android||r.simulateTouch&&!a.support.touch&&a.device.ios)D[b]("mousedown",a.onTouchStart,!1),document[b]("mousemove",
a.onTouchMove,Z),document[b]("mouseup",a.onTouchEnd,!1);window[b]("resize",a.onResize);if(a.params.nextButton&&a.nextButton&&0<a.nextButton.length&&(a.nextButton[f]("click",a.onClickNext),a.params.a11y&&a.a11y))a.nextButton[f]("keydown",a.a11y.onEnterKey);if(a.params.prevButton&&a.prevButton&&0<a.prevButton.length&&(a.prevButton[f]("click",a.onClickPrev),a.params.a11y&&a.a11y))a.prevButton[f]("keydown",a.a11y.onEnterKey);if(a.params.pagination&&a.params.paginationClickable&&(a.paginationContainer[f]("click",
"."+a.params.bulletClass,a.onClickIndex),a.params.a11y&&a.a11y))a.paginationContainer[f]("keydown","."+a.params.bulletClass,a.a11y.onEnterKey);if(a.params.preventClicks||a.params.preventClicksPropagation)D[b]("click",a.preventClicks,!0)};a.attachEvents=function(){a.initEvents()};a.detachEvents=function(){a.initEvents(!0)};a.allowClick=!0;a.preventClicks=function(b){a.allowClick||(a.params.preventClicks&&b.preventDefault(),a.params.preventClicksPropagation&&a.animating&&(b.stopPropagation(),b.stopImmediatePropagation()))};
a.onClickNext=function(b){b.preventDefault();a.isEnd&&!a.params.loop||a.slideNext()};a.onClickPrev=function(b){b.preventDefault();a.isBeginning&&!a.params.loop||a.slidePrev()};a.onClickIndex=function(b){b.preventDefault();b=W(this).index()*a.params.slidesPerGroup;a.params.loop&&(b+=a.loopedSlides);a.slideTo(b)};a.updateClickedSlide=function(b){b=e(b,"."+a.params.slideClass);var f=!1;if(b)for(var D=0;D<a.slides.length;D++)a.slides[D]===b&&(f=!0);if(b&&f){if(a.clickedSlide=b,a.clickedIndex=W(b).index(),
a.params.slideToClickedSlide&&void 0!==a.clickedIndex&&a.clickedIndex!==a.activeIndex){var t=a.clickedIndex;f="auto"===a.params.slidesPerView?a.currentSlidesPerView():a.params.slidesPerView;a.params.loop?a.animating||(b=parseInt(W(a.clickedSlide).attr("data-swiper-slide-index"),10),a.params.centeredSlides?t<a.loopedSlides-f/2||t>a.slides.length-a.loopedSlides+f/2?(a.fixLoop(),t=a.wrapper.children("."+a.params.slideClass+'[data-swiper-slide-index\x3d"'+b+'"]:not(.'+a.params.slideDuplicateClass+")").eq(0).index(),
setTimeout(function(){a.slideTo(t)},0)):a.slideTo(t):t>a.slides.length-f?(a.fixLoop(),t=a.wrapper.children("."+a.params.slideClass+'[data-swiper-slide-index\x3d"'+b+'"]:not(.'+a.params.slideDuplicateClass+")").eq(0).index(),setTimeout(function(){a.slideTo(t)},0)):a.slideTo(t)):a.slideTo(t)}}else a.clickedSlide=void 0,a.clickedIndex=void 0};var fa,ka,la,oa,P,na,ma,J,z=Date.now(),I,da=[],ra;a.animating=!1;a.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var qa,wa;a.onTouchStart=function(b){b.originalEvent&&
(b=b.originalEvent);if((qa="touchstart"===b.type)||!("which"in b)||3!==b.which)if(a.params.noSwiping&&e(b,"."+a.params.noSwipingClass))a.allowClick=!0;else if(!a.params.swipeHandler||e(b,a.params.swipeHandler)){var f=a.touches.currentX="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,D=a.touches.currentY="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY;a.device.ios&&a.params.iOSEdgeSwipeDetection&&f<=a.params.iOSEdgeSwipeThreshold||(fa=!0,ka=!1,la=!0,wa=P=void 0,a.touches.startX=f,a.touches.startY=
D,oa=Date.now(),a.allowClick=!0,a.updateContainerSize(),a.swipeDirection=void 0,0<a.params.threshold&&(J=!1),"touchstart"!==b.type&&(f=!0,W(b.target).is("input, select, textarea, button, video")&&(f=!1),document.activeElement&&W(document.activeElement).is("input, select, textarea, button, video")&&document.activeElement.blur(),f&&b.preventDefault()),a.emit("onTouchStart",a,b))}};a.onTouchMove=function(b){b.originalEvent&&(b=b.originalEvent);if(!qa||"mousemove"!==b.type)if(b.preventedByNestedSwiper)a.touches.startX=
"touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,a.touches.startY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY;else if(a.params.onlyExternal)a.allowClick=!1,fa&&(a.touches.startX=a.touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,a.touches.startY=a.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,oa=Date.now());else{if(qa&&a.params.touchReleaseOnEdges&&!a.params.loop)if(!a.isHorizontal()){if(a.touches.currentY<a.touches.startY&&a.translate<=
a.maxTranslate()||a.touches.currentY>a.touches.startY&&a.translate>=a.minTranslate())return}else if(a.touches.currentX<a.touches.startX&&a.translate<=a.maxTranslate()||a.touches.currentX>a.touches.startX&&a.translate>=a.minTranslate())return;if(qa&&document.activeElement&&b.target===document.activeElement&&W(b.target).is("input, select, textarea, button, video"))ka=!0,a.allowClick=!1;else if(la&&a.emit("onTouchMove",a,b),!(b.targetTouches&&1<b.targetTouches.length)){a.touches.currentX="touchmove"===
b.type?b.targetTouches[0].pageX:b.pageX;a.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY;if("undefined"===typeof P)if(a.isHorizontal()&&a.touches.currentY===a.touches.startY||!a.isHorizontal()&&a.touches.currentX===a.touches.startX)P=!1;else{var f=180*Math.atan2(Math.abs(a.touches.currentY-a.touches.startY),Math.abs(a.touches.currentX-a.touches.startX))/Math.PI;P=a.isHorizontal()?f>a.params.touchAngle:90-f>a.params.touchAngle}P&&a.emit("onTouchMoveOpposite",a,b);"undefined"!==
typeof wa||a.touches.currentX===a.touches.startX&&a.touches.currentY===a.touches.startY||(wa=!0);if(fa)if(P)fa=!1;else if(wa){a.allowClick=!1;a.emit("onSliderMove",a,b);b.preventDefault();a.params.touchMoveStopPropagation&&!a.params.nested&&b.stopPropagation();ka||(r.loop&&a.fixLoop(),ma=a.getWrapperTranslate(),a.setWrapperTransition(0),a.animating&&a.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),a.params.autoplay&&a.autoplaying&&(a.params.autoplayDisableOnInteraction?
a.stopAutoplay():a.pauseAutoplay()),ra=!1,!a.params.grabCursor||!0!==a.params.allowSwipeToNext&&!0!==a.params.allowSwipeToPrev||a.setGrabCursor(!0));ka=!0;f=a.touches.diff=a.isHorizontal()?a.touches.currentX-a.touches.startX:a.touches.currentY-a.touches.startY;f*=a.params.touchRatio;a.rtl&&(f=-f);a.swipeDirection=0<f?"prev":"next";na=f+ma;var D=!0;0<f&&na>a.minTranslate()?(D=!1,a.params.resistance&&(na=a.minTranslate()-1+Math.pow(-a.minTranslate()+ma+f,a.params.resistanceRatio))):0>f&&na<a.maxTranslate()&&
(D=!1,a.params.resistance&&(na=a.maxTranslate()+1-Math.pow(a.maxTranslate()-ma-f,a.params.resistanceRatio)));D&&(b.preventedByNestedSwiper=!0);!a.params.allowSwipeToNext&&"next"===a.swipeDirection&&na<ma&&(na=ma);!a.params.allowSwipeToPrev&&"prev"===a.swipeDirection&&na>ma&&(na=ma);if(0<a.params.threshold)if(Math.abs(f)>a.params.threshold||J){if(!J){J=!0;a.touches.startX=a.touches.currentX;a.touches.startY=a.touches.currentY;na=ma;a.touches.diff=a.isHorizontal()?a.touches.currentX-a.touches.startX:
a.touches.currentY-a.touches.startY;return}}else{na=ma;return}a.params.followFinger&&((a.params.freeMode||a.params.watchSlidesProgress)&&a.updateActiveIndex(),a.params.freeMode&&(0===da.length&&da.push({position:a.touches[a.isHorizontal()?"startX":"startY"],time:oa}),da.push({position:a.touches[a.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),a.updateProgress(na),a.setWrapperTranslate(na))}}}};a.onTouchEnd=function(b){b.originalEvent&&(b=b.originalEvent);la&&a.emit("onTouchEnd",
a,b);la=!1;if(fa){a.params.grabCursor&&ka&&fa&&(!0===a.params.allowSwipeToNext||!0===a.params.allowSwipeToPrev)&&a.setGrabCursor(!1);var f=Date.now(),D=f-oa;a.allowClick&&(a.updateClickedSlide(b),a.emit("onTap",a,b),300>D&&300<f-z&&(I&&clearTimeout(I),I=setTimeout(function(){a&&(a.params.paginationHide&&0<a.paginationContainer.length&&!W(b.target).hasClass(a.params.bulletClass)&&a.paginationContainer.toggleClass(a.params.paginationHiddenClass),a.emit("onClick",a,b))},300)),300>D&&300>f-z&&(I&&clearTimeout(I),
a.emit("onDoubleTap",a,b)));z=Date.now();setTimeout(function(){a&&(a.allowClick=!0)},0);if(fa&&ka&&a.swipeDirection&&0!==a.touches.diff&&na!==ma)if(fa=ka=!1,f=a.params.followFinger?a.rtl?a.translate:-a.translate:-na,a.params.freeMode)if(f<-a.minTranslate())a.slideTo(a.activeIndex);else if(f>-a.maxTranslate())a.slides.length<a.snapGrid.length?a.slideTo(a.snapGrid.length-1):a.slideTo(a.slides.length-1);else{if(a.params.freeModeMomentum){if(1<da.length){f=da.pop();var t=da.pop(),Z=f.time-t.time;a.velocity=
(f.position-t.position)/Z;a.velocity/=2;Math.abs(a.velocity)<a.params.freeModeMinimumVelocity&&(a.velocity=0);if(150<Z||300<(new window.Date).getTime()-f.time)a.velocity=0}else a.velocity=0;a.velocity*=a.params.freeModeMomentumVelocityRatio;da.length=0;f=1E3*a.params.freeModeMomentumRatio;t=a.translate+a.velocity*f;a.rtl&&(t=-t);Z=!1;var ca=20*Math.abs(a.velocity)*a.params.freeModeMomentumBounceRatio;if(t<a.maxTranslate())if(a.params.freeModeMomentumBounce){t+a.maxTranslate()<-ca&&(t=a.maxTranslate()-
ca);var ta=a.maxTranslate();ra=Z=!0}else t=a.maxTranslate();else if(t>a.minTranslate())a.params.freeModeMomentumBounce?(t-a.minTranslate()>ca&&(t=a.minTranslate()+ca),ta=a.minTranslate(),ra=Z=!0):t=a.minTranslate();else if(a.params.freeModeSticky){ca=0;for(ca=0;ca<a.snapGrid.length;ca+=1)if(a.snapGrid[ca]>-t){var g=ca;break}t=Math.abs(a.snapGrid[g]-t)<Math.abs(a.snapGrid[g-1]-t)||"next"===a.swipeDirection?a.snapGrid[g]:a.snapGrid[g-1];a.rtl||(t=-t)}if(0!==a.velocity)f=a.rtl?Math.abs((-t-a.translate)/
a.velocity):Math.abs((t-a.translate)/a.velocity);else if(a.params.freeModeSticky){a.slideReset();return}a.params.freeModeMomentumBounce&&Z?(a.updateProgress(ta),a.setWrapperTransition(f),a.setWrapperTranslate(t),a.onTransitionStart(),a.animating=!0,a.wrapper.transitionEnd(function(){a&&ra&&(a.emit("onMomentumBounce",a),a.setWrapperTransition(a.params.speed),a.setWrapperTranslate(ta),a.wrapper.transitionEnd(function(){if(a)a.onTransitionEnd()}))})):a.velocity?(a.updateProgress(t),a.setWrapperTransition(f),
a.setWrapperTranslate(t),a.onTransitionStart(),a.animating||(a.animating=!0,a.wrapper.transitionEnd(function(){if(a)a.onTransitionEnd()}))):a.updateProgress(t);a.updateActiveIndex()}if(!a.params.freeModeMomentum||D>=a.params.longSwipesMs)a.updateProgress(),a.updateActiveIndex()}else{g=0;Z=a.slidesSizesGrid[0];for(t=0;t<a.slidesGrid.length;t+=a.params.slidesPerGroup)"undefined"!==typeof a.slidesGrid[t+a.params.slidesPerGroup]?f>=a.slidesGrid[t]&&f<a.slidesGrid[t+a.params.slidesPerGroup]&&(g=t,Z=a.slidesGrid[t+
a.params.slidesPerGroup]-a.slidesGrid[t]):f>=a.slidesGrid[t]&&(g=t,Z=a.slidesGrid[a.slidesGrid.length-1]-a.slidesGrid[a.slidesGrid.length-2]);f=(f-a.slidesGrid[g])/Z;D>a.params.longSwipesMs?a.params.longSwipes?("next"===a.swipeDirection&&(f>=a.params.longSwipesRatio?a.slideTo(g+a.params.slidesPerGroup):a.slideTo(g)),"prev"===a.swipeDirection&&(f>1-a.params.longSwipesRatio?a.slideTo(g+a.params.slidesPerGroup):a.slideTo(g))):a.slideTo(a.activeIndex):a.params.shortSwipes?("next"===a.swipeDirection&&
a.slideTo(g+a.params.slidesPerGroup),"prev"===a.swipeDirection&&a.slideTo(g)):a.slideTo(a.activeIndex)}else fa=ka=!1}};a._slideTo=function(b,f){return a.slideTo(b,f,!0,!0)};a.slideTo=function(b,f,D,t){"undefined"===typeof D&&(D=!0);"undefined"===typeof b&&(b=0);0>b&&(b=0);a.snapIndex=Math.floor(b/a.params.slidesPerGroup);a.snapIndex>=a.snapGrid.length&&(a.snapIndex=a.snapGrid.length-1);var Z=-a.snapGrid[a.snapIndex];a.params.autoplay&&a.autoplaying&&(t||!a.params.autoplayDisableOnInteraction?a.pauseAutoplay(f):
a.stopAutoplay());a.updateProgress(Z);if(a.params.normalizeSlideIndex)for(t=0;t<a.slidesGrid.length;t++)-Math.floor(100*Z)>=Math.floor(100*a.slidesGrid[t])&&(b=t);if(!a.params.allowSwipeToNext&&Z<a.translate&&Z<a.minTranslate()||!a.params.allowSwipeToPrev&&Z>a.translate&&Z>a.maxTranslate()&&(a.activeIndex||0)!==b)return!1;"undefined"===typeof f&&(f=a.params.speed);a.previousIndex=a.activeIndex||0;a.activeIndex=b;a.updateRealIndex();if(a.rtl&&-Z===a.translate||!a.rtl&&Z===a.translate)return a.params.autoHeight&&
a.updateAutoHeight(),a.updateClasses(),"slide"!==a.params.effect&&a.setWrapperTranslate(Z),!1;a.updateClasses();a.onTransitionStart(D);0===f||a.browser.lteIE9?(a.setWrapperTranslate(Z),a.setWrapperTransition(0),a.onTransitionEnd(D)):(a.setWrapperTranslate(Z),a.setWrapperTransition(f),a.animating||(a.animating=!0,a.wrapper.transitionEnd(function(){if(a)a.onTransitionEnd(D)})));return!0};a.onTransitionStart=function(b){"undefined"===typeof b&&(b=!0);a.params.autoHeight&&a.updateAutoHeight();if(a.lazy)a.lazy.onTransitionStart();
b&&(a.emit("onTransitionStart",a),a.activeIndex!==a.previousIndex&&(a.emit("onSlideChangeStart",a),a.activeIndex>a.previousIndex?a.emit("onSlideNextStart",a):a.emit("onSlidePrevStart",a)))};a.onTransitionEnd=function(b){a.animating=!1;a.setWrapperTransition(0);"undefined"===typeof b&&(b=!0);if(a.lazy)a.lazy.onTransitionEnd();b&&(a.emit("onTransitionEnd",a),a.activeIndex!==a.previousIndex&&(a.emit("onSlideChangeEnd",a),a.activeIndex>a.previousIndex?a.emit("onSlideNextEnd",a):a.emit("onSlidePrevEnd",
a)));a.params.history&&a.history&&a.history.setHistory(a.params.history,a.activeIndex);a.params.hashnav&&a.hashnav&&a.hashnav.setHash()};a.slideNext=function(b,f,D){if(a.params.loop){if(a.animating)return!1;a.fixLoop()}return a.slideTo(a.activeIndex+a.params.slidesPerGroup,f,b,D)};a._slideNext=function(b){return a.slideNext(!0,b,!0)};a.slidePrev=function(b,f,D){if(a.params.loop){if(a.animating)return!1;a.fixLoop()}return a.slideTo(a.activeIndex-1,f,b,D)};a._slidePrev=function(b){return a.slidePrev(!0,
b,!0)};a.slideReset=function(b,f,D){return a.slideTo(a.activeIndex,f,b)};a.disableTouchControl=function(){return a.params.onlyExternal=!0};a.enableTouchControl=function(){a.params.onlyExternal=!1;return!0};a.setWrapperTransition=function(b,f){a.wrapper.transition(b);"slide"!==a.params.effect&&a.effects[a.params.effect]&&a.effects[a.params.effect].setTransition(b);a.params.parallax&&a.parallax&&a.parallax.setTransition(b);a.params.scrollbar&&a.scrollbar&&a.scrollbar.setTransition(b);a.params.control&&
a.controller&&a.controller.setTransition(b,f);a.emit("onSetTransition",a,b)};a.setWrapperTranslate=function(b,f,D){var t=0,Z=0;a.isHorizontal()?t=a.rtl?-b:b:Z=b;a.params.roundLengths&&(t=Math.floor(t),Z=Math.floor(Z));a.params.virtualTranslate||(a.support.transforms3d?a.wrapper.transform("translate3d("+t+"px, "+Z+"px, 0px)"):a.wrapper.transform("translate("+t+"px, "+Z+"px)"));a.translate=a.isHorizontal()?t:Z;t=a.maxTranslate()-a.minTranslate();(0===t?0:(b-a.minTranslate())/t)!==a.progress&&a.updateProgress(b);
f&&a.updateActiveIndex();"slide"!==a.params.effect&&a.effects[a.params.effect]&&a.effects[a.params.effect].setTranslate(a.translate);a.params.parallax&&a.parallax&&a.parallax.setTranslate(a.translate);a.params.scrollbar&&a.scrollbar&&a.scrollbar.setTranslate(a.translate);a.params.control&&a.controller&&a.controller.setTranslate(a.translate,D);a.emit("onSetTranslate",a,a.translate)};a.getTranslate=function(b,f){"undefined"===typeof f&&(f="x");if(a.params.virtualTranslate)return a.rtl?-a.translate:
a.translate;b=window.getComputedStyle(b,null);if(window.WebKitCSSMatrix){var D=b.transform||b.webkitTransform;6<D.split(",").length&&(D=D.split(", ").map(function(Z){return Z.replace(",",".")}).join(", "));b=new window.WebKitCSSMatrix("none"===D?"":D)}else{b=b.MozTransform||b.OTransform||b.MsTransform||b.msTransform||b.transform||b.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,");var t=b.toString().split(",")}"x"===f&&(D=window.WebKitCSSMatrix?b.m41:16===t.length?parseFloat(t[12]):
parseFloat(t[4]));"y"===f&&(D=window.WebKitCSSMatrix?b.m42:16===t.length?parseFloat(t[13]):parseFloat(t[5]));a.rtl&&D&&(D=-D);return D||0};a.getWrapperTranslate=function(b){"undefined"===typeof b&&(b=a.isHorizontal()?"x":"y");return a.getTranslate(a.wrapper[0],b)};a.observers=[];a.initObservers=function(){if(a.params.observeParents)for(var b=a.container.parents(),f=0;f<b.length;f++)l(b[f]);l(a.container[0],{childList:!1});l(a.wrapper[0],{attributes:!1})};a.disconnectObservers=function(){for(var b=
0;b<a.observers.length;b++)a.observers[b].disconnect();a.observers=[]};a.createLoop=function(){a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass).remove();var b=a.wrapper.children("."+a.params.slideClass);"auto"!==a.params.slidesPerView||a.params.loopedSlides||(a.params.loopedSlides=b.length);a.loopedSlides=parseInt(a.params.loopedSlides||a.params.slidesPerView,10);a.loopedSlides+=a.params.loopAdditionalSlides;a.loopedSlides>b.length&&(a.loopedSlides=b.length);var f=[],D=
[],t;b.each(function(Z,ca){var ta=W(this);Z<a.loopedSlides&&D.push(ca);Z<b.length&&Z>=b.length-a.loopedSlides&&f.push(ca);ta.attr("data-swiper-slide-index",Z)});for(t=0;t<D.length;t++)a.wrapper.append(W(D[t].cloneNode(!0)).addClass(a.params.slideDuplicateClass));for(t=f.length-1;0<=t;t--)a.wrapper.prepend(W(f[t].cloneNode(!0)).addClass(a.params.slideDuplicateClass))};a.destroyLoop=function(){a.wrapper.children("."+a.params.slideClass+"."+a.params.slideDuplicateClass).remove();a.slides.removeAttr("data-swiper-slide-index")};
a.reLoop=function(b){var f=a.activeIndex-a.loopedSlides;a.destroyLoop();a.createLoop();a.updateSlidesSize();b&&a.slideTo(f+a.loopedSlides,0,!1)};a.fixLoop=function(){if(a.activeIndex<a.loopedSlides){var b=a.slides.length-3*a.loopedSlides+a.activeIndex;b+=a.loopedSlides;a.slideTo(b,0,!1,!0)}else if("auto"===a.params.slidesPerView&&a.activeIndex>=2*a.loopedSlides||a.activeIndex>a.slides.length-2*a.params.slidesPerView)b=-a.slides.length+a.activeIndex+a.loopedSlides,b+=a.loopedSlides,a.slideTo(b,0,!1,
!0)};a.appendSlide=function(b){a.params.loop&&a.destroyLoop();if("object"===typeof b&&b.length)for(var f=0;f<b.length;f++)b[f]&&a.wrapper.append(b[f]);else a.wrapper.append(b);a.params.loop&&a.createLoop();a.params.observer&&a.support.observer||a.update(!0)};a.prependSlide=function(b){a.params.loop&&a.destroyLoop();var f=a.activeIndex+1;if("object"===typeof b&&b.length){for(f=0;f<b.length;f++)b[f]&&a.wrapper.prepend(b[f]);f=a.activeIndex+b.length}else a.wrapper.prepend(b);a.params.loop&&a.createLoop();
a.params.observer&&a.support.observer||a.update(!0);a.slideTo(f,0,!1)};a.removeSlide=function(b){a.params.loop&&(a.destroyLoop(),a.slides=a.wrapper.children("."+a.params.slideClass));var f=a.activeIndex;if("object"===typeof b&&b.length)for(var D=0;D<b.length;D++){var t=b[D];a.slides[t]&&a.slides.eq(t).remove();t<f&&f--}else t=b,a.slides[t]&&a.slides.eq(t).remove(),t<f&&f--;f=Math.max(f,0);a.params.loop&&a.createLoop();a.params.observer&&a.support.observer||a.update(!0);a.params.loop?a.slideTo(f+a.loopedSlides,
0,!1):a.slideTo(f,0,!1)};a.removeAllSlides=function(){for(var b=[],f=0;f<a.slides.length;f++)b.push(f);a.removeSlide(b)};a.effects={fade:{setTranslate:function(){for(var b=0;b<a.slides.length;b++){var f=a.slides.eq(b),D=-f[0].swiperSlideOffset;a.params.virtualTranslate||(D-=a.translate);var t=0;a.isHorizontal()||(t=D,D=0);f.css({opacity:a.params.fade.crossFade?Math.max(1-Math.abs(f[0].progress),0):1+Math.min(Math.max(f[0].progress,-1),0)}).transform("translate3d("+D+"px, "+t+"px, 0px)")}},setTransition:function(b){a.slides.transition(b);
if(a.params.virtualTranslate&&0!==b){var f=!1;a.slides.transitionEnd(function(){if(!f&&a){f=!0;a.animating=!1;for(var D=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],t=0;t<D.length;t++)a.wrapper.trigger(D[t])}})}}},flip:{setTranslate:function(){for(var b=0;b<a.slides.length;b++){var f=a.slides.eq(b),D=f[0].progress;a.params.flip.limitRotation&&(D=Math.max(Math.min(f[0].progress,1),-1));var t=-180*D,Z=0,ca=-f[0].swiperSlideOffset,ta=0;a.isHorizontal()?
a.rtl&&(t=-t):(ta=ca,ca=0,Z=-t,t=0);f[0].style.zIndex=-Math.abs(Math.round(D))+a.slides.length;if(a.params.flip.slideShadows){var g=a.isHorizontal()?f.find(".swiper-slide-shadow-left"):f.find(".swiper-slide-shadow-top"),L=a.isHorizontal()?f.find(".swiper-slide-shadow-right"):f.find(".swiper-slide-shadow-bottom");0===g.length&&(g=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"left":"top")+'"\x3e\x3c/div\x3e'),f.append(g));0===L.length&&(L=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?
"right":"bottom")+'"\x3e\x3c/div\x3e'),f.append(L));g.length&&(g[0].style.opacity=Math.max(-D,0));L.length&&(L[0].style.opacity=Math.max(D,0))}f.transform("translate3d("+ca+"px, "+ta+"px, 0px) rotateX("+Z+"deg) rotateY("+t+"deg)")}},setTransition:function(b){a.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b);if(a.params.virtualTranslate&&0!==b){var f=!1;a.slides.eq(a.activeIndex).transitionEnd(function(){if(!f&&
a&&W(this).hasClass(a.params.slideActiveClass)){f=!0;a.animating=!1;for(var D=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],t=0;t<D.length;t++)a.wrapper.trigger(D[t])}})}}},cube:{setTranslate:function(){var b=0;if(a.params.cube.shadow)if(a.isHorizontal()){var f=a.wrapper.find(".swiper-cube-shadow");0===f.length&&(f=W('\x3cdiv class\x3d"swiper-cube-shadow"\x3e\x3c/div\x3e'),a.wrapper.append(f));f.css({height:a.width+"px"})}else f=a.container.find(".swiper-cube-shadow"),
0===f.length&&(f=W('\x3cdiv class\x3d"swiper-cube-shadow"\x3e\x3c/div\x3e'),a.container.append(f));for(var D=0;D<a.slides.length;D++){var t=a.slides.eq(D),Z=90*D,ca=Math.floor(Z/360);a.rtl&&(Z=-Z,ca=Math.floor(-Z/360));var ta=Math.max(Math.min(t[0].progress,1),-1),g=0,L=0,U=0;0===D%4?(g=4*-ca*a.size,U=0):0===(D-1)%4?(g=0,U=4*-ca*a.size):0===(D-2)%4?(g=a.size+4*ca*a.size,U=a.size):0===(D-3)%4&&(g=-a.size,U=3*a.size+4*a.size*ca);a.rtl&&(g=-g);a.isHorizontal()||(L=g,g=0);Z="rotateX("+(a.isHorizontal()?
0:-Z)+"deg) rotateY("+(a.isHorizontal()?Z:0)+"deg) translate3d("+g+"px, "+L+"px, "+U+"px)";1>=ta&&-1<ta&&(b=90*D+90*ta,a.rtl&&(b=90*-D-90*ta));t.transform(Z);a.params.cube.slideShadows&&(Z=a.isHorizontal()?t.find(".swiper-slide-shadow-left"):t.find(".swiper-slide-shadow-top"),ca=a.isHorizontal()?t.find(".swiper-slide-shadow-right"):t.find(".swiper-slide-shadow-bottom"),0===Z.length&&(Z=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"left":"top")+'"\x3e\x3c/div\x3e'),t.append(Z)),0===
ca.length&&(ca=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"right":"bottom")+'"\x3e\x3c/div\x3e'),t.append(ca)),Z.length&&(Z[0].style.opacity=Math.max(-ta,0)),ca.length&&(ca[0].style.opacity=Math.max(ta,0)))}a.wrapper.css({"-webkit-transform-origin":"50% 50% -"+a.size/2+"px","-moz-transform-origin":"50% 50% -"+a.size/2+"px","-ms-transform-origin":"50% 50% -"+a.size/2+"px","transform-origin":"50% 50% -"+a.size/2+"px"});a.params.cube.shadow&&(a.isHorizontal()?f.transform("translate3d(0px, "+
(a.width/2+a.params.cube.shadowOffset)+"px, "+-a.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+a.params.cube.shadowScale+")"):(D=Math.abs(b)-90*Math.floor(Math.abs(b)/90),D=a.params.cube.shadowScale/(1.5-(Math.sin(2*D*Math.PI/360)/2+Math.cos(2*D*Math.PI/360)/2)),f.transform("scale3d("+a.params.cube.shadowScale+", 1, "+D+") translate3d(0px, "+(a.height/2+a.params.cube.shadowOffset)+"px, "+-a.height/2/D+"px) rotateX(-90deg)")));a.wrapper.transform("translate3d(0px,0,"+(a.isSafari||a.isUiWebView?
-a.size/2:0)+"px) rotateX("+(a.isHorizontal()?0:b)+"deg) rotateY("+(a.isHorizontal()?-b:0)+"deg)")},setTransition:function(b){a.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b);a.params.cube.shadow&&!a.isHorizontal()&&a.container.find(".swiper-cube-shadow").transition(b)}},coverflow:{setTranslate:function(){var b=a.translate;b=a.isHorizontal()?-b+a.width/2:-b+a.height/2;for(var f=a.isHorizontal()?
a.params.coverflow.rotate:-a.params.coverflow.rotate,D=a.params.coverflow.depth,t=0,Z=a.slides.length;t<Z;t++){var ca=a.slides.eq(t),ta=a.slidesSizesGrid[t];ta=(b-ca[0].swiperSlideOffset-ta/2)/ta*a.params.coverflow.modifier;var g=a.isHorizontal()?f*ta:0,L=a.isHorizontal()?0:f*ta,U=-D*Math.abs(ta),Y=a.isHorizontal()?0:a.params.coverflow.stretch*ta,ha=a.isHorizontal()?a.params.coverflow.stretch*ta:0;.001>Math.abs(ha)&&(ha=0);.001>Math.abs(Y)&&(Y=0);.001>Math.abs(U)&&(U=0);.001>Math.abs(g)&&(g=0);.001>
Math.abs(L)&&(L=0);ca.transform("translate3d("+ha+"px,"+Y+"px,"+U+"px)  rotateX("+L+"deg) rotateY("+g+"deg)");ca[0].style.zIndex=-Math.abs(Math.round(ta))+1;a.params.coverflow.slideShadows&&(g=a.isHorizontal()?ca.find(".swiper-slide-shadow-left"):ca.find(".swiper-slide-shadow-top"),L=a.isHorizontal()?ca.find(".swiper-slide-shadow-right"):ca.find(".swiper-slide-shadow-bottom"),0===g.length&&(g=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"left":"top")+'"\x3e\x3c/div\x3e'),ca.append(g)),
0===L.length&&(L=W('\x3cdiv class\x3d"swiper-slide-shadow-'+(a.isHorizontal()?"right":"bottom")+'"\x3e\x3c/div\x3e'),ca.append(L)),g.length&&(g[0].style.opacity=0<ta?ta:0),L.length&&(L[0].style.opacity=0<-ta?-ta:0))}a.browser.ie&&(a.wrapper[0].style.perspectiveOrigin=b+"px 50%")},setTransition:function(b){a.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b)}}};a.lazy={initialImageLoaded:!1,loadImageInSlide:function(b,
f){if("undefined"!==typeof b&&("undefined"===typeof f&&(f=!0),0!==a.slides.length)){var D=a.slides.eq(b);b=D.find("."+a.params.lazyLoadingClass+":not(."+a.params.lazyStatusLoadedClass+"):not(."+a.params.lazyStatusLoadingClass+")");!D.hasClass(a.params.lazyLoadingClass)||D.hasClass(a.params.lazyStatusLoadedClass)||D.hasClass(a.params.lazyStatusLoadingClass)||(b=b.add(D[0]));0!==b.length&&b.each(function(){var t=W(this);t.addClass(a.params.lazyStatusLoadingClass);var Z=t.attr("data-background"),ca=
t.attr("data-src"),ta=t.attr("data-srcset"),g=t.attr("data-sizes");a.loadImage(t[0],ca||Z,ta,g,!1,function(){if("undefined"!==typeof a&&null!==a&&a){Z?(t.css("background-image",'url("'+Z+'")'),t.removeAttr("data-background")):(ta&&(t.attr("srcset",ta),t.removeAttr("data-srcset")),g&&(t.attr("sizes",g),t.removeAttr("data-sizes")),ca&&(t.attr("src",ca),t.removeAttr("data-src")));t.addClass(a.params.lazyStatusLoadedClass).removeClass(a.params.lazyStatusLoadingClass);D.find("."+a.params.lazyPreloaderClass+
", ."+a.params.preloaderClass).remove();if(a.params.loop&&f){var L=D.attr("data-swiper-slide-index");D.hasClass(a.params.slideDuplicateClass)?(L=a.wrapper.children('[data-swiper-slide-index\x3d"'+L+'"]:not(.'+a.params.slideDuplicateClass+")"),a.lazy.loadImageInSlide(L.index(),!1)):(L=a.wrapper.children("."+a.params.slideDuplicateClass+'[data-swiper-slide-index\x3d"'+L+'"]'),a.lazy.loadImageInSlide(L.index(),!1))}a.emit("onLazyImageReady",a,D[0],t[0])}});a.emit("onLazyImageLoad",a,D[0],t[0])})}},load:function(){var b,
f=a.params.slidesPerView;"auto"===f&&(f=0);a.lazy.initialImageLoaded||(a.lazy.initialImageLoaded=!0);if(a.params.watchSlidesVisibility)a.wrapper.children("."+a.params.slideVisibleClass).each(function(){a.lazy.loadImageInSlide(W(this).index())});else if(1<f)for(b=a.activeIndex;b<a.activeIndex+f;b++)a.slides[b]&&a.lazy.loadImageInSlide(b);else a.lazy.loadImageInSlide(a.activeIndex);if(a.params.lazyLoadingInPrevNext)if(1<f||a.params.lazyLoadingInPrevNextAmount&&1<a.params.lazyLoadingInPrevNextAmount){b=
a.params.lazyLoadingInPrevNextAmount;var D=f,t=Math.min(a.activeIndex+D+Math.max(b,D),a.slides.length);D=Math.max(a.activeIndex-Math.max(D,b),0);for(b=a.activeIndex+f;b<t;b++)a.slides[b]&&a.lazy.loadImageInSlide(b);for(b=D;b<a.activeIndex;b++)a.slides[b]&&a.lazy.loadImageInSlide(b)}else f=a.wrapper.children("."+a.params.slideNextClass),0<f.length&&a.lazy.loadImageInSlide(f.index()),f=a.wrapper.children("."+a.params.slidePrevClass),0<f.length&&a.lazy.loadImageInSlide(f.index())},onTransitionStart:function(){a.params.lazyLoading&&
(a.params.lazyLoadingOnTransitionStart||!a.params.lazyLoadingOnTransitionStart&&!a.lazy.initialImageLoaded)&&a.lazy.load()},onTransitionEnd:function(){a.params.lazyLoading&&!a.params.lazyLoadingOnTransitionStart&&a.lazy.load()}};y=!1!==a.params.simulateTouch||a.support.touch?a.touchEvents:a.touchEventsDesktop;a.scrollbar={isTouched:!1,setDragPosition:function(b){var f=a.scrollbar;b=(a.isHorizontal()?"touchstart"===b.type||"touchmove"===b.type?b.targetTouches[0].pageX:b.pageX||b.clientX:"touchstart"===
b.type||"touchmove"===b.type?b.targetTouches[0].pageY:b.pageY||b.clientY)-f.track.offset()[a.isHorizontal()?"left":"top"]-f.dragSize/2;var D=-a.minTranslate()*f.moveDivider,t=-a.maxTranslate()*f.moveDivider;b<D?b=D:b>t&&(b=t);b=-b/f.moveDivider;a.updateProgress(b);a.setWrapperTranslate(b,!0)},dragStart:function(b){var f=a.scrollbar;f.isTouched=!0;b.preventDefault();b.stopPropagation();f.setDragPosition(b);clearTimeout(f.dragTimeout);f.track.transition(0);a.params.scrollbarHide&&f.track.css("opacity",
1);a.wrapper.transition(100);f.drag.transition(100);a.emit("onScrollbarDragStart",a)},dragMove:function(b){var f=a.scrollbar;f.isTouched&&(b.preventDefault?b.preventDefault():b.returnValue=!1,f.setDragPosition(b),a.wrapper.transition(0),f.track.transition(0),f.drag.transition(0),a.emit("onScrollbarDragMove",a))},dragEnd:function(b){var f=a.scrollbar;f.isTouched&&(f.isTouched=!1,a.params.scrollbarHide&&(clearTimeout(f.dragTimeout),f.dragTimeout=setTimeout(function(){f.track.css("opacity",0);f.track.transition(400)},
1E3)),a.emit("onScrollbarDragEnd",a),a.params.scrollbarSnapOnRelease&&a.slideReset())},draggableEvents:y,enableDraggable:function(){var b=a.scrollbar,f=a.support.touch?b.track:document;W(b.track).on(b.draggableEvents.start,b.dragStart);W(f).on(b.draggableEvents.move,b.dragMove);W(f).on(b.draggableEvents.end,b.dragEnd)},disableDraggable:function(){var b=a.scrollbar,f=a.support.touch?b.track:document;W(b.track).off(b.draggableEvents.start,b.dragStart);W(f).off(b.draggableEvents.move,b.dragMove);W(f).off(b.draggableEvents.end,
b.dragEnd)},set:function(){if(a.params.scrollbar){var b=a.scrollbar;b.track=W(a.params.scrollbar);a.params.uniqueNavElements&&"string"===typeof a.params.scrollbar&&1<b.track.length&&1===a.container.find(a.params.scrollbar).length&&(b.track=a.container.find(a.params.scrollbar));b.drag=b.track.find(".swiper-scrollbar-drag");0===b.drag.length&&(b.drag=W('\x3cdiv class\x3d"swiper-scrollbar-drag"\x3e\x3c/div\x3e'),b.track.append(b.drag));b.drag[0].style.width="";b.drag[0].style.height="";b.trackSize=a.isHorizontal()?
b.track[0].offsetWidth:b.track[0].offsetHeight;b.divider=a.size/a.virtualSize;b.moveDivider=b.trackSize/a.size*b.divider;b.dragSize=b.trackSize*b.divider;a.isHorizontal()?b.drag[0].style.width=b.dragSize+"px":b.drag[0].style.height=b.dragSize+"px";b.track[0].style.display=1<=b.divider?"none":"";a.params.scrollbarHide&&(b.track[0].style.opacity=0)}},setTranslate:function(){if(a.params.scrollbar){var b=a.scrollbar,f=b.dragSize;var D=(b.trackSize-b.dragSize)*a.progress;a.rtl&&a.isHorizontal()?(D=-D,
0<D?(f=b.dragSize-D,D=0):-D+b.dragSize>b.trackSize&&(f=b.trackSize+D)):0>D?(f=b.dragSize+D,D=0):D+b.dragSize>b.trackSize&&(f=b.trackSize-D);a.isHorizontal()?(a.support.transforms3d?b.drag.transform("translate3d("+D+"px, 0, 0)"):b.drag.transform("translateX("+D+"px)"),b.drag[0].style.width=f+"px"):(a.support.transforms3d?b.drag.transform("translate3d(0px, "+D+"px, 0)"):b.drag.transform("translateY("+D+"px)"),b.drag[0].style.height=f+"px");a.params.scrollbarHide&&(clearTimeout(b.timeout),b.track[0].style.opacity=
1,b.timeout=setTimeout(function(){b.track[0].style.opacity=0;b.track.transition(400)},1E3))}},setTransition:function(b){a.params.scrollbar&&a.scrollbar.drag.transition(b)}};a.controller={LinearSpline:function(b,f){var D=function(){var ca,ta,g;return function(L,U){ta=-1;for(ca=L.length;1<ca-ta;)L[g=ca+ta>>1]<=U?ta=g:ca=g;return ca}}();this.x=b;this.y=f;this.lastIndex=b.length-1;var t,Z;this.interpolate=function(ca){if(!ca)return 0;Z=D(this.x,ca);t=Z-1;return(ca-this.x[t])*(this.y[Z]-this.y[t])/(this.x[Z]-
this.x[t])+this.y[t]}},getInterpolateFunction:function(b){a.controller.spline||(a.controller.spline=a.params.loop?new a.controller.LinearSpline(a.slidesGrid,b.slidesGrid):new a.controller.LinearSpline(a.snapGrid,b.snapGrid))},setTranslate:function(b,f){function D(g){b=g.rtl&&"horizontal"===g.params.direction?-a.translate:a.translate;"slide"===a.params.controlBy&&(a.controller.getInterpolateFunction(g),ca=-a.controller.spline.interpolate(-b));ca&&"container"!==a.params.controlBy||(Z=(g.maxTranslate()-
g.minTranslate())/(a.maxTranslate()-a.minTranslate()),ca=(b-a.minTranslate())*Z+g.minTranslate());a.params.controlInverse&&(ca=g.maxTranslate()-ca);g.updateProgress(ca);g.setWrapperTranslate(ca,!1,a);g.updateActiveIndex()}var t=a.params.control,Z,ca;if(Array.isArray(t))for(var ta=0;ta<t.length;ta++)t[ta]!==f&&t[ta]instanceof u&&D(t[ta]);else t instanceof u&&f!==t&&D(t)},setTransition:function(b,f){function D(ca){ca.setWrapperTransition(b,a);0!==b&&(ca.onTransitionStart(),ca.wrapper.transitionEnd(function(){t&&
(ca.params.loop&&"slide"===a.params.controlBy&&ca.fixLoop(),ca.onTransitionEnd())}))}var t=a.params.control,Z;if(Array.isArray(t))for(Z=0;Z<t.length;Z++)t[Z]!==f&&t[Z]instanceof u&&D(t[Z]);else t instanceof u&&f!==t&&D(t)}};a.hashnav={onHashCange:function(b,f){b=document.location.hash.replace("#","");f=a.slides.eq(a.activeIndex).attr("data-hash");b!==f&&a.slideTo(a.wrapper.children("."+a.params.slideClass+'[data-hash\x3d"'+b+'"]').index())},attachEvents:function(b){b=b?"off":"on";W(window)[b]("hashchange",
a.hashnav.onHashCange)},setHash:function(){if(a.hashnav.initialized&&a.params.hashnav)if(a.params.replaceState&&window.history&&window.history.replaceState)window.history.replaceState(null,null,"#"+a.slides.eq(a.activeIndex).attr("data-hash")||"");else{var b=a.slides.eq(a.activeIndex);b=b.attr("data-hash")||b.attr("data-history");document.location.hash=b||""}},init:function(){if(a.params.hashnav&&!a.params.history){a.hashnav.initialized=!0;var b=document.location.hash.replace("#","");if(b)for(var f=
0,D=a.slides.length;f<D;f++){var t=a.slides.eq(f);(t.attr("data-hash")||t.attr("data-history"))!==b||t.hasClass(a.params.slideDuplicateClass)||(t=t.index(),a.slideTo(t,0,a.params.runCallbacksOnInit,!0))}a.params.hashnavWatchState&&a.hashnav.attachEvents()}},destroy:function(){a.params.hashnavWatchState&&a.hashnav.attachEvents(!0)}};a.history={init:function(){if(a.params.history)if(window.history&&window.history.pushState){if(a.history.initialized=!0,this.paths=this.getPathValues(),this.paths.key||
this.paths.value)this.scrollToSlide(0,this.paths.value,a.params.runCallbacksOnInit),a.params.replaceState||window.addEventListener("popstate",this.setHistoryPopState)}else a.params.history=!1,a.params.hashnav=!0},setHistoryPopState:function(){a.history.paths=a.history.getPathValues();a.history.scrollToSlide(a.params.speed,a.history.paths.value,!1)},getPathValues:function(){var b=window.location.pathname.slice(1).split("/"),f=b.length;return{key:b[f-2],value:b[f-1]}},setHistory:function(b,f){a.history.initialized&&
a.params.history&&(f=a.slides.eq(f),f=this.slugify(f.attr("data-history")),window.location.pathname.includes(b)||(f=b+"/"+f),a.params.replaceState?window.history.replaceState(null,null,f):window.history.pushState(null,null,f))},slugify:function(b){return b.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(b,f,D){if(f)for(var t=0,Z=a.slides.length;t<Z;t++){var ca=a.slides.eq(t);this.slugify(ca.attr("data-history"))!==
f||ca.hasClass(a.params.slideDuplicateClass)||(ca=ca.index(),a.slideTo(ca,b,D))}else a.slideTo(0,b,D)}};a.disableKeyboardControl=function(){a.params.keyboardControl=!1;W(document).off("keydown",m)};a.enableKeyboardControl=function(){a.params.keyboardControl=!0;W(document).on("keydown",m)};a.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()};a.params.mousewheelControl&&(a.mousewheel.event=-1<navigator.userAgent.indexOf("firefox")?"DOMMouseScroll":n()?"wheel":"mousewheel");a.disableMousewheelControl=
function(){if(!a.mousewheel.event)return!1;var b=a.container;"container"!==a.params.mousewheelEventsTarged&&(b=W(a.params.mousewheelEventsTarged));b.off(a.mousewheel.event,x);a.params.mousewheelControl=!1;return!0};a.enableMousewheelControl=function(){if(!a.mousewheel.event)return!1;var b=a.container;"container"!==a.params.mousewheelEventsTarged&&(b=W(a.params.mousewheelEventsTarged));b.on(a.mousewheel.event,x);return a.params.mousewheelControl=!0};a.parallax={setTranslate:function(){a.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){F(this,
a.progress)});a.slides.each(function(){var b=W(this);b.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){F(this,Math.min(Math.max(b[0].progress,-1),1))})})},setTransition:function(b){"undefined"===typeof b&&(b=a.params.speed);a.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var f=W(this),D=parseInt(f.attr("data-swiper-parallax-duration"),10)||b;0===b&&(D=0);f.transition(D)})}};a.zoom={scale:1,
currentScale:1,isScaling:!1,gesture:{slide:void 0,slideWidth:void 0,slideHeight:void 0,image:void 0,imageWrap:void 0,zoomMax:a.params.zoomMax},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0},getDistanceBetweenTouches:function(b){return 2>b.targetTouches.length?
1:Math.sqrt(Math.pow(b.targetTouches[1].pageX-b.targetTouches[0].pageX,2)+Math.pow(b.targetTouches[1].pageY-b.targetTouches[0].pageY,2))},onGestureStart:function(b){var f=a.zoom;if(!a.support.gestures){if("touchstart"!==b.type||"touchstart"===b.type&&2>b.targetTouches.length)return;f.gesture.scaleStart=f.getDistanceBetweenTouches(b)}if(!f.gesture.slide||!f.gesture.slide.length)if(f.gesture.slide=W(this),0===f.gesture.slide.length&&(f.gesture.slide=a.slides.eq(a.activeIndex)),f.gesture.image=f.gesture.slide.find("img, svg, canvas"),
f.gesture.imageWrap=f.gesture.image.parent("."+a.params.zoomContainerClass),f.gesture.zoomMax=f.gesture.imageWrap.attr("data-swiper-zoom")||a.params.zoomMax,0===f.gesture.imageWrap.length){f.gesture.image=void 0;return}f.gesture.image.transition(0);f.isScaling=!0},onGestureChange:function(b){var f=a.zoom;if(!a.support.gestures){if("touchmove"!==b.type||"touchmove"===b.type&&2>b.targetTouches.length)return;f.gesture.scaleMove=f.getDistanceBetweenTouches(b)}f.gesture.image&&0!==f.gesture.image.length&&
(f.scale=a.support.gestures?b.scale*f.currentScale:f.gesture.scaleMove/f.gesture.scaleStart*f.currentScale,f.scale>f.gesture.zoomMax&&(f.scale=f.gesture.zoomMax-1+Math.pow(f.scale-f.gesture.zoomMax+1,.5)),f.scale<a.params.zoomMin&&(f.scale=a.params.zoomMin+1-Math.pow(a.params.zoomMin-f.scale+1,.5)),f.gesture.image.transform("translate3d(0,0,0) scale("+f.scale+")"))},onGestureEnd:function(b){var f=a.zoom;!a.support.gestures&&("touchend"!==b.type||"touchend"===b.type&&2>b.changedTouches.length)||!f.gesture.image||
0===f.gesture.image.length||(f.scale=Math.max(Math.min(f.scale,f.gesture.zoomMax),a.params.zoomMin),f.gesture.image.transition(a.params.speed).transform("translate3d(0,0,0) scale("+f.scale+")"),f.currentScale=f.scale,f.isScaling=!1,1===f.scale&&(f.gesture.slide=void 0))},onTouchStart:function(b,f){var D=b.zoom;D.gesture.image&&0!==D.gesture.image.length&&!D.image.isTouched&&("android"===b.device.os&&f.preventDefault(),D.image.isTouched=!0,D.image.touchesStart.x="touchstart"===f.type?f.targetTouches[0].pageX:
f.pageX,D.image.touchesStart.y="touchstart"===f.type?f.targetTouches[0].pageY:f.pageY)},onTouchMove:function(b){var f=a.zoom;if(f.gesture.image&&0!==f.gesture.image.length&&(a.allowClick=!1,f.image.isTouched&&f.gesture.slide)){f.image.isMoved||(f.image.width=f.gesture.image[0].offsetWidth,f.image.height=f.gesture.image[0].offsetHeight,f.image.startX=a.getTranslate(f.gesture.imageWrap[0],"x")||0,f.image.startY=a.getTranslate(f.gesture.imageWrap[0],"y")||0,f.gesture.slideWidth=f.gesture.slide[0].offsetWidth,
f.gesture.slideHeight=f.gesture.slide[0].offsetHeight,f.gesture.imageWrap.transition(0),a.rtl&&(f.image.startX=-f.image.startX),a.rtl&&(f.image.startY=-f.image.startY));var D=f.image.width*f.scale,t=f.image.height*f.scale;if(!(D<f.gesture.slideWidth&&t<f.gesture.slideHeight)){f.image.minX=Math.min(f.gesture.slideWidth/2-D/2,0);f.image.maxX=-f.image.minX;f.image.minY=Math.min(f.gesture.slideHeight/2-t/2,0);f.image.maxY=-f.image.minY;f.image.touchesCurrent.x="touchmove"===b.type?b.targetTouches[0].pageX:
b.pageX;f.image.touchesCurrent.y="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY;if(!f.image.isMoved&&!f.isScaling){if(a.isHorizontal()&&Math.floor(f.image.minX)===Math.floor(f.image.startX)&&f.image.touchesCurrent.x<f.image.touchesStart.x||Math.floor(f.image.maxX)===Math.floor(f.image.startX)&&f.image.touchesCurrent.x>f.image.touchesStart.x){f.image.isTouched=!1;return}if(!a.isHorizontal()&&Math.floor(f.image.minY)===Math.floor(f.image.startY)&&f.image.touchesCurrent.y<f.image.touchesStart.y||
Math.floor(f.image.maxY)===Math.floor(f.image.startY)&&f.image.touchesCurrent.y>f.image.touchesStart.y){f.image.isTouched=!1;return}}b.preventDefault();b.stopPropagation();f.image.isMoved=!0;f.image.currentX=f.image.touchesCurrent.x-f.image.touchesStart.x+f.image.startX;f.image.currentY=f.image.touchesCurrent.y-f.image.touchesStart.y+f.image.startY;f.image.currentX<f.image.minX&&(f.image.currentX=f.image.minX+1-Math.pow(f.image.minX-f.image.currentX+1,.8));f.image.currentX>f.image.maxX&&(f.image.currentX=
f.image.maxX-1+Math.pow(f.image.currentX-f.image.maxX+1,.8));f.image.currentY<f.image.minY&&(f.image.currentY=f.image.minY+1-Math.pow(f.image.minY-f.image.currentY+1,.8));f.image.currentY>f.image.maxY&&(f.image.currentY=f.image.maxY-1+Math.pow(f.image.currentY-f.image.maxY+1,.8));f.velocity.prevPositionX||(f.velocity.prevPositionX=f.image.touchesCurrent.x);f.velocity.prevPositionY||(f.velocity.prevPositionY=f.image.touchesCurrent.y);f.velocity.prevTime||(f.velocity.prevTime=Date.now());f.velocity.x=
(f.image.touchesCurrent.x-f.velocity.prevPositionX)/(Date.now()-f.velocity.prevTime)/2;f.velocity.y=(f.image.touchesCurrent.y-f.velocity.prevPositionY)/(Date.now()-f.velocity.prevTime)/2;2>Math.abs(f.image.touchesCurrent.x-f.velocity.prevPositionX)&&(f.velocity.x=0);2>Math.abs(f.image.touchesCurrent.y-f.velocity.prevPositionY)&&(f.velocity.y=0);f.velocity.prevPositionX=f.image.touchesCurrent.x;f.velocity.prevPositionY=f.image.touchesCurrent.y;f.velocity.prevTime=Date.now();f.gesture.imageWrap.transform("translate3d("+
f.image.currentX+"px, "+f.image.currentY+"px,0)")}}},onTouchEnd:function(b,f){b=b.zoom;if(b.gesture.image&&0!==b.gesture.image.length)if(b.image.isTouched&&b.image.isMoved){b.image.isTouched=!1;b.image.isMoved=!1;var D=300,t=300;f=b.image.currentX+b.velocity.x*D;var Z=b.image.currentY+b.velocity.y*t;0!==b.velocity.x&&(D=Math.abs((f-b.image.currentX)/b.velocity.x));0!==b.velocity.y&&(t=Math.abs((Z-b.image.currentY)/b.velocity.y));D=Math.max(D,t);b.image.currentX=f;b.image.currentY=Z;f=b.image.height*
b.scale;b.image.minX=Math.min(b.gesture.slideWidth/2-b.image.width*b.scale/2,0);b.image.maxX=-b.image.minX;b.image.minY=Math.min(b.gesture.slideHeight/2-f/2,0);b.image.maxY=-b.image.minY;b.image.currentX=Math.max(Math.min(b.image.currentX,b.image.maxX),b.image.minX);b.image.currentY=Math.max(Math.min(b.image.currentY,b.image.maxY),b.image.minY);b.gesture.imageWrap.transition(D).transform("translate3d("+b.image.currentX+"px, "+b.image.currentY+"px,0)")}else b.image.isTouched=!1,b.image.isMoved=!1},
onTransitionEnd:function(b){var f=b.zoom;f.gesture.slide&&b.previousIndex!==b.activeIndex&&(f.gesture.image.transform("translate3d(0,0,0) scale(1)"),f.gesture.imageWrap.transform("translate3d(0,0,0)"),f.gesture.slide=f.gesture.image=f.gesture.imageWrap=void 0,f.scale=f.currentScale=1)},toggleZoom:function(b,f){var D=b.zoom;D.gesture.slide||(D.gesture.slide=b.clickedSlide?W(b.clickedSlide):b.slides.eq(b.activeIndex),D.gesture.image=D.gesture.slide.find("img, svg, canvas"),D.gesture.imageWrap=D.gesture.image.parent("."+
b.params.zoomContainerClass));if(D.gesture.image&&0!==D.gesture.image.length){if("undefined"===typeof D.image.touchesStart.x&&f){var t="touchend"===f.type?f.changedTouches[0].pageX:f.pageX;var Z="touchend"===f.type?f.changedTouches[0].pageY:f.pageY}else t=D.image.touchesStart.x,Z=D.image.touchesStart.y;if(D.scale&&1!==D.scale)D.scale=D.currentScale=1,D.gesture.imageWrap.transition(300).transform("translate3d(0,0,0)"),D.gesture.image.transition(300).transform("translate3d(0,0,0) scale(1)"),D.gesture.slide=
void 0;else{D.scale=D.currentScale=D.gesture.imageWrap.attr("data-swiper-zoom")||b.params.zoomMax;if(f){var ca=D.gesture.slide[0].offsetWidth;f=D.gesture.slide[0].offsetHeight;var ta=D.gesture.slide.offset().left;b=D.gesture.slide.offset().top;var g=D.gesture.image[0].offsetWidth;var L=D.gesture.image[0].offsetHeight;g*=D.scale;var U=L*D.scale;L=Math.min(ca/2-g/2,0);g=Math.min(f/2-U/2,0);U=-L;var Y=-g;t=(ta+ca/2-t)*D.scale;Z=(b+f/2-Z)*D.scale;t<L&&(t=L);t>U&&(t=U);Z<g&&(Z=g);Z>Y&&(Z=Y)}else Z=t=0;
D.gesture.imageWrap.transition(300).transform("translate3d("+t+"px, "+Z+"px,0)");D.gesture.image.transition(300).transform("translate3d(0,0,0) scale("+D.scale+")")}}},attachEvents:function(b){var f=b?"off":"on";if(a.params.zoom&&(b="touchstart"===a.touchEvents.start&&a.support.passiveListener&&a.params.passiveListeners?{passive:!0,capture:!1}:!1,a.support.gestures?(a.slides[f]("gesturestart",a.zoom.onGestureStart,b),a.slides[f]("gesturechange",a.zoom.onGestureChange,b),a.slides[f]("gestureend",a.zoom.onGestureEnd,
b)):"touchstart"===a.touchEvents.start&&(a.slides[f](a.touchEvents.start,a.zoom.onGestureStart,b),a.slides[f](a.touchEvents.move,a.zoom.onGestureChange,b),a.slides[f](a.touchEvents.end,a.zoom.onGestureEnd,b)),a[f]("touchStart",a.zoom.onTouchStart),a.slides.each(function(D,t){if(0<W(t).find("."+a.params.zoomContainerClass).length)W(t)[f](a.touchEvents.move,a.zoom.onTouchMove)}),a[f]("touchEnd",a.zoom.onTouchEnd),a[f]("transitionEnd",a.zoom.onTransitionEnd),a.params.zoomToggle))a.on("doubleTap",a.zoom.toggleZoom)},
init:function(){a.zoom.attachEvents()},destroy:function(){a.zoom.attachEvents(!0)}};a._plugins=[];for(var Ca in a.plugins)(y=a.plugins[Ca](a,a.params[Ca]))&&a._plugins.push(y);a.callPlugins=function(b,f,D,t,Z,ca){for(var ta=0;ta<a._plugins.length;ta++)if(b in a._plugins[ta])a._plugins[ta][b](f,D,t,Z,ca)};a.emitterEventListeners={};a.emit=function(b,f,D,t,Z,ca){if(a.params[b])a.params[b](f,D,t,Z,ca);var ta;if(a.emitterEventListeners[b])for(ta=0;ta<a.emitterEventListeners[b].length;ta++)a.emitterEventListeners[b][ta](f,
D,t,Z,ca);a.callPlugins&&a.callPlugins(b,f,D,t,Z,ca)};a.on=function(b,f){b=H(b);a.emitterEventListeners[b]||(a.emitterEventListeners[b]=[]);a.emitterEventListeners[b].push(f);return a};a.off=function(b,f){var D;b=H(b);if("undefined"===typeof f)return a.emitterEventListeners[b]=[],a;if(a.emitterEventListeners[b]&&0!==a.emitterEventListeners[b].length){for(D=0;D<a.emitterEventListeners[b].length;D++)a.emitterEventListeners[b][D]===f&&a.emitterEventListeners[b].splice(D,1);return a}};a.once=function(b,
f){b=H(b);var D=function(t,Z,ca,ta,g){f(t,Z,ca,ta,g);a.off(b,D)};a.on(b,D);return a};a.a11y={makeFocusable:function(b){b.attr("tabIndex","0");return b},addRole:function(b,f){b.attr("role",f);return b},addLabel:function(b,f){b.attr("aria-label",f);return b},disable:function(b){b.attr("aria-disabled",!0);return b},enable:function(b){b.attr("aria-disabled",!1);return b},onEnterKey:function(b){13===b.keyCode&&(W(b.target).is(a.params.nextButton)?(a.onClickNext(b),a.isEnd?a.a11y.notify(a.params.lastSlideMessage):
a.a11y.notify(a.params.nextSlideMessage)):W(b.target).is(a.params.prevButton)&&(a.onClickPrev(b),a.isBeginning?a.a11y.notify(a.params.firstSlideMessage):a.a11y.notify(a.params.prevSlideMessage)),W(b.target).is("."+a.params.bulletClass)&&W(b.target)[0].click())},liveRegion:W('\x3cspan class\x3d"'+a.params.notificationClass+'" aria-live\x3d"assertive" aria-atomic\x3d"true"\x3e\x3c/span\x3e'),notify:function(b){var f=a.a11y.liveRegion;0!==f.length&&(f.html(""),f.html(b))},init:function(){a.params.nextButton&&
a.nextButton&&0<a.nextButton.length&&(a.a11y.makeFocusable(a.nextButton),a.a11y.addRole(a.nextButton,"button"),a.a11y.addLabel(a.nextButton,a.params.nextSlideMessage));a.params.prevButton&&a.prevButton&&0<a.prevButton.length&&(a.a11y.makeFocusable(a.prevButton),a.a11y.addRole(a.prevButton,"button"),a.a11y.addLabel(a.prevButton,a.params.prevSlideMessage));W(a.container).append(a.a11y.liveRegion)},initPagination:function(){a.params.pagination&&a.params.paginationClickable&&a.bullets&&a.bullets.length&&
a.bullets.each(function(){var b=W(this);a.a11y.makeFocusable(b);a.a11y.addRole(b,"button");a.a11y.addLabel(b,a.params.paginationBulletMessage.replace(/{{index}}/,b.index()+1))})},destroy:function(){a.a11y.liveRegion&&0<a.a11y.liveRegion.length&&a.a11y.liveRegion.remove()}};a.init=function(){a.params.loop&&a.createLoop();a.updateContainerSize();a.updateSlidesSize();a.updatePagination();a.params.scrollbar&&a.scrollbar&&(a.scrollbar.set(),a.params.scrollbarDraggable&&a.scrollbar.enableDraggable());"slide"!==
a.params.effect&&a.effects[a.params.effect]&&(a.params.loop||a.updateProgress(),a.effects[a.params.effect].setTranslate());a.params.loop?a.slideTo(a.params.initialSlide+a.loopedSlides,0,a.params.runCallbacksOnInit):(a.slideTo(a.params.initialSlide,0,a.params.runCallbacksOnInit),0===a.params.initialSlide&&(a.parallax&&a.params.parallax&&a.parallax.setTranslate(),a.lazy&&a.params.lazyLoading&&(a.lazy.load(),a.lazy.initialImageLoaded=!0)));a.attachEvents();a.params.observer&&a.support.observer&&a.initObservers();
a.params.preloadImages&&!a.params.lazyLoading&&a.preloadImages();a.params.zoom&&a.zoom&&a.zoom.init();a.params.autoplay&&a.startAutoplay();a.params.keyboardControl&&a.enableKeyboardControl&&a.enableKeyboardControl();a.params.mousewheelControl&&a.enableMousewheelControl&&a.enableMousewheelControl();a.params.hashnavReplaceState&&(a.params.replaceState=a.params.hashnavReplaceState);a.params.history&&a.history&&a.history.init();a.params.hashnav&&a.hashnav&&a.hashnav.init();a.params.a11y&&a.a11y&&a.a11y.init();
a.emit("onInit",a)};a.cleanupStyles=function(){a.container.removeClass(a.classNames.join(" ")).removeAttr("style");a.wrapper.removeAttr("style");a.slides&&a.slides.length&&a.slides.removeClass([a.params.slideVisibleClass,a.params.slideActiveClass,a.params.slideNextClass,a.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row");a.paginationContainer&&a.paginationContainer.length&&a.paginationContainer.removeClass(a.params.paginationHiddenClass);
a.bullets&&a.bullets.length&&a.bullets.removeClass(a.params.bulletActiveClass);a.params.prevButton&&W(a.params.prevButton).removeClass(a.params.buttonDisabledClass);a.params.nextButton&&W(a.params.nextButton).removeClass(a.params.buttonDisabledClass);a.params.scrollbar&&a.scrollbar&&(a.scrollbar.track&&a.scrollbar.track.length&&a.scrollbar.track.removeAttr("style"),a.scrollbar.drag&&a.scrollbar.drag.length&&a.scrollbar.drag.removeAttr("style"))};a.destroy=function(b,f){a.detachEvents();a.stopAutoplay();
a.params.scrollbar&&a.scrollbar&&a.params.scrollbarDraggable&&a.scrollbar.disableDraggable();a.params.loop&&a.destroyLoop();f&&a.cleanupStyles();a.disconnectObservers();a.params.zoom&&a.zoom&&a.zoom.destroy();a.params.keyboardControl&&a.disableKeyboardControl&&a.disableKeyboardControl();a.params.mousewheelControl&&a.disableMousewheelControl&&a.disableMousewheelControl();a.params.a11y&&a.a11y&&a.a11y.destroy();a.params.history&&!a.params.replaceState&&window.removeEventListener("popstate",a.history.setHistoryPopState);
a.params.hashnav&&a.hashnav&&a.hashnav.destroy();a.emit("onDestroy");!1!==b&&(a=null)};a.init();return a}};u.prototype={isSafari:function(){var y=window.navigator.userAgent.toLowerCase();return 0<=y.indexOf("safari")&&0>y.indexOf("chrome")&&0>y.indexOf("android")}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(window.navigator.userAgent),isArray:function(y){return"[object Array]"===Object.prototype.toString.apply(y)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,
ieTouch:window.navigator.msPointerEnabled&&1<window.navigator.msMaxTouchPoints||window.navigator.pointerEnabled&&1<window.navigator.maxTouchPoints,lteIE9:function(){var y=document.createElement("div");y.innerHTML="\x3c!--[if lte IE 9]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e";return 1===y.getElementsByTagName("i").length}()},device:function(){var y=window.navigator.userAgent,r=y.match(/(Android);?[\s\/]+([\d.]+)?/),d=y.match(/(iPad).*OS\s([\d_]+)/),e=y.match(/(iPod)(.*OS\s([\d_]+))?/);y=!d&&y.match(/(iPhone\sOS|iOS)\s([\d_]+)/);
return{ios:d||y||e,android:r}}(),support:{touch:window.Modernizr&&!0===Modernizr.touch||!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),transforms3d:window.Modernizr&&!0===Modernizr.csstransforms3d||function(){var y=document.createElement("div").style;return"webkitPerspective"in y||"MozPerspective"in y||"OPerspective"in y||"MsPerspective"in y||"perspective"in y}(),flexbox:function(){for(var y=document.createElement("div").style,r="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),
d=0;d<r.length;d++)if(r[d]in y)return!0}(),observer:"MutationObserver"in window||"WebkitMutationObserver"in window,passiveListener:function(){var y=!1;try{var r=Object.defineProperty({},"passive",{get:function(){y=!0}});window.addEventListener("testPassiveListener",null,r)}catch(d){}return y}(),gestures:"ongesturestart"in window},plugins:{}};var O=function(){var y=function(d){var e=0;for(e=0;e<d.length;e++)this[e]=d[e];this.length=d.length;return this},r=function(d,e){var l=[],m=0;if(d&&!e&&d instanceof
y)return d;if(d)if("string"===typeof d)if(m=d.trim(),0<=m.indexOf("\x3c")&&0<=m.indexOf("\x3e")){e="div";0===m.indexOf("\x3cli")&&(e="ul");0===m.indexOf("\x3ctr")&&(e="tbody");if(0===m.indexOf("\x3ctd")||0===m.indexOf("\x3cth"))e="tr";0===m.indexOf("\x3ctbody")&&(e="table");0===m.indexOf("\x3coption")&&(e="select");e=document.createElement(e);e.innerHTML=d;for(m=0;m<e.childNodes.length;m++)l.push(e.childNodes[m])}else for(d=e||"#"!==d[0]||d.match(/[ .<>:~]/)?(e||document).querySelectorAll(d):[document.getElementById(d.split("#")[1])],
m=0;m<d.length;m++)d[m]&&l.push(d[m]);else if(d.nodeType||d===window||d===document)l.push(d);else if(0<d.length&&d[0].nodeType)for(m=0;m<d.length;m++)l.push(d[m]);return new y(l)};y.prototype={addClass:function(d){if("undefined"===typeof d)return this;d=d.split(" ");for(var e=0;e<d.length;e++)for(var l=0;l<this.length;l++)this[l].classList.add(d[e]);return this},removeClass:function(d){d=d.split(" ");for(var e=0;e<d.length;e++)for(var l=0;l<this.length;l++)this[l].classList.remove(d[e]);return this},
hasClass:function(d){return this[0]?this[0].classList.contains(d):!1},toggleClass:function(d){d=d.split(" ");for(var e=0;e<d.length;e++)for(var l=0;l<this.length;l++)this[l].classList.toggle(d[e]);return this},attr:function(d,e){if(1===arguments.length&&"string"===typeof d){if(this[0])return this[0].getAttribute(d)}else{for(var l=0;l<this.length;l++)if(2===arguments.length)this[l].setAttribute(d,e);else for(var m in d)this[l][m]=d[m],this[l].setAttribute(m,d[m]);return this}},removeAttr:function(d){for(var e=
0;e<this.length;e++)this[e].removeAttribute(d);return this},data:function(d,e){if("undefined"===typeof e){if(this[0]){if(e=this[0].getAttribute("data-"+d))return e;if(this[0].dom7ElementDataStorage&&d in this[0].dom7ElementDataStorage)return this[0].dom7ElementDataStorage[d]}}else{for(var l=0;l<this.length;l++){var m=this[l];m.dom7ElementDataStorage||(m.dom7ElementDataStorage={});m.dom7ElementDataStorage[d]=e}return this}},transform:function(d){for(var e=0;e<this.length;e++){var l=this[e].style;l.webkitTransform=
l.MsTransform=l.msTransform=l.MozTransform=l.OTransform=l.transform=d}return this},transition:function(d){"string"!==typeof d&&(d+="ms");for(var e=0;e<this.length;e++){var l=this[e].style;l.webkitTransitionDuration=l.MsTransitionDuration=l.msTransitionDuration=l.MozTransitionDuration=l.OTransitionDuration=l.transitionDuration=d}return this},on:function(d,e,l,m){function n(F){var H=F.target;if(r(H).is(e))l.call(H,F);else{H=r(H).parents();for(var w=0;w<H.length;w++)r(H[w]).is(e)&&l.call(H[w],F)}}d=
d.split(" ");var h,x;for(h=0;h<this.length;h++)if("function"===typeof e||!1===e)for("function"===typeof e&&(m=(l=e)||!1),x=0;x<d.length;x++)this[h].addEventListener(d[x],l,m);else for(x=0;x<d.length;x++)this[h].dom7LiveListeners||(this[h].dom7LiveListeners=[]),this[h].dom7LiveListeners.push({listener:l,liveListener:n}),this[h].addEventListener(d[x],n,m);return this},off:function(d,e,l,m){d=d.split(" ");for(var n=0;n<d.length;n++)for(var h=0;h<this.length;h++)if("function"===typeof e||!1===e)"function"===
typeof e&&(m=(l=e)||!1),this[h].removeEventListener(d[n],l,m);else if(this[h].dom7LiveListeners)for(var x=0;x<this[h].dom7LiveListeners.length;x++)this[h].dom7LiveListeners[x].listener===l&&this[h].removeEventListener(d[n],this[h].dom7LiveListeners[x].liveListener,m);return this},once:function(d,e,l,m){function n(x){l(x);h.off(d,e,n,m)}var h=this;"function"===typeof e&&(m=l=e=!1);h.on(d,e,n,m)},trigger:function(d,e){for(var l=0;l<this.length;l++){try{var m=new window.CustomEvent(d,{detail:e,bubbles:!0,
cancelable:!0})}catch(n){m=document.createEvent("Event"),m.initEvent(d,!0,!0),m.detail=e}this[l].dispatchEvent(m)}return this},transitionEnd:function(d){function e(h){if(h.target===this)for(d.call(this,h),m=0;m<l.length;m++)n.off(l[m],e)}var l=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],m,n=this;if(d)for(m=0;m<l.length;m++)n.on(l[m],e);return this},width:function(){return this[0]===window?window.innerWidth:0<this.length?parseFloat(this.css("width")):
null},outerWidth:function(d){return 0<this.length?d?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:0<this.length?parseFloat(this.css("height")):null},outerHeight:function(d){return 0<this.length?d?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(0<this.length){var d=this[0],
e=d.getBoundingClientRect(),l=document.body;return{top:e.top+(window.pageYOffset||d.scrollTop)-(d.clientTop||l.clientTop||0),left:e.left+(window.pageXOffset||d.scrollLeft)-(d.clientLeft||l.clientLeft||0)}}return null},css:function(d,e){var l;if(1===arguments.length)if("string"===typeof d){if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(d)}else{for(l=0;l<this.length;l++)for(var m in d)this[l].style[m]=d[m];return this}if(2===arguments.length&&"string"===typeof d)for(l=0;l<
this.length;l++)this[l].style[d]=e;return this},each:function(d){for(var e=0;e<this.length;e++)d.call(this[e],e,this[e]);return this},html:function(d){if("undefined"===typeof d)return this[0]?this[0].innerHTML:void 0;for(var e=0;e<this.length;e++)this[e].innerHTML=d;return this},text:function(d){if("undefined"===typeof d)return this[0]?this[0].textContent.trim():null;for(var e=0;e<this.length;e++)this[e].textContent=d;return this},is:function(d){if(!this[0])return!1;if("string"===typeof d){var e=
this[0];if(e===document)return d===document;if(e===window)return d===window;if(e.matches)return e.matches(d);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(d);if(e.mozMatchesSelector)return e.mozMatchesSelector(d);if(e.msMatchesSelector)return e.msMatchesSelector(d);d=r(d);for(e=0;e<d.length;e++)if(d[e]===this[0])return!0;return!1}if(d===document)return this[0]===document;if(d===window)return this[0]===window;if(d.nodeType||d instanceof y)for(d=d.nodeType?[d]:d,e=0;e<d.length;e++)if(d[e]===
this[0])return!0;return!1},index:function(){if(this[0]){for(var d=this[0],e=0;null!==(d=d.previousSibling);)1===d.nodeType&&e++;return e}},eq:function(d){if("undefined"===typeof d)return this;var e=this.length;return d>e-1?new y([]):0>d?(d=e+d,0>d?new y([]):new y([this[d]])):new y([this[d]])},append:function(d){var e;for(e=0;e<this.length;e++)if("string"===typeof d){var l=document.createElement("div");for(l.innerHTML=d;l.firstChild;)this[e].appendChild(l.firstChild)}else if(d instanceof y)for(l=0;l<
d.length;l++)this[e].appendChild(d[l]);else this[e].appendChild(d);return this},prepend:function(d){var e,l;for(e=0;e<this.length;e++)if("string"===typeof d){var m=document.createElement("div");m.innerHTML=d;for(l=m.childNodes.length-1;0<=l;l--)this[e].insertBefore(m.childNodes[l],this[e].childNodes[0])}else if(d instanceof y)for(l=0;l<d.length;l++)this[e].insertBefore(d[l],this[e].childNodes[0]);else this[e].insertBefore(d,this[e].childNodes[0]);return this},insertBefore:function(d){d=r(d);for(var e=
0;e<this.length;e++)if(1===d.length)d[0].parentNode.insertBefore(this[e],d[0]);else if(1<d.length)for(var l=0;l<d.length;l++)d[l].parentNode.insertBefore(this[e].cloneNode(!0),d[l])},insertAfter:function(d){d=r(d);for(var e=0;e<this.length;e++)if(1===d.length)d[0].parentNode.insertBefore(this[e],d[0].nextSibling);else if(1<d.length)for(var l=0;l<d.length;l++)d[l].parentNode.insertBefore(this[e].cloneNode(!0),d[l].nextSibling)},next:function(d){return 0<this.length?d?this[0].nextElementSibling&&r(this[0].nextElementSibling).is(d)?
new y([this[0].nextElementSibling]):new y([]):this[0].nextElementSibling?new y([this[0].nextElementSibling]):new y([]):new y([])},nextAll:function(d){var e=[],l=this[0];if(!l)return new y([]);for(;l.nextElementSibling;)l=l.nextElementSibling,d?r(l).is(d)&&e.push(l):e.push(l);return new y(e)},prev:function(d){return 0<this.length?d?this[0].previousElementSibling&&r(this[0].previousElementSibling).is(d)?new y([this[0].previousElementSibling]):new y([]):this[0].previousElementSibling?new y([this[0].previousElementSibling]):
new y([]):new y([])},prevAll:function(d){var e=[],l=this[0];if(!l)return new y([]);for(;l.previousElementSibling;)l=l.previousElementSibling,d?r(l).is(d)&&e.push(l):e.push(l);return new y(e)},parent:function(d){for(var e=[],l=0;l<this.length;l++)d?r(this[l].parentNode).is(d)&&e.push(this[l].parentNode):e.push(this[l].parentNode);return r(r.unique(e))},parents:function(d){for(var e=[],l=0;l<this.length;l++)for(var m=this[l].parentNode;m;)d?r(m).is(d)&&e.push(m):e.push(m),m=m.parentNode;return r(r.unique(e))},
find:function(d){for(var e=[],l=0;l<this.length;l++)for(var m=this[l].querySelectorAll(d),n=0;n<m.length;n++)e.push(m[n]);return new y(e)},children:function(d){for(var e=[],l=0;l<this.length;l++)for(var m=this[l].childNodes,n=0;n<m.length;n++)d?1===m[n].nodeType&&r(m[n]).is(d)&&e.push(m[n]):1===m[n].nodeType&&e.push(m[n]);return new y(r.unique(e))},remove:function(){for(var d=0;d<this.length;d++)this[d].parentNode&&this[d].parentNode.removeChild(this[d]);return this},add:function(){var d,e;for(d=
0;d<arguments.length;d++){var l=r(arguments[d]);for(e=0;e<l.length;e++)this[this.length]=l[e],this.length++}return this}};r.fn=y.prototype;r.unique=function(d){for(var e=[],l=0;l<d.length;l++)-1===e.indexOf(d[l])&&e.push(d[l]);return e};return r}(),X=["jQuery","Zepto","Dom7"],N=0;for(;N<X.length;N++)window[X[N]]&&V(window[X[N]]);if(X="undefined"===typeof O?window.Dom7||window.Zepto||window.jQuery:O)"transitionEnd"in X.fn||(X.fn.transitionEnd=function(y){function r(m){if(m.target===this)for(y.call(this,
m),e=0;e<d.length;e++)l.off(d[e],r)}var d=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],e,l=this;if(y)for(e=0;e<d.length;e++)l.on(d[e],r);return this}),"transform"in X.fn||(X.fn.transform=function(y){for(var r=0;r<this.length;r++){var d=this[r].style;d.webkitTransform=d.MsTransform=d.msTransform=d.MozTransform=d.OTransform=d.transform=y}return this}),"transition"in X.fn||(X.fn.transition=function(y){"string"!==typeof y&&(y+="ms");for(var r=0;r<this.length;r++){var d=
this[r].style;d.webkitTransitionDuration=d.MsTransitionDuration=d.msTransitionDuration=d.MozTransitionDuration=d.OTransitionDuration=d.transitionDuration=y}return this}),"outerWidth"in X.fn||(X.fn.outerWidth=function(y){return 0<this.length?y?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null});window.Swiper=u})();"undefined"!==typeof module?module.exports=window.Swiper:"function"===typeof define&&define.amd&&define([],function(){return window.Swiper})},
"widgets/NearMe/closestGeodesicDistanceUtils":function(){define(["esri/SpatialReference","esri/geometry/Polygon","esri/geometry/Polyline","esri/geometry/geometryEngine","esri/geometry/webMercatorUtils"],function(V,W,u,O,X){var N={getGeodesicDistance:function(y,r,d){var e=0;if(!y||!r||O.intersects(y,r))return 0;var l=new V(4326);X.canProject(y,l)&&X.canProject(r,l)&&(y=X.project(y,l),r=X.project(r,l),"point"===y.type?"point"===r.type?e=N.getGeodesicDistanceBetweenPointToPoint(y,r):"polyline"===r.type?
e=N.getGeodesicDistanceBetweenPointToLine(y,r):"polygon"===r.type&&(e=N.getGeodesicDistanceBetweenPointToPolygon(y,r)):"polyline"===y.type?"point"===r.type?e=N.getGeodesicDistanceBetweenPointToLine(r,y):"polyline"===r.type?e=N.getGeodesicDistanceBetweenLineToLine(y,r):"polygon"===r.type&&(e=N.getGeodesicDistanceBetweenLineToPolygon(y,r)):"polygon"===y.type&&("point"===r.type?e=N.getGeodesicDistanceBetweenPointToPolygon(r,y):"polyline"===r.type?e=N.getGeodesicDistanceBetweenLineToPolygon(r,y):"polygon"===
r.type&&(e=N.getGeodesicDistanceBetweenPolygonToPolygon(y,r))),d&&(e=N.convertSingle(e,d)));return e},getGeodesicDistanceBetweenPolygonToPolygon:function(y,r){if(O.intersects(y,r))return 0;var d,e;for(d=0;d<y.rings.length;d++)for(e=0;e<y.rings[d].length;e++){var l=y.getPoint(d,e);l=N.getGeodesicDistanceBetweenPointToPolygon(l,r);if(void 0===m||l<m)var m=l}for(d=0;d<r.rings.length;d++)for(e=0;e<r.rings[d].length;e++)if(l=r.getPoint(d,e),l=N.getGeodesicDistanceBetweenPointToPolygon(l,y),void 0===m||
l<m)m=l;return m},getGeodesicDistanceBetweenLineToPolygon:function(y,r){var d,e;if(O.intersects(y,r))return 0;for(d=0;d<y.paths.length;d++)for(e=0;e<y.paths[d].length;e++){var l=y.getPoint(d,e);l=N.getGeodesicDistanceBetweenPointToPolygon(l,r);if(void 0===m||l<m)var m=l}for(d=0;d<r.rings.length;d++)for(e=0;e<r.rings[d].length;e++)if(l=r.getPoint(d,e),l=N.getGeodesicDistanceBetweenPointToLine(l,y),void 0===m||l<m)m=l;return m},getGeodesicDistanceBetweenLineToLine:function(y,r){var d,e;if(O.intersects(y,
r))return 0;for(d=0;d<y.paths.length;d++)for(e=0;e<y.paths[d].length;e++){var l=y.getPoint(d,e);l=N.getGeodesicDistanceBetweenPointToLine(l,r);if(void 0===m||l<m)var m=l}for(d=0;d<r.paths.length;d++)for(e=0;e<r.paths[d].length;e++)if(l=r.getPoint(d,e),l=N.getGeodesicDistanceBetweenPointToLine(l,y),void 0===m||l<m)m=l;return m},getGeodesicDistanceBetweenPointToPolygon:function(y,r){var d;if(0<r.rings.length)for(d=0;d<r.rings.length;d++){var e=new W({rings:[r.rings[d]],spatialReference:r.spatialReference});
e=O.nearestCoordinate(e,y).coordinate;e=N.getGeodesicDistanceBetweenPointToPoint(y,e);if(void 0===l||e<l)var l=e}return l},getGeodesicDistanceBetweenPointToLine:function(y,r){var d;if(0<r.paths.length)for(d=0;d<r.paths.length;d++){var e=new u({paths:[r.paths[d]],spatialReference:r.spatialReference});e=O.nearestCoordinate(e,y).coordinate;e=N.getGeodesicDistanceBetweenPointToPoint(y,e);if(void 0===l||e<l)var l=e}return l},getGeodesicDistanceBetweenPointToPoint:function(y,r){y=N.getDistance(y,r);return isNaN(y)?
0:y},getDistance:function(y,r){var d=r.x*Math.PI/180-y.x*Math.PI/180,e=.9966471893352243*Math.tan(y.y*Math.PI/180);y=1/Math.sqrt(1+e*e);e*=y;var l=.9966471893352243*Math.tan(r.y*Math.PI/180);r=1/Math.sqrt(1+l*l);var m=l*r,n=d,h=0;do{var x=Math.sin(n);var F=Math.cos(n);l=r*x*r*x+(y*m-e*r*F)*(y*m-e*r*F);l=Math.sqrt(l);if(0==l)return{distance:0,initialBearing:0,finalBearing:0};F=e*m+y*r*F;var H=Math.atan2(l,F);var w=y*r*x/l;var G=1-w*w;x=F-2*e*m/G;isNaN(x)&&(x=0);var Q=2.0955066654848088E-4*G*(4+.003352810664775694*
(4-3*G));var S=n;n=d+.003352810664775694*(1-Q)*w*(H+Q*l*(x+Q*F*(-1+2*x*x)))}while(1E-12<Math.abs(n-S)&&200>++h);if(200<=h)return null;d=2.7233160610984375E11*G/4.040829998465916E13;y=d/1024*(256+d*(-128+d*(74-47*d)));return d=Number((6356752.314245*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(H-y*l*(x+y/4*(F*(-1+2*x*x)-y/6*x*(-3+4*l*l)*(-3+4*x*x))))).toFixed(3))},convertSingle:function(y,r){return"meters"===r?+y:+y/N.perMeter("meters")*N.perMeter(r)},perMeter:function(y){var r=1;switch(y){case "meters":r=
1;break;case "kilometers":r=.001;break;case "feet":r=1/.3048;break;case "yards":r=1/.9144;break;case "miles":r=1/1609.344}return r}};return N})},"widgets/NearMe/filter-list":function(){define("dojo/_base/declare dojo/text!./filter-list.html dojo/_base/array dojo/_base/html dojo/_base/lang dojo/query dojo/on dojo/dom-attr dojo/keys dijit/_WidgetsInTemplateMixin dojo/dom-class jimu/utils jimu/BaseWidget jimu/filterUtils jimu/dijit/FilterParameters esri/symbols/jsonUtils jimu/symbolUtils jimu/LayerInfos/LayerInfos jimu/FilterManager esri/request dojo/Evented dojo/NodeList dojo/NodeList-dom".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S){return V([n,e,S],{name:"NearMeFilter",templateString:W,lastFocusNode:null,baseClass:"jimu-widget-nearme-filter",_itemTemplate:'\x3cli aria-label\x3d"${layerTitle} ${filterNotAppliedLabel}" role\x3d"listitem" tabindex\x3d"0" class\x3d"filter-item" data-index\x3d"${index}"\x3e\x3cdiv class\x3d"header" \x3e\x3cspan role\x3d"button" aria-label\x3d"${toggleTip}" class\x3d"arrow jimu-float-leading jimu-trailing-margin05" title\x3d"${toggleTip}" \x3e\x3c/span\x3e\x3cspan class\x3d"icon"\x3e\x3cimg src\x3d"${icon}" /\x3e\x3c/span\x3e\x3cspan class\x3d"icon symbolIcon" style\x3d"display:none;"\x3e\x3c/span\x3e\x3cspan class\x3d"item-title"\x3e${title}\x3c/span\x3e\x3cspan class\x3d"cando jimu-float-trailing esriCTFliterListCheckbox"\x3e\x3c/span\x3e\x3cspan class\x3d"doing jimu-float-trailing esriCTFliterListCheckbox"\x3e\x3c/span\x3e\x3cspan class\x3d"done jimu-float-trailing esriCTFliterListCheckbox"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"body"\x3e\x3cdiv class\x3d"parameters"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" role\x3d"button" aria-label\x3d"${apply}" class\x3d"jimu-btn apply jimu-float-trailing jimu-trailing-margin25"\x3e${apply}\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e',
_layerTitleTemplate:'\x3cdiv class\x3d"esriCTGroupFilterLayerName"\x3e${layerTitle}\x3c/div\x3e',_store:null,totalAppliedFilters:0,postCreate:function(){this.inherited(arguments);this.totalAppliedFilters=0;this._updateClearAllButtonState();this.own(y(this.clearAllButton,"click",X.hitch(this,this._clearAllFilters)));this.own(y(this.clearAllButton,"keydown",X.hitch(this,function(a){a.keyCode!==d.ENTER&&a.keyCode!==d.SPACE||this._clearAllFilters()})));this._store={};this.layerInfosObj=w.getInstanceSync();
this.filterUtils=new h;this.filterManager=G.getInstance();var M=this.config.filters,R={},C=[];this.config.groupFiltersByLayer?(u.forEach(M,function(a,B){R[a.layerId]||(R[a.layerId]=[],C.push(a.layerId));a.index=B;R[a.layerId].push(a)}),u.forEach(C,X.hitch(this,function(a){var B=this.layerInfosObj.getLayerInfoById(a);B=X.replace(this._layerTitleTemplate,{layerTitle:B.layerObject.name||B.title},/\$\{([^\}]+)\}/ig);B=O.toDom(B);O.place(B,this.filterList);for(B=0;B<R[a].length;B++)this._addFilterInList(R[a][B],
R[a][B].index)}))):u.forEach(M,X.hitch(this,function(a,B){this._addFilterInList(a,B)}))},getLastNode:function(){if(this.lastFocusNode)if(l.contains(this.lastFocusNode,"has-ask-for-value")){var M=m.getFocusNodesInDom(this.lastFocusNode);M=l.contains(this.lastFocusNode,"config-parameters")?M.reverse()[0]:N(".arrow",this.lastFocusNode)[0]}else M=this.lastFocusNode;return M},_addFilterInList:function(M,R){var C=this.filterUtils.isAskForValues(M.filter),a={icon:M.icon?m.processUrlInWidgetConfig(M.icon,
this.folderUrl):this.folderUrl+"/css/images/default_task_icon.png",index:R,title:M.name,layerTitle:M.layerTitle?M.layerTitle:M.name,toggleTip:this.nls.toggleTip,hasValue:C?window.appInfo.isRunInMobile?"block !important":"":"none",isAskForValue:C,apply:X.getObject("jimuNls.common.apply",!1,window)||"Apply",filterNotAppliedLabel:this.nls.filterNotAppliedLabel};this._store[M.layerId]||(this._store[M.layerId]={mapFilterControls:{}});R=X.replace(this._itemTemplate,a,/\$\{([^\}]+)\}/ig);var B=O.toDom(R);
this.lastFocusNode=B;O.place(B,this.filterList);if(M.symbol){R=N(".icon",B);O.setStyle(R[0],"display","none");O.setStyle(R[1],"display","inline-block");var fa=F.fromJson(M.symbol),ka=M.symbol.url||M.symbol.imageData;ka?(fa.setWidth(25),fa.setHeight(25)):fa.setSize(25);fa=ka?H.createSymbolNode(fa):H.createSymbolNode(fa,{width:26,height:26});O.place(fa,R[1])}this.own(N(".header",B).on("click",X.hitch(this,"enableFilter",B,M,a,!1)));C?(O.addClass(B,"has-ask-for-value"),r.set(B,"tabindex","-1")):(this.own(y(N(".header",
B)[0].parentElement,"keydown",X.hitch(this,"enableFilter",B,M,a,!0))),O.addClass(B,"not-has-ask-for-value"));C=N(".apply",B);R=N(".arrow",B);"none"!==a.hasValue?(r.set(C[0],"type",""),r.set(R[0],"type",""),r.set(R[0],"tabindex","0"),this.own(R.on("click",X.hitch(this,"configFilter",B,M))),this.own(R.on("keydown",X.hitch(this,function(la){if(la.keyCode===d.ENTER||la.keyCode===d.SPACE)this.configFilter(B,M),la.stopPropagation()}))),this.own(C.on("click",X.hitch(this,"applyFilterValues",B,M,!1))),this.own(C.on("keydown",
X.hitch(this,"applyFilterValues",B,M,!0))),O.addClass(B,"requesting"),this.configFilter(B,M,null,X.hitch(this,function(){this.config.collapse&&O.removeClass(B,"config-parameters");M.autoApplyWhenWidgetOpen&&this.enableFilter(B,M,a)}))):(r.set(C[0],"type","hidden"),r.set(R[0],"type","hidden"),M.autoApplyWhenWidgetOpen&&this.enableFilter(B,M,a))},startup:function(){this.inherited(arguments);this.resize()},_getPriorityOfMapFilter:function(M){M=X.getObject(M+".mapFilterControls",!1,this._store);var R=
0,C;for(C in M){var a=M[C];a.priority>R&&(R=a.priority)}return R},_getMapFilterControl:function(M){M=X.getObject(M+".mapFilterControls",!1,this._store);var R=!0,C;for(C in M){var a=M[C];0<a.priority&&(R=!!a.enable)}return R},_setItemFilter:function(M,R,C,a){this._store[M]["filter_item_"+R]=C;C=this._getPriorityOfMapFilter(M);X.setObject(M+".mapFilterControls.filter_item_"+R,{enable:a,priority:C+1},this._store)},_removeItemFilter:function(M,R){delete this._store[M]["filter_item_"+R];delete this._store[M].mapFilterControls["filter_item_"+
R]},_getExpr:function(M){if(!this._store[M])return null;var R=[];M=this._store[M];for(var C in M){var a=M[C];a&&"mapFilterControls"!==C&&R.push("("+a+")")}return R.join(" AND ")},_bindMapUpdateEvents:function(M,R){y.once(this.map,"update-start",X.hitch(this,function(){O.addClass(M,"applying");O.removeClass(M,"applied");r.set(M,"aria-label",M.innerText+this.nls.applyingFilterLabel)}));y.once(this.map,"update-end",X.hitch(this,function(){R?(O.addClass(M,"applied"),r.set(M,"aria-label",M.innerText+this.nls.filterAppliedLabel)):
(O.removeClass(M,"applied"),r.set(M,"aria-label",M.innerText+this.nls.filterNotAppliedLabel));O.removeClass(M,"applying")}))},enableFilter:function(M,R,C,a,B){if(!a||B.keyCode===d.ENTER||B.keyCode===d.SPACE)if(!O.hasClass(M,"config-parameters")||M.filterParams&&M.filterParams.getFilterExpr())if(!C.isAskForValue||M.filterParams&&M.filterParams.getFilterExpr()){C=R.layerId;a=O.getAttr(M,"data-index");B=null;var fa=this.layerInfosObj.getLayerInfoById(C);B=O.hasClass(M,"applied");fa.isShowInMap()&&fa.isInScale()?
this._bindMapUpdateEvents(M,B?!1:!0):B?O.removeClass(M,"applied"):O.addClass(M,"applied");fa=null;B?(this._removeItemFilter(C,a),B=this._getExpr(C),fa=this._getMapFilterControl(C),this.filterManager.applyWidgetFilter(C,this.id,B,fa),this.totalAppliedFilters--):(M=this._getFilterExpr(M,R),this._setItemFilter(C,a,M,R.enableMapFilter),B=this._getExpr(C),fa=this._getMapFilterControl(C),this.filterManager.applyWidgetFilter(C,this.id,B,fa),this.totalAppliedFilters++);this.filtersUpdated=!0;this._updateClearAllButtonState()}else this.configFilter(M,
R)},configFilter:function(M,R,C,a){M.filterParams?(O.hasClass(M,"config-parameters")?(O.removeClass(M,"config-parameters"),this._changeItemTitleWidth(M,window.appInfo.isRunInMobile?60:45)):(O.addClass(M,"config-parameters"),this._changeItemTitleWidth(M,60)),a&&a(),this.emit("setLastFilterNode",this.getLastNode())):Q({url:R.url,content:{f:"json"},handleAs:"json",callbackPrams:"callback"}).then(X.hitch(this,function(B){O.addClass(M,"config-parameters");O.removeClass(M,"requesting");var fa=N(".parameters",
M)[0];M.handles=[];M.filterParams=new x;var ka=X.clone(R.filter),la=null;R.enableMapFilter&&(la=R.layerId);M.filterParams.build(R.url,B,ka,la,this.id);this.own(y(M.filterParams,"change",X.hitch(this,function(oa){oa?(N(".apply",M).removeClass("disable-apply"),M.expr=oa):(delete M.expr,N(".apply",M).addClass("disable-apply"))})));M.expr=M.filterParams.getFilterExpr();M.expr?N(".apply",M).removeClass("disable-apply"):(delete M.expr,N(".apply",M).addClass("disable-apply"));M.filterParams.placeAt(fa);
this._changeItemTitleWidth(M,60);a&&a()}));C&&C.target&&C.stopPropagation()},applyFilterValues:function(M,R,C,a){if(!C||a.keyCode===d.ENTER||a.keyCode===d.SPACE){var B=M.filterParams&&(M.expr||this._getFilterExpr(M,R)),fa=!0;C=!1;l.contains(M,"applied")?(C=!0,this._getExpr(R.layerId)==="("+B+")"&&(fa=!1)):fa=!0;if(B&&fa){M.expr=B;B=R.layerId;fa=O.getAttr(M,"data-index");var ka=this.layerInfosObj.getLayerInfoById(B);ka.isShowInMap()&&ka.isInScale()?this._bindMapUpdateEvents(M,!0):O.addClass(M,"applied");
this._setItemFilter(B,fa,M.expr,R.enableMapFilter);M=this._getExpr(B);R=this._getMapFilterControl(B);this.filterManager.applyWidgetFilter(B,this.id,M,R);this.filtersUpdated=!0;C||this.totalAppliedFilters++;this._updateClearAllButtonState()}a.stopPropagation()}},_getFilterExpr:function(M,R){return M.filterParams?M.filterParams.getFilterExpr():this.filterUtils.hasVirtualDate(R.filter)?(this.filterUtils.isHosted=m.isHostedService(R.url),this.filterUtils.getExprByFilterObj(R.filter)):R.filter.expr},resize:function(){this.inherited(arguments);
this._changeItemTitleWidth(this.domNode,window.appInfo.isRunInMobile?60:45)},_changeItemTitleWidth:function(M,R){var C=N(".header",M)[0];C&&(R=O.getContentBox(C).w-R,0<R&&N(".header .item-title",M).style({maxWidth:R+"px"}))},destroy:function(){N(".filter-item",this.filterList).forEach(function(R){delete R.filterParams;delete R.expr});if(this._store)for(var M in this._store)M&&this.filterManager.applyWidgetFilter(M,this.id,"",null);this.inherited(arguments)},filterListShown:function(){this.filtersUpdated=
!1},_updateClearAllButtonState:function(){0<this.totalAppliedFilters?(l.add(this.clearAllButton,"esriCTClearAllFilterActive"),r.set(this.clearAllButton,"aria-disabled","false")):(l.remove(this.clearAllButton,"esriCTClearAllFilterActive"),r.set(this.clearAllButton,"aria-disabled","true"))},_clearAllFilters:function(){if(l.contains(this.clearAllButton,"esriCTClearAllFilterActive")&&this.filterList){var M=N(".applied",this.filterList);u.forEach(M,function(R){(R=N(".header",R))&&0<R.length&&R[0].click()});
this._updateClearAllButtonState();this.emit("clearAllFilters")}}})})},"dojo/NodeList":function(){define(["./query"],function(V){return V.NodeList})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(V,W,u,O,X,N,y,r){V=V(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,
unit:null,unionResults:!1,geodesic:!1,toJson:function(){var d={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},e=this.distances,l=this.outSpatialReference,m=this.bufferSpatialReference,n=u.map(this.geometries,function(F){F="extent"===F.type?y.fromExtent(F):F;return F.toJson()},this),h=this.geometries;if(h&&0<h.length){var x="extent"===h[0].type?"esriGeometryPolygon":r.getJsonType(h[0]);d.geometries=O.toJson({geometryType:x,geometries:n});d.inSR=h[0].spatialReference.wkid?h[0].spatialReference.wkid:
O.toJson(h[0].spatialReference.toJson())}e&&(d.distances=e.join(","));l&&(d.outSR=l.wkid?l.wkid:O.toJson(l.toJson()));m&&(d.bufferSR=m.wkid?m.wkid:O.toJson(m.toJson()));return d}});X("extend-esri")&&W.setObject("tasks.BufferParameters",V,N);return V})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(V,W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R){V=u("esri.dijit.LocateButton",[r,e,W],{templateString:n,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new M(V.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(C,a){C=O.mixin({},this.options,C);this.domNode=
a;this._i18n=h;a=navigator.geolocation;var B=window.hasOwnProperty("isSecureContext");B=B&&window.isSecureContext||!B&&"https:"===window.location.protocol;B&&a||(C.visible=!1);a||console.log("LocateButton::navigator.geolocation unsupported.");B||console.log("LocateButton::navigator.geolocation requires a secure origin.");this.set("map",C.map);this.set("theme",C.theme);this.set("visible",C.visible);this.set("scale",C.scale);this.set("highlightLocation",C.highlightLocation);this.set("symbol",C.symbol);
this.set("infoTemplate",C.infoTemplate);this.set("geolocationOptions",C.geolocationOptions);this.set("useTracking",C.useTracking);this.set("setScale",C.setScale);this.set("centerAt",C.centerAt);this.set("timeout",C.timeout);this.set("graphicsLayer",C.graphicsLayer);this.set("clearOnTrackingStop",C.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",O.hitch(this,function(){this.get("tracking")&&
!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(l(this._locateNode,d,O.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||(this.set("visible",!1),console.log("LocateButton::map required"));if(this.get("map").loaded)this._init();else l.once(this.get("map"),"load",O.hitch(this,function(){this._init()}))},
destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var C=this.get("highlightGraphic"),a=this.get("graphicsLayer");C&&(a?a.remove(C):this.get("map").graphics.remove(C),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?
this.get("tracking")?H.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):H.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):H.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){x.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();
this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(C){return C?{coords:O.mixin({},C.coords),timestamp:C.timestamp}:{}},_startTracking:function(){x.add(this._locateNode,this._css.tracking);this._removeWatchPosition();var C=navigator.geolocation.watchPosition(O.hitch(this,function(a){a=this._positionToObject(a);this._setPosition(a).then(O.hitch(this,function(B){this._locateEvent(B)}),O.hitch(this,function(B){B||(B=Error("LocateButton::Error setting the position."));
this._locateError(B)}))}),O.hitch(this,function(a){this.set("tracking",!1);a||(a=Error("LocateButton::Could not get tracking position."));this._locateError(a)}),this.get("geolocationOptions"));this.set("watchId",C)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var C=new m;this._removePrivateVars();var a=setTimeout(O.hitch(this,function(){clearTimeout(a);C.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));
navigator.geolocation.getCurrentPosition(O.hitch(this,function(B){B=this._positionToObject(B);clearTimeout(a);this._setPosition(B).then(O.hitch(this,function(fa){C.resolve(fa)}),O.hitch(this,function(fa){fa||(fa=Error("LocateButton::Error setting map position."));C.reject(fa)}))}),O.hitch(this,function(B){B||(B=Error("LocateButton::Could not get current position."));C.reject(B)}),this.get("geolocationOptions"));return C.promise},_locate:function(){var C=new m;this._showLoading();if(navigator.geolocation)this.get("useTracking")?
this.get("tracking")?(this._startTracking(),C.resolve({tracking:!0})):(this._stopTracking(),C.resolve({tracking:!1})):this._getCurrentPosition().then(O.hitch(this,function(B){this._locateEvent(B);C.resolve(B)}),O.hitch(this,function(B){B||(B=Error("LocateButton::Could not get current position."));this._locateError(B);C.reject(B)}));else{var a=Error("LocateButton::geolocation unsupported");this._locateError(a);C.reject(a)}this._setTitle();return C.promise},_projectPoint:function(C){var a=new m,B=this.get("map").spatialReference,
fa=B.wkid;B.isWebMercator()?(C=w.geographicToWebMercator(C),a.resolve(C)):y.defaults.geometryService&&4326!==fa?(fa=new R,fa.geometries=[C],fa.outSR=B,y.defaults.geometryService.project(fa).then(O.hitch(this,function(ka){ka&&ka.length?a.resolve(ka[0]):a.reject(Error("LocateButton::Point was not projected."))}),function(ka){ka||(ka=Error("LocateButton::please specify a geometry service on esri/config to project."));a.reject(ka)})):a.resolve(C);return a.promise},_getScale:function(C){var a=this.get("scale");
return C&&C.coords?a||C.coords.accuracy||5E4:a||5E4},_createPoint:function(C){var a;C&&C.coords&&(a=new G([C.coords.longitude,C.coords.latitude],new Q({wkid:4326})));return a},_setPosition:function(C){var a=new m,B,fa;this._removePrivateVars();if((this._position=C)&&C.coords){if(B=this._createPoint(C))this._graphic=fa=this._createGraphic(B,C);var ka=this._getScale(C);this._scale=ka;B?this._projectPoint(B).then(O.hitch(this,function(la){this._graphic=fa=this._createGraphic(la,C);var oa={graphic:fa,
scale:ka,position:C};this.get("setScale")&&this.get("map").setScale(ka);this.get("centerAt")?this.get("map").centerAt(la).then(O.hitch(this,function(){a.resolve(oa)}),O.hitch(this,function(P){P||(P=Error("LocateButton::Could not center map."));a.reject(P)})):a.resolve(oa)}),O.hitch(this,function(la){la||(la=Error("LocateButton::Error projecting point."));a.reject(la)})):(B=Error("LocateButton::Invalid point"),a.reject(B))}else B=Error("LocateButton::Invalid position"),a.reject(B);return a.promise},
_createGraphic:function(C,a){if(C){a={position:a};var B=new S(C,this.get("symbol"),a,this.get("infoTemplate"))}return B},_locateEvent:function(C){if(C.graphic){var a=this.get("highlightGraphic"),B=this.get("graphicsLayer");a?(a.setGeometry(C.graphic.geometry),a.setAttributes(C.graphic.attributes),a.setInfoTemplate(C.graphic.infoTemplate),a.setSymbol(C.graphic.symbol)):(a=C.graphic,this.get("highlightLocation")&&(B?B.add(a):this.get("map").graphics.add(a)));this.set("highlightGraphic",a)}this._hideLoading();
this.emit("locate",C)},_locateError:function(C){C={graphic:this._graphic,scale:this._scale,position:this._position,error:C};this._hideLoading();this.emit("locate",C)},_showLoading:function(){this.get("useTracking")||x.add(this._locateNode,this._css.loading)},_hideLoading:function(){this.get("useTracking")||x.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",
{})},_updateThemeWatch:function(C,a,B){x.remove(this.domNode,a);x.add(this.domNode,B)},_visible:function(){this.get("visible")?F.set(this.domNode,"display","block"):F.set(this.domNode,"display","none")}});X("extend-esri")&&O.setObject("dijit.LocateButton",V,N);return V})},"widgets/NearMe/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/Search/templates/Search.html":'\x3cdiv role\x3d"presentation" class\x3d"${theme}"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${css.searchGroup}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"expandNode" class\x3d"${css.searchExpandContainer}"\x3e\r\n      \x3cdiv class\x3d"${css.searchAnimateContainer}"\x3e\r\n        \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchIn}" id\x3d"${id}_menu_button" class\x3d"${css.searchBtn} ${css.searchToggle}" tabindex\x3d"0" data-dojo-attach-point\x3d"sourcesBtnNode"\x3e\r\n          \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchToggleIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${css.searchSourceName}" data-dojo-attach-point\x3d"sourceNameNode"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${css.searchInputGroup}"\x3e\r\n          \x3cform data-dojo-attach-point\x3d"formNode"\x3e\r\n            \x3cinput maxlength\x3d"${maxLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${css.searchInput}" value\x3d"${value}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n          \x3c/form\x3e\r\n          \x3cdiv role\x3d"button" class\x3d"${css.searchClear}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchClearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchSpinner}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"suggestionsNode" class\x3d"${css.searchMenu} ${css.suggestionsMenu}"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchButtonTitle}" class\x3d"${css.searchBtn} ${css.searchSubmit}" tabindex\x3d"0" data-dojo-attach-point\x3d"submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${css.searchButtonText}"\x3e${_i18n.widgets.Search.main.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"sourcesNode" class\x3d"${css.searchMenu} ${css.sourcesMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noResultsMenuNode" class\x3d"${css.searchMenu} ${css.searchNoResultsMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.searchClearFloat}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/NearMe/item-list.html":'\x3cdiv class\x3d"esriCTItemlList"\x3e\r\n    \x3cdiv class\x3d"esriCTBackButton"\x3e\r\n        \x3cdiv class\x3d"esriCTItemLeftArrow"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTItemRightArrow"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTItemCount esriCTLoadingIcon"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTItemName"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/NearMe/swiperLayout.html":'\x3cdiv class\x3d"swiper-container"\x3e\r\n    \x3cdiv class\x3d"swiper-wrapper"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-button-prev"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-button-next"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-pagination"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"swiper-scrollbar"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/NearMe/filter-list.html":'\x3cdiv\x3e\r\n  \x3cul class\x3d"filter-list" data-dojo-attach-point\x3d"filterList"\x3e\x3c/ul\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/NearMe/Widget.html":'\x3cdiv\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"widgetMainNode" class\x3d"esriCTWidgetMainNode esriCTHidden"\x3e\r\n        \x3cdiv class\x3d"esriCTSearchOuterContainer" data-dojo-attach-point\x3d"searchOuterContainer"\x3e\r\n            \x3cdiv class\x3d"esriCTSearchHeader firstFocusNode" data-dojo-attach-point\x3d"searchHeaderTextNode" role\x3d"presentation" tabindex\x3d"0"\r\n                aria-label\x3d"${nls.searchHeaderText}"\x3e${nls.searchHeaderText}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTSearchContainer"\x3e\r\n                \x3cdiv class\x3d"esriCTSearchDiv"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"search"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTCurrentLocationDiv esriCTImgButtons esriCTCurrentLocation esriCTHidden"\r\n                    data-dojo-attach-point\x3d"currentLocationNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv role\x3d"button" tabindex\x3d"0"\r\n                    class\x3d"esriCTSelectLocationDiv esriCTImgButtons esriCTSelectLocation esriCTHidden"\r\n                    data-dojo-attach-point\x3d"selectLocation" aria-label\x3d"${nls.selectLocationToolTip}"\r\n                    title\x3d"${nls.selectLocationToolTip}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv style\x3d"clear: both"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTBufferOptionParentDiv esriCTHidden" data-dojo-attach-point\x3d"bufferOptionParentNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"bufferTextboxParentNode" class\x3d"esriCTBufferTextboxParent"\x3e\r\n                    \x3cdiv class\x3d"esriCTBufferTextboxText" data-dojo-attach-point\x3d"bufferTextboxText"\x3e\r\n                        ${nls.bufferTextboxLabel}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" aria-label\x3d"${nls.bufferTextboxLabel}" data-dojo-attach-point\x3d"bufferTextboxNode"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTSliderDiv" data-dojo-attach-point\x3d"sliderParentNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"silderText" class\x3d"esriCTSliderText" tabindex\x3d"0" role\x3d"presentation" \x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"horizantalSliderContainer"\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"esriCTSliderValuesDiv"\x3e\r\n                        \x3cdiv class\x3d"esriCTSliderMinValueDiv" data-dojo-attach-point\x3d"sliderMinValue"\x3e\r\n                        \x3c/div\x3e\r\n                        \x3cdiv class\x3d"esriCTSliderMaxValueDiv" data-dojo-attach-point\x3d"sliderMaxValue"\x3e\r\n                        \x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv data-dojo-attach-point\x3d"applyFilterNode" class\x3d"esriCTApplyFilterDiv"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"applyFilterArrowNodeParent" class\x3d"esriCTapplyFilterArrowNodeParent"  tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.filterTitle}"\x3e\r\n                    \x3cdiv class\x3d"esriCTFilterToApply" \x3e\r\n                        ${nls.filterTitle}\r\n                    \x3c/div\x3e\r\n                    \x3cdiv title\x3d"${nls.filterTitle}"\r\n                        data-dojo-attach-point\x3d"applyFilterArrowNode"\r\n                        class\x3d"esriCTApplyFilterArrowNode esriCTApplyFilterArrowDown"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearFilterButton}" title\x3d"${nls.clearFilterButton}"\r\n                    data-dojo-attach-point\x3d"clearAllFilterButton" aria-disabled\x3d"false"\r\n                    class\x3d"esriCTClearAllFilter esriCTClearAllFilterActive"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv style\x3d"clear: both"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"esriCTWidgetErrorNode" data-dojo-attach-point\x3d"widgetErrorNode"\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"layerListOuterDiv" class\x3d"esriCTListOuterContainer"\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"filterListOuterDiv" class\x3d"esriCTListOuterContainer esriCTHidden"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"filterListMainDiv" class\x3d"esriCTFilterListMainContainer"\x3e\r\n                \x3cdiv style\x3d"height: 100%;" data-dojo-attach-point\x3d"filterListNode"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/NearMe/css/style.css":".swiper-container {margin-left: auto; margin-right: auto; position: relative; overflow: hidden; z-index: 1;}.swiper-container-no-flexbox .swiper-slide {float: left;}.swiper-container-vertical \x3e .swiper-wrapper {-webkit-box-orient: vertical; -moz-box-orient: vertical; -ms-flex-direction: column; -webkit-flex-direction: column; flex-direction: column;}.swiper-wrapper {position: relative; width: 100%; height: 100%; z-index: 1; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-transition-property: -webkit-transform; -moz-transition-property: -moz-transform; -o-transition-property: -o-transform; -ms-transition-property: -ms-transform; transition-property: transform; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box;}.swiper-container-android .swiper-slide,.swiper-wrapper {-webkit-transform: translate3d(0px, 0, 0); -moz-transform: translate3d(0px, 0, 0); -o-transform: translate(0px, 0px); -ms-transform: translate3d(0px, 0, 0); transform: translate3d(0px, 0, 0);}.swiper-container-multirow \x3e .swiper-wrapper {-webkit-box-lines: multiple; -moz-box-lines: multiple; -ms-flex-wrap: wrap; -webkit-flex-wrap: wrap; flex-wrap: wrap;}.swiper-container-free-mode \x3e .swiper-wrapper {-webkit-transition-timing-function: ease-out; -moz-transition-timing-function: ease-out; -ms-transition-timing-function: ease-out; -o-transition-timing-function: ease-out; transition-timing-function: ease-out; margin: 0 auto;}.swiper-slide {-webkit-flex-shrink: 0; -ms-flex: 0 0 auto; flex-shrink: 0; width: 100%; height: 100%; position: relative;}.swiper-container-autoheight,.swiper-container-autoheight .swiper-slide {height: auto;}.swiper-container-autoheight .swiper-wrapper {-webkit-box-align: start; -ms-flex-align: start; -webkit-align-items: flex-start; align-items: flex-start; -webkit-transition-property: -webkit-transform, height; -moz-transition-property: -moz-transform; -o-transition-property: -o-transform; -ms-transition-property: -ms-transform; transition-property: transform, height;}.swiper-container .swiper-notification {position: absolute; left: 0; top: 0; pointer-events: none; opacity: 0; z-index: -1000;}.swiper-wp8-horizontal {-ms-touch-action: pan-y; touch-action: pan-y;}.swiper-wp8-vertical {-ms-touch-action: pan-x; touch-action: pan-x;}.swiper-button-prev,.swiper-button-next {position: absolute; top: 50%; width: 27px; height: 44px; margin-top: -22px; z-index: 10; cursor: pointer; -moz-background-size: 27px 44px; -webkit-background-size: 27px 44px; background-size: 27px 44px; background-position: center; background-repeat: no-repeat;}.swiper-button-prev.swiper-button-disabled,.swiper-button-next.swiper-button-disabled {opacity: 0.35; cursor: auto; pointer-events: none;}.swiper-button-prev,.swiper-container-rtl .swiper-button-next {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M0%2C22L22%2C0l2.1%2C2.1L4.2%2C22l19.9%2C19.9L22%2C44L0%2C22L0%2C22L0%2C22z'%20fill%3D'%23007aff'%2F%3E%3C%2Fsvg%3E\"); left: 10px; right: auto;}.swiper-button-prev.swiper-button-black,.swiper-container-rtl .swiper-button-next.swiper-button-black {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M0%2C22L22%2C0l2.1%2C2.1L4.2%2C22l19.9%2C19.9L22%2C44L0%2C22L0%2C22L0%2C22z'%20fill%3D'%23000000'%2F%3E%3C%2Fsvg%3E\");}.swiper-button-prev.swiper-button-white,.swiper-container-rtl .swiper-button-next.swiper-button-white {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M0%2C22L22%2C0l2.1%2C2.1L4.2%2C22l19.9%2C19.9L22%2C44L0%2C22L0%2C22L0%2C22z'%20fill%3D'%23ffffff'%2F%3E%3C%2Fsvg%3E\");}.swiper-button-next,.swiper-container-rtl .swiper-button-prev {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M27%2C22L27%2C22L5%2C44l-2.1-2.1L22.8%2C22L2.9%2C2.1L5%2C0L27%2C22L27%2C22z'%20fill%3D'%23007aff'%2F%3E%3C%2Fsvg%3E\"); right: 10px; left: auto;}.swiper-button-next.swiper-button-black,.swiper-container-rtl .swiper-button-prev.swiper-button-black {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M27%2C22L27%2C22L5%2C44l-2.1-2.1L22.8%2C22L2.9%2C2.1L5%2C0L27%2C22L27%2C22z'%20fill%3D'%23000000'%2F%3E%3C%2Fsvg%3E\");}.swiper-button-next.swiper-button-white,.swiper-container-rtl .swiper-button-prev.swiper-button-white {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2027%2044'%3E%3Cpath%20d%3D'M27%2C22L27%2C22L5%2C44l-2.1-2.1L22.8%2C22L2.9%2C2.1L5%2C0L27%2C22L27%2C22z'%20fill%3D'%23ffffff'%2F%3E%3C%2Fsvg%3E\");}.swiper-pagination {position: absolute; text-align: center; -webkit-transition: 300ms; -moz-transition: 300ms; -o-transition: 300ms; transition: 300ms; -webkit-transform: translate3d(0, 0, 0); -ms-transform: translate3d(0, 0, 0); -o-transform: translate3d(0, 0, 0); transform: translate3d(0, 0, 0); z-index: 10;}.swiper-pagination.swiper-pagination-hidden {opacity: 0;}.swiper-pagination-fraction,.swiper-pagination-custom,.swiper-container-horizontal \x3e .swiper-pagination-bullets {bottom: 10px; left: 0; width: 100%;}.swiper-pagination-bullet {width: 8px; height: 8px; display: inline-block; border-radius: 100%; background: #000; opacity: 0.2;}button.swiper-pagination-bullet {border: none; margin: 0; padding: 0; box-shadow: none; -moz-appearance: none; -ms-appearance: none; -webkit-appearance: none; appearance: none;}.swiper-pagination-clickable .swiper-pagination-bullet {cursor: pointer;}.swiper-pagination-white .swiper-pagination-bullet {background: #fff;}.swiper-pagination-bullet-active {opacity: 1; background: #007aff;}.swiper-pagination-white .swiper-pagination-bullet-active {background: #fff;}.swiper-pagination-black .swiper-pagination-bullet-active {background: #000;}.swiper-container-vertical \x3e .swiper-pagination-bullets {right: 10px; top: 50%; -webkit-transform: translate3d(0px, -50%, 0); -moz-transform: translate3d(0px, -50%, 0); -o-transform: translate(0px, -50%); -ms-transform: translate3d(0px, -50%, 0); transform: translate3d(0px, -50%, 0);}.swiper-container-vertical \x3e .swiper-pagination-bullets .swiper-pagination-bullet {margin: 5px 0; display: block;}.swiper-container-horizontal \x3e .swiper-pagination-bullets .swiper-pagination-bullet {margin: 0 5px;}.swiper-pagination-progress {background: rgba(0, 0, 0, 0.25); position: absolute;}.swiper-pagination-progress .swiper-pagination-progressbar {background: #007aff; position: absolute; left: 0; top: 0; width: 100%; height: 100%; -webkit-transform: scale(0); -ms-transform: scale(0); -o-transform: scale(0); transform: scale(0); -webkit-transform-origin: left top; -moz-transform-origin: left top; -ms-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top;}.swiper-container-rtl .swiper-pagination-progress .swiper-pagination-progressbar {-webkit-transform-origin: right top; -moz-transform-origin: right top; -ms-transform-origin: right top; -o-transform-origin: right top; transform-origin: right top;}.swiper-container-horizontal \x3e .swiper-pagination-progress {width: 100%; height: 4px; left: 0; top: 0;}.swiper-container-vertical \x3e .swiper-pagination-progress {width: 4px; height: 100%; left: 0; top: 0;}.swiper-pagination-progress.swiper-pagination-white {background: rgba(255, 255, 255, 0.5);}.swiper-pagination-progress.swiper-pagination-white .swiper-pagination-progressbar {background: #fff;}.swiper-pagination-progress.swiper-pagination-black .swiper-pagination-progressbar {background: #000;}.swiper-container-3d {-webkit-perspective: 1200px; -moz-perspective: 1200px; -o-perspective: 1200px; perspective: 1200px;}.swiper-container-3d .swiper-wrapper,.swiper-container-3d .swiper-slide,.swiper-container-3d .swiper-slide-shadow-left,.swiper-container-3d .swiper-slide-shadow-right,.swiper-container-3d .swiper-slide-shadow-top,.swiper-container-3d .swiper-slide-shadow-bottom,.swiper-container-3d .swiper-cube-shadow {-webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d;}.swiper-container-3d .swiper-slide-shadow-left,.swiper-container-3d .swiper-slide-shadow-right,.swiper-container-3d .swiper-slide-shadow-top,.swiper-container-3d .swiper-slide-shadow-bottom {position: absolute; left: 0; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;}.swiper-container-3d .swiper-slide-shadow-left {background-image: -webkit-gradient(linear, left top, right top, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-3d .swiper-slide-shadow-right {background-image: -webkit-gradient(linear, right top, left top, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-3d .swiper-slide-shadow-top {background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-3d .swiper-slide-shadow-bottom {background-image: -webkit-gradient(linear, left bottom, left top, from(rgba(0, 0, 0, 0.5)), to(rgba(0, 0, 0, 0))); background-image: -webkit-linear-gradient(top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -moz-linear-gradient(top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: -o-linear-gradient(top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0));}.swiper-container-coverflow .swiper-wrapper,.swiper-container-flip .swiper-wrapper {-ms-perspective: 1200px;}.swiper-container-cube,.swiper-container-flip {overflow: visible;}.swiper-container-cube .swiper-slide,.swiper-container-flip .swiper-slide {pointer-events: none; -webkit-backface-visibility: hidden; -moz-backface-visibility: hidden; -ms-backface-visibility: hidden; backface-visibility: hidden; z-index: 1;}.swiper-container-cube .swiper-slide .swiper-slide,.swiper-container-flip .swiper-slide .swiper-slide {pointer-events: none;}.swiper-container-cube .swiper-slide-active,.swiper-container-flip .swiper-slide-active,.swiper-container-cube .swiper-slide-active .swiper-slide-active,.swiper-container-flip .swiper-slide-active .swiper-slide-active {pointer-events: auto;}.swiper-container-cube .swiper-slide-shadow-top,.swiper-container-flip .swiper-slide-shadow-top,.swiper-container-cube .swiper-slide-shadow-bottom,.swiper-container-flip .swiper-slide-shadow-bottom,.swiper-container-cube .swiper-slide-shadow-left,.swiper-container-flip .swiper-slide-shadow-left,.swiper-container-cube .swiper-slide-shadow-right,.swiper-container-flip .swiper-slide-shadow-right {z-index: 0; -webkit-backface-visibility: hidden; -moz-backface-visibility: hidden; -ms-backface-visibility: hidden; backface-visibility: hidden;}.swiper-container-cube .swiper-slide {visibility: hidden; -webkit-transform-origin: 0 0; -moz-transform-origin: 0 0; -ms-transform-origin: 0 0; transform-origin: 0 0; width: 100%; height: 100%;}.swiper-container-cube.swiper-container-rtl .swiper-slide {-webkit-transform-origin: 100% 0; -moz-transform-origin: 100% 0; -ms-transform-origin: 100% 0; transform-origin: 100% 0;}.swiper-container-cube .swiper-slide-active,.swiper-container-cube .swiper-slide-next,.swiper-container-cube .swiper-slide-prev,.swiper-container-cube .swiper-slide-next + .swiper-slide {pointer-events: auto; visibility: visible;}.swiper-container-cube .swiper-cube-shadow {position: absolute; left: 0; bottom: 0px; width: 100%; height: 100%; background: #000; opacity: 0.6; -webkit-filter: blur(50px); filter: blur(50px); z-index: 0;}.swiper-container-fade.swiper-container-free-mode .swiper-slide {-webkit-transition-timing-function: ease-out; -moz-transition-timing-function: ease-out; -ms-transition-timing-function: ease-out; -o-transition-timing-function: ease-out; transition-timing-function: ease-out;}.swiper-container-fade .swiper-slide {pointer-events: none; -webkit-transition-property: opacity; -moz-transition-property: opacity; -o-transition-property: opacity; transition-property: opacity;}.swiper-container-fade .swiper-slide .swiper-slide {pointer-events: none;}.swiper-container-fade .swiper-slide-active,.swiper-container-fade .swiper-slide-active .swiper-slide-active {pointer-events: auto;}.swiper-zoom-container {width: 100%; height: 100%; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-box-pack: center; -moz-box-pack: center; -ms-flex-pack: center; -webkit-justify-content: center; justify-content: center; -webkit-box-align: center; -moz-box-align: center; -ms-flex-align: center; -webkit-align-items: center; align-items: center; text-align: center;}.swiper-zoom-container \x3e img,.swiper-zoom-container \x3e svg,.swiper-zoom-container \x3e canvas {max-width: 100%; max-height: 100%; object-fit: contain;}.swiper-scrollbar {border-radius: 10px; position: relative; -ms-touch-action: none; background: rgba(0, 0, 0, 0.1);}.swiper-container-horizontal \x3e .swiper-scrollbar {position: absolute; left: 1%; bottom: 3px; z-index: 50; height: 5px; width: 98%;}.swiper-container-vertical \x3e .swiper-scrollbar {position: absolute; right: 3px; top: 1%; z-index: 50; width: 5px; height: 98%;}.swiper-scrollbar-drag {height: 100%; width: 100%; position: relative; background: rgba(0, 0, 0, 0.5); border-radius: 10px; left: 0; top: 0;}.swiper-scrollbar-cursor-drag {cursor: move;}.swiper-lazy-preloader {width: 42px; height: 42px; position: absolute; left: 50%; top: 50%; margin-left: -21px; margin-top: -21px; z-index: 10; -webkit-transform-origin: 50%; -moz-transform-origin: 50%; transform-origin: 50%; -webkit-animation: swiper-preloader-spin 1s steps(12, end) infinite; -moz-animation: swiper-preloader-spin 1s steps(12, end) infinite; animation: swiper-preloader-spin 1s steps(12, end) infinite;}.swiper-lazy-preloader:after {display: block; content: \"\"; width: 100%; height: 100%; background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20viewBox%3D'0%200%20120%20120'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20xmlns%3Axlink%3D'http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink'%3E%3Cdefs%3E%3Cline%20id%3D'l'%20x1%3D'60'%20x2%3D'60'%20y1%3D'7'%20y2%3D'27'%20stroke%3D'%236c6c6c'%20stroke-width%3D'11'%20stroke-linecap%3D'round'%2F%3E%3C%2Fdefs%3E%3Cg%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(30%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(60%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(90%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(120%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(150%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.37'%20transform%3D'rotate(180%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.46'%20transform%3D'rotate(210%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.56'%20transform%3D'rotate(240%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.66'%20transform%3D'rotate(270%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.75'%20transform%3D'rotate(300%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.85'%20transform%3D'rotate(330%2060%2C60)'%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\"); background-position: 50%; -webkit-background-size: 100%; background-size: 100%; background-repeat: no-repeat;}.swiper-lazy-preloader-white:after {background-image: url(\"data:image/svg+xml;charset\x3dutf-8,%3Csvg%20viewBox%3D'0%200%20120%20120'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20xmlns%3Axlink%3D'http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink'%3E%3Cdefs%3E%3Cline%20id%3D'l'%20x1%3D'60'%20x2%3D'60'%20y1%3D'7'%20y2%3D'27'%20stroke%3D'%23fff'%20stroke-width%3D'11'%20stroke-linecap%3D'round'%2F%3E%3C%2Fdefs%3E%3Cg%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(30%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(60%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(90%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(120%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(150%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.37'%20transform%3D'rotate(180%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.46'%20transform%3D'rotate(210%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.56'%20transform%3D'rotate(240%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.66'%20transform%3D'rotate(270%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.75'%20transform%3D'rotate(300%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.85'%20transform%3D'rotate(330%2060%2C60)'%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\");}@-webkit-keyframes swiper-preloader-spin {100% {-webkit-transform: rotate(360deg);}}@keyframes swiper-preloader-spin {100% {transform: rotate(360deg);}}.jimu-widget-nearme-filter {width: 100%; height: 100%; position: relative;}.jimu-widget-nearme-filter .filter-list{height: 100%; overflow: auto; border-top: 1px solid #d7d7d7;} .jimu-widget-nearme-filter .filter-list,.jimu-widget-nearme-filter .filter-list li {margin: 0; padding: 0;}.jimu-widget-nearme-filter .filter-list li {list-style: none;}.jimu-widget-nearme-filter .filter-list .filter-item{border-bottom: 1px solid #d7d7d7; font-size: 12px; overflow: hidden; outline-offset: -2px;}.jimu-widget-nearme-filter .filter-list .filter-item .header{vertical-align: middle; padding-top: 12px; padding-bottom: 12px; min-height: 40px; cursor: pointer; position: relative;}.jimu-widget-nearme-filter .filter-list .filter-item .header:hover{background-color: #eee;}.jimu-widget-nearme-filter .filter-list .filter-item.config-parameters .header .item-title{font-family: 'Avenir Medium', Verdana, Geneva, sans-serif;}.jimu-widget-nearme-filter .filter-list .filter-item .body{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.config-parameters .body{display: block;}.jimu-widget-nearme-filter .filter-list .filter-item .header\x3e*{line-height: 25px; display: inline-block; vertical-align: middle; word-break: break-word;}.jimu-widget-nearme-filter .filter-list .filter-item .header\x3e.icon{vertical-align: top;}.jimu-widget-nearme-filter .filter-list .filter-item .header:after{content: \"\"; height: 100%; min-height: 16px; vertical-align: top; display: inline-block;}.jimu-widget-nearme-filter .filter-list .filter-item .header .icon{width: 25px; height: 25px; margin-right: 5px;}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .icon{margin-right: 0; margin-left: 5px;}.jimu-widget-nearme-filter .filter-list .filter-item .header .icon img{width: 100%; height: 100%;}.jimu-widget-nearme-filter .filter-list .filter-item .header .cando{display: block; position: absolute; top: 14px; right: 0; width: 16px; height: 16px; content: ''; border-radius: 50%; text-indent: -9999em; background: none; border: 2px solid #d6d6d6;}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .cando{left: 0; right: auto;}.jimu-widget-nearme-filter .filter-list .filter-item .header .doing{display: none; position: absolute; top: 14px; right: 0; width: 16px; height: 16px; border-radius: 50%; text-indent: -9999em; background: none; border: 2px solid #d6d6d6; border-left-color: #4A4A4A; -webkit-animation: load8 1.1s infinite linear; -moz-animation: load8 1.1s infinite linear; -ms-animation: load8 1.1s infinite linear; -o-animation: load8 1.1s infinite linear; animation: load8 1.1s infinite linear; -webkit-transform: translateZ(0); -moz-transform: translateZ(0); -ms-transform: translateZ(0); -o-transform: translateZ(0); transform: translateZ(0);}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .doing{left: 0; right: auto;}.jimu-widget-nearme-filter .filter-list .filter-item .header .done{display: none; position: absolute; top: 14px; right: 0; width: 16px; height: 16px; border-radius: 50%; text-indent: -9999em; background: url(\"images/done.svg\") no-repeat center;}.jimu-rtl .jimu-widget-nearme-filter .filter-list .filter-item .header .done{left: 0; right: auto;}.jimu-widget-nearme-filter .filter-list .filter-item.requesting .header .cando,.jimu-widget-nearme-filter .filter-list .filter-item.applying .header .cando{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.requesting .header .doing,.jimu-widget-nearme-filter .filter-list .filter-item.applying .header .doing{display: block;}.jimu-widget-nearme-filter .filter-list .filter-item.requesting .header .done,.jimu-widget-nearme-filter .filter-list .filter-item.applying .header .done{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.applied .header .cando{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.applied .header .doing{display: none;}.jimu-widget-nearme-filter .filter-list .filter-item.applied .header .done{display: block;}.jimu-widget-nearme-filter .filter-list .filter-item .header .arrow{content: ''; border-radius: 50%; width: 16px; height: 25px; top: 12px; text-indent: -9999em; background: url(\"images/arrow_normal.svg\") no-repeat center; z-index: 10;}.jimu-widget-nearme-filter .filter-list .filter-item .header .arrow:hover{background: url(\"images/arrow_hover.svg\") no-repeat center;}.jimu-widget-nearme-filter .filter-list .filter-item.config-parameters .header .arrow{transform: rotate(90deg);}.jimu-widget-nearme-filter .filter-list .filter-item.not-has-ask-for-value .header .arrow{background: transparent !important;}.jimu-widget-nearme-filter .filter-list .filter-item .body .parameters{margin: 0 30px;}.jimu-widget-nearme-filter .filter-list .filter-item .body .jimu-btn{background: #fff; border-radius: 0; width: 82px; border: 1px solid #c7c7c7; color: #000; font-size: 12px; margin-bottom: 15px;}.jimu-widget-nearme-filter .filter-list .filter-item .body .jimu-btn:hover{border: 1px solid #000;}.jimu-widget-nearme-filter .jimu-loading-shelter .loading-container{width: auto;}.jimu-widget-nearme-filter .esriCTGroupFilterLayerName{vertical-align: middle; min-height: 40px; font-weight: bold; font-size: 14px; padding: 12px; border-bottom: 1px solid #d7d7d7;}@-webkit-keyframes load8 {0% {-webkit-transform: rotate(0deg); transform: rotate(0deg);} 100% {-webkit-transform: rotate(360deg); transform: rotate(360deg);}}@-moz-keyframes load8 {0% {-moz-transform: rotate(0deg); transform: rotate(0deg);} 100% {-moz-transform: rotate(360deg); transform: rotate(360deg);}}@-ms-keyframes load8 {0% {-ms-transform: rotate(0deg); transform: rotate(0deg);} 100% {-ms-transform: rotate(360deg); transform: rotate(360deg);}}@keyframes load8 {0% {-webkit-transform: rotate(0deg); -ms-transform: rotate(0deg); -moz-transform: rotate(0deg); transform: rotate(0deg);} 100% {-webkit-transform: rotate(360deg); -ms-transform: rotate(360deg); -moz-transform: rotate(360deg); transform: rotate(360deg);}}.jimu-widget-nearme .swiper-container {width: 100%; height: 250px;}.jimu-widget-nearme .swiper-slide {text-align: center; font-size: 18px; background: #fff; display: -webkit-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-box-pack: center; -ms-flex-pack: center; -webkit-justify-content: center; justify-content: center; -webkit-box-align: center; -ms-flex-align: center; -webkit-align-items: center; align-items: center;}.jimu-widget-nearme .swiper-slide img {max-width: 100%; height: auto;}.jimu-widget-nearme .swiper-slide .chart {width: 200px; height: 200px;}.jimu-widget-nearme .swiper-pagination-bullet:focus {opacity: 1 !important;}.esriCTNearMeContentPanel{padding: 15px 0px !important; overflow-y: hidden !important;}.esriCTContentPanelNoPadding{padding: 0 0 !important;}.jimu-widget-nearme{min-width: 222px; height: 100%; overflow-x: hidden;}.jimu-widget-nearme .esriCTHidden{display: none;}.jimu-widget-nearme .esriCTWidgetMainNode{min-height: 200px;}.jimu-widget-nearme .esriCTWidgetErrorNode{padding: 0px 14px;}.jimu-widget-nearme .mediaSection{padding-bottom: 10px; clear: both;}.jimu-widget-nearme .esriCTDistanceToLocation{line-height: 25px; margin-top: 10px; background-color: #d9dde0; text-align: center;}.jimu-widget-nearme .simpleDirections .esriSearchSourceContainer{display: none;}.jimu-widget-nearme .simpleDirections .esriStopsContainer{height: 0px; margin: 0px;}.jimu-widget-nearme .getDirectionsBtnContainer{display: none;}.jimu-widget-nearme .esriStopsTableContainer{display: none;}.jimu-widget-nearme .esriStopsButtons{display: none;}.jimu-widget-nearme .simpleDirections{margin-top: 20px;}.jimu-widget-nearme .simpleDirections .savePrintBtnContainer{position: relative; top: 15px; left: 90%; margin: 0px; z-index: 1;}.jimu-launchpad-panel .jimu-widget-nearme .simpleDirections .savePrintBtnContainer{top: 10px;}.jimu-launchpad-panel .jimu-widget-nearme .simpleDirections .esriStopsGetDirectionsContainer{padding-top: 0; margin: 0px 10px;}.jimu-widget-nearme .simpleDirections .esriResultsSummary{padding: 0 40px;}.jimu-widget-nearme .simpleDirections .esriResultsLoading .esriResultsContainer{display: none;}.jimu-widget-nearme .esriCTSliderDiv{height: 60px; padding-top: 10px; clear: both;}.jimu-widget-nearme .esriCTOverrideSliderDiv{padding-top: 2px;}.jimu-widget-nearme .esriCTSliderText{font-size: 12px; color: #000000; font-weight: normal;}.jimu-widget-nearme .esriCTHorizantalSlider{width: 100%; margin-top: 15px;}.jimu-widget-nearme .esriCTSliderValuesDiv{width: 100%; margin-top: 8px;}.jimu-widget-nearme .esriCTSliderMinValueDiv{float: left; margin-left: 2px;}.jimu-widget-nearme .esriCTSliderMaxValueDiv{float: right; margin-right: 2px;}.claro .jimu-widget-nearme .dijitSlider {background: transparent; border: 0 none; -webkit-border-radius: 3px; border-radius: 3px; padding: 0;}.claro .jimu-widget-nearme .dijitSliderBar {border-style: solid; outline: 1px;}.claro .jimu-widget-nearme .dijitRuleLabelsContainer {color: #2b2e34;}.claro .jimu-widget-nearme .dijitSliderDisabled {opacity: 0.65; -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d65)\"; filter: alpha(opacity\x3d65);}.claro .jimu-widget-nearme .dijitRuleLabelsContainerH {padding: 8px 0 !important; color: #878787 !important;}.claro .jimu-widget-nearme .dijitSliderBarH,.claro .jimu-widget-nearme .dijitSliderBumperH {height: 4px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderLeftBumper {-webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px; border-width: 1px 0 1px 1px; margin-left: 4px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderRightBumper {-webkit-border-radius: 0 2px 2px 0; border-radius: 0 2px 2px 0; border-width: 1px 1px 1px 0; margin-left: -2px; margin-right: 4px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderProgressBarH {border-color: #878787; background-color: #878787; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderLeftBumper {border-color: #878787; background-color: #878787; background-image: none; -webkit-box-shadow: none; box-shadow: none; -webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px;}.claro .jimu-widget-nearme .dijitSlider .dijitSliderRemainingBarH,.claro .jimu-widget-nearme .dijitSlider .dijitSliderRightBumper {border-color: #ebebeb; background-color: #ebebeb; -webkit-border-radius: 2px; border-radius: 2px;}.claro .jimu-widget-nearme .dijitSliderHover .dijitSliderProgressBarH,.claro .jimu-widget-nearme .dijitSliderHover .dijitSliderLeftBumper {border-color: #6e6e6e; background-color: #6e6e6e; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderProgressBarH,.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderLeftBumper {border-color: #878787;}.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderRemainingBarH,.claro .jimu-widget-nearme .dijitSliderFocused .dijitSliderRightBumper {border-color: #ebebeb; background-color: #ebebeb; -webkit-box-shadow: none; box-shadow: none;}.claro .jimu-widget-nearme .dijitSliderRtl .dijitSliderLeftBumper,.claro .jimu-widget-nearme .dijitSliderRtl .dijitSliderRightBumper{display: none;}.claro .jimu-widget-nearme .dijitSliderImageHandle {background: #878787; -webkit-border-radius: 50%; border-radius: 50%; border: 0 none; width: 16px; height: 16px; margin-top: -2px; position: absolute;}.claro .jimu-widget-nearme .dijitSliderImageHandle:after {content: \"\"; display: block; background: #ffffff; -webkit-border-radius: 50%; border-radius: 50%; height: 8px; width: 8px; left: 4px; top: 4px; position: absolute;}.claro .jimu-widget-nearme .dijitSliderDisabled.dijitSliderFocused .dijitSliderImageHandle:after {display: none; outline: none;}.claro .jimu-widget-nearme .dijitSliderDecrementIconH,.claro .jimu-widget-nearme .dijitSliderIncrementIconH,.claro .jimu-widget-nearme .jimu-widget-nearme .dijitSliderDecrementIconH:hover,.claro .jimu-widget-nearme .dijitSliderIncrementIconH:hover{padding: 0; height: 20px; width: 20px; background-color: transparent; border: 0 none;}.jimu-widget-nearme .esriCTSearchDiv{float: left;}.jimu-widget-nearme .esriCTSearchDiv .arcgisSearch{float: left; width: 100% !important;}.jimu-widget-nearme .esriCTSearchContainer{width: 100%; height: 35px; float: left; clear: both;}.jimu-widget-nearme .arcgisSearch .searchGroup .searchInput{width: 170px;}.jimu-widget-nearme .arcgisSearch .searchBtn{padding: 6px;}.jimu-widget-search .arcgisSearch .searchGroup .searchInputGroup .searchInput{width: auto;}.jimu-widget-nearme .esriCTSearchOuterContainer{width: calc(100% - 40px); margin: 0 auto;}.jimu-widget-nearme .esriCTSearchHeader{padding: 2px 2px 10px 2px; font-size: 12px; color: #000000; font-weight: normal; outline-offset: -2px;}.jimu-widget-nearme .arcgisSearch .searchToggle:focus{outline: 2px solid #18acc2;}.jimu-launchpad-panel .jimu-widget-nearme .arcgisSearch .searchClose, .arcgisSearch .searchSpinner{height: 28px;}.jimu-widget-nearme .arcgisSearch .searchMenu{max-height: 250px;}.jimu-widget-nearme .esriCTSelectLocationDiv{margin: 0px 0px 0px 12px; float: right;}.jimu-widget-nearme .esriCTSelectLocation{background-image: url(\"../images/select-location.png\");}.jimu-widget-nearme .esriCTSelectLocationActive{background-image: url(\"../images/select-location-active.png\"); background-color: #57585A;}.jimu-widget-nearme .esriCTImgButtons{cursor: pointer; width: 32px; height: 34px; border: 1px solid #57585A; border-radius: 4px; background-size: 20px; background-position: center center; background-repeat: no-repeat;}.jimu-widget-nearme .esriCTCurrentLocationDiv{margin: 0px 0px 0px 12px; float: left;}.jimu-widget-nearme .esriCTCurrentLocation .LocateButton .zoomLocateButton{background-image: url(\"../images/current-location.png\"); background-color: transparent; background-size: 20px; background-position: center center; background-repeat: no-repeat;}.esriRtl .jimu-widget-nearme .esriCTCurrentLocationDiv{margin: 0px 12px 12px 0px;float: right;}.jimu-widget-nearme .jimu-loading-indicator{z-index: 100;}.jimu-widget-nearme .esriCTListOuterContainer{margin-top: 10px;}.jimu-widget-nearme .esriCTItemListMainContainer{width: 100%; right: 0px; min-height: 80px; left: 0px; height: calc(100% - 188px); position: absolute; padding-top: 5px;}.jimu-widget-nearme .esriCTFilterListMainContainer{width: 100%; right: 0px; min-height: 80px; left: 0px; height: calc(100% - 188px); position: absolute;}.jimu-widget-nearme .esriCTItemListOverrideMainContainer{height: calc(100% - 80px);}.jimu-widget-nearme .esriCTItemListOverrideMainContainerForBothBufferOptions{height: calc(100% - 160px);}.jimu-widget-nearme .esriCTItemlList{width: 100%; border-bottom: 1px solid #DDDDDD; min-height: 36px; cursor: pointer; outline-offset: -1px;}.jimu-widget-nearme .esriCTItemlList:focus{font-weight: bolder; outline: 2px solid #18acc2;}.jimu-widget-nearme .esriCTItemName{white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 35px; padding: 0px 10px 0px 20px;}.jimu-widget-nearme .esriCTPanelHeader .esriCTItemName{padding: 0px 20px 0px 0px; font-size: 12px; color: #3e3e3e;}.jimu-widget-nearme .esriCTItemRightArrow, .jimu-widget-nearme .esriCTItemLeftArrow{width: 10px; height: 20px; background-repeat: no-repeat; background-color: #3e3e3e; background-position: center center;}.jimu-widget-nearme .esriCTItemRightArrow{margin: 7px 20px 0px 0px;}.jimu-widget-nearme .esriCTItemLeftArrow{margin: 7px 10px 0px 0px;}.jimu-widget-nearme .esriCTItemCount{float: right; margin: 0px 20px 0px 0px; line-height: 35px; height: 35px; text-align: right; overflow: hidden; max-width: 100px;}.jimu-widget-nearme .esriCTLoadingIcon{background-image: url('../images/loading-icon.gif'); background-position: center center; background-repeat: no-repeat; height: 20px; width: 20px; margin-top: 7px;}.jimu-widget-nearme .esriCTItemRightArrow{background-image: url('../images/right-arrow.png'); float: right;}.jimu-widget-nearme .esriCTItemLeftArrow{background-image: url('../images/left-arrow.png'); float: left;}.esriCTDisabled{cursor: default !important;}.esriCTDisabled .esriCTItemRightArrow{background-color: #d8d8d8;}.jimu-widget-nearme .esriCTBackButtonText{float: left; height: 35px; line-height: 35px; text-overflow: ellipsis; white-space: nowrap; max-width: 100px; overflow: hidden;}.jimu-widget-nearme .esriCTBackButton{float: left;}.jimu-widget-nearme .esriCTPanelHeader{font-weight: bold; padding-left: 20px; padding-right: 20px;}.esriCTDirectionInfoPanel .esriCTItemlList{border-bottom: none;}.esriCTFeatureList .esriCTItemRightArrow, .esriCTLayerList .esriCTItemLeftArrow, .esriCTDirectionInfoPanel .esriCTItemRightArrow, .esriCTDirectionInfoPanel .esriCTItemCount{display: none;}.esriCTFeatureListItem .esriCTItemCount{display: block;}.esriCTFeatureListItem .esriCTItemLeftArrow, .esriCTFeatureListItem .esriCTBackButtonText{display: none;}.jimu-widget-nearme .esriCTLayerList, .jimu-widget-nearme .esriCTFeatureList, .jimu-widget-nearme .esriCTDirectionInfoPanel{border-top: 1px solid #464646; position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; display: none;}.jimu-widget-nearme .esriCTNoFeatureFound{height: 32px; margin: 5px 16px; line-height: 30px;}.jimu-widget-nearme .esriCTFeatureListContent{height: calc(100% - 30px); overflow: auto;}.jimu-widget-nearme .esriCTLayerList{overflow: auto;}.jimu-widget-nearme .esriCTAttributeSymbolWrapper{margin: 5px; display: inline-block;}.jimu-widget-nearme .esriCTAttributeSymbolContainer{float: left; margin-right : 5px;}.jimu-widget-nearme .esriCTItemListMainContainer .editSummarySection{display: none;}.jimu-widget-nearme .jimu-tab \x3e .jimu-viewstack{position: relative; top: 0px; height: 100%;}.jimu-widget-nearme .dijitContentPane{overflow: auto; padding: 0px 20px; -webkit-overflow-scrolling: auto;}.jimu-widget-nearme .esriCTPopupInfo{padding: 20px 0px !important; width: 100% !important; height: auto !important;}.jimu-widget-nearme .jimu-tab{height: calc(100% - 56px); min-height: 80px; margin-top: 2px;}.jimu-widget-nearme .esriCTOverrideHeight{height: calc(100% - 46px);}.jimu-widget-nearme .esriCTFeatureInfo{height: calc(100% - 35px); min-height: 80px;}.jimu-widget-nearme .esriCTFeatureInfo:focus,.jimu-widget-nearme .esriCTInfoPanelFocus:focus{outline: 2px solid #18acc2;}.jimu-widget-nearme .esriCTBorderBottom{border-bottom: 1px solid #464646;}.jimu-widget-nearme .esriCTTopBorder{border-top: 1px solid #464646;}.jimu-widget-nearme .esriCTThumbnailContainer{margin: 2px;}.jimu-widget-nearme .esriCTAttachmentImg{cursor: pointer; position: absolute; margin: auto; top: 0; bottom: 0; right: 0; left: 0;}.jimu-widget-nearme .esriCTNonImageAttachmentImg{cursor: pointer; float: left;}.jimu-widget-nearme .esriCTImageFormatDiv{height: 18px; width: 50px; float: left; background-color: #C4BD97; text-align: center; line-height: 18px; color: #fff;}.jimu-widget-nearme .esriCTNonImageAttachmentContainer{height: 58px; width: 50px; float: left; margin: 0 10px 10px 2px; cursor: pointer;}.jimu-widget-nearme .esriCTImageLoader{cursor: default; display: block; background-position: center center; background-image: url(../images/image-loader.gif); background-repeat: no-repeat; width: 90px; height: 60px;}.jimu-widget-nearme .esriCTAutoHeight{height: auto;}.jimu-widget-nearme .esriViewPopup .break{display: none;}.esriRtl .jimu-widget-nearme .esriCTNonImageAttachmentImg{float: right;}.esriRtl .jimu-widget-nearme .esriCTImageFormatDiv{float: right;}.esriRtl .jimu-widget-nearme .esriCTNonImageAttachmentContainer{margin: 0 2px 10px 10px; float: right;}.esriRtl .jimu-widget-nearme .esriCTSliderMinValueDiv{float: right; margin-right: 2px;}.esriRtl .jimu-widget-nearme .esriCTSliderMaxValueDiv{float: left; margin-left: 2px;}.esriRtl .jimu-widget-nearme .esriCTItemName{padding: 0px 20px 0px 10px;}.esriRtl .jimu-widget-nearme .esriCTPanelHeader .esriCTItemName{padding: 0px 0px 0px 20px;}.esriRtl .jimu-widget-nearme .esriCTItemCount{float: left; margin: 0px 0px 0px 20px;}.esriRtl .jimu-widget-nearme .esriCTItemRightArrow{background-image: url('../images/left-arrow.png'); float: left; margin: 7px 0 0 20px;}.esriRtl .jimu-widget-nearme .esriCTBackButton{float: right;}.esriRtl .jimu-widget-nearme .esriCTItemLeftArrow{background-image: url('../images/right-arrow.png'); margin: 7px 0px 0px 10px;}.esriRtl .jimu-widget-nearme .simpleDirections .savePrintBtnContainer{left: 0px; right: 90%;}.esriRtl .jimu-widget-nearme .esriCTSearchDiv, .esriRtl .jimu-widget-nearme .esriCTAttributeSymbolContainer{float: right;}.esriRtl .jimu-widget-nearme .esriCTSelectLocationDiv{margin: 0px 0px 10px 0px; float: left;}.jimu-widget-nearme .esriCTProximityParent {position: relative; right: 65px; float: right; bottom: -20px;}.esriRtl .jimu-widget-nearme .esriCTProximityParent {right: inherit; left: 65px; float: left;}.jimu-widget-nearme .esriCTProximityIconContainer {position: absolute; height: 40px; width: 40px; background: #fffdfd; border-radius: 25px; box-shadow: 0px 0px 2px 2px #d4d4d4; cursor: pointer; z-index: 1; bottom: 0;}.jimu-widget-nearme .esriCTProximityIcon {background-image: url(../images/proximity.png); background-repeat: no-repeat; background-position: center center; background-color: gray; height: 24px; width: 24px; background-size: 24px 24px; margin: 8px;}.jimu-widget-nearme .esriCTFilterIconContainer {position: absolute; right: 25px; height: 40px; width: 40px; background: #fffdfd; border-radius: 25px; box-shadow: 0px 0px 2px 2px #d4d4d4; cursor: pointer; z-index: 1; bottom: 0;}.esriRtl .jimu-widget-nearme .esriCTFilterIconContainer {right: inherit; left: 25px;}.jimu-widget-nearme .esriCTFilterIcon {background-image: url(../images/filter.png); background-repeat: no-repeat; background-position: center center; background-color: gray; height: 25px; width: 25px; background-size: 25px 25px; margin: 8px;}.esriCTMapTooltip{width: 100px; word-wrap: break-word; border: 1px solid #7EABCD; background-color: white; padding: 5px; font-size: 9pt; z-index: 9999; -o-border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px;}.jimu-widget-nearme .esriCTClearAllFilter {background-image: url(../images/clear-all-filter.png); background-repeat: no-repeat; background-position: center center; background-color: #d6d6d6; height: 20px; width: 20px; background-size: 20px 20px; cursor: default; float: right;}.esriRtl .jimu-widget-nearme .esriCTClearAllFilter {float: left;}.jimu-widget-nearme .esriCTClearAllFilterActive {background-color: #18acc2; cursor: pointer;}.jimu-widget-nearme .esriCTFilterBackDiv {width: calc(100% - 30px); float: left;}.esriRtl .jimu-widget-nearme .esriCTFilterBackDiv {float: right;}.dart-panel .jimu-widget-nearme .esriCTDistanceToLocation {background-color: rgba(0, 0, 0, 0.2) !important;}.dart-panel .jimu-widget-nearme .esriCTImgButtons {background-color: darkgray;}.dart-panel .arcgisSearch .searchGroup .searchInput {padding: 6px 24px 6px 12px !important;}.esriRtl .dart-panel .jimu-widget-nearme .arcgisSearch .searchGroup .searchInput {padding: 6px 12px 6px 24px !important;}.dart-panel .jimu-widget-nearme .arcgisSearch .searchMenu{background-color: #373737 !important;}.dart-panel .jimu-widget-nearme .arcgisSearch .searchMenu li:hover, .dart-panel .jimu-widget-nearme .arcgisSearch .searchMenu li:focus {background-color: #232323 !important;}.dart-panel .jimu-widget-nearme .simpleDirections .esriResultsSummary {background-color: darkgray !important;} .dart-panel .jimu-widget-nearme .simpleDirections .esriRouteLength {background: darkgray !important;}.jimu-widget-nearme .esriCTBufferTextboxParent{width: 100%; height: 40px; margin-top: 12px;}.jimu-widget-nearme .esriCTBufferTextboxText {white-space: nowrap; overflow: hidden; text-overflow: ellipsis; float: left; line-height: 30px;}.esriRtl .jimu-widget-nearme .esriCTBufferTextboxText{float: right;}.jimu-widget-nearme .esriCTBufferTextbox{width: 30%; float: left; margin-left: 8px;}.esriRtl .jimu-widget-nearme .esriCTBufferTextbox{float: right; margin-right: 8px;}.jimu-widget-nearme .esriCTapplyFilterArrowNodeParent{outline-offset: 2px; height: 15px; width: 80%; display: inline-block;}.jimu-widget-nearme .esriCTFliterListCheckbox{margin: 0px 22px;}.DashboardTheme .jimu-widget-nearme .esriCTItemName {color: white;}.DashboardTheme .jimu-widget-nearme .esriCTItemCount{color: white;}.DashboardTheme .jimu-widget-nearme .esriCTDistanceToLocation{color: #000000;}.DashboardTheme.light .jimu-widget-nearme .esriCTItemName{color: #000000;}.DashboardTheme.light .jimu-widget-nearme .esriCTItemCount{color: #000000;}.DashboardTheme .jimu-widget-nearme .esriCTClearAllFilter{background-image: url(../images/clear-all-filter-dark.png);}.DashboardTheme.light .jimu-widget-nearme .esriCTClearAllFilter{background-image: url(../images/clear-all-filter.png);}.DashboardTheme .jimu-widget-nearme .esriCTApplyFilterArrowNode{background-image: url(../images/filter-arrow-dark.png); background-color: #fff;}.DashboardTheme .jimu-widget-nearme .esriCTApplyFilterArrowUp{background-image: url(../images/filter-arrow-dark-up.png); background-color: #fff;}.DashboardTheme.light .jimu-widget-nearme .esriCTApplyFilterArrowNode{background-image: url(../images/filter-arrow.png); background-color: #3e3e3e;}.DashboardTheme.light .jimu-widget-nearme .esriCTApplyFilterArrowUp{background-image: url(../images/filter-arrow-up.png); background-color: #3e3e3e;}.DashboardTheme .jimu-widget-nearme-filter .filter-list .filter-item .header:hover{color: #222;}.jimu-widget-nearme .esriCTApplyFilterDiv{width: 100%; clear: both;}.jimu-widget-nearme .esriCTApplyFilterDivSpacing{margin-top: 15px;}.jimu-widget-nearme .esriCTFilterToApply{max-width: calc(100% - 40px); float: left; cursor: pointer;}.esriRtl .jimu-widget-nearme .esriCTFilterToApply{float: right;}.jimu-widget-nearme .esriCTApplyFilterArrowNode{background-image: url('../images/filter-arrow.png'); width: 18px; height: 18px; background-repeat: no-repeat; background-color: #3e3e3e; background-position: center center; float: left; margin: 0 5px; cursor: pointer;}.esriRtl .jimu-widget-nearme .esriCTApplyFilterArrowNode{float: right; margin: 3px 5px;}.jimu-widget-nearme .esriCTApplyFilterArrowUp{background-image: url('../images/filter-arrow-up.png');}",
"*now":function(V){V(['dojo/i18n!*preload*widgets/NearMe/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget dojo/on dojo/dom-construct dojo/dom-class dojo/query dojo/keys dojo/_base/lang dojo/_base/array ./utils ./search ./item-list ./filter-list jimu/portalUtils esri/layers/GraphicsLayer esri/graphic esri/tasks/GeometryService esri/tasks/BufferParameters dijit/form/HorizontalSlider dojo/dom-attr dojo/string dojo/dom-geometry dojo/dom-style esri/symbols/jsonUtils esri/tasks/locator esri/geometry/webMercatorUtils esri/InfoTemplate jimu/dijit/Message jimu/dijit/LoadingIndicator dijit/registry dojo/Deferred dojo/promise/all esri/tasks/query esri/tasks/QueryTask esri/request esri/geometry/scaleUtils esri/geometry/Extent jimu/dijit/EditorXssFilter esri/SpatialReference esri/dijit/LocateButton jimu/utils dijit/focus dijit/form/NumberTextBox".split(" "),function(V,
W,u,O,X,N,y,r,d,e,l,m,n,h,x,F,H,w,G,Q,S,M,R,C,a,B,fa,ka,la,oa,P,na,ma,J,z,I,da,ra,qa,wa,Ca,b,f,D){return V([u,W],{baseClass:"jimu-widget-nearme",_highlightGraphicsLayer:null,_loading:null,_windowResizeTimer:null,_sliderChangeTimer:null,_mapTooltip:null,_searchContainerNodeElement:null,_locatorInstance:null,_searchedLocation:null,_slider:null,_bufferParams:null,_mapClickHandler:null,_mapMoveHandler:null,_itemListObject:null,_isValidConfig:null,appUtils:null,_hasMulitpleSourcesInSearch:!0,_searchInstance:null,
_attributeSearchLayers:[],_doAttributeSearchOn:[],selectedThemeColor:"#000",_geocoderSpatialRef:null,_lastFocusNodes:{mainScreen:null,layerList:null,featureList:null,featureInfo:null,filterList:null},postCreate:function(){this.config.hasOwnProperty("showImageGallery")||(this.config.showImageGallery=!0);this.config.hasOwnProperty("showFeaturesCount")||(this.config.showFeaturesCount=!0);this.config.hasOwnProperty("bufferInputOption")||(this.config.bufferInputOption="slider");this.editorXssFilter=qa.getInstance();
this._bufferParams=null;this.selectedThemeColor="#000";this.openAtStartAysn=!0;this._getSelectedThemeColor();this.config.hasOwnProperty("enableDirection")||(this.config.enableDirection=this.map.webMapResponse.itemInfo.itemData&&this.map.webMapResponse.itemInfo.itemData.applicationProperties&&this.map.webMapResponse.itemInfo.itemData.applicationProperties.viewing&&this.map.webMapResponse.itemInfo.itemData.applicationProperties.viewing.routing&&this.map.webMapResponse.itemInfo.itemData.applicationProperties.viewing.routing.enabled?
!0:!1);this.config.routeService&&(this.config.routeService=this._replaceRouteTaskUrlWithAppProxy(this.config.routeService));this._attributeSearchLayers=[];this._doAttributeSearchOn=[];(!this.config.filterSettings||!this.config.filterSettings.filters||0>=this.config.filterSettings.filters.length)&&N.add(this.applyFilterNode,"esriCTHidden")},_setTheme:function(){var t;if("LaunchpadTheme"===this.appConfig.theme.name)b.loadStyleLink(this.baseClass+"launchpadOverrideCSS",this.folderUrl+"/css/launchpadTheme.css",
null);else if(t=document.getElementById(this.baseClass+"launchpadOverrideCSS"))t.disabled=!0},startup:function(){N.add(this.domNode.parentElement,"esriCTNearMeContentPanel");this.appConfig.portalUrl&&""!==d.trim(this.appConfig.portalUrl)?x.getPortalSelfInfo(this.appConfig.portalUrl).then(d.hitch(this,function(t){this.config.helperServices=t&&t.helperServices;this.config.helperServices&&this.config.helperServices.geometry?(this._isValidConfig=this._validateConfig())?(this._setTheme(),this.appUtils=
new l({map:this.map}),this._updateConfig(),N.remove(this.widgetMainNode,"esriCTHidden"),N.add(this.widgetErrorNode,"esriCTHidden"),this._initWidgetComponents(),this.config.showLocationTool?N.remove(this.selectLocation,"esriCTHidden"):this._mapClickHandler||this._connectMapEventHandler(),this._onWindowResize()):(N.add(this.widgetMainNode,"esriCTHidden"),N.remove(this.widgetErrorNode,"esriCTHidden")):this._displayWidgetError(this.nls.geometryServicesNotFound)}),d.hitch(this,function(){this._displayWidgetError(this.nls.geometryServicesNotFound)})):
this._displayWidgetError(this.nls.geometryServicesNotFound)},_replaceRouteTaskUrlWithAppProxy:function(t){var Z=t;!window.isBuilder&&!this.appConfig.mode&&this.appConfig.appProxies&&0<this.appConfig.appProxies.length&&e.some(this.appConfig.appProxies,function(ca){if(t===ca.sourceUrl)return Z=ca.proxyUrl,!0});return Z},_displayWidgetError:function(t){this.widgetErrorNode&&S.set(this.widgetErrorNode,"innerHTML",t);this._showMessage(t)},_storeLayersVisibility:function(){if(this.config&&this.config.searchLayers)for(var t=
0;t<this.config.searchLayers.length;t++){var Z=this.config.searchLayers[t].id,ca=null;0<Z.indexOf("_")&&(ca=Z.substring(0,Z.lastIndexOf("_")));this.map._layers[Z]?this.config.searchLayers[t].visibility=this.map._layers[Z].visible:ca&&this.map._layers[ca]&&this.map._layers[ca].visibleLayers&&(Z=this.config.searchLayers[t].url.split("/"),Z=Z[Z.length-1],ca=e.indexOf(this.map._layers[ca].visibleLayers,parseInt(Z,10)),this.config.searchLayers[t].visibility=-1===ca?!1:!0)}},onOpen:function(){this._isValidConfig&&
(this._storeLayersVisibility(),this._onWindowResize(),this.config.showLocationTool||this._connectMapEventHandler(),this._slider&&this._slider.set("value",this.config.defaultBufferDistance),b.isAutoFocusFirstNodeWidget(this)&&b.focusFirstFocusNode(this.domNode))},resize:function(){this._onWindowResize()},destroy:function(){this._destroyWidgetData();this.inherited(arguments)},onClose:function(){this._isValidConfig&&(this._disconnectMapEventHandler(),this._searchInstance&&this._searchInstance.clearSearchText(),
this._searchedLocation&&this._itemListObject&&(this._itemListObject.resetAllFilters(),this._clearResults()))},onDeActive:function(){this._isValidConfig&&this.config.showLocationTool&&this._disconnectMapEventHandler()},onActive:function(){this._isValidConfig&&this.config.selectedSearchLayerOnly&&this._storeLayersVisibility()},_destroyWidgetData:function(){this._itemListObject&&(this._itemListObject.removeGraphicsLayer(),this._itemListObject.resetAllFilters(),this._itemListObject.destroy(),this._itemListObject=
null);this._clearResults()},_validateConfig:function(){if(!this.config.searchLayers||!this.config.searchLayers.length)return this._displayWidgetError(this.nls.invalidSearchLayerMsg),!1;this.config.symbols.polygonSymbol||(this.config.symbols.polygonSymbol={color:[255,189,1,0],outline:{color:[255,189,1,255],width:2.25,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"});this.config.symbols.polylineSymbol||(this.config.symbols.polylineSymbol={color:[21,99,184,255],width:3.75,type:"esriSLS",
style:"esriSLSSolid"});return!0},_updateConfig:function(){var t;for(t=0;t<this.config.searchLayers.length;t++)d.mixin(this.config.searchLayers[t],this.appUtils.getLayerDetailsFromMap(this.config.searchLayers[t].baseURL,this.config.searchLayers[t].layerId,this.config.searchLayers[t].id))},_showMessage:function(t){(new la({message:t})).message=t},_initWidgetComponents:function(){this.config.editorDescription&&(this.searchHeaderTextNode.innerHTML=this.editorXssFilter.sanitize(this.config.editorDescription),
S.set(this.searchHeaderTextNode,"aria-label",b.stripHTML(this.config.editorDescription)));this._bufferGraphicLayer=new F;this.map.addLayer(this._bufferGraphicLayer);this._highlightGraphicsLayer=new F;this.map.addLayer(this._highlightGraphicsLayer);this._createSearchInstance();this._createCurrentLocationInstance();this._createSlider();this._initLoading();this._initLayerList();this._displayBufferInputOptions();this._setBufferSliderVisiblity();this.config.showLocationTool&&this._connectSelectLocationHandler();
this._mapTooltip=X.create("div",{"class":"esriCTMapTooltip",innerHTML:this.nls.selectLocationToolTip},this.map.container);C.set(this._mapTooltip,"position","fixed");C.set(this._mapTooltip,"display","none");this.own(O(window,"resize",d.hitch(this,this._onWindowResize)));this._createFilterList()},_hideFilterListBeforeInitWorkflow:function(){N.contains(this.applyFilterNode,"esriCTHidden")||N.contains(this.filterListOuterDiv,"esriCTHidden")||(N.toggle(this.applyFilterArrowNode,"esriCTApplyFilterArrowUp"),
N.remove(this.layerListOuterDiv,"esriCTHidden"),N.add(this.filterListOuterDiv,"esriCTHidden"))},_showHideFilterList:function(){N.toggle(this.applyFilterArrowNode,"esriCTApplyFilterArrowUp");N.contains(this.applyFilterArrowNode,"esriCTApplyFilterArrowUp")?(N.add(this.layerListOuterDiv,"esriCTHidden"),N.remove(this.filterListOuterDiv,"esriCTHidden"),b.initLastFocusNode(this.domNode,this._filterList.getLastNode()),this._filterList.filterListShown()):(N.remove(this.layerListOuterDiv,"esriCTHidden"),N.add(this.filterListOuterDiv,
"esriCTHidden"),this._searchedLocation?this._itemListObject.emit("setLastNode",this._itemListObject._currentPanelName):this._getMainScreenLastNode(),this._searchedLocation&&this._filterList.filtersUpdated&&this._prevFeature&&this._initWorkflow(this._prevFeature,this._prevAttributeSearchResult))},_createFilterList:function(){this.config.filterSettings&&this.config.filterSettings.filters&&0<this.config.filterSettings.filters.length&&(this._filterList=new h({map:this.map,config:this.config.filterSettings,
nls:this.nls,folderUrl:this.folderUrl,clearAllButton:this.clearAllFilterButton},X.create("div",{},this.filterListNode)),this.own(O(this._filterList,"setLastFilterNode",d.hitch(this,function(t){b.initLastFocusNode(this.domNode,t)}))),this.own(O(this._filterList,"clearAllFilters",d.hitch(this,function(t){this._searchedLocation&&this._filterList.filtersUpdated&&this._prevFeature&&this._initWorkflow(this._prevFeature,this._prevAttributeSearchResult)}))),this._filterList.startup(),this.own(O(this.applyFilterArrowNodeParent,
"click",d.hitch(this,function(t){this._showHideFilterList()}))),this.own(O(this.applyFilterArrowNodeParent,"keydown",d.hitch(this,function(t){t.keyCode!==r.ENTER&&t.keyCode!==r.SPACE||this._showHideFilterList()}))),this.config.filterSettings.expandFiltersOnLoad&&this._showHideFilterList())},_setLayersForAttributeSearch:function(t){var Z=[];this._attributeSearchLayers=[];t&&0<t.length&&(e.forEach(this.config.searchLayers,d.hitch(this,function(ca){Z.push(ca.id)})),e.forEach(t,d.hitch(this,function(ca){ca._featureLayerId&&
-1<Z.indexOf(ca._featureLayerId)&&this._attributeSearchLayers.push(ca)})))},_performAttributeSearch:function(t){var Z=[],ca=[];var ta=new na;e.forEach(t,d.hitch(this,function(g){var L=this._searchInstance.getSearchText();L=this._searchInstance.search._whereClause(L,g.featureLayer,g.searchFields,g.exactMatch);g.featureLayer.getDefinitionExpression()&&(L=g.featureLayer.getDefinitionExpression()+" and "+L);Z.push(this._queryForIds(g.featureLayer,L));ca.push(g._featureLayerId)}));ma(Z).then(d.hitch(this,
function(g){for(var L,U=0;U<g.length;U++){var Y=[];0<g[U].length&&(L||(L={}),L.hasOwnProperty(ca[U])&&(Y=L[ca[U]]),Y=this._addOIDsInList(Y,g[U]),L[ca[U]]=Y)}ta.resolve(L)}));return ta.promise},_addOIDsInList:function(t,Z){for(var ca=0;ca<Z.length;ca++)0>t.indexOf(Z[ca])&&t.push(Z[ca]);return t},_queryForIds:function(t,Z){var ca=new na;var ta=new z(t.url);var g=new J;g.returnGeometry=!1;g.where=Z?Z:"1\x3d1";ta.executeForIds(g).then(d.hitch(this,function(L){L&&0<L.length?(L.length>t.maxRecordCount&&
(L=L.slice(0,t.maxRecordCount)),ca.resolve(L)):ca.resolve([])}),d.hitch(this,function(){ca.resolve([])}));return ca.promise},_createSearchInstance:function(){this.config.response=this.map.webMapResponse;this._searchInstance=new m({searchOptions:{addLayersFromMap:!1,autoNavigate:!1,autoComplete:!0,minCharacters:0,maxLocations:5,searchDelay:100,enableHighlight:!1},config:this.config,appConfig:this.appConfig,nls:this.nls,map:this.map},X.create("div",{},this.search));this.own(this._searchInstance.on("init-attribute-search",
d.hitch(this,function(){var t,Z=[];this._doAttributeSearchOn=[];0<this._attributeSearchLayers.length&&((t=this._searchInstance.getActiveSource())?t._featureLayerId&&(Z=e.filter(this._attributeSearchLayers,d.hitch(this,function(ca){return ca._featureLayerId===t._featureLayerId})),0<Z.length&&this._doAttributeSearchOn.push(t)):this._doAttributeSearchOn=this._attributeSearchLayers)})));this.own(this._searchInstance.on("select-result",d.hitch(this,function(t){t.isFeatureFromMapClick=!1;if(0<this._doAttributeSearchOn.length)this._performAttributeSearch(this._doAttributeSearchOn).then(d.hitch(this,
function(g){var L=!0;if(g)for(var U in g)0<g[U].length?L=!1:delete g[U];L?this._initWorkflow(t):this._initWorkflow(null,g)}));else{var Z=!0;if(t&&t.source&&t.source._featureLayerId&&t.source.featureLayer){var ca=e.filter(this._attributeSearchLayers,d.hitch(this,function(g){return g._featureLayerId===t.source._featureLayerId}));if(0<ca.length&&t.source.featureLayer.objectIdField&&t.result.feature.attributes){Z=!1;ca=t.source.featureLayer.objectIdField;var ta={};ta[t.source._featureLayerId]=[t.result.feature.attributes[ca]]}}Z?
this._initWorkflow(t):this._initWorkflow(null,ta)}})));this.own(this._searchInstance.on("clear-search",d.hitch(this,function(){this._itemListObject&&(this.config.selectedSearchLayerOnly&&this._itemListObject.showAllLayers(!0),this._itemListObject.resetAllFilters());this._clearResults();this._getMainScreenLastNode()})));this.own(this._searchInstance.on("search-results",d.hitch(this,function(){this._clearResults(!0)})));this.own(this._searchInstance.on("search-loaded",d.hitch(this,function(){setTimeout(d.hitch(this,
function(){this._getMainScreenLastNode();this._initReverseGeocoder();this._searchContainerNodeElement=y(".arcgisSearch .searchGroup .searchInput",this.domNode)[0];2>this._searchInstance.search.sources.length&&(this._hasMulitpleSourcesInSearch=!1);this._setLayersForAttributeSearch(this._searchInstance.search.sources);this._onWindowResize()}),1E3)})));this._searchInstance.startup()},_getMainScreenLastNode:function(){var t=this._searchInstance.search.submitNode;this.config.showCurrentLocationTool&&(t=
this.currentLocationNode);this.config.showLocationTool&&(t=this.selectLocation);if(!N.contains(this.bufferOptionParentNode,"esriCTHidden")){this._bufferTextbox&&!N.contains(this.bufferTextboxParentNode,"esriCTHidden")&&(t=this._bufferTextbox.domNode);var Z=y(".esriCTSliderDiv",this.widgetMainNode);Z&&!N.contains(Z[0],"esriCTHidden")&&(t=this._slider.sliderHandle)}N.contains(this.applyFilterNode,"esriCTHidden")||(this.applyFilterArrowNodeParent&&(t=this.applyFilterArrowNodeParent),this.clearAllFilterButton&&
(t=this.clearAllFilterButton),N.contains(this.filterListOuterDiv,"esriCTHidden")||(t=this._filterList.getLastNode()));this._itemListObject&&this._itemListObject.filterButton&&"block"===C.get(this._itemListObject.filterButton.parentElement,"display")&&(t=this._itemListObject.filterButton,this._lastFocusNodes.layerList=t,this._lastFocusNodes.featureList=t);this._lastFocusNodes.mainScreen=t;b.initLastFocusNode(this.domNode,t)},_createCurrentLocationInstance:function(){this.isNeedHttpsButNot=b.isNeedHttpsButNot();
b.isNeedHttpsButNot()&&(this.config.showCurrentLocationTool=!1);this.config.showCurrentLocationTool&&(N.remove(this.currentLocationNode,"esriCTHidden"),this._geoLocateInstance=new Ca({highlightLocation:!1,map:this.map},X.create("div",{},this.currentLocationNode)),this.own(O(this._geoLocateInstance,"locate",d.hitch(this,function(t){t&&t.graphic&&t.graphic.geometry?this._initWorkflow({feature:new H(t.graphic.geometry),isFeatureFromMapClick:!0}):t.error&&t.error.message&&this._showMessage(t.error.message)}))),
this._geoLocateInstance._locateNode&&S.set(this._geoLocateInstance._locateNode,"aria-label",this.nls.selectLocationToolTip))},_initReverseGeocoder:function(){var t;this.config.searchSourceSettings&&this.config.searchSourceSettings.sources&&(e.some(this.config.searchSourceSettings.sources,d.hitch(this,function(Z){if(Z&&Z.url&&"locator"===Z.type)return t=Z.url,!0})),t&&(this._loading.show(),I({url:t,content:{f:"json"},handleAs:"json",callbackPrams:"callback"}).then(d.hitch(this,function(Z){this._loading.hide();
this._geocoderSpatialRef=new wa(Z.spatialReference);this._locatorInstance=new B(t);this.own(this._locatorInstance.on("location-to-address-complete",d.hitch(this,this._onLocationToAddressComplete)))}))))},_onLocationToAddressComplete:function(t){var Z;if(t.address&&t.address.address){if(t.address.address.Match_addr)var ca=t.address.address.Match_addr;else{ca="";for(var ta in t.address.address)"Loc_name"!==ta&&t.address.address[ta]&&(ca+=t.address.address[ta]+" ");ca=d.trim(ca)}this._searchInstance&&
this._searchInstance.setSearchText(ca);if(this.config.searchSourceSettings.showInfoWindowOnSelect){t=new ka;t.setContent("${Match_addr}");t.setTitle(this.nls.searchLocationTitle);ca={Match_addr:ca};var g=new H(this._searchedLocation.geometry,null,ca,t);this.map.infoWindow.clearFeatures();this.map.infoWindow.setFeatures([g]);setTimeout(d.hitch(this,function(){Z=this.map.toScreen(g.geometry);this.map.infoWindow.show(Z,this.map.getInfoWindowAnchor(Z));this.map.infoWindow.isShowing=!0}),500)}}},_connectSelectLocationHandler:function(){O(this.selectLocation,
"click",d.hitch(this,function(){this._selectLocationButtonClicked()}));O(this.selectLocation,"keydown",d.hitch(this,function(t){t.keyCode!==r.ENTER&&t.keyCode!==r.SPACE||this._selectLocationButtonClicked()}))},_selectLocationButtonClicked:function(){N.contains(this.selectLocation,"esriCTSelectLocationActive")?this._disconnectMapEventHandler():(N.replace(this.selectLocation,"esriCTSelectLocationActive","esriCTSelectLocation"),this._connectMapEventHandler())},_initWorkflow:function(t,Z){this._hideFilterListBeforeInitWorkflow();
this._clearResults(!Z);this._doAttributeSearchOn=[];var ca=this._getSelectedFeatureFromResult(t);this._prevAttributeSearchResult=d.clone(Z);this._prevFeature={feature:ca,isFeatureFromMapClick:ca?t.isFeatureFromMapClick:!1};this._searchedLocation=ca;t&&t.source&&t.source.zoomScale&&(this._prevFeature.zoomScale=t.source.zoomScale);t&&this._locatorInstance&&t.isFeatureFromMapClick&&this._searchedLocation&&this._searchedLocation.geometry&&this.showReverseGeocodedAddress();ca&&ca.geometry?this._itemListObject.hasValidLayers()?
(this._highlightSelectedLocation(ca),N.contains(this.bufferOptionParentNode,"esriCTHidden")?this.zoomToFeature().then(d.hitch(this,function(){this._itemListObject.displayLayerList(this._searchedLocation,null)})):this._createBuffer(ca.geometry)):this._showMessage(this.nls.allPopupsDisabledMsg):Z&&(this._itemListObject.hasValidLayers()?this._itemListObject.displayLayerList(null,null,Z):this._showMessage(this.nls.allPopupsDisabledMsg))},_clearResults:function(t){this._highlightGraphicsLayer&&this._highlightGraphicsLayer.clear();
this._searchedLocation=null;this._itemListObject&&this._itemListObject.clearResultPanel();this._bufferGraphicLayer&&this._bufferGraphicLayer.clear();t||this.map.infoWindow.hide()},_connectMapEventHandler:function(){this._mapClickHandler||(this._disableWebMapPopup(),this._mapClickHandler=this.own(this.map.on("click",d.hitch(this,this._onMapClick)))[0],"ontouchstart"in document.documentElement?C.set(this._mapTooltip,"display","none"):(this._mapMoveHandler=this.own(this.map.on("mouse-move",d.hitch(this,
this._onMapMouseMove)))[0],this.own(this.map.on("mouse-out",d.hitch(this,function(){C.set(this._mapTooltip,"display","none")})))))},_onMapClick:function(t){this.config.showLocationTool&&this._disconnectMapEventHandler();this.map.infoWindow.hide();this._searchInstance&&this._searchInstance.clearSearchText();this._initWorkflow({feature:new H(t.mapPoint),isFeatureFromMapClick:!0})},_onMapMouseMove:function(t){if(t.clientX||t.pageY){var Z=t.clientX;t=t.clientY}else Z=t.clientX+document.body.scrollLeft-
document.body.clientLeft,t=t.clientY+document.body.scrollTop-document.body.clientTop;C.set(this._mapTooltip,"display","none");C.set(this._mapTooltip,{left:Z+15+"px",top:t+"px"});C.set(this._mapTooltip,"display","")},_disconnectMapEventHandler:function(){this._enableWebMapPopup();N.replace(this.selectLocation,"esriCTSelectLocation","esriCTSelectLocationActive");this._mapClickHandler&&(this._mapClickHandler.remove(),this._mapClickHandler=null);this._mapMoveHandler&&(this._mapMoveHandler.remove(),this._mapMoveHandler=
null,this._mapTooltip.style.display="none")},_enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},_createSlider:function(){this._slider=new Q({name:"slider",showButtons:!1,discreteValues:this.config.maxBufferDistance+1,minimum:0,maximum:this.config.maxBufferDistance,value:this.config.defaultBufferDistance,intermediateChanges:!0,"class":"esriCTHorizantalSlider","aria-label":this.nls.bufferDistanceLabel},
this.horizantalSliderContainer);this._bufferParams={BufferDistance:this._slider.value.toString(),BufferUnit:this.nls.units[this.config.bufferDistanceUnit.value].displayText};this._bufferTextbox=new D({constraints:{min:0,max:this.config.maxBufferDistance},required:!0,value:this.config.defaultBufferDistance,"class":"esriCTBufferTextbox","aria-label":M.substitute(this.nls.bufferSliderText,this._bufferParams)},this.bufferTextboxNode);var t=d.clone(this._bufferParams);t.BufferDistance=b.localizeNumber(t.BufferDistance);
S.set(this.silderText,"innerHTML",M.substitute(this.nls.bufferSliderText,t));S.set(this.silderText,"aria-label",M.substitute(this.nls.bufferSliderText,t));S.set(this.bufferTextboxText,"innerHTML",M.substitute(this.nls.bufferTextboxLabel,this._bufferParams));this.own(O(this._bufferTextbox,"keydown",d.hitch(this,function(Z){Z.keyCode===r.ENTER&&this._bufferTextboxChange()})));this.own(O(this._bufferTextbox,"blur",d.hitch(this,function(){this._bufferTextboxChange()})));this.own(this._slider.on("change",
d.hitch(this,this._sliderChange)));this.sliderMinValue.innerHTML=this._slider.minimum.toString();this.sliderMaxValue.innerHTML=this._slider.maximum.toString()},_bufferTextboxChange:function(){if(this._bufferTextbox.isValid()){var t=this._bufferTextbox.getValue();this._slider.set("value",t)}else this._showMessage(this.nls.invalidBufferDistance)},_sliderChange:function(t){t=parseFloat(t,10);if(!isNaN(t)){this._bufferParams.BufferDistance=t;var Z=M.substitute(this.nls.bufferSliderText,this._bufferParams);
S.set(this.silderText,"innerHTML",Z);S.set(this.silderText,"aria-label",Z);this._bufferTextbox.set("value",t);this._bufferTextbox&&this._bufferTextbox.focusNode&&S.set(this._bufferTextbox.focusNode,"aria-label",Z);this._sliderChangeTimer&&clearTimeout(this._sliderChangeTimer);this._searchedLocation&&(this._loading.show(),this._sliderChangeTimer=setTimeout(d.hitch(this,this._createBuffer),700))}},showReverseGeocodedAddress:function(){this._geocoderSpatialRef&&this._locatorInstance&&this.getProjectedGeometry(this._searchedLocation.geometry,
this._geocoderSpatialRef).then(d.hitch(this,function(t){this._locatorInstance.locationToAddress(t,100)}))},getProjectedGeometry:function(t,Z){var ca=new w(this.config.helperServices.geometry.url);var ta=new na;if(fa.canProject(t,Z)){var g=fa.project(t,Z);ta.resolve(g)}else ca.project([t],Z,function(L){g=L[0];ta.resolve(g)});return ta.promise},_createBuffer:function(){var t=new w(this.config.helperServices.geometry.url);if(0<this._bufferParams.BufferDistance){this._loading.show();var Z=new G;Z.distances=
[this._bufferParams.BufferDistance];Z.unit=w[this.config.bufferDistanceUnit.bufferUnit];Z.bufferSpatialReference=this.map.spatialReference;Z.outSpatialReference=this.map.spatialReference;Z.geometries=[this._searchedLocation.geometry];if(this.config.isGeodesic||4326===this.map.spatialReference.wkid)this.config.isGeodesic=!0,Z.geodesic=!0;t.buffer(Z,d.hitch(this,function(ca){this._showBuffer(ca);this.map.setExtent(ca[0].getExtent().expand(1.5));this._loading.hide();this._itemListObject.displayLayerList(this._searchedLocation,
ca[0])}),d.hitch(this,function(){this._showMessage(this.nls.unableToCreateBuffer);this._loading.hide()}))}else this._bufferGraphicLayer.clear(),this._prevFeature.isFeatureFromMapClick?(this._itemListObject.displayLayerList(this._searchedLocation,null),this._loading.hide()):this.zoomToFeature().then(d.hitch(this,function(){this._itemListObject.displayLayerList(this._searchedLocation,null);this._loading.hide()}))},zoomToFeature:function(){var t=new na;var Z=this._prevFeature.feature.geometry;if("point"===
Z.type){if(this._prevFeature.hasOwnProperty("zoomScale"))var ca=this._prevFeature.zoomScale;ca&&this.map.getScale()>ca?ca=da.getExtentForScale(this.map,this._prevFeature.zoomScale).centerAt(Z):(ca=this.map.extent.centerAt(Z))||(ca=this.pointToExtent(this.map,Z,20))}else ca=Z.getExtent().expand(1.5);ca?this.map.setExtent(ca).then(d.hitch(this,function(){t.resolve()})):t.resolve();return t},pointToExtent:function(t,Z,ca){var ta=t.extent.getWidth()/t.width;ca*=ta;return new ra(Z.x-ca,Z.y-ca,Z.x+ca,Z.y+
ca,t.spatialReference)},_showBuffer:function(t){if(this.config.bufferInfo&&this.config.bufferInfo.isVisible&&(this._bufferGraphicLayer.clear(),this.config&&this.config.symbols&&this.config.symbols.bufferSymbol)){var Z=a.fromJson(this.config.symbols.bufferSymbol);e.forEach(t,d.hitch(this,function(ca){ca=new H(ca,Z);this._bufferGraphicLayer.add(ca)}))}},_getSelectedFeatureFromResult:function(t){if(t)if(t.feature)var Z=t.feature;else t.result&&t.result.feature&&(Z=t.result.feature);return Z},_highlightSelectedLocation:function(t){if(t){this._highlightGraphicsLayer.clear();
var Z="polygon"===t.geometry.type?a.fromJson(this.config.symbols.polygonSymbol):"polyline"===t.geometry.type?a.fromJson(this.config.symbols.polylineSymbol):a.fromJson(this.config.symbols.graphicLocationSymbol);this._highlightGraphicsLayer.add(new H(t.geometry,Z))}},_onWindowResize:function(){this._windowResizeTimer&&clearTimeout(this._windowResizeTimer);this._windowResizeTimer=setTimeout(d.hitch(this,this._resetComponents),500)},_resetComponents:function(){var t,Z=[];var ca=y(".arcgisSearch .searchGroup",
this.domNode)[0];this._searchContainerNodeElement||(this._searchContainerNodeElement=y(".arcgisSearch .searchGroup .searchInput",this.domNode)[0]);Z=y(".dijitContentPane",this.domNode);Z.push(this.domNode);e.forEach(Z,d.hitch(this,function(ta){C.set(ta,"-webkit-overflow-scrolling","auto")}));this.widgetMainNode&&this._searchContainerNodeElement&&(t=R.position(this.widgetMainNode))&&t.w&&(t=t.w-144,this._hasMulitpleSourcesInSearch||(t+=32),0<t&&(this.config.showLocationTool&&(t-=45),this.config.showCurrentLocationTool&&
(t-=45),this._searchContainerNodeElement.style.setProperty("width",t+"px","important"),ca&&ca.style.setProperty("max-width","100%","important")));0<Z.length&&setTimeout(d.hitch(this,function(){e.forEach(Z,d.hitch(this,function(ta){C.set(ta,"-webkit-overflow-scrolling","touch")}))}),500);this._itemListObject&&this._itemListObject.resetGallery()},_initLayerList:function(){this._itemListObject=new n({map:this.map,config:this.config,nls:this.nls,loading:this._loading,parentDivId:this.id,folderUrl:this.folderUrl,
outerContainer:this.layerListOuterDiv,searchOuterContainer:this.searchOuterContainer,selectedThemeColor:this.selectedThemeColor,domNodeObj:this.domNode,applyFilterNode:this.applyFilterNode,filterListMainDiv:this.filterListMainDiv});this.own(O(this._itemListObject,"init-proximity",d.hitch(this,function(t){var Z={isFeatureFromMapClick:!1};Z.feature=t;this._initWorkflow(Z)})));this.own(O(this._itemListObject,"setLastNode",d.hitch(this,function(t){"layerListPanel"===t?(this._itemListObject.filterButton&&
"block"===C.get(this._itemListObject.filterButton.parentElement,"display")?this._lastFocusNodes.layerList=this._itemListObject.filterButton:this._lastFocusNodes.layerList=y(".esriCTLastLayerFocusNode")[0],this._lastFocusNodes.layerList&&b.initLastFocusNode(this.domNode,this._lastFocusNodes.layerList)):"featureListPanel"===t&&(this._itemListObject.filterButton&&"block"===C.get(this._itemListObject.filterButton.parentElement,"display")||(this._lastFocusNodes.featureList=y(".esriCTLastFeatureFocusNode")[0]),
b.initLastFocusNode(this.domNode,this._lastFocusNodes.featureList))})));this.own(O(this._itemListObject,"setLastNodeInFeatureInfo",d.hitch(this,function(t){b.initLastFocusNode(this.domNode,t)})));this.own(O(this._itemListObject,"noFeatureFound",d.hitch(this,function(){this._getMainScreenLastNode();b.focusFirstFocusNode(this.domNode)})));this.own(O(this._itemListObject,"setFocusOnFirstFocusableNode",d.hitch(this,function(){1===this._searchInstance.search.sources.length?f.focus(this._searchInstance.search.inputNode):
f.focus(this._searchInstance.search.sourcesBtnNode)})));this.id&&P.byId(this.id)&&P.byId(this.id).resize&&P.byId(this.id).resize()},_initLoading:function(){this._loading=new oa({hidden:!0});this._loading.placeAt(this.domNode);this._loading.startup()},_displayBufferInputOptions:function(){"slider"===this.config.bufferInputOption?(N.add(this.bufferTextboxParentNode,"esriCTHidden"),N.add(this.applyFilterNode,"esriCTApplyFilterDivSpacing")):"textbox"===this.config.bufferInputOption?N.add(this.sliderParentNode,
"esriCTHidden"):"sliderAndTextbox"===this.config.bufferInputOption&&(N.add(this.silderText,"esriCTHidden"),N.add(this.sliderParentNode,"esriCTOverrideSliderDiv"));N.remove(this.bufferOptionParentNode,"esriCTHidden")},_setBufferSliderVisiblity:function(){var t=!0,Z;this.config.searchLayers&&0<this.config.searchLayers.length&&(e.some(this.config.searchLayers,d.hitch(this,function(ca){if("esriGeometryPolygon"!==ca.geometryType)return t=!1})),this.config.intersectSearchedLocation&&t?(N.add(this.bufferOptionParentNode,
"esriCTHidden"),(Z=y(".esriCTItemListMainContainer",this.domNode))&&("slider"===this.config.bufferInputOption||"textbox"===this.config.bufferInputOption?N.add(Z[0],"esriCTItemListOverrideMainContainer"):N.add(Z[0],"esriCTItemListOverrideMainContainerForBothBufferOptions"))):(N.remove(this.bufferOptionParentNode,"esriCTHidden"),"textbox"===this.config.bufferInputOption?b.initLastFocusNode(this.domNode,this._bufferTextbox.domNode):b.initLastFocusNode(this.domNode,this.horizantalSliderContainer)),this._itemListObject&&
this._itemListObject.updateListHeight())},_getSelectedThemeColor:function(t,Z){var ca=this.appConfig.theme.name;Z&&(ca=t);var ta=this.appConfig&&this.appConfig.theme&&this.appConfig.theme.styles?this.appConfig.theme.styles[0]:"default";Z&&(ta=Z);this.appConfig&&this.appConfig.theme&&this.appConfig.theme.customStyles&&this.appConfig.theme.customStyles.mainBackgroundColor&&!Z?this.selectedThemeColor=this.appConfig.theme.customStyles.mainBackgroundColor:I({url:"./themes/"+ca+"/manifest.json",content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(d.hitch(this,function(g){var L;if(g&&g.styles&&0<g.styles.length)for(L=0;L<g.styles.length;L++){var U=g.styles[L];if(U.name===ta){this.selectedThemeColor=U.styleColor;break}}this.selectedThemeColor||(this.selectedThemeColor="#000000");Z&&(this._itemListObject.selectedThemeColor=this.selectedThemeColor,this._itemListObject.resetIconColors())}),d.hitch(this,function(){this.selectedThemeColor="#000000"}))},onAppConfigChanged:function(t,Z,ca){"styleChange"===
Z&&(t&&t.theme&&t.theme.customStyles&&t.theme.customStyles.mainBackgroundColor?(this._itemListObject.selectedThemeColor=t.theme.customStyles.mainBackgroundColor,this._itemListObject.resetIconColors()):(t=t.theme.name,this._getSelectedThemeColor(t,ca)))}})});