// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/impactSummaryReport/impactSummaryReport.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTImpactSummaryLayerContainer" data-dojo-attach-point\x3d"impactSummaryLayerContainer"\x3e\r\n    \x3c!--title \x26 field icon table--\x3e\r\n    \x3cdiv class\x3d"esriCTLayerTitleAndFieldParentContainer esriCTLayerSectionDisabled esriCTCursorPointer"\r\n      data-dojo-attach-point\x3d"layerTitleAndFieldParentContainer" tabindex\x3d"0" role\x3d"group"\x3e\r\n      \x3c!--title \x26 field icon row--\x3e\r\n      \x3cdiv class\x3d"esriCTLayerTitleAndFieldChildContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTLayerPanelIcon esriCTLayerPanelExpand" data-dojo-attach-point\x3d"layerSectionIcon" tabindex\x3d"-1"\r\n          role\x3d"button" aria-expanded\x3d"false" aria-label\x3d"${nls.reportsTab.expandCollapseIconLabel}"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--title--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerTitle" data-dojo-attach-point\x3d"impactSummaryLayerTitle"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--field icon--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerFieldIcon esriCTImpactSummaryLayerFieldIconDisabled"\r\n          data-dojo-attach-point\x3d"impactSummaryLayerField" title\x3d"${nls.reportsTab.attributeChooserTooltip}"\r\n          tabindex\x3d"-1" aria-label\x3d"${nls.reportsTab.attributeChooserTooltip}" role\x3d"button"\x3e\x3c/div\x3e\r\n        \x3c!--feature count--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerFeatureCount esriCTLoadingIcon"\r\n          data-dojo-attach-point\x3d"impactSummaryLayerFeatureCount"\x3e\x3c/div\x3e\r\n        \x3c!-- Hint for count exceeding max record count --\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerMaxRecordHint esriCTHidden" title\x3d"${nls.reportsTab.unableToAnalyzeText}"\r\n          data-dojo-attach-point\x3d"impactSummaryLayerMaxRecordHint" tabindex\x3d"-1" role\x3d"button"\r\n          aria-label\x3d"${nls.reportsTab.unableToAnalyzeText}"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--layer description--\x3e\r\n    \x3cdiv class\x3d"esriCTImpactSummaryLayerDetailContainer esriCTHidden"\r\n      data-dojo-attach-point\x3d"impactSummaryLayerDetailContainer"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"impactSummaryLayerDetailsMsg" class\x3d"esriCTImpactSummaryLayerDetailsMsg"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"impactSummaryLayerDetails" class\x3d"esriCTImpactSummaryLayerDetails"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noFieldsSelectedContainer" class\x3d"esriCTNoFieldSelectedContainer esriCTHidden"\x3e\r\n        ${nls.reportsTab.noFieldsSelected}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./impactSummaryReport.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/array dojo/Evented jimu/BaseWidget dojo/on dojo/dom-class dojo/dom-attr esri/geometry/geometryEngine esri/geometry/Polyline esri/SpatialReference esri/graphic dojo/dom-construct esri/tasks/query esri/tasks/QueryTask dojo/Deferred ../geometryUtils ../conversionUtils ../highlightSymbolUtils ../fieldSelectorPopup/fieldSelectorPopup esri/lang jimu/utils dojo/query dojo/number dojo/string dojo/promise/all dojo/keys dijit/focus dojo/_base/event esri/arcadeProfiles/fieldCalculateProfile esri/arcade/arcade esri/arcade/Feature esri/support/expressionUtils esri/arcadeProfiles/utils".split(" "),
function(O,P,Q,k,t,R,S,y,l,p,B,T,U,H,z,J,K,A,L,V,W,X,Y,u,M,D,Z,I,v,E,C,ca,N,aa,F,ba){return O([S,Q,R],{baseClass:"jimu-widget-screening-impactSummaryReport",templateString:P,_feetUnitData:[],_squareFeetUnitData:[],_milesUnitData:[],_acresUnitData:[],_metersUnitData:[],_squareMetersUnitData:[],_kilometersUnitData:[],_squareKilometersUnitData:[],_squareMilesUnitData:[],_hectaresUnitData:[],_printCompleteData:{},_printData:{},_feetUnitInfo:[],_squareFeetUnitInfo:[],_countUnitInfo:[],_milesUnitInfo:[],
_acresUnitInfo:[],_metersUnitInfo:[],_squareMetersUnitInfo:[],_kilometersUnitInfo:[],_squareKilometersUnitInfo:[],_hectaresUnitInfo:[],_squareMilesUnitInfo:[],_intersectFeatureCount:0,isExceedingMaxRecordCount:!1,intersectingFeatureIdsToTolerance:[],intersectingFeatureIds:[],_lengthAnalysisUnitsArray:[],_areaAnalysisUnitsArray:[],_aggregatedFeatureGeometries:[],_featureIntersectResultArr:[],_layerDefinition:null,_isFieldsSelectorClick:!1,_selectedFields:[],sortFieldIndex:null,isTimeoutOccurred:!1,
sortFieldType:null,constructor:function(a){this._feetUnitData=[];this._squareFeetUnitData=[];this._milesUnitData=[];this._acresUnitData=[];this._metersUnitData=[];this._squareMetersUnitData=[];this._kilometersUnitData=[];this._squareKilometersUnitData=[];this._squareMilesUnitData=[];this._hectaresUnitData=[];this._printCompleteData={};this._printData={};this._feetUnitInfo=[];this._squareFeetUnitInfo=[];this._countUnitInfo=[];this._milesUnitInfo=[];this._acresUnitInfo=[];this._metersUnitInfo=[];this._squareMetersUnitInfo=
[];this._kilometersUnitInfo=[];this._squareKilometersUnitInfo=[];this._hectaresUnitInfo=[];this._squareMilesUnitInfo=[];this._intersectFeatureCount=0;this.isExceedingMaxRecordCount=!1;this.intersectingFeatureIdsToTolerance=[];this.intersectingFeatureIds=[];this._lengthAnalysisUnitsArray=[];this._areaAnalysisUnitsArray=[];this._aggregatedFeatureGeometries=[];this._featureIntersectResultArr=[];this._layerDefinition=null;this._isFieldsSelectorClick=!1;this._selectedFields=[];this.sortFieldIndex=null;
this.isTimeoutOccurred=!1;this.sortFieldType=null;k.mixin(this,a)},postCreate:function(){this._layerDefinition=u.getFeatureLayerDefinition(this.featureLayer);this._lengthAnalysisUnitsArray=["Feet","Miles","Meters","Kilometers"];this._areaAnalysisUnitsArray="SquareFeet Acres SquareMeters SquareKilometers Hectares SquareMiles".split(" ");this.own(y(this.impactSummaryLayerMaxRecordHint,"click",k.hitch(this,function(a){a.stopPropagation();a.preventDefault();this.isExceedingMaxRecordCount?this.emit("showMessage",
this.nls.reportsTab.unableToAnalyzeText):this.isTimeoutOccurred?this.emit("showMessage",this.nls.reportsTab.errorLabel):this.emit("showMessage",this.nls.reportsTab.layerNotVisibleText)})));this._attachEventToNodes()},_displayLayerNotVisibleText:function(){l.add(this.impactSummaryLayerFeatureCount,"esriCTHidden");l.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled");p.set(this.impactSummaryLayerMaxRecordHint,"title",this.nls.reportsTab.layerNotVisibleText);p.set(this.impactSummaryLayerMaxRecordHint,
"aria-label",this.nls.reportsTab.layerNotVisibleText);l.remove(this.impactSummaryLayerMaxRecordHint,"esriCTHidden");l.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth");this._showMessage(this.nls.reportsTab.layerNotVisibleText)},generateReport:function(a,b,c){var d,e;var f=new A;this._setAttributeToFeatureLayerContainer();this._setFeatureLayerTitle();this._attachEventToLayerTitle();this._aggregatedFeatureGeometries=[];this._featureIntersectResultArr=[];(e=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))&&
e.isVisible()&&e.isInScale()||e&&!e.isVisible()&&!this.config.allowVisibleLayerAnalysisOnly||e&&!e.isInScale()&&!this.config.allowVisibleLayerAnalysisOnly||this.isFeatureCollectionLayer?this._getIntersectingFeaturesCount(c).then(k.hitch(this,function(g){this._getIntersectingFeaturesCount(b).then(k.hitch(this,function(h){this.intersectingFeatureIdsToTolerance=this._getUniqueIds(g,h);this._getIntersectingFeaturesCount(a).then(k.hitch(this,function(m){this.intersectingFeatureIds=k.clone(m);m=this._getUniqueIds(h,
m);if(this.isExceedingMaxRecordCount)this._setFeatureLayerIntersectFeatureCount(m.length),this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null),this._printData={},this._printData=k.clone(this._printCompleteData),this._showMessage(this.nls.reportsTab.unableToAnalyzeText),l.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled"),this._showReport(),f.resolve(this._getReportLayerDetails([]));else{var n=a||b;this._getFeatureByChunks(m,n).then(k.hitch(this,function(w){var r=
[];this._featureIntersectResultArr=[];t.forEach(w,k.hitch(this,function(x){a&&B.touches(x.geometry,a)||r.push(x)}));var q=[];this._setFeatureLayerIntersectFeatureCount(r.length);0<r.length?("esriGeometryPolyline"!==this.featureLayer.geometryType&&"esriGeometryPolygon"!==this.featureLayer.geometryType||!a?q=r:(d=this._polygonToPolyline(a),q=this._getCutOrWithInFeatures(d,r,a)),this._createLayerDetails(q,this.featureLayer.geometryType).then(k.hitch(this,function(){this._filterPrintDataObjAccToConfiguredFields(this.configuredField);
l.remove(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled");l.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled");this._featureIntersectResultArr=q;this._showReport();f.resolve(this._getReportLayerDetails(q))}))):(this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null),this._printData={},this._printData=k.clone(this._printCompleteData),this._showMessage(this.nls.reportsTab.noDetailsAvailableText),l.remove(this.layerTitleAndFieldParentContainer,
"esriCTLayerSectionDisabled"),this._featureIntersectResultArr=q,this._showReport(),f.resolve(this._getReportLayerDetails(q)))}))}}))}))})):(this._displayLayerNotVisibleText(),f.resolve());return f.promise},retainLastSelectedField:function(){null!==this.retainSelectedFieldsArr&&(this._selectedFields=this.retainSelectedFieldsArr,l.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._filterFieldsForReport(this.retainSelectedFieldsArr))},_getReportLayerDetails:function(a){var b=
{};b.id=this.id;b.featureLayerId=this.featureLayer.id;b.features=a;b.printInfo={};b.printInfo.isExceedingMaxRecordCount=this.isExceedingMaxRecordCount;b.printInfo.featureCount=this._intersectFeatureCount;b.printInfo.info=this._printData;b.printInfo.feetUnitInfo=this._feetUnitInfo;b.printInfo.squareFeetUnitInfo=this._squareFeetUnitInfo;b.printInfo.countUnitInfo=this._countUnitInfo;b.printInfo.milesUnitInfo=this._milesUnitInfo;b.printInfo.acresUnitInfo=this._acresUnitInfo;b.printInfo.metersUnitInfo=
this._metersUnitInfo;b.printInfo.squareMetersUnitInfo=this._squareMetersUnitInfo;b.printInfo.kilometersUnitInfo=this._kilometersUnitInfo;b.printInfo.squareKilometersUnitInfo=this._squareKilometersUnitInfo;b.printInfo.squareMilesUnitInfo=this._squareMilesUnitInfo;b.printInfo.hectaresUnitInfo=this._hectaresUnitInfo;b.printInfo.geometryType=this.featureLayer.geometryType;b.printInfo.groupbyfieldCheckBoxStatus=this.groupbyfieldCheckBoxStatus;b.printInfo.sortInfo=this.sortInfo;return b},_setAttributeToFeatureLayerContainer:function(){p.set(this.impactSummaryLayerContainer,
"featureLayerID",this.featureLayer.id)},_setFeatureLayerTitle:function(a){var b=this.configuredLayerLabel;this.configuredLayerLabel||(b=this.configuredLayerLabel=this.featureLayer.name);if(a||0===a)b=Z.substitute(this.nls.reportsTab.layerNameWithFeatureCount,{layerName:this.configuredLayerLabel,featureCount:a});p.set(this.impactSummaryLayerTitle,"innerHTML",u.sanitizeHTML(this.configuredLayerLabel));p.set(this.impactSummaryLayerTitle,"title",u.sanitizeHTML(this.configuredLayerLabel));p.set(this.layerTitleAndFieldParentContainer,
"aria-label",b)},_attachEventToLayerTitle:function(){this.own(y(this.layerTitleAndFieldParentContainer,"click",k.hitch(this,function(a){l.contains(a.target,"esriCTImpactSummaryLayerFieldIcon")?l.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget():l.contains(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled")||this._showOrHideLayerDetailsContainer()})))},_createFieldSelectorPopupWidget:function(){this._isFieldsSelectorClick=
!0;this._fieldSelectorWidget=new X({outFields:this.configuredField,popupTitle:this.configuredLayerLabel,fieldTitle:this.nls.reportsTab.selectReportFieldTitle,nls:this.nls,appConfig:this.appConfig,retainSelectedFieldsArr:this._fieldSelectorWidget?this._selectedFields:this.retainSelectedFieldsArr,featureLayer:this.featureLayer,sortInfo:this.sortInfo});this._fieldSelectorWidget.startup();y(this._fieldSelectorWidget,"onFieldSelectComplete",k.hitch(this,function(a){this._selectedFields=a.selectedFields;
this.sortInfo=a.sortInfo;this._filterFieldsForReport(this._selectedFields)}));y(this._fieldSelectorWidget,"onCancel",k.hitch(this,function(a){this._selectedFields=a}));"DartTheme"===this.appConfig.theme.name&&l.add(this._fieldSelectorWidget.fieldsPopup.domNode,"esriCTDartPanel")},_getAllFields:function(){var a;var b=[];for(a in this.configuredField)this.configuredField.hasOwnProperty(a)&&(this.configuredField[a].hasOwnProperty("fieldName")&&b.push(this.configuredField[a].fieldName),this.configuredField[a].hasOwnProperty("name")&&
b.push(this.configuredField[a].name));return b},getSelectedFields:function(){return l.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")?null!==this._selectedFields&&0<this._selectedFields.length?this._selectedFields:null!==this._selectedFields&&0===this._selectedFields.length&&null===this.retainSelectedFieldsArr?this._getAllFields():null!==this._selectedFields&&0===this._selectedFields.length&&0===this.retainSelectedFieldsArr.length?[]:this._getAllFields():this._isFieldsSelectorClick&&
null!==this._selectedFields&&0<this._selectedFields.length?this._selectedFields:this._isFieldsSelectorClick&&null!==this._selectedFields&&0===this._selectedFields.length?[]:!this._isFieldsSelectorClick&&null!==this._selectedFields&&0<this._selectedFields.length?this._selectedFields:this._isFieldsSelectorClick||null===this._selectedFields||0!==this._selectedFields.length||null!==this.retainSelectedFieldsArr?this._isFieldsSelectorClick||null===this._selectedFields||0!==this._selectedFields.length||
0!==this.retainSelectedFieldsArr.length?this._getAllFields():[]:this._getAllFields()},_filterFieldsForReport:function(a){var b=k.clone(this.configuredField),c;for(c in this.configuredField)-1>=a.indexOf(c)&&delete b[c];this._filterPrintDataObjAccToConfiguredFields(b);(a=M(".esriCTAttrTableHighlighted",this.domNode.parentElement))&&0<a.length&&p.get(a[0],"esriCTLayerId")===this.featureLayer.id&&(l.remove(a[0],"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear());this._showReport();this.emit("printDataUpdated",
{id:this.id,printData:this._printData,sortInfo:this.sortInfo})},_showOrHideLayerDetailsContainer:function(){l.toggle(this.layerTitleAndFieldParentContainer,"esriCTBoldFont");l.toggle(this.impactSummaryLayerDetailContainer,"esriCTHidden");l.contains(this.layerSectionIcon,"esriCTLayerPanelExpand")?(l.replace(this.layerSectionIcon,"esriCTLayerPanelCollapse","esriCTLayerPanelExpand"),p.set(this.layerSectionIcon,"aria-expanded","true")):(l.replace(this.layerSectionIcon,"esriCTLayerPanelExpand","esriCTLayerPanelCollapse"),
p.set(this.layerSectionIcon,"aria-expanded","false"))},_getIntersectingFeaturesCount:function(a){var b,c;var d=new A;if(a)if(this.isFeatureCollectionLayer){var e=[];if(0<this.featureLayer.graphics.length)for(c=0;c<this.featureLayer.graphics.length;c++)(b=this.featureLayer.graphics[c].geometry?B.intersects(a,this.featureLayer.graphics[c].geometry):null)&&e.push(c);d.resolve(e)}else{var f;e=new J;b=new K(this.featureLayer.url);(f=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))&&(c=f.getFilter()?
f.getFilter():"1\x3d1");c&&(e.where=c);e.geometry=a;b.executeForIds(e,k.hitch(this,function(g){g&&0!==g.length?(g.length>this.maxFeaturesForAnalysis&&(l.remove(this.impactSummaryLayerMaxRecordHint,"esriCTHidden"),l.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth"),this.isExceedingMaxRecordCount=!0,this.emit("exceedingMaxRecordCount")),d.resolve(g)):d.resolve([])}),k.hitch(this,function(g){this.isTimeoutOccurred=!0;l.remove(this.impactSummaryLayerMaxRecordHint,"esriCTHidden");p.set(this.impactSummaryLayerMaxRecordHint,
"title",this.nls.reportsTab.timedOutErrorLabel);p.set(this.impactSummaryLayerMaxRecordHint,"aria-label",this.nls.reportsTab.timedOutErrorLabel);l.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth");d.resolve([])}))}else d.resolve([]);return d.promise},_getFeatureByChunks:function(a,b){var c=new A;var d=[];var e=this.featureLayer.maxRecordCount;if(this.isFeatureCollectionLayer)d.push(this._getIntersectFeature(a,b));else for(;0<a.length;)d.push(this._getIntersectFeature(a.splice(0,e),
b));I(d).then(k.hitch(this,function(f){var g=!1;var h=[];t.forEach(f,k.hitch(this,function(m){null!==m?h=h.concat(m):g=!0}));g?c.resolve([]):c.resolve(h)}));return c.promise},_getIntersectFeature:function(a,b){var c;var d=new A;if(this.isFeatureCollectionLayer){var e=[];if(0<this.featureLayer.graphics.length)for(a=0;a<this.featureLayer.graphics.length;a++)(c=this.featureLayer.graphics[a].geometry?B.intersects(b,this.featureLayer.graphics[a].geometry):null)&&e.push(this.featureLayer.graphics[a]);d.resolve(e.splice(0,
this.maxFeaturesForAnalysis))}else e=new J,e.outFields=["*"],e.returnGeometry=!0,e.objectIds=a,e.outSpatialReference=b.spatialReference,b=new K(this.featureLayer.url),b.execute(e,k.hitch(this,function(f){f.features?d.resolve(f.features):d.resolve([])}),k.hitch(this,function(f){this.isTimeoutOccurred=!0;l.remove(this.impactSummaryLayerMaxRecordHint,"esriCTHidden");p.set(this.impactSummaryLayerMaxRecordHint,"title",this.nls.reportsTab.timedOutErrorLabel);p.set(this.impactSummaryLayerMaxRecordHint,"aria-label",
this.nls.reportsTab.timedOutErrorLabel);l.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth");d.resolve(null)}));return d.promise},_setFeatureLayerIntersectFeatureCount:function(a){this._intersectFeatureCount=D.format(a);l.remove(this.impactSummaryLayerFeatureCount,"esriCTLoadingIcon");p.set(this.impactSummaryLayerFeatureCount,"innerHTML","("+this._intersectFeatureCount+")");p.set(this.impactSummaryLayerFeatureCount,"title","("+this._intersectFeatureCount+")");this._setFeatureLayerTitle(a)},
_isDonutPolygon:function(a){var b=!1;"polygon"===a.type&&1<a.rings.length&&t.forEach(a.rings,k.hitch(this,function(c){a.isClockwise(c)||(b=!0)}));return b},_getCutOrWithInFeatures:function(a,b,c){var d=[];for(var e=0;e<a.length;e++)for(var f=0;f<b.length;f++){var g=B.cut(b[f].geometry,a[e]);0<g.length?d=this._getWithinFeature({cutFeatureArr:g,bufferGeometry:c,featureIntersectResultArr:d,intersectFeatureArr:b,index:f}):(B.within(b[f].geometry,c)?g=new H(b[f].geometry,null,b[f].attributes):(g=B.intersect(b[f].geometry,
c),g=new H(g,null,b[f].attributes,null)),d.push(g))}return d},_getWithinFeature:function(a){var b;var c=a.cutFeatureArr;var d=a.bufferGeometry;var e=a.intersectFeatureArr;var f=a.featureIntersectResultArr;var g=a.index;t.forEach(c,k.hitch(this,function(h){B.within(h,d)&&(b=new H(h,null,e[g].attributes),f.push(b))}));return f},_polygonToPolyline:function(a){var b,c;var d=[];var e=new T(new U({wkid:102100}));for(c=0;c<a.rings.length;c++){var f=[];for(b=0;b<a.rings[c].length;b++)f.push(a.rings[c][b]);
e.addPath(f)}d.push(e);return d},_updateFormattedAttribute:function(a){var b=new A,c=[],d=null;if(!this.isFeatureCollectionLayer){var e=this.layerInfosObj.getLayerInfoById(this.featureLayer.id);d=e.originOperLayer.popupInfo;!d&&e&&e.getPopupInfo&&e.getPopupInfo()&&(d=e.getPopupInfo())}if(d&&d.expressionInfos&&0<d.expressionInfos.length){var f=this.parseArcadeExpressions(d.expressionInfos);t.forEach(a,k.hitch(this,function(g){c.push(this.combineFeatureAttributesAndExpressionResolutions(g,e,d.expressionInfos,
f))}))}I(c).then(k.hitch(this,function(g){t.forEach(a,k.hitch(this,function(h,m){var n;-1===this.intersectingFeatureIds.indexOf(h.attributes[this.featureLayer.objectIdField])&&(n=!0);var w=g&&0<g.length&&g[m]?k.clone(g[m]):k.clone(h.attributes);w=this._getFormatedAttrs(w,this.featureLayer.fields,d);a[m].setAttributes(w);t.forEach(this.featureLayer.fields,k.hitch(this,function(r){a[m].attributes.hasOwnProperty(r.name)||(a[m].attributes[r.name]=this.nls.reportsTab.noDataText);if(a[m].attributes.hasOwnProperty(r.name)){var q=
a[m].attributes[r.name];void 0===q||""===q||null===q?a[m].attributes[r.name]=this.nls.reportsTab.noDataText:""===k.trim(q.toString())&&(a[m].attributes[r.name]=this.nls.reportsTab.noDataText)}}));if(n&&"esriGeometryPolygon"===this.featureLayer.geometryType)this._squareFeetUnitData.push(0),this._acresUnitData.push(0),this._squareMetersUnitData.push(0),this._squareKilometersUnitData.push(0),this._squareMilesUnitData.push(0),this._hectaresUnitData.push(0);else if(n&&"esriGeometryPolyline"===this.featureLayer.geometryType)this._feetUnitData.push(0),
this._milesUnitData.push(0),this._metersUnitData.push(0),this._kilometersUnitData.push(0);else switch(this.featureLayer.geometryType){case "esriGeometryPolygon":h=L.getAreaOfGeometry(h.geometry);this._squareFeetUnitData.push(h.squareFeet);this._acresUnitData.push(h.acres);this._squareMetersUnitData.push(h.squareMeters);this._squareKilometersUnitData.push(h.squareKilometer);this._squareMilesUnitData.push(h.squareMiles);this._hectaresUnitData.push(h.hectares);break;case "esriGeometryPolyline":h=L.getLengthOfGeometry(h.geometry),
this._feetUnitData.push(h.feet),this._milesUnitData.push(h.miles),this._metersUnitData.push(h.meters),this._kilometersUnitData.push(h.kilometers)}}));b.resolve(a)}));return b},_getFieldText:function(a,b){return a.label?a.label:a.alias?a.alias:b},_createLayerDetails:function(a,b){var c,d,e,f,g;var h=Object.keys(this.configuredField).length;var m=new A;this._updateFormattedAttribute(a).then(k.hitch(this,function(n){a=n;this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null);for(g in this.configuredField)for(e=
this.configuredField[g],f=this._getFieldText(e,g),this._printCompleteData.cols.push(f),c=0;c<a.length;c++)switch((d=a[c].attributes[g])||0===d?this._pushDataInPrintDataObj(null,c,d):this._pushDataInPrintDataObj(null,c,""),b){case "esriGeometryPolyline":this._printCompleteData.cols.length===h&&(this._feetUnitInfo.push(this._feetUnitData[c]),this._milesUnitInfo.push(this._milesUnitData[c]),this._metersUnitInfo.push(this._metersUnitData[c]),this._kilometersUnitInfo.push(this._kilometersUnitData[c]));
break;case "esriGeometryPolygon":this._printCompleteData.cols.length===h&&(this._squareFeetUnitInfo.push(this._squareFeetUnitData[c]),this._acresUnitInfo.push(this._acresUnitData[c]),this._squareMetersUnitInfo.push(this._squareMetersUnitData[c]),this._squareKilometersUnitInfo.push(this._squareKilometersUnitData[c]),this._squareMilesUnitInfo.push(this._squareMilesUnitData[c]),this._hectaresUnitInfo.push(this._hectaresUnitData[c]));break;case "esriGeometryPoint":this._printCompleteData.cols.length===
h&&this._countUnitInfo.push(1)}m.resolve()}));return m.promise},_pushDataInPrintDataObj:function(a,b,c){a?(this._printCompleteData={},this._feetUnitInfo=[],this._squareFeetUnitInfo=[],this._countUnitInfo=[],this._milesUnitInfo=[],this._acresUnitInfo=[],this._metersUnitInfo=[],this._squareMetersUnitInfo=[],this._kilometersUnitInfo=[],this.squareKilometersUnitInfo=[],this.squareMilesUnitInfo=[],this._hectaresUnitInfo=[],this._printCompleteData.title=a,this._printCompleteData.rows=[],this._printCompleteData.cols=
[]):(c===this.nls.reportsTab.noDataText&&(c="\x3ci\x3e"+c+"\x3c/i\x3e"),this._printCompleteData.rows[b]||this._printCompleteData.rows.push([]),this._printCompleteData.rows[b].push(c))},_filterPrintDataObjAccToConfiguredFields:function(a){var b,c;this._printData={};this._printData=k.clone(this._printCompleteData);for(b=this._printData.cols.length-1;0<=b;--b){var d=!1;for(c in a)switch(this._printData.cols[b]){case a[c].label:d=!0;break;case a[c].alias:d=!0;break;case c:d=!0}if(!d)for(this._printData.cols.splice(b,
1),d=0;d<this._printData.rows.length;d++)this._printData.rows[d].splice(b,1)}},_getFormatedAttrs:function(a,b,c){function d(g){if(c&&Y.isDefined(c.fieldInfos))for(var h=0,m=c.fieldInfos.length;h<m;h++){var n=c.fieldInfos[h];if(n.fieldName===g)return n.format}return null}var e=[null,void 0,""],f={};t.forEach(b,k.hitch(this,function(g,h){if(-1===e.indexOf(a[g.name])){var m="esriFieldTypeDate"===g.type,n=g.name,w=d(g.name);if("esriFieldTypeDate"===b[h].type)f[n]=u.fieldFormatter.getFormattedDate(a[g.name],
w?w:{dateFormat:"shortDateShortTime"});else if("esriFieldTypeDouble"===b[h].type||"esriFieldTypeSingle"===b[h].type||"esriFieldTypeInteger"===b[h].type||"esriFieldTypeSmallInteger"===b[h].type)f[n]=this._getFormattedNumber(a[g.name],w);m||(f[n]=n in f?f[n]:a[g.name],(g=u.getDisplayValueForCodedValueOrSubtype(this._layerDefinition,g.name,a))&&g.isCodedValueOrSubtype&&g.hasOwnProperty("displayValue")&&-1===e.indexOf(g.displayValue)&&(g=g.displayValue,f[n]=g||isFinite(g)?g:""))}}));c&&c.expressionInfos&&
t.forEach(c.expressionInfos,k.hitch(this,function(g,h){h="expression/"+g.name;var m=d(h);-1===e.indexOf(a[h])&&("date"===g.returnType?f[h]=u.fieldFormatter.getFormattedDate(a[h],m?m:{dateFormat:"shortDateShortTime"}):"number"===g.returnType?f[h]=this._getFormattedNumber(Number(a[h]),m):"string"===g.returnType&&(f[h]=a[h]))}));return f},_getFormattedNumber:function(a,b){if("number"===typeof a){var c=(a.toString().split(".")[1]||"").length;return(a=u.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===
typeof b.places?parseInt(b.places,10):c,digitSeparator:b&&b.digitSeparator}}))||""}return a},_getArrayIndex:function(a,b){var c,d,e=[];for(c=0;c<a.length;++c)if(b.length===a[c].length){var f=a[c];for(d=0;d<b.length&&b[d]===f[d];)++d;d===b.length&&e.push(c)}return e},getSum:function(a,b){a=(b&&0<b.length?t.filter(a,function(c,d){return-1<b.indexOf(d)}):a).reduce(function(c,d){return c+d},0);return.01<a?V.honourPopupRounding(2,a):a},_getAggregatedColTitle:function(a){switch(a){case "esriGeometryPoint":var b=
this.nls.reportsTab.featureCountText;break;case "esriGeometryPolyline":b=this.nls.reportsTab.featureLengthText;break;case "esriGeometryPolygon":b=this.nls.reportsTab.featureAreaText}return b},_getUnitsForGeometry:function(a,b){switch(a){case "esriGeometryPoint":var c="";break;case "esriGeometryPolyline":c=this._getAnalysisUnitForGeometry(b,a);break;case "esriGeometryPolygon":c=this._getAnalysisUnitForGeometry(b,a)}return c},_getAnalysisUnitForGeometry:function(a,b){switch(a){case "Feet":case "SquareFeet":var c=
"esriGeometryPolygon"===b?this.nls.units.feetAbbr+"\x26sup2":this.nls.units.feetAbbr;break;case "Miles":case "Acres":c="esriGeometryPolygon"===b?this.nls.units.acresAbbr:this.nls.units.milesAbbr;break;case "Meters":case "SquareMeters":c="esriGeometryPolygon"===b?this.nls.units.metersAbbr+"\x26sup2":this.nls.units.metersAbbr;break;case "Kilometers":case "SquareKilometers":c="esriGeometryPolygon"===b?this.nls.units.kilometersAbbr+"\x26sup2":this.nls.units.kilometersAbbr;break;case "Hectares":c="esriGeometryPolygon"===
b?this.nls.reportsTab.hectaresAbbr:this.nls.units.kilometersAbbr;break;case "SquareMiles":c="esriGeometryPolygon"===b?this.nls.units.milesAbbr+"\x26sup2":this.nls.units.milesAbbr}return c},_showMessage:function(a){z.empty(this.impactSummaryLayerDetails);p.set(this.impactSummaryLayerDetailsMsg,"innerHTML",a);l.add(this.impactSummaryLayerDetailsMsg,"esriCTLayerDetailCenterText")},_showReport:function(){var a,b,c=[];var d=this._printData;z.empty(this.impactSummaryLayerDetails);if(!d.cols.length&&0<d.rows.length)this._showMessage(this.nls.reportsTab.noFieldsSelected);
else if(d.rows&&0<d.rows.length){p.set(this.impactSummaryLayerDetailsMsg,"innerHTML","");l.remove(this.impactSummaryLayerDetailsMsg,"esriCTLayerDetailCenterText");var e=[];var f={};for(b=0;b<d.rows.length;b++)if(this.groupbyfieldCheckBoxStatus){if(0>e.indexOf(b)){var g=this._getArrayIndex(d.rows,d.rows[b]);f[b]=g;e=e.concat(g)}if(e.length===d.rows.length)break}else g=[],g.push(b),f[b]=g;e={rows:[],cols:k.clone(d.cols)};b=this._getAggregatedColTitle(this.featureLayer.geometryType);"esriGeometryPoint"===
this.featureLayer.geometryType?e.cols.push(b):"esriGeometryPolyline"===this.featureLayer.geometryType?(e.cols.push(b),e.cols.push(b),e.cols.push(b),e.cols.push(b)):"esriGeometryPolygon"===this.featureLayer.geometryType&&(e.cols.push(b),e.cols.push(b),e.cols.push(b),e.cols.push(b),e.cols.push(b),e.cols.push(b));for(a in f){b=k.clone(d.rows[parseInt(a,10)]);if("esriGeometryPolyline"===this.featureLayer.geometryType){var h=this.getSum(this._feetUnitInfo,f[parseInt(a,10)]);b.push(h);b.push(this.getSum(this._milesUnitInfo,
f[parseInt(a,10)]));b.push(this.getSum(this._metersUnitInfo,f[parseInt(a,10)]));g=this.getSum(this._kilometersUnitInfo,f[parseInt(a,10)]);b.push(g)}else if("esriGeometryPolygon"===this.featureLayer.geometryType){var m=this.getSum(this._squareFeetUnitInfo,f[parseInt(a,10)]);b.push(m);b.push(this.getSum(this._acresUnitInfo,f[parseInt(a,10)]));b.push(this.getSum(this._squareMetersUnitInfo,f[parseInt(a,10)]));b.push(this.getSum(this._squareKilometersUnitInfo,f[parseInt(a,10)]));g=this.getSum(this._hectaresUnitInfo,
f[parseInt(a,10)]);b.push(g);b.push(this.getSum(this._squareMilesUnitInfo,f[parseInt(a,10)]))}else if("esriGeometryPoint"===this.featureLayer.geometryType){var n=this.getSum(this._countUnitInfo,f[parseInt(a,10)]);b.push(n)}e.rows.push(b);this._featureIntersectResultArr&&("esriGeometryPolyline"===this.featureLayer.geometryType?c.push({features:this._getAggregatedFeatures(f[a]),sortValue:"esriCTTotalLengthField"===this.sortInfo.sortingField?h:this._getAggregatedFeatures(f[a])[0].attributes[this._getSortFieldValue()]}):
"esriGeometryPolygon"===this.featureLayer.geometryType?c.push({features:this._getAggregatedFeatures(f[a]),sortValue:"esriCTTotalAreaField"===this.sortInfo.sortingField?m:this._getAggregatedFeatures(f[a])[0].attributes[this._getSortFieldValue()]}):"esriGeometryPoint"===this.featureLayer.geometryType&&c.push({features:this._getAggregatedFeatures(f[a]),sortValue:"esriCTCountField"===this.sortInfo.sortingField?n:this._getAggregatedFeatures(f[a])[0].attributes[this._getSortFieldValue()]}))}this._renderReport(e,
c)}},_getAggregatedFeatures:function(a){var b=[];t.forEach(a,k.hitch(this,function(c){b.push(this._featureIntersectResultArr[c])}));return b},_sortFeatureArray:function(a,b){a=a[this.sortFieldIndex];b=b[this.sortFieldIndex];if(a==="\x3ci\x3e"+this.nls.reportsTab.noDataText+"\x3c/i\x3e"||a==="\x3ci\x3e"+this.nls.reportsTab.notApplicableText+"\x3c/i\x3e")a="";if(b==="\x3ci\x3e"+this.nls.reportsTab.noDataText+"\x3c/i\x3e"||a==="\x3ci\x3e"+this.nls.reportsTab.notApplicableText+"\x3c/i\x3e")b="";if("undefined"===
typeof a||null===a||""===a)return"Desc"===this.sortInfo.sortOrder?-1:1;if("undefined"===typeof b||null===b||""===b)return"Desc"===this.sortInfo.sortOrder?1:-1;if(a===b)return 0;"esriFieldTypeDate"===this.sortFieldType&&(a=(new Date(a)).getTime(),b=(new Date(b)).getTime());return-1!=="esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeDate".split(" ").indexOf(this.sortFieldType)?u.parseNumber(a)-u.parseNumber(b):a.toString().localeCompare(b.toString())},
_sortArrayByKey:function(a,b){a=a.sortValue;b=b.sortValue;if(a===this.nls.reportsTab.noDataText||a===this.nls.reportsTab.notApplicableText)a="";if(b===this.nls.reportsTab.noDataText||a===this.nls.reportsTab.notApplicableText)b="";if("undefined"===typeof a||null===a||""===a)return"Desc"===this.sortInfo.sortOrder?-1:1;if("undefined"===typeof b||null===b||""===b)return"Desc"===this.sortInfo.sortOrder?1:-1;if(a===b)return 0;"esriFieldTypeDate"===this.sortFieldType&&(a=(new Date(a)).getTime(),b=(new Date(b)).getTime());
return-1!=="esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeDate".split(" ").indexOf(this.sortFieldType)?u.parseNumber(a)-u.parseNumber(b):a.toString().localeCompare(b.toString())},_createTemplateNode:function(){var a=z.create("div",{"class":"esriCTImpactSummaryLayerDetailMainNode",tabindex:0,role:"presentation"},this.impactSummaryLayerDetails);var b=z.create("table",{"class":"esriCTAttrTable esriCTCursorPointer",cellpadding:"0px",
cellspacing:"0px"},a);z.create("div",{"class":"esriCTInfoDataSeparator"},this.impactSummaryLayerDetails);this.own(y(b,"click",k.hitch(this,function(c){this._highlightSelection(c.currentTarget)})));this.own(y(a,"keydown",k.hitch(this,function(c){c.keyCode!==v.ENTER&&c.keyCode!==v.SPACE||this._highlightSelection(c.currentTarget.children[0])})));return b},_renderReport:function(a,b){var c=this._getSortFieldValue();if(a.rows&&0<a.rows.length){if(-1!==["esriCTCountField","esriCTTotalLengthField","esriCTTotalAreaField"].indexOf(c))this.sortFieldIndex=
"esriGeometryPolyline"===this.featureLayer.geometryType?a.cols.length-4:"esriGeometryPolygon"===this.featureLayer.geometryType?a.cols.length-6:a.cols.length-1;else{var d=this._getFieldText(this.configuredField[c],c);this.sortFieldIndex=a.cols.indexOf(d)}this.sortFieldType=this._getFieldType(c,d);a.rows=a.rows.sort(k.hitch(this,this._sortFeatureArray));"Desc"===this.sortInfo.sortOrder&&a.rows.reverse();b=b.sort(k.hitch(this,this._sortArrayByKey));"Desc"===this.sortInfo.sortOrder&&b.reverse();this._aggregatedFeatureGeometries=
b;t.forEach(a.rows,k.hitch(this,function(e,f){var g;var h=this._createTemplateNode();p.set(h,"esriCTTableIndex",f);p.set(h,"esriCTLayerId",this.featureLayer.id);t.forEach(e,k.hitch(this,function(m,n){g=z.create("tr",{valign:"top"},h);var w=z.create("td",{"class":"esriCTAttrName"},g);var r=z.create("td",{"class":"esriCTAttrValue"},g);var q=u.fieldFormatter.getFormattedUrl(m);m=a.cols[n]+": ";var x=q;switch(this.featureLayer.geometryType){case "esriGeometryPoint":var G=1;break;case "esriGeometryPolyline":G=
4;break;case "esriGeometryPolygon":G=6}if(n>=e.length-G){n-=e.length-G;.01<=q?(q="esriGeometryPoint"!==this.featureLayer.geometryType?D.format(q,{places:2}):D.format(q),"esriGeometryPolyline"===this.featureLayer.geometryType?x=m+q+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._lengthAnalysisUnitsArray[n]):"esriGeometryPolygon"===this.featureLayer.geometryType?x=m+q+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._areaAnalysisUnitsArray[n]):"esriGeometryPoint"===
this.featureLayer.geometryType&&(x=m+q+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,null))):.01>q&&0!==q?"esriGeometryPolyline"===this.featureLayer.geometryType?x=m+"  \x3c "+D.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._lengthAnalysisUnitsArray[n]):"esriGeometryPolygon"===this.featureLayer.geometryType?x=m+"  \x3c "+D.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._areaAnalysisUnitsArray[n]):"esriGeometryPoint"===this.featureLayer.geometryType&&
(x=m+"  \x3c "+D.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,null)):x=m+" "+this.nls.reportsTab.notApplicableText;m="";l.add(w,"esriCTReportsTabInfoData");q="esriGeometryPolyline"===this.featureLayer.geometryType?"esriCTFieldDistinct"+this._lengthAnalysisUnitsArray[n]+"UnitData":"esriCTFieldDistinct"+this._areaAnalysisUnitsArray[n]+"UnitData";l.add(r,"esriCTInfoDataMeasurement esriCTReportsTabInfoData");if("esriGeometryPolyline"===this.featureLayer.geometryType){switch(this._lengthAnalysisUnitsArray[n]){case "Feet":case "Miles":case "Meters":case "Kilometers":l.add(r,
q),l.add(r,"esriCTEsriGeometryPolyline")}this.config.lengthUnits!==this._lengthAnalysisUnitsArray[n]&&l.add(r,"esriCTHidden")}if("esriGeometryPolygon"===this.featureLayer.geometryType){switch(this._areaAnalysisUnitsArray[n]){case "SquareFeet":case "Acres":case "SquareMeters":case "SquareKilometers":case "Hectares":case "SquareMiles":l.add(r,q),l.add(r,"esriCTEsriGeometryPolygon")}this.config.areaUnits!==this._areaAnalysisUnitsArray[n]&&l.add(r,"esriCTHidden")}}p.set(w,"innerHTML",m);p.set(r,"innerHTML",
x)}))}))}},_getUniqueIds:function(a,b){if(0===a.length)return b;if(0===b.length)return a;t.forEach(a,k.hitch(this,function(c){c=b.indexOf(c);-1!==c&&b.splice(c,1)}));return a.concat(b)},_highlightSelection:function(a){var b;l.contains(a,"esriCTAttrTableHighlighted")?(l.remove(a,"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear()):((b=M(".esriCTAttrTableHighlighted",this.domNode.parentElement))&&0<b.length&&l.remove(b[0],"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear(),
l.add(a,"esriCTAttrTableHighlighted"),a=p.get(a,"esriCTTableIndex"),a=this._aggregatedFeatureGeometries[parseInt(a,10)].features,t.forEach(a,k.hitch(this,function(c){c=W.getHighLightSymbol(c,this.featureLayer);this.highlightGraphicsLayer.add(c)})))},_attachEventToNodes:function(){var a=this.own(y.pausable(this.layerTitleAndFieldParentContainer,"keydown",k.hitch(this,function(b){if(b.keyCode===v.ENTER||b.keyCode===v.SPACE)C.stop(b),this._setFocus(),a[0].pause()})));this.own(y(this.layerSectionIcon,
"keydown",k.hitch(this,function(b){if(b.keyCode===v.ENTER||b.keyCode===v.SPACE)C.stop(b),l.contains(this.layerTitleAndFieldParentContainer,"esriCTImpactSummaryLayerFieldIcon")?l.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget():l.contains(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled")||this._showOrHideLayerDetailsContainer();b.keyCode===v.ESCAPE&&(C.stop(b),this._removeFocus(),a[0].resume())})));this.own(y(this.impactSummaryLayerField,
"keydown",k.hitch(this,function(b){if(b.keyCode===v.ENTER||b.keyCode===v.SPACE)C.stop(b),l.contains(b.target,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget();b.keyCode===v.ESCAPE&&(C.stop(b),this._removeFocus(),a[0].resume())})));this.own(y(this.impactSummaryLayerMaxRecordHint,"keydown",k.hitch(this,function(b){if(b.keyCode===v.ENTER||b.keyCode===v.SPACE)C.stop(b),this.isExceedingMaxRecordCount?this.emit("showMessage",this.nls.reportsTab.unableToAnalyzeText):this.isTimeoutOccurred?
this.emit("showMessage",this.nls.reportsTab.errorLabel):this.emit("showMessage",this.nls.reportsTab.layerNotVisibleText);b.keyCode===v.ESCAPE&&(C.stop(b),this._removeFocus(),a[0].resume())})))},_removeFocus:function(){this._restrictFocus();this.emit("initializeAccessibility");this._focusOutCurrentNode();E.focus(this.layerTitleAndFieldParentContainer)},_setFocus:function(){this._allowFocus();this._setFirstFocusNode();this._setLastFocusNode();this._setFocusOnFirstNode()},_restrictFocus:function(){p.set(this.layerSectionIcon,
"tabindex","-1");p.set(this.impactSummaryLayerMaxRecordHint,"tabindex","-1");p.set(this.impactSummaryLayerField,"tabindex","-1")},_allowFocus:function(){p.set(this.layerSectionIcon,"tabindex","1");l.contains(this.impactSummaryLayerMaxRecordHint,"esriCTHidden")||p.set(this.impactSummaryLayerMaxRecordHint,"tabindex","1");l.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||p.set(this.impactSummaryLayerField,"tabindex","1")},_setFirstFocusNode:function(){u.initFirstFocusNode(this.domNodeObj,
this.layerSectionIcon)},_setLastFocusNode:function(){l.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")?l.contains(this.impactSummaryLayerMaxRecordHint,"esriCTHidden")?u.initLastFocusNode(this.domNodeObj,this.layerSectionIcon):u.initLastFocusNode(this.domNodeObj,this.impactSummaryLayerMaxRecordHint):u.initLastFocusNode(this.domNodeObj,this.impactSummaryLayerField)},_focusOutCurrentNode:function(){E.curNode&&E.curNode.blur()},_setFocusOnFirstNode:function(){this._focusOutCurrentNode();
E.focus(this.layerSectionIcon)},parseArcadeExpressions:function(a){if(Array.isArray(a)&&0<a.length){var b={};t.forEach(a,function(c){b[c.name]=N.parseScript(c.expression)})}return b},initArcadeContext:function(a,b,c){var d=null,e=null;this.map&&(d=this.map);b&&b.layerObject&&(b=b.layerObject);a&&a.geometry&&a.geometry.spatialReference&&(e=a.geometry.spatialReference);return this.getEvalOptions({expression:c,feature:a,layer:b,map:d,sr:e}).context},getEvalOptions:function(a){var b=a.feature,c=a.layer,
d=a.map;a=a.spatialReference;b=b?aa.createFromGraphicLikeObject(b.geometry,b.attributes,c):null;if(c){var e={spatialReference:a};var f=c.getMap()?F.createFeatureSetFromLayer(c,e):F.createFeatureSetFromLayerUrl(c.url,e);e=(c=ba.getServiceUrl(c.url))?F.createFeatureSetCollectionFromServiceUrl(c,e):null}d=d?F.createFeatureSetCollectionFromMap(d):null;return{context:{vars:{$feature:b,$layer:f,$datastore:e,$map:d},spatialReference:a}}},combineFeatureAttributesAndExpressionResolutions:function(a,b,c,d){var e=
new A,f=[],g;var h=k.mixin({},a.attributes);if(d){a=this.initArcadeContext(a,b,c,d);for(g in d)f.push(this.executeArcadeExpression(g,d[g],a,h));I(f).then(function(){e.resolve(h)})}else e.resolve(h);return e.promise},executeArcadeExpression:function(a,b,c,d){var e=new A;(b=N.executeScript(b,c))&&b.then?b.then(function(f){d["expression/"+a]=f?f.toString():"";e.resolve(f)},function(f){d["expression/"+a]=f?f.toString():"";e.resolve(f)}):(d["expression/"+a]=b?b.toString():"",e.resolve(b));return e.promise},
_getFieldType:function(a,b){var c="esriFieldTypeString";if("esriCTCountField"===a||"esriCTTotalLengthField"===a||"esriCTTotalAreaField"===a)return"esriFieldTypeInteger";for(var d in this.configuredField){a=this.configuredField[d];var e=this._getFieldText(a,d);if(e===b)if(a.type)c=a.type;else if(a.format){if(a=a.format,a.hasOwnProperty("dateFormat")&&(c="esriFieldTypeDate"),a.hasOwnProperty("digitSeparator")||a.hasOwnProperty("places"))c="esriFieldTypeInteger"}else a.hasOwnProperty("returnType")?("number"===
a.returnType&&(c="esriFieldTypeInteger"),"string"===a.returnType&&(c="esriFieldTypeString")):c="esriFieldTypeString"}return c},_getSortFieldValue:function(){var a=["esriCTCountField","esriCTTotalLengthField","esriCTTotalAreaField"],b=this.sortInfo.sortingField;if(-1===Object.keys(this.configuredField).indexOf(b)&&-1===a.indexOf(b))for(var c in this.configuredField)a=this.configuredField[c],a=this._getFieldText(a,c),a===b&&(b=c);return b}})});